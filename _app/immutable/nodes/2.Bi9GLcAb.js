import{d as Se,a as ae,f as ze,p as bn,l as hr,t as Ys,m as so}from"../chunks/y9CSy2bM.js";import{i as ka}from"../chunks/s_gUsukN.js";import{h as ls,I as pc,H as mc,l as N,ar as gc,af as vc,K as yc,U as ro,S as no,a4 as Ar,e as Fs,J as bc,a9 as wc,R as Sc,c as Cc,b as rn,s as Ec,a7 as xa,aJ as kc,a as Aa,ai as Di,C as oo,aT as xc,aU as Ac,aV as Rc,r as Ra,p as Tc,aW as Rr,a2 as Lc,aX as Dc,aY as Oc,a6 as Ic,d as Pc,ag as Ta,i as bt,D as Mc,n as La,ac as Bc,aZ as Uc,a_ as Nc,az as Fc,ap as zc,u as Hc,aB as Z,ay as Da,al as Gt,g as wn,t as Ue,v as ye,x as Ne,y as Pe,ab as st,z as Me,a$ as Xe,b0 as Mi,w as ir,b1 as qc,b2 as Wc,A as Ot,T as zs,b3 as $c}from"../chunks/B3iw4AZn.js";import{s as Sn}from"../chunks/Df-nOmkS.js";import{s as ke,b as Ye,c as ao,h as jc}from"../chunks/C-S9_zVh.js";import{a as Cn,o as Oa,w as Vc,g as jt}from"../chunks/BEeVc2IM.js";import{i as We,r as Ve,_ as nn,p as Fi,b as Tr,s as Gc,a as Kc,c as us}from"../chunks/Bv9p-gIO.js";function Xc(e,t){return t}function Yc(e,t,i){for(var s=[],n=t.length,a=0;a<n;a++)Dc(t[a].e,s,!0);Oc(s,()=>{var c=s.length===0&&i!==null;if(c){var r=i,o=r.parentNode;Ic(o),o.append(r),e.items.clear(),Kt(e,t[0].prev,t[n-1].next)}for(var u=0;u<n;u++){var f=t[u];c||(e.items.delete(f.k),Kt(e,f.prev,f.next)),Pc(f.e,!c)}e.first===t[0]&&(e.first=t[0].prev)})}function Jc(e,t,i,s,n,a=null){var c=e,r={items:new Map,first:null};ls&&pc();var o=null,u=gc(()=>{var C=i();return kc(C)?C:C==null?[]:xa(C)}),f,l=!0;function m(){Zc(g,f,r,c,t,s),o!==null&&(f.length===0?(o.fragment?(c.before(o.fragment),o.fragment=null):Ra(o.effect),g.first=o.effect):Tc(o.effect,()=>{o=null}))}var g=mc(()=>{f=N(u);var C=f.length;let v=!1;if(ls){var h=vc(c)===yc;h!==(C===0)&&(c=ro(),no(c),Ar(!1),v=!0)}for(var p=new Set,_=Cc,d=null,y=Ec(),S=0;S<C;S+=1){ls&&Fs.nodeType===bc&&Fs.data===wc&&(c=Fs,v=!0,Ar(!1));var w=f[S],E=s(w,S),b=l?null:r.items.get(E);b?(Sc(b.v,w),b.i=S,y&&_.skipped_effects.delete(b.e)):(b=Qc(l?c:null,d,w,E,S,n,t,i),l&&(b.o=!0,d===null?r.first=b:d.next=b,d=b),r.items.set(E,b)),p.add(E)}if(C===0&&a&&!o)if(l)o={fragment:null,effect:rn(()=>a(c))};else{var k=document.createDocumentFragment(),R=Aa();k.append(R),o={fragment:k,effect:rn(()=>a(R))}}if(ls&&C>0&&no(ro()),!l)if(y){for(const[O,P]of r.items)p.has(O)||_.skipped_effects.add(P.e);_.oncommit(m),_.ondiscard(()=>{})}else m();v&&Ar(!0),N(u)});l=!1,ls&&(c=Fs)}function Zc(e,t,i,s,n,a){var c=t.length,r=i.items,o=i.first,u,f=null,l=[],m=[],g,C,v,h;for(h=0;h<c;h+=1){if(g=t[h],C=a(g,h),v=r.get(C),i.first??=v,!v.o){v.o=!0;var p=f?f.next:o;Kt(i,f,v),Kt(i,v,p),Lr(v,p,s),f=v,l=[],m=[],o=f.next;continue}if((v.e.f&Rr)!==0&&Ra(v.e),v!==o){if(u!==void 0&&u.has(v)){if(l.length<m.length){var _=m[0],d;f=_.prev;var y=l[0],S=l[l.length-1];for(d=0;d<l.length;d+=1)Lr(l[d],_,s);for(d=0;d<m.length;d+=1)u.delete(m[d]);Kt(i,y.prev,S.next),Kt(i,f,y),Kt(i,S,_),o=_,f=S,h-=1,l=[],m=[]}else u.delete(v),Lr(v,o,s),Kt(i,v.prev,v.next),Kt(i,v,f===null?i.first:f.next),Kt(i,f,v),f=v;continue}for(l=[],m=[];o!==null&&o.k!==C;)(o.e.f&Rr)===0&&(u??=new Set).add(o),m.push(o),o=o.next;if(o===null)continue;v=o}l.push(v),f=v,o=v.next}if(o!==null||u!==void 0){for(var w=u===void 0?[]:xa(u);o!==null;)(o.e.f&Rr)===0&&w.push(o),o=o.next;var E=w.length;if(E>0){var b=null;Yc(i,w,b)}}e.first=i.first&&i.first.e,e.last=f&&f.e,f&&(f.e.next=null)}function Qc(e,t,i,s,n,a,c,r){var o=(c&Ac)!==0,u=(c&Rc)===0,f=o?u?Di(i,!1,!1):oo(i):i,l=(c&xc)===0?n:oo(n),m={i:l,v:f,k:s,a:null,e:null,o:!1,prev:t,next:null};try{if(e===null){var g=document.createDocumentFragment();g.append(e=Aa())}return m.e=rn(()=>a(e,f,l,r)),m.e.prev=t&&t.e,t!==null&&(t.next=m,t.e.next=m.e),m}finally{}}function Lr(e,t,i){for(var s=e.next?e.next.e.nodes_start:i,n=t?t.e.nodes_start:i,a=e.e.nodes_start;a!==null&&a!==s;){var c=Lc(a);n.before(a),a=c}}function Kt(e,t,i){t===null?e.first=i:(t.next=i,t.e.next=i&&i.e),i!==null&&(i.prev=t,i.e.prev=t&&t.e)}function el(e,t,i){Ta(()=>{var s=bt(()=>t(e,i?.())||{});if(i&&s?.update){var n=!1,a={};Mc(()=>{var c=i();La(c),n&&Bc(a,c)&&(a=c,s.update(c))}),n=!0}if(s?.destroy)return()=>s.destroy()})}function Rs(e){const t=Symbol();return{key:t,consume(){return Nc(t)||e},provide(i){return Uc(t,i)}}}const St={trigger:"",contextTrigger:"",positioner:"",indicator:"",content:"skb:card skb:bg-surface-50-950 skb:border skb:border-surface-200-800 skb:p-2 skb:flex skb:flex-col skb:items-stretch skb:gap-2 skb:shadow-lg skb:min-w-48",arrow:"",arrowTip:"",itemGroup:"",itemGroupLabel:"skb:text-surface-600-400 skb:text-xs skb:px-2 skb:py-1",item:"skb:flex skb:justify-between skb:items-center skb:px-2 skb:py-1 skb:rounded skb:cursor-pointer skb:data-highlighted:preset-tonal",itemText:"",itemIndicator:"",separator:"skb:hr"},_i={root:"skb:flex skb:flex-col skb:gap-2 skb:data-[orientation=horizontal]:w-full skb:data-[orientation=vertical]:items-center",label:"skb:whitespace-nowrap",valueText:"",track:"skb:bg-surface-200-800 skb:rounded-base skb:overflow-hidden skb:data-[orientation=horizontal]:w-full skb:data-[orientation=horizontal]:h-2 skb:data-[orientation=vertical]:w-2 skb:data-[orientation=vertical]:h-[100px] skb:data-[orientation=vertical]:flex skb:data-[orientation=vertical]:flex-col-reverse",range:"skb:h-full skb:bg-surface-950-50 skb:rounded-base skb:data-[orientation=horizontal]:transition-[width] skb:data-[orientation=horizontal]:data-[state=indeterminate]:animate-progress-linear-indeterminate-horizontal skb:data-[orientation=vertical]:transition-[height] skb:data-[orientation=vertical]:data-[state=indeterminate]:animate-progress-linear-indeterminate-vertical",circle:"",circleTrack:"skb:stroke-surface-200-800",circleRange:"skb:stroke-primary-500 skb:transition-[stroke-dashoffset] skb:ease-in-out skb:data-[state=indeterminate]:animate-progress-circular-indeterminate"};function tl(e){return e==null?[]:Array.isArray(e)?e:[e]}var il=e=>e[0],sl=e=>e[e.length-1];function Ia(e,t,i={}){const{step:s=1,loop:n=!0}=i,a=t+s,c=e.length,r=c-1;return t===-1?s>0?0:r:a<0?n?r:0:a>=c?n?0:t>c?c:t:a}function rl(e,t,i={}){return e[Ia(e,t,i)]}function nl(e,t,i={}){const{step:s=1,loop:n=!0}=i;return Ia(e,t,{step:-s,loop:n})}function ol(e,t,i={}){return e[nl(e,t,i)]}var ho=e=>e?.constructor.name==="Array",al=(e,t)=>{if(e.length!==t.length)return!1;for(let i=0;i<e.length;i++)if(!Ts(e[i],t[i]))return!1;return!0},Ts=(e,t)=>{if(Object.is(e,t))return!0;if(e==null&&t!=null||e!=null&&t==null)return!1;if(typeof e?.isEqual=="function"&&typeof t?.isEqual=="function")return e.isEqual(t);if(typeof e=="function"&&typeof t=="function")return e.toString()===t.toString();if(ho(e)&&ho(t))return al(Array.from(e),Array.from(t));if(typeof e!="object"||typeof t!="object")return!1;const i=Object.keys(t??Object.create(null)),s=i.length;for(let n=0;n<s;n++)if(!Reflect.has(e,i[n]))return!1;for(let n=0;n<s;n++){const a=i[n];if(!Ts(e[a],t[a]))return!1}return!0},hl=e=>e!=null&&typeof e=="object",Pa=e=>typeof e=="number"&&!Number.isNaN(e),Js=e=>typeof e=="string",Oi=e=>typeof e=="function",cl=e=>e==null,Zs=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),ll=e=>Object.prototype.toString.call(e),Ma=Function.prototype.toString,ul=Ma.call(Object),_l=e=>{if(!hl(e)||ll(e)!="[object Object]"||pl(e))return!1;const t=Object.getPrototypeOf(e);if(t===null)return!0;const i=Zs(t,"constructor")&&t.constructor;return typeof i=="function"&&i instanceof i&&Ma.call(i)==ul},dl=e=>typeof e=="object"&&e!==null&&"$$typeof"in e&&"props"in e,fl=e=>typeof e=="object"&&e!==null&&"__v_isVNode"in e,pl=e=>dl(e)||fl(e),co=e=>e,ml=e=>e(),gl=()=>{},on=(...e)=>(...t)=>{e.forEach(function(i){i?.(...t)})},vl=e=>Number.isNaN(e),yl=e=>vl(e)?0:e,bl=(e,t,i)=>(yl(e)-t)/(i-t);function En(e){if(!_l(e)||e===void 0)return e;const t=Reflect.ownKeys(e).filter(s=>typeof s=="string"),i={};for(const s of t){const n=e[s];n!==void 0&&(i[s]=En(n))}return i}function wl(e,t){const i={},s={},n=new Set(t),a=Reflect.ownKeys(e);for(const c of a)n.has(c)?s[c]=e[c]:i[c]=e[c];return[s,i]}var Qi=e=>function(i){return wl(i,e)};function an(...e){e.length===1?e[0]:e[1],e.length===2&&e[0]}function Sl(e,t){if(e==null)throw new Error(t())}var Cl=Object.defineProperty,El=(e,t,i)=>t in e?Cl(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,Dr=(e,t,i)=>El(e,typeof t!="symbol"?t+"":t,i),kl=(e,t)=>e.map((i,s)=>e[(Math.max(t,0)+s)%e.length]),xl=()=>{},cr=e=>typeof e=="object"&&e!==null,zi=e=>e?"":void 0,Al=e=>e?"true":void 0,Rl=1,Tl=9,Ll=11,ft=e=>cr(e)&&e.nodeType===Rl&&typeof e.nodeName=="string",kn=e=>cr(e)&&e.nodeType===Tl,Dl=e=>cr(e)&&e===e.window,Ba=e=>ft(e)?e.localName||"":"#document";function Ol(e){return["html","body","#document"].includes(Ba(e))}var Il=e=>cr(e)&&e.nodeType!==void 0,Xi=e=>Il(e)&&e.nodeType===Ll&&"host"in e,Pl=e=>ft(e)&&e.localName==="input",Ml=e=>!!e?.matches("a[href]"),Bl=e=>ft(e)?e.offsetWidth>0||e.offsetHeight>0||e.getClientRects().length>0:!1;function hn(e){if(!e)return!1;const t=e.getRootNode();return Na(t)===e}var Ul=/(textarea|select)/;function Ua(e){if(e==null||!ft(e))return!1;try{return Pl(e)&&e.selectionStart!=null||Ul.test(e.localName)||e.isContentEditable||e.getAttribute("contenteditable")==="true"||e.getAttribute("contenteditable")===""}catch{return!1}}function bi(e,t){if(!e||!t||!ft(e)||!ft(t))return!1;const i=t.getRootNode?.();if(e===t||e.contains(t))return!0;if(i&&Xi(i)){let s=t;for(;s;){if(e===s)return!0;s=s.parentNode||s.host}}return!1}function Bi(e){return kn(e)?e:Dl(e)?e.document:e?.ownerDocument??document}function Nl(e){return Bi(e).documentElement}function ki(e){return Xi(e)?ki(e.host):kn(e)?e.defaultView??window:ft(e)?e.ownerDocument?.defaultView??window:window}function Na(e){let t=e.activeElement;for(;t?.shadowRoot;){const i=t.shadowRoot.activeElement;if(!i||i===t)break;t=i}return t}function Fl(e){if(Ba(e)==="html")return e;const t=e.assignedSlot||e.parentNode||Xi(e)&&e.host||Nl(e);return Xi(t)?t.host:t}function zl(e){let t;try{if(t=e.getRootNode({composed:!0}),kn(t)||Xi(t))return t}catch{}return e.ownerDocument??document}var Or=new WeakMap;function Hl(e){return Or.has(e)||Or.set(e,ki(e).getComputedStyle(e)),Or.get(e)}var ql=new Set(["menu","listbox","dialog","grid","tree","region"]),Wl=e=>ql.has(e),$l=e=>e.getAttribute("aria-controls")?.split(" ")||[];function jl(e,t){const i=new Set,s=zl(e),n=a=>{const c=a.querySelectorAll("[aria-controls]");for(const r of c){if(r.getAttribute("aria-expanded")!=="true")continue;const o=$l(r);for(const u of o){if(!u||i.has(u))continue;i.add(u);const f=s.getElementById(u);if(f){const l=f.getAttribute("role"),m=f.getAttribute("aria-modal")==="true";if(l&&Wl(l)&&!m&&(f===t||f.contains(t)||n(f)))return!0}}}return!1};return n(e)}var xn=()=>typeof document<"u";function Vl(){return navigator.userAgentData?.platform??navigator.platform}function Gl(){const e=navigator.userAgentData;return e&&Array.isArray(e.brands)?e.brands.map(({brand:t,version:i})=>`${t}/${i}`).join(" "):navigator.userAgent}var Kl=e=>xn()&&e.test(Vl()),Xl=e=>xn()&&e.test(Gl()),lo=()=>xn()&&!!navigator.maxTouchPoints,Fa=()=>Kl(/^Mac/i),Yl=()=>Xl(/Firefox/i);function Jl(e){return e.composedPath?.()??e.nativeEvent?.composedPath?.()}function Si(e){return Jl(e)?.[0]??e.target}function uo(e){const t=e.currentTarget;if(!t||!t.matches("a[href], button[type='submit'], input[type='submit']"))return!1;const s=e.button===1,n=Zl(e);return s||n}function _o(e){const t=e.currentTarget;if(!t)return!1;const i=t.localName;return e.altKey?i==="a"||i==="button"&&t.type==="submit"||i==="input"&&t.type==="submit":!1}function Zl(e){return Fa()?e.metaKey:e.ctrlKey}function Ql(e){return e.key.length===1&&!e.ctrlKey&&!e.metaKey}var za=e=>e.button===2||Fa()&&e.ctrlKey&&e.button===0,eu=e=>e.ctrlKey||e.altKey||e.metaKey,tu=e=>"touches"in e&&e.touches.length>0,iu={Up:"ArrowUp",Down:"ArrowDown",Esc:"Escape"," ":"Space",",":"Comma",Left:"ArrowLeft",Right:"ArrowRight"},fo={ArrowLeft:"ArrowRight",ArrowRight:"ArrowLeft"};function po(e,t={}){const{dir:i="ltr",orientation:s="horizontal"}=t;let n=e.key;return n=iu[n]??n,i==="rtl"&&s==="horizontal"&&n in fo&&(n=fo[n]),n}function Hs(e,t="client"){const i=tu(e)?e.touches[0]||e.changedTouches[0]:e;return{x:i[`${t}X`],y:i[`${t}Y`]}}var vs=(e,t,i,s)=>{const n=typeof e=="function"?e():e;return n?.addEventListener(t,i,s),()=>{n?.removeEventListener(t,i,s)}},su=e=>ft(e)&&e.tagName==="IFRAME";function ru(e){const t=e.getAttribute("tabindex");return t?parseInt(t,10):NaN}var nu=e=>ru(e)<0;function ou(e,t){if(!t)return null;if(t===!0)return e.shadowRoot||null;const i=t(e);return(i===!0?e.shadowRoot:i)||null}function au(e,t,i){const s=[...e],n=[...e],a=new Set,c=new Map;e.forEach((o,u)=>c.set(o,u));let r=0;for(;r<n.length;){const o=n[r++];if(!o||a.has(o))continue;a.add(o);const u=ou(o,t);if(u){const f=Array.from(u.querySelectorAll(An)).filter(i),l=c.get(o);if(l!==void 0){const m=l+1;s.splice(m,0,...f),f.forEach((g,C)=>{c.set(g,m+C)});for(let g=m+f.length;g<s.length;g++)c.set(s[g],g)}else{const m=s.length;s.push(...f),f.forEach((g,C)=>{c.set(g,m+C)})}n.push(...f)}}return s}var An="input:not([type='hidden']):not([disabled]), select:not([disabled]), textarea:not([disabled]), a[href], button:not([disabled]), [tabindex], iframe, object, embed, area[href], audio[controls], video[controls], [contenteditable]:not([contenteditable='false']), details > summary:first-of-type";function Rn(e){return!ft(e)||e.closest("[inert]")?!1:e.matches(An)&&Bl(e)}function Tn(e,t={}){if(!e)return[];const{includeContainer:i,getShadowRoot:s}=t,n=Array.from(e.querySelectorAll(An));i&&Ir(e)&&n.unshift(e);const a=[];for(const c of n)if(Ir(c)){if(su(c)&&c.contentDocument){const r=c.contentDocument.body;a.push(...Tn(r,{getShadowRoot:s}));continue}a.push(c)}if(s){const c=au(a,s,Ir);return!c.length&&i?n:c}return!a.length&&i?n:a}function Ir(e){return ft(e)&&e.tabIndex>0?!0:Rn(e)&&!nu(e)}function hu(e,t={}){const i=Tn(e,t),s=i[0]||null,n=i[i.length-1]||null;return[s,n]}function cu(e){const{root:t,getInitialEl:i,filter:s,enabled:n=!0}=e;if(!n)return;let a=null;if(a||(a=typeof i=="function"?i():i),a||(a=t?.querySelector("[data-autofocus],[autofocus]")),!a){const c=Tn(t);a=s?c.filter(s)[0]:c[0]}return a||t||void 0}function lu(e){const t=e.currentTarget;if(!t)return!1;const[i,s]=hu(t);return!(hn(i)&&e.shiftKey||hn(s)&&!e.shiftKey||!i&&!s)}var uu=class Ha{constructor(){Dr(this,"id",null),Dr(this,"fn_cleanup"),Dr(this,"cleanup",()=>{this.cancel()})}static create(){return new Ha}request(t){this.cancel(),this.id=globalThis.requestAnimationFrame(()=>{this.id=null,this.fn_cleanup=t?.()})}cancel(){this.id!==null&&(globalThis.cancelAnimationFrame(this.id),this.id=null),this.fn_cleanup?.(),this.fn_cleanup=void 0}isActive(){return this.id!==null}};function Ft(e){const t=uu.create();return t.request(e),t.cleanup}function _u(e,t,i){const s=Ft(()=>{e.removeEventListener(t,n,!0),i()}),n=()=>{s(),i()};return e.addEventListener(t,n,{once:!0,capture:!0}),s}function du(e,t){if(!e)return;const{attributes:i,callback:s}=t,n=e.ownerDocument.defaultView||window,a=new n.MutationObserver(c=>{for(const r of c)r.type==="attributes"&&r.attributeName&&i.includes(r.attributeName)&&s(r)});return a.observe(e,{attributes:!0,attributeFilter:i}),()=>a.disconnect()}function fu(e,t){const i=Ft,s=[];return s.push(i(()=>{const n=typeof e=="function"?e():e;s.push(du(n,t))})),()=>{s.forEach(n=>n?.())}}function pu(e){const t=()=>{const i=ki(e);e.dispatchEvent(new i.MouseEvent("click"))};Yl()?_u(e,"keyup",t):queueMicrotask(t)}function cn(e){const t=Fl(e);return Ol(t)?Bi(t).body:ft(t)&&qa(t)?t:cn(t)}var mu=/auto|scroll|overlay|hidden|clip/,gu=new Set(["inline","contents"]);function qa(e){const t=ki(e),{overflow:i,overflowX:s,overflowY:n,display:a}=t.getComputedStyle(e);return mu.test(i+n+s)&&!gu.has(a)}function vu(e){return e.scrollHeight>e.clientHeight||e.scrollWidth>e.clientWidth}function yu(e,t){const{rootEl:i,...s}=t||{};!e||!i||!qa(i)||!vu(i)||e.scrollIntoView(s)}function bu(e,t){return Array.from(e?.querySelectorAll(t)??[])}var Ln=e=>e.id;function wu(e,t,i=Ln){return e.find(s=>i(s)===t)}function Su(e,t,i=Ln){const s=wu(e,t,i);return s?e.indexOf(s):-1}var Cu=e=>e.split("").map(t=>{const i=t.charCodeAt(0);return i>0&&i<128?t:i>=128&&i<=255?`/x${i.toString(16)}`.replace("/","\\"):""}).join("").trim(),Eu=e=>Cu(e.dataset?.valuetext??e.textContent??""),ku=(e,t)=>e.trim().toLowerCase().startsWith(t.toLowerCase());function xu(e,t,i,s=Ln){const n=i?Su(e,i,s):-1;let a=i?kl(e,n):e;return t.length===1&&(a=a.filter(r=>s(r)!==i)),a.find(r=>ku(Eu(r),t))}function Au(e,t){if(!e)return xl;const i=Object.keys(t).reduce((s,n)=>(s[n]=e.style.getPropertyValue(n),s),{});return Object.assign(e.style,t),()=>{Object.assign(e.style,i),e.style.length===0&&e.removeAttribute("style")}}function Ru(e,t){const{state:i,activeId:s,key:n,timeout:a=350,itemToId:c}=t,r=i.keysSoFar+n,u=r.length>1&&Array.from(r).every(C=>C===r[0])?r[0]:r;let f=e.slice();const l=xu(f,u,s,c);function m(){clearTimeout(i.timer),i.timer=-1}function g(C){i.keysSoFar=C,m(),C!==""&&(i.timer=+setTimeout(()=>{g(""),m()},a))}return g(r),l}var Wa=Object.assign(Ru,{defaultOptions:{keysSoFar:"",timer:-1},isValidEvent:Tu});function Tu(e){return e.key.length===1&&!e.ctrlKey&&!e.metaKey}function Lu(e,t,i){const{signal:s}=t;return[new Promise((c,r)=>{const o=setTimeout(()=>{r(new Error(`Timeout of ${i}ms exceeded`))},i);s.addEventListener("abort",()=>{clearTimeout(o),r(new Error("Promise aborted"))}),e.then(u=>{s.aborted||(clearTimeout(o),c(u))}).catch(u=>{s.aborted||(clearTimeout(o),r(u))})}),()=>t.abort()]}function Du(e,t){const{timeout:i,rootNode:s}=t,n=ki(s),a=Bi(s),c=new n.AbortController;return Lu(new Promise(r=>{const o=e();if(o){r(o);return}const u=new n.MutationObserver(()=>{const f=e();f&&f.isConnected&&(u.disconnect(),r(f))});u.observe(a.body,{childList:!0,subtree:!0})}),c,i)}var Ou=(...e)=>e.map(t=>t?.trim?.()).filter(Boolean).join(" "),Iu=/((?:--)?(?:\w+-?)+)\s*:\s*([^;]*)/g,mo=e=>{const t={};let i;for(;i=Iu.exec(e);)t[i[1]]=i[2];return t},Pu=(e,t)=>{if(Js(e)){if(Js(t))return`${e};${t}`;e=mo(e)}else Js(t)&&(t=mo(t));return Object.assign({},e??{},t??{})};function $a(...e){let t={};for(let i of e){if(!i)continue;for(let n in t){if(n.startsWith("on")&&typeof t[n]=="function"&&typeof i[n]=="function"){t[n]=on(i[n],t[n]);continue}if(n==="className"||n==="class"){t[n]=Ou(t[n],i[n]);continue}if(n==="style"){t[n]=Pu(t[n],i[n]);continue}t[n]=i[n]!==void 0?i[n]:t[n]}for(let n in i)t[n]===void 0&&(t[n]=i[n]);const s=Object.getOwnPropertySymbols(i);for(let n of s)t[n]=i[n]}return t}function Mu(e,t,i){let s=[],n;return a=>{const c=e(a);return(c.length!==s.length||c.some((o,u)=>!Ts(s[u],o)))&&(s=c,n=t(c,a)),n}}function Bu(){return{and:(...e)=>function(i){return e.every(s=>i.guard(s))},or:(...e)=>function(i){return e.some(s=>i.guard(s))},not:e=>function(i){return!i.guard(e)}}}var ji=(e=>(e.NotStarted="Not Started",e.Started="Started",e.Stopped="Stopped",e))(ji||{}),Pr="__init__";function Uu(e){const t=()=>e.getRootNode?.()??document,i=()=>Bi(t());return{...e,getRootNode:t,getDoc:i,getWin:()=>i().defaultView??window,getActiveElement:()=>Na(t()),isActiveElement:hn,getById:c=>t().getElementById(c)}}function Nu(e){return new Proxy({},{get(t,i){return i==="style"?s=>e({style:s}).style:e}})}var es=()=>e=>Array.from(new Set(e));const go={className:"class",defaultChecked:"checked",defaultValue:"value",htmlFor:"for",onBlur:"onfocusout",onChange:"oninput",onFocus:"onfocusin",onDoubleClick:"ondblclick"};function ja(e){let t="";for(let i in e){const s=e[i];s!=null&&(i.startsWith("--")||(i=i.replace(/[A-Z]/g,n=>`-${n.toLowerCase()}`)),t+=`${i}:${s};`)}return t}const Fu=new Set("viewBox,className,preserveAspectRatio,fillRule,clipPath,clipRule,strokeWidth,strokeLinecap,strokeLinejoin,strokeDasharray,strokeDashoffset,strokeMiterlimit".split(","));function zu(e){return e in go?go[e]:Fu.has(e)?e:e.toLowerCase()}function Hu(e,t){return e==="style"&&typeof t=="object"?ja(t):t}const Va=Nu(e=>{const t={};for(const i in e)t[zu(i)]=Hu(i,e[i]);return t}),qu=/((?:--)?(?:\w+-?)+)\s*:\s*([^;]*)/g,Wu=e=>{const t={};let i;for(;i=qu.exec(e);)t[i[1]]=i[2];return t};function Je(...e){const t=[];for(const s of e)s&&"class"in s&&s.class!=null&&t.push(s.class);const i=$a(...e);return t.length>0&&(i.class=t.length===1?t[0]:t),"style"in i&&(typeof i.style=="string"&&(i.style=Wu(i.style)),i.style=ja(i.style)),i}function sr(e){const t=e().defaultValue??e().value,i=e().isEqual??Object.is;let s=Fc(zc(t));const n=Z(()=>e().value!==void 0);let a={current:bt(()=>N(s))},c={current:void 0};Hc(()=>{const u=N(n)?e().value:N(s);a={current:u},c={current:u}});const r=u=>{const f=Oi(u)?u(a.current):u,l=c.current;e().debug&&console.log(`[bindable > ${e().debug}] setValue`,{next:f,prev:l}),N(n)||Gt(s,f,!0),i(f,l)||e().onChange?.(f,l)};function o(){return N(n)?e().value:N(s)}return{initial:t,ref:a,get:o,set(u){(e().sync?Da:ml)(()=>r(u))},invoke(u,f){e().onChange?.(u,f)},hash(u){return e().hash?.(u)??String(u)}}}sr.cleanup=e=>{Cn(()=>e())};sr.ref=e=>{let t=e;return{get:()=>t,set:i=>{t=i}}};function $u(e){const t={current:e};return{get(i){return t.current[i]},set(i,s){t.current[i]=s}}}const Mr=e=>typeof e=="function"?e():e,ju=(e,t)=>{let i=[],s=!0;wn(()=>{if(s){i=e.map(a=>Mr(a)),s=!1;return}let n=!1;for(let a=0;a<e.length;a++)if(!Ts(i[a],Mr(e[a]))){n=!0;break}n&&(i=e.map(a=>Mr(a)),t())})};function Br(e){return Oi(e)?e():e}function Ga(e,t){const i=Z(()=>{const{id:b,ids:k,getRootNode:R}=Br(t);return Uu({id:b,ids:k,getRootNode:R})}),s=(...b)=>{e.debug&&console.log(...b)},n=Z(()=>e.props?.({props:En(Br(t)),scope:N(i)})??Br(t)),a=Vu(()=>N(n)),c=e.context?.({prop:a,bindable:sr,get scope(){return N(i)},flush:vo,getContext(){return r},getComputed(){return y},getRefs(){return C},getEvent(){return m()}}),r={get(b){return c?.[b].get()},set(b,k){c?.[b].set(k)},initial(b){return c?.[b].initial},hash(b){const k=c?.[b].get();return c?.[b].hash(k)}};let o=new Map,u={current:null},f={current:null},l={current:{type:""}};const m=()=>({...l.current,current(){return l.current},previous(){return f.current}}),g=()=>({...S,hasTag(b){const k=S.get();return!!e.states[k]?.tags?.includes(b)},matches(...b){const k=S.get();return b.includes(k)}}),C=$u(e.refs?.({prop:a,context:r})??{}),v=()=>({state:g(),context:r,event:m(),prop:a,send:E,action:h,guard:p,track:ju,refs:C,computed:y,flush:vo,scope:N(i),choose:d}),h=b=>{const k=Oi(b)?b(v()):b;if(!k)return;const R=k.map(O=>{const P=e.implementations?.actions?.[O];return P||an(`[zag-js] No implementation found for action "${JSON.stringify(O)}"`),P});for(const O of R)O?.(v())},p=b=>Oi(b)?b(v()):e.implementations?.guards?.[b](v()),_=b=>{const k=Oi(b)?b(v()):b;if(!k)return;const R=k.map(P=>{const L=e.implementations?.effects?.[P];return L||an(`[zag-js] No implementation found for effect "${JSON.stringify(P)}"`),L}),O=[];for(const P of R){const L=P?.(v());L&&O.push(L)}return()=>O.forEach(P=>P?.())},d=b=>tl(b).find(k=>{let R=!k.guard;return Js(k.guard)?R=!!p(k.guard):Oi(k.guard)&&(R=k.guard(v())),R}),y=b=>{Sl(e.computed,()=>"[zag-js] No computed object found on machine");const k=e.computed[b];return k({context:r,event:m(),prop:a,refs:C,scope:N(i),computed:y})},S=sr(()=>({defaultValue:e.initialState({prop:a}),onChange(b,k){k&&(o.get(k)?.(),o.delete(k)),k&&h(e.states[k]?.exit),h(u.current?.actions);const R=_(e.states[b]?.effects);if(R&&o.set(b,R),k===Pr){h(e.entry);const O=_(e.effects);O&&o.set(Pr,O)}h(e.states[b]?.entry)}}));let w=ji.NotStarted;Oa(()=>{const b=w===ji.Started;w=ji.Started,s(b?"rehydrating...":"initializing..."),S.invoke(S.initial,Pr)}),Cn(()=>{s("unmounting..."),w=ji.Stopped,o.forEach(b=>b?.()),o=new Map,u.current=null,h(e.exit)});const E=b=>{if(w!==ji.Started)return;f.current=l.current,l.current=b;let k=S.get();const R=e.states[k].on?.[b.type]??e.on?.[b.type],O=d(R);if(!O)return;u.current=O;const P=O.target??k;s("transition",b.type,O.target||k,`(${O.actions})`);const L=P!==k;L?S.set(P):O.reenter&&!L?S.invoke(k,k):h(O.actions)};return e.watch?.(v()),{get state(){return g()},send:E,context:r,prop:a,get scope(){return N(i)},refs:C,computed:y,get event(){return m()},getStatus:()=>w}}function Vu(e){return function(i){return e()[i]}}function vo(e){Da(()=>{queueMicrotask(()=>e())})}var Gi=(e,t=[])=>({parts:(...i)=>{if(Gu(t))return Gi(e,i);throw new Error("createAnatomy().parts(...) should only be called once. Did you mean to use .extendWith(...) ?")},extendWith:(...i)=>Gi(e,[...t,...i]),omit:(...i)=>Gi(e,t.filter(s=>!i.includes(s))),rename:i=>Gi(i,t),keys:()=>t,build:()=>[...new Set(t)].reduce((i,s)=>Object.assign(i,{[s]:{selector:[`&[data-scope="${Hi(e)}"][data-part="${Hi(s)}"]`,`& [data-scope="${Hi(e)}"][data-part="${Hi(s)}"]`].join(", "),attrs:{"data-scope":Hi(e),"data-part":Hi(s)}}}),{})}),Hi=e=>e.replace(/([A-Z])([A-Z])/g,"$1-$2").replace(/([a-z])([A-Z])/g,"$1-$2").replace(/[\s_]+/g,"-").toLowerCase(),Gu=e=>e.length===0;const Ku=["top","right","bottom","left"],Ci=Math.min,Rt=Math.max,rr=Math.round,qs=Math.floor,Yt=e=>({x:e,y:e}),Xu={left:"right",right:"left",bottom:"top",top:"bottom"},Yu={start:"end",end:"start"};function ln(e,t,i){return Rt(e,Ci(t,i))}function ci(e,t){return typeof e=="function"?e(t):e}function li(e){return e.split("-")[0]}function ts(e){return e.split("-")[1]}function Dn(e){return e==="x"?"y":"x"}function On(e){return e==="y"?"height":"width"}const Ju=new Set(["top","bottom"]);function Xt(e){return Ju.has(li(e))?"y":"x"}function In(e){return Dn(Xt(e))}function Zu(e,t,i){i===void 0&&(i=!1);const s=ts(e),n=In(e),a=On(n);let c=n==="x"?s===(i?"end":"start")?"right":"left":s==="start"?"bottom":"top";return t.reference[a]>t.floating[a]&&(c=nr(c)),[c,nr(c)]}function Qu(e){const t=nr(e);return[un(e),t,un(t)]}function un(e){return e.replace(/start|end/g,t=>Yu[t])}const yo=["left","right"],bo=["right","left"],e_=["top","bottom"],t_=["bottom","top"];function i_(e,t,i){switch(e){case"top":case"bottom":return i?t?bo:yo:t?yo:bo;case"left":case"right":return t?e_:t_;default:return[]}}function s_(e,t,i,s){const n=ts(e);let a=i_(li(e),i==="start",s);return n&&(a=a.map(c=>c+"-"+n),t&&(a=a.concat(a.map(un)))),a}function nr(e){return e.replace(/left|right|bottom|top/g,t=>Xu[t])}function r_(e){return{top:0,right:0,bottom:0,left:0,...e}}function Ka(e){return typeof e!="number"?r_(e):{top:e,right:e,bottom:e,left:e}}function or(e){const{x:t,y:i,width:s,height:n}=e;return{width:s,height:n,top:i,left:t,right:t+s,bottom:i+n,x:t,y:i}}function wo(e,t,i){let{reference:s,floating:n}=e;const a=Xt(t),c=In(t),r=On(c),o=li(t),u=a==="y",f=s.x+s.width/2-n.width/2,l=s.y+s.height/2-n.height/2,m=s[r]/2-n[r]/2;let g;switch(o){case"top":g={x:f,y:s.y-n.height};break;case"bottom":g={x:f,y:s.y+s.height};break;case"right":g={x:s.x+s.width,y:l};break;case"left":g={x:s.x-n.width,y:l};break;default:g={x:s.x,y:s.y}}switch(ts(t)){case"start":g[c]-=m*(i&&u?-1:1);break;case"end":g[c]+=m*(i&&u?-1:1);break}return g}const n_=async(e,t,i)=>{const{placement:s="bottom",strategy:n="absolute",middleware:a=[],platform:c}=i,r=a.filter(Boolean),o=await(c.isRTL==null?void 0:c.isRTL(t));let u=await c.getElementRects({reference:e,floating:t,strategy:n}),{x:f,y:l}=wo(u,s,o),m=s,g={},C=0;for(let v=0;v<r.length;v++){const{name:h,fn:p}=r[v],{x:_,y:d,data:y,reset:S}=await p({x:f,y:l,initialPlacement:s,placement:m,strategy:n,middlewareData:g,rects:u,platform:c,elements:{reference:e,floating:t}});f=_??f,l=d??l,g={...g,[h]:{...g[h],...y}},S&&C<=50&&(C++,typeof S=="object"&&(S.placement&&(m=S.placement),S.rects&&(u=S.rects===!0?await c.getElementRects({reference:e,floating:t,strategy:n}):S.rects),{x:f,y:l}=wo(u,m,o)),v=-1)}return{x:f,y:l,placement:m,strategy:n,middlewareData:g}};async function Es(e,t){var i;t===void 0&&(t={});const{x:s,y:n,platform:a,rects:c,elements:r,strategy:o}=e,{boundary:u="clippingAncestors",rootBoundary:f="viewport",elementContext:l="floating",altBoundary:m=!1,padding:g=0}=ci(t,e),C=Ka(g),h=r[m?l==="floating"?"reference":"floating":l],p=or(await a.getClippingRect({element:(i=await(a.isElement==null?void 0:a.isElement(h)))==null||i?h:h.contextElement||await(a.getDocumentElement==null?void 0:a.getDocumentElement(r.floating)),boundary:u,rootBoundary:f,strategy:o})),_=l==="floating"?{x:s,y:n,width:c.floating.width,height:c.floating.height}:c.reference,d=await(a.getOffsetParent==null?void 0:a.getOffsetParent(r.floating)),y=await(a.isElement==null?void 0:a.isElement(d))?await(a.getScale==null?void 0:a.getScale(d))||{x:1,y:1}:{x:1,y:1},S=or(a.convertOffsetParentRelativeRectToViewportRelativeRect?await a.convertOffsetParentRelativeRectToViewportRelativeRect({elements:r,rect:_,offsetParent:d,strategy:o}):_);return{top:(p.top-S.top+C.top)/y.y,bottom:(S.bottom-p.bottom+C.bottom)/y.y,left:(p.left-S.left+C.left)/y.x,right:(S.right-p.right+C.right)/y.x}}const o_=e=>({name:"arrow",options:e,async fn(t){const{x:i,y:s,placement:n,rects:a,platform:c,elements:r,middlewareData:o}=t,{element:u,padding:f=0}=ci(e,t)||{};if(u==null)return{};const l=Ka(f),m={x:i,y:s},g=In(n),C=On(g),v=await c.getDimensions(u),h=g==="y",p=h?"top":"left",_=h?"bottom":"right",d=h?"clientHeight":"clientWidth",y=a.reference[C]+a.reference[g]-m[g]-a.floating[C],S=m[g]-a.reference[g],w=await(c.getOffsetParent==null?void 0:c.getOffsetParent(u));let E=w?w[d]:0;(!E||!await(c.isElement==null?void 0:c.isElement(w)))&&(E=r.floating[d]||a.floating[C]);const b=y/2-S/2,k=E/2-v[C]/2-1,R=Ci(l[p],k),O=Ci(l[_],k),P=R,L=E-v[C]-O,q=E/2-v[C]/2+b,J=ln(P,q,L),re=!o.arrow&&ts(n)!=null&&q!==J&&a.reference[C]/2-(q<P?R:O)-v[C]/2<0,ie=re?q<P?q-P:q-L:0;return{[g]:m[g]+ie,data:{[g]:J,centerOffset:q-J-ie,...re&&{alignmentOffset:ie}},reset:re}}}),a_=function(e){return e===void 0&&(e={}),{name:"flip",options:e,async fn(t){var i,s;const{placement:n,middlewareData:a,rects:c,initialPlacement:r,platform:o,elements:u}=t,{mainAxis:f=!0,crossAxis:l=!0,fallbackPlacements:m,fallbackStrategy:g="bestFit",fallbackAxisSideDirection:C="none",flipAlignment:v=!0,...h}=ci(e,t);if((i=a.arrow)!=null&&i.alignmentOffset)return{};const p=li(n),_=Xt(r),d=li(r)===r,y=await(o.isRTL==null?void 0:o.isRTL(u.floating)),S=m||(d||!v?[nr(r)]:Qu(r)),w=C!=="none";!m&&w&&S.push(...s_(r,v,C,y));const E=[r,...S],b=await Es(t,h),k=[];let R=((s=a.flip)==null?void 0:s.overflows)||[];if(f&&k.push(b[p]),l){const q=Zu(n,c,y);k.push(b[q[0]],b[q[1]])}if(R=[...R,{placement:n,overflows:k}],!k.every(q=>q<=0)){var O,P;const q=(((O=a.flip)==null?void 0:O.index)||0)+1,J=E[q];if(J&&(!(l==="alignment"?_!==Xt(J):!1)||R.every(ee=>Xt(ee.placement)===_?ee.overflows[0]>0:!0)))return{data:{index:q,overflows:R},reset:{placement:J}};let re=(P=R.filter(ie=>ie.overflows[0]<=0).sort((ie,ee)=>ie.overflows[1]-ee.overflows[1])[0])==null?void 0:P.placement;if(!re)switch(g){case"bestFit":{var L;const ie=(L=R.filter(ee=>{if(w){const x=Xt(ee.placement);return x===_||x==="y"}return!0}).map(ee=>[ee.placement,ee.overflows.filter(x=>x>0).reduce((x,B)=>x+B,0)]).sort((ee,x)=>ee[1]-x[1])[0])==null?void 0:L[0];ie&&(re=ie);break}case"initialPlacement":re=r;break}if(n!==re)return{reset:{placement:re}}}return{}}}};function So(e,t){return{top:e.top-t.height,right:e.right-t.width,bottom:e.bottom-t.height,left:e.left-t.width}}function Co(e){return Ku.some(t=>e[t]>=0)}const h_=function(e){return e===void 0&&(e={}),{name:"hide",options:e,async fn(t){const{rects:i}=t,{strategy:s="referenceHidden",...n}=ci(e,t);switch(s){case"referenceHidden":{const a=await Es(t,{...n,elementContext:"reference"}),c=So(a,i.reference);return{data:{referenceHiddenOffsets:c,referenceHidden:Co(c)}}}case"escaped":{const a=await Es(t,{...n,altBoundary:!0}),c=So(a,i.floating);return{data:{escapedOffsets:c,escaped:Co(c)}}}default:return{}}}}},Xa=new Set(["left","top"]);async function c_(e,t){const{placement:i,platform:s,elements:n}=e,a=await(s.isRTL==null?void 0:s.isRTL(n.floating)),c=li(i),r=ts(i),o=Xt(i)==="y",u=Xa.has(c)?-1:1,f=a&&o?-1:1,l=ci(t,e);let{mainAxis:m,crossAxis:g,alignmentAxis:C}=typeof l=="number"?{mainAxis:l,crossAxis:0,alignmentAxis:null}:{mainAxis:l.mainAxis||0,crossAxis:l.crossAxis||0,alignmentAxis:l.alignmentAxis};return r&&typeof C=="number"&&(g=r==="end"?C*-1:C),o?{x:g*f,y:m*u}:{x:m*u,y:g*f}}const l_=function(e){return e===void 0&&(e=0),{name:"offset",options:e,async fn(t){var i,s;const{x:n,y:a,placement:c,middlewareData:r}=t,o=await c_(t,e);return c===((i=r.offset)==null?void 0:i.placement)&&(s=r.arrow)!=null&&s.alignmentOffset?{}:{x:n+o.x,y:a+o.y,data:{...o,placement:c}}}}},u_=function(e){return e===void 0&&(e={}),{name:"shift",options:e,async fn(t){const{x:i,y:s,placement:n}=t,{mainAxis:a=!0,crossAxis:c=!1,limiter:r={fn:h=>{let{x:p,y:_}=h;return{x:p,y:_}}},...o}=ci(e,t),u={x:i,y:s},f=await Es(t,o),l=Xt(li(n)),m=Dn(l);let g=u[m],C=u[l];if(a){const h=m==="y"?"top":"left",p=m==="y"?"bottom":"right",_=g+f[h],d=g-f[p];g=ln(_,g,d)}if(c){const h=l==="y"?"top":"left",p=l==="y"?"bottom":"right",_=C+f[h],d=C-f[p];C=ln(_,C,d)}const v=r.fn({...t,[m]:g,[l]:C});return{...v,data:{x:v.x-i,y:v.y-s,enabled:{[m]:a,[l]:c}}}}}},__=function(e){return e===void 0&&(e={}),{options:e,fn(t){const{x:i,y:s,placement:n,rects:a,middlewareData:c}=t,{offset:r=0,mainAxis:o=!0,crossAxis:u=!0}=ci(e,t),f={x:i,y:s},l=Xt(n),m=Dn(l);let g=f[m],C=f[l];const v=ci(r,t),h=typeof v=="number"?{mainAxis:v,crossAxis:0}:{mainAxis:0,crossAxis:0,...v};if(o){const d=m==="y"?"height":"width",y=a.reference[m]-a.floating[d]+h.mainAxis,S=a.reference[m]+a.reference[d]-h.mainAxis;g<y?g=y:g>S&&(g=S)}if(u){var p,_;const d=m==="y"?"width":"height",y=Xa.has(li(n)),S=a.reference[l]-a.floating[d]+(y&&((p=c.offset)==null?void 0:p[l])||0)+(y?0:h.crossAxis),w=a.reference[l]+a.reference[d]+(y?0:((_=c.offset)==null?void 0:_[l])||0)-(y?h.crossAxis:0);C<S?C=S:C>w&&(C=w)}return{[m]:g,[l]:C}}}},d_=function(e){return e===void 0&&(e={}),{name:"size",options:e,async fn(t){var i,s;const{placement:n,rects:a,platform:c,elements:r}=t,{apply:o=()=>{},...u}=ci(e,t),f=await Es(t,u),l=li(n),m=ts(n),g=Xt(n)==="y",{width:C,height:v}=a.floating;let h,p;l==="top"||l==="bottom"?(h=l,p=m===(await(c.isRTL==null?void 0:c.isRTL(r.floating))?"start":"end")?"left":"right"):(p=l,h=m==="end"?"top":"bottom");const _=v-f.top-f.bottom,d=C-f.left-f.right,y=Ci(v-f[h],_),S=Ci(C-f[p],d),w=!t.middlewareData.shift;let E=y,b=S;if((i=t.middlewareData.shift)!=null&&i.enabled.x&&(b=d),(s=t.middlewareData.shift)!=null&&s.enabled.y&&(E=_),w&&!m){const R=Rt(f.left,0),O=Rt(f.right,0),P=Rt(f.top,0),L=Rt(f.bottom,0);g?b=C-2*(R!==0||O!==0?R+O:Rt(f.left,f.right)):E=v-2*(P!==0||L!==0?P+L:Rt(f.top,f.bottom))}await o({...t,availableWidth:b,availableHeight:E});const k=await c.getDimensions(r.floating);return C!==k.width||v!==k.height?{reset:{rects:!0}}:{}}}};function lr(){return typeof window<"u"}function is(e){return Ya(e)?(e.nodeName||"").toLowerCase():"#document"}function Tt(e){var t;return(e==null||(t=e.ownerDocument)==null?void 0:t.defaultView)||window}function ei(e){var t;return(t=(Ya(e)?e.ownerDocument:e.document)||window.document)==null?void 0:t.documentElement}function Ya(e){return lr()?e instanceof Node||e instanceof Tt(e).Node:!1}function zt(e){return lr()?e instanceof Element||e instanceof Tt(e).Element:!1}function Zt(e){return lr()?e instanceof HTMLElement||e instanceof Tt(e).HTMLElement:!1}function Eo(e){return!lr()||typeof ShadowRoot>"u"?!1:e instanceof ShadowRoot||e instanceof Tt(e).ShadowRoot}const f_=new Set(["inline","contents"]);function Ls(e){const{overflow:t,overflowX:i,overflowY:s,display:n}=Ht(e);return/auto|scroll|overlay|hidden|clip/.test(t+s+i)&&!f_.has(n)}const p_=new Set(["table","td","th"]);function m_(e){return p_.has(is(e))}const g_=[":popover-open",":modal"];function ur(e){return g_.some(t=>{try{return e.matches(t)}catch{return!1}})}const v_=["transform","translate","scale","rotate","perspective"],y_=["transform","translate","scale","rotate","perspective","filter"],b_=["paint","layout","strict","content"];function Pn(e){const t=Mn(),i=zt(e)?Ht(e):e;return v_.some(s=>i[s]?i[s]!=="none":!1)||(i.containerType?i.containerType!=="normal":!1)||!t&&(i.backdropFilter?i.backdropFilter!=="none":!1)||!t&&(i.filter?i.filter!=="none":!1)||y_.some(s=>(i.willChange||"").includes(s))||b_.some(s=>(i.contain||"").includes(s))}function w_(e){let t=Ei(e);for(;Zt(t)&&!Yi(t);){if(Pn(t))return t;if(ur(t))return null;t=Ei(t)}return null}function Mn(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}const S_=new Set(["html","body","#document"]);function Yi(e){return S_.has(is(e))}function Ht(e){return Tt(e).getComputedStyle(e)}function _r(e){return zt(e)?{scrollLeft:e.scrollLeft,scrollTop:e.scrollTop}:{scrollLeft:e.scrollX,scrollTop:e.scrollY}}function Ei(e){if(is(e)==="html")return e;const t=e.assignedSlot||e.parentNode||Eo(e)&&e.host||ei(e);return Eo(t)?t.host:t}function Ja(e){const t=Ei(e);return Yi(t)?e.ownerDocument?e.ownerDocument.body:e.body:Zt(t)&&Ls(t)?t:Ja(t)}function ks(e,t,i){var s;t===void 0&&(t=[]),i===void 0&&(i=!0);const n=Ja(e),a=n===((s=e.ownerDocument)==null?void 0:s.body),c=Tt(n);if(a){const r=_n(c);return t.concat(c,c.visualViewport||[],Ls(n)?n:[],r&&i?ks(r):[])}return t.concat(n,ks(n,[],i))}function _n(e){return e.parent&&Object.getPrototypeOf(e.parent)?e.frameElement:null}function Za(e){const t=Ht(e);let i=parseFloat(t.width)||0,s=parseFloat(t.height)||0;const n=Zt(e),a=n?e.offsetWidth:i,c=n?e.offsetHeight:s,r=rr(i)!==a||rr(s)!==c;return r&&(i=a,s=c),{width:i,height:s,$:r}}function Bn(e){return zt(e)?e:e.contextElement}function Ki(e){const t=Bn(e);if(!Zt(t))return Yt(1);const i=t.getBoundingClientRect(),{width:s,height:n,$:a}=Za(t);let c=(a?rr(i.width):i.width)/s,r=(a?rr(i.height):i.height)/n;return(!c||!Number.isFinite(c))&&(c=1),(!r||!Number.isFinite(r))&&(r=1),{x:c,y:r}}const C_=Yt(0);function Qa(e){const t=Tt(e);return!Mn()||!t.visualViewport?C_:{x:t.visualViewport.offsetLeft,y:t.visualViewport.offsetTop}}function E_(e,t,i){return t===void 0&&(t=!1),!i||t&&i!==Tt(e)?!1:t}function Ii(e,t,i,s){t===void 0&&(t=!1),i===void 0&&(i=!1);const n=e.getBoundingClientRect(),a=Bn(e);let c=Yt(1);t&&(s?zt(s)&&(c=Ki(s)):c=Ki(e));const r=E_(a,i,s)?Qa(a):Yt(0);let o=(n.left+r.x)/c.x,u=(n.top+r.y)/c.y,f=n.width/c.x,l=n.height/c.y;if(a){const m=Tt(a),g=s&&zt(s)?Tt(s):s;let C=m,v=_n(C);for(;v&&s&&g!==C;){const h=Ki(v),p=v.getBoundingClientRect(),_=Ht(v),d=p.left+(v.clientLeft+parseFloat(_.paddingLeft))*h.x,y=p.top+(v.clientTop+parseFloat(_.paddingTop))*h.y;o*=h.x,u*=h.y,f*=h.x,l*=h.y,o+=d,u+=y,C=Tt(v),v=_n(C)}}return or({width:f,height:l,x:o,y:u})}function dr(e,t){const i=_r(e).scrollLeft;return t?t.left+i:Ii(ei(e)).left+i}function eh(e,t){const i=e.getBoundingClientRect(),s=i.left+t.scrollLeft-dr(e,i),n=i.top+t.scrollTop;return{x:s,y:n}}function k_(e){let{elements:t,rect:i,offsetParent:s,strategy:n}=e;const a=n==="fixed",c=ei(s),r=t?ur(t.floating):!1;if(s===c||r&&a)return i;let o={scrollLeft:0,scrollTop:0},u=Yt(1);const f=Yt(0),l=Zt(s);if((l||!l&&!a)&&((is(s)!=="body"||Ls(c))&&(o=_r(s)),Zt(s))){const g=Ii(s);u=Ki(s),f.x=g.x+s.clientLeft,f.y=g.y+s.clientTop}const m=c&&!l&&!a?eh(c,o):Yt(0);return{width:i.width*u.x,height:i.height*u.y,x:i.x*u.x-o.scrollLeft*u.x+f.x+m.x,y:i.y*u.y-o.scrollTop*u.y+f.y+m.y}}function x_(e){return Array.from(e.getClientRects())}function A_(e){const t=ei(e),i=_r(e),s=e.ownerDocument.body,n=Rt(t.scrollWidth,t.clientWidth,s.scrollWidth,s.clientWidth),a=Rt(t.scrollHeight,t.clientHeight,s.scrollHeight,s.clientHeight);let c=-i.scrollLeft+dr(e);const r=-i.scrollTop;return Ht(s).direction==="rtl"&&(c+=Rt(t.clientWidth,s.clientWidth)-n),{width:n,height:a,x:c,y:r}}const ko=25;function R_(e,t){const i=Tt(e),s=ei(e),n=i.visualViewport;let a=s.clientWidth,c=s.clientHeight,r=0,o=0;if(n){a=n.width,c=n.height;const f=Mn();(!f||f&&t==="fixed")&&(r=n.offsetLeft,o=n.offsetTop)}const u=dr(s);if(u<=0){const f=s.ownerDocument,l=f.body,m=getComputedStyle(l),g=f.compatMode==="CSS1Compat"&&parseFloat(m.marginLeft)+parseFloat(m.marginRight)||0,C=Math.abs(s.clientWidth-l.clientWidth-g);C<=ko&&(a-=C)}else u<=ko&&(a+=u);return{width:a,height:c,x:r,y:o}}const T_=new Set(["absolute","fixed"]);function L_(e,t){const i=Ii(e,!0,t==="fixed"),s=i.top+e.clientTop,n=i.left+e.clientLeft,a=Zt(e)?Ki(e):Yt(1),c=e.clientWidth*a.x,r=e.clientHeight*a.y,o=n*a.x,u=s*a.y;return{width:c,height:r,x:o,y:u}}function xo(e,t,i){let s;if(t==="viewport")s=R_(e,i);else if(t==="document")s=A_(ei(e));else if(zt(t))s=L_(t,i);else{const n=Qa(e);s={x:t.x-n.x,y:t.y-n.y,width:t.width,height:t.height}}return or(s)}function th(e,t){const i=Ei(e);return i===t||!zt(i)||Yi(i)?!1:Ht(i).position==="fixed"||th(i,t)}function D_(e,t){const i=t.get(e);if(i)return i;let s=ks(e,[],!1).filter(r=>zt(r)&&is(r)!=="body"),n=null;const a=Ht(e).position==="fixed";let c=a?Ei(e):e;for(;zt(c)&&!Yi(c);){const r=Ht(c),o=Pn(c);!o&&r.position==="fixed"&&(n=null),(a?!o&&!n:!o&&r.position==="static"&&!!n&&T_.has(n.position)||Ls(c)&&!o&&th(e,c))?s=s.filter(f=>f!==c):n=r,c=Ei(c)}return t.set(e,s),s}function O_(e){let{element:t,boundary:i,rootBoundary:s,strategy:n}=e;const c=[...i==="clippingAncestors"?ur(t)?[]:D_(t,this._c):[].concat(i),s],r=c[0],o=c.reduce((u,f)=>{const l=xo(t,f,n);return u.top=Rt(l.top,u.top),u.right=Ci(l.right,u.right),u.bottom=Ci(l.bottom,u.bottom),u.left=Rt(l.left,u.left),u},xo(t,r,n));return{width:o.right-o.left,height:o.bottom-o.top,x:o.left,y:o.top}}function I_(e){const{width:t,height:i}=Za(e);return{width:t,height:i}}function P_(e,t,i){const s=Zt(t),n=ei(t),a=i==="fixed",c=Ii(e,!0,a,t);let r={scrollLeft:0,scrollTop:0};const o=Yt(0);function u(){o.x=dr(n)}if(s||!s&&!a)if((is(t)!=="body"||Ls(n))&&(r=_r(t)),s){const g=Ii(t,!0,a,t);o.x=g.x+t.clientLeft,o.y=g.y+t.clientTop}else n&&u();a&&!s&&n&&u();const f=n&&!s&&!a?eh(n,r):Yt(0),l=c.left+r.scrollLeft-o.x-f.x,m=c.top+r.scrollTop-o.y-f.y;return{x:l,y:m,width:c.width,height:c.height}}function Ur(e){return Ht(e).position==="static"}function Ao(e,t){if(!Zt(e)||Ht(e).position==="fixed")return null;if(t)return t(e);let i=e.offsetParent;return ei(e)===i&&(i=i.ownerDocument.body),i}function ih(e,t){const i=Tt(e);if(ur(e))return i;if(!Zt(e)){let n=Ei(e);for(;n&&!Yi(n);){if(zt(n)&&!Ur(n))return n;n=Ei(n)}return i}let s=Ao(e,t);for(;s&&m_(s)&&Ur(s);)s=Ao(s,t);return s&&Yi(s)&&Ur(s)&&!Pn(s)?i:s||w_(e)||i}const M_=async function(e){const t=this.getOffsetParent||ih,i=this.getDimensions,s=await i(e.floating);return{reference:P_(e.reference,await t(e.floating),e.strategy),floating:{x:0,y:0,width:s.width,height:s.height}}};function B_(e){return Ht(e).direction==="rtl"}const U_={convertOffsetParentRelativeRectToViewportRelativeRect:k_,getDocumentElement:ei,getClippingRect:O_,getOffsetParent:ih,getElementRects:M_,getClientRects:x_,getDimensions:I_,getScale:Ki,isElement:zt,isRTL:B_};function sh(e,t){return e.x===t.x&&e.y===t.y&&e.width===t.width&&e.height===t.height}function N_(e,t){let i=null,s;const n=ei(e);function a(){var r;clearTimeout(s),(r=i)==null||r.disconnect(),i=null}function c(r,o){r===void 0&&(r=!1),o===void 0&&(o=1),a();const u=e.getBoundingClientRect(),{left:f,top:l,width:m,height:g}=u;if(r||t(),!m||!g)return;const C=qs(l),v=qs(n.clientWidth-(f+m)),h=qs(n.clientHeight-(l+g)),p=qs(f),d={rootMargin:-C+"px "+-v+"px "+-h+"px "+-p+"px",threshold:Rt(0,Ci(1,o))||1};let y=!0;function S(w){const E=w[0].intersectionRatio;if(E!==o){if(!y)return c();E?c(!1,E):s=setTimeout(()=>{c(!1,1e-7)},1e3)}E===1&&!sh(u,e.getBoundingClientRect())&&c(),y=!1}try{i=new IntersectionObserver(S,{...d,root:n.ownerDocument})}catch{i=new IntersectionObserver(S,d)}i.observe(e)}return c(!0),a}function F_(e,t,i,s){s===void 0&&(s={});const{ancestorScroll:n=!0,ancestorResize:a=!0,elementResize:c=typeof ResizeObserver=="function",layoutShift:r=typeof IntersectionObserver=="function",animationFrame:o=!1}=s,u=Bn(e),f=n||a?[...u?ks(u):[],...ks(t)]:[];f.forEach(p=>{n&&p.addEventListener("scroll",i,{passive:!0}),a&&p.addEventListener("resize",i)});const l=u&&r?N_(u,i):null;let m=-1,g=null;c&&(g=new ResizeObserver(p=>{let[_]=p;_&&_.target===u&&g&&(g.unobserve(t),cancelAnimationFrame(m),m=requestAnimationFrame(()=>{var d;(d=g)==null||d.observe(t)})),i()}),u&&!o&&g.observe(u),g.observe(t));let C,v=o?Ii(e):null;o&&h();function h(){const p=Ii(e);v&&!sh(v,p)&&i(),v=p,C=requestAnimationFrame(h)}return i(),()=>{var p;f.forEach(_=>{n&&_.removeEventListener("scroll",i),a&&_.removeEventListener("resize",i)}),l?.(),(p=g)==null||p.disconnect(),g=null,o&&cancelAnimationFrame(C)}}const z_=l_,H_=u_,q_=a_,W_=d_,$_=h_,j_=o_,V_=__,G_=(e,t,i)=>{const s=new Map,n={platform:U_,...i},a={...n.platform,_c:s};return n_(e,t,{...n,platform:a})};function Ro(e=0,t=0,i=0,s=0){if(typeof DOMRect=="function")return new DOMRect(e,t,i,s);const n={x:e,y:t,width:i,height:s,top:t,right:e+i,bottom:t+s,left:e};return{...n,toJSON:()=>n}}function K_(e){if(!e)return Ro();const{x:t,y:i,width:s,height:n}=e;return Ro(t,i,s,n)}function X_(e,t){return{contextElement:ft(e)?e:void 0,getBoundingClientRect:()=>{const i=e,s=t?.(i);return s||!i?K_(s):i.getBoundingClientRect()}}}var _s=e=>({variable:e,reference:`var(${e})`}),hi={arrowSize:_s("--arrow-size"),arrowSizeHalf:_s("--arrow-size-half"),arrowBg:_s("--arrow-background"),transformOrigin:_s("--transform-origin"),arrowOffset:_s("--arrow-offset")},Y_=e=>e==="top"||e==="bottom"?"y":"x";function J_(e,t){return{name:"transformOrigin",fn(i){const{elements:s,middlewareData:n,placement:a,rects:c,y:r}=i,o=a.split("-")[0],u=Y_(o),f=n.arrow?.x||0,l=n.arrow?.y||0,m=t?.clientWidth||0,g=t?.clientHeight||0,C=f+m/2,v=l+g/2,h=Math.abs(n.shift?.y||0),p=c.reference.height/2,_=g/2,d=e.offset?.mainAxis??e.gutter,y=typeof d=="number"?d+_:d??_,S=h>y,w={top:`${C}px calc(100% + ${y}px)`,bottom:`${C}px ${-y}px`,left:`calc(100% + ${y}px) ${v}px`,right:`${-y}px ${v}px`}[o],E=`${C}px ${c.reference.y+p-r}px`,b=!!e.overlap&&u==="y"&&S;return s.floating.style.setProperty(hi.transformOrigin.variable,b?E:w),{data:{transformOrigin:b?E:w}}}}}var Z_={name:"rects",fn({rects:e}){return{data:e}}},Q_=e=>{if(e)return{name:"shiftArrow",fn({placement:t,middlewareData:i}){if(!i.arrow)return{};const{x:s,y:n}=i.arrow,a=t.split("-")[0];return Object.assign(e.style,{left:s!=null?`${s}px`:"",top:n!=null?`${n}px`:"",[a]:`calc(100% + ${hi.arrowOffset.reference})`}),{}}}};function ed(e){const[t,i]=e.split("-");return{side:t,align:i,hasAlign:i!=null}}function td(e){return e.split("-")[0]}var id={strategy:"absolute",placement:"bottom",listeners:!0,gutter:8,flip:!0,slide:!0,overlap:!1,sameWidth:!1,fitViewport:!1,overflowPadding:8,arrowPadding:4};function To(e,t){const i=e.devicePixelRatio||1;return Math.round(t*i)/i}function Un(e){return typeof e=="function"?e():e==="clipping-ancestors"?"clippingAncestors":e}function sd(e,t,i){const s=e||t.createElement("div");return j_({element:s,padding:i.arrowPadding})}function rd(e,t){if(!cl(t.offset??t.gutter))return z_(({placement:i})=>{const s=(e?.clientHeight||0)/2,n=t.offset?.mainAxis??t.gutter,a=typeof n=="number"?n+s:n??s,{hasAlign:c}=ed(i),r=c?void 0:t.shift,o=t.offset?.crossAxis??r;return En({crossAxis:o,mainAxis:a,alignmentAxis:t.shift})})}function nd(e){if(!e.flip)return;const t=Un(e.boundary);return q_({...t?{boundary:t}:void 0,padding:e.overflowPadding,fallbackPlacements:e.flip===!0?void 0:e.flip})}function od(e){if(!e.slide&&!e.overlap)return;const t=Un(e.boundary);return H_({...t?{boundary:t}:void 0,mainAxis:e.slide,crossAxis:e.overlap,padding:e.overflowPadding,limiter:V_()})}function ad(e){return W_({padding:e.overflowPadding,apply({elements:t,rects:i,availableHeight:s,availableWidth:n}){const a=t.floating,c=Math.round(i.reference.width),r=Math.round(i.reference.height);n=Math.floor(n),s=Math.floor(s),a.style.setProperty("--reference-width",`${c}px`),a.style.setProperty("--reference-height",`${r}px`),a.style.setProperty("--available-width",`${n}px`),a.style.setProperty("--available-height",`${s}px`)}})}function hd(e){if(e.hideWhenDetached)return $_({strategy:"referenceHidden",boundary:Un(e.boundary)??"clippingAncestors"})}function cd(e){return e?e===!0?{ancestorResize:!0,ancestorScroll:!0,elementResize:!0,layoutShift:!0}:e:{}}function ld(e,t,i={}){const s=X_(e,i.getAnchorRect);if(!t||!s)return;const n=Object.assign({},id,i),a=t.querySelector("[data-part=arrow]"),c=[rd(a,n),nd(n),od(n),sd(a,t.ownerDocument,n),Q_(a),J_({gutter:n.gutter,offset:n.offset,overlap:n.overlap},a),ad(n),hd(n),Z_],{placement:r,strategy:o,onComplete:u,onPositioned:f}=n,l=async()=>{if(!s||!t)return;const v=await G_(s,t,{placement:r,middleware:c,strategy:o});u?.(v),f?.({placed:!0});const h=ki(t),p=To(h,v.x),_=To(h,v.y);t.style.setProperty("--x",`${p}px`),t.style.setProperty("--y",`${_}px`),n.hideWhenDetached&&(v.middlewareData.hide?.referenceHidden?(t.style.setProperty("visibility","hidden"),t.style.setProperty("pointer-events","none")):(t.style.removeProperty("visibility"),t.style.removeProperty("pointer-events")));const d=t.firstElementChild;if(d){const y=Hl(d);t.style.setProperty("--z-index",y.zIndex)}},m=async()=>{i.updatePosition?(await i.updatePosition({updatePosition:l,floatingElement:t}),f?.({placed:!0})):await l()},g=cd(n.listeners),C=n.listeners?F_(s,t,m,g):gl;return m(),()=>{C?.(),f?.({placed:!1})}}function Lo(e,t,i={}){const{defer:s,...n}=i,a=s?Ft:r=>r(),c=[];return c.push(a(()=>{const r=typeof e=="function"?e():e,o=typeof t=="function"?t():t;c.push(ld(r,o,n))})),()=>{c.forEach(r=>r?.())}}var ud={bottom:"rotate(45deg)",left:"rotate(135deg)",top:"rotate(225deg)",right:"rotate(315deg)"};function _d(e={}){const{placement:t,sameWidth:i,fitViewport:s,strategy:n="absolute"}=e;return{arrow:{position:"absolute",width:hi.arrowSize.reference,height:hi.arrowSize.reference,[hi.arrowSizeHalf.variable]:`calc(${hi.arrowSize.reference} / 2)`,[hi.arrowOffset.variable]:`calc(${hi.arrowSizeHalf.reference} * -1)`},arrowTip:{transform:t?ud[t.split("-")[0]]:void 0,background:hi.arrowBg.reference,top:"0",left:"0",width:"100%",height:"100%",position:"absolute",zIndex:"inherit"},floating:{position:n,isolation:"isolate",minWidth:i?void 0:"max-content",width:i?"var(--reference-width)":void 0,maxWidth:s?"var(--available-width)":void 0,maxHeight:s?"var(--available-height)":void 0,pointerEvents:t?void 0:"none",top:"0px",left:"0px",transform:t?"translate3d(var(--x), var(--y), 0)":"translate3d(0, -100vh, 0)",zIndex:"var(--z-index)"}}}function dd(e){const t={each(i){for(let s=0;s<e.frames?.length;s+=1){const n=e.frames[s];n&&i(n)}},addEventListener(i,s,n){return t.each(a=>{try{a.document.addEventListener(i,s,n)}catch{}}),()=>{try{t.removeEventListener(i,s,n)}catch{}}},removeEventListener(i,s,n){t.each(a=>{try{a.document.removeEventListener(i,s,n)}catch{}})}};return t}function fd(e){const t=e.frameElement!=null?e.parent:null;return{addEventListener:(i,s,n)=>{try{t?.addEventListener(i,s,n)}catch{}return()=>{try{t?.removeEventListener(i,s,n)}catch{}}},removeEventListener:(i,s,n)=>{try{t?.removeEventListener(i,s,n)}catch{}}}}var Do="pointerdown.outside",Oo="focus.outside";function pd(e){for(const t of e)if(ft(t)&&Rn(t))return!0;return!1}var rh=e=>"clientY"in e;function md(e,t){if(!rh(t)||!e)return!1;const i=e.getBoundingClientRect();return i.width===0||i.height===0?!1:i.top<=t.clientY&&t.clientY<=i.top+i.height&&i.left<=t.clientX&&t.clientX<=i.left+i.width}function gd(e,t){return e.y<=t.y&&t.y<=e.y+e.height&&e.x<=t.x&&t.x<=e.x+e.width}function Io(e,t){if(!t||!rh(e))return!1;const i=t.scrollHeight>t.clientHeight,s=i&&e.clientX>t.offsetLeft+t.clientWidth,n=t.scrollWidth>t.clientWidth,a=n&&e.clientY>t.offsetTop+t.clientHeight,c={x:t.offsetLeft,y:t.offsetTop,width:t.clientWidth+(i?16:0),height:t.clientHeight+(n?16:0)},r={x:e.clientX,y:e.clientY};return gd(c,r)?s||a:!1}function vd(e,t){const{exclude:i,onFocusOutside:s,onPointerDownOutside:n,onInteractOutside:a,defer:c,followControlledElements:r=!0}=t;if(!e)return;const o=Bi(e),u=ki(e),f=dd(u),l=fd(u);function m(d,y){if(!ft(y)||!y.isConnected||bi(e,y)||md(e,d)||r&&jl(e,y))return!1;const S=o.querySelector(`[aria-controls="${e.id}"]`);if(S){const E=cn(S);if(Io(d,E))return!1}const w=cn(e);return Io(d,w)?!1:!i?.(y)}const g=new Set,C=Xi(e?.getRootNode());function v(d){function y(S){const w=c&&!lo()?Ft:k=>k(),E=S??d,b=E?.composedPath?.()??[E?.target];w(()=>{const k=C?b[0]:Si(d);if(!(!e||!m(d,k))){if(n||a){const R=on(n,a);e.addEventListener(Do,R,{once:!0})}Po(e,Do,{bubbles:!1,cancelable:!0,detail:{originalEvent:E,contextmenu:za(E),focusable:pd(b),target:k}})}})}d.pointerType==="touch"?(g.forEach(S=>S()),g.add(vs(o,"click",y,{once:!0})),g.add(l.addEventListener("click",y,{once:!0})),g.add(f.addEventListener("click",y,{once:!0}))):y()}const h=new Set,p=setTimeout(()=>{h.add(vs(o,"pointerdown",v,!0)),h.add(l.addEventListener("pointerdown",v,!0)),h.add(f.addEventListener("pointerdown",v,!0))},0);function _(d){(c?Ft:S=>S())(()=>{const S=d?.composedPath?.()??[d?.target],w=C?S[0]:Si(d);if(!(!e||!m(d,w))){if(s||a){const E=on(s,a);e.addEventListener(Oo,E,{once:!0})}Po(e,Oo,{bubbles:!1,cancelable:!0,detail:{originalEvent:d,contextmenu:!1,focusable:Rn(w),target:w}})}})}return lo()||(h.add(vs(o,"focusin",_,!0)),h.add(l.addEventListener("focusin",_,!0)),h.add(f.addEventListener("focusin",_,!0))),()=>{clearTimeout(p),g.forEach(d=>d()),h.forEach(d=>d())}}function yd(e,t){const{defer:i}=t,s=i?Ft:a=>a(),n=[];return n.push(s(()=>{const a=typeof e=="function"?e():e;n.push(vd(a,t))})),()=>{n.forEach(a=>a?.())}}function Po(e,t,i){const s=e.ownerDocument.defaultView||window,n=new s.CustomEvent(t,i);return e.dispatchEvent(n)}function bd(e,t){const i=s=>{s.key==="Escape"&&(s.isComposing||t?.(s))};return vs(Bi(e),"keydown",i,{capture:!0})}var Mo="layer:request-dismiss",It={layers:[],branches:[],count(){return this.layers.length},pointerBlockingLayers(){return this.layers.filter(e=>e.pointerBlocking)},topMostPointerBlockingLayer(){return[...this.pointerBlockingLayers()].slice(-1)[0]},hasPointerBlockingLayer(){return this.pointerBlockingLayers().length>0},isBelowPointerBlockingLayer(e){const t=this.indexOf(e),i=this.topMostPointerBlockingLayer()?this.indexOf(this.topMostPointerBlockingLayer()?.node):-1;return t<i},isTopMost(e){return this.layers[this.count()-1]?.node===e},getNestedLayers(e){return Array.from(this.layers).slice(this.indexOf(e)+1)},getLayersByType(e){return this.layers.filter(t=>t.type===e)},getNestedLayersByType(e,t){const i=this.indexOf(e);return i===-1?[]:this.layers.slice(i+1).filter(s=>s.type===t)},getParentLayerOfType(e,t){const i=this.indexOf(e);if(!(i<=0))return this.layers.slice(0,i).reverse().find(s=>s.type===t)},countNestedLayersOfType(e,t){return this.getNestedLayersByType(e,t).length},isInNestedLayer(e,t){return this.getNestedLayers(e).some(i=>bi(i.node,t))},isInBranch(e){return Array.from(this.branches).some(t=>bi(t,e))},add(e){this.layers.push(e),this.syncLayers()},addBranch(e){this.branches.push(e)},remove(e){const t=this.indexOf(e);t<0||(t<this.count()-1&&this.getNestedLayers(e).forEach(s=>It.dismiss(s.node,e)),this.layers.splice(t,1),this.syncLayers())},removeBranch(e){const t=this.branches.indexOf(e);t>=0&&this.branches.splice(t,1)},syncLayers(){this.layers.forEach((e,t)=>{e.node.style.setProperty("--layer-index",`${t}`),e.node.removeAttribute("data-nested"),e.node.removeAttribute("data-has-nested"),this.getParentLayerOfType(e.node,e.type)&&e.node.setAttribute("data-nested",e.type);const s=this.countNestedLayersOfType(e.node,e.type);s>0&&e.node.setAttribute("data-has-nested",e.type),e.node.style.setProperty("--nested-layer-count",`${s}`)})},indexOf(e){return this.layers.findIndex(t=>t.node===e)},dismiss(e,t){const i=this.indexOf(e);if(i===-1)return;const s=this.layers[i];Sd(e,Mo,n=>{s.requestDismiss?.(n),n.defaultPrevented||s?.dismiss()}),wd(e,Mo,{originalLayer:e,targetLayer:t,originalIndex:i,targetIndex:t?this.indexOf(t):-1}),this.syncLayers()},clear(){this.remove(this.layers[0].node)}};function wd(e,t,i){const s=e.ownerDocument.defaultView||window,n=new s.CustomEvent(t,{cancelable:!0,bubbles:!0,detail:i});return e.dispatchEvent(n)}function Sd(e,t,i){e.addEventListener(t,i,{once:!0})}var Bo;function Uo(){It.layers.forEach(({node:e})=>{e.style.pointerEvents=It.isBelowPointerBlockingLayer(e)?"none":"auto"})}function Cd(e){e.style.pointerEvents=""}function Ed(e,t){const i=Bi(e),s=[];return It.hasPointerBlockingLayer()&&!i.body.hasAttribute("data-inert")&&(Bo=document.body.style.pointerEvents,queueMicrotask(()=>{i.body.style.pointerEvents="none",i.body.setAttribute("data-inert","")})),t?.forEach(n=>{const[a,c]=Du(()=>{const r=n();return ft(r)?r:null},{timeout:1e3});a.then(r=>s.push(Au(r,{pointerEvents:"auto"}))),s.push(c)}),()=>{It.hasPointerBlockingLayer()||(queueMicrotask(()=>{i.body.style.pointerEvents=Bo,i.body.removeAttribute("data-inert"),i.body.style.length===0&&i.body.removeAttribute("style")}),s.forEach(n=>n()))}}function kd(e,t){const{warnOnMissingNode:i=!0}=t;if(i&&!e){an("[@zag-js/dismissable] node is `null` or `undefined`");return}if(!e)return;const{onDismiss:s,onRequestDismiss:n,pointerBlocking:a,exclude:c,debug:r,type:o="dialog"}=t,u={dismiss:s,node:e,type:o,pointerBlocking:a,requestDismiss:n};It.add(u),Uo();function f(v){const h=Si(v.detail.originalEvent);It.isBelowPointerBlockingLayer(e)||It.isInBranch(h)||(t.onPointerDownOutside?.(v),t.onInteractOutside?.(v),!v.defaultPrevented&&(r&&console.log("onPointerDownOutside:",v.detail.originalEvent),s?.()))}function l(v){const h=Si(v.detail.originalEvent);It.isInBranch(h)||(t.onFocusOutside?.(v),t.onInteractOutside?.(v),!v.defaultPrevented&&(r&&console.log("onFocusOutside:",v.detail.originalEvent),s?.()))}function m(v){It.isTopMost(e)&&(t.onEscapeKeyDown?.(v),!v.defaultPrevented&&s&&(v.preventDefault(),s()))}function g(v){if(!e)return!1;const h=typeof c=="function"?c():c,p=Array.isArray(h)?h:[h],_=t.persistentElements?.map(d=>d()).filter(ft);return _&&p.push(..._),p.some(d=>bi(d,v))||It.isInNestedLayer(e,v)}const C=[a?Ed(e,t.persistentElements):void 0,bd(e,m),yd(e,{exclude:g,onFocusOutside:l,onPointerDownOutside:f,defer:t.defer})];return()=>{It.remove(e),Uo(),Cd(e),C.forEach(v=>v?.())}}function xd(e,t){const{defer:i}=t,s=i?Ft:a=>a(),n=[];return n.push(s(()=>{const a=Oi(e)?e():e;n.push(kd(a,t))})),()=>{n.forEach(a=>a?.())}}const ct=Rs();var Ad=ze("<div><!></div>");function Rd(e,t){Ue(t,!0);const i=Ve(t,["$$slots","$$events","$$legacy"]),s=ct.consume(),n=Z(()=>t.element),a=Z(()=>t.children),c=Z(()=>Xe(i,["element","children"])),r=Z(()=>Je(s().getArrowTipProps(),{class:St.arrowTip},N(c)));var o=Se(),u=ye(o);{var f=m=>{var g=Se(),C=ye(g);ke(C,()=>N(n),()=>N(r)),ae(m,g)},l=m=>{var g=Ad();Ye(g,()=>({...N(r)}));var C=Pe(g);ke(C,()=>N(a)??st),Me(g),ae(m,g)};We(u,m=>{N(n)?m(f):m(l,!1)})}ae(e,o),Ne()}var Td=ze("<div><!></div>");function Ld(e,t){Ue(t,!0);const i=Ve(t,["$$slots","$$events","$$legacy"]),s=ct.consume(),n=Z(()=>t.element),a=Z(()=>t.children),c=Z(()=>Xe(i,["element","children"])),r=Z(()=>Je(s().getArrowProps(),{class:St.arrow},N(c)));var o=Se(),u=ye(o);{var f=m=>{var g=Se(),C=ye(g);ke(C,()=>N(n),()=>N(r)),ae(m,g)},l=m=>{var g=Td();Ye(g,()=>({...N(r)}));var C=Pe(g);ke(C,()=>N(a)??st),Me(g),ae(m,g)};We(u,m=>{N(n)?m(f):m(l,!1)})}ae(e,o),Ne()}var Dd=ze("<div><!></div>");function Od(e,t){Ue(t,!0);const i=Ve(t,["$$slots","$$events","$$legacy"]),s=ct.consume(),n=Z(()=>t.element),a=Z(()=>t.children),c=Z(()=>Xe(i,["element","children"])),r=Z(()=>Je(s().getContentProps(),{class:St.content},N(c)));var o=Se(),u=ye(o);{var f=m=>{var g=Se(),C=ye(g);ke(C,()=>N(n),()=>N(r)),ae(m,g)},l=m=>{var g=Dd();Ye(g,()=>({...N(r)}));var C=Pe(g);ke(C,()=>N(a)??st),Me(g),ae(m,g)};We(u,m=>{N(n)?m(f):m(l,!1)})}ae(e,o),Ne()}var Id=ze("<button><!></button>");function Pd(e,t){Ue(t,!0);const i=Ve(t,["$$slots","$$events","$$legacy"]),s=ct.consume(),n=Z(()=>t.element),a=Z(()=>t.children),c=Z(()=>Xe(i,["element","children"])),r=Z(()=>Je(s().getContextTriggerProps(),{class:St.contextTrigger},N(c)));var o=Se(),u=ye(o);{var f=m=>{var g=Se(),C=ye(g);ke(C,()=>N(n),()=>N(r)),ae(m,g)},l=m=>{var g=Id();Ye(g,()=>({...N(r)}));var C=Pe(g);ke(C,()=>N(a)??st),Me(g),ae(m,g)};We(u,m=>{N(n)?m(f):m(l,!1)})}ae(e,o),Ne()}var Md=ze("<div><!></div>");function Bd(e,t){Ue(t,!0);const i=Ve(t,["$$slots","$$events","$$legacy"]),s=ct.consume(),n=Z(()=>t.element),a=Z(()=>t.children),c=Z(()=>Xe(i,["element","children"])),r=Z(()=>Je(s().getIndicatorProps(),{class:St.indicator},N(c)));var o=Se(),u=ye(o);{var f=m=>{var g=Se(),C=ye(g);ke(C,()=>N(n),()=>N(r)),ae(m,g)},l=m=>{var g=Md();Ye(g,()=>({...N(r)}));var C=Pe(g);ke(C,()=>N(a)??st),Me(g),ae(m,g)};We(u,m=>{N(n)?m(f):m(l,!1)})}ae(e,o),Ne()}const nh=Rs();var gs=(e,t)=>({x:e,y:t});function Ud(e){const{x:t,y:i,width:s,height:n}=e,a=t+s/2,c=i+n/2;return{x:t,y:i,width:s,height:n,minX:t,minY:i,maxX:t+s,maxY:i+n,midX:a,midY:c,center:gs(a,c)}}function Nd(e){const t=gs(e.minX,e.minY),i=gs(e.maxX,e.minY),s=gs(e.maxX,e.maxY),n=gs(e.minX,e.maxY);return{top:t,right:i,bottom:s,left:n}}function Fd(e,t){const i=Ud(e),{top:s,right:n,left:a,bottom:c}=Nd(i),[r]=t.split("-");return{top:[a,s,n,c],right:[s,n,c,a],bottom:[s,a,c,n],left:[n,s,a,c]}[r]}function zd(e,t){const{x:i,y:s}=t;let n=!1;for(let a=0,c=e.length-1;a<e.length;c=a++){const r=e[a].x,o=e[a].y,u=e[c].x,f=e[c].y;o>s!=f>s&&i<(u-r)*(s-o)/(f-o)+r&&(n=!n)}return n}var Hd=Gi("menu").parts("arrow","arrowTip","content","contextTrigger","indicator","item","itemGroup","itemGroupLabel","itemIndicator","itemText","positioner","separator","trigger","triggerItem"),yt=Hd.build(),ar=e=>e.ids?.trigger??`menu:${e.id}:trigger`,oh=e=>e.ids?.contextTrigger??`menu:${e.id}:ctx-trigger`,ys=e=>e.ids?.content??`menu:${e.id}:content`,qd=e=>e.ids?.arrow??`menu:${e.id}:arrow`,ah=e=>e.ids?.positioner??`menu:${e.id}:popper`,Wd=(e,t)=>e.ids?.group?.(t)??`menu:${e.id}:group:${t}`,xs=(e,t)=>`${e.id}/${t}`,Li=e=>e?.dataset.value??null,No=(e,t)=>e.ids?.groupLabel?.(t)??`menu:${e.id}:group-label:${t}`,yi=e=>e.getById(ys(e)),Fo=e=>e.getById(ah(e)),Ws=e=>e.getById(ar(e)),$d=(e,t)=>t?e.getById(xs(e,t)):null,Nr=e=>e.getById(oh(e)),Ds=e=>{const i=`[role^="menuitem"][data-ownedby=${CSS.escape(ys(e))}]:not([data-disabled])`;return bu(yi(e),i)},jd=e=>il(Ds(e)),Vd=e=>sl(Ds(e)),Nn=(e,t)=>t?e.id===t||e.dataset.value===t:!1,Gd=(e,t)=>{const i=Ds(e),s=i.findIndex(n=>Nn(n,t.value));return rl(i,s,{loop:t.loop??t.loopFocus})},Kd=(e,t)=>{const i=Ds(e),s=i.findIndex(n=>Nn(n,t.value));return ol(i,s,{loop:t.loop??t.loopFocus})},Xd=(e,t)=>{const i=Ds(e),s=i.find(n=>Nn(n,t.value));return Wa(i,{state:t.typeaheadState,key:t.key,activeId:s?.id??null})},$s=e=>ft(e)&&(e.dataset.disabled===""||e.hasAttribute("disabled")),Yd=e=>!!e?.getAttribute("role")?.startsWith("menuitem")&&!!e?.hasAttribute("aria-controls"),dn="menu:select";function Jd(e,t){if(!e)return;const i=ki(e),s=new i.CustomEvent(dn,{detail:{value:t}});e.dispatchEvent(s)}function Zd(e,t){const{context:i,send:s,state:n,computed:a,prop:c,scope:r}=e,o=n.hasTag("open"),u=i.get("isSubmenu"),f=a("isTypingAhead"),l=c("composite"),m=i.get("currentPlacement"),g=i.get("anchorPoint"),C=i.get("highlightedValue"),v=_d({...c("positioning"),placement:g?"bottom":m});function h(y){return{id:xs(r,y.value),disabled:!!y.disabled,highlighted:C===y.value}}function p(y){const S=y.valueText??y.value;return{...y,id:y.value,valueText:S}}function _(y){return{...h(p(y)),checked:!!y.checked}}function d(y){const{closeOnSelect:S,valueText:w,value:E}=y,b=h(y),k=xs(r,E);return t.element({...yt.item.attrs,id:k,role:"menuitem","aria-disabled":Al(b.disabled),"data-disabled":zi(b.disabled),"data-ownedby":ys(r),"data-highlighted":zi(b.highlighted),"data-value":E,"data-valuetext":w,onDragStart(R){R.currentTarget.matches("a[href]")&&R.preventDefault()},onPointerMove(R){if(b.disabled||R.pointerType!=="mouse")return;const O=R.currentTarget;b.highlighted||s({type:"ITEM_POINTERMOVE",id:k,target:O,closeOnSelect:S})},onPointerLeave(R){if(b.disabled||R.pointerType!=="mouse"||!e.event.previous()?.type.includes("POINTER"))return;const P=R.currentTarget;s({type:"ITEM_POINTERLEAVE",id:k,target:P,closeOnSelect:S})},onPointerDown(R){if(b.disabled)return;const O=R.currentTarget;s({type:"ITEM_POINTERDOWN",target:O,id:k,closeOnSelect:S})},onClick(R){if(_o(R)||uo(R)||b.disabled)return;const O=R.currentTarget;s({type:"ITEM_CLICK",target:O,id:k,closeOnSelect:S})}})}return{highlightedValue:C,open:o,setOpen(y){n.hasTag("open")!==y&&s({type:y?"OPEN":"CLOSE"})},setHighlightedValue(y){s({type:"HIGHLIGHTED.SET",value:y})},setParent(y){s({type:"PARENT.SET",value:y,id:y.prop("id")})},setChild(y){s({type:"CHILD.SET",value:y,id:y.prop("id")})},reposition(y={}){s({type:"POSITIONING.SET",options:y})},addItemListener(y){const S=r.getById(y.id);if(!S)return;const w=()=>y.onSelect?.();return S.addEventListener(dn,w),()=>S.removeEventListener(dn,w)},getContextTriggerProps(){return t.element({...yt.contextTrigger.attrs,dir:c("dir"),id:oh(r),"data-state":o?"open":"closed",onPointerDown(y){if(y.pointerType==="mouse")return;const S=Hs(y);s({type:"CONTEXT_MENU_START",point:S})},onPointerCancel(y){y.pointerType!=="mouse"&&s({type:"CONTEXT_MENU_CANCEL"})},onPointerMove(y){y.pointerType!=="mouse"&&s({type:"CONTEXT_MENU_CANCEL"})},onPointerUp(y){y.pointerType!=="mouse"&&s({type:"CONTEXT_MENU_CANCEL"})},onContextMenu(y){const S=Hs(y);s({type:"CONTEXT_MENU",point:S}),y.preventDefault()},style:{WebkitTouchCallout:"none",WebkitUserSelect:"none",userSelect:"none"}})},getTriggerItemProps(y){const S=y.getTriggerProps();return $a(d({value:S.id}),S)},getTriggerProps(){return t.button({...u?yt.triggerItem.attrs:yt.trigger.attrs,"data-placement":i.get("currentPlacement"),type:"button",dir:c("dir"),id:ar(r),"data-uid":c("id"),"aria-haspopup":l?"menu":"dialog","aria-controls":ys(r),"aria-expanded":o||void 0,"data-state":o?"open":"closed",onPointerMove(y){if(y.pointerType!=="mouse"||$s(y.currentTarget)||!u)return;const w=Hs(y);s({type:"TRIGGER_POINTERMOVE",target:y.currentTarget,point:w})},onPointerLeave(y){if($s(y.currentTarget)||y.pointerType!=="mouse"||!u)return;const S=Hs(y);s({type:"TRIGGER_POINTERLEAVE",target:y.currentTarget,point:S})},onPointerDown(y){$s(y.currentTarget)||za(y)||y.preventDefault()},onClick(y){y.defaultPrevented||$s(y.currentTarget)||s({type:"TRIGGER_CLICK",target:y.currentTarget})},onBlur(){s({type:"TRIGGER_BLUR"})},onFocus(){s({type:"TRIGGER_FOCUS"})},onKeyDown(y){if(y.defaultPrevented)return;const S={ArrowDown(){s({type:"ARROW_DOWN"})},ArrowUp(){s({type:"ARROW_UP"})},Enter(){s({type:"ARROW_DOWN",src:"enter"})},Space(){s({type:"ARROW_DOWN",src:"space"})}},w=po(y,{orientation:"vertical",dir:c("dir")}),E=S[w];E&&(y.preventDefault(),E(y))}})},getIndicatorProps(){return t.element({...yt.indicator.attrs,dir:c("dir"),"data-state":o?"open":"closed"})},getPositionerProps(){return t.element({...yt.positioner.attrs,dir:c("dir"),id:ah(r),style:v.floating})},getArrowProps(){return t.element({id:qd(r),...yt.arrow.attrs,dir:c("dir"),style:v.arrow})},getArrowTipProps(){return t.element({...yt.arrowTip.attrs,dir:c("dir"),style:v.arrowTip})},getContentProps(){return t.element({...yt.content.attrs,id:ys(r),"aria-label":c("aria-label"),hidden:!o,"data-state":o?"open":"closed",role:l?"menu":"dialog",tabIndex:0,dir:c("dir"),"aria-activedescendant":a("highlightedId")||void 0,"aria-labelledby":ar(r),"data-placement":m,onPointerEnter(y){y.pointerType==="mouse"&&s({type:"MENU_POINTERENTER"})},onKeyDown(y){if(y.defaultPrevented||!bi(y.currentTarget,Si(y)))return;const S=Si(y);if(!(S?.closest("[role=menu]")===y.currentTarget||S===y.currentTarget))return;if(y.key==="Tab"&&!lu(y)){y.preventDefault();return}const E={ArrowDown(){s({type:"ARROW_DOWN"})},ArrowUp(){s({type:"ARROW_UP"})},ArrowLeft(){s({type:"ARROW_LEFT"})},ArrowRight(){s({type:"ARROW_RIGHT"})},Enter(){s({type:"ENTER"})},Space(R){f?s({type:"TYPEAHEAD",key:R.key}):E.Enter?.(R)},Home(){s({type:"HOME"})},End(){s({type:"END"})}},b=po(y,{dir:c("dir")}),k=E[b];if(k){k(y),y.stopPropagation(),y.preventDefault();return}c("typeahead")&&Ql(y)&&(eu(y)||Ua(S)||(s({type:"TYPEAHEAD",key:y.key}),y.preventDefault()))}})},getSeparatorProps(){return t.element({...yt.separator.attrs,role:"separator",dir:c("dir"),"aria-orientation":"horizontal"})},getItemState:h,getItemProps:d,getOptionItemState:_,getOptionItemProps(y){const{type:S,disabled:w,closeOnSelect:E}=y,b=p(y),k=_(y);return{...d(b),...t.element({"data-type":S,...yt.item.attrs,dir:c("dir"),"data-value":b.value,role:`menuitem${S}`,"aria-checked":!!k.checked,"data-state":k.checked?"checked":"unchecked",onClick(R){if(w||_o(R)||uo(R))return;const O=R.currentTarget;s({type:"ITEM_CLICK",target:O,option:b,closeOnSelect:E})}})}},getItemIndicatorProps(y){const S=_(co(y)),w=S.checked?"checked":"unchecked";return t.element({...yt.itemIndicator.attrs,dir:c("dir"),"data-disabled":zi(S.disabled),"data-highlighted":zi(S.highlighted),"data-state":Zs(y,"checked")?w:void 0,hidden:Zs(y,"checked")?!S.checked:void 0})},getItemTextProps(y){const S=_(co(y)),w=S.checked?"checked":"unchecked";return t.element({...yt.itemText.attrs,dir:c("dir"),"data-disabled":zi(S.disabled),"data-highlighted":zi(S.highlighted),"data-state":Zs(y,"checked")?w:void 0})},getItemGroupLabelProps(y){return t.element({...yt.itemGroupLabel.attrs,id:No(r,y.htmlFor),dir:c("dir")})},getItemGroupProps(y){return t.element({id:Wd(r,y.id),...yt.itemGroup.attrs,dir:c("dir"),"aria-labelledby":No(r,y.id),role:"group"})}}}var{not:Dt,and:qi,or:Qd}=Bu(),ef={props({props:e}){return{closeOnSelect:!0,typeahead:!0,composite:!0,loopFocus:!1,navigate(t){pu(t.node)},...e,positioning:{placement:"bottom-start",gutter:8,...e.positioning}}},initialState({prop:e}){return e("open")||e("defaultOpen")?"open":"idle"},context({bindable:e,prop:t}){return{suspendPointer:e(()=>({defaultValue:!1})),highlightedValue:e(()=>({defaultValue:t("defaultHighlightedValue")||null,value:t("highlightedValue"),onChange(i){t("onHighlightChange")?.({highlightedValue:i})}})),lastHighlightedValue:e(()=>({defaultValue:null})),currentPlacement:e(()=>({defaultValue:void 0})),intentPolygon:e(()=>({defaultValue:null})),anchorPoint:e(()=>({defaultValue:null,hash(i){return`x: ${i?.x}, y: ${i?.y}`}})),isSubmenu:e(()=>({defaultValue:!1}))}},refs(){return{parent:null,children:{},typeaheadState:{...Wa.defaultOptions},positioningOverride:{}}},computed:{isRtl:({prop:e})=>e("dir")==="rtl",isTypingAhead:({refs:e})=>e.get("typeaheadState").keysSoFar!=="",highlightedId:({context:e,scope:t,refs:i})=>sf(i.get("children"),e.get("highlightedValue"),t)},watch({track:e,action:t,context:i,prop:s}){e([()=>i.get("isSubmenu")],()=>{t(["setSubmenuPlacement"])}),e([()=>i.hash("anchorPoint")],()=>{i.get("anchorPoint")&&t(["reposition"])}),e([()=>s("open")],()=>{t(["toggleVisibility"])})},on:{"PARENT.SET":{actions:["setParentMenu"]},"CHILD.SET":{actions:["setChildMenu"]},OPEN:[{guard:"isOpenControlled",actions:["invokeOnOpen"]},{target:"open",actions:["invokeOnOpen"]}],OPEN_AUTOFOCUS:[{guard:"isOpenControlled",actions:["invokeOnOpen"]},{target:"open",actions:["highlightFirstItem","invokeOnOpen"]}],CLOSE:[{guard:"isOpenControlled",actions:["invokeOnClose"]},{target:"closed",actions:["invokeOnClose"]}],"HIGHLIGHTED.RESTORE":{actions:["restoreHighlightedItem"]},"HIGHLIGHTED.SET":{actions:["setHighlightedItem"]}},states:{idle:{tags:["closed"],on:{"CONTROLLED.OPEN":{target:"open"},"CONTROLLED.CLOSE":{target:"closed"},CONTEXT_MENU_START:{target:"opening:contextmenu",actions:["setAnchorPoint"]},CONTEXT_MENU:[{guard:"isOpenControlled",actions:["setAnchorPoint","invokeOnOpen"]},{target:"open",actions:["setAnchorPoint","invokeOnOpen"]}],TRIGGER_CLICK:[{guard:"isOpenControlled",actions:["invokeOnOpen"]},{target:"open",actions:["invokeOnOpen"]}],TRIGGER_FOCUS:{guard:Dt("isSubmenu"),target:"closed"},TRIGGER_POINTERMOVE:{guard:"isSubmenu",target:"opening"}}},"opening:contextmenu":{tags:["closed"],effects:["waitForLongPress"],on:{"CONTROLLED.OPEN":{target:"open"},"CONTROLLED.CLOSE":{target:"closed"},CONTEXT_MENU_CANCEL:[{guard:"isOpenControlled",actions:["invokeOnClose"]},{target:"closed",actions:["invokeOnClose"]}],"LONG_PRESS.OPEN":[{guard:"isOpenControlled",actions:["invokeOnOpen"]},{target:"open",actions:["invokeOnOpen"]}]}},opening:{tags:["closed"],effects:["waitForOpenDelay"],on:{"CONTROLLED.OPEN":{target:"open"},"CONTROLLED.CLOSE":{target:"closed"},BLUR:[{guard:"isOpenControlled",actions:["invokeOnClose"]},{target:"closed",actions:["invokeOnClose"]}],TRIGGER_POINTERLEAVE:[{guard:"isOpenControlled",actions:["invokeOnClose"]},{target:"closed",actions:["invokeOnClose"]}],"DELAY.OPEN":[{guard:"isOpenControlled",actions:["invokeOnOpen"]},{target:"open",actions:["invokeOnOpen"]}]}},closing:{tags:["open"],effects:["trackPointerMove","trackInteractOutside","waitForCloseDelay"],on:{"CONTROLLED.OPEN":{target:"open"},"CONTROLLED.CLOSE":{target:"closed",actions:["focusParentMenu","restoreParentHighlightedItem"]},MENU_POINTERENTER:{target:"open",actions:["clearIntentPolygon"]},POINTER_MOVED_AWAY_FROM_SUBMENU:[{guard:"isOpenControlled",actions:["invokeOnClose"]},{target:"closed",actions:["focusParentMenu","restoreParentHighlightedItem"]}],"DELAY.CLOSE":[{guard:"isOpenControlled",actions:["invokeOnClose"]},{target:"closed",actions:["focusParentMenu","restoreParentHighlightedItem","invokeOnClose"]}]}},closed:{tags:["closed"],entry:["clearHighlightedItem","focusTrigger","resumePointer","clearAnchorPoint"],on:{"CONTROLLED.OPEN":[{guard:Qd("isOpenAutoFocusEvent","isArrowDownEvent"),target:"open",actions:["highlightFirstItem"]},{guard:"isArrowUpEvent",target:"open",actions:["highlightLastItem"]},{target:"open"}],CONTEXT_MENU_START:{target:"opening:contextmenu",actions:["setAnchorPoint"]},CONTEXT_MENU:[{guard:"isOpenControlled",actions:["setAnchorPoint","invokeOnOpen"]},{target:"open",actions:["setAnchorPoint","invokeOnOpen"]}],TRIGGER_CLICK:[{guard:"isOpenControlled",actions:["invokeOnOpen"]},{target:"open",actions:["invokeOnOpen"]}],TRIGGER_POINTERMOVE:{guard:"isTriggerItem",target:"opening"},TRIGGER_BLUR:{target:"idle"},ARROW_DOWN:[{guard:"isOpenControlled",actions:["invokeOnOpen"]},{target:"open",actions:["highlightFirstItem","invokeOnOpen"]}],ARROW_UP:[{guard:"isOpenControlled",actions:["invokeOnOpen"]},{target:"open",actions:["highlightLastItem","invokeOnOpen"]}]}},open:{tags:["open"],effects:["trackInteractOutside","trackPositioning","scrollToHighlightedItem"],entry:["focusMenu","resumePointer"],on:{"CONTROLLED.CLOSE":[{target:"closed",guard:"isArrowLeftEvent",actions:["focusParentMenu"]},{target:"closed"}],TRIGGER_CLICK:[{guard:qi(Dt("isTriggerItem"),"isOpenControlled"),actions:["invokeOnClose"]},{guard:Dt("isTriggerItem"),target:"closed",actions:["invokeOnClose"]}],CONTEXT_MENU:{actions:["setAnchorPoint","focusMenu"]},ARROW_UP:{actions:["highlightPrevItem","focusMenu"]},ARROW_DOWN:{actions:["highlightNextItem","focusMenu"]},ARROW_LEFT:[{guard:qi("isSubmenu","isOpenControlled"),actions:["invokeOnClose"]},{guard:"isSubmenu",target:"closed",actions:["focusParentMenu","invokeOnClose"]}],HOME:{actions:["highlightFirstItem","focusMenu"]},END:{actions:["highlightLastItem","focusMenu"]},ARROW_RIGHT:{guard:"isTriggerItemHighlighted",actions:["openSubmenu"]},ENTER:[{guard:"isTriggerItemHighlighted",actions:["openSubmenu"]},{actions:["clickHighlightedItem"]}],ITEM_POINTERMOVE:[{guard:Dt("isPointerSuspended"),actions:["setHighlightedItem","focusMenu"]},{actions:["setLastHighlightedItem"]}],ITEM_POINTERLEAVE:{guard:qi(Dt("isPointerSuspended"),Dt("isTriggerItem")),actions:["clearHighlightedItem"]},ITEM_CLICK:[{guard:qi(Dt("isTriggerItemHighlighted"),Dt("isHighlightedItemEditable"),"closeOnSelect","isOpenControlled"),actions:["invokeOnSelect","setOptionState","closeRootMenu","invokeOnClose"]},{guard:qi(Dt("isTriggerItemHighlighted"),Dt("isHighlightedItemEditable"),"closeOnSelect"),target:"closed",actions:["invokeOnSelect","setOptionState","closeRootMenu","invokeOnClose"]},{guard:qi(Dt("isTriggerItemHighlighted"),Dt("isHighlightedItemEditable")),actions:["invokeOnSelect","setOptionState"]},{actions:["setHighlightedItem"]}],TRIGGER_POINTERMOVE:{guard:"isTriggerItem",actions:["setIntentPolygon"]},TRIGGER_POINTERLEAVE:{target:"closing"},ITEM_POINTERDOWN:{actions:["setHighlightedItem"]},TYPEAHEAD:{actions:["highlightMatchedItem"]},FOCUS_MENU:{actions:["focusMenu"]},"POSITIONING.SET":{actions:["reposition"]}}}},implementations:{guards:{closeOnSelect:({prop:e,event:t})=>!!(t?.closeOnSelect??e("closeOnSelect")),isTriggerItem:({event:e})=>Yd(e.target),isTriggerItemHighlighted:({event:e,scope:t,computed:i})=>!!(e.target??t.getById(i("highlightedId")))?.hasAttribute("aria-controls"),isSubmenu:({context:e})=>e.get("isSubmenu"),isPointerSuspended:({context:e})=>e.get("suspendPointer"),isHighlightedItemEditable:({scope:e,computed:t})=>Ua(e.getById(t("highlightedId"))),isOpenControlled:({prop:e})=>e("open")!==void 0,isArrowLeftEvent:({event:e})=>e.previousEvent?.type==="ARROW_LEFT",isArrowUpEvent:({event:e})=>e.previousEvent?.type==="ARROW_UP",isArrowDownEvent:({event:e})=>e.previousEvent?.type==="ARROW_DOWN",isOpenAutoFocusEvent:({event:e})=>e.previousEvent?.type==="OPEN_AUTOFOCUS"},effects:{waitForOpenDelay({send:e}){const t=setTimeout(()=>{e({type:"DELAY.OPEN"})},100);return()=>clearTimeout(t)},waitForCloseDelay({send:e}){const t=setTimeout(()=>{e({type:"DELAY.CLOSE"})},300);return()=>clearTimeout(t)},waitForLongPress({send:e}){const t=setTimeout(()=>{e({type:"LONG_PRESS.OPEN"})},700);return()=>clearTimeout(t)},trackPositioning({context:e,prop:t,scope:i,refs:s}){if(Nr(i))return;const n={...t("positioning"),...s.get("positioningOverride")};e.set("currentPlacement",n.placement);const a=()=>Fo(i);return Lo(Ws(i),a,{...n,defer:!0,onComplete(c){e.set("currentPlacement",c.placement)}})},trackInteractOutside({refs:e,scope:t,prop:i,context:s,send:n}){const a=()=>yi(t);let c=!0;return xd(a,{type:"menu",defer:!0,exclude:[Ws(t)],onInteractOutside:i("onInteractOutside"),onRequestDismiss:i("onRequestDismiss"),onFocusOutside(r){i("onFocusOutside")?.(r);const o=Si(r.detail.originalEvent);if(bi(Nr(t),o)){r.preventDefault();return}},onEscapeKeyDown(r){i("onEscapeKeyDown")?.(r),s.get("isSubmenu")&&r.preventDefault(),zo({parent:e.get("parent")})},onPointerDownOutside(r){i("onPointerDownOutside")?.(r);const o=Si(r.detail.originalEvent);if(bi(Nr(t),o)&&r.detail.contextmenu){r.preventDefault();return}c=!r.detail.focusable},onDismiss(){n({type:"CLOSE",src:"interact-outside",restoreFocus:c})}})},trackPointerMove({context:e,scope:t,send:i,refs:s,flush:n}){const a=s.get("parent");n(()=>{a.context.set("suspendPointer",!0)});const c=t.getDoc();return vs(c,"pointermove",r=>{tf(e.get("intentPolygon"),{x:r.clientX,y:r.clientY})||(i({type:"POINTER_MOVED_AWAY_FROM_SUBMENU"}),a.context.set("suspendPointer",!1))})},scrollToHighlightedItem({event:e,scope:t,computed:i}){const s=()=>{if(e.current().type.startsWith("ITEM_POINTER"))return;const a=t.getById(i("highlightedId")),c=yi(t);yu(a,{rootEl:c,block:"nearest"})};return Ft(()=>s()),fu(()=>yi(t),{attributes:["aria-activedescendant"],callback:s})}},actions:{setAnchorPoint({context:e,event:t}){e.set("anchorPoint",i=>Ts(i,t.point)?i:t.point)},setSubmenuPlacement({context:e,computed:t,refs:i}){if(!e.get("isSubmenu"))return;const s=t("isRtl")?"left-start":"right-start";i.set("positioningOverride",{placement:s,gutter:0})},reposition({context:e,scope:t,prop:i,event:s,refs:n}){const a=()=>Fo(t),c=e.get("anchorPoint"),r=c?()=>({width:0,height:0,...c}):void 0,o={...i("positioning"),...n.get("positioningOverride")};Lo(Ws(t),a,{...o,defer:!0,getAnchorRect:r,...s.options??{},listeners:!1,onComplete(u){e.set("currentPlacement",u.placement)}})},setOptionState({event:e}){if(!e.option)return;const{checked:t,onCheckedChange:i,type:s}=e.option;s==="radio"?i?.(!0):s==="checkbox"&&i?.(!t)},clickHighlightedItem({scope:e,computed:t,prop:i,context:s}){const n=e.getById(t("highlightedId"));if(!n||n.dataset.disabled)return;const a=s.get("highlightedValue");Ml(n)?i("navigate")?.({value:a,node:n,href:n.href}):queueMicrotask(()=>n.click())},setIntentPolygon({context:e,scope:t,event:i}){const s=yi(t),n=e.get("currentPlacement");if(!s||!n)return;const a=s.getBoundingClientRect(),c=Fd(a,n);if(!c)return;const o=td(n)==="right"?-5:5;e.set("intentPolygon",[{...i.point,x:i.point.x+o},...c])},clearIntentPolygon({context:e}){e.set("intentPolygon",null)},clearAnchorPoint({context:e}){e.set("anchorPoint",null)},resumePointer({refs:e,flush:t}){const i=e.get("parent");i&&t(()=>{i.context.set("suspendPointer",!1)})},setHighlightedItem({context:e,event:t}){const i=t.value||Li(t.target);e.set("highlightedValue",i)},clearHighlightedItem({context:e}){e.set("highlightedValue",null)},focusMenu({scope:e}){Ft(()=>{const t=yi(e);cu({root:t,enabled:!bi(t,e.getActiveElement()),filter(s){return!s.role?.startsWith("menuitem")}})?.focus({preventScroll:!0})})},highlightFirstItem({context:e,scope:t}){(yi(t)?queueMicrotask:Ft)(()=>{const s=jd(t);s&&e.set("highlightedValue",Li(s))})},highlightLastItem({context:e,scope:t}){(yi(t)?queueMicrotask:Ft)(()=>{const s=Vd(t);s&&e.set("highlightedValue",Li(s))})},highlightNextItem({context:e,scope:t,event:i,prop:s}){const n=Gd(t,{loop:i.loop,value:e.get("highlightedValue"),loopFocus:s("loopFocus")});e.set("highlightedValue",Li(n))},highlightPrevItem({context:e,scope:t,event:i,prop:s}){const n=Kd(t,{loop:i.loop,value:e.get("highlightedValue"),loopFocus:s("loopFocus")});e.set("highlightedValue",Li(n))},invokeOnSelect({context:e,prop:t,scope:i}){const s=e.get("highlightedValue");if(s==null)return;const n=$d(i,s);Jd(n,s),t("onSelect")?.({value:s})},focusTrigger({scope:e,context:t,event:i}){t.get("isSubmenu")||t.get("anchorPoint")||i.restoreFocus===!1||queueMicrotask(()=>Ws(e)?.focus({preventScroll:!0}))},highlightMatchedItem({scope:e,context:t,event:i,refs:s}){const n=Xd(e,{key:i.key,value:t.get("highlightedValue"),typeaheadState:s.get("typeaheadState")});n&&t.set("highlightedValue",Li(n))},setParentMenu({refs:e,event:t,context:i}){e.set("parent",t.value),i.set("isSubmenu",!0)},setChildMenu({refs:e,event:t}){const i=e.get("children");i[t.id]=t.value,e.set("children",i)},closeRootMenu({refs:e}){zo({parent:e.get("parent")})},openSubmenu({refs:e,scope:t,computed:i}){const n=t.getById(i("highlightedId"))?.getAttribute("data-uid"),a=e.get("children");(n?a[n]:null)?.send({type:"OPEN_AUTOFOCUS"})},focusParentMenu({refs:e}){e.get("parent")?.send({type:"FOCUS_MENU"})},setLastHighlightedItem({context:e,event:t}){e.set("lastHighlightedValue",Li(t.target))},restoreHighlightedItem({context:e}){e.get("lastHighlightedValue")&&(e.set("highlightedValue",e.get("lastHighlightedValue")),e.set("lastHighlightedValue",null))},restoreParentHighlightedItem({refs:e}){e.get("parent")?.send({type:"HIGHLIGHTED.RESTORE"})},invokeOnOpen({prop:e}){e("onOpenChange")?.({open:!0})},invokeOnClose({prop:e}){e("onOpenChange")?.({open:!1})},toggleVisibility({prop:e,event:t,send:i}){i({type:e("open")?"CONTROLLED.OPEN":"CONTROLLED.CLOSE",previousEvent:t})}}}};function zo(e){let t=e.parent;for(;t&&t.context.get("isSubmenu");)t=t.refs.get("parent");t?.send({type:"CLOSE"})}function tf(e,t){return e?zd(e,t):!1}function sf(e,t,i){const s=Object.keys(e).length>0;if(!t)return null;if(!s)return xs(i,t);for(const n in e){const a=e[n],c=ar(a.scope);if(c===t)return c}return xs(i,t)}var rf=es()(["anchorPoint","aria-label","closeOnSelect","composite","defaultHighlightedValue","defaultOpen","dir","getRootNode","highlightedValue","id","ids","loopFocus","navigate","onEscapeKeyDown","onFocusOutside","onHighlightChange","onInteractOutside","onOpenChange","onPointerDownOutside","onRequestDismiss","onSelect","open","positioning","typeahead"]),nf=Qi(rf),of=es()(["closeOnSelect","disabled","value","valueText"]),hh=Qi(of),af=es()(["htmlFor"]),hf=Qi(af),cf=es()(["id"]),lf=Qi(cf),uf=es()(["checked","closeOnSelect","disabled","onCheckedChange","type","value","valueText"]),_f=Qi(uf),df=ze("<div><!></div>");function ff(e,t){Ue(t,!0);const i=Ve(t,["$$slots","$$events","$$legacy"]),s=ct.consume(),n=nh.consume(),a=Z(()=>hf({htmlFor:n().id,...i})),c=Z(()=>Mi(N(a),2)),r=Z(()=>N(c)[0]),o=Z(()=>N(c)[1]),u=Z(()=>N(o).element),f=Z(()=>N(o).children),l=Z(()=>Xe(N(o),["element","children"])),m=Z(()=>Je(s().getItemGroupLabelProps(N(r)),{class:St.itemGroupLabel},N(l)));var g=Se(),C=ye(g);{var v=p=>{var _=Se(),d=ye(_);ke(d,()=>N(u),()=>N(m)),ae(p,_)},h=p=>{var _=df();Ye(_,()=>({...N(m)}));var d=Pe(_);ke(d,()=>N(f)??st),Me(_),ae(p,_)};We(C,p=>{N(u)?p(v):p(h,!1)})}ae(e,g),Ne()}var pf=ze("<div><!></div>");function mf(e,t){const i=bn();Ue(t,!0);const s=Ve(t,["$$slots","$$events","$$legacy"]),n=ct.consume(),a=Z(()=>lf({id:i,...s})),c=Z(()=>Mi(N(a),2)),r=Z(()=>N(c)[0]),o=Z(()=>N(c)[1]),u=Z(()=>N(o).element),f=Z(()=>N(o).children),l=Z(()=>Xe(N(o),["element","children"])),m=Z(()=>Je(n().getItemGroupProps(N(r)),{class:St.itemGroup},N(l)));nh.provide(()=>N(r));var g=Se(),C=ye(g);{var v=p=>{var _=Se(),d=ye(_);ke(d,()=>N(u),()=>N(m)),ae(p,_)},h=p=>{var _=pf();Ye(_,()=>({...N(m)}));var d=Pe(_);ke(d,()=>N(f)??st),Me(_),ae(p,_)};We(C,p=>{N(u)?p(v):p(h,!1)})}ae(e,g),Ne()}const Os=Rs();var gf=ze("<div><!></div>");function vf(e,t){Ue(t,!0);const i=Ve(t,["$$slots","$$events","$$legacy"]),s=ct.consume(),n=Os.consume(),a=Z(()=>t.element),c=Z(()=>t.children),r=Z(()=>Xe(i,["element","children"])),o=Z(()=>Je(s().getItemIndicatorProps(n()),{class:St.itemIndicator},N(r)));var u=Se(),f=ye(u);{var l=g=>{var C=Se(),v=ye(C);ke(v,()=>N(a),()=>N(o)),ae(g,C)},m=g=>{var C=gf();Ye(C,()=>({...N(o)}));var v=Pe(C);ke(v,()=>N(c)??st),Me(C),ae(g,C)};We(f,g=>{N(a)?g(l):g(m,!1)})}ae(e,u),Ne()}var yf=ze("<div><!></div>");function bf(e,t){Ue(t,!0);const i=Ve(t,["$$slots","$$events","$$legacy"]),s=ct.consume(),n=Os.consume(),a=Z(()=>t.element),c=Z(()=>t.children),r=Z(()=>Xe(i,["element","children"])),o=Z(()=>Je(s().getItemTextProps(n()),{class:St.itemText},N(r)));var u=Se(),f=ye(u);{var l=g=>{var C=Se(),v=ye(C);ke(v,()=>N(a),()=>N(o)),ae(g,C)},m=g=>{var C=yf();Ye(C,()=>({...N(o)}));var v=Pe(C);ke(v,()=>N(c)??st),Me(C),ae(g,C)};We(f,g=>{N(a)?g(l):g(m,!1)})}ae(e,u),Ne()}var wf=ze("<div><!></div>");function Sf(e,t){Ue(t,!0);const i=Ve(t,["$$slots","$$events","$$legacy"]),s=ct.consume(),n=Z(()=>hh(i)),a=Z(()=>Mi(N(n),2)),c=Z(()=>N(a)[0]),r=Z(()=>N(a)[1]),o=Z(()=>N(r).element),u=Z(()=>N(r).children),f=Z(()=>Xe(N(r),["element","children"])),l=Z(()=>Je(s().getItemProps(N(c)),{class:St.item},N(f)));Os.provide(()=>N(c));var m=Se(),g=ye(m);{var C=h=>{var p=Se(),_=ye(p);ke(_,()=>N(o),()=>N(l)),ae(h,p)},v=h=>{var p=wf();Ye(p,()=>({...N(l)}));var _=Pe(p);ke(_,()=>N(u)??st),Me(p),ae(h,p)};We(g,h=>{N(o)?h(C):h(v,!1)})}ae(e,m),Ne()}var Cf=ze("<div><!></div>");function Ef(e,t){Ue(t,!0);const i=Ve(t,["$$slots","$$events","$$legacy"]),s=ct.consume(),n=Z(()=>_f(i)),a=Z(()=>Mi(N(n),2)),c=Z(()=>N(a)[0]),r=Z(()=>N(a)[1]),o=Z(()=>N(r).element),u=Z(()=>N(r).children),f=Z(()=>Xe(N(r),["element","children"])),l=Z(()=>Je(s().getOptionItemProps(N(c)),{class:St.item},N(f)));Os.provide(()=>N(c));var m=Se(),g=ye(m);{var C=h=>{var p=Se(),_=ye(p);ke(_,()=>N(o),()=>N(l)),ae(h,p)},v=h=>{var p=Cf();Ye(p,()=>({...N(l)}));var _=Pe(p);ke(_,()=>N(u)??st),Me(p),ae(h,p)};We(g,h=>{N(o)?h(C):h(v,!1)})}ae(e,m),Ne()}var kf=ze("<div><!></div>");function xf(e,t){Ue(t,!0);const i=Ve(t,["$$slots","$$events","$$legacy"]),s=ct.consume(),n=Z(()=>t.element),a=Z(()=>t.children),c=Z(()=>Xe(i,["element","children"])),r=Z(()=>Je(s().getPositionerProps(),{class:St.positioner},N(c)));var o=Se(),u=ye(o);{var f=m=>{var g=Se(),C=ye(g);ke(C,()=>N(n),()=>N(r)),ae(m,g)},l=m=>{var g=kf();Ye(g,()=>({...N(r)}));var C=Pe(g);ke(C,()=>N(a)??st),Me(g),ae(m,g)};We(u,m=>{N(n)?m(f):m(l,!1)})}ae(e,o),Ne()}function Af(e,t){Ue(t,!0);const i=ct.consume(),s=Z(()=>t.children);var n=Se(),a=ye(n);ke(a,()=>N(s),()=>i),ae(e,n),Ne()}const Fn=Rs();function Rf(e,t){Ue(t,!0);const i=ct.consume(),s=Z(()=>t.children),n=Z(()=>t.value);wn(()=>bt(()=>{i&&(N(n)().setParent(i().service),i().setChild(N(n)().service))})),ct.provide(()=>N(n)()),Fn.provide(()=>i?.().getTriggerItemProps(N(n)()));var a=Se(),c=ye(a);ke(c,()=>N(s)??st),ae(e,a),Ne()}function Tf(e){const t=Ga(ef,e),i=Z(()=>Zd(t,Va));return()=>({...N(i),get service(){return t}})}function Lf(e,t){const i=bn();Ue(t,!0);const s=Ve(t,["$$slots","$$events","$$legacy"]),n=ct.consume(),a=Z(()=>nf(s)),c=Z(()=>Mi(N(a),2)),r=Z(()=>N(c)[0]),o=Z(()=>N(c)[1]),u=Z(()=>N(o).children),f=Tf(()=>({...N(r),id:i}));wn(()=>bt(()=>{n&&(f().setParent(n().service),n().setChild(f().service))})),ct.provide(()=>f()),Fn.provide(()=>n?.().getTriggerItemProps(f()));var l=Se(),m=ye(l);ke(m,()=>N(u)??st),ae(e,l),Ne()}var Df=ze("<hr/>");function Of(e,t){Ue(t,!0);const i=Ve(t,["$$slots","$$events","$$legacy"]),s=ct.consume(),n=Z(()=>t.element),a=Z(()=>Xe(i,["element"])),c=Z(()=>Je(s().getSeparatorProps(),{class:St.separator},N(a)));var r=Se(),o=ye(r);{var u=l=>{var m=Se(),g=ye(m);ke(g,()=>N(n),()=>N(c)),ae(l,m)},f=l=>{var m=Df();Ye(m,()=>({...N(c)})),ae(l,m)};We(o,l=>{N(n)?l(u):l(f,!1)})}ae(e,r),Ne()}var If=ze("<div><!></div>");function Pf(e,t){Ue(t,!0);const i=Ve(t,["$$slots","$$events","$$legacy"]),s=Fn.consume(),n=Z(()=>hh(i)),a=Z(()=>Mi(N(n),2)),c=Z(()=>N(a)[0]),r=Z(()=>N(a)[1]),o=Z(()=>N(r).element),u=Z(()=>N(r).children),f=Z(()=>Xe(N(r),["element","children"])),l=Z(()=>Je(s(),{class:St.item},N(f)));Os.provide(()=>N(c));var m=Se(),g=ye(m);{var C=h=>{var p=Se(),_=ye(p);ke(_,()=>N(o),()=>N(l)),ae(h,p)},v=h=>{var p=If();Ye(p,()=>({...N(l)}));var _=Pe(p);ke(_,()=>N(u)??st),Me(p),ae(h,p)};We(g,h=>{N(o)?h(C):h(v,!1)})}ae(e,m),Ne()}var Mf=ze("<button><!></button>");function Bf(e,t){Ue(t,!0);const i=Ve(t,["$$slots","$$events","$$legacy"]),s=ct.consume(),n=Z(()=>t.element),a=Z(()=>t.children),c=Z(()=>Xe(i,["element","children"])),r=Z(()=>Je(s().getTriggerProps(),{class:St.trigger},N(c)));var o=Se(),u=ye(o);{var f=m=>{var g=Se(),C=ye(g);ke(C,()=>N(n),()=>N(r)),ae(m,g)},l=m=>{var g=Mf();Ye(g,()=>({...N(r)}));var C=Pe(g);ke(C,()=>N(a)??st),Me(g),ae(m,g)};We(u,m=>{N(n)?m(f):m(l,!1)})}ae(e,o),Ne()}const Vt=Object.assign(Lf,{Provider:Rf,Context:Af,Trigger:Bf,ContextTrigger:Pd,Indicator:Bd,Positioner:xf,Content:Od,ItemGroup:mf,ItemGroupLabel:ff,Item:Sf,OptionItem:Ef,TriggerItem:Pf,ItemText:bf,ItemIndicator:vf,Separator:Of,Arrow:Ld,ArrowTip:Rd}),ti=Rs();var Uf=hr("<circle></circle>");function Nf(e,t){Ue(t,!0);const i=Ve(t,["$$slots","$$events","$$legacy"]),s=ti.consume(),n=Z(()=>t.element),a=Z(()=>Xe(i,["element"])),c=Z(()=>Je(s().getCircleRangeProps(),{class:_i.circleRange,"stroke-linecap":"round"},N(a)));var r=Se(),o=ye(r);{var u=l=>{var m=Se(),g=ye(m);ke(g,()=>N(n),()=>N(c)),ae(l,m)},f=l=>{var m=Uf();Ye(m,()=>({...N(c)})),ae(l,m)};We(o,l=>{N(n)?l(u):l(f,!1)})}ae(e,r),Ne()}var Ff=hr("<circle></circle>");function zf(e,t){Ue(t,!0);const i=Ve(t,["$$slots","$$events","$$legacy"]),s=ti.consume(),n=Z(()=>t.element),a=Z(()=>Xe(i,["element"])),c=Z(()=>Je(s().getCircleTrackProps(),{class:_i.circleTrack},N(a)));var r=Se(),o=ye(r);{var u=l=>{var m=Se(),g=ye(m);ke(g,()=>N(n),()=>N(c)),ae(l,m)},f=l=>{var m=Ff();Ye(m,()=>({...N(c)})),ae(l,m)};We(o,l=>{N(n)?l(u):l(f,!1)})}ae(e,r),Ne()}var Hf=hr("<svg><!></svg>");function qf(e,t){Ue(t,!0);const i=Ve(t,["$$slots","$$events","$$legacy"]),s=ti.consume(),n=Z(()=>t.element),a=Z(()=>t.children),c=Z(()=>Xe(i,["element","children"])),r=Z(()=>Je(s().getCircleProps(),{class:_i.circle,style:"--size: 100px; --thickness: 10px;"},N(c)));var o=Se(),u=ye(o);{var f=m=>{var g=Se(),C=ye(g);ke(C,()=>N(n),()=>N(r)),ae(m,g)},l=m=>{var g=Hf();Ye(g,()=>({...N(r)}));var C=Pe(g);ke(C,()=>N(a)??st),Me(g),ae(m,g)};We(u,m=>{N(n)?m(f):m(l,!1)})}ae(e,o),Ne()}var Wf=ze("<div><!></div>");function $f(e,t){Ue(t,!0);const i=Ve(t,["$$slots","$$events","$$legacy"]),s=ti.consume(),n=Z(()=>t.element),a=Z(()=>t.children),c=Z(()=>Xe(i,["element","children"])),r=Z(()=>Je(s().getLabelProps(),{class:_i.label},N(c)));var o=Se(),u=ye(o);{var f=m=>{var g=Se(),C=ye(g);ke(C,()=>N(n),()=>N(r)),ae(m,g)},l=m=>{var g=Wf();Ye(g,()=>({...N(r)}));var C=Pe(g);ke(C,()=>N(a)??st),Me(g),ae(m,g)};We(u,m=>{N(n)?m(f):m(l,!1)})}ae(e,o),Ne()}var jf=ze("<div><!></div>");function Vf(e,t){Ue(t,!0);const i=Ve(t,["$$slots","$$events","$$legacy"]),s=ti.consume(),n=Z(()=>t.element),a=Z(()=>t.children),c=Z(()=>Xe(i,["element","children"])),r=Z(()=>Je(s().getRangeProps(),{class:_i.range},N(c)));var o=Se(),u=ye(o);{var f=m=>{var g=Se(),C=ye(g);ke(C,()=>N(n),()=>N(r)),ae(m,g)},l=m=>{var g=jf();Ye(g,()=>({...N(r)}));var C=Pe(g);ke(C,()=>N(a)??st),Me(g),ae(m,g)};We(u,m=>{N(n)?m(f):m(l,!1)})}ae(e,o),Ne()}function Gf(e,t){Ue(t,!0);const i=ti.consume(),s=Z(()=>t.children);var n=Se(),a=ye(n);ke(a,()=>N(s),()=>i),ae(e,n),Ne()}var Kf=ze("<div><!></div>");function Xf(e,t){Ue(t,!0);const i=Ve(t,["$$slots","$$events","$$legacy"]),s=Z(()=>t.element),n=Z(()=>t.children),a=Z(()=>t.value),c=Z(()=>Xe(i,["element","children","value"])),r=Z(()=>Je(N(a)().getRootProps(),{class:_i.root},N(c)));ti.provide(()=>N(a)());var o=Se(),u=ye(o);{var f=m=>{var g=Se(),C=ye(g);ke(C,()=>N(s),()=>N(r)),ae(m,g)},l=m=>{var g=Kf();Ye(g,()=>({...N(r)}));var C=Pe(g);ke(C,()=>N(n)??st),Me(g),ae(m,g)};We(u,m=>{N(s)?m(f):m(l,!1)})}ae(e,o),Ne()}var Yf=Gi("progress").parts("root","label","track","range","valueText","view","circle","circleTrack","circleRange"),ai=Yf.build(),Jf=e=>e.ids?.root??`progress-${e.id}`,Zf=e=>e.ids?.track??`progress-${e.id}-track`,Qf=e=>e.ids?.label??`progress-${e.id}-label`,ep=e=>e.ids?.circle??`progress-${e.id}-circle`;function tp(e,t){const{context:i,computed:s,prop:n,send:a,scope:c}=e,r=s("percent"),o=s("isIndeterminate")?"":s("formatter").format(r/100),u=n("max"),f=n("min"),l=n("orientation"),m=n("translations"),g=s("isIndeterminate"),C=i.get("value"),v=m?.value({value:C,max:u,percent:r,min:f,formatter:s("formatter")})??"",h=ip(C,u),p={role:"progressbar","aria-label":v,"data-max":u,"aria-valuemin":f,"aria-valuemax":u,"aria-valuenow":C??void 0,"data-orientation":l,"data-state":h},_=rp(e);return{value:C,valueAsString:v,min:f,max:u,percent:r,percentAsString:o,indeterminate:g,setValue(d){a({type:"VALUE.SET",value:d})},setToMax(){a({type:"VALUE.SET",value:u})},setToMin(){a({type:"VALUE.SET",value:f})},getRootProps(){return t.element({dir:n("dir"),...ai.root.attrs,id:Jf(c),"data-max":u,"data-value":C??void 0,"data-state":h,"data-orientation":l,style:{"--percent":g?void 0:r}})},getLabelProps(){return t.element({dir:n("dir"),id:Qf(c),...ai.label.attrs,"data-orientation":l})},getValueTextProps(){return t.element({dir:n("dir"),"aria-live":"polite",...ai.valueText.attrs})},getTrackProps(){return t.element({dir:n("dir"),id:Zf(c),...ai.track.attrs,...p})},getRangeProps(){return t.element({dir:n("dir"),...ai.range.attrs,"data-orientation":l,"data-state":h,style:{[s("isHorizontal")?"width":"height"]:g?void 0:`${r}%`}})},getCircleProps(){return t.element({dir:n("dir"),id:ep(c),...ai.circle.attrs,...p,..._.root})},getCircleTrackProps(){return t.element({dir:n("dir"),"data-orientation":l,...ai.circleTrack.attrs,..._.track})},getCircleRangeProps(){return t.element({dir:n("dir"),...ai.circleRange.attrs,..._.range,"data-state":h})},getViewProps(d){return t.element({dir:n("dir"),...ai.view.attrs,"data-state":d.state,hidden:d.state!==h})}}}function ip(e,t){return e==null?"indeterminate":e===t?"complete":"loading"}var Ho={style:{"--radius":"calc(var(--size) / 2 - var(--thickness) / 2)",cx:"calc(var(--size) / 2)",cy:"calc(var(--size) / 2)",r:"var(--radius)",fill:"transparent",strokeWidth:"var(--thickness)"}},sp={style:{width:"var(--size)",height:"var(--size)"}};function rp(e){const{context:t,computed:i}=e;return{root:sp,track:Ho,range:{opacity:t.get("value")===0?0:void 0,style:{...Ho.style,"--percent":i("percent"),"--circumference":"calc(2 * 3.14159 * var(--radius))","--offset":"calc(var(--circumference) * (100 - var(--percent)) / 100)",strokeDashoffset:"calc(var(--circumference) * ((100 - var(--percent)) / 100))",strokeDasharray:i("isIndeterminate")?void 0:"var(--circumference)",transformOrigin:"center",transform:"rotate(-90deg)"}}}}var np={props({props:e}){const t=e.min??0,i=e.max??100;return{orientation:"horizontal",...e,max:i,min:t,defaultValue:e.defaultValue!==void 0?e.defaultValue:hp(t,i),formatOptions:{style:"percent",...e.formatOptions},translations:{value:({value:s,percent:n,formatter:a})=>{if(s===null)return"loading...";if(a){const r=a.resolvedOptions().style==="percent"?n/100:s;return a.format(r)}return s.toString()},...e.translations}}},initialState(){return"idle"},entry:["validateContext"],context({bindable:e,prop:t}){return{value:e(()=>({defaultValue:t("defaultValue"),value:t("value"),onChange(i){t("onValueChange")?.({value:i})}}))}},computed:{isIndeterminate:({context:e})=>e.get("value")===null,percent({context:e,prop:t}){const i=e.get("value");return Pa(i)?bl(i,t("min"),t("max"))*100:-1},formatter:Mu(({prop:e})=>[e("locale"),e("formatOptions")],([e,t])=>new Intl.NumberFormat(e,t)),isHorizontal:({prop:e})=>e("orientation")==="horizontal"},states:{idle:{on:{"VALUE.SET":{actions:["setValue"]}}}},implementations:{actions:{setValue:({context:e,event:t,prop:i})=>{const s=t.value===null?null:Math.max(0,Math.min(t.value,i("max")));e.set("value",s)},validateContext:({context:e,prop:t})=>{const i=t("max"),s=t("min"),n=e.get("value");if(n!=null){if(!zn(i))throw new Error(`[progress] The max value passed \`${i}\` is not a valid number`);if(!op(n,i))throw new Error(`[progress] The value passed \`${n}\` exceeds the max value \`${i}\``);if(!ap(n,s))throw new Error(`[progress] The value passed \`${n}\` exceeds the min value \`${s}\``)}}}}},zn=e=>Pa(e)&&!isNaN(e),op=(e,t)=>zn(e)&&e<=t,ap=(e,t)=>zn(e)&&e>=t,hp=(e,t)=>e+(t-e)/2,cp=es()(["dir","getRootNode","id","ids","max","min","orientation","translations","value","onValueChange","defaultValue","formatOptions","locale"]),lp=Qi(cp);function up(e){const t=Ga(np,e),i=Z(()=>tp(t,Va));return()=>N(i)}var _p=ze("<div><!></div>");function dp(e,t){const i=bn();Ue(t,!0);const s=Ve(t,["$$slots","$$events","$$legacy"]),n=Z(()=>lp(s)),a=Z(()=>Mi(N(n),2)),c=Z(()=>N(a)[0]),r=Z(()=>N(a)[1]),o=Z(()=>N(r).element),u=Z(()=>N(r).children),f=Z(()=>Xe(N(r),["element","children"])),l=up(()=>({...N(c),id:i})),m=Z(()=>Je(l().getRootProps(),{class:_i.root},N(f)));ti.provide(()=>l());var g=Se(),C=ye(g);{var v=p=>{var _=Se(),d=ye(_);ke(d,()=>N(o),()=>N(m)),ae(p,_)},h=p=>{var _=_p();Ye(_,()=>({...N(m)}));var d=Pe(_);ke(d,()=>N(u)??st),Me(_),ae(p,_)};We(C,p=>{N(o)?p(v):p(h,!1)})}ae(e,g),Ne()}var fp=ze("<div><!></div>");function pp(e,t){Ue(t,!0);const i=Ve(t,["$$slots","$$events","$$legacy"]),s=ti.consume(),n=Z(()=>t.element),a=Z(()=>t.children),c=Z(()=>Xe(i,["element","children"])),r=Z(()=>Je(s().getTrackProps(),{class:_i.track},N(c)));var o=Se(),u=ye(o);{var f=m=>{var g=Se(),C=ye(g);ke(C,()=>N(n),()=>N(r)),ae(m,g)},l=m=>{var g=fp();Ye(g,()=>({...N(r)}));var C=Pe(g);ke(C,()=>N(a)??st),Me(g),ae(m,g)};We(u,m=>{N(n)?m(f):m(l,!1)})}ae(e,o),Ne()}var mp=ze("<span><!></span>");function gp(e,t){Ue(t,!0);const i=Ve(t,["$$slots","$$events","$$legacy"]),s=ti.consume(),n=Z(()=>t.element),a=Z(()=>t.children),c=Z(()=>Xe(i,["element","children"])),r=Z(()=>Je(s().getValueTextProps(),{class:_i.valueText},N(c)));var o=Se(),u=ye(o);{var f=m=>{var g=Se(),C=ye(g);ke(C,()=>N(n),()=>N(r)),ae(m,g)},l=m=>{var g=mp();Ye(g,()=>({...N(r)}));var C=Pe(g);{var v=p=>{var _=Se(),d=ye(_);ke(d,()=>N(a)??st),ae(p,_)},h=p=>{var _=Ys();ir(d=>Sn(_,d),[()=>s().percentAsString]),ae(p,_)};We(C,p=>{N(a)?p(v):p(h,!1)})}Me(g),ae(m,g)};We(u,m=>{N(n)?m(f):m(l,!1)})}ae(e,o),Ne()}const js=Object.assign(dp,{Provider:Xf,Context:Gf,Label:$f,ValueText:gp,Track:pp,Range:Vf,Circle:qf,CircleTrack:zf,CircleRange:Nf});var Fr=function(e,t){return Object.defineProperty?Object.defineProperty(e,"raw",{value:t}):e.raw=t,e},qe;(function(e){e[e.EOS=0]="EOS",e[e.Text=1]="Text",e[e.Incomplete=2]="Incomplete",e[e.ESC=3]="ESC",e[e.Unknown=4]="Unknown",e[e.SGR=5]="SGR",e[e.OSCURL=6]="OSCURL"})(qe||(qe={}));class vp{constructor(){this.VERSION="6.0.6",this.setup_palettes(),this._use_classes=!1,this.bold=!1,this.faint=!1,this.italic=!1,this.underline=!1,this.fg=this.bg=null,this._buffer="",this._url_allowlist={http:1,https:1},this._escape_html=!0,this.boldStyle="font-weight:bold",this.faintStyle="opacity:0.7",this.italicStyle="font-style:italic",this.underlineStyle="text-decoration:underline"}set use_classes(t){this._use_classes=t}get use_classes(){return this._use_classes}set url_allowlist(t){this._url_allowlist=t}get url_allowlist(){return this._url_allowlist}set escape_html(t){this._escape_html=t}get escape_html(){return this._escape_html}set boldStyle(t){this._boldStyle=t}get boldStyle(){return this._boldStyle}set faintStyle(t){this._faintStyle=t}get faintStyle(){return this._faintStyle}set italicStyle(t){this._italicStyle=t}get italicStyle(){return this._italicStyle}set underlineStyle(t){this._underlineStyle=t}get underlineStyle(){return this._underlineStyle}setup_palettes(){this.ansi_colors=[[{rgb:[0,0,0],class_name:"ansi-black"},{rgb:[187,0,0],class_name:"ansi-red"},{rgb:[0,187,0],class_name:"ansi-green"},{rgb:[187,187,0],class_name:"ansi-yellow"},{rgb:[0,0,187],class_name:"ansi-blue"},{rgb:[187,0,187],class_name:"ansi-magenta"},{rgb:[0,187,187],class_name:"ansi-cyan"},{rgb:[255,255,255],class_name:"ansi-white"}],[{rgb:[85,85,85],class_name:"ansi-bright-black"},{rgb:[255,85,85],class_name:"ansi-bright-red"},{rgb:[0,255,0],class_name:"ansi-bright-green"},{rgb:[255,255,85],class_name:"ansi-bright-yellow"},{rgb:[85,85,255],class_name:"ansi-bright-blue"},{rgb:[255,85,255],class_name:"ansi-bright-magenta"},{rgb:[85,255,255],class_name:"ansi-bright-cyan"},{rgb:[255,255,255],class_name:"ansi-bright-white"}]],this.palette_256=[],this.ansi_colors.forEach(s=>{s.forEach(n=>{this.palette_256.push(n)})});let t=[0,95,135,175,215,255];for(let s=0;s<6;++s)for(let n=0;n<6;++n)for(let a=0;a<6;++a){let c={rgb:[t[s],t[n],t[a]],class_name:"truecolor"};this.palette_256.push(c)}let i=8;for(let s=0;s<24;++s,i+=10){let n={rgb:[i,i,i],class_name:"truecolor"};this.palette_256.push(n)}}escape_txt_for_html(t){return this._escape_html?t.replace(/[&<>"']/gm,i=>{if(i==="&")return"&amp;";if(i==="<")return"&lt;";if(i===">")return"&gt;";if(i==='"')return"&quot;";if(i==="'")return"&#x27;"}):t}append_buffer(t){var i=this._buffer+t;this._buffer=i}get_next_packet(){var t={kind:qe.EOS,text:"",url:""},i=this._buffer.length;if(i==0)return t;var s=this._buffer.indexOf("\x1B");if(s==-1)return t.kind=qe.Text,t.text=this._buffer,this._buffer="",t;if(s>0)return t.kind=qe.Text,t.text=this._buffer.slice(0,s),this._buffer=this._buffer.slice(s),t;if(s==0){if(i<3)return t.kind=qe.Incomplete,t;var n=this._buffer.charAt(1);if(n!="["&&n!="]"&&n!="(")return t.kind=qe.ESC,t.text=this._buffer.slice(0,1),this._buffer=this._buffer.slice(1),t;if(n=="["){this._csi_regex||(this._csi_regex=qo(Wo||(Wo=Fr([`
                        ^                           # beginning of line
                                                    #
                                                    # First attempt
                        (?:                         # legal sequence
                          \x1B[                      # CSI
                          ([<-?]?)              # private-mode char
                          ([d;]*)                    # any digits or semicolons
                          ([ -/]?               # an intermediate modifier
                          [@-~])                # the command
                        )
                        |                           # alternate (second attempt)
                        (?:                         # illegal sequence
                          \x1B[                      # CSI
                          [ -~]*                # anything legal
                          ([\0-:])              # anything illegal
                        )
                    `],[`
                        ^                           # beginning of line
                                                    #
                                                    # First attempt
                        (?:                         # legal sequence
                          \\x1b\\[                      # CSI
                          ([\\x3c-\\x3f]?)              # private-mode char
                          ([\\d;]*)                    # any digits or semicolons
                          ([\\x20-\\x2f]?               # an intermediate modifier
                          [\\x40-\\x7e])                # the command
                        )
                        |                           # alternate (second attempt)
                        (?:                         # illegal sequence
                          \\x1b\\[                      # CSI
                          [\\x20-\\x7e]*                # anything legal
                          ([\\x00-\\x1f:])              # anything illegal
                        )
                    `]))));let c=this._buffer.match(this._csi_regex);if(c===null)return t.kind=qe.Incomplete,t;if(c[4])return t.kind=qe.ESC,t.text=this._buffer.slice(0,1),this._buffer=this._buffer.slice(1),t;c[1]!=""||c[3]!="m"?t.kind=qe.Unknown:t.kind=qe.SGR,t.text=c[2];var a=c[0].length;return this._buffer=this._buffer.slice(a),t}else if(n=="]"){if(i<4)return t.kind=qe.Incomplete,t;if(this._buffer.charAt(2)!="8"||this._buffer.charAt(3)!=";")return t.kind=qe.ESC,t.text=this._buffer.slice(0,1),this._buffer=this._buffer.slice(1),t;this._osc_st||(this._osc_st=yp($o||($o=Fr([`
                        (?:                         # legal sequence
                          (\x1B\\)                    # ESC                           |                           # alternate
                          (\x07)                      # BEL (what xterm did)
                        )
                        |                           # alternate (second attempt)
                        (                           # illegal sequence
                          [\0-]                 # anything illegal
                          |                           # alternate
                          [\b-]                 # anything illegal
                          |                           # alternate
                          [-]                 # anything illegal
                        )
                    `],[`
                        (?:                         # legal sequence
                          (\\x1b\\\\)                    # ESC \\
                          |                           # alternate
                          (\\x07)                      # BEL (what xterm did)
                        )
                        |                           # alternate (second attempt)
                        (                           # illegal sequence
                          [\\x00-\\x06]                 # anything illegal
                          |                           # alternate
                          [\\x08-\\x1a]                 # anything illegal
                          |                           # alternate
                          [\\x1c-\\x1f]                 # anything illegal
                        )
                    `])))),this._osc_st.lastIndex=0;{let o=this._osc_st.exec(this._buffer);if(o===null)return t.kind=qe.Incomplete,t;if(o[3])return t.kind=qe.ESC,t.text=this._buffer.slice(0,1),this._buffer=this._buffer.slice(1),t}{let o=this._osc_st.exec(this._buffer);if(o===null)return t.kind=qe.Incomplete,t;if(o[3])return t.kind=qe.ESC,t.text=this._buffer.slice(0,1),this._buffer=this._buffer.slice(1),t}this._osc_regex||(this._osc_regex=qo(jo||(jo=Fr([`
                        ^                           # beginning of line
                                                    #
                        \x1B]8;                    # OSC Hyperlink
                        [ -:<-~]*       # params (excluding ;)
                        ;                           # end of params
                        ([!-~]{0,512})        # URL capture
                        (?:                         # ST
                          (?:\x1B\\)                  # ESC                           |                           # alternate
                          (?:\x07)                    # BEL (what xterm did)
                        )
                        ([ -~]+)              # TEXT capture
                        \x1B]8;;                   # OSC Hyperlink End
                        (?:                         # ST
                          (?:\x1B\\)                  # ESC                           |                           # alternate
                          (?:\x07)                    # BEL (what xterm did)
                        )
                    `],[`
                        ^                           # beginning of line
                                                    #
                        \\x1b\\]8;                    # OSC Hyperlink
                        [\\x20-\\x3a\\x3c-\\x7e]*       # params (excluding ;)
                        ;                           # end of params
                        ([\\x21-\\x7e]{0,512})        # URL capture
                        (?:                         # ST
                          (?:\\x1b\\\\)                  # ESC \\
                          |                           # alternate
                          (?:\\x07)                    # BEL (what xterm did)
                        )
                        ([\\x20-\\x7e]+)              # TEXT capture
                        \\x1b\\]8;;                   # OSC Hyperlink End
                        (?:                         # ST
                          (?:\\x1b\\\\)                  # ESC \\
                          |                           # alternate
                          (?:\\x07)                    # BEL (what xterm did)
                        )
                    `]))));let c=this._buffer.match(this._osc_regex);if(c===null)return t.kind=qe.ESC,t.text=this._buffer.slice(0,1),this._buffer=this._buffer.slice(1),t;t.kind=qe.OSCURL,t.url=c[1],t.text=c[2];var a=c[0].length;return this._buffer=this._buffer.slice(a),t}else if(n=="(")return t.kind=qe.Unknown,this._buffer=this._buffer.slice(3),t}}ansi_to_html(t){this.append_buffer(t);for(var i=[];;){var s=this.get_next_packet();if(s.kind==qe.EOS||s.kind==qe.Incomplete)break;s.kind==qe.ESC||s.kind==qe.Unknown||(s.kind==qe.Text?i.push(this.transform_to_html(this.with_state(s))):s.kind==qe.SGR?this.process_ansi(s):s.kind==qe.OSCURL&&i.push(this.process_hyperlink(s)))}return i.join("")}with_state(t){return{bold:this.bold,faint:this.faint,italic:this.italic,underline:this.underline,fg:this.fg,bg:this.bg,text:t.text}}process_ansi(t){let i=t.text.split(";");for(;i.length>0;){let s=i.shift(),n=parseInt(s,10);if(isNaN(n)||n===0)this.fg=null,this.bg=null,this.bold=!1,this.faint=!1,this.italic=!1,this.underline=!1;else if(n===1)this.bold=!0;else if(n===2)this.faint=!0;else if(n===3)this.italic=!0;else if(n===4)this.underline=!0;else if(n===21)this.bold=!1;else if(n===22)this.faint=!1,this.bold=!1;else if(n===23)this.italic=!1;else if(n===24)this.underline=!1;else if(n===39)this.fg=null;else if(n===49)this.bg=null;else if(n>=30&&n<38)this.fg=this.ansi_colors[0][n-30];else if(n>=40&&n<48)this.bg=this.ansi_colors[0][n-40];else if(n>=90&&n<98)this.fg=this.ansi_colors[1][n-90];else if(n>=100&&n<108)this.bg=this.ansi_colors[1][n-100];else if((n===38||n===48)&&i.length>0){let a=n===38,c=i.shift();if(c==="5"&&i.length>0){let r=parseInt(i.shift(),10);r>=0&&r<=255&&(a?this.fg=this.palette_256[r]:this.bg=this.palette_256[r])}if(c==="2"&&i.length>2){let r=parseInt(i.shift(),10),o=parseInt(i.shift(),10),u=parseInt(i.shift(),10);if(r>=0&&r<=255&&o>=0&&o<=255&&u>=0&&u<=255){let f={rgb:[r,o,u],class_name:"truecolor"};a?this.fg=f:this.bg=f}}}}}transform_to_html(t){let i=t.text;if(i.length===0||(i=this.escape_txt_for_html(i),!t.bold&&!t.italic&&!t.faint&&!t.underline&&t.fg===null&&t.bg===null))return i;let s=[],n=[],a=t.fg,c=t.bg;t.bold&&s.push(this._boldStyle),t.faint&&s.push(this._faintStyle),t.italic&&s.push(this._italicStyle),t.underline&&s.push(this._underlineStyle),this._use_classes?(a&&(a.class_name!=="truecolor"?n.push(`${a.class_name}-fg`):s.push(`color:rgb(${a.rgb.join(",")})`)),c&&(c.class_name!=="truecolor"?n.push(`${c.class_name}-bg`):s.push(`background-color:rgb(${c.rgb.join(",")})`))):(a&&s.push(`color:rgb(${a.rgb.join(",")})`),c&&s.push(`background-color:rgb(${c.rgb})`));let r="",o="";return n.length&&(r=` class="${n.join(" ")}"`),s.length&&(o=` style="${s.join(";")}"`),`<span${o}${r}>${i}</span>`}process_hyperlink(t){let i=t.url.split(":");return i.length<1||!this._url_allowlist[i[0]]?"":`<a href="${this.escape_txt_for_html(t.url)}">${this.escape_txt_for_html(t.text)}</a>`}}function qo(e,...t){let i=e.raw[0],s=/^\s+|\s+\n|\s*#[\s\S]*?\n|\n/gm,n=i.replace(s,"");return new RegExp(n)}function yp(e,...t){let i=e.raw[0],s=/^\s+|\s+\n|\s*#[\s\S]*?\n|\n/gm,n=i.replace(s,"");return new RegExp(n,"g")}var Wo,$o,jo,Vs=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function ch(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var zr={exports:{}},Vo;function lh(){if(Vo)return zr.exports;Vo=1;var e=zr.exports={};return e.forEach=function(t,i){for(var s=0;s<t.length;s++){var n=i(t[s]);if(n)return n}},zr.exports}var Hr,Go;function bp(){return Go||(Go=1,Hr=function(e){var t=e.stateHandler.getState;function i(c){var r=t(c);return r&&!!r.isDetectable}function s(c){t(c).isDetectable=!0}function n(c){return!!t(c).busy}function a(c,r){t(c).busy=!!r}return{isDetectable:i,markAsDetectable:s,isBusy:n,markBusy:a}}),Hr}var qr,Ko;function wp(){return Ko||(Ko=1,qr=function(e){var t={};function i(c){var r=e.get(c);return r===void 0?[]:t[r]||[]}function s(c,r){var o=e.get(c);t[o]||(t[o]=[]),t[o].push(r)}function n(c,r){for(var o=i(c),u=0,f=o.length;u<f;++u)if(o[u]===r){o.splice(u,1);break}}function a(c){var r=i(c);r&&(r.length=0)}return{get:i,add:s,removeListener:n,removeAllListeners:a}}),qr}var Wr,Xo;function Sp(){return Xo||(Xo=1,Wr=function(){var e=1;function t(){return e++}return{generate:t}}),Wr}var $r,Yo;function Cp(){return Yo||(Yo=1,$r=function(e){var t=e.idGenerator,i=e.stateHandler.getState;function s(a){var c=i(a);return c&&c.id!==void 0?c.id:null}function n(a){var c=i(a);if(!c)throw new Error("setId required the element to have a resize detection state.");var r=t.generate();return c.id=r,r}return{get:s,set:n}}),$r}var jr,Jo;function Ep(){return Jo||(Jo=1,jr=function(e){function t(){}var i={log:t,warn:t,error:t};if(!e&&window.console){var s=function(n,a){n[a]=function(){var r=console[a];if(r.apply)r.apply(console,arguments);else for(var o=0;o<arguments.length;o++)r(arguments[o])}};s(i,"log"),s(i,"warn"),s(i,"error")}return i}),jr}var Vr={exports:{}},Zo;function uh(){if(Zo)return Vr.exports;Zo=1;var e=Vr.exports={};return e.isIE=function(t){function i(){var n=navigator.userAgent.toLowerCase();return n.indexOf("msie")!==-1||n.indexOf("trident")!==-1||n.indexOf(" edge/")!==-1}if(!i())return!1;if(!t)return!0;var s=(function(){var n,a=3,c=document.createElement("div"),r=c.getElementsByTagName("i");do c.innerHTML="<!--[if gt IE "+ ++a+"]><i></i><![endif]-->";while(r[0]);return a>4?a:n})();return t===s},e.isLegacyOpera=function(){return!!window.opera},Vr.exports}var Gr={exports:{}},Qo;function kp(){if(Qo)return Gr.exports;Qo=1;var e=Gr.exports={};e.getOption=t;function t(i,s,n){var a=i[s];return a==null&&n!==void 0?n:a}return Gr.exports}var Kr,ea;function xp(){if(ea)return Kr;ea=1;var e=kp();Kr=function(s){s=s||{};var n=s.reporter,a=e.getOption(s,"async",!0),c=e.getOption(s,"auto",!0);c&&!a&&(n&&n.warn("Invalid options combination. auto=true and async=false is invalid. Setting async=true."),a=!0);var r=t(),o,u=!1;function f(h,p){!u&&c&&a&&r.size()===0&&g(),r.add(h,p)}function l(){for(u=!0;r.size();){var h=r;r=t(),h.process()}u=!1}function m(h){u||(h===void 0&&(h=a),o&&(C(o),o=null),h?g():l())}function g(){o=v(l)}function C(h){var p=clearTimeout;return p(h)}function v(h){var p=function(_){return setTimeout(_,0)};return p(h)}return{add:f,force:m}};function t(){var i={},s=0,n=0,a=0;function c(u,f){f||(f=u,u=0),u>n?n=u:u<a&&(a=u),i[u]||(i[u]=[]),i[u].push(f),s++}function r(){for(var u=a;u<=n;u++)for(var f=i[u],l=0;l<f.length;l++){var m=f[l];m()}}function o(){return s}return{add:c,process:r,size:o}}return Kr}var Xr,ta;function Ap(){if(ta)return Xr;ta=1;var e="_erd";function t(n){return n[e]={},i(n)}function i(n){return n[e]}function s(n){delete n[e]}return Xr={initState:t,getState:i,cleanState:s},Xr}var Yr,ia;function Rp(){if(ia)return Yr;ia=1;var e=uh();return Yr=function(t){t=t||{};var i=t.reporter,s=t.batchProcessor,n=t.stateHandler.getState;if(!i)throw new Error("Missing required dependency: reporter.");function a(f,l){function m(){l(f)}if(e.isIE(8))n(f).object={proxy:m},f.attachEvent("onresize",m);else{var g=o(f);if(!g)throw new Error("Element is not detectable by this strategy.");g.contentDocument.defaultView.addEventListener("resize",m)}}function c(f){var l=t.important?" !important; ":"; ";return(f.join(l)+l).trim()}function r(f,l,m){m||(m=l,l=f,f=null),f=f||{},f.debug;function g(C,v){var h=c(["display: block","position: absolute","top: 0","left: 0","width: 100%","height: 100%","border: none","padding: 0","margin: 0","opacity: 0","z-index: -1000","pointer-events: none"]),p=!1,_=window.getComputedStyle(C),d=C.offsetWidth,y=C.offsetHeight;n(C).startSize={width:d,height:y};function S(){function w(){if(_.position==="static"){C.style.setProperty("position","relative",f.important?"important":"");var k=function(R,O,P,L){function q(re){return re.replace(/[^-\d\.]/g,"")}var J=P[L];J!=="auto"&&q(J)!=="0"&&(R.warn("An element that is positioned static has style."+L+"="+J+" which is ignored due to the static positioning. The element will need to be positioned relative, so the style."+L+" will be set to 0. Element: ",O),O.style.setProperty(L,"0",f.important?"important":""))};k(i,C,_,"top"),k(i,C,_,"right"),k(i,C,_,"bottom"),k(i,C,_,"left")}}function E(){p||w();function k(O,P){if(!O.contentDocument){var L=n(O);L.checkForObjectDocumentTimeoutId&&window.clearTimeout(L.checkForObjectDocumentTimeoutId),L.checkForObjectDocumentTimeoutId=setTimeout(function(){L.checkForObjectDocumentTimeoutId=0,k(O,P)},100);return}P(O.contentDocument)}var R=this;k(R,function(P){v(C)})}_.position!==""&&(w(),p=!0);var b=document.createElement("object");b.style.cssText=h,b.tabIndex=-1,b.type="text/html",b.setAttribute("aria-hidden","true"),b.onload=E,e.isIE()||(b.data="about:blank"),n(C)&&(C.appendChild(b),n(C).object=b,e.isIE()&&(b.data="about:blank"))}s?s.add(S):S()}e.isIE(8)?m(l):g(l,m)}function o(f){return n(f).object}function u(f){if(n(f)){var l=o(f);l&&(e.isIE(8)?f.detachEvent("onresize",l.proxy):f.removeChild(l),n(f).checkForObjectDocumentTimeoutId&&window.clearTimeout(n(f).checkForObjectDocumentTimeoutId),delete n(f).object)}}return{makeDetectable:r,addListener:a,uninstall:u}},Yr}var Jr,sa;function Tp(){if(sa)return Jr;sa=1;var e=lh().forEach;return Jr=function(t){t=t||{};var i=t.reporter,s=t.batchProcessor,n=t.stateHandler.getState;t.stateHandler.hasState;var a=t.idHandler;if(!s)throw new Error("Missing required dependency: batchProcessor");if(!i)throw new Error("Missing required dependency: reporter.");var c=l(),r="erd_scroll_detection_scrollbar_style",o="erd_scroll_detection_container";function u(S){m(S,r,o)}u(window.document);function f(S){var w=t.important?" !important; ":"; ";return(S.join(w)+w).trim()}function l(){var S=500,w=500,E=document.createElement("div");E.style.cssText=f(["position: absolute","width: "+S*2+"px","height: "+w*2+"px","visibility: hidden","margin: 0","padding: 0"]);var b=document.createElement("div");b.style.cssText=f(["position: absolute","width: "+S+"px","height: "+w+"px","overflow: scroll","visibility: none","top: "+-S*3+"px","left: "+-w*3+"px","visibility: hidden","margin: 0","padding: 0"]),b.appendChild(E),document.body.insertBefore(b,document.body.firstChild);var k=S-b.clientWidth,R=w-b.clientHeight;return document.body.removeChild(b),{width:k,height:R}}function m(S,w,E){function b(P,L){L=L||function(J){S.head.appendChild(J)};var q=S.createElement("style");return q.innerHTML=P,q.id=w,L(q),q}if(!S.getElementById(w)){var k=E+"_animation",R=E+"_animation_active",O=`/* Created by the element-resize-detector library. */
`;O+="."+E+" > div::-webkit-scrollbar { "+f(["display: none"])+` }

`,O+="."+R+" { "+f(["-webkit-animation-duration: 0.1s","animation-duration: 0.1s","-webkit-animation-name: "+k,"animation-name: "+k])+` }
`,O+="@-webkit-keyframes "+k+` { 0% { opacity: 1; } 50% { opacity: 0; } 100% { opacity: 1; } }
`,O+="@keyframes "+k+" { 0% { opacity: 1; } 50% { opacity: 0; } 100% { opacity: 1; } }",b(O)}}function g(S){S.className+=" "+o+"_animation_active"}function C(S,w,E){if(S.addEventListener)S.addEventListener(w,E);else if(S.attachEvent)S.attachEvent("on"+w,E);else return i.error("[scroll] Don't know how to add event listeners.")}function v(S,w,E){if(S.removeEventListener)S.removeEventListener(w,E);else if(S.detachEvent)S.detachEvent("on"+w,E);else return i.error("[scroll] Don't know how to remove event listeners.")}function h(S){return n(S).container.childNodes[0].childNodes[0].childNodes[0]}function p(S){return n(S).container.childNodes[0].childNodes[0].childNodes[1]}function _(S,w){var E=n(S).listeners;if(!E.push)throw new Error("Cannot add listener to an element that is not detectable.");n(S).listeners.push(w)}function d(S,w,E){E||(E=w,w=S,S=null),S=S||{};function b(){if(S.debug){var H=Array.prototype.slice.call(arguments);if(H.unshift(a.get(w),"Scroll: "),i.log.apply)i.log.apply(null,H);else for(var X=0;X<H.length;X++)i.log(H[X])}}function k(H){function X(Q){var he=Q.getRootNode&&Q.getRootNode().contains(Q);return Q===Q.ownerDocument.body||Q.ownerDocument.body.contains(Q)||he}return!X(H)||window.getComputedStyle(H)===null}function R(H){var X=n(H).container.childNodes[0],Q=window.getComputedStyle(X);return!Q.width||Q.width.indexOf("px")===-1}function O(){var H=window.getComputedStyle(w),X={};return X.position=H.position,X.width=w.offsetWidth,X.height=w.offsetHeight,X.top=H.top,X.right=H.right,X.bottom=H.bottom,X.left=H.left,X.widthCSS=H.width,X.heightCSS=H.height,X}function P(){var H=O();n(w).startSize={width:H.width,height:H.height},b("Element start size",n(w).startSize)}function L(){n(w).listeners=[]}function q(){if(b("storeStyle invoked."),!n(w)){b("Aborting because element has been uninstalled");return}var H=O();n(w).style=H}function J(H,X,Q){n(H).lastWidth=X,n(H).lastHeight=Q}function re(H){return h(H).childNodes[0]}function ie(){return 2*c.width+1}function ee(){return 2*c.height+1}function x(H){return H+10+ie()}function B(H){return H+10+ee()}function U(H){return H*2+ie()}function z(H){return H*2+ee()}function se(H,X,Q){var he=h(H),me=p(H),fe=x(X),Ae=B(Q),ue=U(X),ve=z(Q);he.scrollLeft=fe,he.scrollTop=Ae,me.scrollLeft=ue,me.scrollTop=ve}function j(){var H=n(w).container;if(!H){H=document.createElement("div"),H.className=o,H.style.cssText=f(["visibility: hidden","display: inline","width: 0px","height: 0px","z-index: -1","overflow: hidden","margin: 0","padding: 0"]),n(w).container=H,g(H),w.appendChild(H);var X=function(){n(w).onRendered&&n(w).onRendered()};C(H,"animationstart",X),n(w).onAnimationStart=X}return H}function G(){function H(){var je=n(w).style;if(je.position==="static"){w.style.setProperty("position","relative",S.important?"important":"");var rt=function(vt,De,Ui,mi){function Sr(as){return as.replace(/[^-\d\.]/g,"")}var os=Ui[mi];os!=="auto"&&Sr(os)!=="0"&&(vt.warn("An element that is positioned static has style."+mi+"="+os+" which is ignored due to the static positioning. The element will need to be positioned relative, so the style."+mi+" will be set to 0. Element: ",De),De.style[mi]=0)};rt(i,w,je,"top"),rt(i,w,je,"right"),rt(i,w,je,"bottom"),rt(i,w,je,"left")}}function X(je,rt,vt,De){return je=je?je+"px":"0",rt=rt?rt+"px":"0",vt=vt?vt+"px":"0",De=De?De+"px":"0",["left: "+je,"top: "+rt,"right: "+De,"bottom: "+vt]}if(b("Injecting elements"),!n(w)){b("Aborting because element has been uninstalled");return}H();var Q=n(w).container;Q||(Q=j());var he=c.width,me=c.height,fe=f(["position: absolute","flex: none","overflow: hidden","z-index: -1","visibility: hidden","width: 100%","height: 100%","left: 0px","top: 0px"]),Ae=f(["position: absolute","flex: none","overflow: hidden","z-index: -1","visibility: hidden"].concat(X(-(1+he),-(1+me),-me,-he))),ue=f(["position: absolute","flex: none","overflow: scroll","z-index: -1","visibility: hidden","width: 100%","height: 100%"]),ve=f(["position: absolute","flex: none","overflow: scroll","z-index: -1","visibility: hidden","width: 100%","height: 100%"]),Ie=f(["position: absolute","left: 0","top: 0"]),et=f(["position: absolute","width: 200%","height: 200%"]),$e=document.createElement("div"),tt=document.createElement("div"),He=document.createElement("div"),Ut=document.createElement("div"),ut=document.createElement("div"),Nt=document.createElement("div");$e.dir="ltr",$e.style.cssText=fe,$e.className=o,tt.className=o,tt.style.cssText=Ae,He.style.cssText=ue,Ut.style.cssText=Ie,ut.style.cssText=ve,Nt.style.cssText=et,He.appendChild(Ut),ut.appendChild(Nt),tt.appendChild(He),tt.appendChild(ut),$e.appendChild(tt),Q.appendChild($e);function oi(){var je=n(w);je&&je.onExpand?je.onExpand():b("Aborting expand scroll handler: element has been uninstalled")}function Et(){var je=n(w);je&&je.onShrink?je.onShrink():b("Aborting shrink scroll handler: element has been uninstalled")}C(He,"scroll",oi),C(ut,"scroll",Et),n(w).onExpandScroll=oi,n(w).onShrinkScroll=Et}function Y(){function H(ue,ve,Ie){var et=re(ue),$e=x(ve),tt=B(Ie);et.style.setProperty("width",$e+"px",S.important?"important":""),et.style.setProperty("height",tt+"px",S.important?"important":"")}function X(ue){var ve=w.offsetWidth,Ie=w.offsetHeight,et=ve!==n(w).lastWidth||Ie!==n(w).lastHeight;b("Storing current size",ve,Ie),J(w,ve,Ie),s.add(0,function(){if(et){if(!n(w)){b("Aborting because element has been uninstalled");return}if(!Q()){b("Aborting because element container has not been initialized");return}if(S.debug){var tt=w.offsetWidth,He=w.offsetHeight;(tt!==ve||He!==Ie)&&i.warn(a.get(w),"Scroll: Size changed before updating detector elements.")}H(w,ve,Ie)}}),s.add(1,function(){if(!n(w)){b("Aborting because element has been uninstalled");return}if(!Q()){b("Aborting because element container has not been initialized");return}se(w,ve,Ie)}),et&&ue&&s.add(2,function(){if(!n(w)){b("Aborting because element has been uninstalled");return}if(!Q()){b("Aborting because element container has not been initialized");return}ue()})}function Q(){return!!n(w).container}function he(){function ue(){return n(w).lastNotifiedWidth===void 0}b("notifyListenersIfNeeded invoked");var ve=n(w);if(ue()&&ve.lastWidth===ve.startSize.width&&ve.lastHeight===ve.startSize.height)return b("Not notifying: Size is the same as the start size, and there has been no notification yet.");if(ve.lastWidth===ve.lastNotifiedWidth&&ve.lastHeight===ve.lastNotifiedHeight)return b("Not notifying: Size already notified");b("Current size not notified, notifying..."),ve.lastNotifiedWidth=ve.lastWidth,ve.lastNotifiedHeight=ve.lastHeight,e(n(w).listeners,function(Ie){Ie(w)})}function me(){if(b("startanimation triggered."),R(w)){b("Ignoring since element is still unrendered...");return}b("Element rendered.");var ue=h(w),ve=p(w);(ue.scrollLeft===0||ue.scrollTop===0||ve.scrollLeft===0||ve.scrollTop===0)&&(b("Scrollbars out of sync. Updating detector elements..."),X(he))}function fe(){if(b("Scroll detected."),R(w)){b("Scroll event fired while unrendered. Ignoring...");return}X(he)}if(b("registerListenersAndPositionElements invoked."),!n(w)){b("Aborting because element has been uninstalled");return}n(w).onRendered=me,n(w).onExpand=fe,n(w).onShrink=fe;var Ae=n(w).style;H(w,Ae.width,Ae.height)}function M(){if(b("finalizeDomMutation invoked."),!n(w)){b("Aborting because element has been uninstalled");return}var H=n(w).style;J(w,H.width,H.height),se(w,H.width,H.height)}function T(){E(w)}function K(){b("Installing..."),L(),P(),s.add(0,q),s.add(1,G),s.add(2,Y),s.add(3,M),s.add(4,T)}b("Making detectable..."),k(w)?(b("Element is detached"),j(),b("Waiting until element is attached..."),n(w).onRendered=function(){b("Element is now attached"),K()}):K()}function y(S){var w=n(S);w&&(w.onExpandScroll&&v(h(S),"scroll",w.onExpandScroll),w.onShrinkScroll&&v(p(S),"scroll",w.onShrinkScroll),w.onAnimationStart&&v(w.container,"animationstart",w.onAnimationStart),w.container&&S.removeChild(w.container))}return{makeDetectable:d,addListener:_,uninstall:y,initDocument:u}},Jr}var Zr,ra;function Lp(){if(ra)return Zr;ra=1;var e=lh().forEach,t=bp(),i=wp(),s=Sp(),n=Cp(),a=Ep(),c=uh(),r=xp(),o=Ap(),u=Rp(),f=Tp();function l(v){return Array.isArray(v)||v.length!==void 0}function m(v){if(Array.isArray(v))return v;var h=[];return e(v,function(p){h.push(p)}),h}function g(v){return v&&v.nodeType===1}Zr=function(v){v=v||{};var h;if(v.idHandler)h={get:function(ie){return v.idHandler.get(ie,!0)},set:v.idHandler.set};else{var p=s(),_=n({idGenerator:p,stateHandler:o});h=_}var d=v.reporter;if(!d){var y=d===!1;d=a(y)}var S=C(v,"batchProcessor",r({reporter:d})),w={};w.callOnAdd=!!C(v,"callOnAdd",!0),w.debug=!!C(v,"debug",!1);var E=i(h),b=t({stateHandler:o}),k,R=C(v,"strategy","object"),O=C(v,"important",!1),P={reporter:d,batchProcessor:S,stateHandler:o,idHandler:h,important:O};if(R==="scroll"&&(c.isLegacyOpera()?(d.warn("Scroll strategy is not supported on legacy Opera. Changing to object strategy."),R="object"):c.isIE(9)&&(d.warn("Scroll strategy is not supported on IE9. Changing to object strategy."),R="object")),R==="scroll")k=f(P);else if(R==="object")k=u(P);else throw new Error("Invalid strategy name: "+R);var L={};function q(ie,ee,x){function B(Y){var M=E.get(Y);e(M,function(K){K(Y)})}function U(Y,M,T){E.add(M,T),Y&&T(M)}if(x||(x=ee,ee=ie,ie={}),!ee)throw new Error("At least one element required.");if(!x)throw new Error("Listener required.");if(g(ee))ee=[ee];else if(l(ee))ee=m(ee);else return d.error("Invalid arguments. Must be a DOM element or a collection of DOM elements.");var z=0,se=C(ie,"callOnAdd",w.callOnAdd),j=C(ie,"onReady",function(){}),G=C(ie,"debug",w.debug);e(ee,function(M){o.getState(M)||(o.initState(M),h.set(M));var T=h.get(M);if(G&&d.log("Attaching listener to element",T,M),!b.isDetectable(M)){if(G&&d.log(T,"Not detectable."),b.isBusy(M)){G&&d.log(T,"System busy making it detectable"),U(se,M,x),L[T]=L[T]||[],L[T].push(function(){z++,z===ee.length&&j()});return}return G&&d.log(T,"Making detectable..."),b.markBusy(M,!0),k.makeDetectable({debug:G,important:O},M,function(H){if(G&&d.log(T,"onElementDetectable"),o.getState(H)){b.markAsDetectable(H),b.markBusy(H,!1),k.addListener(H,B),U(se,H,x);var X=o.getState(H);if(X&&X.startSize){var Q=H.offsetWidth,he=H.offsetHeight;(X.startSize.width!==Q||X.startSize.height!==he)&&B(H)}L[T]&&e(L[T],function(me){me()})}else G&&d.log(T,"Element uninstalled before being detectable.");delete L[T],z++,z===ee.length&&j()})}G&&d.log(T,"Already detecable, adding listener."),U(se,M,x),z++}),z===ee.length&&j()}function J(ie){if(!ie)return d.error("At least one element is required.");if(g(ie))ie=[ie];else if(l(ie))ie=m(ie);else return d.error("Invalid arguments. Must be a DOM element or a collection of DOM elements.");e(ie,function(ee){E.removeAllListeners(ee),k.uninstall(ee),o.cleanState(ee)})}function re(ie){k.initDocument&&k.initDocument(ie)}return{listenTo:q,removeListener:E.removeListener,removeAllListeners:E.removeAllListeners,uninstall:J,initDocument:re}};function C(v,h,p){var _=v[h];return _==null&&p!==void 0?p:_}return Zr}var Dp=Lp();const Op=ch(Dp);var Gs=Op({strategy:"scroll"});function Ip(e,t){Gs.listenTo(e,t);var i=t;return{update:function(s){Gs.removeListener(e,i),Gs.listenTo(e,s),i=s},destroy:function(){Gs.removeListener(e,i)}}}var Qr={exports:{}},na;function Pp(){return na||(na=1,(function(e,t){(function(i,s){e.exports=s()})(self,(()=>(()=>{var i={};return(()=>{var s=i;Object.defineProperty(s,"__esModule",{value:!0}),s.FitAddon=void 0,s.FitAddon=class{activate(n){this._terminal=n}dispose(){}fit(){const n=this.proposeDimensions();if(!n||!this._terminal||isNaN(n.cols)||isNaN(n.rows))return;const a=this._terminal._core;this._terminal.rows===n.rows&&this._terminal.cols===n.cols||(a._renderService.clear(),this._terminal.resize(n.cols,n.rows))}proposeDimensions(){if(!this._terminal||!this._terminal.element||!this._terminal.element.parentElement)return;const n=this._terminal._core,a=n._renderService.dimensions;if(a.css.cell.width===0||a.css.cell.height===0)return;const c=this._terminal.options.scrollback===0?0:n.viewport.scrollBarWidth,r=window.getComputedStyle(this._terminal.element.parentElement),o=parseInt(r.getPropertyValue("height")),u=Math.max(0,parseInt(r.getPropertyValue("width"))),f=window.getComputedStyle(this._terminal.element),l=o-(parseInt(f.getPropertyValue("padding-top"))+parseInt(f.getPropertyValue("padding-bottom"))),m=u-(parseInt(f.getPropertyValue("padding-right"))+parseInt(f.getPropertyValue("padding-left")))-c;return{cols:Math.max(2,Math.floor(m/a.css.cell.width)),rows:Math.max(1,Math.floor(l/a.css.cell.height))}}}})(),i})()))})(Qr)),Qr.exports}var Mp=Pp(),en={exports:{}},oa;function Bp(){return oa||(oa=1,(function(e,t){(function(i,s){e.exports=s()})(self,(()=>(()=>{var i={6:(c,r)=>{function o(f){try{const l=new URL(f),m=l.password&&l.username?`${l.protocol}//${l.username}:${l.password}@${l.host}`:l.username?`${l.protocol}//${l.username}@${l.host}`:`${l.protocol}//${l.host}`;return f.toLocaleLowerCase().startsWith(m.toLocaleLowerCase())}catch{return!1}}Object.defineProperty(r,"__esModule",{value:!0}),r.LinkComputer=r.WebLinkProvider=void 0,r.WebLinkProvider=class{constructor(f,l,m,g={}){this._terminal=f,this._regex=l,this._handler=m,this._options=g}provideLinks(f,l){const m=u.computeLink(f,this._regex,this._terminal,this._handler);l(this._addCallbacks(m))}_addCallbacks(f){return f.map((l=>(l.leave=this._options.leave,l.hover=(m,g)=>{if(this._options.hover){const{range:C}=l;this._options.hover(m,g,C)}},l)))}};class u{static computeLink(l,m,g,C){const v=new RegExp(m.source,(m.flags||"")+"g"),[h,p]=u._getWindowedLineStrings(l-1,g),_=h.join("");let d;const y=[];for(;d=v.exec(_);){const S=d[0];if(!o(S))continue;const[w,E]=u._mapStrIdx(g,p,0,d.index),[b,k]=u._mapStrIdx(g,w,E,S.length);if(w===-1||E===-1||b===-1||k===-1)continue;const R={start:{x:E+1,y:w+1},end:{x:k,y:b+1}};y.push({range:R,text:S,activate:C})}return y}static _getWindowedLineStrings(l,m){let g,C=l,v=l,h=0,p="";const _=[];if(g=m.buffer.active.getLine(l)){const d=g.translateToString(!0);if(g.isWrapped&&d[0]!==" "){for(h=0;(g=m.buffer.active.getLine(--C))&&h<2048&&(p=g.translateToString(!0),h+=p.length,_.push(p),g.isWrapped&&p.indexOf(" ")===-1););_.reverse()}for(_.push(d),h=0;(g=m.buffer.active.getLine(++v))&&g.isWrapped&&h<2048&&(p=g.translateToString(!0),h+=p.length,_.push(p),p.indexOf(" ")===-1););}return[_,C]}static _mapStrIdx(l,m,g,C){const v=l.buffer.active,h=v.getNullCell();let p=g;for(;C;){const _=v.getLine(m);if(!_)return[-1,-1];for(let d=p;d<_.length;++d){_.getCell(d,h);const y=h.getChars();if(h.getWidth()&&(C-=y.length||1,d===_.length-1&&y==="")){const S=v.getLine(m+1);S&&S.isWrapped&&(S.getCell(0,h),h.getWidth()===2&&(C+=1))}if(C<0)return[m,d]}m++,p=0}return[m,p]}}r.LinkComputer=u}},s={};function n(c){var r=s[c];if(r!==void 0)return r.exports;var o=s[c]={exports:{}};return i[c](o,o.exports,n),o.exports}var a={};return(()=>{var c=a;Object.defineProperty(c,"__esModule",{value:!0}),c.WebLinksAddon=void 0;const r=n(6),o=/(https?|HTTPS?):[/]{2}[^\s"'!*(){}|\\\^<>`]*[^\s"':,.!?{}|\\\^~\[\]`()<>]/;function u(f,l){const m=window.open();if(m){try{m.opener=null}catch{}m.location.href=l}else console.warn("Opening link blocked as opener could not be cleared")}c.WebLinksAddon=class{constructor(f=u,l={}){this._handler=f,this._options=l}activate(f){this._terminal=f;const l=this._options,m=l.urlRegex||o;this._linkProvider=this._terminal.registerLinkProvider(new r.WebLinkProvider(this._terminal,m,this._handler,l))}dispose(){this._linkProvider?.dispose()}}})(),a})()))})(en)),en.exports}var Up=Bp(),Qs={exports:{}},Np=Qs.exports,aa;function Fp(){return aa||(aa=1,(function(e,t){(function(i,s){e.exports=s()})(Np,(()=>(()=>{var i={930:(c,r,o)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.ColorContrastCache=void 0;const u=o(485);r.ColorContrastCache=class{constructor(){this._color=new u.TwoKeyMap,this._css=new u.TwoKeyMap}setCss(f,l,m){this._css.set(f,l,m)}getCss(f,l){return this._css.get(f,l)}setColor(f,l,m){this._color.set(f,l,m)}getColor(f,l){return this._color.get(f,l)}clear(){this._color.clear(),this._css.clear()}}},997:function(c,r,o){var u=this&&this.__decorate||function(E,b,k,R){var O,P=arguments.length,L=P<3?b:R===null?R=Object.getOwnPropertyDescriptor(b,k):R;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")L=Reflect.decorate(E,b,k,R);else for(var q=E.length-1;q>=0;q--)(O=E[q])&&(L=(P<3?O(L):P>3?O(b,k,L):O(b,k))||L);return P>3&&L&&Object.defineProperty(b,k,L),L},f=this&&this.__param||function(E,b){return function(k,R){b(k,R,E)}};Object.defineProperty(r,"__esModule",{value:!0}),r.ThemeService=r.DEFAULT_ANSI_COLORS=void 0;const l=o(930),m=o(160),g=o(345),C=o(859),v=o(97),h=m.css.toColor("#ffffff"),p=m.css.toColor("#000000"),_=m.css.toColor("#ffffff"),d=m.css.toColor("#000000"),y={css:"rgba(255, 255, 255, 0.3)",rgba:4294967117};r.DEFAULT_ANSI_COLORS=Object.freeze((()=>{const E=[m.css.toColor("#2e3436"),m.css.toColor("#cc0000"),m.css.toColor("#4e9a06"),m.css.toColor("#c4a000"),m.css.toColor("#3465a4"),m.css.toColor("#75507b"),m.css.toColor("#06989a"),m.css.toColor("#d3d7cf"),m.css.toColor("#555753"),m.css.toColor("#ef2929"),m.css.toColor("#8ae234"),m.css.toColor("#fce94f"),m.css.toColor("#729fcf"),m.css.toColor("#ad7fa8"),m.css.toColor("#34e2e2"),m.css.toColor("#eeeeec")],b=[0,95,135,175,215,255];for(let k=0;k<216;k++){const R=b[k/36%6|0],O=b[k/6%6|0],P=b[k%6];E.push({css:m.channels.toCss(R,O,P),rgba:m.channels.toRgba(R,O,P)})}for(let k=0;k<24;k++){const R=8+10*k;E.push({css:m.channels.toCss(R,R,R),rgba:m.channels.toRgba(R,R,R)})}return E})());let S=r.ThemeService=class extends C.Disposable{get colors(){return this._colors}constructor(E){super(),this._optionsService=E,this._contrastCache=new l.ColorContrastCache,this._halfContrastCache=new l.ColorContrastCache,this._onChangeColors=this.register(new g.EventEmitter),this.onChangeColors=this._onChangeColors.event,this._colors={foreground:h,background:p,cursor:_,cursorAccent:d,selectionForeground:void 0,selectionBackgroundTransparent:y,selectionBackgroundOpaque:m.color.blend(p,y),selectionInactiveBackgroundTransparent:y,selectionInactiveBackgroundOpaque:m.color.blend(p,y),ansi:r.DEFAULT_ANSI_COLORS.slice(),contrastCache:this._contrastCache,halfContrastCache:this._halfContrastCache},this._updateRestoreColors(),this._setTheme(this._optionsService.rawOptions.theme),this.register(this._optionsService.onSpecificOptionChange("minimumContrastRatio",(()=>this._contrastCache.clear()))),this.register(this._optionsService.onSpecificOptionChange("theme",(()=>this._setTheme(this._optionsService.rawOptions.theme))))}_setTheme(E={}){const b=this._colors;if(b.foreground=w(E.foreground,h),b.background=w(E.background,p),b.cursor=w(E.cursor,_),b.cursorAccent=w(E.cursorAccent,d),b.selectionBackgroundTransparent=w(E.selectionBackground,y),b.selectionBackgroundOpaque=m.color.blend(b.background,b.selectionBackgroundTransparent),b.selectionInactiveBackgroundTransparent=w(E.selectionInactiveBackground,b.selectionBackgroundTransparent),b.selectionInactiveBackgroundOpaque=m.color.blend(b.background,b.selectionInactiveBackgroundTransparent),b.selectionForeground=E.selectionForeground?w(E.selectionForeground,m.NULL_COLOR):void 0,b.selectionForeground===m.NULL_COLOR&&(b.selectionForeground=void 0),m.color.isOpaque(b.selectionBackgroundTransparent)&&(b.selectionBackgroundTransparent=m.color.opacity(b.selectionBackgroundTransparent,.3)),m.color.isOpaque(b.selectionInactiveBackgroundTransparent)&&(b.selectionInactiveBackgroundTransparent=m.color.opacity(b.selectionInactiveBackgroundTransparent,.3)),b.ansi=r.DEFAULT_ANSI_COLORS.slice(),b.ansi[0]=w(E.black,r.DEFAULT_ANSI_COLORS[0]),b.ansi[1]=w(E.red,r.DEFAULT_ANSI_COLORS[1]),b.ansi[2]=w(E.green,r.DEFAULT_ANSI_COLORS[2]),b.ansi[3]=w(E.yellow,r.DEFAULT_ANSI_COLORS[3]),b.ansi[4]=w(E.blue,r.DEFAULT_ANSI_COLORS[4]),b.ansi[5]=w(E.magenta,r.DEFAULT_ANSI_COLORS[5]),b.ansi[6]=w(E.cyan,r.DEFAULT_ANSI_COLORS[6]),b.ansi[7]=w(E.white,r.DEFAULT_ANSI_COLORS[7]),b.ansi[8]=w(E.brightBlack,r.DEFAULT_ANSI_COLORS[8]),b.ansi[9]=w(E.brightRed,r.DEFAULT_ANSI_COLORS[9]),b.ansi[10]=w(E.brightGreen,r.DEFAULT_ANSI_COLORS[10]),b.ansi[11]=w(E.brightYellow,r.DEFAULT_ANSI_COLORS[11]),b.ansi[12]=w(E.brightBlue,r.DEFAULT_ANSI_COLORS[12]),b.ansi[13]=w(E.brightMagenta,r.DEFAULT_ANSI_COLORS[13]),b.ansi[14]=w(E.brightCyan,r.DEFAULT_ANSI_COLORS[14]),b.ansi[15]=w(E.brightWhite,r.DEFAULT_ANSI_COLORS[15]),E.extendedAnsi){const k=Math.min(b.ansi.length-16,E.extendedAnsi.length);for(let R=0;R<k;R++)b.ansi[R+16]=w(E.extendedAnsi[R],r.DEFAULT_ANSI_COLORS[R+16])}this._contrastCache.clear(),this._halfContrastCache.clear(),this._updateRestoreColors(),this._onChangeColors.fire(this.colors)}restoreColor(E){this._restoreColor(E),this._onChangeColors.fire(this.colors)}_restoreColor(E){if(E!==void 0)switch(E){case 256:this._colors.foreground=this._restoreColors.foreground;break;case 257:this._colors.background=this._restoreColors.background;break;case 258:this._colors.cursor=this._restoreColors.cursor;break;default:this._colors.ansi[E]=this._restoreColors.ansi[E]}else for(let b=0;b<this._restoreColors.ansi.length;++b)this._colors.ansi[b]=this._restoreColors.ansi[b]}modifyColors(E){E(this._colors),this._onChangeColors.fire(this.colors)}_updateRestoreColors(){this._restoreColors={foreground:this._colors.foreground,background:this._colors.background,cursor:this._colors.cursor,ansi:this._colors.ansi.slice()}}};function w(E,b){if(E!==void 0)try{return m.css.toColor(E)}catch{}return b}r.ThemeService=S=u([f(0,v.IOptionsService)],S)},160:(c,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.contrastRatio=r.toPaddedHex=r.rgba=r.rgb=r.css=r.color=r.channels=r.NULL_COLOR=void 0;let o=0,u=0,f=0,l=0;var m,g,C,v,h;function p(d){const y=d.toString(16);return y.length<2?"0"+y:y}function _(d,y){return d<y?(y+.05)/(d+.05):(d+.05)/(y+.05)}r.NULL_COLOR={css:"#00000000",rgba:0},(function(d){d.toCss=function(y,S,w,E){return E!==void 0?`#${p(y)}${p(S)}${p(w)}${p(E)}`:`#${p(y)}${p(S)}${p(w)}`},d.toRgba=function(y,S,w,E=255){return(y<<24|S<<16|w<<8|E)>>>0},d.toColor=function(y,S,w,E){return{css:d.toCss(y,S,w,E),rgba:d.toRgba(y,S,w,E)}}})(m||(r.channels=m={})),(function(d){function y(S,w){return l=Math.round(255*w),[o,u,f]=h.toChannels(S.rgba),{css:m.toCss(o,u,f,l),rgba:m.toRgba(o,u,f,l)}}d.blend=function(S,w){if(l=(255&w.rgba)/255,l===1)return{css:w.css,rgba:w.rgba};const E=w.rgba>>24&255,b=w.rgba>>16&255,k=w.rgba>>8&255,R=S.rgba>>24&255,O=S.rgba>>16&255,P=S.rgba>>8&255;return o=R+Math.round((E-R)*l),u=O+Math.round((b-O)*l),f=P+Math.round((k-P)*l),{css:m.toCss(o,u,f),rgba:m.toRgba(o,u,f)}},d.isOpaque=function(S){return(255&S.rgba)==255},d.ensureContrastRatio=function(S,w,E){const b=h.ensureContrastRatio(S.rgba,w.rgba,E);if(b)return m.toColor(b>>24&255,b>>16&255,b>>8&255)},d.opaque=function(S){const w=(255|S.rgba)>>>0;return[o,u,f]=h.toChannels(w),{css:m.toCss(o,u,f),rgba:w}},d.opacity=y,d.multiplyOpacity=function(S,w){return l=255&S.rgba,y(S,l*w/255)},d.toColorRGB=function(S){return[S.rgba>>24&255,S.rgba>>16&255,S.rgba>>8&255]}})(g||(r.color=g={})),(function(d){let y,S;try{const w=document.createElement("canvas");w.width=1,w.height=1;const E=w.getContext("2d",{willReadFrequently:!0});E&&(y=E,y.globalCompositeOperation="copy",S=y.createLinearGradient(0,0,1,1))}catch{}d.toColor=function(w){if(w.match(/#[\da-f]{3,8}/i))switch(w.length){case 4:return o=parseInt(w.slice(1,2).repeat(2),16),u=parseInt(w.slice(2,3).repeat(2),16),f=parseInt(w.slice(3,4).repeat(2),16),m.toColor(o,u,f);case 5:return o=parseInt(w.slice(1,2).repeat(2),16),u=parseInt(w.slice(2,3).repeat(2),16),f=parseInt(w.slice(3,4).repeat(2),16),l=parseInt(w.slice(4,5).repeat(2),16),m.toColor(o,u,f,l);case 7:return{css:w,rgba:(parseInt(w.slice(1),16)<<8|255)>>>0};case 9:return{css:w,rgba:parseInt(w.slice(1),16)>>>0}}const E=w.match(/rgba?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(,\s*(0|1|\d?\.(\d+))\s*)?\)/);if(E)return o=parseInt(E[1]),u=parseInt(E[2]),f=parseInt(E[3]),l=Math.round(255*(E[5]===void 0?1:parseFloat(E[5]))),m.toColor(o,u,f,l);if(!y||!S)throw new Error("css.toColor: Unsupported css format");if(y.fillStyle=S,y.fillStyle=w,typeof y.fillStyle!="string")throw new Error("css.toColor: Unsupported css format");if(y.fillRect(0,0,1,1),[o,u,f,l]=y.getImageData(0,0,1,1).data,l!==255)throw new Error("css.toColor: Unsupported css format");return{rgba:m.toRgba(o,u,f,l),css:w}}})(C||(r.css=C={})),(function(d){function y(S,w,E){const b=S/255,k=w/255,R=E/255;return .2126*(b<=.03928?b/12.92:Math.pow((b+.055)/1.055,2.4))+.7152*(k<=.03928?k/12.92:Math.pow((k+.055)/1.055,2.4))+.0722*(R<=.03928?R/12.92:Math.pow((R+.055)/1.055,2.4))}d.relativeLuminance=function(S){return y(S>>16&255,S>>8&255,255&S)},d.relativeLuminance2=y})(v||(r.rgb=v={})),(function(d){function y(w,E,b){const k=w>>24&255,R=w>>16&255,O=w>>8&255;let P=E>>24&255,L=E>>16&255,q=E>>8&255,J=_(v.relativeLuminance2(P,L,q),v.relativeLuminance2(k,R,O));for(;J<b&&(P>0||L>0||q>0);)P-=Math.max(0,Math.ceil(.1*P)),L-=Math.max(0,Math.ceil(.1*L)),q-=Math.max(0,Math.ceil(.1*q)),J=_(v.relativeLuminance2(P,L,q),v.relativeLuminance2(k,R,O));return(P<<24|L<<16|q<<8|255)>>>0}function S(w,E,b){const k=w>>24&255,R=w>>16&255,O=w>>8&255;let P=E>>24&255,L=E>>16&255,q=E>>8&255,J=_(v.relativeLuminance2(P,L,q),v.relativeLuminance2(k,R,O));for(;J<b&&(P<255||L<255||q<255);)P=Math.min(255,P+Math.ceil(.1*(255-P))),L=Math.min(255,L+Math.ceil(.1*(255-L))),q=Math.min(255,q+Math.ceil(.1*(255-q))),J=_(v.relativeLuminance2(P,L,q),v.relativeLuminance2(k,R,O));return(P<<24|L<<16|q<<8|255)>>>0}d.blend=function(w,E){if(l=(255&E)/255,l===1)return E;const b=E>>24&255,k=E>>16&255,R=E>>8&255,O=w>>24&255,P=w>>16&255,L=w>>8&255;return o=O+Math.round((b-O)*l),u=P+Math.round((k-P)*l),f=L+Math.round((R-L)*l),m.toRgba(o,u,f)},d.ensureContrastRatio=function(w,E,b){const k=v.relativeLuminance(w>>8),R=v.relativeLuminance(E>>8);if(_(k,R)<b){if(R<k){const L=y(w,E,b),q=_(k,v.relativeLuminance(L>>8));if(q<b){const J=S(w,E,b);return q>_(k,v.relativeLuminance(J>>8))?L:J}return L}const O=S(w,E,b),P=_(k,v.relativeLuminance(O>>8));if(P<b){const L=y(w,E,b);return P>_(k,v.relativeLuminance(L>>8))?O:L}return O}},d.reduceLuminance=y,d.increaseLuminance=S,d.toChannels=function(w){return[w>>24&255,w>>16&255,w>>8&255,255&w]}})(h||(r.rgba=h={})),r.toPaddedHex=p,r.contrastRatio=_},345:(c,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.runAndSubscribe=r.forwardEvent=r.EventEmitter=void 0,r.EventEmitter=class{constructor(){this._listeners=[],this._disposed=!1}get event(){return this._event||(this._event=o=>(this._listeners.push(o),{dispose:()=>{if(!this._disposed){for(let u=0;u<this._listeners.length;u++)if(this._listeners[u]===o)return void this._listeners.splice(u,1)}}})),this._event}fire(o,u){const f=[];for(let l=0;l<this._listeners.length;l++)f.push(this._listeners[l]);for(let l=0;l<f.length;l++)f[l].call(void 0,o,u)}dispose(){this.clearListeners(),this._disposed=!0}clearListeners(){this._listeners&&(this._listeners.length=0)}},r.forwardEvent=function(o,u){return o((f=>u.fire(f)))},r.runAndSubscribe=function(o,u){return u(void 0),o((f=>u(f)))}},859:(c,r)=>{function o(u){for(const f of u)f.dispose();u.length=0}Object.defineProperty(r,"__esModule",{value:!0}),r.getDisposeArrayDisposable=r.disposeArray=r.toDisposable=r.MutableDisposable=r.Disposable=void 0,r.Disposable=class{constructor(){this._disposables=[],this._isDisposed=!1}dispose(){this._isDisposed=!0;for(const u of this._disposables)u.dispose();this._disposables.length=0}register(u){return this._disposables.push(u),u}unregister(u){const f=this._disposables.indexOf(u);f!==-1&&this._disposables.splice(f,1)}},r.MutableDisposable=class{constructor(){this._isDisposed=!1}get value(){return this._isDisposed?void 0:this._value}set value(u){this._isDisposed||u===this._value||(this._value?.dispose(),this._value=u)}clear(){this.value=void 0}dispose(){this._isDisposed=!0,this._value?.dispose(),this._value=void 0}},r.toDisposable=function(u){return{dispose:u}},r.disposeArray=o,r.getDisposeArrayDisposable=function(u){return{dispose:()=>o(u)}}},485:(c,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.FourKeyMap=r.TwoKeyMap=void 0;class o{constructor(){this._data={}}set(f,l,m){this._data[f]||(this._data[f]={}),this._data[f][l]=m}get(f,l){return this._data[f]?this._data[f][l]:void 0}clear(){this._data={}}}r.TwoKeyMap=o,r.FourKeyMap=class{constructor(){this._data=new o}set(u,f,l,m,g){this._data.get(u,f)||this._data.set(u,f,new o),this._data.get(u,f).set(l,m,g)}get(u,f,l,m){return this._data.get(u,f)?.get(l,m)}clear(){this._data.clear()}}},726:(c,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.createDecorator=r.getServiceDependencies=r.serviceRegistry=void 0;const o="di$target",u="di$dependencies";r.serviceRegistry=new Map,r.getServiceDependencies=function(f){return f[u]||[]},r.createDecorator=function(f){if(r.serviceRegistry.has(f))return r.serviceRegistry.get(f);const l=function(m,g,C){if(arguments.length!==3)throw new Error("@IServiceName-decorator can only be used to decorate a parameter");(function(v,h,p){h[o]===h?h[u].push({id:v,index:p}):(h[u]=[{id:v,index:p}],h[o]=h)})(l,m,C)};return l.toString=()=>f,r.serviceRegistry.set(f,l),l}},97:(c,r,o)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.IDecorationService=r.IUnicodeService=r.IOscLinkService=r.IOptionsService=r.ILogService=r.LogLevelEnum=r.IInstantiationService=r.ICharsetService=r.ICoreService=r.ICoreMouseService=r.IBufferService=void 0;const u=o(726);var f;r.IBufferService=(0,u.createDecorator)("BufferService"),r.ICoreMouseService=(0,u.createDecorator)("CoreMouseService"),r.ICoreService=(0,u.createDecorator)("CoreService"),r.ICharsetService=(0,u.createDecorator)("CharsetService"),r.IInstantiationService=(0,u.createDecorator)("InstantiationService"),(function(l){l[l.TRACE=0]="TRACE",l[l.DEBUG=1]="DEBUG",l[l.INFO=2]="INFO",l[l.WARN=3]="WARN",l[l.ERROR=4]="ERROR",l[l.OFF=5]="OFF"})(f||(r.LogLevelEnum=f={})),r.ILogService=(0,u.createDecorator)("LogService"),r.IOptionsService=(0,u.createDecorator)("OptionsService"),r.IOscLinkService=(0,u.createDecorator)("OscLinkService"),r.IUnicodeService=(0,u.createDecorator)("UnicodeService"),r.IDecorationService=(0,u.createDecorator)("DecorationService")}},s={};function n(c){var r=s[c];if(r!==void 0)return r.exports;var o=s[c]={exports:{}};return i[c].call(o.exports,o,o.exports,n),o.exports}var a={};return(()=>{var c=a;Object.defineProperty(c,"__esModule",{value:!0}),c.HTMLSerializeHandler=c.SerializeAddon=void 0;const r=n(997);function o(v,h,p){return Math.max(h,Math.min(v,p))}class u{constructor(h){this._buffer=h}serialize(h,p){const _=this._buffer.getNullCell(),d=this._buffer.getNullCell();let y=_;const S=h.start.y,w=h.end.y,E=h.start.x,b=h.end.x;this._beforeSerialize(w-S,S,w);for(let k=S;k<=w;k++){const R=this._buffer.getLine(k);if(R){const O=k===h.start.y?E:0,P=k===h.end.y?b:R.length;for(let L=O;L<P;L++){const q=R.getCell(L,y===_?d:_);q?(this._nextCell(q,y,k,L),y=q):console.warn(`Can't get cell at row=${k}, col=${L}`)}}this._rowEnd(k,k===w)}return this._afterSerialize(),this._serializeString(p)}_nextCell(h,p,_,d){}_rowEnd(h,p){}_beforeSerialize(h,p,_){}_afterSerialize(){}_serializeString(h){return""}}function f(v,h){return v.getFgColorMode()===h.getFgColorMode()&&v.getFgColor()===h.getFgColor()}function l(v,h){return v.getBgColorMode()===h.getBgColorMode()&&v.getBgColor()===h.getBgColor()}function m(v,h){return v.isInverse()===h.isInverse()&&v.isBold()===h.isBold()&&v.isUnderline()===h.isUnderline()&&v.isOverline()===h.isOverline()&&v.isBlink()===h.isBlink()&&v.isInvisible()===h.isInvisible()&&v.isItalic()===h.isItalic()&&v.isDim()===h.isDim()&&v.isStrikethrough()===h.isStrikethrough()}class g extends u{constructor(h,p){super(h),this._terminal=p,this._rowIndex=0,this._allRows=new Array,this._allRowSeparators=new Array,this._currentRow="",this._nullCellCount=0,this._cursorStyle=this._buffer.getNullCell(),this._cursorStyleRow=0,this._cursorStyleCol=0,this._backgroundCell=this._buffer.getNullCell(),this._firstRow=0,this._lastCursorRow=0,this._lastCursorCol=0,this._lastContentCursorRow=0,this._lastContentCursorCol=0,this._thisRowLastChar=this._buffer.getNullCell(),this._thisRowLastSecondChar=this._buffer.getNullCell(),this._nextRowFirstChar=this._buffer.getNullCell()}_beforeSerialize(h,p,_){this._allRows=new Array(h),this._lastContentCursorRow=p,this._lastCursorRow=p,this._firstRow=p}_rowEnd(h,p){this._nullCellCount>0&&!l(this._cursorStyle,this._backgroundCell)&&(this._currentRow+=`\x1B[${this._nullCellCount}X`);let _="";if(!p){h-this._firstRow>=this._terminal.rows&&this._buffer.getLine(this._cursorStyleRow)?.getCell(this._cursorStyleCol,this._backgroundCell);const d=this._buffer.getLine(h),y=this._buffer.getLine(h+1);if(y.isWrapped){_="";const S=d.getCell(d.length-1,this._thisRowLastChar),w=d.getCell(d.length-2,this._thisRowLastSecondChar),E=y.getCell(0,this._nextRowFirstChar),b=E.getWidth()>1;let k=!1;(E.getChars()&&b?this._nullCellCount<=1:this._nullCellCount<=0)&&((S.getChars()||S.getWidth()===0)&&l(S,E)&&(k=!0),b&&(w.getChars()||w.getWidth()===0)&&l(S,E)&&l(w,E)&&(k=!0)),k||(_="-".repeat(this._nullCellCount+1),_+="\x1B[1D\x1B[1X",this._nullCellCount>0&&(_+="\x1B[A",_+=`\x1B[${d.length-this._nullCellCount}C`,_+=`\x1B[${this._nullCellCount}X`,_+=`\x1B[${d.length-this._nullCellCount}D`,_+="\x1B[B"),this._lastContentCursorRow=h+1,this._lastContentCursorCol=0,this._lastCursorRow=h+1,this._lastCursorCol=0)}else _=`\r
`,this._lastCursorRow=h+1,this._lastCursorCol=0}this._allRows[this._rowIndex]=this._currentRow,this._allRowSeparators[this._rowIndex++]=_,this._currentRow="",this._nullCellCount=0}_diffStyle(h,p){const _=[],d=!f(h,p),y=!l(h,p),S=!m(h,p);if(d||y||S)if(h.isAttributeDefault())p.isAttributeDefault()||_.push(0);else{if(d){const w=h.getFgColor();h.isFgRGB()?_.push(38,2,w>>>16&255,w>>>8&255,255&w):h.isFgPalette()?w>=16?_.push(38,5,w):_.push(8&w?90+(7&w):30+(7&w)):_.push(39)}if(y){const w=h.getBgColor();h.isBgRGB()?_.push(48,2,w>>>16&255,w>>>8&255,255&w):h.isBgPalette()?w>=16?_.push(48,5,w):_.push(8&w?100+(7&w):40+(7&w)):_.push(49)}S&&(h.isInverse()!==p.isInverse()&&_.push(h.isInverse()?7:27),h.isBold()!==p.isBold()&&_.push(h.isBold()?1:22),h.isUnderline()!==p.isUnderline()&&_.push(h.isUnderline()?4:24),h.isOverline()!==p.isOverline()&&_.push(h.isOverline()?53:55),h.isBlink()!==p.isBlink()&&_.push(h.isBlink()?5:25),h.isInvisible()!==p.isInvisible()&&_.push(h.isInvisible()?8:28),h.isItalic()!==p.isItalic()&&_.push(h.isItalic()?3:23),h.isDim()!==p.isDim()&&_.push(h.isDim()?2:22),h.isStrikethrough()!==p.isStrikethrough()&&_.push(h.isStrikethrough()?9:29))}return _}_nextCell(h,p,_,d){if(h.getWidth()===0)return;const y=h.getChars()==="",S=this._diffStyle(h,this._cursorStyle);if(y?!l(this._cursorStyle,h):S.length>0){this._nullCellCount>0&&(l(this._cursorStyle,this._backgroundCell)||(this._currentRow+=`\x1B[${this._nullCellCount}X`),this._currentRow+=`\x1B[${this._nullCellCount}C`,this._nullCellCount=0),this._lastContentCursorRow=this._lastCursorRow=_,this._lastContentCursorCol=this._lastCursorCol=d,this._currentRow+=`\x1B[${S.join(";")}m`;const w=this._buffer.getLine(_);w!==void 0&&(w.getCell(d,this._cursorStyle),this._cursorStyleRow=_,this._cursorStyleCol=d)}y?this._nullCellCount+=h.getWidth():(this._nullCellCount>0&&(l(this._cursorStyle,this._backgroundCell)||(this._currentRow+=`\x1B[${this._nullCellCount}X`),this._currentRow+=`\x1B[${this._nullCellCount}C`,this._nullCellCount=0),this._currentRow+=h.getChars(),this._lastContentCursorRow=this._lastCursorRow=_,this._lastContentCursorCol=this._lastCursorCol=d+h.getWidth())}_serializeString(h){let p=this._allRows.length;this._buffer.length-this._firstRow<=this._terminal.rows&&(p=this._lastContentCursorRow+1-this._firstRow,this._lastCursorCol=this._lastContentCursorCol,this._lastCursorRow=this._lastContentCursorRow);let _="";for(let w=0;w<p;w++)_+=this._allRows[w],w+1<p&&(_+=this._allRowSeparators[w]);if(!h){const w=this._buffer.baseY+this._buffer.cursorY,E=this._buffer.cursorX,b=k=>{k>0?_+=`\x1B[${k}C`:k<0&&(_+=`\x1B[${-k}D`)};(w!==this._lastCursorRow||E!==this._lastCursorCol)&&((d=w-this._lastCursorRow)>0?_+=`\x1B[${d}B`:d<0&&(_+=`\x1B[${-d}A`),b(E-this._lastCursorCol))}var d;const y=this._terminal._core._inputHandler._curAttrData,S=this._diffStyle(y,this._cursorStyle);return S.length>0&&(_+=`\x1B[${S.join(";")}m`),_}}c.SerializeAddon=class{activate(v){this._terminal=v}_serializeBufferByScrollback(v,h,p){const _=h.length,d=p===void 0?_:o(p+v.rows,0,_);return this._serializeBufferByRange(v,h,{start:_-d,end:_-1},!1)}_serializeBufferByRange(v,h,p,_){return new g(h,v).serialize({start:{x:0,y:typeof p.start=="number"?p.start:p.start.line},end:{x:v.cols,y:typeof p.end=="number"?p.end:p.end.line}},_)}_serializeBufferAsHTML(v,h){const p=v.buffer.active,_=new C(p,v,h);if(!h.onlySelection){const y=p.length,S=h.scrollback,w=S===void 0?y:o(S+v.rows,0,y);return _.serialize({start:{x:0,y:y-w},end:{x:v.cols,y:y-1}})}const d=this._terminal?.getSelectionPosition();return d!==void 0?_.serialize({start:{x:d.start.x,y:d.start.y},end:{x:d.end.x,y:d.end.y}}):""}_serializeModes(v){let h="";const p=v.modes;if(p.applicationCursorKeysMode&&(h+="\x1B[?1h"),p.applicationKeypadMode&&(h+="\x1B[?66h"),p.bracketedPasteMode&&(h+="\x1B[?2004h"),p.insertMode&&(h+="\x1B[4h"),p.originMode&&(h+="\x1B[?6h"),p.reverseWraparoundMode&&(h+="\x1B[?45h"),p.sendFocusMode&&(h+="\x1B[?1004h"),p.wraparoundMode===!1&&(h+="\x1B[?7l"),p.mouseTrackingMode!=="none")switch(p.mouseTrackingMode){case"x10":h+="\x1B[?9h";break;case"vt200":h+="\x1B[?1000h";break;case"drag":h+="\x1B[?1002h";break;case"any":h+="\x1B[?1003h"}return h}serialize(v){if(!this._terminal)throw new Error("Cannot use addon until it has been loaded");let h=v?.range?this._serializeBufferByRange(this._terminal,this._terminal.buffer.normal,v.range,!0):this._serializeBufferByScrollback(this._terminal,this._terminal.buffer.normal,v?.scrollback);return v?.excludeAltBuffer||this._terminal.buffer.active.type!=="alternate"||(h+=`\x1B[?1049h\x1B[H${this._serializeBufferByScrollback(this._terminal,this._terminal.buffer.alternate,void 0)}`),v?.excludeModes||(h+=this._serializeModes(this._terminal)),h}serializeAsHTML(v){if(!this._terminal)throw new Error("Cannot use addon until it has been loaded");return this._serializeBufferAsHTML(this._terminal,v||{})}dispose(){}};class C extends u{constructor(h,p,_){super(h),this._terminal=p,this._options=_,this._currentRow="",this._htmlContent="",p._core._themeService?this._ansiColors=p._core._themeService.colors.ansi:this._ansiColors=r.DEFAULT_ANSI_COLORS}_padStart(h,p,_){return p>>=0,_=_??" ",h.length>p?h:((p-=h.length)>_.length&&(_+=_.repeat(p/_.length)),_.slice(0,p)+h)}_beforeSerialize(h,p,_){this._htmlContent+="<html><body><!--StartFragment--><pre>";let d="#000000",y="#ffffff";this._options.includeGlobalBackground&&(d=this._terminal.options.theme?.foreground??"#ffffff",y=this._terminal.options.theme?.background??"#000000");const S=[];S.push("color: "+d+";"),S.push("background-color: "+y+";"),S.push("font-family: "+this._terminal.options.fontFamily+";"),S.push("font-size: "+this._terminal.options.fontSize+"px;"),this._htmlContent+="<div style='"+S.join(" ")+"'>"}_afterSerialize(){this._htmlContent+="</div>",this._htmlContent+="</pre><!--EndFragment--></body></html>"}_rowEnd(h,p){this._htmlContent+="<div><span>"+this._currentRow+"</span></div>",this._currentRow=""}_getHexColor(h,p){const _=p?h.getFgColor():h.getBgColor();return(p?h.isFgRGB():h.isBgRGB())?"#"+[_>>16&255,_>>8&255,255&_].map((d=>this._padStart(d.toString(16),2,"0"))).join(""):(p?h.isFgPalette():h.isBgPalette())?this._ansiColors[_].css:void 0}_diffStyle(h,p){const _=[],d=!f(h,p),y=!l(h,p),S=!m(h,p);if(d||y||S){const w=this._getHexColor(h,!0);w&&_.push("color: "+w+";");const E=this._getHexColor(h,!1);return E&&_.push("background-color: "+E+";"),h.isInverse()&&_.push("color: #000000; background-color: #BFBFBF;"),h.isBold()&&_.push("font-weight: bold;"),h.isUnderline()&&h.isOverline()?_.push("text-decoration: overline underline;"):h.isUnderline()?_.push("text-decoration: underline;"):h.isOverline()&&_.push("text-decoration: overline;"),h.isBlink()&&_.push("text-decoration: blink;"),h.isInvisible()&&_.push("visibility: hidden;"),h.isItalic()&&_.push("font-style: italic;"),h.isDim()&&_.push("opacity: 0.5;"),h.isStrikethrough()&&_.push("text-decoration: line-through;"),_}}_nextCell(h,p,_,d){if(h.getWidth()===0)return;const y=h.getChars()==="",S=this._diffStyle(h,p);S&&(this._currentRow+=S.length===0?"</span><span>":"</span><span style='"+S.join(" ")+"'>"),this._currentRow+=y?" ":h.getChars()}_serializeString(){return this._htmlContent}}c.HTMLSerializeHandler=C})(),a})()))})(Qs)),Qs.exports}var zp=Fp(),tn={exports:{}},ha;function Hp(){return ha||(ha=1,(function(e,t){(function(i,s){e.exports=s()})(globalThis,(()=>(()=>{var i={4567:function(c,r,o){var u=this&&this.__decorate||function(_,d,y,S){var w,E=arguments.length,b=E<3?d:S===null?S=Object.getOwnPropertyDescriptor(d,y):S;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")b=Reflect.decorate(_,d,y,S);else for(var k=_.length-1;k>=0;k--)(w=_[k])&&(b=(E<3?w(b):E>3?w(d,y,b):w(d,y))||b);return E>3&&b&&Object.defineProperty(d,y,b),b},f=this&&this.__param||function(_,d){return function(y,S){d(y,S,_)}};Object.defineProperty(r,"__esModule",{value:!0}),r.AccessibilityManager=void 0;const l=o(9042),m=o(9924),g=o(844),C=o(4725),v=o(2585),h=o(3656);let p=r.AccessibilityManager=class extends g.Disposable{constructor(_,d,y,S){super(),this._terminal=_,this._coreBrowserService=y,this._renderService=S,this._rowColumns=new WeakMap,this._liveRegionLineCount=0,this._charsToConsume=[],this._charsToAnnounce="",this._accessibilityContainer=this._coreBrowserService.mainDocument.createElement("div"),this._accessibilityContainer.classList.add("xterm-accessibility"),this._rowContainer=this._coreBrowserService.mainDocument.createElement("div"),this._rowContainer.setAttribute("role","list"),this._rowContainer.classList.add("xterm-accessibility-tree"),this._rowElements=[];for(let w=0;w<this._terminal.rows;w++)this._rowElements[w]=this._createAccessibilityTreeNode(),this._rowContainer.appendChild(this._rowElements[w]);if(this._topBoundaryFocusListener=w=>this._handleBoundaryFocus(w,0),this._bottomBoundaryFocusListener=w=>this._handleBoundaryFocus(w,1),this._rowElements[0].addEventListener("focus",this._topBoundaryFocusListener),this._rowElements[this._rowElements.length-1].addEventListener("focus",this._bottomBoundaryFocusListener),this._refreshRowsDimensions(),this._accessibilityContainer.appendChild(this._rowContainer),this._liveRegion=this._coreBrowserService.mainDocument.createElement("div"),this._liveRegion.classList.add("live-region"),this._liveRegion.setAttribute("aria-live","assertive"),this._accessibilityContainer.appendChild(this._liveRegion),this._liveRegionDebouncer=this.register(new m.TimeBasedDebouncer(this._renderRows.bind(this))),!this._terminal.element)throw new Error("Cannot enable accessibility before Terminal.open");this._terminal.element.insertAdjacentElement("afterbegin",this._accessibilityContainer),this.register(this._terminal.onResize((w=>this._handleResize(w.rows)))),this.register(this._terminal.onRender((w=>this._refreshRows(w.start,w.end)))),this.register(this._terminal.onScroll((()=>this._refreshRows()))),this.register(this._terminal.onA11yChar((w=>this._handleChar(w)))),this.register(this._terminal.onLineFeed((()=>this._handleChar(`
`)))),this.register(this._terminal.onA11yTab((w=>this._handleTab(w)))),this.register(this._terminal.onKey((w=>this._handleKey(w.key)))),this.register(this._terminal.onBlur((()=>this._clearLiveRegion()))),this.register(this._renderService.onDimensionsChange((()=>this._refreshRowsDimensions()))),this.register((0,h.addDisposableDomListener)(document,"selectionchange",(()=>this._handleSelectionChange()))),this.register(this._coreBrowserService.onDprChange((()=>this._refreshRowsDimensions()))),this._refreshRows(),this.register((0,g.toDisposable)((()=>{this._accessibilityContainer.remove(),this._rowElements.length=0})))}_handleTab(_){for(let d=0;d<_;d++)this._handleChar(" ")}_handleChar(_){this._liveRegionLineCount<21&&(this._charsToConsume.length>0?this._charsToConsume.shift()!==_&&(this._charsToAnnounce+=_):this._charsToAnnounce+=_,_===`
`&&(this._liveRegionLineCount++,this._liveRegionLineCount===21&&(this._liveRegion.textContent+=l.tooMuchOutput)))}_clearLiveRegion(){this._liveRegion.textContent="",this._liveRegionLineCount=0}_handleKey(_){this._clearLiveRegion(),new RegExp("\\p{Control}","u").test(_)||this._charsToConsume.push(_)}_refreshRows(_,d){this._liveRegionDebouncer.refresh(_,d,this._terminal.rows)}_renderRows(_,d){const y=this._terminal.buffer,S=y.lines.length.toString();for(let w=_;w<=d;w++){const E=y.lines.get(y.ydisp+w),b=[],k=E?.translateToString(!0,void 0,void 0,b)||"",R=(y.ydisp+w+1).toString(),O=this._rowElements[w];O&&(k.length===0?(O.innerText="",this._rowColumns.set(O,[0,1])):(O.textContent=k,this._rowColumns.set(O,b)),O.setAttribute("aria-posinset",R),O.setAttribute("aria-setsize",S))}this._announceCharacters()}_announceCharacters(){this._charsToAnnounce.length!==0&&(this._liveRegion.textContent+=this._charsToAnnounce,this._charsToAnnounce="")}_handleBoundaryFocus(_,d){const y=_.target,S=this._rowElements[d===0?1:this._rowElements.length-2];if(y.getAttribute("aria-posinset")===(d===0?"1":`${this._terminal.buffer.lines.length}`)||_.relatedTarget!==S)return;let w,E;if(d===0?(w=y,E=this._rowElements.pop(),this._rowContainer.removeChild(E)):(w=this._rowElements.shift(),E=y,this._rowContainer.removeChild(w)),w.removeEventListener("focus",this._topBoundaryFocusListener),E.removeEventListener("focus",this._bottomBoundaryFocusListener),d===0){const b=this._createAccessibilityTreeNode();this._rowElements.unshift(b),this._rowContainer.insertAdjacentElement("afterbegin",b)}else{const b=this._createAccessibilityTreeNode();this._rowElements.push(b),this._rowContainer.appendChild(b)}this._rowElements[0].addEventListener("focus",this._topBoundaryFocusListener),this._rowElements[this._rowElements.length-1].addEventListener("focus",this._bottomBoundaryFocusListener),this._terminal.scrollLines(d===0?-1:1),this._rowElements[d===0?1:this._rowElements.length-2].focus(),_.preventDefault(),_.stopImmediatePropagation()}_handleSelectionChange(){if(this._rowElements.length===0)return;const _=document.getSelection();if(!_)return;if(_.isCollapsed)return void(this._rowContainer.contains(_.anchorNode)&&this._terminal.clearSelection());if(!_.anchorNode||!_.focusNode)return void console.error("anchorNode and/or focusNode are null");let d={node:_.anchorNode,offset:_.anchorOffset},y={node:_.focusNode,offset:_.focusOffset};if((d.node.compareDocumentPosition(y.node)&Node.DOCUMENT_POSITION_PRECEDING||d.node===y.node&&d.offset>y.offset)&&([d,y]=[y,d]),d.node.compareDocumentPosition(this._rowElements[0])&(Node.DOCUMENT_POSITION_CONTAINED_BY|Node.DOCUMENT_POSITION_FOLLOWING)&&(d={node:this._rowElements[0].childNodes[0],offset:0}),!this._rowContainer.contains(d.node))return;const S=this._rowElements.slice(-1)[0];if(y.node.compareDocumentPosition(S)&(Node.DOCUMENT_POSITION_CONTAINED_BY|Node.DOCUMENT_POSITION_PRECEDING)&&(y={node:S,offset:S.textContent?.length??0}),!this._rowContainer.contains(y.node))return;const w=({node:k,offset:R})=>{const O=k instanceof Text?k.parentNode:k;let P=parseInt(O?.getAttribute("aria-posinset"),10)-1;if(isNaN(P))return console.warn("row is invalid. Race condition?"),null;const L=this._rowColumns.get(O);if(!L)return console.warn("columns is null. Race condition?"),null;let q=R<L.length?L[R]:L.slice(-1)[0]+1;return q>=this._terminal.cols&&(++P,q=0),{row:P,column:q}},E=w(d),b=w(y);if(E&&b){if(E.row>b.row||E.row===b.row&&E.column>=b.column)throw new Error("invalid range");this._terminal.select(E.column,E.row,(b.row-E.row)*this._terminal.cols-E.column+b.column)}}_handleResize(_){this._rowElements[this._rowElements.length-1].removeEventListener("focus",this._bottomBoundaryFocusListener);for(let d=this._rowContainer.children.length;d<this._terminal.rows;d++)this._rowElements[d]=this._createAccessibilityTreeNode(),this._rowContainer.appendChild(this._rowElements[d]);for(;this._rowElements.length>_;)this._rowContainer.removeChild(this._rowElements.pop());this._rowElements[this._rowElements.length-1].addEventListener("focus",this._bottomBoundaryFocusListener),this._refreshRowsDimensions()}_createAccessibilityTreeNode(){const _=this._coreBrowserService.mainDocument.createElement("div");return _.setAttribute("role","listitem"),_.tabIndex=-1,this._refreshRowDimensions(_),_}_refreshRowsDimensions(){if(this._renderService.dimensions.css.cell.height){this._accessibilityContainer.style.width=`${this._renderService.dimensions.css.canvas.width}px`,this._rowElements.length!==this._terminal.rows&&this._handleResize(this._terminal.rows);for(let _=0;_<this._terminal.rows;_++)this._refreshRowDimensions(this._rowElements[_])}}_refreshRowDimensions(_){_.style.height=`${this._renderService.dimensions.css.cell.height}px`}};r.AccessibilityManager=p=u([f(1,v.IInstantiationService),f(2,C.ICoreBrowserService),f(3,C.IRenderService)],p)},3614:(c,r)=>{function o(m){return m.replace(/\r?\n/g,"\r")}function u(m,g){return g?"\x1B[200~"+m+"\x1B[201~":m}function f(m,g,C,v){m=u(m=o(m),C.decPrivateModes.bracketedPasteMode&&v.rawOptions.ignoreBracketedPasteMode!==!0),C.triggerDataEvent(m,!0),g.value=""}function l(m,g,C){const v=C.getBoundingClientRect(),h=m.clientX-v.left-10,p=m.clientY-v.top-10;g.style.width="20px",g.style.height="20px",g.style.left=`${h}px`,g.style.top=`${p}px`,g.style.zIndex="1000",g.focus()}Object.defineProperty(r,"__esModule",{value:!0}),r.rightClickHandler=r.moveTextAreaUnderMouseCursor=r.paste=r.handlePasteEvent=r.copyHandler=r.bracketTextForPaste=r.prepareTextForTerminal=void 0,r.prepareTextForTerminal=o,r.bracketTextForPaste=u,r.copyHandler=function(m,g){m.clipboardData&&m.clipboardData.setData("text/plain",g.selectionText),m.preventDefault()},r.handlePasteEvent=function(m,g,C,v){m.stopPropagation(),m.clipboardData&&f(m.clipboardData.getData("text/plain"),g,C,v)},r.paste=f,r.moveTextAreaUnderMouseCursor=l,r.rightClickHandler=function(m,g,C,v,h){l(m,g,C),h&&v.rightClickSelect(m),g.value=v.selectionText,g.select()}},7239:(c,r,o)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.ColorContrastCache=void 0;const u=o(1505);r.ColorContrastCache=class{constructor(){this._color=new u.TwoKeyMap,this._css=new u.TwoKeyMap}setCss(f,l,m){this._css.set(f,l,m)}getCss(f,l){return this._css.get(f,l)}setColor(f,l,m){this._color.set(f,l,m)}getColor(f,l){return this._color.get(f,l)}clear(){this._color.clear(),this._css.clear()}}},3656:(c,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.addDisposableDomListener=void 0,r.addDisposableDomListener=function(o,u,f,l){o.addEventListener(u,f,l);let m=!1;return{dispose:()=>{m||(m=!0,o.removeEventListener(u,f,l))}}}},3551:function(c,r,o){var u=this&&this.__decorate||function(p,_,d,y){var S,w=arguments.length,E=w<3?_:y===null?y=Object.getOwnPropertyDescriptor(_,d):y;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")E=Reflect.decorate(p,_,d,y);else for(var b=p.length-1;b>=0;b--)(S=p[b])&&(E=(w<3?S(E):w>3?S(_,d,E):S(_,d))||E);return w>3&&E&&Object.defineProperty(_,d,E),E},f=this&&this.__param||function(p,_){return function(d,y){_(d,y,p)}};Object.defineProperty(r,"__esModule",{value:!0}),r.Linkifier=void 0;const l=o(3656),m=o(8460),g=o(844),C=o(2585),v=o(4725);let h=r.Linkifier=class extends g.Disposable{get currentLink(){return this._currentLink}constructor(p,_,d,y,S){super(),this._element=p,this._mouseService=_,this._renderService=d,this._bufferService=y,this._linkProviderService=S,this._linkCacheDisposables=[],this._isMouseOut=!0,this._wasResized=!1,this._activeLine=-1,this._onShowLinkUnderline=this.register(new m.EventEmitter),this.onShowLinkUnderline=this._onShowLinkUnderline.event,this._onHideLinkUnderline=this.register(new m.EventEmitter),this.onHideLinkUnderline=this._onHideLinkUnderline.event,this.register((0,g.getDisposeArrayDisposable)(this._linkCacheDisposables)),this.register((0,g.toDisposable)((()=>{this._lastMouseEvent=void 0,this._activeProviderReplies?.clear()}))),this.register(this._bufferService.onResize((()=>{this._clearCurrentLink(),this._wasResized=!0}))),this.register((0,l.addDisposableDomListener)(this._element,"mouseleave",(()=>{this._isMouseOut=!0,this._clearCurrentLink()}))),this.register((0,l.addDisposableDomListener)(this._element,"mousemove",this._handleMouseMove.bind(this))),this.register((0,l.addDisposableDomListener)(this._element,"mousedown",this._handleMouseDown.bind(this))),this.register((0,l.addDisposableDomListener)(this._element,"mouseup",this._handleMouseUp.bind(this)))}_handleMouseMove(p){this._lastMouseEvent=p;const _=this._positionFromMouseEvent(p,this._element,this._mouseService);if(!_)return;this._isMouseOut=!1;const d=p.composedPath();for(let y=0;y<d.length;y++){const S=d[y];if(S.classList.contains("xterm"))break;if(S.classList.contains("xterm-hover"))return}this._lastBufferCell&&_.x===this._lastBufferCell.x&&_.y===this._lastBufferCell.y||(this._handleHover(_),this._lastBufferCell=_)}_handleHover(p){if(this._activeLine!==p.y||this._wasResized)return this._clearCurrentLink(),this._askForLink(p,!1),void(this._wasResized=!1);this._currentLink&&this._linkAtPosition(this._currentLink.link,p)||(this._clearCurrentLink(),this._askForLink(p,!0))}_askForLink(p,_){this._activeProviderReplies&&_||(this._activeProviderReplies?.forEach((y=>{y?.forEach((S=>{S.link.dispose&&S.link.dispose()}))})),this._activeProviderReplies=new Map,this._activeLine=p.y);let d=!1;for(const[y,S]of this._linkProviderService.linkProviders.entries())_?this._activeProviderReplies?.get(y)&&(d=this._checkLinkProviderResult(y,p,d)):S.provideLinks(p.y,(w=>{if(this._isMouseOut)return;const E=w?.map((b=>({link:b})));this._activeProviderReplies?.set(y,E),d=this._checkLinkProviderResult(y,p,d),this._activeProviderReplies?.size===this._linkProviderService.linkProviders.length&&this._removeIntersectingLinks(p.y,this._activeProviderReplies)}))}_removeIntersectingLinks(p,_){const d=new Set;for(let y=0;y<_.size;y++){const S=_.get(y);if(S)for(let w=0;w<S.length;w++){const E=S[w],b=E.link.range.start.y<p?0:E.link.range.start.x,k=E.link.range.end.y>p?this._bufferService.cols:E.link.range.end.x;for(let R=b;R<=k;R++){if(d.has(R)){S.splice(w--,1);break}d.add(R)}}}}_checkLinkProviderResult(p,_,d){if(!this._activeProviderReplies)return d;const y=this._activeProviderReplies.get(p);let S=!1;for(let w=0;w<p;w++)this._activeProviderReplies.has(w)&&!this._activeProviderReplies.get(w)||(S=!0);if(!S&&y){const w=y.find((E=>this._linkAtPosition(E.link,_)));w&&(d=!0,this._handleNewLink(w))}if(this._activeProviderReplies.size===this._linkProviderService.linkProviders.length&&!d)for(let w=0;w<this._activeProviderReplies.size;w++){const E=this._activeProviderReplies.get(w)?.find((b=>this._linkAtPosition(b.link,_)));if(E){d=!0,this._handleNewLink(E);break}}return d}_handleMouseDown(){this._mouseDownLink=this._currentLink}_handleMouseUp(p){if(!this._currentLink)return;const _=this._positionFromMouseEvent(p,this._element,this._mouseService);_&&this._mouseDownLink===this._currentLink&&this._linkAtPosition(this._currentLink.link,_)&&this._currentLink.link.activate(p,this._currentLink.link.text)}_clearCurrentLink(p,_){this._currentLink&&this._lastMouseEvent&&(!p||!_||this._currentLink.link.range.start.y>=p&&this._currentLink.link.range.end.y<=_)&&(this._linkLeave(this._element,this._currentLink.link,this._lastMouseEvent),this._currentLink=void 0,(0,g.disposeArray)(this._linkCacheDisposables))}_handleNewLink(p){if(!this._lastMouseEvent)return;const _=this._positionFromMouseEvent(this._lastMouseEvent,this._element,this._mouseService);_&&this._linkAtPosition(p.link,_)&&(this._currentLink=p,this._currentLink.state={decorations:{underline:p.link.decorations===void 0||p.link.decorations.underline,pointerCursor:p.link.decorations===void 0||p.link.decorations.pointerCursor},isHovered:!0},this._linkHover(this._element,p.link,this._lastMouseEvent),p.link.decorations={},Object.defineProperties(p.link.decorations,{pointerCursor:{get:()=>this._currentLink?.state?.decorations.pointerCursor,set:d=>{this._currentLink?.state&&this._currentLink.state.decorations.pointerCursor!==d&&(this._currentLink.state.decorations.pointerCursor=d,this._currentLink.state.isHovered&&this._element.classList.toggle("xterm-cursor-pointer",d))}},underline:{get:()=>this._currentLink?.state?.decorations.underline,set:d=>{this._currentLink?.state&&this._currentLink?.state?.decorations.underline!==d&&(this._currentLink.state.decorations.underline=d,this._currentLink.state.isHovered&&this._fireUnderlineEvent(p.link,d))}}}),this._linkCacheDisposables.push(this._renderService.onRenderedViewportChange((d=>{if(!this._currentLink)return;const y=d.start===0?0:d.start+1+this._bufferService.buffer.ydisp,S=this._bufferService.buffer.ydisp+1+d.end;if(this._currentLink.link.range.start.y>=y&&this._currentLink.link.range.end.y<=S&&(this._clearCurrentLink(y,S),this._lastMouseEvent)){const w=this._positionFromMouseEvent(this._lastMouseEvent,this._element,this._mouseService);w&&this._askForLink(w,!1)}}))))}_linkHover(p,_,d){this._currentLink?.state&&(this._currentLink.state.isHovered=!0,this._currentLink.state.decorations.underline&&this._fireUnderlineEvent(_,!0),this._currentLink.state.decorations.pointerCursor&&p.classList.add("xterm-cursor-pointer")),_.hover&&_.hover(d,_.text)}_fireUnderlineEvent(p,_){const d=p.range,y=this._bufferService.buffer.ydisp,S=this._createLinkUnderlineEvent(d.start.x-1,d.start.y-y-1,d.end.x,d.end.y-y-1,void 0);(_?this._onShowLinkUnderline:this._onHideLinkUnderline).fire(S)}_linkLeave(p,_,d){this._currentLink?.state&&(this._currentLink.state.isHovered=!1,this._currentLink.state.decorations.underline&&this._fireUnderlineEvent(_,!1),this._currentLink.state.decorations.pointerCursor&&p.classList.remove("xterm-cursor-pointer")),_.leave&&_.leave(d,_.text)}_linkAtPosition(p,_){const d=p.range.start.y*this._bufferService.cols+p.range.start.x,y=p.range.end.y*this._bufferService.cols+p.range.end.x,S=_.y*this._bufferService.cols+_.x;return d<=S&&S<=y}_positionFromMouseEvent(p,_,d){const y=d.getCoords(p,_,this._bufferService.cols,this._bufferService.rows);if(y)return{x:y[0],y:y[1]+this._bufferService.buffer.ydisp}}_createLinkUnderlineEvent(p,_,d,y,S){return{x1:p,y1:_,x2:d,y2:y,cols:this._bufferService.cols,fg:S}}};r.Linkifier=h=u([f(1,v.IMouseService),f(2,v.IRenderService),f(3,C.IBufferService),f(4,v.ILinkProviderService)],h)},9042:(c,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.tooMuchOutput=r.promptLabel=void 0,r.promptLabel="Terminal input",r.tooMuchOutput="Too much output to announce, navigate to rows manually to read"},3730:function(c,r,o){var u=this&&this.__decorate||function(v,h,p,_){var d,y=arguments.length,S=y<3?h:_===null?_=Object.getOwnPropertyDescriptor(h,p):_;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")S=Reflect.decorate(v,h,p,_);else for(var w=v.length-1;w>=0;w--)(d=v[w])&&(S=(y<3?d(S):y>3?d(h,p,S):d(h,p))||S);return y>3&&S&&Object.defineProperty(h,p,S),S},f=this&&this.__param||function(v,h){return function(p,_){h(p,_,v)}};Object.defineProperty(r,"__esModule",{value:!0}),r.OscLinkProvider=void 0;const l=o(511),m=o(2585);let g=r.OscLinkProvider=class{constructor(v,h,p){this._bufferService=v,this._optionsService=h,this._oscLinkService=p}provideLinks(v,h){const p=this._bufferService.buffer.lines.get(v-1);if(!p)return void h(void 0);const _=[],d=this._optionsService.rawOptions.linkHandler,y=new l.CellData,S=p.getTrimmedLength();let w=-1,E=-1,b=!1;for(let k=0;k<S;k++)if(E!==-1||p.hasContent(k)){if(p.loadCell(k,y),y.hasExtendedAttrs()&&y.extended.urlId){if(E===-1){E=k,w=y.extended.urlId;continue}b=y.extended.urlId!==w}else E!==-1&&(b=!0);if(b||E!==-1&&k===S-1){const R=this._oscLinkService.getLinkData(w)?.uri;if(R){const O={start:{x:E+1,y:v},end:{x:k+(b||k!==S-1?0:1),y:v}};let P=!1;if(!d?.allowNonHttpProtocols)try{const L=new URL(R);["http:","https:"].includes(L.protocol)||(P=!0)}catch{P=!0}P||_.push({text:R,range:O,activate:(L,q)=>d?d.activate(L,q,O):C(0,q),hover:(L,q)=>d?.hover?.(L,q,O),leave:(L,q)=>d?.leave?.(L,q,O)})}b=!1,y.hasExtendedAttrs()&&y.extended.urlId?(E=k,w=y.extended.urlId):(E=-1,w=-1)}}h(_)}};function C(v,h){if(confirm(`Do you want to navigate to ${h}?

WARNING: This link could potentially be dangerous`)){const p=window.open();if(p){try{p.opener=null}catch{}p.location.href=h}else console.warn("Opening link blocked as opener could not be cleared")}}r.OscLinkProvider=g=u([f(0,m.IBufferService),f(1,m.IOptionsService),f(2,m.IOscLinkService)],g)},6193:(c,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.RenderDebouncer=void 0,r.RenderDebouncer=class{constructor(o,u){this._renderCallback=o,this._coreBrowserService=u,this._refreshCallbacks=[]}dispose(){this._animationFrame&&(this._coreBrowserService.window.cancelAnimationFrame(this._animationFrame),this._animationFrame=void 0)}addRefreshCallback(o){return this._refreshCallbacks.push(o),this._animationFrame||(this._animationFrame=this._coreBrowserService.window.requestAnimationFrame((()=>this._innerRefresh()))),this._animationFrame}refresh(o,u,f){this._rowCount=f,o=o!==void 0?o:0,u=u!==void 0?u:this._rowCount-1,this._rowStart=this._rowStart!==void 0?Math.min(this._rowStart,o):o,this._rowEnd=this._rowEnd!==void 0?Math.max(this._rowEnd,u):u,this._animationFrame||(this._animationFrame=this._coreBrowserService.window.requestAnimationFrame((()=>this._innerRefresh())))}_innerRefresh(){if(this._animationFrame=void 0,this._rowStart===void 0||this._rowEnd===void 0||this._rowCount===void 0)return void this._runRefreshCallbacks();const o=Math.max(this._rowStart,0),u=Math.min(this._rowEnd,this._rowCount-1);this._rowStart=void 0,this._rowEnd=void 0,this._renderCallback(o,u),this._runRefreshCallbacks()}_runRefreshCallbacks(){for(const o of this._refreshCallbacks)o(0);this._refreshCallbacks=[]}}},3236:(c,r,o)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.Terminal=void 0;const u=o(3614),f=o(3656),l=o(3551),m=o(9042),g=o(3730),C=o(1680),v=o(3107),h=o(5744),p=o(2950),_=o(1296),d=o(428),y=o(4269),S=o(5114),w=o(8934),E=o(3230),b=o(9312),k=o(4725),R=o(6731),O=o(8055),P=o(8969),L=o(8460),q=o(844),J=o(6114),re=o(8437),ie=o(2584),ee=o(7399),x=o(5941),B=o(9074),U=o(2585),z=o(5435),se=o(4567),j=o(779);class G extends P.CoreTerminal{get onFocus(){return this._onFocus.event}get onBlur(){return this._onBlur.event}get onA11yChar(){return this._onA11yCharEmitter.event}get onA11yTab(){return this._onA11yTabEmitter.event}get onWillOpen(){return this._onWillOpen.event}constructor(M={}){super(M),this.browser=J,this._keyDownHandled=!1,this._keyDownSeen=!1,this._keyPressHandled=!1,this._unprocessedDeadKey=!1,this._accessibilityManager=this.register(new q.MutableDisposable),this._onCursorMove=this.register(new L.EventEmitter),this.onCursorMove=this._onCursorMove.event,this._onKey=this.register(new L.EventEmitter),this.onKey=this._onKey.event,this._onRender=this.register(new L.EventEmitter),this.onRender=this._onRender.event,this._onSelectionChange=this.register(new L.EventEmitter),this.onSelectionChange=this._onSelectionChange.event,this._onTitleChange=this.register(new L.EventEmitter),this.onTitleChange=this._onTitleChange.event,this._onBell=this.register(new L.EventEmitter),this.onBell=this._onBell.event,this._onFocus=this.register(new L.EventEmitter),this._onBlur=this.register(new L.EventEmitter),this._onA11yCharEmitter=this.register(new L.EventEmitter),this._onA11yTabEmitter=this.register(new L.EventEmitter),this._onWillOpen=this.register(new L.EventEmitter),this._setup(),this._decorationService=this._instantiationService.createInstance(B.DecorationService),this._instantiationService.setService(U.IDecorationService,this._decorationService),this._linkProviderService=this._instantiationService.createInstance(j.LinkProviderService),this._instantiationService.setService(k.ILinkProviderService,this._linkProviderService),this._linkProviderService.registerLinkProvider(this._instantiationService.createInstance(g.OscLinkProvider)),this.register(this._inputHandler.onRequestBell((()=>this._onBell.fire()))),this.register(this._inputHandler.onRequestRefreshRows(((T,K)=>this.refresh(T,K)))),this.register(this._inputHandler.onRequestSendFocus((()=>this._reportFocus()))),this.register(this._inputHandler.onRequestReset((()=>this.reset()))),this.register(this._inputHandler.onRequestWindowsOptionsReport((T=>this._reportWindowsOptions(T)))),this.register(this._inputHandler.onColor((T=>this._handleColorEvent(T)))),this.register((0,L.forwardEvent)(this._inputHandler.onCursorMove,this._onCursorMove)),this.register((0,L.forwardEvent)(this._inputHandler.onTitleChange,this._onTitleChange)),this.register((0,L.forwardEvent)(this._inputHandler.onA11yChar,this._onA11yCharEmitter)),this.register((0,L.forwardEvent)(this._inputHandler.onA11yTab,this._onA11yTabEmitter)),this.register(this._bufferService.onResize((T=>this._afterResize(T.cols,T.rows)))),this.register((0,q.toDisposable)((()=>{this._customKeyEventHandler=void 0,this.element?.parentNode?.removeChild(this.element)})))}_handleColorEvent(M){if(this._themeService)for(const T of M){let K,H="";switch(T.index){case 256:K="foreground",H="10";break;case 257:K="background",H="11";break;case 258:K="cursor",H="12";break;default:K="ansi",H="4;"+T.index}switch(T.type){case 0:const X=O.color.toColorRGB(K==="ansi"?this._themeService.colors.ansi[T.index]:this._themeService.colors[K]);this.coreService.triggerDataEvent(`${ie.C0.ESC}]${H};${(0,x.toRgbString)(X)}${ie.C1_ESCAPED.ST}`);break;case 1:if(K==="ansi")this._themeService.modifyColors((Q=>Q.ansi[T.index]=O.channels.toColor(...T.color)));else{const Q=K;this._themeService.modifyColors((he=>he[Q]=O.channels.toColor(...T.color)))}break;case 2:this._themeService.restoreColor(T.index)}}}_setup(){super._setup(),this._customKeyEventHandler=void 0}get buffer(){return this.buffers.active}focus(){this.textarea&&this.textarea.focus({preventScroll:!0})}_handleScreenReaderModeOptionChange(M){M?!this._accessibilityManager.value&&this._renderService&&(this._accessibilityManager.value=this._instantiationService.createInstance(se.AccessibilityManager,this)):this._accessibilityManager.clear()}_handleTextAreaFocus(M){this.coreService.decPrivateModes.sendFocus&&this.coreService.triggerDataEvent(ie.C0.ESC+"[I"),this.element.classList.add("focus"),this._showCursor(),this._onFocus.fire()}blur(){return this.textarea?.blur()}_handleTextAreaBlur(){this.textarea.value="",this.refresh(this.buffer.y,this.buffer.y),this.coreService.decPrivateModes.sendFocus&&this.coreService.triggerDataEvent(ie.C0.ESC+"[O"),this.element.classList.remove("focus"),this._onBlur.fire()}_syncTextArea(){if(!this.textarea||!this.buffer.isCursorInViewport||this._compositionHelper.isComposing||!this._renderService)return;const M=this.buffer.ybase+this.buffer.y,T=this.buffer.lines.get(M);if(!T)return;const K=Math.min(this.buffer.x,this.cols-1),H=this._renderService.dimensions.css.cell.height,X=T.getWidth(K),Q=this._renderService.dimensions.css.cell.width*X,he=this.buffer.y*this._renderService.dimensions.css.cell.height,me=K*this._renderService.dimensions.css.cell.width;this.textarea.style.left=me+"px",this.textarea.style.top=he+"px",this.textarea.style.width=Q+"px",this.textarea.style.height=H+"px",this.textarea.style.lineHeight=H+"px",this.textarea.style.zIndex="-5"}_initGlobal(){this._bindKeys(),this.register((0,f.addDisposableDomListener)(this.element,"copy",(T=>{this.hasSelection()&&(0,u.copyHandler)(T,this._selectionService)})));const M=T=>(0,u.handlePasteEvent)(T,this.textarea,this.coreService,this.optionsService);this.register((0,f.addDisposableDomListener)(this.textarea,"paste",M)),this.register((0,f.addDisposableDomListener)(this.element,"paste",M)),J.isFirefox?this.register((0,f.addDisposableDomListener)(this.element,"mousedown",(T=>{T.button===2&&(0,u.rightClickHandler)(T,this.textarea,this.screenElement,this._selectionService,this.options.rightClickSelectsWord)}))):this.register((0,f.addDisposableDomListener)(this.element,"contextmenu",(T=>{(0,u.rightClickHandler)(T,this.textarea,this.screenElement,this._selectionService,this.options.rightClickSelectsWord)}))),J.isLinux&&this.register((0,f.addDisposableDomListener)(this.element,"auxclick",(T=>{T.button===1&&(0,u.moveTextAreaUnderMouseCursor)(T,this.textarea,this.screenElement)})))}_bindKeys(){this.register((0,f.addDisposableDomListener)(this.textarea,"keyup",(M=>this._keyUp(M)),!0)),this.register((0,f.addDisposableDomListener)(this.textarea,"keydown",(M=>this._keyDown(M)),!0)),this.register((0,f.addDisposableDomListener)(this.textarea,"keypress",(M=>this._keyPress(M)),!0)),this.register((0,f.addDisposableDomListener)(this.textarea,"compositionstart",(()=>this._compositionHelper.compositionstart()))),this.register((0,f.addDisposableDomListener)(this.textarea,"compositionupdate",(M=>this._compositionHelper.compositionupdate(M)))),this.register((0,f.addDisposableDomListener)(this.textarea,"compositionend",(()=>this._compositionHelper.compositionend()))),this.register((0,f.addDisposableDomListener)(this.textarea,"input",(M=>this._inputEvent(M)),!0)),this.register(this.onRender((()=>this._compositionHelper.updateCompositionElements())))}open(M){if(!M)throw new Error("Terminal requires a parent element.");if(M.isConnected||this._logService.debug("Terminal.open was called on an element that was not attached to the DOM"),this.element?.ownerDocument.defaultView&&this._coreBrowserService)return void(this.element.ownerDocument.defaultView!==this._coreBrowserService.window&&(this._coreBrowserService.window=this.element.ownerDocument.defaultView));this._document=M.ownerDocument,this.options.documentOverride&&this.options.documentOverride instanceof Document&&(this._document=this.optionsService.rawOptions.documentOverride),this.element=this._document.createElement("div"),this.element.dir="ltr",this.element.classList.add("terminal"),this.element.classList.add("xterm"),M.appendChild(this.element);const T=this._document.createDocumentFragment();this._viewportElement=this._document.createElement("div"),this._viewportElement.classList.add("xterm-viewport"),T.appendChild(this._viewportElement),this._viewportScrollArea=this._document.createElement("div"),this._viewportScrollArea.classList.add("xterm-scroll-area"),this._viewportElement.appendChild(this._viewportScrollArea),this.screenElement=this._document.createElement("div"),this.screenElement.classList.add("xterm-screen"),this.register((0,f.addDisposableDomListener)(this.screenElement,"mousemove",(K=>this.updateCursorStyle(K)))),this._helperContainer=this._document.createElement("div"),this._helperContainer.classList.add("xterm-helpers"),this.screenElement.appendChild(this._helperContainer),T.appendChild(this.screenElement),this.textarea=this._document.createElement("textarea"),this.textarea.classList.add("xterm-helper-textarea"),this.textarea.setAttribute("aria-label",m.promptLabel),J.isChromeOS||this.textarea.setAttribute("aria-multiline","false"),this.textarea.setAttribute("autocorrect","off"),this.textarea.setAttribute("autocapitalize","off"),this.textarea.setAttribute("spellcheck","false"),this.textarea.tabIndex=0,this._coreBrowserService=this.register(this._instantiationService.createInstance(S.CoreBrowserService,this.textarea,M.ownerDocument.defaultView??window,this._document??typeof window<"u"?window.document:null)),this._instantiationService.setService(k.ICoreBrowserService,this._coreBrowserService),this.register((0,f.addDisposableDomListener)(this.textarea,"focus",(K=>this._handleTextAreaFocus(K)))),this.register((0,f.addDisposableDomListener)(this.textarea,"blur",(()=>this._handleTextAreaBlur()))),this._helperContainer.appendChild(this.textarea),this._charSizeService=this._instantiationService.createInstance(d.CharSizeService,this._document,this._helperContainer),this._instantiationService.setService(k.ICharSizeService,this._charSizeService),this._themeService=this._instantiationService.createInstance(R.ThemeService),this._instantiationService.setService(k.IThemeService,this._themeService),this._characterJoinerService=this._instantiationService.createInstance(y.CharacterJoinerService),this._instantiationService.setService(k.ICharacterJoinerService,this._characterJoinerService),this._renderService=this.register(this._instantiationService.createInstance(E.RenderService,this.rows,this.screenElement)),this._instantiationService.setService(k.IRenderService,this._renderService),this.register(this._renderService.onRenderedViewportChange((K=>this._onRender.fire(K)))),this.onResize((K=>this._renderService.resize(K.cols,K.rows))),this._compositionView=this._document.createElement("div"),this._compositionView.classList.add("composition-view"),this._compositionHelper=this._instantiationService.createInstance(p.CompositionHelper,this.textarea,this._compositionView),this._helperContainer.appendChild(this._compositionView),this._mouseService=this._instantiationService.createInstance(w.MouseService),this._instantiationService.setService(k.IMouseService,this._mouseService),this.linkifier=this.register(this._instantiationService.createInstance(l.Linkifier,this.screenElement)),this.element.appendChild(T);try{this._onWillOpen.fire(this.element)}catch{}this._renderService.hasRenderer()||this._renderService.setRenderer(this._createRenderer()),this.viewport=this._instantiationService.createInstance(C.Viewport,this._viewportElement,this._viewportScrollArea),this.viewport.onRequestScrollLines((K=>this.scrollLines(K.amount,K.suppressScrollEvent,1))),this.register(this._inputHandler.onRequestSyncScrollBar((()=>this.viewport.syncScrollArea()))),this.register(this.viewport),this.register(this.onCursorMove((()=>{this._renderService.handleCursorMove(),this._syncTextArea()}))),this.register(this.onResize((()=>this._renderService.handleResize(this.cols,this.rows)))),this.register(this.onBlur((()=>this._renderService.handleBlur()))),this.register(this.onFocus((()=>this._renderService.handleFocus()))),this.register(this._renderService.onDimensionsChange((()=>this.viewport.syncScrollArea()))),this._selectionService=this.register(this._instantiationService.createInstance(b.SelectionService,this.element,this.screenElement,this.linkifier)),this._instantiationService.setService(k.ISelectionService,this._selectionService),this.register(this._selectionService.onRequestScrollLines((K=>this.scrollLines(K.amount,K.suppressScrollEvent)))),this.register(this._selectionService.onSelectionChange((()=>this._onSelectionChange.fire()))),this.register(this._selectionService.onRequestRedraw((K=>this._renderService.handleSelectionChanged(K.start,K.end,K.columnSelectMode)))),this.register(this._selectionService.onLinuxMouseSelection((K=>{this.textarea.value=K,this.textarea.focus(),this.textarea.select()}))),this.register(this._onScroll.event((K=>{this.viewport.syncScrollArea(),this._selectionService.refresh()}))),this.register((0,f.addDisposableDomListener)(this._viewportElement,"scroll",(()=>this._selectionService.refresh()))),this.register(this._instantiationService.createInstance(v.BufferDecorationRenderer,this.screenElement)),this.register((0,f.addDisposableDomListener)(this.element,"mousedown",(K=>this._selectionService.handleMouseDown(K)))),this.coreMouseService.areMouseEventsActive?(this._selectionService.disable(),this.element.classList.add("enable-mouse-events")):this._selectionService.enable(),this.options.screenReaderMode&&(this._accessibilityManager.value=this._instantiationService.createInstance(se.AccessibilityManager,this)),this.register(this.optionsService.onSpecificOptionChange("screenReaderMode",(K=>this._handleScreenReaderModeOptionChange(K)))),this.options.overviewRulerWidth&&(this._overviewRulerRenderer=this.register(this._instantiationService.createInstance(h.OverviewRulerRenderer,this._viewportElement,this.screenElement))),this.optionsService.onSpecificOptionChange("overviewRulerWidth",(K=>{!this._overviewRulerRenderer&&K&&this._viewportElement&&this.screenElement&&(this._overviewRulerRenderer=this.register(this._instantiationService.createInstance(h.OverviewRulerRenderer,this._viewportElement,this.screenElement)))})),this._charSizeService.measure(),this.refresh(0,this.rows-1),this._initGlobal(),this.bindMouse()}_createRenderer(){return this._instantiationService.createInstance(_.DomRenderer,this,this._document,this.element,this.screenElement,this._viewportElement,this._helperContainer,this.linkifier)}bindMouse(){const M=this,T=this.element;function K(Q){const he=M._mouseService.getMouseReportCoords(Q,M.screenElement);if(!he)return!1;let me,fe;switch(Q.overrideType||Q.type){case"mousemove":fe=32,Q.buttons===void 0?(me=3,Q.button!==void 0&&(me=Q.button<3?Q.button:3)):me=1&Q.buttons?0:4&Q.buttons?1:2&Q.buttons?2:3;break;case"mouseup":fe=0,me=Q.button<3?Q.button:3;break;case"mousedown":fe=1,me=Q.button<3?Q.button:3;break;case"wheel":if(M._customWheelEventHandler&&M._customWheelEventHandler(Q)===!1||M.viewport.getLinesScrolled(Q)===0)return!1;fe=Q.deltaY<0?0:1,me=4;break;default:return!1}return!(fe===void 0||me===void 0||me>4)&&M.coreMouseService.triggerMouseEvent({col:he.col,row:he.row,x:he.x,y:he.y,button:me,action:fe,ctrl:Q.ctrlKey,alt:Q.altKey,shift:Q.shiftKey})}const H={mouseup:null,wheel:null,mousedrag:null,mousemove:null},X={mouseup:Q=>(K(Q),Q.buttons||(this._document.removeEventListener("mouseup",H.mouseup),H.mousedrag&&this._document.removeEventListener("mousemove",H.mousedrag)),this.cancel(Q)),wheel:Q=>(K(Q),this.cancel(Q,!0)),mousedrag:Q=>{Q.buttons&&K(Q)},mousemove:Q=>{Q.buttons||K(Q)}};this.register(this.coreMouseService.onProtocolChange((Q=>{Q?(this.optionsService.rawOptions.logLevel==="debug"&&this._logService.debug("Binding to mouse events:",this.coreMouseService.explainEvents(Q)),this.element.classList.add("enable-mouse-events"),this._selectionService.disable()):(this._logService.debug("Unbinding from mouse events."),this.element.classList.remove("enable-mouse-events"),this._selectionService.enable()),8&Q?H.mousemove||(T.addEventListener("mousemove",X.mousemove),H.mousemove=X.mousemove):(T.removeEventListener("mousemove",H.mousemove),H.mousemove=null),16&Q?H.wheel||(T.addEventListener("wheel",X.wheel,{passive:!1}),H.wheel=X.wheel):(T.removeEventListener("wheel",H.wheel),H.wheel=null),2&Q?H.mouseup||(H.mouseup=X.mouseup):(this._document.removeEventListener("mouseup",H.mouseup),H.mouseup=null),4&Q?H.mousedrag||(H.mousedrag=X.mousedrag):(this._document.removeEventListener("mousemove",H.mousedrag),H.mousedrag=null)}))),this.coreMouseService.activeProtocol=this.coreMouseService.activeProtocol,this.register((0,f.addDisposableDomListener)(T,"mousedown",(Q=>{if(Q.preventDefault(),this.focus(),this.coreMouseService.areMouseEventsActive&&!this._selectionService.shouldForceSelection(Q))return K(Q),H.mouseup&&this._document.addEventListener("mouseup",H.mouseup),H.mousedrag&&this._document.addEventListener("mousemove",H.mousedrag),this.cancel(Q)}))),this.register((0,f.addDisposableDomListener)(T,"wheel",(Q=>{if(!H.wheel){if(this._customWheelEventHandler&&this._customWheelEventHandler(Q)===!1)return!1;if(!this.buffer.hasScrollback){const he=this.viewport.getLinesScrolled(Q);if(he===0)return;const me=ie.C0.ESC+(this.coreService.decPrivateModes.applicationCursorKeys?"O":"[")+(Q.deltaY<0?"A":"B");let fe="";for(let Ae=0;Ae<Math.abs(he);Ae++)fe+=me;return this.coreService.triggerDataEvent(fe,!0),this.cancel(Q,!0)}return this.viewport.handleWheel(Q)?this.cancel(Q):void 0}}),{passive:!1})),this.register((0,f.addDisposableDomListener)(T,"touchstart",(Q=>{if(!this.coreMouseService.areMouseEventsActive)return this.viewport.handleTouchStart(Q),this.cancel(Q)}),{passive:!0})),this.register((0,f.addDisposableDomListener)(T,"touchmove",(Q=>{if(!this.coreMouseService.areMouseEventsActive)return this.viewport.handleTouchMove(Q)?void 0:this.cancel(Q)}),{passive:!1}))}refresh(M,T){this._renderService?.refreshRows(M,T)}updateCursorStyle(M){this._selectionService?.shouldColumnSelect(M)?this.element.classList.add("column-select"):this.element.classList.remove("column-select")}_showCursor(){this.coreService.isCursorInitialized||(this.coreService.isCursorInitialized=!0,this.refresh(this.buffer.y,this.buffer.y))}scrollLines(M,T,K=0){K===1?(super.scrollLines(M,T,K),this.refresh(0,this.rows-1)):this.viewport?.scrollLines(M)}paste(M){(0,u.paste)(M,this.textarea,this.coreService,this.optionsService)}attachCustomKeyEventHandler(M){this._customKeyEventHandler=M}attachCustomWheelEventHandler(M){this._customWheelEventHandler=M}registerLinkProvider(M){return this._linkProviderService.registerLinkProvider(M)}registerCharacterJoiner(M){if(!this._characterJoinerService)throw new Error("Terminal must be opened first");const T=this._characterJoinerService.register(M);return this.refresh(0,this.rows-1),T}deregisterCharacterJoiner(M){if(!this._characterJoinerService)throw new Error("Terminal must be opened first");this._characterJoinerService.deregister(M)&&this.refresh(0,this.rows-1)}get markers(){return this.buffer.markers}registerMarker(M){return this.buffer.addMarker(this.buffer.ybase+this.buffer.y+M)}registerDecoration(M){return this._decorationService.registerDecoration(M)}hasSelection(){return!!this._selectionService&&this._selectionService.hasSelection}select(M,T,K){this._selectionService.setSelection(M,T,K)}getSelection(){return this._selectionService?this._selectionService.selectionText:""}getSelectionPosition(){if(this._selectionService&&this._selectionService.hasSelection)return{start:{x:this._selectionService.selectionStart[0],y:this._selectionService.selectionStart[1]},end:{x:this._selectionService.selectionEnd[0],y:this._selectionService.selectionEnd[1]}}}clearSelection(){this._selectionService?.clearSelection()}selectAll(){this._selectionService?.selectAll()}selectLines(M,T){this._selectionService?.selectLines(M,T)}_keyDown(M){if(this._keyDownHandled=!1,this._keyDownSeen=!0,this._customKeyEventHandler&&this._customKeyEventHandler(M)===!1)return!1;const T=this.browser.isMac&&this.options.macOptionIsMeta&&M.altKey;if(!T&&!this._compositionHelper.keydown(M))return this.options.scrollOnUserInput&&this.buffer.ybase!==this.buffer.ydisp&&this.scrollToBottom(),!1;T||M.key!=="Dead"&&M.key!=="AltGraph"||(this._unprocessedDeadKey=!0);const K=(0,ee.evaluateKeyboardEvent)(M,this.coreService.decPrivateModes.applicationCursorKeys,this.browser.isMac,this.options.macOptionIsMeta);if(this.updateCursorStyle(M),K.type===3||K.type===2){const H=this.rows-1;return this.scrollLines(K.type===2?-H:H),this.cancel(M,!0)}return K.type===1&&this.selectAll(),!!this._isThirdLevelShift(this.browser,M)||(K.cancel&&this.cancel(M,!0),!K.key||!!(M.key&&!M.ctrlKey&&!M.altKey&&!M.metaKey&&M.key.length===1&&M.key.charCodeAt(0)>=65&&M.key.charCodeAt(0)<=90)||(this._unprocessedDeadKey?(this._unprocessedDeadKey=!1,!0):(K.key!==ie.C0.ETX&&K.key!==ie.C0.CR||(this.textarea.value=""),this._onKey.fire({key:K.key,domEvent:M}),this._showCursor(),this.coreService.triggerDataEvent(K.key,!0),!this.optionsService.rawOptions.screenReaderMode||M.altKey||M.ctrlKey?this.cancel(M,!0):void(this._keyDownHandled=!0))))}_isThirdLevelShift(M,T){const K=M.isMac&&!this.options.macOptionIsMeta&&T.altKey&&!T.ctrlKey&&!T.metaKey||M.isWindows&&T.altKey&&T.ctrlKey&&!T.metaKey||M.isWindows&&T.getModifierState("AltGraph");return T.type==="keypress"?K:K&&(!T.keyCode||T.keyCode>47)}_keyUp(M){this._keyDownSeen=!1,this._customKeyEventHandler&&this._customKeyEventHandler(M)===!1||((function(T){return T.keyCode===16||T.keyCode===17||T.keyCode===18})(M)||this.focus(),this.updateCursorStyle(M),this._keyPressHandled=!1)}_keyPress(M){let T;if(this._keyPressHandled=!1,this._keyDownHandled||this._customKeyEventHandler&&this._customKeyEventHandler(M)===!1)return!1;if(this.cancel(M),M.charCode)T=M.charCode;else if(M.which===null||M.which===void 0)T=M.keyCode;else{if(M.which===0||M.charCode===0)return!1;T=M.which}return!(!T||(M.altKey||M.ctrlKey||M.metaKey)&&!this._isThirdLevelShift(this.browser,M)||(T=String.fromCharCode(T),this._onKey.fire({key:T,domEvent:M}),this._showCursor(),this.coreService.triggerDataEvent(T,!0),this._keyPressHandled=!0,this._unprocessedDeadKey=!1,0))}_inputEvent(M){if(M.data&&M.inputType==="insertText"&&(!M.composed||!this._keyDownSeen)&&!this.optionsService.rawOptions.screenReaderMode){if(this._keyPressHandled)return!1;this._unprocessedDeadKey=!1;const T=M.data;return this.coreService.triggerDataEvent(T,!0),this.cancel(M),!0}return!1}resize(M,T){M!==this.cols||T!==this.rows?super.resize(M,T):this._charSizeService&&!this._charSizeService.hasValidSize&&this._charSizeService.measure()}_afterResize(M,T){this._charSizeService?.measure(),this.viewport?.syncScrollArea(!0)}clear(){if(this.buffer.ybase!==0||this.buffer.y!==0){this.buffer.clearAllMarkers(),this.buffer.lines.set(0,this.buffer.lines.get(this.buffer.ybase+this.buffer.y)),this.buffer.lines.length=1,this.buffer.ydisp=0,this.buffer.ybase=0,this.buffer.y=0;for(let M=1;M<this.rows;M++)this.buffer.lines.push(this.buffer.getBlankLine(re.DEFAULT_ATTR_DATA));this._onScroll.fire({position:this.buffer.ydisp,source:0}),this.viewport?.reset(),this.refresh(0,this.rows-1)}}reset(){this.options.rows=this.rows,this.options.cols=this.cols;const M=this._customKeyEventHandler;this._setup(),super.reset(),this._selectionService?.reset(),this._decorationService.reset(),this.viewport?.reset(),this._customKeyEventHandler=M,this.refresh(0,this.rows-1)}clearTextureAtlas(){this._renderService?.clearTextureAtlas()}_reportFocus(){this.element?.classList.contains("focus")?this.coreService.triggerDataEvent(ie.C0.ESC+"[I"):this.coreService.triggerDataEvent(ie.C0.ESC+"[O")}_reportWindowsOptions(M){if(this._renderService)switch(M){case z.WindowsOptionsReportType.GET_WIN_SIZE_PIXELS:const T=this._renderService.dimensions.css.canvas.width.toFixed(0),K=this._renderService.dimensions.css.canvas.height.toFixed(0);this.coreService.triggerDataEvent(`${ie.C0.ESC}[4;${K};${T}t`);break;case z.WindowsOptionsReportType.GET_CELL_SIZE_PIXELS:const H=this._renderService.dimensions.css.cell.width.toFixed(0),X=this._renderService.dimensions.css.cell.height.toFixed(0);this.coreService.triggerDataEvent(`${ie.C0.ESC}[6;${X};${H}t`)}}cancel(M,T){if(this.options.cancelEvents||T)return M.preventDefault(),M.stopPropagation(),!1}}r.Terminal=G},9924:(c,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.TimeBasedDebouncer=void 0,r.TimeBasedDebouncer=class{constructor(o,u=1e3){this._renderCallback=o,this._debounceThresholdMS=u,this._lastRefreshMs=0,this._additionalRefreshRequested=!1}dispose(){this._refreshTimeoutID&&clearTimeout(this._refreshTimeoutID)}refresh(o,u,f){this._rowCount=f,o=o!==void 0?o:0,u=u!==void 0?u:this._rowCount-1,this._rowStart=this._rowStart!==void 0?Math.min(this._rowStart,o):o,this._rowEnd=this._rowEnd!==void 0?Math.max(this._rowEnd,u):u;const l=Date.now();if(l-this._lastRefreshMs>=this._debounceThresholdMS)this._lastRefreshMs=l,this._innerRefresh();else if(!this._additionalRefreshRequested){const m=l-this._lastRefreshMs,g=this._debounceThresholdMS-m;this._additionalRefreshRequested=!0,this._refreshTimeoutID=window.setTimeout((()=>{this._lastRefreshMs=Date.now(),this._innerRefresh(),this._additionalRefreshRequested=!1,this._refreshTimeoutID=void 0}),g)}}_innerRefresh(){if(this._rowStart===void 0||this._rowEnd===void 0||this._rowCount===void 0)return;const o=Math.max(this._rowStart,0),u=Math.min(this._rowEnd,this._rowCount-1);this._rowStart=void 0,this._rowEnd=void 0,this._renderCallback(o,u)}}},1680:function(c,r,o){var u=this&&this.__decorate||function(p,_,d,y){var S,w=arguments.length,E=w<3?_:y===null?y=Object.getOwnPropertyDescriptor(_,d):y;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")E=Reflect.decorate(p,_,d,y);else for(var b=p.length-1;b>=0;b--)(S=p[b])&&(E=(w<3?S(E):w>3?S(_,d,E):S(_,d))||E);return w>3&&E&&Object.defineProperty(_,d,E),E},f=this&&this.__param||function(p,_){return function(d,y){_(d,y,p)}};Object.defineProperty(r,"__esModule",{value:!0}),r.Viewport=void 0;const l=o(3656),m=o(4725),g=o(8460),C=o(844),v=o(2585);let h=r.Viewport=class extends C.Disposable{constructor(p,_,d,y,S,w,E,b){super(),this._viewportElement=p,this._scrollArea=_,this._bufferService=d,this._optionsService=y,this._charSizeService=S,this._renderService=w,this._coreBrowserService=E,this.scrollBarWidth=0,this._currentRowHeight=0,this._currentDeviceCellHeight=0,this._lastRecordedBufferLength=0,this._lastRecordedViewportHeight=0,this._lastRecordedBufferHeight=0,this._lastTouchY=0,this._lastScrollTop=0,this._wheelPartialScroll=0,this._refreshAnimationFrame=null,this._ignoreNextScrollEvent=!1,this._smoothScrollState={startTime:0,origin:-1,target:-1},this._onRequestScrollLines=this.register(new g.EventEmitter),this.onRequestScrollLines=this._onRequestScrollLines.event,this.scrollBarWidth=this._viewportElement.offsetWidth-this._scrollArea.offsetWidth||15,this.register((0,l.addDisposableDomListener)(this._viewportElement,"scroll",this._handleScroll.bind(this))),this._activeBuffer=this._bufferService.buffer,this.register(this._bufferService.buffers.onBufferActivate((k=>this._activeBuffer=k.activeBuffer))),this._renderDimensions=this._renderService.dimensions,this.register(this._renderService.onDimensionsChange((k=>this._renderDimensions=k))),this._handleThemeChange(b.colors),this.register(b.onChangeColors((k=>this._handleThemeChange(k)))),this.register(this._optionsService.onSpecificOptionChange("scrollback",(()=>this.syncScrollArea()))),setTimeout((()=>this.syncScrollArea()))}_handleThemeChange(p){this._viewportElement.style.backgroundColor=p.background.css}reset(){this._currentRowHeight=0,this._currentDeviceCellHeight=0,this._lastRecordedBufferLength=0,this._lastRecordedViewportHeight=0,this._lastRecordedBufferHeight=0,this._lastTouchY=0,this._lastScrollTop=0,this._coreBrowserService.window.requestAnimationFrame((()=>this.syncScrollArea()))}_refresh(p){if(p)return this._innerRefresh(),void(this._refreshAnimationFrame!==null&&this._coreBrowserService.window.cancelAnimationFrame(this._refreshAnimationFrame));this._refreshAnimationFrame===null&&(this._refreshAnimationFrame=this._coreBrowserService.window.requestAnimationFrame((()=>this._innerRefresh())))}_innerRefresh(){if(this._charSizeService.height>0){this._currentRowHeight=this._renderDimensions.device.cell.height/this._coreBrowserService.dpr,this._currentDeviceCellHeight=this._renderDimensions.device.cell.height,this._lastRecordedViewportHeight=this._viewportElement.offsetHeight;const _=Math.round(this._currentRowHeight*this._lastRecordedBufferLength)+(this._lastRecordedViewportHeight-this._renderDimensions.css.canvas.height);this._lastRecordedBufferHeight!==_&&(this._lastRecordedBufferHeight=_,this._scrollArea.style.height=this._lastRecordedBufferHeight+"px")}const p=this._bufferService.buffer.ydisp*this._currentRowHeight;this._viewportElement.scrollTop!==p&&(this._ignoreNextScrollEvent=!0,this._viewportElement.scrollTop=p),this._refreshAnimationFrame=null}syncScrollArea(p=!1){if(this._lastRecordedBufferLength!==this._bufferService.buffer.lines.length)return this._lastRecordedBufferLength=this._bufferService.buffer.lines.length,void this._refresh(p);this._lastRecordedViewportHeight===this._renderService.dimensions.css.canvas.height&&this._lastScrollTop===this._activeBuffer.ydisp*this._currentRowHeight&&this._renderDimensions.device.cell.height===this._currentDeviceCellHeight||this._refresh(p)}_handleScroll(p){if(this._lastScrollTop=this._viewportElement.scrollTop,!this._viewportElement.offsetParent)return;if(this._ignoreNextScrollEvent)return this._ignoreNextScrollEvent=!1,void this._onRequestScrollLines.fire({amount:0,suppressScrollEvent:!0});const _=Math.round(this._lastScrollTop/this._currentRowHeight)-this._bufferService.buffer.ydisp;this._onRequestScrollLines.fire({amount:_,suppressScrollEvent:!0})}_smoothScroll(){if(this._isDisposed||this._smoothScrollState.origin===-1||this._smoothScrollState.target===-1)return;const p=this._smoothScrollPercent();this._viewportElement.scrollTop=this._smoothScrollState.origin+Math.round(p*(this._smoothScrollState.target-this._smoothScrollState.origin)),p<1?this._coreBrowserService.window.requestAnimationFrame((()=>this._smoothScroll())):this._clearSmoothScrollState()}_smoothScrollPercent(){return this._optionsService.rawOptions.smoothScrollDuration&&this._smoothScrollState.startTime?Math.max(Math.min((Date.now()-this._smoothScrollState.startTime)/this._optionsService.rawOptions.smoothScrollDuration,1),0):1}_clearSmoothScrollState(){this._smoothScrollState.startTime=0,this._smoothScrollState.origin=-1,this._smoothScrollState.target=-1}_bubbleScroll(p,_){const d=this._viewportElement.scrollTop+this._lastRecordedViewportHeight;return!(_<0&&this._viewportElement.scrollTop!==0||_>0&&d<this._lastRecordedBufferHeight)||(p.cancelable&&p.preventDefault(),!1)}handleWheel(p){const _=this._getPixelsScrolled(p);return _!==0&&(this._optionsService.rawOptions.smoothScrollDuration?(this._smoothScrollState.startTime=Date.now(),this._smoothScrollPercent()<1?(this._smoothScrollState.origin=this._viewportElement.scrollTop,this._smoothScrollState.target===-1?this._smoothScrollState.target=this._viewportElement.scrollTop+_:this._smoothScrollState.target+=_,this._smoothScrollState.target=Math.max(Math.min(this._smoothScrollState.target,this._viewportElement.scrollHeight),0),this._smoothScroll()):this._clearSmoothScrollState()):this._viewportElement.scrollTop+=_,this._bubbleScroll(p,_))}scrollLines(p){if(p!==0)if(this._optionsService.rawOptions.smoothScrollDuration){const _=p*this._currentRowHeight;this._smoothScrollState.startTime=Date.now(),this._smoothScrollPercent()<1?(this._smoothScrollState.origin=this._viewportElement.scrollTop,this._smoothScrollState.target=this._smoothScrollState.origin+_,this._smoothScrollState.target=Math.max(Math.min(this._smoothScrollState.target,this._viewportElement.scrollHeight),0),this._smoothScroll()):this._clearSmoothScrollState()}else this._onRequestScrollLines.fire({amount:p,suppressScrollEvent:!1})}_getPixelsScrolled(p){if(p.deltaY===0||p.shiftKey)return 0;let _=this._applyScrollModifier(p.deltaY,p);return p.deltaMode===WheelEvent.DOM_DELTA_LINE?_*=this._currentRowHeight:p.deltaMode===WheelEvent.DOM_DELTA_PAGE&&(_*=this._currentRowHeight*this._bufferService.rows),_}getBufferElements(p,_){let d,y="";const S=[],w=_??this._bufferService.buffer.lines.length,E=this._bufferService.buffer.lines;for(let b=p;b<w;b++){const k=E.get(b);if(!k)continue;const R=E.get(b+1)?.isWrapped;if(y+=k.translateToString(!R),!R||b===E.length-1){const O=document.createElement("div");O.textContent=y,S.push(O),y.length>0&&(d=O),y=""}}return{bufferElements:S,cursorElement:d}}getLinesScrolled(p){if(p.deltaY===0||p.shiftKey)return 0;let _=this._applyScrollModifier(p.deltaY,p);return p.deltaMode===WheelEvent.DOM_DELTA_PIXEL?(_/=this._currentRowHeight+0,this._wheelPartialScroll+=_,_=Math.floor(Math.abs(this._wheelPartialScroll))*(this._wheelPartialScroll>0?1:-1),this._wheelPartialScroll%=1):p.deltaMode===WheelEvent.DOM_DELTA_PAGE&&(_*=this._bufferService.rows),_}_applyScrollModifier(p,_){const d=this._optionsService.rawOptions.fastScrollModifier;return d==="alt"&&_.altKey||d==="ctrl"&&_.ctrlKey||d==="shift"&&_.shiftKey?p*this._optionsService.rawOptions.fastScrollSensitivity*this._optionsService.rawOptions.scrollSensitivity:p*this._optionsService.rawOptions.scrollSensitivity}handleTouchStart(p){this._lastTouchY=p.touches[0].pageY}handleTouchMove(p){const _=this._lastTouchY-p.touches[0].pageY;return this._lastTouchY=p.touches[0].pageY,_!==0&&(this._viewportElement.scrollTop+=_,this._bubbleScroll(p,_))}};r.Viewport=h=u([f(2,v.IBufferService),f(3,v.IOptionsService),f(4,m.ICharSizeService),f(5,m.IRenderService),f(6,m.ICoreBrowserService),f(7,m.IThemeService)],h)},3107:function(c,r,o){var u=this&&this.__decorate||function(v,h,p,_){var d,y=arguments.length,S=y<3?h:_===null?_=Object.getOwnPropertyDescriptor(h,p):_;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")S=Reflect.decorate(v,h,p,_);else for(var w=v.length-1;w>=0;w--)(d=v[w])&&(S=(y<3?d(S):y>3?d(h,p,S):d(h,p))||S);return y>3&&S&&Object.defineProperty(h,p,S),S},f=this&&this.__param||function(v,h){return function(p,_){h(p,_,v)}};Object.defineProperty(r,"__esModule",{value:!0}),r.BufferDecorationRenderer=void 0;const l=o(4725),m=o(844),g=o(2585);let C=r.BufferDecorationRenderer=class extends m.Disposable{constructor(v,h,p,_,d){super(),this._screenElement=v,this._bufferService=h,this._coreBrowserService=p,this._decorationService=_,this._renderService=d,this._decorationElements=new Map,this._altBufferIsActive=!1,this._dimensionsChanged=!1,this._container=document.createElement("div"),this._container.classList.add("xterm-decoration-container"),this._screenElement.appendChild(this._container),this.register(this._renderService.onRenderedViewportChange((()=>this._doRefreshDecorations()))),this.register(this._renderService.onDimensionsChange((()=>{this._dimensionsChanged=!0,this._queueRefresh()}))),this.register(this._coreBrowserService.onDprChange((()=>this._queueRefresh()))),this.register(this._bufferService.buffers.onBufferActivate((()=>{this._altBufferIsActive=this._bufferService.buffer===this._bufferService.buffers.alt}))),this.register(this._decorationService.onDecorationRegistered((()=>this._queueRefresh()))),this.register(this._decorationService.onDecorationRemoved((y=>this._removeDecoration(y)))),this.register((0,m.toDisposable)((()=>{this._container.remove(),this._decorationElements.clear()})))}_queueRefresh(){this._animationFrame===void 0&&(this._animationFrame=this._renderService.addRefreshCallback((()=>{this._doRefreshDecorations(),this._animationFrame=void 0})))}_doRefreshDecorations(){for(const v of this._decorationService.decorations)this._renderDecoration(v);this._dimensionsChanged=!1}_renderDecoration(v){this._refreshStyle(v),this._dimensionsChanged&&this._refreshXPosition(v)}_createElement(v){const h=this._coreBrowserService.mainDocument.createElement("div");h.classList.add("xterm-decoration"),h.classList.toggle("xterm-decoration-top-layer",v?.options?.layer==="top"),h.style.width=`${Math.round((v.options.width||1)*this._renderService.dimensions.css.cell.width)}px`,h.style.height=(v.options.height||1)*this._renderService.dimensions.css.cell.height+"px",h.style.top=(v.marker.line-this._bufferService.buffers.active.ydisp)*this._renderService.dimensions.css.cell.height+"px",h.style.lineHeight=`${this._renderService.dimensions.css.cell.height}px`;const p=v.options.x??0;return p&&p>this._bufferService.cols&&(h.style.display="none"),this._refreshXPosition(v,h),h}_refreshStyle(v){const h=v.marker.line-this._bufferService.buffers.active.ydisp;if(h<0||h>=this._bufferService.rows)v.element&&(v.element.style.display="none",v.onRenderEmitter.fire(v.element));else{let p=this._decorationElements.get(v);p||(p=this._createElement(v),v.element=p,this._decorationElements.set(v,p),this._container.appendChild(p),v.onDispose((()=>{this._decorationElements.delete(v),p.remove()}))),p.style.top=h*this._renderService.dimensions.css.cell.height+"px",p.style.display=this._altBufferIsActive?"none":"block",v.onRenderEmitter.fire(p)}}_refreshXPosition(v,h=v.element){if(!h)return;const p=v.options.x??0;(v.options.anchor||"left")==="right"?h.style.right=p?p*this._renderService.dimensions.css.cell.width+"px":"":h.style.left=p?p*this._renderService.dimensions.css.cell.width+"px":""}_removeDecoration(v){this._decorationElements.get(v)?.remove(),this._decorationElements.delete(v),v.dispose()}};r.BufferDecorationRenderer=C=u([f(1,g.IBufferService),f(2,l.ICoreBrowserService),f(3,g.IDecorationService),f(4,l.IRenderService)],C)},5871:(c,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.ColorZoneStore=void 0,r.ColorZoneStore=class{constructor(){this._zones=[],this._zonePool=[],this._zonePoolIndex=0,this._linePadding={full:0,left:0,center:0,right:0}}get zones(){return this._zonePool.length=Math.min(this._zonePool.length,this._zones.length),this._zones}clear(){this._zones.length=0,this._zonePoolIndex=0}addDecoration(o){if(o.options.overviewRulerOptions){for(const u of this._zones)if(u.color===o.options.overviewRulerOptions.color&&u.position===o.options.overviewRulerOptions.position){if(this._lineIntersectsZone(u,o.marker.line))return;if(this._lineAdjacentToZone(u,o.marker.line,o.options.overviewRulerOptions.position))return void this._addLineToZone(u,o.marker.line)}if(this._zonePoolIndex<this._zonePool.length)return this._zonePool[this._zonePoolIndex].color=o.options.overviewRulerOptions.color,this._zonePool[this._zonePoolIndex].position=o.options.overviewRulerOptions.position,this._zonePool[this._zonePoolIndex].startBufferLine=o.marker.line,this._zonePool[this._zonePoolIndex].endBufferLine=o.marker.line,void this._zones.push(this._zonePool[this._zonePoolIndex++]);this._zones.push({color:o.options.overviewRulerOptions.color,position:o.options.overviewRulerOptions.position,startBufferLine:o.marker.line,endBufferLine:o.marker.line}),this._zonePool.push(this._zones[this._zones.length-1]),this._zonePoolIndex++}}setPadding(o){this._linePadding=o}_lineIntersectsZone(o,u){return u>=o.startBufferLine&&u<=o.endBufferLine}_lineAdjacentToZone(o,u,f){return u>=o.startBufferLine-this._linePadding[f||"full"]&&u<=o.endBufferLine+this._linePadding[f||"full"]}_addLineToZone(o,u){o.startBufferLine=Math.min(o.startBufferLine,u),o.endBufferLine=Math.max(o.endBufferLine,u)}}},5744:function(c,r,o){var u=this&&this.__decorate||function(d,y,S,w){var E,b=arguments.length,k=b<3?y:w===null?w=Object.getOwnPropertyDescriptor(y,S):w;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")k=Reflect.decorate(d,y,S,w);else for(var R=d.length-1;R>=0;R--)(E=d[R])&&(k=(b<3?E(k):b>3?E(y,S,k):E(y,S))||k);return b>3&&k&&Object.defineProperty(y,S,k),k},f=this&&this.__param||function(d,y){return function(S,w){y(S,w,d)}};Object.defineProperty(r,"__esModule",{value:!0}),r.OverviewRulerRenderer=void 0;const l=o(5871),m=o(4725),g=o(844),C=o(2585),v={full:0,left:0,center:0,right:0},h={full:0,left:0,center:0,right:0},p={full:0,left:0,center:0,right:0};let _=r.OverviewRulerRenderer=class extends g.Disposable{get _width(){return this._optionsService.options.overviewRulerWidth||0}constructor(d,y,S,w,E,b,k){super(),this._viewportElement=d,this._screenElement=y,this._bufferService=S,this._decorationService=w,this._renderService=E,this._optionsService=b,this._coreBrowserService=k,this._colorZoneStore=new l.ColorZoneStore,this._shouldUpdateDimensions=!0,this._shouldUpdateAnchor=!0,this._lastKnownBufferLength=0,this._canvas=this._coreBrowserService.mainDocument.createElement("canvas"),this._canvas.classList.add("xterm-decoration-overview-ruler"),this._refreshCanvasDimensions(),this._viewportElement.parentElement?.insertBefore(this._canvas,this._viewportElement);const R=this._canvas.getContext("2d");if(!R)throw new Error("Ctx cannot be null");this._ctx=R,this._registerDecorationListeners(),this._registerBufferChangeListeners(),this._registerDimensionChangeListeners(),this.register((0,g.toDisposable)((()=>{this._canvas?.remove()})))}_registerDecorationListeners(){this.register(this._decorationService.onDecorationRegistered((()=>this._queueRefresh(void 0,!0)))),this.register(this._decorationService.onDecorationRemoved((()=>this._queueRefresh(void 0,!0))))}_registerBufferChangeListeners(){this.register(this._renderService.onRenderedViewportChange((()=>this._queueRefresh()))),this.register(this._bufferService.buffers.onBufferActivate((()=>{this._canvas.style.display=this._bufferService.buffer===this._bufferService.buffers.alt?"none":"block"}))),this.register(this._bufferService.onScroll((()=>{this._lastKnownBufferLength!==this._bufferService.buffers.normal.lines.length&&(this._refreshDrawHeightConstants(),this._refreshColorZonePadding())})))}_registerDimensionChangeListeners(){this.register(this._renderService.onRender((()=>{this._containerHeight&&this._containerHeight===this._screenElement.clientHeight||(this._queueRefresh(!0),this._containerHeight=this._screenElement.clientHeight)}))),this.register(this._optionsService.onSpecificOptionChange("overviewRulerWidth",(()=>this._queueRefresh(!0)))),this.register(this._coreBrowserService.onDprChange((()=>this._queueRefresh(!0)))),this._queueRefresh(!0)}_refreshDrawConstants(){const d=Math.floor(this._canvas.width/3),y=Math.ceil(this._canvas.width/3);h.full=this._canvas.width,h.left=d,h.center=y,h.right=d,this._refreshDrawHeightConstants(),p.full=0,p.left=0,p.center=h.left,p.right=h.left+h.center}_refreshDrawHeightConstants(){v.full=Math.round(2*this._coreBrowserService.dpr);const d=this._canvas.height/this._bufferService.buffer.lines.length,y=Math.round(Math.max(Math.min(d,12),6)*this._coreBrowserService.dpr);v.left=y,v.center=y,v.right=y}_refreshColorZonePadding(){this._colorZoneStore.setPadding({full:Math.floor(this._bufferService.buffers.active.lines.length/(this._canvas.height-1)*v.full),left:Math.floor(this._bufferService.buffers.active.lines.length/(this._canvas.height-1)*v.left),center:Math.floor(this._bufferService.buffers.active.lines.length/(this._canvas.height-1)*v.center),right:Math.floor(this._bufferService.buffers.active.lines.length/(this._canvas.height-1)*v.right)}),this._lastKnownBufferLength=this._bufferService.buffers.normal.lines.length}_refreshCanvasDimensions(){this._canvas.style.width=`${this._width}px`,this._canvas.width=Math.round(this._width*this._coreBrowserService.dpr),this._canvas.style.height=`${this._screenElement.clientHeight}px`,this._canvas.height=Math.round(this._screenElement.clientHeight*this._coreBrowserService.dpr),this._refreshDrawConstants(),this._refreshColorZonePadding()}_refreshDecorations(){this._shouldUpdateDimensions&&this._refreshCanvasDimensions(),this._ctx.clearRect(0,0,this._canvas.width,this._canvas.height),this._colorZoneStore.clear();for(const y of this._decorationService.decorations)this._colorZoneStore.addDecoration(y);this._ctx.lineWidth=1;const d=this._colorZoneStore.zones;for(const y of d)y.position!=="full"&&this._renderColorZone(y);for(const y of d)y.position==="full"&&this._renderColorZone(y);this._shouldUpdateDimensions=!1,this._shouldUpdateAnchor=!1}_renderColorZone(d){this._ctx.fillStyle=d.color,this._ctx.fillRect(p[d.position||"full"],Math.round((this._canvas.height-1)*(d.startBufferLine/this._bufferService.buffers.active.lines.length)-v[d.position||"full"]/2),h[d.position||"full"],Math.round((this._canvas.height-1)*((d.endBufferLine-d.startBufferLine)/this._bufferService.buffers.active.lines.length)+v[d.position||"full"]))}_queueRefresh(d,y){this._shouldUpdateDimensions=d||this._shouldUpdateDimensions,this._shouldUpdateAnchor=y||this._shouldUpdateAnchor,this._animationFrame===void 0&&(this._animationFrame=this._coreBrowserService.window.requestAnimationFrame((()=>{this._refreshDecorations(),this._animationFrame=void 0})))}};r.OverviewRulerRenderer=_=u([f(2,C.IBufferService),f(3,C.IDecorationService),f(4,m.IRenderService),f(5,C.IOptionsService),f(6,m.ICoreBrowserService)],_)},2950:function(c,r,o){var u=this&&this.__decorate||function(v,h,p,_){var d,y=arguments.length,S=y<3?h:_===null?_=Object.getOwnPropertyDescriptor(h,p):_;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")S=Reflect.decorate(v,h,p,_);else for(var w=v.length-1;w>=0;w--)(d=v[w])&&(S=(y<3?d(S):y>3?d(h,p,S):d(h,p))||S);return y>3&&S&&Object.defineProperty(h,p,S),S},f=this&&this.__param||function(v,h){return function(p,_){h(p,_,v)}};Object.defineProperty(r,"__esModule",{value:!0}),r.CompositionHelper=void 0;const l=o(4725),m=o(2585),g=o(2584);let C=r.CompositionHelper=class{get isComposing(){return this._isComposing}constructor(v,h,p,_,d,y){this._textarea=v,this._compositionView=h,this._bufferService=p,this._optionsService=_,this._coreService=d,this._renderService=y,this._isComposing=!1,this._isSendingComposition=!1,this._compositionPosition={start:0,end:0},this._dataAlreadySent=""}compositionstart(){this._isComposing=!0,this._compositionPosition.start=this._textarea.value.length,this._compositionView.textContent="",this._dataAlreadySent="",this._compositionView.classList.add("active")}compositionupdate(v){this._compositionView.textContent=v.data,this.updateCompositionElements(),setTimeout((()=>{this._compositionPosition.end=this._textarea.value.length}),0)}compositionend(){this._finalizeComposition(!0)}keydown(v){if(this._isComposing||this._isSendingComposition){if(v.keyCode===229||v.keyCode===16||v.keyCode===17||v.keyCode===18)return!1;this._finalizeComposition(!1)}return v.keyCode!==229||(this._handleAnyTextareaChanges(),!1)}_finalizeComposition(v){if(this._compositionView.classList.remove("active"),this._isComposing=!1,v){const h={start:this._compositionPosition.start,end:this._compositionPosition.end};this._isSendingComposition=!0,setTimeout((()=>{if(this._isSendingComposition){let p;this._isSendingComposition=!1,h.start+=this._dataAlreadySent.length,p=this._isComposing?this._textarea.value.substring(h.start,h.end):this._textarea.value.substring(h.start),p.length>0&&this._coreService.triggerDataEvent(p,!0)}}),0)}else{this._isSendingComposition=!1;const h=this._textarea.value.substring(this._compositionPosition.start,this._compositionPosition.end);this._coreService.triggerDataEvent(h,!0)}}_handleAnyTextareaChanges(){const v=this._textarea.value;setTimeout((()=>{if(!this._isComposing){const h=this._textarea.value,p=h.replace(v,"");this._dataAlreadySent=p,h.length>v.length?this._coreService.triggerDataEvent(p,!0):h.length<v.length?this._coreService.triggerDataEvent(`${g.C0.DEL}`,!0):h.length===v.length&&h!==v&&this._coreService.triggerDataEvent(h,!0)}}),0)}updateCompositionElements(v){if(this._isComposing){if(this._bufferService.buffer.isCursorInViewport){const h=Math.min(this._bufferService.buffer.x,this._bufferService.cols-1),p=this._renderService.dimensions.css.cell.height,_=this._bufferService.buffer.y*this._renderService.dimensions.css.cell.height,d=h*this._renderService.dimensions.css.cell.width;this._compositionView.style.left=d+"px",this._compositionView.style.top=_+"px",this._compositionView.style.height=p+"px",this._compositionView.style.lineHeight=p+"px",this._compositionView.style.fontFamily=this._optionsService.rawOptions.fontFamily,this._compositionView.style.fontSize=this._optionsService.rawOptions.fontSize+"px";const y=this._compositionView.getBoundingClientRect();this._textarea.style.left=d+"px",this._textarea.style.top=_+"px",this._textarea.style.width=Math.max(y.width,1)+"px",this._textarea.style.height=Math.max(y.height,1)+"px",this._textarea.style.lineHeight=y.height+"px"}v||setTimeout((()=>this.updateCompositionElements(!0)),0)}}};r.CompositionHelper=C=u([f(2,m.IBufferService),f(3,m.IOptionsService),f(4,m.ICoreService),f(5,l.IRenderService)],C)},9806:(c,r)=>{function o(u,f,l){const m=l.getBoundingClientRect(),g=u.getComputedStyle(l),C=parseInt(g.getPropertyValue("padding-left")),v=parseInt(g.getPropertyValue("padding-top"));return[f.clientX-m.left-C,f.clientY-m.top-v]}Object.defineProperty(r,"__esModule",{value:!0}),r.getCoords=r.getCoordsRelativeToElement=void 0,r.getCoordsRelativeToElement=o,r.getCoords=function(u,f,l,m,g,C,v,h,p){if(!C)return;const _=o(u,f,l);return _?(_[0]=Math.ceil((_[0]+(p?v/2:0))/v),_[1]=Math.ceil(_[1]/h),_[0]=Math.min(Math.max(_[0],1),m+(p?1:0)),_[1]=Math.min(Math.max(_[1],1),g),_):void 0}},9504:(c,r,o)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.moveToCellSequence=void 0;const u=o(2584);function f(h,p,_,d){const y=h-l(h,_),S=p-l(p,_),w=Math.abs(y-S)-(function(E,b,k){let R=0;const O=E-l(E,k),P=b-l(b,k);for(let L=0;L<Math.abs(O-P);L++){const q=m(E,b)==="A"?-1:1;k.buffer.lines.get(O+q*L)?.isWrapped&&R++}return R})(h,p,_);return v(w,C(m(h,p),d))}function l(h,p){let _=0,d=p.buffer.lines.get(h),y=d?.isWrapped;for(;y&&h>=0&&h<p.rows;)_++,d=p.buffer.lines.get(--h),y=d?.isWrapped;return _}function m(h,p){return h>p?"A":"B"}function g(h,p,_,d,y,S){let w=h,E=p,b="";for(;w!==_||E!==d;)w+=y?1:-1,y&&w>S.cols-1?(b+=S.buffer.translateBufferLineToString(E,!1,h,w),w=0,h=0,E++):!y&&w<0&&(b+=S.buffer.translateBufferLineToString(E,!1,0,h+1),w=S.cols-1,h=w,E--);return b+S.buffer.translateBufferLineToString(E,!1,h,w)}function C(h,p){const _=p?"O":"[";return u.C0.ESC+_+h}function v(h,p){h=Math.floor(h);let _="";for(let d=0;d<h;d++)_+=p;return _}r.moveToCellSequence=function(h,p,_,d){const y=_.buffer.x,S=_.buffer.y;if(!_.buffer.hasScrollback)return(function(b,k,R,O,P,L){return f(k,O,P,L).length===0?"":v(g(b,k,b,k-l(k,P),!1,P).length,C("D",L))})(y,S,0,p,_,d)+f(S,p,_,d)+(function(b,k,R,O,P,L){let q;q=f(k,O,P,L).length>0?O-l(O,P):k;const J=O,re=(function(ie,ee,x,B,U,z){let se;return se=f(x,B,U,z).length>0?B-l(B,U):ee,ie<x&&se<=B||ie>=x&&se<B?"C":"D"})(b,k,R,O,P,L);return v(g(b,q,R,J,re==="C",P).length,C(re,L))})(y,S,h,p,_,d);let w;if(S===p)return w=y>h?"D":"C",v(Math.abs(y-h),C(w,d));w=S>p?"D":"C";const E=Math.abs(S-p);return v((function(b,k){return k.cols-b})(S>p?h:y,_)+(E-1)*_.cols+1+((S>p?y:h)-1),C(w,d))}},1296:function(c,r,o){var u=this&&this.__decorate||function(L,q,J,re){var ie,ee=arguments.length,x=ee<3?q:re===null?re=Object.getOwnPropertyDescriptor(q,J):re;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")x=Reflect.decorate(L,q,J,re);else for(var B=L.length-1;B>=0;B--)(ie=L[B])&&(x=(ee<3?ie(x):ee>3?ie(q,J,x):ie(q,J))||x);return ee>3&&x&&Object.defineProperty(q,J,x),x},f=this&&this.__param||function(L,q){return function(J,re){q(J,re,L)}};Object.defineProperty(r,"__esModule",{value:!0}),r.DomRenderer=void 0;const l=o(3787),m=o(2550),g=o(2223),C=o(6171),v=o(6052),h=o(4725),p=o(8055),_=o(8460),d=o(844),y=o(2585),S="xterm-dom-renderer-owner-",w="xterm-rows",E="xterm-fg-",b="xterm-bg-",k="xterm-focus",R="xterm-selection";let O=1,P=r.DomRenderer=class extends d.Disposable{constructor(L,q,J,re,ie,ee,x,B,U,z,se,j,G){super(),this._terminal=L,this._document=q,this._element=J,this._screenElement=re,this._viewportElement=ie,this._helperContainer=ee,this._linkifier2=x,this._charSizeService=U,this._optionsService=z,this._bufferService=se,this._coreBrowserService=j,this._themeService=G,this._terminalClass=O++,this._rowElements=[],this._selectionRenderModel=(0,v.createSelectionRenderModel)(),this.onRequestRedraw=this.register(new _.EventEmitter).event,this._rowContainer=this._document.createElement("div"),this._rowContainer.classList.add(w),this._rowContainer.style.lineHeight="normal",this._rowContainer.setAttribute("aria-hidden","true"),this._refreshRowElements(this._bufferService.cols,this._bufferService.rows),this._selectionContainer=this._document.createElement("div"),this._selectionContainer.classList.add(R),this._selectionContainer.setAttribute("aria-hidden","true"),this.dimensions=(0,C.createRenderDimensions)(),this._updateDimensions(),this.register(this._optionsService.onOptionChange((()=>this._handleOptionsChanged()))),this.register(this._themeService.onChangeColors((Y=>this._injectCss(Y)))),this._injectCss(this._themeService.colors),this._rowFactory=B.createInstance(l.DomRendererRowFactory,document),this._element.classList.add(S+this._terminalClass),this._screenElement.appendChild(this._rowContainer),this._screenElement.appendChild(this._selectionContainer),this.register(this._linkifier2.onShowLinkUnderline((Y=>this._handleLinkHover(Y)))),this.register(this._linkifier2.onHideLinkUnderline((Y=>this._handleLinkLeave(Y)))),this.register((0,d.toDisposable)((()=>{this._element.classList.remove(S+this._terminalClass),this._rowContainer.remove(),this._selectionContainer.remove(),this._widthCache.dispose(),this._themeStyleElement.remove(),this._dimensionsStyleElement.remove()}))),this._widthCache=new m.WidthCache(this._document,this._helperContainer),this._widthCache.setFont(this._optionsService.rawOptions.fontFamily,this._optionsService.rawOptions.fontSize,this._optionsService.rawOptions.fontWeight,this._optionsService.rawOptions.fontWeightBold),this._setDefaultSpacing()}_updateDimensions(){const L=this._coreBrowserService.dpr;this.dimensions.device.char.width=this._charSizeService.width*L,this.dimensions.device.char.height=Math.ceil(this._charSizeService.height*L),this.dimensions.device.cell.width=this.dimensions.device.char.width+Math.round(this._optionsService.rawOptions.letterSpacing),this.dimensions.device.cell.height=Math.floor(this.dimensions.device.char.height*this._optionsService.rawOptions.lineHeight),this.dimensions.device.char.left=0,this.dimensions.device.char.top=0,this.dimensions.device.canvas.width=this.dimensions.device.cell.width*this._bufferService.cols,this.dimensions.device.canvas.height=this.dimensions.device.cell.height*this._bufferService.rows,this.dimensions.css.canvas.width=Math.round(this.dimensions.device.canvas.width/L),this.dimensions.css.canvas.height=Math.round(this.dimensions.device.canvas.height/L),this.dimensions.css.cell.width=this.dimensions.css.canvas.width/this._bufferService.cols,this.dimensions.css.cell.height=this.dimensions.css.canvas.height/this._bufferService.rows;for(const J of this._rowElements)J.style.width=`${this.dimensions.css.canvas.width}px`,J.style.height=`${this.dimensions.css.cell.height}px`,J.style.lineHeight=`${this.dimensions.css.cell.height}px`,J.style.overflow="hidden";this._dimensionsStyleElement||(this._dimensionsStyleElement=this._document.createElement("style"),this._screenElement.appendChild(this._dimensionsStyleElement));const q=`${this._terminalSelector} .${w} span { display: inline-block; height: 100%; vertical-align: top;}`;this._dimensionsStyleElement.textContent=q,this._selectionContainer.style.height=this._viewportElement.style.height,this._screenElement.style.width=`${this.dimensions.css.canvas.width}px`,this._screenElement.style.height=`${this.dimensions.css.canvas.height}px`}_injectCss(L){this._themeStyleElement||(this._themeStyleElement=this._document.createElement("style"),this._screenElement.appendChild(this._themeStyleElement));let q=`${this._terminalSelector} .${w} { color: ${L.foreground.css}; font-family: ${this._optionsService.rawOptions.fontFamily}; font-size: ${this._optionsService.rawOptions.fontSize}px; font-kerning: none; white-space: pre}`;q+=`${this._terminalSelector} .${w} .xterm-dim { color: ${p.color.multiplyOpacity(L.foreground,.5).css};}`,q+=`${this._terminalSelector} span:not(.xterm-bold) { font-weight: ${this._optionsService.rawOptions.fontWeight};}${this._terminalSelector} span.xterm-bold { font-weight: ${this._optionsService.rawOptions.fontWeightBold};}${this._terminalSelector} span.xterm-italic { font-style: italic;}`;const J=`blink_underline_${this._terminalClass}`,re=`blink_bar_${this._terminalClass}`,ie=`blink_block_${this._terminalClass}`;q+=`@keyframes ${J} { 50% {  border-bottom-style: hidden; }}`,q+=`@keyframes ${re} { 50% {  box-shadow: none; }}`,q+=`@keyframes ${ie} { 0% {  background-color: ${L.cursor.css};  color: ${L.cursorAccent.css}; } 50% {  background-color: inherit;  color: ${L.cursor.css}; }}`,q+=`${this._terminalSelector} .${w}.${k} .xterm-cursor.xterm-cursor-blink.xterm-cursor-underline { animation: ${J} 1s step-end infinite;}${this._terminalSelector} .${w}.${k} .xterm-cursor.xterm-cursor-blink.xterm-cursor-bar { animation: ${re} 1s step-end infinite;}${this._terminalSelector} .${w}.${k} .xterm-cursor.xterm-cursor-blink.xterm-cursor-block { animation: ${ie} 1s step-end infinite;}${this._terminalSelector} .${w} .xterm-cursor.xterm-cursor-block { background-color: ${L.cursor.css}; color: ${L.cursorAccent.css};}${this._terminalSelector} .${w} .xterm-cursor.xterm-cursor-block:not(.xterm-cursor-blink) { background-color: ${L.cursor.css} !important; color: ${L.cursorAccent.css} !important;}${this._terminalSelector} .${w} .xterm-cursor.xterm-cursor-outline { outline: 1px solid ${L.cursor.css}; outline-offset: -1px;}${this._terminalSelector} .${w} .xterm-cursor.xterm-cursor-bar { box-shadow: ${this._optionsService.rawOptions.cursorWidth}px 0 0 ${L.cursor.css} inset;}${this._terminalSelector} .${w} .xterm-cursor.xterm-cursor-underline { border-bottom: 1px ${L.cursor.css}; border-bottom-style: solid; height: calc(100% - 1px);}`,q+=`${this._terminalSelector} .${R} { position: absolute; top: 0; left: 0; z-index: 1; pointer-events: none;}${this._terminalSelector}.focus .${R} div { position: absolute; background-color: ${L.selectionBackgroundOpaque.css};}${this._terminalSelector} .${R} div { position: absolute; background-color: ${L.selectionInactiveBackgroundOpaque.css};}`;for(const[ee,x]of L.ansi.entries())q+=`${this._terminalSelector} .${E}${ee} { color: ${x.css}; }${this._terminalSelector} .${E}${ee}.xterm-dim { color: ${p.color.multiplyOpacity(x,.5).css}; }${this._terminalSelector} .${b}${ee} { background-color: ${x.css}; }`;q+=`${this._terminalSelector} .${E}${g.INVERTED_DEFAULT_COLOR} { color: ${p.color.opaque(L.background).css}; }${this._terminalSelector} .${E}${g.INVERTED_DEFAULT_COLOR}.xterm-dim { color: ${p.color.multiplyOpacity(p.color.opaque(L.background),.5).css}; }${this._terminalSelector} .${b}${g.INVERTED_DEFAULT_COLOR} { background-color: ${L.foreground.css}; }`,this._themeStyleElement.textContent=q}_setDefaultSpacing(){const L=this.dimensions.css.cell.width-this._widthCache.get("W",!1,!1);this._rowContainer.style.letterSpacing=`${L}px`,this._rowFactory.defaultSpacing=L}handleDevicePixelRatioChange(){this._updateDimensions(),this._widthCache.clear(),this._setDefaultSpacing()}_refreshRowElements(L,q){for(let J=this._rowElements.length;J<=q;J++){const re=this._document.createElement("div");this._rowContainer.appendChild(re),this._rowElements.push(re)}for(;this._rowElements.length>q;)this._rowContainer.removeChild(this._rowElements.pop())}handleResize(L,q){this._refreshRowElements(L,q),this._updateDimensions(),this.handleSelectionChanged(this._selectionRenderModel.selectionStart,this._selectionRenderModel.selectionEnd,this._selectionRenderModel.columnSelectMode)}handleCharSizeChanged(){this._updateDimensions(),this._widthCache.clear(),this._setDefaultSpacing()}handleBlur(){this._rowContainer.classList.remove(k),this.renderRows(0,this._bufferService.rows-1)}handleFocus(){this._rowContainer.classList.add(k),this.renderRows(this._bufferService.buffer.y,this._bufferService.buffer.y)}handleSelectionChanged(L,q,J){if(this._selectionContainer.replaceChildren(),this._rowFactory.handleSelectionChanged(L,q,J),this.renderRows(0,this._bufferService.rows-1),!L||!q)return;this._selectionRenderModel.update(this._terminal,L,q,J);const re=this._selectionRenderModel.viewportStartRow,ie=this._selectionRenderModel.viewportEndRow,ee=this._selectionRenderModel.viewportCappedStartRow,x=this._selectionRenderModel.viewportCappedEndRow;if(ee>=this._bufferService.rows||x<0)return;const B=this._document.createDocumentFragment();if(J){const U=L[0]>q[0];B.appendChild(this._createSelectionElement(ee,U?q[0]:L[0],U?L[0]:q[0],x-ee+1))}else{const U=re===ee?L[0]:0,z=ee===ie?q[0]:this._bufferService.cols;B.appendChild(this._createSelectionElement(ee,U,z));const se=x-ee-1;if(B.appendChild(this._createSelectionElement(ee+1,0,this._bufferService.cols,se)),ee!==x){const j=ie===x?q[0]:this._bufferService.cols;B.appendChild(this._createSelectionElement(x,0,j))}}this._selectionContainer.appendChild(B)}_createSelectionElement(L,q,J,re=1){const ie=this._document.createElement("div"),ee=q*this.dimensions.css.cell.width;let x=this.dimensions.css.cell.width*(J-q);return ee+x>this.dimensions.css.canvas.width&&(x=this.dimensions.css.canvas.width-ee),ie.style.height=re*this.dimensions.css.cell.height+"px",ie.style.top=L*this.dimensions.css.cell.height+"px",ie.style.left=`${ee}px`,ie.style.width=`${x}px`,ie}handleCursorMove(){}_handleOptionsChanged(){this._updateDimensions(),this._injectCss(this._themeService.colors),this._widthCache.setFont(this._optionsService.rawOptions.fontFamily,this._optionsService.rawOptions.fontSize,this._optionsService.rawOptions.fontWeight,this._optionsService.rawOptions.fontWeightBold),this._setDefaultSpacing()}clear(){for(const L of this._rowElements)L.replaceChildren()}renderRows(L,q){const J=this._bufferService.buffer,re=J.ybase+J.y,ie=Math.min(J.x,this._bufferService.cols-1),ee=this._optionsService.rawOptions.cursorBlink,x=this._optionsService.rawOptions.cursorStyle,B=this._optionsService.rawOptions.cursorInactiveStyle;for(let U=L;U<=q;U++){const z=U+J.ydisp,se=this._rowElements[U],j=J.lines.get(z);if(!se||!j)break;se.replaceChildren(...this._rowFactory.createRow(j,z,z===re,x,B,ie,ee,this.dimensions.css.cell.width,this._widthCache,-1,-1))}}get _terminalSelector(){return`.${S}${this._terminalClass}`}_handleLinkHover(L){this._setCellUnderline(L.x1,L.x2,L.y1,L.y2,L.cols,!0)}_handleLinkLeave(L){this._setCellUnderline(L.x1,L.x2,L.y1,L.y2,L.cols,!1)}_setCellUnderline(L,q,J,re,ie,ee){J<0&&(L=0),re<0&&(q=0);const x=this._bufferService.rows-1;J=Math.max(Math.min(J,x),0),re=Math.max(Math.min(re,x),0),ie=Math.min(ie,this._bufferService.cols);const B=this._bufferService.buffer,U=B.ybase+B.y,z=Math.min(B.x,ie-1),se=this._optionsService.rawOptions.cursorBlink,j=this._optionsService.rawOptions.cursorStyle,G=this._optionsService.rawOptions.cursorInactiveStyle;for(let Y=J;Y<=re;++Y){const M=Y+B.ydisp,T=this._rowElements[Y],K=B.lines.get(M);if(!T||!K)break;T.replaceChildren(...this._rowFactory.createRow(K,M,M===U,j,G,z,se,this.dimensions.css.cell.width,this._widthCache,ee?Y===J?L:0:-1,ee?(Y===re?q:ie)-1:-1))}}};r.DomRenderer=P=u([f(7,y.IInstantiationService),f(8,h.ICharSizeService),f(9,y.IOptionsService),f(10,y.IBufferService),f(11,h.ICoreBrowserService),f(12,h.IThemeService)],P)},3787:function(c,r,o){var u=this&&this.__decorate||function(w,E,b,k){var R,O=arguments.length,P=O<3?E:k===null?k=Object.getOwnPropertyDescriptor(E,b):k;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")P=Reflect.decorate(w,E,b,k);else for(var L=w.length-1;L>=0;L--)(R=w[L])&&(P=(O<3?R(P):O>3?R(E,b,P):R(E,b))||P);return O>3&&P&&Object.defineProperty(E,b,P),P},f=this&&this.__param||function(w,E){return function(b,k){E(b,k,w)}};Object.defineProperty(r,"__esModule",{value:!0}),r.DomRendererRowFactory=void 0;const l=o(2223),m=o(643),g=o(511),C=o(2585),v=o(8055),h=o(4725),p=o(4269),_=o(6171),d=o(3734);let y=r.DomRendererRowFactory=class{constructor(w,E,b,k,R,O,P){this._document=w,this._characterJoinerService=E,this._optionsService=b,this._coreBrowserService=k,this._coreService=R,this._decorationService=O,this._themeService=P,this._workCell=new g.CellData,this._columnSelectMode=!1,this.defaultSpacing=0}handleSelectionChanged(w,E,b){this._selectionStart=w,this._selectionEnd=E,this._columnSelectMode=b}createRow(w,E,b,k,R,O,P,L,q,J,re){const ie=[],ee=this._characterJoinerService.getJoinedCharacters(E),x=this._themeService.colors;let B,U=w.getNoBgTrimmedLength();b&&U<O+1&&(U=O+1);let z=0,se="",j=0,G=0,Y=0,M=!1,T=0,K=!1,H=0;const X=[],Q=J!==-1&&re!==-1;for(let he=0;he<U;he++){w.loadCell(he,this._workCell);let me=this._workCell.getWidth();if(me===0)continue;let fe=!1,Ae=he,ue=this._workCell;if(ee.length>0&&he===ee[0][0]){fe=!0;const De=ee.shift();ue=new p.JoinedCellData(this._workCell,w.translateToString(!0,De[0],De[1]),De[1]-De[0]),Ae=De[1]-1,me=ue.getWidth()}const ve=this._isCellInSelection(he,E),Ie=b&&he===O,et=Q&&he>=J&&he<=re;let $e=!1;this._decorationService.forEachDecorationAtCell(he,E,void 0,(De=>{$e=!0}));let tt=ue.getChars()||m.WHITESPACE_CELL_CHAR;if(tt===" "&&(ue.isUnderline()||ue.isOverline())&&(tt=""),H=me*L-q.get(tt,ue.isBold(),ue.isItalic()),B){if(z&&(ve&&K||!ve&&!K&&ue.bg===j)&&(ve&&K&&x.selectionForeground||ue.fg===G)&&ue.extended.ext===Y&&et===M&&H===T&&!Ie&&!fe&&!$e){ue.isInvisible()?se+=m.WHITESPACE_CELL_CHAR:se+=tt,z++;continue}z&&(B.textContent=se),B=this._document.createElement("span"),z=0,se=""}else B=this._document.createElement("span");if(j=ue.bg,G=ue.fg,Y=ue.extended.ext,M=et,T=H,K=ve,fe&&O>=he&&O<=Ae&&(O=he),!this._coreService.isCursorHidden&&Ie&&this._coreService.isCursorInitialized){if(X.push("xterm-cursor"),this._coreBrowserService.isFocused)P&&X.push("xterm-cursor-blink"),X.push(k==="bar"?"xterm-cursor-bar":k==="underline"?"xterm-cursor-underline":"xterm-cursor-block");else if(R)switch(R){case"outline":X.push("xterm-cursor-outline");break;case"block":X.push("xterm-cursor-block");break;case"bar":X.push("xterm-cursor-bar");break;case"underline":X.push("xterm-cursor-underline")}}if(ue.isBold()&&X.push("xterm-bold"),ue.isItalic()&&X.push("xterm-italic"),ue.isDim()&&X.push("xterm-dim"),se=ue.isInvisible()?m.WHITESPACE_CELL_CHAR:ue.getChars()||m.WHITESPACE_CELL_CHAR,ue.isUnderline()&&(X.push(`xterm-underline-${ue.extended.underlineStyle}`),se===" "&&(se=""),!ue.isUnderlineColorDefault()))if(ue.isUnderlineColorRGB())B.style.textDecorationColor=`rgb(${d.AttributeData.toColorRGB(ue.getUnderlineColor()).join(",")})`;else{let De=ue.getUnderlineColor();this._optionsService.rawOptions.drawBoldTextInBrightColors&&ue.isBold()&&De<8&&(De+=8),B.style.textDecorationColor=x.ansi[De].css}ue.isOverline()&&(X.push("xterm-overline"),se===" "&&(se="")),ue.isStrikethrough()&&X.push("xterm-strikethrough"),et&&(B.style.textDecoration="underline");let He=ue.getFgColor(),Ut=ue.getFgColorMode(),ut=ue.getBgColor(),Nt=ue.getBgColorMode();const oi=!!ue.isInverse();if(oi){const De=He;He=ut,ut=De;const Ui=Ut;Ut=Nt,Nt=Ui}let Et,je,rt,vt=!1;switch(this._decorationService.forEachDecorationAtCell(he,E,void 0,(De=>{De.options.layer!=="top"&&vt||(De.backgroundColorRGB&&(Nt=50331648,ut=De.backgroundColorRGB.rgba>>8&16777215,Et=De.backgroundColorRGB),De.foregroundColorRGB&&(Ut=50331648,He=De.foregroundColorRGB.rgba>>8&16777215,je=De.foregroundColorRGB),vt=De.options.layer==="top")})),!vt&&ve&&(Et=this._coreBrowserService.isFocused?x.selectionBackgroundOpaque:x.selectionInactiveBackgroundOpaque,ut=Et.rgba>>8&16777215,Nt=50331648,vt=!0,x.selectionForeground&&(Ut=50331648,He=x.selectionForeground.rgba>>8&16777215,je=x.selectionForeground)),vt&&X.push("xterm-decoration-top"),Nt){case 16777216:case 33554432:rt=x.ansi[ut],X.push(`xterm-bg-${ut}`);break;case 50331648:rt=v.channels.toColor(ut>>16,ut>>8&255,255&ut),this._addStyle(B,`background-color:#${S((ut>>>0).toString(16),"0",6)}`);break;default:oi?(rt=x.foreground,X.push(`xterm-bg-${l.INVERTED_DEFAULT_COLOR}`)):rt=x.background}switch(Et||ue.isDim()&&(Et=v.color.multiplyOpacity(rt,.5)),Ut){case 16777216:case 33554432:ue.isBold()&&He<8&&this._optionsService.rawOptions.drawBoldTextInBrightColors&&(He+=8),this._applyMinimumContrast(B,rt,x.ansi[He],ue,Et,void 0)||X.push(`xterm-fg-${He}`);break;case 50331648:const De=v.channels.toColor(He>>16&255,He>>8&255,255&He);this._applyMinimumContrast(B,rt,De,ue,Et,je)||this._addStyle(B,`color:#${S(He.toString(16),"0",6)}`);break;default:this._applyMinimumContrast(B,rt,x.foreground,ue,Et,je)||oi&&X.push(`xterm-fg-${l.INVERTED_DEFAULT_COLOR}`)}X.length&&(B.className=X.join(" "),X.length=0),Ie||fe||$e?B.textContent=se:z++,H!==this.defaultSpacing&&(B.style.letterSpacing=`${H}px`),ie.push(B),he=Ae}return B&&z&&(B.textContent=se),ie}_applyMinimumContrast(w,E,b,k,R,O){if(this._optionsService.rawOptions.minimumContrastRatio===1||(0,_.treatGlyphAsBackgroundColor)(k.getCode()))return!1;const P=this._getContrastCache(k);let L;if(R||O||(L=P.getColor(E.rgba,b.rgba)),L===void 0){const q=this._optionsService.rawOptions.minimumContrastRatio/(k.isDim()?2:1);L=v.color.ensureContrastRatio(R||E,O||b,q),P.setColor((R||E).rgba,(O||b).rgba,L??null)}return!!L&&(this._addStyle(w,`color:${L.css}`),!0)}_getContrastCache(w){return w.isDim()?this._themeService.colors.halfContrastCache:this._themeService.colors.contrastCache}_addStyle(w,E){w.setAttribute("style",`${w.getAttribute("style")||""}${E};`)}_isCellInSelection(w,E){const b=this._selectionStart,k=this._selectionEnd;return!(!b||!k)&&(this._columnSelectMode?b[0]<=k[0]?w>=b[0]&&E>=b[1]&&w<k[0]&&E<=k[1]:w<b[0]&&E>=b[1]&&w>=k[0]&&E<=k[1]:E>b[1]&&E<k[1]||b[1]===k[1]&&E===b[1]&&w>=b[0]&&w<k[0]||b[1]<k[1]&&E===k[1]&&w<k[0]||b[1]<k[1]&&E===b[1]&&w>=b[0])}};function S(w,E,b){for(;w.length<b;)w=E+w;return w}r.DomRendererRowFactory=y=u([f(1,h.ICharacterJoinerService),f(2,C.IOptionsService),f(3,h.ICoreBrowserService),f(4,C.ICoreService),f(5,C.IDecorationService),f(6,h.IThemeService)],y)},2550:(c,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.WidthCache=void 0,r.WidthCache=class{constructor(o,u){this._flat=new Float32Array(256),this._font="",this._fontSize=0,this._weight="normal",this._weightBold="bold",this._measureElements=[],this._container=o.createElement("div"),this._container.classList.add("xterm-width-cache-measure-container"),this._container.setAttribute("aria-hidden","true"),this._container.style.whiteSpace="pre",this._container.style.fontKerning="none";const f=o.createElement("span");f.classList.add("xterm-char-measure-element");const l=o.createElement("span");l.classList.add("xterm-char-measure-element"),l.style.fontWeight="bold";const m=o.createElement("span");m.classList.add("xterm-char-measure-element"),m.style.fontStyle="italic";const g=o.createElement("span");g.classList.add("xterm-char-measure-element"),g.style.fontWeight="bold",g.style.fontStyle="italic",this._measureElements=[f,l,m,g],this._container.appendChild(f),this._container.appendChild(l),this._container.appendChild(m),this._container.appendChild(g),u.appendChild(this._container),this.clear()}dispose(){this._container.remove(),this._measureElements.length=0,this._holey=void 0}clear(){this._flat.fill(-9999),this._holey=new Map}setFont(o,u,f,l){o===this._font&&u===this._fontSize&&f===this._weight&&l===this._weightBold||(this._font=o,this._fontSize=u,this._weight=f,this._weightBold=l,this._container.style.fontFamily=this._font,this._container.style.fontSize=`${this._fontSize}px`,this._measureElements[0].style.fontWeight=`${f}`,this._measureElements[1].style.fontWeight=`${l}`,this._measureElements[2].style.fontWeight=`${f}`,this._measureElements[3].style.fontWeight=`${l}`,this.clear())}get(o,u,f){let l=0;if(!u&&!f&&o.length===1&&(l=o.charCodeAt(0))<256){if(this._flat[l]!==-9999)return this._flat[l];const C=this._measure(o,0);return C>0&&(this._flat[l]=C),C}let m=o;u&&(m+="B"),f&&(m+="I");let g=this._holey.get(m);if(g===void 0){let C=0;u&&(C|=1),f&&(C|=2),g=this._measure(o,C),g>0&&this._holey.set(m,g)}return g}_measure(o,u){const f=this._measureElements[u];return f.textContent=o.repeat(32),f.offsetWidth/32}}},2223:(c,r,o)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.TEXT_BASELINE=r.DIM_OPACITY=r.INVERTED_DEFAULT_COLOR=void 0;const u=o(6114);r.INVERTED_DEFAULT_COLOR=257,r.DIM_OPACITY=.5,r.TEXT_BASELINE=u.isFirefox||u.isLegacyEdge?"bottom":"ideographic"},6171:(c,r)=>{function o(f){return 57508<=f&&f<=57558}function u(f){return f>=128512&&f<=128591||f>=127744&&f<=128511||f>=128640&&f<=128767||f>=9728&&f<=9983||f>=9984&&f<=10175||f>=65024&&f<=65039||f>=129280&&f<=129535||f>=127462&&f<=127487}Object.defineProperty(r,"__esModule",{value:!0}),r.computeNextVariantOffset=r.createRenderDimensions=r.treatGlyphAsBackgroundColor=r.allowRescaling=r.isEmoji=r.isRestrictedPowerlineGlyph=r.isPowerlineGlyph=r.throwIfFalsy=void 0,r.throwIfFalsy=function(f){if(!f)throw new Error("value must not be falsy");return f},r.isPowerlineGlyph=o,r.isRestrictedPowerlineGlyph=function(f){return 57520<=f&&f<=57527},r.isEmoji=u,r.allowRescaling=function(f,l,m,g){return l===1&&m>Math.ceil(1.5*g)&&f!==void 0&&f>255&&!u(f)&&!o(f)&&!(function(C){return 57344<=C&&C<=63743})(f)},r.treatGlyphAsBackgroundColor=function(f){return o(f)||(function(l){return 9472<=l&&l<=9631})(f)},r.createRenderDimensions=function(){return{css:{canvas:{width:0,height:0},cell:{width:0,height:0}},device:{canvas:{width:0,height:0},cell:{width:0,height:0},char:{width:0,height:0,left:0,top:0}}}},r.computeNextVariantOffset=function(f,l,m=0){return(f-(2*Math.round(l)-m))%(2*Math.round(l))}},6052:(c,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.createSelectionRenderModel=void 0;class o{constructor(){this.clear()}clear(){this.hasSelection=!1,this.columnSelectMode=!1,this.viewportStartRow=0,this.viewportEndRow=0,this.viewportCappedStartRow=0,this.viewportCappedEndRow=0,this.startCol=0,this.endCol=0,this.selectionStart=void 0,this.selectionEnd=void 0}update(f,l,m,g=!1){if(this.selectionStart=l,this.selectionEnd=m,!l||!m||l[0]===m[0]&&l[1]===m[1])return void this.clear();const C=f.buffers.active.ydisp,v=l[1]-C,h=m[1]-C,p=Math.max(v,0),_=Math.min(h,f.rows-1);p>=f.rows||_<0?this.clear():(this.hasSelection=!0,this.columnSelectMode=g,this.viewportStartRow=v,this.viewportEndRow=h,this.viewportCappedStartRow=p,this.viewportCappedEndRow=_,this.startCol=l[0],this.endCol=m[0])}isCellSelected(f,l,m){return!!this.hasSelection&&(m-=f.buffer.active.viewportY,this.columnSelectMode?this.startCol<=this.endCol?l>=this.startCol&&m>=this.viewportCappedStartRow&&l<this.endCol&&m<=this.viewportCappedEndRow:l<this.startCol&&m>=this.viewportCappedStartRow&&l>=this.endCol&&m<=this.viewportCappedEndRow:m>this.viewportStartRow&&m<this.viewportEndRow||this.viewportStartRow===this.viewportEndRow&&m===this.viewportStartRow&&l>=this.startCol&&l<this.endCol||this.viewportStartRow<this.viewportEndRow&&m===this.viewportEndRow&&l<this.endCol||this.viewportStartRow<this.viewportEndRow&&m===this.viewportStartRow&&l>=this.startCol)}}r.createSelectionRenderModel=function(){return new o}},456:(c,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.SelectionModel=void 0,r.SelectionModel=class{constructor(o){this._bufferService=o,this.isSelectAllActive=!1,this.selectionStartLength=0}clearSelection(){this.selectionStart=void 0,this.selectionEnd=void 0,this.isSelectAllActive=!1,this.selectionStartLength=0}get finalSelectionStart(){return this.isSelectAllActive?[0,0]:this.selectionEnd&&this.selectionStart&&this.areSelectionValuesReversed()?this.selectionEnd:this.selectionStart}get finalSelectionEnd(){if(this.isSelectAllActive)return[this._bufferService.cols,this._bufferService.buffer.ybase+this._bufferService.rows-1];if(this.selectionStart){if(!this.selectionEnd||this.areSelectionValuesReversed()){const o=this.selectionStart[0]+this.selectionStartLength;return o>this._bufferService.cols?o%this._bufferService.cols==0?[this._bufferService.cols,this.selectionStart[1]+Math.floor(o/this._bufferService.cols)-1]:[o%this._bufferService.cols,this.selectionStart[1]+Math.floor(o/this._bufferService.cols)]:[o,this.selectionStart[1]]}if(this.selectionStartLength&&this.selectionEnd[1]===this.selectionStart[1]){const o=this.selectionStart[0]+this.selectionStartLength;return o>this._bufferService.cols?[o%this._bufferService.cols,this.selectionStart[1]+Math.floor(o/this._bufferService.cols)]:[Math.max(o,this.selectionEnd[0]),this.selectionEnd[1]]}return this.selectionEnd}}areSelectionValuesReversed(){const o=this.selectionStart,u=this.selectionEnd;return!(!o||!u)&&(o[1]>u[1]||o[1]===u[1]&&o[0]>u[0])}handleTrim(o){return this.selectionStart&&(this.selectionStart[1]-=o),this.selectionEnd&&(this.selectionEnd[1]-=o),this.selectionEnd&&this.selectionEnd[1]<0?(this.clearSelection(),!0):(this.selectionStart&&this.selectionStart[1]<0&&(this.selectionStart[1]=0),!1)}}},428:function(c,r,o){var u=this&&this.__decorate||function(_,d,y,S){var w,E=arguments.length,b=E<3?d:S===null?S=Object.getOwnPropertyDescriptor(d,y):S;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")b=Reflect.decorate(_,d,y,S);else for(var k=_.length-1;k>=0;k--)(w=_[k])&&(b=(E<3?w(b):E>3?w(d,y,b):w(d,y))||b);return E>3&&b&&Object.defineProperty(d,y,b),b},f=this&&this.__param||function(_,d){return function(y,S){d(y,S,_)}};Object.defineProperty(r,"__esModule",{value:!0}),r.CharSizeService=void 0;const l=o(2585),m=o(8460),g=o(844);let C=r.CharSizeService=class extends g.Disposable{get hasValidSize(){return this.width>0&&this.height>0}constructor(_,d,y){super(),this._optionsService=y,this.width=0,this.height=0,this._onCharSizeChange=this.register(new m.EventEmitter),this.onCharSizeChange=this._onCharSizeChange.event;try{this._measureStrategy=this.register(new p(this._optionsService))}catch{this._measureStrategy=this.register(new h(_,d,this._optionsService))}this.register(this._optionsService.onMultipleOptionChange(["fontFamily","fontSize"],(()=>this.measure())))}measure(){const _=this._measureStrategy.measure();_.width===this.width&&_.height===this.height||(this.width=_.width,this.height=_.height,this._onCharSizeChange.fire())}};r.CharSizeService=C=u([f(2,l.IOptionsService)],C);class v extends g.Disposable{constructor(){super(...arguments),this._result={width:0,height:0}}_validateAndSet(d,y){d!==void 0&&d>0&&y!==void 0&&y>0&&(this._result.width=d,this._result.height=y)}}class h extends v{constructor(d,y,S){super(),this._document=d,this._parentElement=y,this._optionsService=S,this._measureElement=this._document.createElement("span"),this._measureElement.classList.add("xterm-char-measure-element"),this._measureElement.textContent="W".repeat(32),this._measureElement.setAttribute("aria-hidden","true"),this._measureElement.style.whiteSpace="pre",this._measureElement.style.fontKerning="none",this._parentElement.appendChild(this._measureElement)}measure(){return this._measureElement.style.fontFamily=this._optionsService.rawOptions.fontFamily,this._measureElement.style.fontSize=`${this._optionsService.rawOptions.fontSize}px`,this._validateAndSet(Number(this._measureElement.offsetWidth)/32,Number(this._measureElement.offsetHeight)),this._result}}class p extends v{constructor(d){super(),this._optionsService=d,this._canvas=new OffscreenCanvas(100,100),this._ctx=this._canvas.getContext("2d");const y=this._ctx.measureText("W");if(!("width"in y&&"fontBoundingBoxAscent"in y&&"fontBoundingBoxDescent"in y))throw new Error("Required font metrics not supported")}measure(){this._ctx.font=`${this._optionsService.rawOptions.fontSize}px ${this._optionsService.rawOptions.fontFamily}`;const d=this._ctx.measureText("W");return this._validateAndSet(d.width,d.fontBoundingBoxAscent+d.fontBoundingBoxDescent),this._result}}},4269:function(c,r,o){var u=this&&this.__decorate||function(p,_,d,y){var S,w=arguments.length,E=w<3?_:y===null?y=Object.getOwnPropertyDescriptor(_,d):y;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")E=Reflect.decorate(p,_,d,y);else for(var b=p.length-1;b>=0;b--)(S=p[b])&&(E=(w<3?S(E):w>3?S(_,d,E):S(_,d))||E);return w>3&&E&&Object.defineProperty(_,d,E),E},f=this&&this.__param||function(p,_){return function(d,y){_(d,y,p)}};Object.defineProperty(r,"__esModule",{value:!0}),r.CharacterJoinerService=r.JoinedCellData=void 0;const l=o(3734),m=o(643),g=o(511),C=o(2585);class v extends l.AttributeData{constructor(_,d,y){super(),this.content=0,this.combinedData="",this.fg=_.fg,this.bg=_.bg,this.combinedData=d,this._width=y}isCombined(){return 2097152}getWidth(){return this._width}getChars(){return this.combinedData}getCode(){return 2097151}setFromCharData(_){throw new Error("not implemented")}getAsCharData(){return[this.fg,this.getChars(),this.getWidth(),this.getCode()]}}r.JoinedCellData=v;let h=r.CharacterJoinerService=class _h{constructor(_){this._bufferService=_,this._characterJoiners=[],this._nextCharacterJoinerId=0,this._workCell=new g.CellData}register(_){const d={id:this._nextCharacterJoinerId++,handler:_};return this._characterJoiners.push(d),d.id}deregister(_){for(let d=0;d<this._characterJoiners.length;d++)if(this._characterJoiners[d].id===_)return this._characterJoiners.splice(d,1),!0;return!1}getJoinedCharacters(_){if(this._characterJoiners.length===0)return[];const d=this._bufferService.buffer.lines.get(_);if(!d||d.length===0)return[];const y=[],S=d.translateToString(!0);let w=0,E=0,b=0,k=d.getFg(0),R=d.getBg(0);for(let O=0;O<d.getTrimmedLength();O++)if(d.loadCell(O,this._workCell),this._workCell.getWidth()!==0){if(this._workCell.fg!==k||this._workCell.bg!==R){if(O-w>1){const P=this._getJoinedRanges(S,b,E,d,w);for(let L=0;L<P.length;L++)y.push(P[L])}w=O,b=E,k=this._workCell.fg,R=this._workCell.bg}E+=this._workCell.getChars().length||m.WHITESPACE_CELL_CHAR.length}if(this._bufferService.cols-w>1){const O=this._getJoinedRanges(S,b,E,d,w);for(let P=0;P<O.length;P++)y.push(O[P])}return y}_getJoinedRanges(_,d,y,S,w){const E=_.substring(d,y);let b=[];try{b=this._characterJoiners[0].handler(E)}catch(k){console.error(k)}for(let k=1;k<this._characterJoiners.length;k++)try{const R=this._characterJoiners[k].handler(E);for(let O=0;O<R.length;O++)_h._mergeRanges(b,R[O])}catch(R){console.error(R)}return this._stringRangesToCellRanges(b,S,w),b}_stringRangesToCellRanges(_,d,y){let S=0,w=!1,E=0,b=_[S];if(b){for(let k=y;k<this._bufferService.cols;k++){const R=d.getWidth(k),O=d.getString(k).length||m.WHITESPACE_CELL_CHAR.length;if(R!==0){if(!w&&b[0]<=E&&(b[0]=k,w=!0),b[1]<=E){if(b[1]=k,b=_[++S],!b)break;b[0]<=E?(b[0]=k,w=!0):w=!1}E+=O}}b&&(b[1]=this._bufferService.cols)}}static _mergeRanges(_,d){let y=!1;for(let S=0;S<_.length;S++){const w=_[S];if(y){if(d[1]<=w[0])return _[S-1][1]=d[1],_;if(d[1]<=w[1])return _[S-1][1]=Math.max(d[1],w[1]),_.splice(S,1),_;_.splice(S,1),S--}else{if(d[1]<=w[0])return _.splice(S,0,d),_;if(d[1]<=w[1])return w[0]=Math.min(d[0],w[0]),_;d[0]<w[1]&&(w[0]=Math.min(d[0],w[0]),y=!0)}}return y?_[_.length-1][1]=d[1]:_.push(d),_}};r.CharacterJoinerService=h=u([f(0,C.IBufferService)],h)},5114:(c,r,o)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.CoreBrowserService=void 0;const u=o(844),f=o(8460),l=o(3656);class m extends u.Disposable{constructor(v,h,p){super(),this._textarea=v,this._window=h,this.mainDocument=p,this._isFocused=!1,this._cachedIsFocused=void 0,this._screenDprMonitor=new g(this._window),this._onDprChange=this.register(new f.EventEmitter),this.onDprChange=this._onDprChange.event,this._onWindowChange=this.register(new f.EventEmitter),this.onWindowChange=this._onWindowChange.event,this.register(this.onWindowChange((_=>this._screenDprMonitor.setWindow(_)))),this.register((0,f.forwardEvent)(this._screenDprMonitor.onDprChange,this._onDprChange)),this._textarea.addEventListener("focus",(()=>this._isFocused=!0)),this._textarea.addEventListener("blur",(()=>this._isFocused=!1))}get window(){return this._window}set window(v){this._window!==v&&(this._window=v,this._onWindowChange.fire(this._window))}get dpr(){return this.window.devicePixelRatio}get isFocused(){return this._cachedIsFocused===void 0&&(this._cachedIsFocused=this._isFocused&&this._textarea.ownerDocument.hasFocus(),queueMicrotask((()=>this._cachedIsFocused=void 0))),this._cachedIsFocused}}r.CoreBrowserService=m;class g extends u.Disposable{constructor(v){super(),this._parentWindow=v,this._windowResizeListener=this.register(new u.MutableDisposable),this._onDprChange=this.register(new f.EventEmitter),this.onDprChange=this._onDprChange.event,this._outerListener=()=>this._setDprAndFireIfDiffers(),this._currentDevicePixelRatio=this._parentWindow.devicePixelRatio,this._updateDpr(),this._setWindowResizeListener(),this.register((0,u.toDisposable)((()=>this.clearListener())))}setWindow(v){this._parentWindow=v,this._setWindowResizeListener(),this._setDprAndFireIfDiffers()}_setWindowResizeListener(){this._windowResizeListener.value=(0,l.addDisposableDomListener)(this._parentWindow,"resize",(()=>this._setDprAndFireIfDiffers()))}_setDprAndFireIfDiffers(){this._parentWindow.devicePixelRatio!==this._currentDevicePixelRatio&&this._onDprChange.fire(this._parentWindow.devicePixelRatio),this._updateDpr()}_updateDpr(){this._outerListener&&(this._resolutionMediaMatchList?.removeListener(this._outerListener),this._currentDevicePixelRatio=this._parentWindow.devicePixelRatio,this._resolutionMediaMatchList=this._parentWindow.matchMedia(`screen and (resolution: ${this._parentWindow.devicePixelRatio}dppx)`),this._resolutionMediaMatchList.addListener(this._outerListener))}clearListener(){this._resolutionMediaMatchList&&this._outerListener&&(this._resolutionMediaMatchList.removeListener(this._outerListener),this._resolutionMediaMatchList=void 0,this._outerListener=void 0)}}},779:(c,r,o)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.LinkProviderService=void 0;const u=o(844);class f extends u.Disposable{constructor(){super(),this.linkProviders=[],this.register((0,u.toDisposable)((()=>this.linkProviders.length=0)))}registerLinkProvider(m){return this.linkProviders.push(m),{dispose:()=>{const g=this.linkProviders.indexOf(m);g!==-1&&this.linkProviders.splice(g,1)}}}}r.LinkProviderService=f},8934:function(c,r,o){var u=this&&this.__decorate||function(C,v,h,p){var _,d=arguments.length,y=d<3?v:p===null?p=Object.getOwnPropertyDescriptor(v,h):p;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")y=Reflect.decorate(C,v,h,p);else for(var S=C.length-1;S>=0;S--)(_=C[S])&&(y=(d<3?_(y):d>3?_(v,h,y):_(v,h))||y);return d>3&&y&&Object.defineProperty(v,h,y),y},f=this&&this.__param||function(C,v){return function(h,p){v(h,p,C)}};Object.defineProperty(r,"__esModule",{value:!0}),r.MouseService=void 0;const l=o(4725),m=o(9806);let g=r.MouseService=class{constructor(C,v){this._renderService=C,this._charSizeService=v}getCoords(C,v,h,p,_){return(0,m.getCoords)(window,C,v,h,p,this._charSizeService.hasValidSize,this._renderService.dimensions.css.cell.width,this._renderService.dimensions.css.cell.height,_)}getMouseReportCoords(C,v){const h=(0,m.getCoordsRelativeToElement)(window,C,v);if(this._charSizeService.hasValidSize)return h[0]=Math.min(Math.max(h[0],0),this._renderService.dimensions.css.canvas.width-1),h[1]=Math.min(Math.max(h[1],0),this._renderService.dimensions.css.canvas.height-1),{col:Math.floor(h[0]/this._renderService.dimensions.css.cell.width),row:Math.floor(h[1]/this._renderService.dimensions.css.cell.height),x:Math.floor(h[0]),y:Math.floor(h[1])}}};r.MouseService=g=u([f(0,l.IRenderService),f(1,l.ICharSizeService)],g)},3230:function(c,r,o){var u=this&&this.__decorate||function(_,d,y,S){var w,E=arguments.length,b=E<3?d:S===null?S=Object.getOwnPropertyDescriptor(d,y):S;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")b=Reflect.decorate(_,d,y,S);else for(var k=_.length-1;k>=0;k--)(w=_[k])&&(b=(E<3?w(b):E>3?w(d,y,b):w(d,y))||b);return E>3&&b&&Object.defineProperty(d,y,b),b},f=this&&this.__param||function(_,d){return function(y,S){d(y,S,_)}};Object.defineProperty(r,"__esModule",{value:!0}),r.RenderService=void 0;const l=o(6193),m=o(4725),g=o(8460),C=o(844),v=o(7226),h=o(2585);let p=r.RenderService=class extends C.Disposable{get dimensions(){return this._renderer.value.dimensions}constructor(_,d,y,S,w,E,b,k){super(),this._rowCount=_,this._charSizeService=S,this._renderer=this.register(new C.MutableDisposable),this._pausedResizeTask=new v.DebouncedIdleTask,this._observerDisposable=this.register(new C.MutableDisposable),this._isPaused=!1,this._needsFullRefresh=!1,this._isNextRenderRedrawOnly=!0,this._needsSelectionRefresh=!1,this._canvasWidth=0,this._canvasHeight=0,this._selectionState={start:void 0,end:void 0,columnSelectMode:!1},this._onDimensionsChange=this.register(new g.EventEmitter),this.onDimensionsChange=this._onDimensionsChange.event,this._onRenderedViewportChange=this.register(new g.EventEmitter),this.onRenderedViewportChange=this._onRenderedViewportChange.event,this._onRender=this.register(new g.EventEmitter),this.onRender=this._onRender.event,this._onRefreshRequest=this.register(new g.EventEmitter),this.onRefreshRequest=this._onRefreshRequest.event,this._renderDebouncer=new l.RenderDebouncer(((R,O)=>this._renderRows(R,O)),b),this.register(this._renderDebouncer),this.register(b.onDprChange((()=>this.handleDevicePixelRatioChange()))),this.register(E.onResize((()=>this._fullRefresh()))),this.register(E.buffers.onBufferActivate((()=>this._renderer.value?.clear()))),this.register(y.onOptionChange((()=>this._handleOptionsChanged()))),this.register(this._charSizeService.onCharSizeChange((()=>this.handleCharSizeChanged()))),this.register(w.onDecorationRegistered((()=>this._fullRefresh()))),this.register(w.onDecorationRemoved((()=>this._fullRefresh()))),this.register(y.onMultipleOptionChange(["customGlyphs","drawBoldTextInBrightColors","letterSpacing","lineHeight","fontFamily","fontSize","fontWeight","fontWeightBold","minimumContrastRatio","rescaleOverlappingGlyphs"],(()=>{this.clear(),this.handleResize(E.cols,E.rows),this._fullRefresh()}))),this.register(y.onMultipleOptionChange(["cursorBlink","cursorStyle"],(()=>this.refreshRows(E.buffer.y,E.buffer.y,!0)))),this.register(k.onChangeColors((()=>this._fullRefresh()))),this._registerIntersectionObserver(b.window,d),this.register(b.onWindowChange((R=>this._registerIntersectionObserver(R,d))))}_registerIntersectionObserver(_,d){if("IntersectionObserver"in _){const y=new _.IntersectionObserver((S=>this._handleIntersectionChange(S[S.length-1])),{threshold:0});y.observe(d),this._observerDisposable.value=(0,C.toDisposable)((()=>y.disconnect()))}}_handleIntersectionChange(_){this._isPaused=_.isIntersecting===void 0?_.intersectionRatio===0:!_.isIntersecting,this._isPaused||this._charSizeService.hasValidSize||this._charSizeService.measure(),!this._isPaused&&this._needsFullRefresh&&(this._pausedResizeTask.flush(),this.refreshRows(0,this._rowCount-1),this._needsFullRefresh=!1)}refreshRows(_,d,y=!1){this._isPaused?this._needsFullRefresh=!0:(y||(this._isNextRenderRedrawOnly=!1),this._renderDebouncer.refresh(_,d,this._rowCount))}_renderRows(_,d){this._renderer.value&&(_=Math.min(_,this._rowCount-1),d=Math.min(d,this._rowCount-1),this._renderer.value.renderRows(_,d),this._needsSelectionRefresh&&(this._renderer.value.handleSelectionChanged(this._selectionState.start,this._selectionState.end,this._selectionState.columnSelectMode),this._needsSelectionRefresh=!1),this._isNextRenderRedrawOnly||this._onRenderedViewportChange.fire({start:_,end:d}),this._onRender.fire({start:_,end:d}),this._isNextRenderRedrawOnly=!0)}resize(_,d){this._rowCount=d,this._fireOnCanvasResize()}_handleOptionsChanged(){this._renderer.value&&(this.refreshRows(0,this._rowCount-1),this._fireOnCanvasResize())}_fireOnCanvasResize(){this._renderer.value&&(this._renderer.value.dimensions.css.canvas.width===this._canvasWidth&&this._renderer.value.dimensions.css.canvas.height===this._canvasHeight||this._onDimensionsChange.fire(this._renderer.value.dimensions))}hasRenderer(){return!!this._renderer.value}setRenderer(_){this._renderer.value=_,this._renderer.value&&(this._renderer.value.onRequestRedraw((d=>this.refreshRows(d.start,d.end,!0))),this._needsSelectionRefresh=!0,this._fullRefresh())}addRefreshCallback(_){return this._renderDebouncer.addRefreshCallback(_)}_fullRefresh(){this._isPaused?this._needsFullRefresh=!0:this.refreshRows(0,this._rowCount-1)}clearTextureAtlas(){this._renderer.value&&(this._renderer.value.clearTextureAtlas?.(),this._fullRefresh())}handleDevicePixelRatioChange(){this._charSizeService.measure(),this._renderer.value&&(this._renderer.value.handleDevicePixelRatioChange(),this.refreshRows(0,this._rowCount-1))}handleResize(_,d){this._renderer.value&&(this._isPaused?this._pausedResizeTask.set((()=>this._renderer.value?.handleResize(_,d))):this._renderer.value.handleResize(_,d),this._fullRefresh())}handleCharSizeChanged(){this._renderer.value?.handleCharSizeChanged()}handleBlur(){this._renderer.value?.handleBlur()}handleFocus(){this._renderer.value?.handleFocus()}handleSelectionChanged(_,d,y){this._selectionState.start=_,this._selectionState.end=d,this._selectionState.columnSelectMode=y,this._renderer.value?.handleSelectionChanged(_,d,y)}handleCursorMove(){this._renderer.value?.handleCursorMove()}clear(){this._renderer.value?.clear()}};r.RenderService=p=u([f(2,h.IOptionsService),f(3,m.ICharSizeService),f(4,h.IDecorationService),f(5,h.IBufferService),f(6,m.ICoreBrowserService),f(7,m.IThemeService)],p)},9312:function(c,r,o){var u=this&&this.__decorate||function(b,k,R,O){var P,L=arguments.length,q=L<3?k:O===null?O=Object.getOwnPropertyDescriptor(k,R):O;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")q=Reflect.decorate(b,k,R,O);else for(var J=b.length-1;J>=0;J--)(P=b[J])&&(q=(L<3?P(q):L>3?P(k,R,q):P(k,R))||q);return L>3&&q&&Object.defineProperty(k,R,q),q},f=this&&this.__param||function(b,k){return function(R,O){k(R,O,b)}};Object.defineProperty(r,"__esModule",{value:!0}),r.SelectionService=void 0;const l=o(9806),m=o(9504),g=o(456),C=o(4725),v=o(8460),h=o(844),p=o(6114),_=o(4841),d=o(511),y=o(2585),S="",w=new RegExp(S,"g");let E=r.SelectionService=class extends h.Disposable{constructor(b,k,R,O,P,L,q,J,re){super(),this._element=b,this._screenElement=k,this._linkifier=R,this._bufferService=O,this._coreService=P,this._mouseService=L,this._optionsService=q,this._renderService=J,this._coreBrowserService=re,this._dragScrollAmount=0,this._enabled=!0,this._workCell=new d.CellData,this._mouseDownTimeStamp=0,this._oldHasSelection=!1,this._oldSelectionStart=void 0,this._oldSelectionEnd=void 0,this._onLinuxMouseSelection=this.register(new v.EventEmitter),this.onLinuxMouseSelection=this._onLinuxMouseSelection.event,this._onRedrawRequest=this.register(new v.EventEmitter),this.onRequestRedraw=this._onRedrawRequest.event,this._onSelectionChange=this.register(new v.EventEmitter),this.onSelectionChange=this._onSelectionChange.event,this._onRequestScrollLines=this.register(new v.EventEmitter),this.onRequestScrollLines=this._onRequestScrollLines.event,this._mouseMoveListener=ie=>this._handleMouseMove(ie),this._mouseUpListener=ie=>this._handleMouseUp(ie),this._coreService.onUserInput((()=>{this.hasSelection&&this.clearSelection()})),this._trimListener=this._bufferService.buffer.lines.onTrim((ie=>this._handleTrim(ie))),this.register(this._bufferService.buffers.onBufferActivate((ie=>this._handleBufferActivate(ie)))),this.enable(),this._model=new g.SelectionModel(this._bufferService),this._activeSelectionMode=0,this.register((0,h.toDisposable)((()=>{this._removeMouseDownListeners()})))}reset(){this.clearSelection()}disable(){this.clearSelection(),this._enabled=!1}enable(){this._enabled=!0}get selectionStart(){return this._model.finalSelectionStart}get selectionEnd(){return this._model.finalSelectionEnd}get hasSelection(){const b=this._model.finalSelectionStart,k=this._model.finalSelectionEnd;return!(!b||!k||b[0]===k[0]&&b[1]===k[1])}get selectionText(){const b=this._model.finalSelectionStart,k=this._model.finalSelectionEnd;if(!b||!k)return"";const R=this._bufferService.buffer,O=[];if(this._activeSelectionMode===3){if(b[0]===k[0])return"";const P=b[0]<k[0]?b[0]:k[0],L=b[0]<k[0]?k[0]:b[0];for(let q=b[1];q<=k[1];q++){const J=R.translateBufferLineToString(q,!0,P,L);O.push(J)}}else{const P=b[1]===k[1]?k[0]:void 0;O.push(R.translateBufferLineToString(b[1],!0,b[0],P));for(let L=b[1]+1;L<=k[1]-1;L++){const q=R.lines.get(L),J=R.translateBufferLineToString(L,!0);q?.isWrapped?O[O.length-1]+=J:O.push(J)}if(b[1]!==k[1]){const L=R.lines.get(k[1]),q=R.translateBufferLineToString(k[1],!0,0,k[0]);L&&L.isWrapped?O[O.length-1]+=q:O.push(q)}}return O.map((P=>P.replace(w," "))).join(p.isWindows?`\r
`:`
`)}clearSelection(){this._model.clearSelection(),this._removeMouseDownListeners(),this.refresh(),this._onSelectionChange.fire()}refresh(b){this._refreshAnimationFrame||(this._refreshAnimationFrame=this._coreBrowserService.window.requestAnimationFrame((()=>this._refresh()))),p.isLinux&&b&&this.selectionText.length&&this._onLinuxMouseSelection.fire(this.selectionText)}_refresh(){this._refreshAnimationFrame=void 0,this._onRedrawRequest.fire({start:this._model.finalSelectionStart,end:this._model.finalSelectionEnd,columnSelectMode:this._activeSelectionMode===3})}_isClickInSelection(b){const k=this._getMouseBufferCoords(b),R=this._model.finalSelectionStart,O=this._model.finalSelectionEnd;return!!(R&&O&&k)&&this._areCoordsInSelection(k,R,O)}isCellInSelection(b,k){const R=this._model.finalSelectionStart,O=this._model.finalSelectionEnd;return!(!R||!O)&&this._areCoordsInSelection([b,k],R,O)}_areCoordsInSelection(b,k,R){return b[1]>k[1]&&b[1]<R[1]||k[1]===R[1]&&b[1]===k[1]&&b[0]>=k[0]&&b[0]<R[0]||k[1]<R[1]&&b[1]===R[1]&&b[0]<R[0]||k[1]<R[1]&&b[1]===k[1]&&b[0]>=k[0]}_selectWordAtCursor(b,k){const R=this._linkifier.currentLink?.link?.range;if(R)return this._model.selectionStart=[R.start.x-1,R.start.y-1],this._model.selectionStartLength=(0,_.getRangeLength)(R,this._bufferService.cols),this._model.selectionEnd=void 0,!0;const O=this._getMouseBufferCoords(b);return!!O&&(this._selectWordAt(O,k),this._model.selectionEnd=void 0,!0)}selectAll(){this._model.isSelectAllActive=!0,this.refresh(),this._onSelectionChange.fire()}selectLines(b,k){this._model.clearSelection(),b=Math.max(b,0),k=Math.min(k,this._bufferService.buffer.lines.length-1),this._model.selectionStart=[0,b],this._model.selectionEnd=[this._bufferService.cols,k],this.refresh(),this._onSelectionChange.fire()}_handleTrim(b){this._model.handleTrim(b)&&this.refresh()}_getMouseBufferCoords(b){const k=this._mouseService.getCoords(b,this._screenElement,this._bufferService.cols,this._bufferService.rows,!0);if(k)return k[0]--,k[1]--,k[1]+=this._bufferService.buffer.ydisp,k}_getMouseEventScrollAmount(b){let k=(0,l.getCoordsRelativeToElement)(this._coreBrowserService.window,b,this._screenElement)[1];const R=this._renderService.dimensions.css.canvas.height;return k>=0&&k<=R?0:(k>R&&(k-=R),k=Math.min(Math.max(k,-50),50),k/=50,k/Math.abs(k)+Math.round(14*k))}shouldForceSelection(b){return p.isMac?b.altKey&&this._optionsService.rawOptions.macOptionClickForcesSelection:b.shiftKey}handleMouseDown(b){if(this._mouseDownTimeStamp=b.timeStamp,(b.button!==2||!this.hasSelection)&&b.button===0){if(!this._enabled){if(!this.shouldForceSelection(b))return;b.stopPropagation()}b.preventDefault(),this._dragScrollAmount=0,this._enabled&&b.shiftKey?this._handleIncrementalClick(b):b.detail===1?this._handleSingleClick(b):b.detail===2?this._handleDoubleClick(b):b.detail===3&&this._handleTripleClick(b),this._addMouseDownListeners(),this.refresh(!0)}}_addMouseDownListeners(){this._screenElement.ownerDocument&&(this._screenElement.ownerDocument.addEventListener("mousemove",this._mouseMoveListener),this._screenElement.ownerDocument.addEventListener("mouseup",this._mouseUpListener)),this._dragScrollIntervalTimer=this._coreBrowserService.window.setInterval((()=>this._dragScroll()),50)}_removeMouseDownListeners(){this._screenElement.ownerDocument&&(this._screenElement.ownerDocument.removeEventListener("mousemove",this._mouseMoveListener),this._screenElement.ownerDocument.removeEventListener("mouseup",this._mouseUpListener)),this._coreBrowserService.window.clearInterval(this._dragScrollIntervalTimer),this._dragScrollIntervalTimer=void 0}_handleIncrementalClick(b){this._model.selectionStart&&(this._model.selectionEnd=this._getMouseBufferCoords(b))}_handleSingleClick(b){if(this._model.selectionStartLength=0,this._model.isSelectAllActive=!1,this._activeSelectionMode=this.shouldColumnSelect(b)?3:0,this._model.selectionStart=this._getMouseBufferCoords(b),!this._model.selectionStart)return;this._model.selectionEnd=void 0;const k=this._bufferService.buffer.lines.get(this._model.selectionStart[1]);k&&k.length!==this._model.selectionStart[0]&&k.hasWidth(this._model.selectionStart[0])===0&&this._model.selectionStart[0]++}_handleDoubleClick(b){this._selectWordAtCursor(b,!0)&&(this._activeSelectionMode=1)}_handleTripleClick(b){const k=this._getMouseBufferCoords(b);k&&(this._activeSelectionMode=2,this._selectLineAt(k[1]))}shouldColumnSelect(b){return b.altKey&&!(p.isMac&&this._optionsService.rawOptions.macOptionClickForcesSelection)}_handleMouseMove(b){if(b.stopImmediatePropagation(),!this._model.selectionStart)return;const k=this._model.selectionEnd?[this._model.selectionEnd[0],this._model.selectionEnd[1]]:null;if(this._model.selectionEnd=this._getMouseBufferCoords(b),!this._model.selectionEnd)return void this.refresh(!0);this._activeSelectionMode===2?this._model.selectionEnd[1]<this._model.selectionStart[1]?this._model.selectionEnd[0]=0:this._model.selectionEnd[0]=this._bufferService.cols:this._activeSelectionMode===1&&this._selectToWordAt(this._model.selectionEnd),this._dragScrollAmount=this._getMouseEventScrollAmount(b),this._activeSelectionMode!==3&&(this._dragScrollAmount>0?this._model.selectionEnd[0]=this._bufferService.cols:this._dragScrollAmount<0&&(this._model.selectionEnd[0]=0));const R=this._bufferService.buffer;if(this._model.selectionEnd[1]<R.lines.length){const O=R.lines.get(this._model.selectionEnd[1]);O&&O.hasWidth(this._model.selectionEnd[0])===0&&this._model.selectionEnd[0]<this._bufferService.cols&&this._model.selectionEnd[0]++}k&&k[0]===this._model.selectionEnd[0]&&k[1]===this._model.selectionEnd[1]||this.refresh(!0)}_dragScroll(){if(this._model.selectionEnd&&this._model.selectionStart&&this._dragScrollAmount){this._onRequestScrollLines.fire({amount:this._dragScrollAmount,suppressScrollEvent:!1});const b=this._bufferService.buffer;this._dragScrollAmount>0?(this._activeSelectionMode!==3&&(this._model.selectionEnd[0]=this._bufferService.cols),this._model.selectionEnd[1]=Math.min(b.ydisp+this._bufferService.rows,b.lines.length-1)):(this._activeSelectionMode!==3&&(this._model.selectionEnd[0]=0),this._model.selectionEnd[1]=b.ydisp),this.refresh()}}_handleMouseUp(b){const k=b.timeStamp-this._mouseDownTimeStamp;if(this._removeMouseDownListeners(),this.selectionText.length<=1&&k<500&&b.altKey&&this._optionsService.rawOptions.altClickMovesCursor){if(this._bufferService.buffer.ybase===this._bufferService.buffer.ydisp){const R=this._mouseService.getCoords(b,this._element,this._bufferService.cols,this._bufferService.rows,!1);if(R&&R[0]!==void 0&&R[1]!==void 0){const O=(0,m.moveToCellSequence)(R[0]-1,R[1]-1,this._bufferService,this._coreService.decPrivateModes.applicationCursorKeys);this._coreService.triggerDataEvent(O,!0)}}}else this._fireEventIfSelectionChanged()}_fireEventIfSelectionChanged(){const b=this._model.finalSelectionStart,k=this._model.finalSelectionEnd,R=!(!b||!k||b[0]===k[0]&&b[1]===k[1]);R?b&&k&&(this._oldSelectionStart&&this._oldSelectionEnd&&b[0]===this._oldSelectionStart[0]&&b[1]===this._oldSelectionStart[1]&&k[0]===this._oldSelectionEnd[0]&&k[1]===this._oldSelectionEnd[1]||this._fireOnSelectionChange(b,k,R)):this._oldHasSelection&&this._fireOnSelectionChange(b,k,R)}_fireOnSelectionChange(b,k,R){this._oldSelectionStart=b,this._oldSelectionEnd=k,this._oldHasSelection=R,this._onSelectionChange.fire()}_handleBufferActivate(b){this.clearSelection(),this._trimListener.dispose(),this._trimListener=b.activeBuffer.lines.onTrim((k=>this._handleTrim(k)))}_convertViewportColToCharacterIndex(b,k){let R=k;for(let O=0;k>=O;O++){const P=b.loadCell(O,this._workCell).getChars().length;this._workCell.getWidth()===0?R--:P>1&&k!==O&&(R+=P-1)}return R}setSelection(b,k,R){this._model.clearSelection(),this._removeMouseDownListeners(),this._model.selectionStart=[b,k],this._model.selectionStartLength=R,this.refresh(),this._fireEventIfSelectionChanged()}rightClickSelect(b){this._isClickInSelection(b)||(this._selectWordAtCursor(b,!1)&&this.refresh(!0),this._fireEventIfSelectionChanged())}_getWordAt(b,k,R=!0,O=!0){if(b[0]>=this._bufferService.cols)return;const P=this._bufferService.buffer,L=P.lines.get(b[1]);if(!L)return;const q=P.translateBufferLineToString(b[1],!1);let J=this._convertViewportColToCharacterIndex(L,b[0]),re=J;const ie=b[0]-J;let ee=0,x=0,B=0,U=0;if(q.charAt(J)===" "){for(;J>0&&q.charAt(J-1)===" ";)J--;for(;re<q.length&&q.charAt(re+1)===" ";)re++}else{let j=b[0],G=b[0];L.getWidth(j)===0&&(ee++,j--),L.getWidth(G)===2&&(x++,G++);const Y=L.getString(G).length;for(Y>1&&(U+=Y-1,re+=Y-1);j>0&&J>0&&!this._isCharWordSeparator(L.loadCell(j-1,this._workCell));){L.loadCell(j-1,this._workCell);const M=this._workCell.getChars().length;this._workCell.getWidth()===0?(ee++,j--):M>1&&(B+=M-1,J-=M-1),J--,j--}for(;G<L.length&&re+1<q.length&&!this._isCharWordSeparator(L.loadCell(G+1,this._workCell));){L.loadCell(G+1,this._workCell);const M=this._workCell.getChars().length;this._workCell.getWidth()===2?(x++,G++):M>1&&(U+=M-1,re+=M-1),re++,G++}}re++;let z=J+ie-ee+B,se=Math.min(this._bufferService.cols,re-J+ee+x-B-U);if(k||q.slice(J,re).trim()!==""){if(R&&z===0&&L.getCodePoint(0)!==32){const j=P.lines.get(b[1]-1);if(j&&L.isWrapped&&j.getCodePoint(this._bufferService.cols-1)!==32){const G=this._getWordAt([this._bufferService.cols-1,b[1]-1],!1,!0,!1);if(G){const Y=this._bufferService.cols-G.start;z-=Y,se+=Y}}}if(O&&z+se===this._bufferService.cols&&L.getCodePoint(this._bufferService.cols-1)!==32){const j=P.lines.get(b[1]+1);if(j?.isWrapped&&j.getCodePoint(0)!==32){const G=this._getWordAt([0,b[1]+1],!1,!1,!0);G&&(se+=G.length)}}return{start:z,length:se}}}_selectWordAt(b,k){const R=this._getWordAt(b,k);if(R){for(;R.start<0;)R.start+=this._bufferService.cols,b[1]--;this._model.selectionStart=[R.start,b[1]],this._model.selectionStartLength=R.length}}_selectToWordAt(b){const k=this._getWordAt(b,!0);if(k){let R=b[1];for(;k.start<0;)k.start+=this._bufferService.cols,R--;if(!this._model.areSelectionValuesReversed())for(;k.start+k.length>this._bufferService.cols;)k.length-=this._bufferService.cols,R++;this._model.selectionEnd=[this._model.areSelectionValuesReversed()?k.start:k.start+k.length,R]}}_isCharWordSeparator(b){return b.getWidth()!==0&&this._optionsService.rawOptions.wordSeparator.indexOf(b.getChars())>=0}_selectLineAt(b){const k=this._bufferService.buffer.getWrappedRangeForLine(b),R={start:{x:0,y:k.first},end:{x:this._bufferService.cols-1,y:k.last}};this._model.selectionStart=[0,k.first],this._model.selectionEnd=void 0,this._model.selectionStartLength=(0,_.getRangeLength)(R,this._bufferService.cols)}};r.SelectionService=E=u([f(3,y.IBufferService),f(4,y.ICoreService),f(5,C.IMouseService),f(6,y.IOptionsService),f(7,C.IRenderService),f(8,C.ICoreBrowserService)],E)},4725:(c,r,o)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.ILinkProviderService=r.IThemeService=r.ICharacterJoinerService=r.ISelectionService=r.IRenderService=r.IMouseService=r.ICoreBrowserService=r.ICharSizeService=void 0;const u=o(8343);r.ICharSizeService=(0,u.createDecorator)("CharSizeService"),r.ICoreBrowserService=(0,u.createDecorator)("CoreBrowserService"),r.IMouseService=(0,u.createDecorator)("MouseService"),r.IRenderService=(0,u.createDecorator)("RenderService"),r.ISelectionService=(0,u.createDecorator)("SelectionService"),r.ICharacterJoinerService=(0,u.createDecorator)("CharacterJoinerService"),r.IThemeService=(0,u.createDecorator)("ThemeService"),r.ILinkProviderService=(0,u.createDecorator)("LinkProviderService")},6731:function(c,r,o){var u=this&&this.__decorate||function(E,b,k,R){var O,P=arguments.length,L=P<3?b:R===null?R=Object.getOwnPropertyDescriptor(b,k):R;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")L=Reflect.decorate(E,b,k,R);else for(var q=E.length-1;q>=0;q--)(O=E[q])&&(L=(P<3?O(L):P>3?O(b,k,L):O(b,k))||L);return P>3&&L&&Object.defineProperty(b,k,L),L},f=this&&this.__param||function(E,b){return function(k,R){b(k,R,E)}};Object.defineProperty(r,"__esModule",{value:!0}),r.ThemeService=r.DEFAULT_ANSI_COLORS=void 0;const l=o(7239),m=o(8055),g=o(8460),C=o(844),v=o(2585),h=m.css.toColor("#ffffff"),p=m.css.toColor("#000000"),_=m.css.toColor("#ffffff"),d=m.css.toColor("#000000"),y={css:"rgba(255, 255, 255, 0.3)",rgba:4294967117};r.DEFAULT_ANSI_COLORS=Object.freeze((()=>{const E=[m.css.toColor("#2e3436"),m.css.toColor("#cc0000"),m.css.toColor("#4e9a06"),m.css.toColor("#c4a000"),m.css.toColor("#3465a4"),m.css.toColor("#75507b"),m.css.toColor("#06989a"),m.css.toColor("#d3d7cf"),m.css.toColor("#555753"),m.css.toColor("#ef2929"),m.css.toColor("#8ae234"),m.css.toColor("#fce94f"),m.css.toColor("#729fcf"),m.css.toColor("#ad7fa8"),m.css.toColor("#34e2e2"),m.css.toColor("#eeeeec")],b=[0,95,135,175,215,255];for(let k=0;k<216;k++){const R=b[k/36%6|0],O=b[k/6%6|0],P=b[k%6];E.push({css:m.channels.toCss(R,O,P),rgba:m.channels.toRgba(R,O,P)})}for(let k=0;k<24;k++){const R=8+10*k;E.push({css:m.channels.toCss(R,R,R),rgba:m.channels.toRgba(R,R,R)})}return E})());let S=r.ThemeService=class extends C.Disposable{get colors(){return this._colors}constructor(E){super(),this._optionsService=E,this._contrastCache=new l.ColorContrastCache,this._halfContrastCache=new l.ColorContrastCache,this._onChangeColors=this.register(new g.EventEmitter),this.onChangeColors=this._onChangeColors.event,this._colors={foreground:h,background:p,cursor:_,cursorAccent:d,selectionForeground:void 0,selectionBackgroundTransparent:y,selectionBackgroundOpaque:m.color.blend(p,y),selectionInactiveBackgroundTransparent:y,selectionInactiveBackgroundOpaque:m.color.blend(p,y),ansi:r.DEFAULT_ANSI_COLORS.slice(),contrastCache:this._contrastCache,halfContrastCache:this._halfContrastCache},this._updateRestoreColors(),this._setTheme(this._optionsService.rawOptions.theme),this.register(this._optionsService.onSpecificOptionChange("minimumContrastRatio",(()=>this._contrastCache.clear()))),this.register(this._optionsService.onSpecificOptionChange("theme",(()=>this._setTheme(this._optionsService.rawOptions.theme))))}_setTheme(E={}){const b=this._colors;if(b.foreground=w(E.foreground,h),b.background=w(E.background,p),b.cursor=w(E.cursor,_),b.cursorAccent=w(E.cursorAccent,d),b.selectionBackgroundTransparent=w(E.selectionBackground,y),b.selectionBackgroundOpaque=m.color.blend(b.background,b.selectionBackgroundTransparent),b.selectionInactiveBackgroundTransparent=w(E.selectionInactiveBackground,b.selectionBackgroundTransparent),b.selectionInactiveBackgroundOpaque=m.color.blend(b.background,b.selectionInactiveBackgroundTransparent),b.selectionForeground=E.selectionForeground?w(E.selectionForeground,m.NULL_COLOR):void 0,b.selectionForeground===m.NULL_COLOR&&(b.selectionForeground=void 0),m.color.isOpaque(b.selectionBackgroundTransparent)&&(b.selectionBackgroundTransparent=m.color.opacity(b.selectionBackgroundTransparent,.3)),m.color.isOpaque(b.selectionInactiveBackgroundTransparent)&&(b.selectionInactiveBackgroundTransparent=m.color.opacity(b.selectionInactiveBackgroundTransparent,.3)),b.ansi=r.DEFAULT_ANSI_COLORS.slice(),b.ansi[0]=w(E.black,r.DEFAULT_ANSI_COLORS[0]),b.ansi[1]=w(E.red,r.DEFAULT_ANSI_COLORS[1]),b.ansi[2]=w(E.green,r.DEFAULT_ANSI_COLORS[2]),b.ansi[3]=w(E.yellow,r.DEFAULT_ANSI_COLORS[3]),b.ansi[4]=w(E.blue,r.DEFAULT_ANSI_COLORS[4]),b.ansi[5]=w(E.magenta,r.DEFAULT_ANSI_COLORS[5]),b.ansi[6]=w(E.cyan,r.DEFAULT_ANSI_COLORS[6]),b.ansi[7]=w(E.white,r.DEFAULT_ANSI_COLORS[7]),b.ansi[8]=w(E.brightBlack,r.DEFAULT_ANSI_COLORS[8]),b.ansi[9]=w(E.brightRed,r.DEFAULT_ANSI_COLORS[9]),b.ansi[10]=w(E.brightGreen,r.DEFAULT_ANSI_COLORS[10]),b.ansi[11]=w(E.brightYellow,r.DEFAULT_ANSI_COLORS[11]),b.ansi[12]=w(E.brightBlue,r.DEFAULT_ANSI_COLORS[12]),b.ansi[13]=w(E.brightMagenta,r.DEFAULT_ANSI_COLORS[13]),b.ansi[14]=w(E.brightCyan,r.DEFAULT_ANSI_COLORS[14]),b.ansi[15]=w(E.brightWhite,r.DEFAULT_ANSI_COLORS[15]),E.extendedAnsi){const k=Math.min(b.ansi.length-16,E.extendedAnsi.length);for(let R=0;R<k;R++)b.ansi[R+16]=w(E.extendedAnsi[R],r.DEFAULT_ANSI_COLORS[R+16])}this._contrastCache.clear(),this._halfContrastCache.clear(),this._updateRestoreColors(),this._onChangeColors.fire(this.colors)}restoreColor(E){this._restoreColor(E),this._onChangeColors.fire(this.colors)}_restoreColor(E){if(E!==void 0)switch(E){case 256:this._colors.foreground=this._restoreColors.foreground;break;case 257:this._colors.background=this._restoreColors.background;break;case 258:this._colors.cursor=this._restoreColors.cursor;break;default:this._colors.ansi[E]=this._restoreColors.ansi[E]}else for(let b=0;b<this._restoreColors.ansi.length;++b)this._colors.ansi[b]=this._restoreColors.ansi[b]}modifyColors(E){E(this._colors),this._onChangeColors.fire(this.colors)}_updateRestoreColors(){this._restoreColors={foreground:this._colors.foreground,background:this._colors.background,cursor:this._colors.cursor,ansi:this._colors.ansi.slice()}}};function w(E,b){if(E!==void 0)try{return m.css.toColor(E)}catch{}return b}r.ThemeService=S=u([f(0,v.IOptionsService)],S)},6349:(c,r,o)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.CircularList=void 0;const u=o(8460),f=o(844);class l extends f.Disposable{constructor(g){super(),this._maxLength=g,this.onDeleteEmitter=this.register(new u.EventEmitter),this.onDelete=this.onDeleteEmitter.event,this.onInsertEmitter=this.register(new u.EventEmitter),this.onInsert=this.onInsertEmitter.event,this.onTrimEmitter=this.register(new u.EventEmitter),this.onTrim=this.onTrimEmitter.event,this._array=new Array(this._maxLength),this._startIndex=0,this._length=0}get maxLength(){return this._maxLength}set maxLength(g){if(this._maxLength===g)return;const C=new Array(g);for(let v=0;v<Math.min(g,this.length);v++)C[v]=this._array[this._getCyclicIndex(v)];this._array=C,this._maxLength=g,this._startIndex=0}get length(){return this._length}set length(g){if(g>this._length)for(let C=this._length;C<g;C++)this._array[C]=void 0;this._length=g}get(g){return this._array[this._getCyclicIndex(g)]}set(g,C){this._array[this._getCyclicIndex(g)]=C}push(g){this._array[this._getCyclicIndex(this._length)]=g,this._length===this._maxLength?(this._startIndex=++this._startIndex%this._maxLength,this.onTrimEmitter.fire(1)):this._length++}recycle(){if(this._length!==this._maxLength)throw new Error("Can only recycle when the buffer is full");return this._startIndex=++this._startIndex%this._maxLength,this.onTrimEmitter.fire(1),this._array[this._getCyclicIndex(this._length-1)]}get isFull(){return this._length===this._maxLength}pop(){return this._array[this._getCyclicIndex(this._length---1)]}splice(g,C,...v){if(C){for(let h=g;h<this._length-C;h++)this._array[this._getCyclicIndex(h)]=this._array[this._getCyclicIndex(h+C)];this._length-=C,this.onDeleteEmitter.fire({index:g,amount:C})}for(let h=this._length-1;h>=g;h--)this._array[this._getCyclicIndex(h+v.length)]=this._array[this._getCyclicIndex(h)];for(let h=0;h<v.length;h++)this._array[this._getCyclicIndex(g+h)]=v[h];if(v.length&&this.onInsertEmitter.fire({index:g,amount:v.length}),this._length+v.length>this._maxLength){const h=this._length+v.length-this._maxLength;this._startIndex+=h,this._length=this._maxLength,this.onTrimEmitter.fire(h)}else this._length+=v.length}trimStart(g){g>this._length&&(g=this._length),this._startIndex+=g,this._length-=g,this.onTrimEmitter.fire(g)}shiftElements(g,C,v){if(!(C<=0)){if(g<0||g>=this._length)throw new Error("start argument out of range");if(g+v<0)throw new Error("Cannot shift elements in list beyond index 0");if(v>0){for(let p=C-1;p>=0;p--)this.set(g+p+v,this.get(g+p));const h=g+C+v-this._length;if(h>0)for(this._length+=h;this._length>this._maxLength;)this._length--,this._startIndex++,this.onTrimEmitter.fire(1)}else for(let h=0;h<C;h++)this.set(g+h+v,this.get(g+h))}}_getCyclicIndex(g){return(this._startIndex+g)%this._maxLength}}r.CircularList=l},1439:(c,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.clone=void 0,r.clone=function o(u,f=5){if(typeof u!="object")return u;const l=Array.isArray(u)?[]:{};for(const m in u)l[m]=f<=1?u[m]:u[m]&&o(u[m],f-1);return l}},8055:(c,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.contrastRatio=r.toPaddedHex=r.rgba=r.rgb=r.css=r.color=r.channels=r.NULL_COLOR=void 0;let o=0,u=0,f=0,l=0;var m,g,C,v,h;function p(d){const y=d.toString(16);return y.length<2?"0"+y:y}function _(d,y){return d<y?(y+.05)/(d+.05):(d+.05)/(y+.05)}r.NULL_COLOR={css:"#00000000",rgba:0},(function(d){d.toCss=function(y,S,w,E){return E!==void 0?`#${p(y)}${p(S)}${p(w)}${p(E)}`:`#${p(y)}${p(S)}${p(w)}`},d.toRgba=function(y,S,w,E=255){return(y<<24|S<<16|w<<8|E)>>>0},d.toColor=function(y,S,w,E){return{css:d.toCss(y,S,w,E),rgba:d.toRgba(y,S,w,E)}}})(m||(r.channels=m={})),(function(d){function y(S,w){return l=Math.round(255*w),[o,u,f]=h.toChannels(S.rgba),{css:m.toCss(o,u,f,l),rgba:m.toRgba(o,u,f,l)}}d.blend=function(S,w){if(l=(255&w.rgba)/255,l===1)return{css:w.css,rgba:w.rgba};const E=w.rgba>>24&255,b=w.rgba>>16&255,k=w.rgba>>8&255,R=S.rgba>>24&255,O=S.rgba>>16&255,P=S.rgba>>8&255;return o=R+Math.round((E-R)*l),u=O+Math.round((b-O)*l),f=P+Math.round((k-P)*l),{css:m.toCss(o,u,f),rgba:m.toRgba(o,u,f)}},d.isOpaque=function(S){return(255&S.rgba)==255},d.ensureContrastRatio=function(S,w,E){const b=h.ensureContrastRatio(S.rgba,w.rgba,E);if(b)return m.toColor(b>>24&255,b>>16&255,b>>8&255)},d.opaque=function(S){const w=(255|S.rgba)>>>0;return[o,u,f]=h.toChannels(w),{css:m.toCss(o,u,f),rgba:w}},d.opacity=y,d.multiplyOpacity=function(S,w){return l=255&S.rgba,y(S,l*w/255)},d.toColorRGB=function(S){return[S.rgba>>24&255,S.rgba>>16&255,S.rgba>>8&255]}})(g||(r.color=g={})),(function(d){let y,S;try{const w=document.createElement("canvas");w.width=1,w.height=1;const E=w.getContext("2d",{willReadFrequently:!0});E&&(y=E,y.globalCompositeOperation="copy",S=y.createLinearGradient(0,0,1,1))}catch{}d.toColor=function(w){if(w.match(/#[\da-f]{3,8}/i))switch(w.length){case 4:return o=parseInt(w.slice(1,2).repeat(2),16),u=parseInt(w.slice(2,3).repeat(2),16),f=parseInt(w.slice(3,4).repeat(2),16),m.toColor(o,u,f);case 5:return o=parseInt(w.slice(1,2).repeat(2),16),u=parseInt(w.slice(2,3).repeat(2),16),f=parseInt(w.slice(3,4).repeat(2),16),l=parseInt(w.slice(4,5).repeat(2),16),m.toColor(o,u,f,l);case 7:return{css:w,rgba:(parseInt(w.slice(1),16)<<8|255)>>>0};case 9:return{css:w,rgba:parseInt(w.slice(1),16)>>>0}}const E=w.match(/rgba?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(,\s*(0|1|\d?\.(\d+))\s*)?\)/);if(E)return o=parseInt(E[1]),u=parseInt(E[2]),f=parseInt(E[3]),l=Math.round(255*(E[5]===void 0?1:parseFloat(E[5]))),m.toColor(o,u,f,l);if(!y||!S)throw new Error("css.toColor: Unsupported css format");if(y.fillStyle=S,y.fillStyle=w,typeof y.fillStyle!="string")throw new Error("css.toColor: Unsupported css format");if(y.fillRect(0,0,1,1),[o,u,f,l]=y.getImageData(0,0,1,1).data,l!==255)throw new Error("css.toColor: Unsupported css format");return{rgba:m.toRgba(o,u,f,l),css:w}}})(C||(r.css=C={})),(function(d){function y(S,w,E){const b=S/255,k=w/255,R=E/255;return .2126*(b<=.03928?b/12.92:Math.pow((b+.055)/1.055,2.4))+.7152*(k<=.03928?k/12.92:Math.pow((k+.055)/1.055,2.4))+.0722*(R<=.03928?R/12.92:Math.pow((R+.055)/1.055,2.4))}d.relativeLuminance=function(S){return y(S>>16&255,S>>8&255,255&S)},d.relativeLuminance2=y})(v||(r.rgb=v={})),(function(d){function y(w,E,b){const k=w>>24&255,R=w>>16&255,O=w>>8&255;let P=E>>24&255,L=E>>16&255,q=E>>8&255,J=_(v.relativeLuminance2(P,L,q),v.relativeLuminance2(k,R,O));for(;J<b&&(P>0||L>0||q>0);)P-=Math.max(0,Math.ceil(.1*P)),L-=Math.max(0,Math.ceil(.1*L)),q-=Math.max(0,Math.ceil(.1*q)),J=_(v.relativeLuminance2(P,L,q),v.relativeLuminance2(k,R,O));return(P<<24|L<<16|q<<8|255)>>>0}function S(w,E,b){const k=w>>24&255,R=w>>16&255,O=w>>8&255;let P=E>>24&255,L=E>>16&255,q=E>>8&255,J=_(v.relativeLuminance2(P,L,q),v.relativeLuminance2(k,R,O));for(;J<b&&(P<255||L<255||q<255);)P=Math.min(255,P+Math.ceil(.1*(255-P))),L=Math.min(255,L+Math.ceil(.1*(255-L))),q=Math.min(255,q+Math.ceil(.1*(255-q))),J=_(v.relativeLuminance2(P,L,q),v.relativeLuminance2(k,R,O));return(P<<24|L<<16|q<<8|255)>>>0}d.blend=function(w,E){if(l=(255&E)/255,l===1)return E;const b=E>>24&255,k=E>>16&255,R=E>>8&255,O=w>>24&255,P=w>>16&255,L=w>>8&255;return o=O+Math.round((b-O)*l),u=P+Math.round((k-P)*l),f=L+Math.round((R-L)*l),m.toRgba(o,u,f)},d.ensureContrastRatio=function(w,E,b){const k=v.relativeLuminance(w>>8),R=v.relativeLuminance(E>>8);if(_(k,R)<b){if(R<k){const L=y(w,E,b),q=_(k,v.relativeLuminance(L>>8));if(q<b){const J=S(w,E,b);return q>_(k,v.relativeLuminance(J>>8))?L:J}return L}const O=S(w,E,b),P=_(k,v.relativeLuminance(O>>8));if(P<b){const L=y(w,E,b);return P>_(k,v.relativeLuminance(L>>8))?O:L}return O}},d.reduceLuminance=y,d.increaseLuminance=S,d.toChannels=function(w){return[w>>24&255,w>>16&255,w>>8&255,255&w]}})(h||(r.rgba=h={})),r.toPaddedHex=p,r.contrastRatio=_},8969:(c,r,o)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.CoreTerminal=void 0;const u=o(844),f=o(2585),l=o(4348),m=o(7866),g=o(744),C=o(7302),v=o(6975),h=o(8460),p=o(1753),_=o(1480),d=o(7994),y=o(9282),S=o(5435),w=o(5981),E=o(2660);let b=!1;class k extends u.Disposable{get onScroll(){return this._onScrollApi||(this._onScrollApi=this.register(new h.EventEmitter),this._onScroll.event((O=>{this._onScrollApi?.fire(O.position)}))),this._onScrollApi.event}get cols(){return this._bufferService.cols}get rows(){return this._bufferService.rows}get buffers(){return this._bufferService.buffers}get options(){return this.optionsService.options}set options(O){for(const P in O)this.optionsService.options[P]=O[P]}constructor(O){super(),this._windowsWrappingHeuristics=this.register(new u.MutableDisposable),this._onBinary=this.register(new h.EventEmitter),this.onBinary=this._onBinary.event,this._onData=this.register(new h.EventEmitter),this.onData=this._onData.event,this._onLineFeed=this.register(new h.EventEmitter),this.onLineFeed=this._onLineFeed.event,this._onResize=this.register(new h.EventEmitter),this.onResize=this._onResize.event,this._onWriteParsed=this.register(new h.EventEmitter),this.onWriteParsed=this._onWriteParsed.event,this._onScroll=this.register(new h.EventEmitter),this._instantiationService=new l.InstantiationService,this.optionsService=this.register(new C.OptionsService(O)),this._instantiationService.setService(f.IOptionsService,this.optionsService),this._bufferService=this.register(this._instantiationService.createInstance(g.BufferService)),this._instantiationService.setService(f.IBufferService,this._bufferService),this._logService=this.register(this._instantiationService.createInstance(m.LogService)),this._instantiationService.setService(f.ILogService,this._logService),this.coreService=this.register(this._instantiationService.createInstance(v.CoreService)),this._instantiationService.setService(f.ICoreService,this.coreService),this.coreMouseService=this.register(this._instantiationService.createInstance(p.CoreMouseService)),this._instantiationService.setService(f.ICoreMouseService,this.coreMouseService),this.unicodeService=this.register(this._instantiationService.createInstance(_.UnicodeService)),this._instantiationService.setService(f.IUnicodeService,this.unicodeService),this._charsetService=this._instantiationService.createInstance(d.CharsetService),this._instantiationService.setService(f.ICharsetService,this._charsetService),this._oscLinkService=this._instantiationService.createInstance(E.OscLinkService),this._instantiationService.setService(f.IOscLinkService,this._oscLinkService),this._inputHandler=this.register(new S.InputHandler(this._bufferService,this._charsetService,this.coreService,this._logService,this.optionsService,this._oscLinkService,this.coreMouseService,this.unicodeService)),this.register((0,h.forwardEvent)(this._inputHandler.onLineFeed,this._onLineFeed)),this.register(this._inputHandler),this.register((0,h.forwardEvent)(this._bufferService.onResize,this._onResize)),this.register((0,h.forwardEvent)(this.coreService.onData,this._onData)),this.register((0,h.forwardEvent)(this.coreService.onBinary,this._onBinary)),this.register(this.coreService.onRequestScrollToBottom((()=>this.scrollToBottom()))),this.register(this.coreService.onUserInput((()=>this._writeBuffer.handleUserInput()))),this.register(this.optionsService.onMultipleOptionChange(["windowsMode","windowsPty"],(()=>this._handleWindowsPtyOptionChange()))),this.register(this._bufferService.onScroll((P=>{this._onScroll.fire({position:this._bufferService.buffer.ydisp,source:0}),this._inputHandler.markRangeDirty(this._bufferService.buffer.scrollTop,this._bufferService.buffer.scrollBottom)}))),this.register(this._inputHandler.onScroll((P=>{this._onScroll.fire({position:this._bufferService.buffer.ydisp,source:0}),this._inputHandler.markRangeDirty(this._bufferService.buffer.scrollTop,this._bufferService.buffer.scrollBottom)}))),this._writeBuffer=this.register(new w.WriteBuffer(((P,L)=>this._inputHandler.parse(P,L)))),this.register((0,h.forwardEvent)(this._writeBuffer.onWriteParsed,this._onWriteParsed))}write(O,P){this._writeBuffer.write(O,P)}writeSync(O,P){this._logService.logLevel<=f.LogLevelEnum.WARN&&!b&&(this._logService.warn("writeSync is unreliable and will be removed soon."),b=!0),this._writeBuffer.writeSync(O,P)}input(O,P=!0){this.coreService.triggerDataEvent(O,P)}resize(O,P){isNaN(O)||isNaN(P)||(O=Math.max(O,g.MINIMUM_COLS),P=Math.max(P,g.MINIMUM_ROWS),this._bufferService.resize(O,P))}scroll(O,P=!1){this._bufferService.scroll(O,P)}scrollLines(O,P,L){this._bufferService.scrollLines(O,P,L)}scrollPages(O){this.scrollLines(O*(this.rows-1))}scrollToTop(){this.scrollLines(-this._bufferService.buffer.ydisp)}scrollToBottom(){this.scrollLines(this._bufferService.buffer.ybase-this._bufferService.buffer.ydisp)}scrollToLine(O){const P=O-this._bufferService.buffer.ydisp;P!==0&&this.scrollLines(P)}registerEscHandler(O,P){return this._inputHandler.registerEscHandler(O,P)}registerDcsHandler(O,P){return this._inputHandler.registerDcsHandler(O,P)}registerCsiHandler(O,P){return this._inputHandler.registerCsiHandler(O,P)}registerOscHandler(O,P){return this._inputHandler.registerOscHandler(O,P)}_setup(){this._handleWindowsPtyOptionChange()}reset(){this._inputHandler.reset(),this._bufferService.reset(),this._charsetService.reset(),this.coreService.reset(),this.coreMouseService.reset()}_handleWindowsPtyOptionChange(){let O=!1;const P=this.optionsService.rawOptions.windowsPty;P&&P.buildNumber!==void 0&&P.buildNumber!==void 0?O=P.backend==="conpty"&&P.buildNumber<21376:this.optionsService.rawOptions.windowsMode&&(O=!0),O?this._enableWindowsWrappingHeuristics():this._windowsWrappingHeuristics.clear()}_enableWindowsWrappingHeuristics(){if(!this._windowsWrappingHeuristics.value){const O=[];O.push(this.onLineFeed(y.updateWindowsModeWrappedState.bind(null,this._bufferService))),O.push(this.registerCsiHandler({final:"H"},(()=>((0,y.updateWindowsModeWrappedState)(this._bufferService),!1)))),this._windowsWrappingHeuristics.value=(0,u.toDisposable)((()=>{for(const P of O)P.dispose()}))}}}r.CoreTerminal=k},8460:(c,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.runAndSubscribe=r.forwardEvent=r.EventEmitter=void 0,r.EventEmitter=class{constructor(){this._listeners=[],this._disposed=!1}get event(){return this._event||(this._event=o=>(this._listeners.push(o),{dispose:()=>{if(!this._disposed){for(let u=0;u<this._listeners.length;u++)if(this._listeners[u]===o)return void this._listeners.splice(u,1)}}})),this._event}fire(o,u){const f=[];for(let l=0;l<this._listeners.length;l++)f.push(this._listeners[l]);for(let l=0;l<f.length;l++)f[l].call(void 0,o,u)}dispose(){this.clearListeners(),this._disposed=!0}clearListeners(){this._listeners&&(this._listeners.length=0)}},r.forwardEvent=function(o,u){return o((f=>u.fire(f)))},r.runAndSubscribe=function(o,u){return u(void 0),o((f=>u(f)))}},5435:function(c,r,o){var u=this&&this.__decorate||function(ee,x,B,U){var z,se=arguments.length,j=se<3?x:U===null?U=Object.getOwnPropertyDescriptor(x,B):U;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")j=Reflect.decorate(ee,x,B,U);else for(var G=ee.length-1;G>=0;G--)(z=ee[G])&&(j=(se<3?z(j):se>3?z(x,B,j):z(x,B))||j);return se>3&&j&&Object.defineProperty(x,B,j),j},f=this&&this.__param||function(ee,x){return function(B,U){x(B,U,ee)}};Object.defineProperty(r,"__esModule",{value:!0}),r.InputHandler=r.WindowsOptionsReportType=void 0;const l=o(2584),m=o(7116),g=o(2015),C=o(844),v=o(482),h=o(8437),p=o(8460),_=o(643),d=o(511),y=o(3734),S=o(2585),w=o(1480),E=o(6242),b=o(6351),k=o(5941),R={"(":0,")":1,"*":2,"+":3,"-":1,".":2},O=131072;function P(ee,x){if(ee>24)return x.setWinLines||!1;switch(ee){case 1:return!!x.restoreWin;case 2:return!!x.minimizeWin;case 3:return!!x.setWinPosition;case 4:return!!x.setWinSizePixels;case 5:return!!x.raiseWin;case 6:return!!x.lowerWin;case 7:return!!x.refreshWin;case 8:return!!x.setWinSizeChars;case 9:return!!x.maximizeWin;case 10:return!!x.fullscreenWin;case 11:return!!x.getWinState;case 13:return!!x.getWinPosition;case 14:return!!x.getWinSizePixels;case 15:return!!x.getScreenSizePixels;case 16:return!!x.getCellSizePixels;case 18:return!!x.getWinSizeChars;case 19:return!!x.getScreenSizeChars;case 20:return!!x.getIconTitle;case 21:return!!x.getWinTitle;case 22:return!!x.pushTitle;case 23:return!!x.popTitle;case 24:return!!x.setWinLines}return!1}var L;(function(ee){ee[ee.GET_WIN_SIZE_PIXELS=0]="GET_WIN_SIZE_PIXELS",ee[ee.GET_CELL_SIZE_PIXELS=1]="GET_CELL_SIZE_PIXELS"})(L||(r.WindowsOptionsReportType=L={}));let q=0;class J extends C.Disposable{getAttrData(){return this._curAttrData}constructor(x,B,U,z,se,j,G,Y,M=new g.EscapeSequenceParser){super(),this._bufferService=x,this._charsetService=B,this._coreService=U,this._logService=z,this._optionsService=se,this._oscLinkService=j,this._coreMouseService=G,this._unicodeService=Y,this._parser=M,this._parseBuffer=new Uint32Array(4096),this._stringDecoder=new v.StringToUtf32,this._utf8Decoder=new v.Utf8ToUtf32,this._workCell=new d.CellData,this._windowTitle="",this._iconName="",this._windowTitleStack=[],this._iconNameStack=[],this._curAttrData=h.DEFAULT_ATTR_DATA.clone(),this._eraseAttrDataInternal=h.DEFAULT_ATTR_DATA.clone(),this._onRequestBell=this.register(new p.EventEmitter),this.onRequestBell=this._onRequestBell.event,this._onRequestRefreshRows=this.register(new p.EventEmitter),this.onRequestRefreshRows=this._onRequestRefreshRows.event,this._onRequestReset=this.register(new p.EventEmitter),this.onRequestReset=this._onRequestReset.event,this._onRequestSendFocus=this.register(new p.EventEmitter),this.onRequestSendFocus=this._onRequestSendFocus.event,this._onRequestSyncScrollBar=this.register(new p.EventEmitter),this.onRequestSyncScrollBar=this._onRequestSyncScrollBar.event,this._onRequestWindowsOptionsReport=this.register(new p.EventEmitter),this.onRequestWindowsOptionsReport=this._onRequestWindowsOptionsReport.event,this._onA11yChar=this.register(new p.EventEmitter),this.onA11yChar=this._onA11yChar.event,this._onA11yTab=this.register(new p.EventEmitter),this.onA11yTab=this._onA11yTab.event,this._onCursorMove=this.register(new p.EventEmitter),this.onCursorMove=this._onCursorMove.event,this._onLineFeed=this.register(new p.EventEmitter),this.onLineFeed=this._onLineFeed.event,this._onScroll=this.register(new p.EventEmitter),this.onScroll=this._onScroll.event,this._onTitleChange=this.register(new p.EventEmitter),this.onTitleChange=this._onTitleChange.event,this._onColor=this.register(new p.EventEmitter),this.onColor=this._onColor.event,this._parseStack={paused:!1,cursorStartX:0,cursorStartY:0,decodedLength:0,position:0},this._specialColors=[256,257,258],this.register(this._parser),this._dirtyRowTracker=new re(this._bufferService),this._activeBuffer=this._bufferService.buffer,this.register(this._bufferService.buffers.onBufferActivate((T=>this._activeBuffer=T.activeBuffer))),this._parser.setCsiHandlerFallback(((T,K)=>{this._logService.debug("Unknown CSI code: ",{identifier:this._parser.identToString(T),params:K.toArray()})})),this._parser.setEscHandlerFallback((T=>{this._logService.debug("Unknown ESC code: ",{identifier:this._parser.identToString(T)})})),this._parser.setExecuteHandlerFallback((T=>{this._logService.debug("Unknown EXECUTE code: ",{code:T})})),this._parser.setOscHandlerFallback(((T,K,H)=>{this._logService.debug("Unknown OSC code: ",{identifier:T,action:K,data:H})})),this._parser.setDcsHandlerFallback(((T,K,H)=>{K==="HOOK"&&(H=H.toArray()),this._logService.debug("Unknown DCS code: ",{identifier:this._parser.identToString(T),action:K,payload:H})})),this._parser.setPrintHandler(((T,K,H)=>this.print(T,K,H))),this._parser.registerCsiHandler({final:"@"},(T=>this.insertChars(T))),this._parser.registerCsiHandler({intermediates:" ",final:"@"},(T=>this.scrollLeft(T))),this._parser.registerCsiHandler({final:"A"},(T=>this.cursorUp(T))),this._parser.registerCsiHandler({intermediates:" ",final:"A"},(T=>this.scrollRight(T))),this._parser.registerCsiHandler({final:"B"},(T=>this.cursorDown(T))),this._parser.registerCsiHandler({final:"C"},(T=>this.cursorForward(T))),this._parser.registerCsiHandler({final:"D"},(T=>this.cursorBackward(T))),this._parser.registerCsiHandler({final:"E"},(T=>this.cursorNextLine(T))),this._parser.registerCsiHandler({final:"F"},(T=>this.cursorPrecedingLine(T))),this._parser.registerCsiHandler({final:"G"},(T=>this.cursorCharAbsolute(T))),this._parser.registerCsiHandler({final:"H"},(T=>this.cursorPosition(T))),this._parser.registerCsiHandler({final:"I"},(T=>this.cursorForwardTab(T))),this._parser.registerCsiHandler({final:"J"},(T=>this.eraseInDisplay(T,!1))),this._parser.registerCsiHandler({prefix:"?",final:"J"},(T=>this.eraseInDisplay(T,!0))),this._parser.registerCsiHandler({final:"K"},(T=>this.eraseInLine(T,!1))),this._parser.registerCsiHandler({prefix:"?",final:"K"},(T=>this.eraseInLine(T,!0))),this._parser.registerCsiHandler({final:"L"},(T=>this.insertLines(T))),this._parser.registerCsiHandler({final:"M"},(T=>this.deleteLines(T))),this._parser.registerCsiHandler({final:"P"},(T=>this.deleteChars(T))),this._parser.registerCsiHandler({final:"S"},(T=>this.scrollUp(T))),this._parser.registerCsiHandler({final:"T"},(T=>this.scrollDown(T))),this._parser.registerCsiHandler({final:"X"},(T=>this.eraseChars(T))),this._parser.registerCsiHandler({final:"Z"},(T=>this.cursorBackwardTab(T))),this._parser.registerCsiHandler({final:"`"},(T=>this.charPosAbsolute(T))),this._parser.registerCsiHandler({final:"a"},(T=>this.hPositionRelative(T))),this._parser.registerCsiHandler({final:"b"},(T=>this.repeatPrecedingCharacter(T))),this._parser.registerCsiHandler({final:"c"},(T=>this.sendDeviceAttributesPrimary(T))),this._parser.registerCsiHandler({prefix:">",final:"c"},(T=>this.sendDeviceAttributesSecondary(T))),this._parser.registerCsiHandler({final:"d"},(T=>this.linePosAbsolute(T))),this._parser.registerCsiHandler({final:"e"},(T=>this.vPositionRelative(T))),this._parser.registerCsiHandler({final:"f"},(T=>this.hVPosition(T))),this._parser.registerCsiHandler({final:"g"},(T=>this.tabClear(T))),this._parser.registerCsiHandler({final:"h"},(T=>this.setMode(T))),this._parser.registerCsiHandler({prefix:"?",final:"h"},(T=>this.setModePrivate(T))),this._parser.registerCsiHandler({final:"l"},(T=>this.resetMode(T))),this._parser.registerCsiHandler({prefix:"?",final:"l"},(T=>this.resetModePrivate(T))),this._parser.registerCsiHandler({final:"m"},(T=>this.charAttributes(T))),this._parser.registerCsiHandler({final:"n"},(T=>this.deviceStatus(T))),this._parser.registerCsiHandler({prefix:"?",final:"n"},(T=>this.deviceStatusPrivate(T))),this._parser.registerCsiHandler({intermediates:"!",final:"p"},(T=>this.softReset(T))),this._parser.registerCsiHandler({intermediates:" ",final:"q"},(T=>this.setCursorStyle(T))),this._parser.registerCsiHandler({final:"r"},(T=>this.setScrollRegion(T))),this._parser.registerCsiHandler({final:"s"},(T=>this.saveCursor(T))),this._parser.registerCsiHandler({final:"t"},(T=>this.windowOptions(T))),this._parser.registerCsiHandler({final:"u"},(T=>this.restoreCursor(T))),this._parser.registerCsiHandler({intermediates:"'",final:"}"},(T=>this.insertColumns(T))),this._parser.registerCsiHandler({intermediates:"'",final:"~"},(T=>this.deleteColumns(T))),this._parser.registerCsiHandler({intermediates:'"',final:"q"},(T=>this.selectProtected(T))),this._parser.registerCsiHandler({intermediates:"$",final:"p"},(T=>this.requestMode(T,!0))),this._parser.registerCsiHandler({prefix:"?",intermediates:"$",final:"p"},(T=>this.requestMode(T,!1))),this._parser.setExecuteHandler(l.C0.BEL,(()=>this.bell())),this._parser.setExecuteHandler(l.C0.LF,(()=>this.lineFeed())),this._parser.setExecuteHandler(l.C0.VT,(()=>this.lineFeed())),this._parser.setExecuteHandler(l.C0.FF,(()=>this.lineFeed())),this._parser.setExecuteHandler(l.C0.CR,(()=>this.carriageReturn())),this._parser.setExecuteHandler(l.C0.BS,(()=>this.backspace())),this._parser.setExecuteHandler(l.C0.HT,(()=>this.tab())),this._parser.setExecuteHandler(l.C0.SO,(()=>this.shiftOut())),this._parser.setExecuteHandler(l.C0.SI,(()=>this.shiftIn())),this._parser.setExecuteHandler(l.C1.IND,(()=>this.index())),this._parser.setExecuteHandler(l.C1.NEL,(()=>this.nextLine())),this._parser.setExecuteHandler(l.C1.HTS,(()=>this.tabSet())),this._parser.registerOscHandler(0,new E.OscHandler((T=>(this.setTitle(T),this.setIconName(T),!0)))),this._parser.registerOscHandler(1,new E.OscHandler((T=>this.setIconName(T)))),this._parser.registerOscHandler(2,new E.OscHandler((T=>this.setTitle(T)))),this._parser.registerOscHandler(4,new E.OscHandler((T=>this.setOrReportIndexedColor(T)))),this._parser.registerOscHandler(8,new E.OscHandler((T=>this.setHyperlink(T)))),this._parser.registerOscHandler(10,new E.OscHandler((T=>this.setOrReportFgColor(T)))),this._parser.registerOscHandler(11,new E.OscHandler((T=>this.setOrReportBgColor(T)))),this._parser.registerOscHandler(12,new E.OscHandler((T=>this.setOrReportCursorColor(T)))),this._parser.registerOscHandler(104,new E.OscHandler((T=>this.restoreIndexedColor(T)))),this._parser.registerOscHandler(110,new E.OscHandler((T=>this.restoreFgColor(T)))),this._parser.registerOscHandler(111,new E.OscHandler((T=>this.restoreBgColor(T)))),this._parser.registerOscHandler(112,new E.OscHandler((T=>this.restoreCursorColor(T)))),this._parser.registerEscHandler({final:"7"},(()=>this.saveCursor())),this._parser.registerEscHandler({final:"8"},(()=>this.restoreCursor())),this._parser.registerEscHandler({final:"D"},(()=>this.index())),this._parser.registerEscHandler({final:"E"},(()=>this.nextLine())),this._parser.registerEscHandler({final:"H"},(()=>this.tabSet())),this._parser.registerEscHandler({final:"M"},(()=>this.reverseIndex())),this._parser.registerEscHandler({final:"="},(()=>this.keypadApplicationMode())),this._parser.registerEscHandler({final:">"},(()=>this.keypadNumericMode())),this._parser.registerEscHandler({final:"c"},(()=>this.fullReset())),this._parser.registerEscHandler({final:"n"},(()=>this.setgLevel(2))),this._parser.registerEscHandler({final:"o"},(()=>this.setgLevel(3))),this._parser.registerEscHandler({final:"|"},(()=>this.setgLevel(3))),this._parser.registerEscHandler({final:"}"},(()=>this.setgLevel(2))),this._parser.registerEscHandler({final:"~"},(()=>this.setgLevel(1))),this._parser.registerEscHandler({intermediates:"%",final:"@"},(()=>this.selectDefaultCharset())),this._parser.registerEscHandler({intermediates:"%",final:"G"},(()=>this.selectDefaultCharset()));for(const T in m.CHARSETS)this._parser.registerEscHandler({intermediates:"(",final:T},(()=>this.selectCharset("("+T))),this._parser.registerEscHandler({intermediates:")",final:T},(()=>this.selectCharset(")"+T))),this._parser.registerEscHandler({intermediates:"*",final:T},(()=>this.selectCharset("*"+T))),this._parser.registerEscHandler({intermediates:"+",final:T},(()=>this.selectCharset("+"+T))),this._parser.registerEscHandler({intermediates:"-",final:T},(()=>this.selectCharset("-"+T))),this._parser.registerEscHandler({intermediates:".",final:T},(()=>this.selectCharset("."+T))),this._parser.registerEscHandler({intermediates:"/",final:T},(()=>this.selectCharset("/"+T)));this._parser.registerEscHandler({intermediates:"#",final:"8"},(()=>this.screenAlignmentPattern())),this._parser.setErrorHandler((T=>(this._logService.error("Parsing error: ",T),T))),this._parser.registerDcsHandler({intermediates:"$",final:"q"},new b.DcsHandler(((T,K)=>this.requestStatusString(T,K))))}_preserveStack(x,B,U,z){this._parseStack.paused=!0,this._parseStack.cursorStartX=x,this._parseStack.cursorStartY=B,this._parseStack.decodedLength=U,this._parseStack.position=z}_logSlowResolvingAsync(x){this._logService.logLevel<=S.LogLevelEnum.WARN&&Promise.race([x,new Promise(((B,U)=>setTimeout((()=>U("#SLOW_TIMEOUT")),5e3)))]).catch((B=>{if(B!=="#SLOW_TIMEOUT")throw B;console.warn("async parser handler taking longer than 5000 ms")}))}_getCurrentLinkId(){return this._curAttrData.extended.urlId}parse(x,B){let U,z=this._activeBuffer.x,se=this._activeBuffer.y,j=0;const G=this._parseStack.paused;if(G){if(U=this._parser.parse(this._parseBuffer,this._parseStack.decodedLength,B))return this._logSlowResolvingAsync(U),U;z=this._parseStack.cursorStartX,se=this._parseStack.cursorStartY,this._parseStack.paused=!1,x.length>O&&(j=this._parseStack.position+O)}if(this._logService.logLevel<=S.LogLevelEnum.DEBUG&&this._logService.debug("parsing data"+(typeof x=="string"?` "${x}"`:` "${Array.prototype.map.call(x,(T=>String.fromCharCode(T))).join("")}"`),typeof x=="string"?x.split("").map((T=>T.charCodeAt(0))):x),this._parseBuffer.length<x.length&&this._parseBuffer.length<O&&(this._parseBuffer=new Uint32Array(Math.min(x.length,O))),G||this._dirtyRowTracker.clearRange(),x.length>O)for(let T=j;T<x.length;T+=O){const K=T+O<x.length?T+O:x.length,H=typeof x=="string"?this._stringDecoder.decode(x.substring(T,K),this._parseBuffer):this._utf8Decoder.decode(x.subarray(T,K),this._parseBuffer);if(U=this._parser.parse(this._parseBuffer,H))return this._preserveStack(z,se,H,T),this._logSlowResolvingAsync(U),U}else if(!G){const T=typeof x=="string"?this._stringDecoder.decode(x,this._parseBuffer):this._utf8Decoder.decode(x,this._parseBuffer);if(U=this._parser.parse(this._parseBuffer,T))return this._preserveStack(z,se,T,0),this._logSlowResolvingAsync(U),U}this._activeBuffer.x===z&&this._activeBuffer.y===se||this._onCursorMove.fire();const Y=this._dirtyRowTracker.end+(this._bufferService.buffer.ybase-this._bufferService.buffer.ydisp),M=this._dirtyRowTracker.start+(this._bufferService.buffer.ybase-this._bufferService.buffer.ydisp);M<this._bufferService.rows&&this._onRequestRefreshRows.fire(Math.min(M,this._bufferService.rows-1),Math.min(Y,this._bufferService.rows-1))}print(x,B,U){let z,se;const j=this._charsetService.charset,G=this._optionsService.rawOptions.screenReaderMode,Y=this._bufferService.cols,M=this._coreService.decPrivateModes.wraparound,T=this._coreService.modes.insertMode,K=this._curAttrData;let H=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);this._dirtyRowTracker.markDirty(this._activeBuffer.y),this._activeBuffer.x&&U-B>0&&H.getWidth(this._activeBuffer.x-1)===2&&H.setCellFromCodepoint(this._activeBuffer.x-1,0,1,K);let X=this._parser.precedingJoinState;for(let Q=B;Q<U;++Q){if(z=x[Q],z<127&&j){const Ae=j[String.fromCharCode(z)];Ae&&(z=Ae.charCodeAt(0))}const he=this._unicodeService.charProperties(z,X);se=w.UnicodeService.extractWidth(he);const me=w.UnicodeService.extractShouldJoin(he),fe=me?w.UnicodeService.extractWidth(X):0;if(X=he,G&&this._onA11yChar.fire((0,v.stringFromCodePoint)(z)),this._getCurrentLinkId()&&this._oscLinkService.addLineToLink(this._getCurrentLinkId(),this._activeBuffer.ybase+this._activeBuffer.y),this._activeBuffer.x+se-fe>Y){if(M){const Ae=H;let ue=this._activeBuffer.x-fe;for(this._activeBuffer.x=fe,this._activeBuffer.y++,this._activeBuffer.y===this._activeBuffer.scrollBottom+1?(this._activeBuffer.y--,this._bufferService.scroll(this._eraseAttrData(),!0)):(this._activeBuffer.y>=this._bufferService.rows&&(this._activeBuffer.y=this._bufferService.rows-1),this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y).isWrapped=!0),H=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y),fe>0&&H instanceof h.BufferLine&&H.copyCellsFrom(Ae,ue,0,fe,!1);ue<Y;)Ae.setCellFromCodepoint(ue++,0,1,K)}else if(this._activeBuffer.x=Y-1,se===2)continue}if(me&&this._activeBuffer.x){const Ae=H.getWidth(this._activeBuffer.x-1)?1:2;H.addCodepointToCell(this._activeBuffer.x-Ae,z,se);for(let ue=se-fe;--ue>=0;)H.setCellFromCodepoint(this._activeBuffer.x++,0,0,K)}else if(T&&(H.insertCells(this._activeBuffer.x,se-fe,this._activeBuffer.getNullCell(K)),H.getWidth(Y-1)===2&&H.setCellFromCodepoint(Y-1,_.NULL_CELL_CODE,_.NULL_CELL_WIDTH,K)),H.setCellFromCodepoint(this._activeBuffer.x++,z,se,K),se>0)for(;--se;)H.setCellFromCodepoint(this._activeBuffer.x++,0,0,K)}this._parser.precedingJoinState=X,this._activeBuffer.x<Y&&U-B>0&&H.getWidth(this._activeBuffer.x)===0&&!H.hasContent(this._activeBuffer.x)&&H.setCellFromCodepoint(this._activeBuffer.x,0,1,K),this._dirtyRowTracker.markDirty(this._activeBuffer.y)}registerCsiHandler(x,B){return x.final!=="t"||x.prefix||x.intermediates?this._parser.registerCsiHandler(x,B):this._parser.registerCsiHandler(x,(U=>!P(U.params[0],this._optionsService.rawOptions.windowOptions)||B(U)))}registerDcsHandler(x,B){return this._parser.registerDcsHandler(x,new b.DcsHandler(B))}registerEscHandler(x,B){return this._parser.registerEscHandler(x,B)}registerOscHandler(x,B){return this._parser.registerOscHandler(x,new E.OscHandler(B))}bell(){return this._onRequestBell.fire(),!0}lineFeed(){return this._dirtyRowTracker.markDirty(this._activeBuffer.y),this._optionsService.rawOptions.convertEol&&(this._activeBuffer.x=0),this._activeBuffer.y++,this._activeBuffer.y===this._activeBuffer.scrollBottom+1?(this._activeBuffer.y--,this._bufferService.scroll(this._eraseAttrData())):this._activeBuffer.y>=this._bufferService.rows?this._activeBuffer.y=this._bufferService.rows-1:this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y).isWrapped=!1,this._activeBuffer.x>=this._bufferService.cols&&this._activeBuffer.x--,this._dirtyRowTracker.markDirty(this._activeBuffer.y),this._onLineFeed.fire(),!0}carriageReturn(){return this._activeBuffer.x=0,!0}backspace(){if(!this._coreService.decPrivateModes.reverseWraparound)return this._restrictCursor(),this._activeBuffer.x>0&&this._activeBuffer.x--,!0;if(this._restrictCursor(this._bufferService.cols),this._activeBuffer.x>0)this._activeBuffer.x--;else if(this._activeBuffer.x===0&&this._activeBuffer.y>this._activeBuffer.scrollTop&&this._activeBuffer.y<=this._activeBuffer.scrollBottom&&this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y)?.isWrapped){this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y).isWrapped=!1,this._activeBuffer.y--,this._activeBuffer.x=this._bufferService.cols-1;const x=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);x.hasWidth(this._activeBuffer.x)&&!x.hasContent(this._activeBuffer.x)&&this._activeBuffer.x--}return this._restrictCursor(),!0}tab(){if(this._activeBuffer.x>=this._bufferService.cols)return!0;const x=this._activeBuffer.x;return this._activeBuffer.x=this._activeBuffer.nextStop(),this._optionsService.rawOptions.screenReaderMode&&this._onA11yTab.fire(this._activeBuffer.x-x),!0}shiftOut(){return this._charsetService.setgLevel(1),!0}shiftIn(){return this._charsetService.setgLevel(0),!0}_restrictCursor(x=this._bufferService.cols-1){this._activeBuffer.x=Math.min(x,Math.max(0,this._activeBuffer.x)),this._activeBuffer.y=this._coreService.decPrivateModes.origin?Math.min(this._activeBuffer.scrollBottom,Math.max(this._activeBuffer.scrollTop,this._activeBuffer.y)):Math.min(this._bufferService.rows-1,Math.max(0,this._activeBuffer.y)),this._dirtyRowTracker.markDirty(this._activeBuffer.y)}_setCursor(x,B){this._dirtyRowTracker.markDirty(this._activeBuffer.y),this._coreService.decPrivateModes.origin?(this._activeBuffer.x=x,this._activeBuffer.y=this._activeBuffer.scrollTop+B):(this._activeBuffer.x=x,this._activeBuffer.y=B),this._restrictCursor(),this._dirtyRowTracker.markDirty(this._activeBuffer.y)}_moveCursor(x,B){this._restrictCursor(),this._setCursor(this._activeBuffer.x+x,this._activeBuffer.y+B)}cursorUp(x){const B=this._activeBuffer.y-this._activeBuffer.scrollTop;return B>=0?this._moveCursor(0,-Math.min(B,x.params[0]||1)):this._moveCursor(0,-(x.params[0]||1)),!0}cursorDown(x){const B=this._activeBuffer.scrollBottom-this._activeBuffer.y;return B>=0?this._moveCursor(0,Math.min(B,x.params[0]||1)):this._moveCursor(0,x.params[0]||1),!0}cursorForward(x){return this._moveCursor(x.params[0]||1,0),!0}cursorBackward(x){return this._moveCursor(-(x.params[0]||1),0),!0}cursorNextLine(x){return this.cursorDown(x),this._activeBuffer.x=0,!0}cursorPrecedingLine(x){return this.cursorUp(x),this._activeBuffer.x=0,!0}cursorCharAbsolute(x){return this._setCursor((x.params[0]||1)-1,this._activeBuffer.y),!0}cursorPosition(x){return this._setCursor(x.length>=2?(x.params[1]||1)-1:0,(x.params[0]||1)-1),!0}charPosAbsolute(x){return this._setCursor((x.params[0]||1)-1,this._activeBuffer.y),!0}hPositionRelative(x){return this._moveCursor(x.params[0]||1,0),!0}linePosAbsolute(x){return this._setCursor(this._activeBuffer.x,(x.params[0]||1)-1),!0}vPositionRelative(x){return this._moveCursor(0,x.params[0]||1),!0}hVPosition(x){return this.cursorPosition(x),!0}tabClear(x){const B=x.params[0];return B===0?delete this._activeBuffer.tabs[this._activeBuffer.x]:B===3&&(this._activeBuffer.tabs={}),!0}cursorForwardTab(x){if(this._activeBuffer.x>=this._bufferService.cols)return!0;let B=x.params[0]||1;for(;B--;)this._activeBuffer.x=this._activeBuffer.nextStop();return!0}cursorBackwardTab(x){if(this._activeBuffer.x>=this._bufferService.cols)return!0;let B=x.params[0]||1;for(;B--;)this._activeBuffer.x=this._activeBuffer.prevStop();return!0}selectProtected(x){const B=x.params[0];return B===1&&(this._curAttrData.bg|=536870912),B!==2&&B!==0||(this._curAttrData.bg&=-536870913),!0}_eraseInBufferLine(x,B,U,z=!1,se=!1){const j=this._activeBuffer.lines.get(this._activeBuffer.ybase+x);j.replaceCells(B,U,this._activeBuffer.getNullCell(this._eraseAttrData()),se),z&&(j.isWrapped=!1)}_resetBufferLine(x,B=!1){const U=this._activeBuffer.lines.get(this._activeBuffer.ybase+x);U&&(U.fill(this._activeBuffer.getNullCell(this._eraseAttrData()),B),this._bufferService.buffer.clearMarkers(this._activeBuffer.ybase+x),U.isWrapped=!1)}eraseInDisplay(x,B=!1){let U;switch(this._restrictCursor(this._bufferService.cols),x.params[0]){case 0:for(U=this._activeBuffer.y,this._dirtyRowTracker.markDirty(U),this._eraseInBufferLine(U++,this._activeBuffer.x,this._bufferService.cols,this._activeBuffer.x===0,B);U<this._bufferService.rows;U++)this._resetBufferLine(U,B);this._dirtyRowTracker.markDirty(U);break;case 1:for(U=this._activeBuffer.y,this._dirtyRowTracker.markDirty(U),this._eraseInBufferLine(U,0,this._activeBuffer.x+1,!0,B),this._activeBuffer.x+1>=this._bufferService.cols&&(this._activeBuffer.lines.get(U+1).isWrapped=!1);U--;)this._resetBufferLine(U,B);this._dirtyRowTracker.markDirty(0);break;case 2:for(U=this._bufferService.rows,this._dirtyRowTracker.markDirty(U-1);U--;)this._resetBufferLine(U,B);this._dirtyRowTracker.markDirty(0);break;case 3:const z=this._activeBuffer.lines.length-this._bufferService.rows;z>0&&(this._activeBuffer.lines.trimStart(z),this._activeBuffer.ybase=Math.max(this._activeBuffer.ybase-z,0),this._activeBuffer.ydisp=Math.max(this._activeBuffer.ydisp-z,0),this._onScroll.fire(0))}return!0}eraseInLine(x,B=!1){switch(this._restrictCursor(this._bufferService.cols),x.params[0]){case 0:this._eraseInBufferLine(this._activeBuffer.y,this._activeBuffer.x,this._bufferService.cols,this._activeBuffer.x===0,B);break;case 1:this._eraseInBufferLine(this._activeBuffer.y,0,this._activeBuffer.x+1,!1,B);break;case 2:this._eraseInBufferLine(this._activeBuffer.y,0,this._bufferService.cols,!0,B)}return this._dirtyRowTracker.markDirty(this._activeBuffer.y),!0}insertLines(x){this._restrictCursor();let B=x.params[0]||1;if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;const U=this._activeBuffer.ybase+this._activeBuffer.y,z=this._bufferService.rows-1-this._activeBuffer.scrollBottom,se=this._bufferService.rows-1+this._activeBuffer.ybase-z+1;for(;B--;)this._activeBuffer.lines.splice(se-1,1),this._activeBuffer.lines.splice(U,0,this._activeBuffer.getBlankLine(this._eraseAttrData()));return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.y,this._activeBuffer.scrollBottom),this._activeBuffer.x=0,!0}deleteLines(x){this._restrictCursor();let B=x.params[0]||1;if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;const U=this._activeBuffer.ybase+this._activeBuffer.y;let z;for(z=this._bufferService.rows-1-this._activeBuffer.scrollBottom,z=this._bufferService.rows-1+this._activeBuffer.ybase-z;B--;)this._activeBuffer.lines.splice(U,1),this._activeBuffer.lines.splice(z,0,this._activeBuffer.getBlankLine(this._eraseAttrData()));return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.y,this._activeBuffer.scrollBottom),this._activeBuffer.x=0,!0}insertChars(x){this._restrictCursor();const B=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);return B&&(B.insertCells(this._activeBuffer.x,x.params[0]||1,this._activeBuffer.getNullCell(this._eraseAttrData())),this._dirtyRowTracker.markDirty(this._activeBuffer.y)),!0}deleteChars(x){this._restrictCursor();const B=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);return B&&(B.deleteCells(this._activeBuffer.x,x.params[0]||1,this._activeBuffer.getNullCell(this._eraseAttrData())),this._dirtyRowTracker.markDirty(this._activeBuffer.y)),!0}scrollUp(x){let B=x.params[0]||1;for(;B--;)this._activeBuffer.lines.splice(this._activeBuffer.ybase+this._activeBuffer.scrollTop,1),this._activeBuffer.lines.splice(this._activeBuffer.ybase+this._activeBuffer.scrollBottom,0,this._activeBuffer.getBlankLine(this._eraseAttrData()));return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}scrollDown(x){let B=x.params[0]||1;for(;B--;)this._activeBuffer.lines.splice(this._activeBuffer.ybase+this._activeBuffer.scrollBottom,1),this._activeBuffer.lines.splice(this._activeBuffer.ybase+this._activeBuffer.scrollTop,0,this._activeBuffer.getBlankLine(h.DEFAULT_ATTR_DATA));return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}scrollLeft(x){if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;const B=x.params[0]||1;for(let U=this._activeBuffer.scrollTop;U<=this._activeBuffer.scrollBottom;++U){const z=this._activeBuffer.lines.get(this._activeBuffer.ybase+U);z.deleteCells(0,B,this._activeBuffer.getNullCell(this._eraseAttrData())),z.isWrapped=!1}return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}scrollRight(x){if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;const B=x.params[0]||1;for(let U=this._activeBuffer.scrollTop;U<=this._activeBuffer.scrollBottom;++U){const z=this._activeBuffer.lines.get(this._activeBuffer.ybase+U);z.insertCells(0,B,this._activeBuffer.getNullCell(this._eraseAttrData())),z.isWrapped=!1}return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}insertColumns(x){if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;const B=x.params[0]||1;for(let U=this._activeBuffer.scrollTop;U<=this._activeBuffer.scrollBottom;++U){const z=this._activeBuffer.lines.get(this._activeBuffer.ybase+U);z.insertCells(this._activeBuffer.x,B,this._activeBuffer.getNullCell(this._eraseAttrData())),z.isWrapped=!1}return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}deleteColumns(x){if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;const B=x.params[0]||1;for(let U=this._activeBuffer.scrollTop;U<=this._activeBuffer.scrollBottom;++U){const z=this._activeBuffer.lines.get(this._activeBuffer.ybase+U);z.deleteCells(this._activeBuffer.x,B,this._activeBuffer.getNullCell(this._eraseAttrData())),z.isWrapped=!1}return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}eraseChars(x){this._restrictCursor();const B=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);return B&&(B.replaceCells(this._activeBuffer.x,this._activeBuffer.x+(x.params[0]||1),this._activeBuffer.getNullCell(this._eraseAttrData())),this._dirtyRowTracker.markDirty(this._activeBuffer.y)),!0}repeatPrecedingCharacter(x){const B=this._parser.precedingJoinState;if(!B)return!0;const U=x.params[0]||1,z=w.UnicodeService.extractWidth(B),se=this._activeBuffer.x-z,j=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y).getString(se),G=new Uint32Array(j.length*U);let Y=0;for(let T=0;T<j.length;){const K=j.codePointAt(T)||0;G[Y++]=K,T+=K>65535?2:1}let M=Y;for(let T=1;T<U;++T)G.copyWithin(M,0,Y),M+=Y;return this.print(G,0,M),!0}sendDeviceAttributesPrimary(x){return x.params[0]>0||(this._is("xterm")||this._is("rxvt-unicode")||this._is("screen")?this._coreService.triggerDataEvent(l.C0.ESC+"[?1;2c"):this._is("linux")&&this._coreService.triggerDataEvent(l.C0.ESC+"[?6c")),!0}sendDeviceAttributesSecondary(x){return x.params[0]>0||(this._is("xterm")?this._coreService.triggerDataEvent(l.C0.ESC+"[>0;276;0c"):this._is("rxvt-unicode")?this._coreService.triggerDataEvent(l.C0.ESC+"[>85;95;0c"):this._is("linux")?this._coreService.triggerDataEvent(x.params[0]+"c"):this._is("screen")&&this._coreService.triggerDataEvent(l.C0.ESC+"[>83;40003;0c")),!0}_is(x){return(this._optionsService.rawOptions.termName+"").indexOf(x)===0}setMode(x){for(let B=0;B<x.length;B++)switch(x.params[B]){case 4:this._coreService.modes.insertMode=!0;break;case 20:this._optionsService.options.convertEol=!0}return!0}setModePrivate(x){for(let B=0;B<x.length;B++)switch(x.params[B]){case 1:this._coreService.decPrivateModes.applicationCursorKeys=!0;break;case 2:this._charsetService.setgCharset(0,m.DEFAULT_CHARSET),this._charsetService.setgCharset(1,m.DEFAULT_CHARSET),this._charsetService.setgCharset(2,m.DEFAULT_CHARSET),this._charsetService.setgCharset(3,m.DEFAULT_CHARSET);break;case 3:this._optionsService.rawOptions.windowOptions.setWinLines&&(this._bufferService.resize(132,this._bufferService.rows),this._onRequestReset.fire());break;case 6:this._coreService.decPrivateModes.origin=!0,this._setCursor(0,0);break;case 7:this._coreService.decPrivateModes.wraparound=!0;break;case 12:this._optionsService.options.cursorBlink=!0;break;case 45:this._coreService.decPrivateModes.reverseWraparound=!0;break;case 66:this._logService.debug("Serial port requested application keypad."),this._coreService.decPrivateModes.applicationKeypad=!0,this._onRequestSyncScrollBar.fire();break;case 9:this._coreMouseService.activeProtocol="X10";break;case 1e3:this._coreMouseService.activeProtocol="VT200";break;case 1002:this._coreMouseService.activeProtocol="DRAG";break;case 1003:this._coreMouseService.activeProtocol="ANY";break;case 1004:this._coreService.decPrivateModes.sendFocus=!0,this._onRequestSendFocus.fire();break;case 1005:this._logService.debug("DECSET 1005 not supported (see #2507)");break;case 1006:this._coreMouseService.activeEncoding="SGR";break;case 1015:this._logService.debug("DECSET 1015 not supported (see #2507)");break;case 1016:this._coreMouseService.activeEncoding="SGR_PIXELS";break;case 25:this._coreService.isCursorHidden=!1;break;case 1048:this.saveCursor();break;case 1049:this.saveCursor();case 47:case 1047:this._bufferService.buffers.activateAltBuffer(this._eraseAttrData()),this._coreService.isCursorInitialized=!0,this._onRequestRefreshRows.fire(0,this._bufferService.rows-1),this._onRequestSyncScrollBar.fire();break;case 2004:this._coreService.decPrivateModes.bracketedPasteMode=!0}return!0}resetMode(x){for(let B=0;B<x.length;B++)switch(x.params[B]){case 4:this._coreService.modes.insertMode=!1;break;case 20:this._optionsService.options.convertEol=!1}return!0}resetModePrivate(x){for(let B=0;B<x.length;B++)switch(x.params[B]){case 1:this._coreService.decPrivateModes.applicationCursorKeys=!1;break;case 3:this._optionsService.rawOptions.windowOptions.setWinLines&&(this._bufferService.resize(80,this._bufferService.rows),this._onRequestReset.fire());break;case 6:this._coreService.decPrivateModes.origin=!1,this._setCursor(0,0);break;case 7:this._coreService.decPrivateModes.wraparound=!1;break;case 12:this._optionsService.options.cursorBlink=!1;break;case 45:this._coreService.decPrivateModes.reverseWraparound=!1;break;case 66:this._logService.debug("Switching back to normal keypad."),this._coreService.decPrivateModes.applicationKeypad=!1,this._onRequestSyncScrollBar.fire();break;case 9:case 1e3:case 1002:case 1003:this._coreMouseService.activeProtocol="NONE";break;case 1004:this._coreService.decPrivateModes.sendFocus=!1;break;case 1005:this._logService.debug("DECRST 1005 not supported (see #2507)");break;case 1006:case 1016:this._coreMouseService.activeEncoding="DEFAULT";break;case 1015:this._logService.debug("DECRST 1015 not supported (see #2507)");break;case 25:this._coreService.isCursorHidden=!0;break;case 1048:this.restoreCursor();break;case 1049:case 47:case 1047:this._bufferService.buffers.activateNormalBuffer(),x.params[B]===1049&&this.restoreCursor(),this._coreService.isCursorInitialized=!0,this._onRequestRefreshRows.fire(0,this._bufferService.rows-1),this._onRequestSyncScrollBar.fire();break;case 2004:this._coreService.decPrivateModes.bracketedPasteMode=!1}return!0}requestMode(x,B){const U=this._coreService.decPrivateModes,{activeProtocol:z,activeEncoding:se}=this._coreMouseService,j=this._coreService,{buffers:G,cols:Y}=this._bufferService,{active:M,alt:T}=G,K=this._optionsService.rawOptions,H=me=>me?1:2,X=x.params[0];return Q=X,he=B?X===2?4:X===4?H(j.modes.insertMode):X===12?3:X===20?H(K.convertEol):0:X===1?H(U.applicationCursorKeys):X===3?K.windowOptions.setWinLines?Y===80?2:Y===132?1:0:0:X===6?H(U.origin):X===7?H(U.wraparound):X===8?3:X===9?H(z==="X10"):X===12?H(K.cursorBlink):X===25?H(!j.isCursorHidden):X===45?H(U.reverseWraparound):X===66?H(U.applicationKeypad):X===67?4:X===1e3?H(z==="VT200"):X===1002?H(z==="DRAG"):X===1003?H(z==="ANY"):X===1004?H(U.sendFocus):X===1005?4:X===1006?H(se==="SGR"):X===1015?4:X===1016?H(se==="SGR_PIXELS"):X===1048?1:X===47||X===1047||X===1049?H(M===T):X===2004?H(U.bracketedPasteMode):0,j.triggerDataEvent(`${l.C0.ESC}[${B?"":"?"}${Q};${he}$y`),!0;var Q,he}_updateAttrColor(x,B,U,z,se){return B===2?(x|=50331648,x&=-16777216,x|=y.AttributeData.fromColorRGB([U,z,se])):B===5&&(x&=-50331904,x|=33554432|255&U),x}_extractColor(x,B,U){const z=[0,0,-1,0,0,0];let se=0,j=0;do{if(z[j+se]=x.params[B+j],x.hasSubParams(B+j)){const G=x.getSubParams(B+j);let Y=0;do z[1]===5&&(se=1),z[j+Y+1+se]=G[Y];while(++Y<G.length&&Y+j+1+se<z.length);break}if(z[1]===5&&j+se>=2||z[1]===2&&j+se>=5)break;z[1]&&(se=1)}while(++j+B<x.length&&j+se<z.length);for(let G=2;G<z.length;++G)z[G]===-1&&(z[G]=0);switch(z[0]){case 38:U.fg=this._updateAttrColor(U.fg,z[1],z[3],z[4],z[5]);break;case 48:U.bg=this._updateAttrColor(U.bg,z[1],z[3],z[4],z[5]);break;case 58:U.extended=U.extended.clone(),U.extended.underlineColor=this._updateAttrColor(U.extended.underlineColor,z[1],z[3],z[4],z[5])}return j}_processUnderline(x,B){B.extended=B.extended.clone(),(!~x||x>5)&&(x=1),B.extended.underlineStyle=x,B.fg|=268435456,x===0&&(B.fg&=-268435457),B.updateExtended()}_processSGR0(x){x.fg=h.DEFAULT_ATTR_DATA.fg,x.bg=h.DEFAULT_ATTR_DATA.bg,x.extended=x.extended.clone(),x.extended.underlineStyle=0,x.extended.underlineColor&=-67108864,x.updateExtended()}charAttributes(x){if(x.length===1&&x.params[0]===0)return this._processSGR0(this._curAttrData),!0;const B=x.length;let U;const z=this._curAttrData;for(let se=0;se<B;se++)U=x.params[se],U>=30&&U<=37?(z.fg&=-50331904,z.fg|=16777216|U-30):U>=40&&U<=47?(z.bg&=-50331904,z.bg|=16777216|U-40):U>=90&&U<=97?(z.fg&=-50331904,z.fg|=16777224|U-90):U>=100&&U<=107?(z.bg&=-50331904,z.bg|=16777224|U-100):U===0?this._processSGR0(z):U===1?z.fg|=134217728:U===3?z.bg|=67108864:U===4?(z.fg|=268435456,this._processUnderline(x.hasSubParams(se)?x.getSubParams(se)[0]:1,z)):U===5?z.fg|=536870912:U===7?z.fg|=67108864:U===8?z.fg|=1073741824:U===9?z.fg|=2147483648:U===2?z.bg|=134217728:U===21?this._processUnderline(2,z):U===22?(z.fg&=-134217729,z.bg&=-134217729):U===23?z.bg&=-67108865:U===24?(z.fg&=-268435457,this._processUnderline(0,z)):U===25?z.fg&=-536870913:U===27?z.fg&=-67108865:U===28?z.fg&=-1073741825:U===29?z.fg&=2147483647:U===39?(z.fg&=-67108864,z.fg|=16777215&h.DEFAULT_ATTR_DATA.fg):U===49?(z.bg&=-67108864,z.bg|=16777215&h.DEFAULT_ATTR_DATA.bg):U===38||U===48||U===58?se+=this._extractColor(x,se,z):U===53?z.bg|=1073741824:U===55?z.bg&=-1073741825:U===59?(z.extended=z.extended.clone(),z.extended.underlineColor=-1,z.updateExtended()):U===100?(z.fg&=-67108864,z.fg|=16777215&h.DEFAULT_ATTR_DATA.fg,z.bg&=-67108864,z.bg|=16777215&h.DEFAULT_ATTR_DATA.bg):this._logService.debug("Unknown SGR attribute: %d.",U);return!0}deviceStatus(x){switch(x.params[0]){case 5:this._coreService.triggerDataEvent(`${l.C0.ESC}[0n`);break;case 6:const B=this._activeBuffer.y+1,U=this._activeBuffer.x+1;this._coreService.triggerDataEvent(`${l.C0.ESC}[${B};${U}R`)}return!0}deviceStatusPrivate(x){if(x.params[0]===6){const B=this._activeBuffer.y+1,U=this._activeBuffer.x+1;this._coreService.triggerDataEvent(`${l.C0.ESC}[?${B};${U}R`)}return!0}softReset(x){return this._coreService.isCursorHidden=!1,this._onRequestSyncScrollBar.fire(),this._activeBuffer.scrollTop=0,this._activeBuffer.scrollBottom=this._bufferService.rows-1,this._curAttrData=h.DEFAULT_ATTR_DATA.clone(),this._coreService.reset(),this._charsetService.reset(),this._activeBuffer.savedX=0,this._activeBuffer.savedY=this._activeBuffer.ybase,this._activeBuffer.savedCurAttrData.fg=this._curAttrData.fg,this._activeBuffer.savedCurAttrData.bg=this._curAttrData.bg,this._activeBuffer.savedCharset=this._charsetService.charset,this._coreService.decPrivateModes.origin=!1,!0}setCursorStyle(x){const B=x.params[0]||1;switch(B){case 1:case 2:this._optionsService.options.cursorStyle="block";break;case 3:case 4:this._optionsService.options.cursorStyle="underline";break;case 5:case 6:this._optionsService.options.cursorStyle="bar"}const U=B%2==1;return this._optionsService.options.cursorBlink=U,!0}setScrollRegion(x){const B=x.params[0]||1;let U;return(x.length<2||(U=x.params[1])>this._bufferService.rows||U===0)&&(U=this._bufferService.rows),U>B&&(this._activeBuffer.scrollTop=B-1,this._activeBuffer.scrollBottom=U-1,this._setCursor(0,0)),!0}windowOptions(x){if(!P(x.params[0],this._optionsService.rawOptions.windowOptions))return!0;const B=x.length>1?x.params[1]:0;switch(x.params[0]){case 14:B!==2&&this._onRequestWindowsOptionsReport.fire(L.GET_WIN_SIZE_PIXELS);break;case 16:this._onRequestWindowsOptionsReport.fire(L.GET_CELL_SIZE_PIXELS);break;case 18:this._bufferService&&this._coreService.triggerDataEvent(`${l.C0.ESC}[8;${this._bufferService.rows};${this._bufferService.cols}t`);break;case 22:B!==0&&B!==2||(this._windowTitleStack.push(this._windowTitle),this._windowTitleStack.length>10&&this._windowTitleStack.shift()),B!==0&&B!==1||(this._iconNameStack.push(this._iconName),this._iconNameStack.length>10&&this._iconNameStack.shift());break;case 23:B!==0&&B!==2||this._windowTitleStack.length&&this.setTitle(this._windowTitleStack.pop()),B!==0&&B!==1||this._iconNameStack.length&&this.setIconName(this._iconNameStack.pop())}return!0}saveCursor(x){return this._activeBuffer.savedX=this._activeBuffer.x,this._activeBuffer.savedY=this._activeBuffer.ybase+this._activeBuffer.y,this._activeBuffer.savedCurAttrData.fg=this._curAttrData.fg,this._activeBuffer.savedCurAttrData.bg=this._curAttrData.bg,this._activeBuffer.savedCharset=this._charsetService.charset,!0}restoreCursor(x){return this._activeBuffer.x=this._activeBuffer.savedX||0,this._activeBuffer.y=Math.max(this._activeBuffer.savedY-this._activeBuffer.ybase,0),this._curAttrData.fg=this._activeBuffer.savedCurAttrData.fg,this._curAttrData.bg=this._activeBuffer.savedCurAttrData.bg,this._charsetService.charset=this._savedCharset,this._activeBuffer.savedCharset&&(this._charsetService.charset=this._activeBuffer.savedCharset),this._restrictCursor(),!0}setTitle(x){return this._windowTitle=x,this._onTitleChange.fire(x),!0}setIconName(x){return this._iconName=x,!0}setOrReportIndexedColor(x){const B=[],U=x.split(";");for(;U.length>1;){const z=U.shift(),se=U.shift();if(/^\d+$/.exec(z)){const j=parseInt(z);if(ie(j))if(se==="?")B.push({type:0,index:j});else{const G=(0,k.parseColor)(se);G&&B.push({type:1,index:j,color:G})}}}return B.length&&this._onColor.fire(B),!0}setHyperlink(x){const B=x.split(";");return!(B.length<2)&&(B[1]?this._createHyperlink(B[0],B[1]):!B[0]&&this._finishHyperlink())}_createHyperlink(x,B){this._getCurrentLinkId()&&this._finishHyperlink();const U=x.split(":");let z;const se=U.findIndex((j=>j.startsWith("id=")));return se!==-1&&(z=U[se].slice(3)||void 0),this._curAttrData.extended=this._curAttrData.extended.clone(),this._curAttrData.extended.urlId=this._oscLinkService.registerLink({id:z,uri:B}),this._curAttrData.updateExtended(),!0}_finishHyperlink(){return this._curAttrData.extended=this._curAttrData.extended.clone(),this._curAttrData.extended.urlId=0,this._curAttrData.updateExtended(),!0}_setOrReportSpecialColor(x,B){const U=x.split(";");for(let z=0;z<U.length&&!(B>=this._specialColors.length);++z,++B)if(U[z]==="?")this._onColor.fire([{type:0,index:this._specialColors[B]}]);else{const se=(0,k.parseColor)(U[z]);se&&this._onColor.fire([{type:1,index:this._specialColors[B],color:se}])}return!0}setOrReportFgColor(x){return this._setOrReportSpecialColor(x,0)}setOrReportBgColor(x){return this._setOrReportSpecialColor(x,1)}setOrReportCursorColor(x){return this._setOrReportSpecialColor(x,2)}restoreIndexedColor(x){if(!x)return this._onColor.fire([{type:2}]),!0;const B=[],U=x.split(";");for(let z=0;z<U.length;++z)if(/^\d+$/.exec(U[z])){const se=parseInt(U[z]);ie(se)&&B.push({type:2,index:se})}return B.length&&this._onColor.fire(B),!0}restoreFgColor(x){return this._onColor.fire([{type:2,index:256}]),!0}restoreBgColor(x){return this._onColor.fire([{type:2,index:257}]),!0}restoreCursorColor(x){return this._onColor.fire([{type:2,index:258}]),!0}nextLine(){return this._activeBuffer.x=0,this.index(),!0}keypadApplicationMode(){return this._logService.debug("Serial port requested application keypad."),this._coreService.decPrivateModes.applicationKeypad=!0,this._onRequestSyncScrollBar.fire(),!0}keypadNumericMode(){return this._logService.debug("Switching back to normal keypad."),this._coreService.decPrivateModes.applicationKeypad=!1,this._onRequestSyncScrollBar.fire(),!0}selectDefaultCharset(){return this._charsetService.setgLevel(0),this._charsetService.setgCharset(0,m.DEFAULT_CHARSET),!0}selectCharset(x){return x.length!==2?(this.selectDefaultCharset(),!0):(x[0]==="/"||this._charsetService.setgCharset(R[x[0]],m.CHARSETS[x[1]]||m.DEFAULT_CHARSET),!0)}index(){return this._restrictCursor(),this._activeBuffer.y++,this._activeBuffer.y===this._activeBuffer.scrollBottom+1?(this._activeBuffer.y--,this._bufferService.scroll(this._eraseAttrData())):this._activeBuffer.y>=this._bufferService.rows&&(this._activeBuffer.y=this._bufferService.rows-1),this._restrictCursor(),!0}tabSet(){return this._activeBuffer.tabs[this._activeBuffer.x]=!0,!0}reverseIndex(){if(this._restrictCursor(),this._activeBuffer.y===this._activeBuffer.scrollTop){const x=this._activeBuffer.scrollBottom-this._activeBuffer.scrollTop;this._activeBuffer.lines.shiftElements(this._activeBuffer.ybase+this._activeBuffer.y,x,1),this._activeBuffer.lines.set(this._activeBuffer.ybase+this._activeBuffer.y,this._activeBuffer.getBlankLine(this._eraseAttrData())),this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom)}else this._activeBuffer.y--,this._restrictCursor();return!0}fullReset(){return this._parser.reset(),this._onRequestReset.fire(),!0}reset(){this._curAttrData=h.DEFAULT_ATTR_DATA.clone(),this._eraseAttrDataInternal=h.DEFAULT_ATTR_DATA.clone()}_eraseAttrData(){return this._eraseAttrDataInternal.bg&=-67108864,this._eraseAttrDataInternal.bg|=67108863&this._curAttrData.bg,this._eraseAttrDataInternal}setgLevel(x){return this._charsetService.setgLevel(x),!0}screenAlignmentPattern(){const x=new d.CellData;x.content=4194373,x.fg=this._curAttrData.fg,x.bg=this._curAttrData.bg,this._setCursor(0,0);for(let B=0;B<this._bufferService.rows;++B){const U=this._activeBuffer.ybase+this._activeBuffer.y+B,z=this._activeBuffer.lines.get(U);z&&(z.fill(x),z.isWrapped=!1)}return this._dirtyRowTracker.markAllDirty(),this._setCursor(0,0),!0}requestStatusString(x,B){const U=this._bufferService.buffer,z=this._optionsService.rawOptions;return(se=>(this._coreService.triggerDataEvent(`${l.C0.ESC}${se}${l.C0.ESC}\\`),!0))(x==='"q'?`P1$r${this._curAttrData.isProtected()?1:0}"q`:x==='"p'?'P1$r61;1"p':x==="r"?`P1$r${U.scrollTop+1};${U.scrollBottom+1}r`:x==="m"?"P1$r0m":x===" q"?`P1$r${{block:2,underline:4,bar:6}[z.cursorStyle]-(z.cursorBlink?1:0)} q`:"P0$r")}markRangeDirty(x,B){this._dirtyRowTracker.markRangeDirty(x,B)}}r.InputHandler=J;let re=class{constructor(ee){this._bufferService=ee,this.clearRange()}clearRange(){this.start=this._bufferService.buffer.y,this.end=this._bufferService.buffer.y}markDirty(ee){ee<this.start?this.start=ee:ee>this.end&&(this.end=ee)}markRangeDirty(ee,x){ee>x&&(q=ee,ee=x,x=q),ee<this.start&&(this.start=ee),x>this.end&&(this.end=x)}markAllDirty(){this.markRangeDirty(0,this._bufferService.rows-1)}};function ie(ee){return 0<=ee&&ee<256}re=u([f(0,S.IBufferService)],re)},844:(c,r)=>{function o(u){for(const f of u)f.dispose();u.length=0}Object.defineProperty(r,"__esModule",{value:!0}),r.getDisposeArrayDisposable=r.disposeArray=r.toDisposable=r.MutableDisposable=r.Disposable=void 0,r.Disposable=class{constructor(){this._disposables=[],this._isDisposed=!1}dispose(){this._isDisposed=!0;for(const u of this._disposables)u.dispose();this._disposables.length=0}register(u){return this._disposables.push(u),u}unregister(u){const f=this._disposables.indexOf(u);f!==-1&&this._disposables.splice(f,1)}},r.MutableDisposable=class{constructor(){this._isDisposed=!1}get value(){return this._isDisposed?void 0:this._value}set value(u){this._isDisposed||u===this._value||(this._value?.dispose(),this._value=u)}clear(){this.value=void 0}dispose(){this._isDisposed=!0,this._value?.dispose(),this._value=void 0}},r.toDisposable=function(u){return{dispose:u}},r.disposeArray=o,r.getDisposeArrayDisposable=function(u){return{dispose:()=>o(u)}}},1505:(c,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.FourKeyMap=r.TwoKeyMap=void 0;class o{constructor(){this._data={}}set(f,l,m){this._data[f]||(this._data[f]={}),this._data[f][l]=m}get(f,l){return this._data[f]?this._data[f][l]:void 0}clear(){this._data={}}}r.TwoKeyMap=o,r.FourKeyMap=class{constructor(){this._data=new o}set(u,f,l,m,g){this._data.get(u,f)||this._data.set(u,f,new o),this._data.get(u,f).set(l,m,g)}get(u,f,l,m){return this._data.get(u,f)?.get(l,m)}clear(){this._data.clear()}}},6114:(c,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.isChromeOS=r.isLinux=r.isWindows=r.isIphone=r.isIpad=r.isMac=r.getSafariVersion=r.isSafari=r.isLegacyEdge=r.isFirefox=r.isNode=void 0,r.isNode=typeof process<"u"&&"title"in process;const o=r.isNode?"node":navigator.userAgent,u=r.isNode?"node":navigator.platform;r.isFirefox=o.includes("Firefox"),r.isLegacyEdge=o.includes("Edge"),r.isSafari=/^((?!chrome|android).)*safari/i.test(o),r.getSafariVersion=function(){if(!r.isSafari)return 0;const f=o.match(/Version\/(\d+)/);return f===null||f.length<2?0:parseInt(f[1])},r.isMac=["Macintosh","MacIntel","MacPPC","Mac68K"].includes(u),r.isIpad=u==="iPad",r.isIphone=u==="iPhone",r.isWindows=["Windows","Win16","Win32","WinCE"].includes(u),r.isLinux=u.indexOf("Linux")>=0,r.isChromeOS=/\bCrOS\b/.test(o)},6106:(c,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.SortedList=void 0;let o=0;r.SortedList=class{constructor(u){this._getKey=u,this._array=[]}clear(){this._array.length=0}insert(u){this._array.length!==0?(o=this._search(this._getKey(u)),this._array.splice(o,0,u)):this._array.push(u)}delete(u){if(this._array.length===0)return!1;const f=this._getKey(u);if(f===void 0||(o=this._search(f),o===-1)||this._getKey(this._array[o])!==f)return!1;do if(this._array[o]===u)return this._array.splice(o,1),!0;while(++o<this._array.length&&this._getKey(this._array[o])===f);return!1}*getKeyIterator(u){if(this._array.length!==0&&(o=this._search(u),!(o<0||o>=this._array.length)&&this._getKey(this._array[o])===u))do yield this._array[o];while(++o<this._array.length&&this._getKey(this._array[o])===u)}forEachByKey(u,f){if(this._array.length!==0&&(o=this._search(u),!(o<0||o>=this._array.length)&&this._getKey(this._array[o])===u))do f(this._array[o]);while(++o<this._array.length&&this._getKey(this._array[o])===u)}values(){return[...this._array].values()}_search(u){let f=0,l=this._array.length-1;for(;l>=f;){let m=f+l>>1;const g=this._getKey(this._array[m]);if(g>u)l=m-1;else{if(!(g<u)){for(;m>0&&this._getKey(this._array[m-1])===u;)m--;return m}f=m+1}}return f}}},7226:(c,r,o)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.DebouncedIdleTask=r.IdleTaskQueue=r.PriorityTaskQueue=void 0;const u=o(6114);class f{constructor(){this._tasks=[],this._i=0}enqueue(g){this._tasks.push(g),this._start()}flush(){for(;this._i<this._tasks.length;)this._tasks[this._i]()||this._i++;this.clear()}clear(){this._idleCallback&&(this._cancelCallback(this._idleCallback),this._idleCallback=void 0),this._i=0,this._tasks.length=0}_start(){this._idleCallback||(this._idleCallback=this._requestCallback(this._process.bind(this)))}_process(g){this._idleCallback=void 0;let C=0,v=0,h=g.timeRemaining(),p=0;for(;this._i<this._tasks.length;){if(C=Date.now(),this._tasks[this._i]()||this._i++,C=Math.max(1,Date.now()-C),v=Math.max(C,v),p=g.timeRemaining(),1.5*v>p)return h-C<-20&&console.warn(`task queue exceeded allotted deadline by ${Math.abs(Math.round(h-C))}ms`),void this._start();h=p}this.clear()}}class l extends f{_requestCallback(g){return setTimeout((()=>g(this._createDeadline(16))))}_cancelCallback(g){clearTimeout(g)}_createDeadline(g){const C=Date.now()+g;return{timeRemaining:()=>Math.max(0,C-Date.now())}}}r.PriorityTaskQueue=l,r.IdleTaskQueue=!u.isNode&&"requestIdleCallback"in window?class extends f{_requestCallback(m){return requestIdleCallback(m)}_cancelCallback(m){cancelIdleCallback(m)}}:l,r.DebouncedIdleTask=class{constructor(){this._queue=new r.IdleTaskQueue}set(m){this._queue.clear(),this._queue.enqueue(m)}flush(){this._queue.flush()}}},9282:(c,r,o)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.updateWindowsModeWrappedState=void 0;const u=o(643);r.updateWindowsModeWrappedState=function(f){const l=f.buffer.lines.get(f.buffer.ybase+f.buffer.y-1),m=l?.get(f.cols-1),g=f.buffer.lines.get(f.buffer.ybase+f.buffer.y);g&&m&&(g.isWrapped=m[u.CHAR_DATA_CODE_INDEX]!==u.NULL_CELL_CODE&&m[u.CHAR_DATA_CODE_INDEX]!==u.WHITESPACE_CELL_CODE)}},3734:(c,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.ExtendedAttrs=r.AttributeData=void 0;class o{constructor(){this.fg=0,this.bg=0,this.extended=new u}static toColorRGB(l){return[l>>>16&255,l>>>8&255,255&l]}static fromColorRGB(l){return(255&l[0])<<16|(255&l[1])<<8|255&l[2]}clone(){const l=new o;return l.fg=this.fg,l.bg=this.bg,l.extended=this.extended.clone(),l}isInverse(){return 67108864&this.fg}isBold(){return 134217728&this.fg}isUnderline(){return this.hasExtendedAttrs()&&this.extended.underlineStyle!==0?1:268435456&this.fg}isBlink(){return 536870912&this.fg}isInvisible(){return 1073741824&this.fg}isItalic(){return 67108864&this.bg}isDim(){return 134217728&this.bg}isStrikethrough(){return 2147483648&this.fg}isProtected(){return 536870912&this.bg}isOverline(){return 1073741824&this.bg}getFgColorMode(){return 50331648&this.fg}getBgColorMode(){return 50331648&this.bg}isFgRGB(){return(50331648&this.fg)==50331648}isBgRGB(){return(50331648&this.bg)==50331648}isFgPalette(){return(50331648&this.fg)==16777216||(50331648&this.fg)==33554432}isBgPalette(){return(50331648&this.bg)==16777216||(50331648&this.bg)==33554432}isFgDefault(){return(50331648&this.fg)==0}isBgDefault(){return(50331648&this.bg)==0}isAttributeDefault(){return this.fg===0&&this.bg===0}getFgColor(){switch(50331648&this.fg){case 16777216:case 33554432:return 255&this.fg;case 50331648:return 16777215&this.fg;default:return-1}}getBgColor(){switch(50331648&this.bg){case 16777216:case 33554432:return 255&this.bg;case 50331648:return 16777215&this.bg;default:return-1}}hasExtendedAttrs(){return 268435456&this.bg}updateExtended(){this.extended.isEmpty()?this.bg&=-268435457:this.bg|=268435456}getUnderlineColor(){if(268435456&this.bg&&~this.extended.underlineColor)switch(50331648&this.extended.underlineColor){case 16777216:case 33554432:return 255&this.extended.underlineColor;case 50331648:return 16777215&this.extended.underlineColor;default:return this.getFgColor()}return this.getFgColor()}getUnderlineColorMode(){return 268435456&this.bg&&~this.extended.underlineColor?50331648&this.extended.underlineColor:this.getFgColorMode()}isUnderlineColorRGB(){return 268435456&this.bg&&~this.extended.underlineColor?(50331648&this.extended.underlineColor)==50331648:this.isFgRGB()}isUnderlineColorPalette(){return 268435456&this.bg&&~this.extended.underlineColor?(50331648&this.extended.underlineColor)==16777216||(50331648&this.extended.underlineColor)==33554432:this.isFgPalette()}isUnderlineColorDefault(){return 268435456&this.bg&&~this.extended.underlineColor?(50331648&this.extended.underlineColor)==0:this.isFgDefault()}getUnderlineStyle(){return 268435456&this.fg?268435456&this.bg?this.extended.underlineStyle:1:0}getUnderlineVariantOffset(){return this.extended.underlineVariantOffset}}r.AttributeData=o;class u{get ext(){return this._urlId?-469762049&this._ext|this.underlineStyle<<26:this._ext}set ext(l){this._ext=l}get underlineStyle(){return this._urlId?5:(469762048&this._ext)>>26}set underlineStyle(l){this._ext&=-469762049,this._ext|=l<<26&469762048}get underlineColor(){return 67108863&this._ext}set underlineColor(l){this._ext&=-67108864,this._ext|=67108863&l}get urlId(){return this._urlId}set urlId(l){this._urlId=l}get underlineVariantOffset(){const l=(3758096384&this._ext)>>29;return l<0?4294967288^l:l}set underlineVariantOffset(l){this._ext&=536870911,this._ext|=l<<29&3758096384}constructor(l=0,m=0){this._ext=0,this._urlId=0,this._ext=l,this._urlId=m}clone(){return new u(this._ext,this._urlId)}isEmpty(){return this.underlineStyle===0&&this._urlId===0}}r.ExtendedAttrs=u},9092:(c,r,o)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.Buffer=r.MAX_BUFFER_SIZE=void 0;const u=o(6349),f=o(7226),l=o(3734),m=o(8437),g=o(4634),C=o(511),v=o(643),h=o(4863),p=o(7116);r.MAX_BUFFER_SIZE=4294967295,r.Buffer=class{constructor(_,d,y){this._hasScrollback=_,this._optionsService=d,this._bufferService=y,this.ydisp=0,this.ybase=0,this.y=0,this.x=0,this.tabs={},this.savedY=0,this.savedX=0,this.savedCurAttrData=m.DEFAULT_ATTR_DATA.clone(),this.savedCharset=p.DEFAULT_CHARSET,this.markers=[],this._nullCell=C.CellData.fromCharData([0,v.NULL_CELL_CHAR,v.NULL_CELL_WIDTH,v.NULL_CELL_CODE]),this._whitespaceCell=C.CellData.fromCharData([0,v.WHITESPACE_CELL_CHAR,v.WHITESPACE_CELL_WIDTH,v.WHITESPACE_CELL_CODE]),this._isClearing=!1,this._memoryCleanupQueue=new f.IdleTaskQueue,this._memoryCleanupPosition=0,this._cols=this._bufferService.cols,this._rows=this._bufferService.rows,this.lines=new u.CircularList(this._getCorrectBufferLength(this._rows)),this.scrollTop=0,this.scrollBottom=this._rows-1,this.setupTabStops()}getNullCell(_){return _?(this._nullCell.fg=_.fg,this._nullCell.bg=_.bg,this._nullCell.extended=_.extended):(this._nullCell.fg=0,this._nullCell.bg=0,this._nullCell.extended=new l.ExtendedAttrs),this._nullCell}getWhitespaceCell(_){return _?(this._whitespaceCell.fg=_.fg,this._whitespaceCell.bg=_.bg,this._whitespaceCell.extended=_.extended):(this._whitespaceCell.fg=0,this._whitespaceCell.bg=0,this._whitespaceCell.extended=new l.ExtendedAttrs),this._whitespaceCell}getBlankLine(_,d){return new m.BufferLine(this._bufferService.cols,this.getNullCell(_),d)}get hasScrollback(){return this._hasScrollback&&this.lines.maxLength>this._rows}get isCursorInViewport(){const _=this.ybase+this.y-this.ydisp;return _>=0&&_<this._rows}_getCorrectBufferLength(_){if(!this._hasScrollback)return _;const d=_+this._optionsService.rawOptions.scrollback;return d>r.MAX_BUFFER_SIZE?r.MAX_BUFFER_SIZE:d}fillViewportRows(_){if(this.lines.length===0){_===void 0&&(_=m.DEFAULT_ATTR_DATA);let d=this._rows;for(;d--;)this.lines.push(this.getBlankLine(_))}}clear(){this.ydisp=0,this.ybase=0,this.y=0,this.x=0,this.lines=new u.CircularList(this._getCorrectBufferLength(this._rows)),this.scrollTop=0,this.scrollBottom=this._rows-1,this.setupTabStops()}resize(_,d){const y=this.getNullCell(m.DEFAULT_ATTR_DATA);let S=0;const w=this._getCorrectBufferLength(d);if(w>this.lines.maxLength&&(this.lines.maxLength=w),this.lines.length>0){if(this._cols<_)for(let b=0;b<this.lines.length;b++)S+=+this.lines.get(b).resize(_,y);let E=0;if(this._rows<d)for(let b=this._rows;b<d;b++)this.lines.length<d+this.ybase&&(this._optionsService.rawOptions.windowsMode||this._optionsService.rawOptions.windowsPty.backend!==void 0||this._optionsService.rawOptions.windowsPty.buildNumber!==void 0?this.lines.push(new m.BufferLine(_,y)):this.ybase>0&&this.lines.length<=this.ybase+this.y+E+1?(this.ybase--,E++,this.ydisp>0&&this.ydisp--):this.lines.push(new m.BufferLine(_,y)));else for(let b=this._rows;b>d;b--)this.lines.length>d+this.ybase&&(this.lines.length>this.ybase+this.y+1?this.lines.pop():(this.ybase++,this.ydisp++));if(w<this.lines.maxLength){const b=this.lines.length-w;b>0&&(this.lines.trimStart(b),this.ybase=Math.max(this.ybase-b,0),this.ydisp=Math.max(this.ydisp-b,0),this.savedY=Math.max(this.savedY-b,0)),this.lines.maxLength=w}this.x=Math.min(this.x,_-1),this.y=Math.min(this.y,d-1),E&&(this.y+=E),this.savedX=Math.min(this.savedX,_-1),this.scrollTop=0}if(this.scrollBottom=d-1,this._isReflowEnabled&&(this._reflow(_,d),this._cols>_))for(let E=0;E<this.lines.length;E++)S+=+this.lines.get(E).resize(_,y);this._cols=_,this._rows=d,this._memoryCleanupQueue.clear(),S>.1*this.lines.length&&(this._memoryCleanupPosition=0,this._memoryCleanupQueue.enqueue((()=>this._batchedMemoryCleanup())))}_batchedMemoryCleanup(){let _=!0;this._memoryCleanupPosition>=this.lines.length&&(this._memoryCleanupPosition=0,_=!1);let d=0;for(;this._memoryCleanupPosition<this.lines.length;)if(d+=this.lines.get(this._memoryCleanupPosition++).cleanupMemory(),d>100)return!0;return _}get _isReflowEnabled(){const _=this._optionsService.rawOptions.windowsPty;return _&&_.buildNumber?this._hasScrollback&&_.backend==="conpty"&&_.buildNumber>=21376:this._hasScrollback&&!this._optionsService.rawOptions.windowsMode}_reflow(_,d){this._cols!==_&&(_>this._cols?this._reflowLarger(_,d):this._reflowSmaller(_,d))}_reflowLarger(_,d){const y=(0,g.reflowLargerGetLinesToRemove)(this.lines,this._cols,_,this.ybase+this.y,this.getNullCell(m.DEFAULT_ATTR_DATA));if(y.length>0){const S=(0,g.reflowLargerCreateNewLayout)(this.lines,y);(0,g.reflowLargerApplyNewLayout)(this.lines,S.layout),this._reflowLargerAdjustViewport(_,d,S.countRemoved)}}_reflowLargerAdjustViewport(_,d,y){const S=this.getNullCell(m.DEFAULT_ATTR_DATA);let w=y;for(;w-- >0;)this.ybase===0?(this.y>0&&this.y--,this.lines.length<d&&this.lines.push(new m.BufferLine(_,S))):(this.ydisp===this.ybase&&this.ydisp--,this.ybase--);this.savedY=Math.max(this.savedY-y,0)}_reflowSmaller(_,d){const y=this.getNullCell(m.DEFAULT_ATTR_DATA),S=[];let w=0;for(let E=this.lines.length-1;E>=0;E--){let b=this.lines.get(E);if(!b||!b.isWrapped&&b.getTrimmedLength()<=_)continue;const k=[b];for(;b.isWrapped&&E>0;)b=this.lines.get(--E),k.unshift(b);const R=this.ybase+this.y;if(R>=E&&R<E+k.length)continue;const O=k[k.length-1].getTrimmedLength(),P=(0,g.reflowSmallerGetNewLineLengths)(k,this._cols,_),L=P.length-k.length;let q;q=this.ybase===0&&this.y!==this.lines.length-1?Math.max(0,this.y-this.lines.maxLength+L):Math.max(0,this.lines.length-this.lines.maxLength+L);const J=[];for(let U=0;U<L;U++){const z=this.getBlankLine(m.DEFAULT_ATTR_DATA,!0);J.push(z)}J.length>0&&(S.push({start:E+k.length+w,newLines:J}),w+=J.length),k.push(...J);let re=P.length-1,ie=P[re];ie===0&&(re--,ie=P[re]);let ee=k.length-L-1,x=O;for(;ee>=0;){const U=Math.min(x,ie);if(k[re]===void 0)break;if(k[re].copyCellsFrom(k[ee],x-U,ie-U,U,!0),ie-=U,ie===0&&(re--,ie=P[re]),x-=U,x===0){ee--;const z=Math.max(ee,0);x=(0,g.getWrappedLineTrimmedLength)(k,z,this._cols)}}for(let U=0;U<k.length;U++)P[U]<_&&k[U].setCell(P[U],y);let B=L-q;for(;B-- >0;)this.ybase===0?this.y<d-1?(this.y++,this.lines.pop()):(this.ybase++,this.ydisp++):this.ybase<Math.min(this.lines.maxLength,this.lines.length+w)-d&&(this.ybase===this.ydisp&&this.ydisp++,this.ybase++);this.savedY=Math.min(this.savedY+L,this.ybase+d-1)}if(S.length>0){const E=[],b=[];for(let re=0;re<this.lines.length;re++)b.push(this.lines.get(re));const k=this.lines.length;let R=k-1,O=0,P=S[O];this.lines.length=Math.min(this.lines.maxLength,this.lines.length+w);let L=0;for(let re=Math.min(this.lines.maxLength-1,k+w-1);re>=0;re--)if(P&&P.start>R+L){for(let ie=P.newLines.length-1;ie>=0;ie--)this.lines.set(re--,P.newLines[ie]);re++,E.push({index:R+1,amount:P.newLines.length}),L+=P.newLines.length,P=S[++O]}else this.lines.set(re,b[R--]);let q=0;for(let re=E.length-1;re>=0;re--)E[re].index+=q,this.lines.onInsertEmitter.fire(E[re]),q+=E[re].amount;const J=Math.max(0,k+w-this.lines.maxLength);J>0&&this.lines.onTrimEmitter.fire(J)}}translateBufferLineToString(_,d,y=0,S){const w=this.lines.get(_);return w?w.translateToString(d,y,S):""}getWrappedRangeForLine(_){let d=_,y=_;for(;d>0&&this.lines.get(d).isWrapped;)d--;for(;y+1<this.lines.length&&this.lines.get(y+1).isWrapped;)y++;return{first:d,last:y}}setupTabStops(_){for(_!=null?this.tabs[_]||(_=this.prevStop(_)):(this.tabs={},_=0);_<this._cols;_+=this._optionsService.rawOptions.tabStopWidth)this.tabs[_]=!0}prevStop(_){for(_==null&&(_=this.x);!this.tabs[--_]&&_>0;);return _>=this._cols?this._cols-1:_<0?0:_}nextStop(_){for(_==null&&(_=this.x);!this.tabs[++_]&&_<this._cols;);return _>=this._cols?this._cols-1:_<0?0:_}clearMarkers(_){this._isClearing=!0;for(let d=0;d<this.markers.length;d++)this.markers[d].line===_&&(this.markers[d].dispose(),this.markers.splice(d--,1));this._isClearing=!1}clearAllMarkers(){this._isClearing=!0;for(let _=0;_<this.markers.length;_++)this.markers[_].dispose(),this.markers.splice(_--,1);this._isClearing=!1}addMarker(_){const d=new h.Marker(_);return this.markers.push(d),d.register(this.lines.onTrim((y=>{d.line-=y,d.line<0&&d.dispose()}))),d.register(this.lines.onInsert((y=>{d.line>=y.index&&(d.line+=y.amount)}))),d.register(this.lines.onDelete((y=>{d.line>=y.index&&d.line<y.index+y.amount&&d.dispose(),d.line>y.index&&(d.line-=y.amount)}))),d.register(d.onDispose((()=>this._removeMarker(d)))),d}_removeMarker(_){this._isClearing||this.markers.splice(this.markers.indexOf(_),1)}}},8437:(c,r,o)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.BufferLine=r.DEFAULT_ATTR_DATA=void 0;const u=o(3734),f=o(511),l=o(643),m=o(482);r.DEFAULT_ATTR_DATA=Object.freeze(new u.AttributeData);let g=0;class C{constructor(h,p,_=!1){this.isWrapped=_,this._combined={},this._extendedAttrs={},this._data=new Uint32Array(3*h);const d=p||f.CellData.fromCharData([0,l.NULL_CELL_CHAR,l.NULL_CELL_WIDTH,l.NULL_CELL_CODE]);for(let y=0;y<h;++y)this.setCell(y,d);this.length=h}get(h){const p=this._data[3*h+0],_=2097151&p;return[this._data[3*h+1],2097152&p?this._combined[h]:_?(0,m.stringFromCodePoint)(_):"",p>>22,2097152&p?this._combined[h].charCodeAt(this._combined[h].length-1):_]}set(h,p){this._data[3*h+1]=p[l.CHAR_DATA_ATTR_INDEX],p[l.CHAR_DATA_CHAR_INDEX].length>1?(this._combined[h]=p[1],this._data[3*h+0]=2097152|h|p[l.CHAR_DATA_WIDTH_INDEX]<<22):this._data[3*h+0]=p[l.CHAR_DATA_CHAR_INDEX].charCodeAt(0)|p[l.CHAR_DATA_WIDTH_INDEX]<<22}getWidth(h){return this._data[3*h+0]>>22}hasWidth(h){return 12582912&this._data[3*h+0]}getFg(h){return this._data[3*h+1]}getBg(h){return this._data[3*h+2]}hasContent(h){return 4194303&this._data[3*h+0]}getCodePoint(h){const p=this._data[3*h+0];return 2097152&p?this._combined[h].charCodeAt(this._combined[h].length-1):2097151&p}isCombined(h){return 2097152&this._data[3*h+0]}getString(h){const p=this._data[3*h+0];return 2097152&p?this._combined[h]:2097151&p?(0,m.stringFromCodePoint)(2097151&p):""}isProtected(h){return 536870912&this._data[3*h+2]}loadCell(h,p){return g=3*h,p.content=this._data[g+0],p.fg=this._data[g+1],p.bg=this._data[g+2],2097152&p.content&&(p.combinedData=this._combined[h]),268435456&p.bg&&(p.extended=this._extendedAttrs[h]),p}setCell(h,p){2097152&p.content&&(this._combined[h]=p.combinedData),268435456&p.bg&&(this._extendedAttrs[h]=p.extended),this._data[3*h+0]=p.content,this._data[3*h+1]=p.fg,this._data[3*h+2]=p.bg}setCellFromCodepoint(h,p,_,d){268435456&d.bg&&(this._extendedAttrs[h]=d.extended),this._data[3*h+0]=p|_<<22,this._data[3*h+1]=d.fg,this._data[3*h+2]=d.bg}addCodepointToCell(h,p,_){let d=this._data[3*h+0];2097152&d?this._combined[h]+=(0,m.stringFromCodePoint)(p):2097151&d?(this._combined[h]=(0,m.stringFromCodePoint)(2097151&d)+(0,m.stringFromCodePoint)(p),d&=-2097152,d|=2097152):d=p|4194304,_&&(d&=-12582913,d|=_<<22),this._data[3*h+0]=d}insertCells(h,p,_){if((h%=this.length)&&this.getWidth(h-1)===2&&this.setCellFromCodepoint(h-1,0,1,_),p<this.length-h){const d=new f.CellData;for(let y=this.length-h-p-1;y>=0;--y)this.setCell(h+p+y,this.loadCell(h+y,d));for(let y=0;y<p;++y)this.setCell(h+y,_)}else for(let d=h;d<this.length;++d)this.setCell(d,_);this.getWidth(this.length-1)===2&&this.setCellFromCodepoint(this.length-1,0,1,_)}deleteCells(h,p,_){if(h%=this.length,p<this.length-h){const d=new f.CellData;for(let y=0;y<this.length-h-p;++y)this.setCell(h+y,this.loadCell(h+p+y,d));for(let y=this.length-p;y<this.length;++y)this.setCell(y,_)}else for(let d=h;d<this.length;++d)this.setCell(d,_);h&&this.getWidth(h-1)===2&&this.setCellFromCodepoint(h-1,0,1,_),this.getWidth(h)!==0||this.hasContent(h)||this.setCellFromCodepoint(h,0,1,_)}replaceCells(h,p,_,d=!1){if(d)for(h&&this.getWidth(h-1)===2&&!this.isProtected(h-1)&&this.setCellFromCodepoint(h-1,0,1,_),p<this.length&&this.getWidth(p-1)===2&&!this.isProtected(p)&&this.setCellFromCodepoint(p,0,1,_);h<p&&h<this.length;)this.isProtected(h)||this.setCell(h,_),h++;else for(h&&this.getWidth(h-1)===2&&this.setCellFromCodepoint(h-1,0,1,_),p<this.length&&this.getWidth(p-1)===2&&this.setCellFromCodepoint(p,0,1,_);h<p&&h<this.length;)this.setCell(h++,_)}resize(h,p){if(h===this.length)return 4*this._data.length*2<this._data.buffer.byteLength;const _=3*h;if(h>this.length){if(this._data.buffer.byteLength>=4*_)this._data=new Uint32Array(this._data.buffer,0,_);else{const d=new Uint32Array(_);d.set(this._data),this._data=d}for(let d=this.length;d<h;++d)this.setCell(d,p)}else{this._data=this._data.subarray(0,_);const d=Object.keys(this._combined);for(let S=0;S<d.length;S++){const w=parseInt(d[S],10);w>=h&&delete this._combined[w]}const y=Object.keys(this._extendedAttrs);for(let S=0;S<y.length;S++){const w=parseInt(y[S],10);w>=h&&delete this._extendedAttrs[w]}}return this.length=h,4*_*2<this._data.buffer.byteLength}cleanupMemory(){if(4*this._data.length*2<this._data.buffer.byteLength){const h=new Uint32Array(this._data.length);return h.set(this._data),this._data=h,1}return 0}fill(h,p=!1){if(p)for(let _=0;_<this.length;++_)this.isProtected(_)||this.setCell(_,h);else{this._combined={},this._extendedAttrs={};for(let _=0;_<this.length;++_)this.setCell(_,h)}}copyFrom(h){this.length!==h.length?this._data=new Uint32Array(h._data):this._data.set(h._data),this.length=h.length,this._combined={};for(const p in h._combined)this._combined[p]=h._combined[p];this._extendedAttrs={};for(const p in h._extendedAttrs)this._extendedAttrs[p]=h._extendedAttrs[p];this.isWrapped=h.isWrapped}clone(){const h=new C(0);h._data=new Uint32Array(this._data),h.length=this.length;for(const p in this._combined)h._combined[p]=this._combined[p];for(const p in this._extendedAttrs)h._extendedAttrs[p]=this._extendedAttrs[p];return h.isWrapped=this.isWrapped,h}getTrimmedLength(){for(let h=this.length-1;h>=0;--h)if(4194303&this._data[3*h+0])return h+(this._data[3*h+0]>>22);return 0}getNoBgTrimmedLength(){for(let h=this.length-1;h>=0;--h)if(4194303&this._data[3*h+0]||50331648&this._data[3*h+2])return h+(this._data[3*h+0]>>22);return 0}copyCellsFrom(h,p,_,d,y){const S=h._data;if(y)for(let E=d-1;E>=0;E--){for(let b=0;b<3;b++)this._data[3*(_+E)+b]=S[3*(p+E)+b];268435456&S[3*(p+E)+2]&&(this._extendedAttrs[_+E]=h._extendedAttrs[p+E])}else for(let E=0;E<d;E++){for(let b=0;b<3;b++)this._data[3*(_+E)+b]=S[3*(p+E)+b];268435456&S[3*(p+E)+2]&&(this._extendedAttrs[_+E]=h._extendedAttrs[p+E])}const w=Object.keys(h._combined);for(let E=0;E<w.length;E++){const b=parseInt(w[E],10);b>=p&&(this._combined[b-p+_]=h._combined[b])}}translateToString(h,p,_,d){p=p??0,_=_??this.length,h&&(_=Math.min(_,this.getTrimmedLength())),d&&(d.length=0);let y="";for(;p<_;){const S=this._data[3*p+0],w=2097151&S,E=2097152&S?this._combined[p]:w?(0,m.stringFromCodePoint)(w):l.WHITESPACE_CELL_CHAR;if(y+=E,d)for(let b=0;b<E.length;++b)d.push(p);p+=S>>22||1}return d&&d.push(p),y}}r.BufferLine=C},4841:(c,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.getRangeLength=void 0,r.getRangeLength=function(o,u){if(o.start.y>o.end.y)throw new Error(`Buffer range end (${o.end.x}, ${o.end.y}) cannot be before start (${o.start.x}, ${o.start.y})`);return u*(o.end.y-o.start.y)+(o.end.x-o.start.x+1)}},4634:(c,r)=>{function o(u,f,l){if(f===u.length-1)return u[f].getTrimmedLength();const m=!u[f].hasContent(l-1)&&u[f].getWidth(l-1)===1,g=u[f+1].getWidth(0)===2;return m&&g?l-1:l}Object.defineProperty(r,"__esModule",{value:!0}),r.getWrappedLineTrimmedLength=r.reflowSmallerGetNewLineLengths=r.reflowLargerApplyNewLayout=r.reflowLargerCreateNewLayout=r.reflowLargerGetLinesToRemove=void 0,r.reflowLargerGetLinesToRemove=function(u,f,l,m,g){const C=[];for(let v=0;v<u.length-1;v++){let h=v,p=u.get(++h);if(!p.isWrapped)continue;const _=[u.get(v)];for(;h<u.length&&p.isWrapped;)_.push(p),p=u.get(++h);if(m>=v&&m<h){v+=_.length-1;continue}let d=0,y=o(_,d,f),S=1,w=0;for(;S<_.length;){const b=o(_,S,f),k=b-w,R=l-y,O=Math.min(k,R);_[d].copyCellsFrom(_[S],w,y,O,!1),y+=O,y===l&&(d++,y=0),w+=O,w===b&&(S++,w=0),y===0&&d!==0&&_[d-1].getWidth(l-1)===2&&(_[d].copyCellsFrom(_[d-1],l-1,y++,1,!1),_[d-1].setCell(l-1,g))}_[d].replaceCells(y,l,g);let E=0;for(let b=_.length-1;b>0&&(b>d||_[b].getTrimmedLength()===0);b--)E++;E>0&&(C.push(v+_.length-E),C.push(E)),v+=_.length-1}return C},r.reflowLargerCreateNewLayout=function(u,f){const l=[];let m=0,g=f[m],C=0;for(let v=0;v<u.length;v++)if(g===v){const h=f[++m];u.onDeleteEmitter.fire({index:v-C,amount:h}),v+=h-1,C+=h,g=f[++m]}else l.push(v);return{layout:l,countRemoved:C}},r.reflowLargerApplyNewLayout=function(u,f){const l=[];for(let m=0;m<f.length;m++)l.push(u.get(f[m]));for(let m=0;m<l.length;m++)u.set(m,l[m]);u.length=f.length},r.reflowSmallerGetNewLineLengths=function(u,f,l){const m=[],g=u.map(((p,_)=>o(u,_,f))).reduce(((p,_)=>p+_));let C=0,v=0,h=0;for(;h<g;){if(g-h<l){m.push(g-h);break}C+=l;const p=o(u,v,f);C>p&&(C-=p,v++);const _=u[v].getWidth(C-1)===2;_&&C--;const d=_?l-1:l;m.push(d),h+=d}return m},r.getWrappedLineTrimmedLength=o},5295:(c,r,o)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.BufferSet=void 0;const u=o(8460),f=o(844),l=o(9092);class m extends f.Disposable{constructor(C,v){super(),this._optionsService=C,this._bufferService=v,this._onBufferActivate=this.register(new u.EventEmitter),this.onBufferActivate=this._onBufferActivate.event,this.reset(),this.register(this._optionsService.onSpecificOptionChange("scrollback",(()=>this.resize(this._bufferService.cols,this._bufferService.rows)))),this.register(this._optionsService.onSpecificOptionChange("tabStopWidth",(()=>this.setupTabStops())))}reset(){this._normal=new l.Buffer(!0,this._optionsService,this._bufferService),this._normal.fillViewportRows(),this._alt=new l.Buffer(!1,this._optionsService,this._bufferService),this._activeBuffer=this._normal,this._onBufferActivate.fire({activeBuffer:this._normal,inactiveBuffer:this._alt}),this.setupTabStops()}get alt(){return this._alt}get active(){return this._activeBuffer}get normal(){return this._normal}activateNormalBuffer(){this._activeBuffer!==this._normal&&(this._normal.x=this._alt.x,this._normal.y=this._alt.y,this._alt.clearAllMarkers(),this._alt.clear(),this._activeBuffer=this._normal,this._onBufferActivate.fire({activeBuffer:this._normal,inactiveBuffer:this._alt}))}activateAltBuffer(C){this._activeBuffer!==this._alt&&(this._alt.fillViewportRows(C),this._alt.x=this._normal.x,this._alt.y=this._normal.y,this._activeBuffer=this._alt,this._onBufferActivate.fire({activeBuffer:this._alt,inactiveBuffer:this._normal}))}resize(C,v){this._normal.resize(C,v),this._alt.resize(C,v),this.setupTabStops(C)}setupTabStops(C){this._normal.setupTabStops(C),this._alt.setupTabStops(C)}}r.BufferSet=m},511:(c,r,o)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.CellData=void 0;const u=o(482),f=o(643),l=o(3734);class m extends l.AttributeData{constructor(){super(...arguments),this.content=0,this.fg=0,this.bg=0,this.extended=new l.ExtendedAttrs,this.combinedData=""}static fromCharData(C){const v=new m;return v.setFromCharData(C),v}isCombined(){return 2097152&this.content}getWidth(){return this.content>>22}getChars(){return 2097152&this.content?this.combinedData:2097151&this.content?(0,u.stringFromCodePoint)(2097151&this.content):""}getCode(){return this.isCombined()?this.combinedData.charCodeAt(this.combinedData.length-1):2097151&this.content}setFromCharData(C){this.fg=C[f.CHAR_DATA_ATTR_INDEX],this.bg=0;let v=!1;if(C[f.CHAR_DATA_CHAR_INDEX].length>2)v=!0;else if(C[f.CHAR_DATA_CHAR_INDEX].length===2){const h=C[f.CHAR_DATA_CHAR_INDEX].charCodeAt(0);if(55296<=h&&h<=56319){const p=C[f.CHAR_DATA_CHAR_INDEX].charCodeAt(1);56320<=p&&p<=57343?this.content=1024*(h-55296)+p-56320+65536|C[f.CHAR_DATA_WIDTH_INDEX]<<22:v=!0}else v=!0}else this.content=C[f.CHAR_DATA_CHAR_INDEX].charCodeAt(0)|C[f.CHAR_DATA_WIDTH_INDEX]<<22;v&&(this.combinedData=C[f.CHAR_DATA_CHAR_INDEX],this.content=2097152|C[f.CHAR_DATA_WIDTH_INDEX]<<22)}getAsCharData(){return[this.fg,this.getChars(),this.getWidth(),this.getCode()]}}r.CellData=m},643:(c,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.WHITESPACE_CELL_CODE=r.WHITESPACE_CELL_WIDTH=r.WHITESPACE_CELL_CHAR=r.NULL_CELL_CODE=r.NULL_CELL_WIDTH=r.NULL_CELL_CHAR=r.CHAR_DATA_CODE_INDEX=r.CHAR_DATA_WIDTH_INDEX=r.CHAR_DATA_CHAR_INDEX=r.CHAR_DATA_ATTR_INDEX=r.DEFAULT_EXT=r.DEFAULT_ATTR=r.DEFAULT_COLOR=void 0,r.DEFAULT_COLOR=0,r.DEFAULT_ATTR=256|r.DEFAULT_COLOR<<9,r.DEFAULT_EXT=0,r.CHAR_DATA_ATTR_INDEX=0,r.CHAR_DATA_CHAR_INDEX=1,r.CHAR_DATA_WIDTH_INDEX=2,r.CHAR_DATA_CODE_INDEX=3,r.NULL_CELL_CHAR="",r.NULL_CELL_WIDTH=1,r.NULL_CELL_CODE=0,r.WHITESPACE_CELL_CHAR=" ",r.WHITESPACE_CELL_WIDTH=1,r.WHITESPACE_CELL_CODE=32},4863:(c,r,o)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.Marker=void 0;const u=o(8460),f=o(844);class l{get id(){return this._id}constructor(g){this.line=g,this.isDisposed=!1,this._disposables=[],this._id=l._nextId++,this._onDispose=this.register(new u.EventEmitter),this.onDispose=this._onDispose.event}dispose(){this.isDisposed||(this.isDisposed=!0,this.line=-1,this._onDispose.fire(),(0,f.disposeArray)(this._disposables),this._disposables.length=0)}register(g){return this._disposables.push(g),g}}r.Marker=l,l._nextId=1},7116:(c,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.DEFAULT_CHARSET=r.CHARSETS=void 0,r.CHARSETS={},r.DEFAULT_CHARSET=r.CHARSETS.B,r.CHARSETS[0]={"`":"",a:"",b:"",c:"",d:"",e:"",f:"",g:"",h:"",i:"",j:"",k:"",l:"",m:"",n:"",o:"",p:"",q:"",r:"",s:"",t:"",u:"",v:"",w:"",x:"",y:"",z:"","{":"","|":"","}":"","~":""},r.CHARSETS.A={"#":""},r.CHARSETS.B=void 0,r.CHARSETS[4]={"#":"","@":"","[":"ij","\\":"","]":"|","{":"","|":"f","}":"","~":""},r.CHARSETS.C=r.CHARSETS[5]={"[":"","\\":"","]":"","^":"","`":"","{":"","|":"","}":"","~":""},r.CHARSETS.R={"#":"","@":"","[":"","\\":"","]":"","{":"","|":"","}":"","~":""},r.CHARSETS.Q={"@":"","[":"","\\":"","]":"","^":"","`":"","{":"","|":"","}":"","~":""},r.CHARSETS.K={"@":"","[":"","\\":"","]":"","{":"","|":"","}":"","~":""},r.CHARSETS.Y={"#":"","@":"","[":"","\\":"","]":"","`":"","{":"","|":"","}":"","~":""},r.CHARSETS.E=r.CHARSETS[6]={"@":"","[":"","\\":"","]":"","^":"","`":"","{":"","|":"","}":"","~":""},r.CHARSETS.Z={"#":"","@":"","[":"","\\":"","]":"","{":"","|":"","}":""},r.CHARSETS.H=r.CHARSETS[7]={"@":"","[":"","\\":"","]":"","^":"","`":"","{":"","|":"","}":"","~":""},r.CHARSETS["="]={"#":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":""}},2584:(c,r)=>{var o,u,f;Object.defineProperty(r,"__esModule",{value:!0}),r.C1_ESCAPED=r.C1=r.C0=void 0,(function(l){l.NUL="\0",l.SOH="",l.STX="",l.ETX="",l.EOT="",l.ENQ="",l.ACK="",l.BEL="\x07",l.BS="\b",l.HT="	",l.LF=`
`,l.VT="\v",l.FF="\f",l.CR="\r",l.SO="",l.SI="",l.DLE="",l.DC1="",l.DC2="",l.DC3="",l.DC4="",l.NAK="",l.SYN="",l.ETB="",l.CAN="",l.EM="",l.SUB="",l.ESC="\x1B",l.FS="",l.GS="",l.RS="",l.US="",l.SP=" ",l.DEL=""})(o||(r.C0=o={})),(function(l){l.PAD="",l.HOP="",l.BPH="",l.NBH="",l.IND="",l.NEL="",l.SSA="",l.ESA="",l.HTS="",l.HTJ="",l.VTS="",l.PLD="",l.PLU="",l.RI="",l.SS2="",l.SS3="",l.DCS="",l.PU1="",l.PU2="",l.STS="",l.CCH="",l.MW="",l.SPA="",l.EPA="",l.SOS="",l.SGCI="",l.SCI="",l.CSI="",l.ST="",l.OSC="",l.PM="",l.APC=""})(u||(r.C1=u={})),(function(l){l.ST=`${o.ESC}\\`})(f||(r.C1_ESCAPED=f={}))},7399:(c,r,o)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.evaluateKeyboardEvent=void 0;const u=o(2584),f={48:["0",")"],49:["1","!"],50:["2","@"],51:["3","#"],52:["4","$"],53:["5","%"],54:["6","^"],55:["7","&"],56:["8","*"],57:["9","("],186:[";",":"],187:["=","+"],188:[",","<"],189:["-","_"],190:[".",">"],191:["/","?"],192:["`","~"],219:["[","{"],220:["\\","|"],221:["]","}"],222:["'",'"']};r.evaluateKeyboardEvent=function(l,m,g,C){const v={type:0,cancel:!1,key:void 0},h=(l.shiftKey?1:0)|(l.altKey?2:0)|(l.ctrlKey?4:0)|(l.metaKey?8:0);switch(l.keyCode){case 0:l.key==="UIKeyInputUpArrow"?v.key=m?u.C0.ESC+"OA":u.C0.ESC+"[A":l.key==="UIKeyInputLeftArrow"?v.key=m?u.C0.ESC+"OD":u.C0.ESC+"[D":l.key==="UIKeyInputRightArrow"?v.key=m?u.C0.ESC+"OC":u.C0.ESC+"[C":l.key==="UIKeyInputDownArrow"&&(v.key=m?u.C0.ESC+"OB":u.C0.ESC+"[B");break;case 8:v.key=l.ctrlKey?"\b":u.C0.DEL,l.altKey&&(v.key=u.C0.ESC+v.key);break;case 9:if(l.shiftKey){v.key=u.C0.ESC+"[Z";break}v.key=u.C0.HT,v.cancel=!0;break;case 13:v.key=l.altKey?u.C0.ESC+u.C0.CR:u.C0.CR,v.cancel=!0;break;case 27:v.key=u.C0.ESC,l.altKey&&(v.key=u.C0.ESC+u.C0.ESC),v.cancel=!0;break;case 37:if(l.metaKey)break;h?(v.key=u.C0.ESC+"[1;"+(h+1)+"D",v.key===u.C0.ESC+"[1;3D"&&(v.key=u.C0.ESC+(g?"b":"[1;5D"))):v.key=m?u.C0.ESC+"OD":u.C0.ESC+"[D";break;case 39:if(l.metaKey)break;h?(v.key=u.C0.ESC+"[1;"+(h+1)+"C",v.key===u.C0.ESC+"[1;3C"&&(v.key=u.C0.ESC+(g?"f":"[1;5C"))):v.key=m?u.C0.ESC+"OC":u.C0.ESC+"[C";break;case 38:if(l.metaKey)break;h?(v.key=u.C0.ESC+"[1;"+(h+1)+"A",g||v.key!==u.C0.ESC+"[1;3A"||(v.key=u.C0.ESC+"[1;5A")):v.key=m?u.C0.ESC+"OA":u.C0.ESC+"[A";break;case 40:if(l.metaKey)break;h?(v.key=u.C0.ESC+"[1;"+(h+1)+"B",g||v.key!==u.C0.ESC+"[1;3B"||(v.key=u.C0.ESC+"[1;5B")):v.key=m?u.C0.ESC+"OB":u.C0.ESC+"[B";break;case 45:l.shiftKey||l.ctrlKey||(v.key=u.C0.ESC+"[2~");break;case 46:v.key=h?u.C0.ESC+"[3;"+(h+1)+"~":u.C0.ESC+"[3~";break;case 36:v.key=h?u.C0.ESC+"[1;"+(h+1)+"H":m?u.C0.ESC+"OH":u.C0.ESC+"[H";break;case 35:v.key=h?u.C0.ESC+"[1;"+(h+1)+"F":m?u.C0.ESC+"OF":u.C0.ESC+"[F";break;case 33:l.shiftKey?v.type=2:l.ctrlKey?v.key=u.C0.ESC+"[5;"+(h+1)+"~":v.key=u.C0.ESC+"[5~";break;case 34:l.shiftKey?v.type=3:l.ctrlKey?v.key=u.C0.ESC+"[6;"+(h+1)+"~":v.key=u.C0.ESC+"[6~";break;case 112:v.key=h?u.C0.ESC+"[1;"+(h+1)+"P":u.C0.ESC+"OP";break;case 113:v.key=h?u.C0.ESC+"[1;"+(h+1)+"Q":u.C0.ESC+"OQ";break;case 114:v.key=h?u.C0.ESC+"[1;"+(h+1)+"R":u.C0.ESC+"OR";break;case 115:v.key=h?u.C0.ESC+"[1;"+(h+1)+"S":u.C0.ESC+"OS";break;case 116:v.key=h?u.C0.ESC+"[15;"+(h+1)+"~":u.C0.ESC+"[15~";break;case 117:v.key=h?u.C0.ESC+"[17;"+(h+1)+"~":u.C0.ESC+"[17~";break;case 118:v.key=h?u.C0.ESC+"[18;"+(h+1)+"~":u.C0.ESC+"[18~";break;case 119:v.key=h?u.C0.ESC+"[19;"+(h+1)+"~":u.C0.ESC+"[19~";break;case 120:v.key=h?u.C0.ESC+"[20;"+(h+1)+"~":u.C0.ESC+"[20~";break;case 121:v.key=h?u.C0.ESC+"[21;"+(h+1)+"~":u.C0.ESC+"[21~";break;case 122:v.key=h?u.C0.ESC+"[23;"+(h+1)+"~":u.C0.ESC+"[23~";break;case 123:v.key=h?u.C0.ESC+"[24;"+(h+1)+"~":u.C0.ESC+"[24~";break;default:if(!l.ctrlKey||l.shiftKey||l.altKey||l.metaKey)if(g&&!C||!l.altKey||l.metaKey)!g||l.altKey||l.ctrlKey||l.shiftKey||!l.metaKey?l.key&&!l.ctrlKey&&!l.altKey&&!l.metaKey&&l.keyCode>=48&&l.key.length===1?v.key=l.key:l.key&&l.ctrlKey&&(l.key==="_"&&(v.key=u.C0.US),l.key==="@"&&(v.key=u.C0.NUL)):l.keyCode===65&&(v.type=1);else{const p=f[l.keyCode],_=p?.[l.shiftKey?1:0];if(_)v.key=u.C0.ESC+_;else if(l.keyCode>=65&&l.keyCode<=90){const d=l.ctrlKey?l.keyCode-64:l.keyCode+32;let y=String.fromCharCode(d);l.shiftKey&&(y=y.toUpperCase()),v.key=u.C0.ESC+y}else if(l.keyCode===32)v.key=u.C0.ESC+(l.ctrlKey?u.C0.NUL:" ");else if(l.key==="Dead"&&l.code.startsWith("Key")){let d=l.code.slice(3,4);l.shiftKey||(d=d.toLowerCase()),v.key=u.C0.ESC+d,v.cancel=!0}}else l.keyCode>=65&&l.keyCode<=90?v.key=String.fromCharCode(l.keyCode-64):l.keyCode===32?v.key=u.C0.NUL:l.keyCode>=51&&l.keyCode<=55?v.key=String.fromCharCode(l.keyCode-51+27):l.keyCode===56?v.key=u.C0.DEL:l.keyCode===219?v.key=u.C0.ESC:l.keyCode===220?v.key=u.C0.FS:l.keyCode===221&&(v.key=u.C0.GS)}return v}},482:(c,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.Utf8ToUtf32=r.StringToUtf32=r.utf32ToString=r.stringFromCodePoint=void 0,r.stringFromCodePoint=function(o){return o>65535?(o-=65536,String.fromCharCode(55296+(o>>10))+String.fromCharCode(o%1024+56320)):String.fromCharCode(o)},r.utf32ToString=function(o,u=0,f=o.length){let l="";for(let m=u;m<f;++m){let g=o[m];g>65535?(g-=65536,l+=String.fromCharCode(55296+(g>>10))+String.fromCharCode(g%1024+56320)):l+=String.fromCharCode(g)}return l},r.StringToUtf32=class{constructor(){this._interim=0}clear(){this._interim=0}decode(o,u){const f=o.length;if(!f)return 0;let l=0,m=0;if(this._interim){const g=o.charCodeAt(m++);56320<=g&&g<=57343?u[l++]=1024*(this._interim-55296)+g-56320+65536:(u[l++]=this._interim,u[l++]=g),this._interim=0}for(let g=m;g<f;++g){const C=o.charCodeAt(g);if(55296<=C&&C<=56319){if(++g>=f)return this._interim=C,l;const v=o.charCodeAt(g);56320<=v&&v<=57343?u[l++]=1024*(C-55296)+v-56320+65536:(u[l++]=C,u[l++]=v)}else C!==65279&&(u[l++]=C)}return l}},r.Utf8ToUtf32=class{constructor(){this.interim=new Uint8Array(3)}clear(){this.interim.fill(0)}decode(o,u){const f=o.length;if(!f)return 0;let l,m,g,C,v=0,h=0,p=0;if(this.interim[0]){let y=!1,S=this.interim[0];S&=(224&S)==192?31:(240&S)==224?15:7;let w,E=0;for(;(w=63&this.interim[++E])&&E<4;)S<<=6,S|=w;const b=(224&this.interim[0])==192?2:(240&this.interim[0])==224?3:4,k=b-E;for(;p<k;){if(p>=f)return 0;if(w=o[p++],(192&w)!=128){p--,y=!0;break}this.interim[E++]=w,S<<=6,S|=63&w}y||(b===2?S<128?p--:u[v++]=S:b===3?S<2048||S>=55296&&S<=57343||S===65279||(u[v++]=S):S<65536||S>1114111||(u[v++]=S)),this.interim.fill(0)}const _=f-4;let d=p;for(;d<f;){for(;!(!(d<_)||128&(l=o[d])||128&(m=o[d+1])||128&(g=o[d+2])||128&(C=o[d+3]));)u[v++]=l,u[v++]=m,u[v++]=g,u[v++]=C,d+=4;if(l=o[d++],l<128)u[v++]=l;else if((224&l)==192){if(d>=f)return this.interim[0]=l,v;if(m=o[d++],(192&m)!=128){d--;continue}if(h=(31&l)<<6|63&m,h<128){d--;continue}u[v++]=h}else if((240&l)==224){if(d>=f)return this.interim[0]=l,v;if(m=o[d++],(192&m)!=128){d--;continue}if(d>=f)return this.interim[0]=l,this.interim[1]=m,v;if(g=o[d++],(192&g)!=128){d--;continue}if(h=(15&l)<<12|(63&m)<<6|63&g,h<2048||h>=55296&&h<=57343||h===65279)continue;u[v++]=h}else if((248&l)==240){if(d>=f)return this.interim[0]=l,v;if(m=o[d++],(192&m)!=128){d--;continue}if(d>=f)return this.interim[0]=l,this.interim[1]=m,v;if(g=o[d++],(192&g)!=128){d--;continue}if(d>=f)return this.interim[0]=l,this.interim[1]=m,this.interim[2]=g,v;if(C=o[d++],(192&C)!=128){d--;continue}if(h=(7&l)<<18|(63&m)<<12|(63&g)<<6|63&C,h<65536||h>1114111)continue;u[v++]=h}}return v}}},225:(c,r,o)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.UnicodeV6=void 0;const u=o(1480),f=[[768,879],[1155,1158],[1160,1161],[1425,1469],[1471,1471],[1473,1474],[1476,1477],[1479,1479],[1536,1539],[1552,1557],[1611,1630],[1648,1648],[1750,1764],[1767,1768],[1770,1773],[1807,1807],[1809,1809],[1840,1866],[1958,1968],[2027,2035],[2305,2306],[2364,2364],[2369,2376],[2381,2381],[2385,2388],[2402,2403],[2433,2433],[2492,2492],[2497,2500],[2509,2509],[2530,2531],[2561,2562],[2620,2620],[2625,2626],[2631,2632],[2635,2637],[2672,2673],[2689,2690],[2748,2748],[2753,2757],[2759,2760],[2765,2765],[2786,2787],[2817,2817],[2876,2876],[2879,2879],[2881,2883],[2893,2893],[2902,2902],[2946,2946],[3008,3008],[3021,3021],[3134,3136],[3142,3144],[3146,3149],[3157,3158],[3260,3260],[3263,3263],[3270,3270],[3276,3277],[3298,3299],[3393,3395],[3405,3405],[3530,3530],[3538,3540],[3542,3542],[3633,3633],[3636,3642],[3655,3662],[3761,3761],[3764,3769],[3771,3772],[3784,3789],[3864,3865],[3893,3893],[3895,3895],[3897,3897],[3953,3966],[3968,3972],[3974,3975],[3984,3991],[3993,4028],[4038,4038],[4141,4144],[4146,4146],[4150,4151],[4153,4153],[4184,4185],[4448,4607],[4959,4959],[5906,5908],[5938,5940],[5970,5971],[6002,6003],[6068,6069],[6071,6077],[6086,6086],[6089,6099],[6109,6109],[6155,6157],[6313,6313],[6432,6434],[6439,6440],[6450,6450],[6457,6459],[6679,6680],[6912,6915],[6964,6964],[6966,6970],[6972,6972],[6978,6978],[7019,7027],[7616,7626],[7678,7679],[8203,8207],[8234,8238],[8288,8291],[8298,8303],[8400,8431],[12330,12335],[12441,12442],[43014,43014],[43019,43019],[43045,43046],[64286,64286],[65024,65039],[65056,65059],[65279,65279],[65529,65531]],l=[[68097,68099],[68101,68102],[68108,68111],[68152,68154],[68159,68159],[119143,119145],[119155,119170],[119173,119179],[119210,119213],[119362,119364],[917505,917505],[917536,917631],[917760,917999]];let m;r.UnicodeV6=class{constructor(){if(this.version="6",!m){m=new Uint8Array(65536),m.fill(1),m[0]=0,m.fill(0,1,32),m.fill(0,127,160),m.fill(2,4352,4448),m[9001]=2,m[9002]=2,m.fill(2,11904,42192),m[12351]=1,m.fill(2,44032,55204),m.fill(2,63744,64256),m.fill(2,65040,65050),m.fill(2,65072,65136),m.fill(2,65280,65377),m.fill(2,65504,65511);for(let g=0;g<f.length;++g)m.fill(0,f[g][0],f[g][1]+1)}}wcwidth(g){return g<32?0:g<127?1:g<65536?m[g]:(function(C,v){let h,p=0,_=v.length-1;if(C<v[0][0]||C>v[_][1])return!1;for(;_>=p;)if(h=p+_>>1,C>v[h][1])p=h+1;else{if(!(C<v[h][0]))return!0;_=h-1}return!1})(g,l)?0:g>=131072&&g<=196605||g>=196608&&g<=262141?2:1}charProperties(g,C){let v=this.wcwidth(g),h=v===0&&C!==0;if(h){const p=u.UnicodeService.extractWidth(C);p===0?h=!1:p>v&&(v=p)}return u.UnicodeService.createPropertyValue(0,v,h)}}},5981:(c,r,o)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.WriteBuffer=void 0;const u=o(8460),f=o(844);class l extends f.Disposable{constructor(g){super(),this._action=g,this._writeBuffer=[],this._callbacks=[],this._pendingData=0,this._bufferOffset=0,this._isSyncWriting=!1,this._syncCalls=0,this._didUserInput=!1,this._onWriteParsed=this.register(new u.EventEmitter),this.onWriteParsed=this._onWriteParsed.event}handleUserInput(){this._didUserInput=!0}writeSync(g,C){if(C!==void 0&&this._syncCalls>C)return void(this._syncCalls=0);if(this._pendingData+=g.length,this._writeBuffer.push(g),this._callbacks.push(void 0),this._syncCalls++,this._isSyncWriting)return;let v;for(this._isSyncWriting=!0;v=this._writeBuffer.shift();){this._action(v);const h=this._callbacks.shift();h&&h()}this._pendingData=0,this._bufferOffset=2147483647,this._isSyncWriting=!1,this._syncCalls=0}write(g,C){if(this._pendingData>5e7)throw new Error("write data discarded, use flow control to avoid losing data");if(!this._writeBuffer.length){if(this._bufferOffset=0,this._didUserInput)return this._didUserInput=!1,this._pendingData+=g.length,this._writeBuffer.push(g),this._callbacks.push(C),void this._innerWrite();setTimeout((()=>this._innerWrite()))}this._pendingData+=g.length,this._writeBuffer.push(g),this._callbacks.push(C)}_innerWrite(g=0,C=!0){const v=g||Date.now();for(;this._writeBuffer.length>this._bufferOffset;){const h=this._writeBuffer[this._bufferOffset],p=this._action(h,C);if(p){const d=y=>Date.now()-v>=12?setTimeout((()=>this._innerWrite(0,y))):this._innerWrite(v,y);return void p.catch((y=>(queueMicrotask((()=>{throw y})),Promise.resolve(!1)))).then(d)}const _=this._callbacks[this._bufferOffset];if(_&&_(),this._bufferOffset++,this._pendingData-=h.length,Date.now()-v>=12)break}this._writeBuffer.length>this._bufferOffset?(this._bufferOffset>50&&(this._writeBuffer=this._writeBuffer.slice(this._bufferOffset),this._callbacks=this._callbacks.slice(this._bufferOffset),this._bufferOffset=0),setTimeout((()=>this._innerWrite()))):(this._writeBuffer.length=0,this._callbacks.length=0,this._pendingData=0,this._bufferOffset=0),this._onWriteParsed.fire()}}r.WriteBuffer=l},5941:(c,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.toRgbString=r.parseColor=void 0;const o=/^([\da-f])\/([\da-f])\/([\da-f])$|^([\da-f]{2})\/([\da-f]{2})\/([\da-f]{2})$|^([\da-f]{3})\/([\da-f]{3})\/([\da-f]{3})$|^([\da-f]{4})\/([\da-f]{4})\/([\da-f]{4})$/,u=/^[\da-f]+$/;function f(l,m){const g=l.toString(16),C=g.length<2?"0"+g:g;switch(m){case 4:return g[0];case 8:return C;case 12:return(C+C).slice(0,3);default:return C+C}}r.parseColor=function(l){if(!l)return;let m=l.toLowerCase();if(m.indexOf("rgb:")===0){m=m.slice(4);const g=o.exec(m);if(g){const C=g[1]?15:g[4]?255:g[7]?4095:65535;return[Math.round(parseInt(g[1]||g[4]||g[7]||g[10],16)/C*255),Math.round(parseInt(g[2]||g[5]||g[8]||g[11],16)/C*255),Math.round(parseInt(g[3]||g[6]||g[9]||g[12],16)/C*255)]}}else if(m.indexOf("#")===0&&(m=m.slice(1),u.exec(m)&&[3,6,9,12].includes(m.length))){const g=m.length/3,C=[0,0,0];for(let v=0;v<3;++v){const h=parseInt(m.slice(g*v,g*v+g),16);C[v]=g===1?h<<4:g===2?h:g===3?h>>4:h>>8}return C}},r.toRgbString=function(l,m=16){const[g,C,v]=l;return`rgb:${f(g,m)}/${f(C,m)}/${f(v,m)}`}},5770:(c,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.PAYLOAD_LIMIT=void 0,r.PAYLOAD_LIMIT=1e7},6351:(c,r,o)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.DcsHandler=r.DcsParser=void 0;const u=o(482),f=o(8742),l=o(5770),m=[];r.DcsParser=class{constructor(){this._handlers=Object.create(null),this._active=m,this._ident=0,this._handlerFb=()=>{},this._stack={paused:!1,loopPosition:0,fallThrough:!1}}dispose(){this._handlers=Object.create(null),this._handlerFb=()=>{},this._active=m}registerHandler(C,v){this._handlers[C]===void 0&&(this._handlers[C]=[]);const h=this._handlers[C];return h.push(v),{dispose:()=>{const p=h.indexOf(v);p!==-1&&h.splice(p,1)}}}clearHandler(C){this._handlers[C]&&delete this._handlers[C]}setHandlerFallback(C){this._handlerFb=C}reset(){if(this._active.length)for(let C=this._stack.paused?this._stack.loopPosition-1:this._active.length-1;C>=0;--C)this._active[C].unhook(!1);this._stack.paused=!1,this._active=m,this._ident=0}hook(C,v){if(this.reset(),this._ident=C,this._active=this._handlers[C]||m,this._active.length)for(let h=this._active.length-1;h>=0;h--)this._active[h].hook(v);else this._handlerFb(this._ident,"HOOK",v)}put(C,v,h){if(this._active.length)for(let p=this._active.length-1;p>=0;p--)this._active[p].put(C,v,h);else this._handlerFb(this._ident,"PUT",(0,u.utf32ToString)(C,v,h))}unhook(C,v=!0){if(this._active.length){let h=!1,p=this._active.length-1,_=!1;if(this._stack.paused&&(p=this._stack.loopPosition-1,h=v,_=this._stack.fallThrough,this._stack.paused=!1),!_&&h===!1){for(;p>=0&&(h=this._active[p].unhook(C),h!==!0);p--)if(h instanceof Promise)return this._stack.paused=!0,this._stack.loopPosition=p,this._stack.fallThrough=!1,h;p--}for(;p>=0;p--)if(h=this._active[p].unhook(!1),h instanceof Promise)return this._stack.paused=!0,this._stack.loopPosition=p,this._stack.fallThrough=!0,h}else this._handlerFb(this._ident,"UNHOOK",C);this._active=m,this._ident=0}};const g=new f.Params;g.addParam(0),r.DcsHandler=class{constructor(C){this._handler=C,this._data="",this._params=g,this._hitLimit=!1}hook(C){this._params=C.length>1||C.params[0]?C.clone():g,this._data="",this._hitLimit=!1}put(C,v,h){this._hitLimit||(this._data+=(0,u.utf32ToString)(C,v,h),this._data.length>l.PAYLOAD_LIMIT&&(this._data="",this._hitLimit=!0))}unhook(C){let v=!1;if(this._hitLimit)v=!1;else if(C&&(v=this._handler(this._data,this._params),v instanceof Promise))return v.then((h=>(this._params=g,this._data="",this._hitLimit=!1,h)));return this._params=g,this._data="",this._hitLimit=!1,v}}},2015:(c,r,o)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.EscapeSequenceParser=r.VT500_TRANSITION_TABLE=r.TransitionTable=void 0;const u=o(844),f=o(8742),l=o(6242),m=o(6351);class g{constructor(p){this.table=new Uint8Array(p)}setDefault(p,_){this.table.fill(p<<4|_)}add(p,_,d,y){this.table[_<<8|p]=d<<4|y}addMany(p,_,d,y){for(let S=0;S<p.length;S++)this.table[_<<8|p[S]]=d<<4|y}}r.TransitionTable=g;const C=160;r.VT500_TRANSITION_TABLE=(function(){const h=new g(4095),p=Array.apply(null,Array(256)).map(((E,b)=>b)),_=(E,b)=>p.slice(E,b),d=_(32,127),y=_(0,24);y.push(25),y.push.apply(y,_(28,32));const S=_(0,14);let w;for(w in h.setDefault(1,0),h.addMany(d,0,2,0),S)h.addMany([24,26,153,154],w,3,0),h.addMany(_(128,144),w,3,0),h.addMany(_(144,152),w,3,0),h.add(156,w,0,0),h.add(27,w,11,1),h.add(157,w,4,8),h.addMany([152,158,159],w,0,7),h.add(155,w,11,3),h.add(144,w,11,9);return h.addMany(y,0,3,0),h.addMany(y,1,3,1),h.add(127,1,0,1),h.addMany(y,8,0,8),h.addMany(y,3,3,3),h.add(127,3,0,3),h.addMany(y,4,3,4),h.add(127,4,0,4),h.addMany(y,6,3,6),h.addMany(y,5,3,5),h.add(127,5,0,5),h.addMany(y,2,3,2),h.add(127,2,0,2),h.add(93,1,4,8),h.addMany(d,8,5,8),h.add(127,8,5,8),h.addMany([156,27,24,26,7],8,6,0),h.addMany(_(28,32),8,0,8),h.addMany([88,94,95],1,0,7),h.addMany(d,7,0,7),h.addMany(y,7,0,7),h.add(156,7,0,0),h.add(127,7,0,7),h.add(91,1,11,3),h.addMany(_(64,127),3,7,0),h.addMany(_(48,60),3,8,4),h.addMany([60,61,62,63],3,9,4),h.addMany(_(48,60),4,8,4),h.addMany(_(64,127),4,7,0),h.addMany([60,61,62,63],4,0,6),h.addMany(_(32,64),6,0,6),h.add(127,6,0,6),h.addMany(_(64,127),6,0,0),h.addMany(_(32,48),3,9,5),h.addMany(_(32,48),5,9,5),h.addMany(_(48,64),5,0,6),h.addMany(_(64,127),5,7,0),h.addMany(_(32,48),4,9,5),h.addMany(_(32,48),1,9,2),h.addMany(_(32,48),2,9,2),h.addMany(_(48,127),2,10,0),h.addMany(_(48,80),1,10,0),h.addMany(_(81,88),1,10,0),h.addMany([89,90,92],1,10,0),h.addMany(_(96,127),1,10,0),h.add(80,1,11,9),h.addMany(y,9,0,9),h.add(127,9,0,9),h.addMany(_(28,32),9,0,9),h.addMany(_(32,48),9,9,12),h.addMany(_(48,60),9,8,10),h.addMany([60,61,62,63],9,9,10),h.addMany(y,11,0,11),h.addMany(_(32,128),11,0,11),h.addMany(_(28,32),11,0,11),h.addMany(y,10,0,10),h.add(127,10,0,10),h.addMany(_(28,32),10,0,10),h.addMany(_(48,60),10,8,10),h.addMany([60,61,62,63],10,0,11),h.addMany(_(32,48),10,9,12),h.addMany(y,12,0,12),h.add(127,12,0,12),h.addMany(_(28,32),12,0,12),h.addMany(_(32,48),12,9,12),h.addMany(_(48,64),12,0,11),h.addMany(_(64,127),12,12,13),h.addMany(_(64,127),10,12,13),h.addMany(_(64,127),9,12,13),h.addMany(y,13,13,13),h.addMany(d,13,13,13),h.add(127,13,0,13),h.addMany([27,156,24,26],13,14,0),h.add(C,0,2,0),h.add(C,8,5,8),h.add(C,6,0,6),h.add(C,11,0,11),h.add(C,13,13,13),h})();class v extends u.Disposable{constructor(p=r.VT500_TRANSITION_TABLE){super(),this._transitions=p,this._parseStack={state:0,handlers:[],handlerPos:0,transition:0,chunkPos:0},this.initialState=0,this.currentState=this.initialState,this._params=new f.Params,this._params.addParam(0),this._collect=0,this.precedingJoinState=0,this._printHandlerFb=(_,d,y)=>{},this._executeHandlerFb=_=>{},this._csiHandlerFb=(_,d)=>{},this._escHandlerFb=_=>{},this._errorHandlerFb=_=>_,this._printHandler=this._printHandlerFb,this._executeHandlers=Object.create(null),this._csiHandlers=Object.create(null),this._escHandlers=Object.create(null),this.register((0,u.toDisposable)((()=>{this._csiHandlers=Object.create(null),this._executeHandlers=Object.create(null),this._escHandlers=Object.create(null)}))),this._oscParser=this.register(new l.OscParser),this._dcsParser=this.register(new m.DcsParser),this._errorHandler=this._errorHandlerFb,this.registerEscHandler({final:"\\"},(()=>!0))}_identifier(p,_=[64,126]){let d=0;if(p.prefix){if(p.prefix.length>1)throw new Error("only one byte as prefix supported");if(d=p.prefix.charCodeAt(0),d&&60>d||d>63)throw new Error("prefix must be in range 0x3c .. 0x3f")}if(p.intermediates){if(p.intermediates.length>2)throw new Error("only two bytes as intermediates are supported");for(let S=0;S<p.intermediates.length;++S){const w=p.intermediates.charCodeAt(S);if(32>w||w>47)throw new Error("intermediate must be in range 0x20 .. 0x2f");d<<=8,d|=w}}if(p.final.length!==1)throw new Error("final must be a single byte");const y=p.final.charCodeAt(0);if(_[0]>y||y>_[1])throw new Error(`final must be in range ${_[0]} .. ${_[1]}`);return d<<=8,d|=y,d}identToString(p){const _=[];for(;p;)_.push(String.fromCharCode(255&p)),p>>=8;return _.reverse().join("")}setPrintHandler(p){this._printHandler=p}clearPrintHandler(){this._printHandler=this._printHandlerFb}registerEscHandler(p,_){const d=this._identifier(p,[48,126]);this._escHandlers[d]===void 0&&(this._escHandlers[d]=[]);const y=this._escHandlers[d];return y.push(_),{dispose:()=>{const S=y.indexOf(_);S!==-1&&y.splice(S,1)}}}clearEscHandler(p){this._escHandlers[this._identifier(p,[48,126])]&&delete this._escHandlers[this._identifier(p,[48,126])]}setEscHandlerFallback(p){this._escHandlerFb=p}setExecuteHandler(p,_){this._executeHandlers[p.charCodeAt(0)]=_}clearExecuteHandler(p){this._executeHandlers[p.charCodeAt(0)]&&delete this._executeHandlers[p.charCodeAt(0)]}setExecuteHandlerFallback(p){this._executeHandlerFb=p}registerCsiHandler(p,_){const d=this._identifier(p);this._csiHandlers[d]===void 0&&(this._csiHandlers[d]=[]);const y=this._csiHandlers[d];return y.push(_),{dispose:()=>{const S=y.indexOf(_);S!==-1&&y.splice(S,1)}}}clearCsiHandler(p){this._csiHandlers[this._identifier(p)]&&delete this._csiHandlers[this._identifier(p)]}setCsiHandlerFallback(p){this._csiHandlerFb=p}registerDcsHandler(p,_){return this._dcsParser.registerHandler(this._identifier(p),_)}clearDcsHandler(p){this._dcsParser.clearHandler(this._identifier(p))}setDcsHandlerFallback(p){this._dcsParser.setHandlerFallback(p)}registerOscHandler(p,_){return this._oscParser.registerHandler(p,_)}clearOscHandler(p){this._oscParser.clearHandler(p)}setOscHandlerFallback(p){this._oscParser.setHandlerFallback(p)}setErrorHandler(p){this._errorHandler=p}clearErrorHandler(){this._errorHandler=this._errorHandlerFb}reset(){this.currentState=this.initialState,this._oscParser.reset(),this._dcsParser.reset(),this._params.reset(),this._params.addParam(0),this._collect=0,this.precedingJoinState=0,this._parseStack.state!==0&&(this._parseStack.state=2,this._parseStack.handlers=[])}_preserveStack(p,_,d,y,S){this._parseStack.state=p,this._parseStack.handlers=_,this._parseStack.handlerPos=d,this._parseStack.transition=y,this._parseStack.chunkPos=S}parse(p,_,d){let y,S=0,w=0,E=0;if(this._parseStack.state)if(this._parseStack.state===2)this._parseStack.state=0,E=this._parseStack.chunkPos+1;else{if(d===void 0||this._parseStack.state===1)throw this._parseStack.state=1,new Error("improper continuation due to previous async handler, giving up parsing");const b=this._parseStack.handlers;let k=this._parseStack.handlerPos-1;switch(this._parseStack.state){case 3:if(d===!1&&k>-1){for(;k>=0&&(y=b[k](this._params),y!==!0);k--)if(y instanceof Promise)return this._parseStack.handlerPos=k,y}this._parseStack.handlers=[];break;case 4:if(d===!1&&k>-1){for(;k>=0&&(y=b[k](),y!==!0);k--)if(y instanceof Promise)return this._parseStack.handlerPos=k,y}this._parseStack.handlers=[];break;case 6:if(S=p[this._parseStack.chunkPos],y=this._dcsParser.unhook(S!==24&&S!==26,d),y)return y;S===27&&(this._parseStack.transition|=1),this._params.reset(),this._params.addParam(0),this._collect=0;break;case 5:if(S=p[this._parseStack.chunkPos],y=this._oscParser.end(S!==24&&S!==26,d),y)return y;S===27&&(this._parseStack.transition|=1),this._params.reset(),this._params.addParam(0),this._collect=0}this._parseStack.state=0,E=this._parseStack.chunkPos+1,this.precedingJoinState=0,this.currentState=15&this._parseStack.transition}for(let b=E;b<_;++b){switch(S=p[b],w=this._transitions.table[this.currentState<<8|(S<160?S:C)],w>>4){case 2:for(let L=b+1;;++L){if(L>=_||(S=p[L])<32||S>126&&S<C){this._printHandler(p,b,L),b=L-1;break}if(++L>=_||(S=p[L])<32||S>126&&S<C){this._printHandler(p,b,L),b=L-1;break}if(++L>=_||(S=p[L])<32||S>126&&S<C){this._printHandler(p,b,L),b=L-1;break}if(++L>=_||(S=p[L])<32||S>126&&S<C){this._printHandler(p,b,L),b=L-1;break}}break;case 3:this._executeHandlers[S]?this._executeHandlers[S]():this._executeHandlerFb(S),this.precedingJoinState=0;break;case 0:break;case 1:if(this._errorHandler({position:b,code:S,currentState:this.currentState,collect:this._collect,params:this._params,abort:!1}).abort)return;break;case 7:const k=this._csiHandlers[this._collect<<8|S];let R=k?k.length-1:-1;for(;R>=0&&(y=k[R](this._params),y!==!0);R--)if(y instanceof Promise)return this._preserveStack(3,k,R,w,b),y;R<0&&this._csiHandlerFb(this._collect<<8|S,this._params),this.precedingJoinState=0;break;case 8:do switch(S){case 59:this._params.addParam(0);break;case 58:this._params.addSubParam(-1);break;default:this._params.addDigit(S-48)}while(++b<_&&(S=p[b])>47&&S<60);b--;break;case 9:this._collect<<=8,this._collect|=S;break;case 10:const O=this._escHandlers[this._collect<<8|S];let P=O?O.length-1:-1;for(;P>=0&&(y=O[P](),y!==!0);P--)if(y instanceof Promise)return this._preserveStack(4,O,P,w,b),y;P<0&&this._escHandlerFb(this._collect<<8|S),this.precedingJoinState=0;break;case 11:this._params.reset(),this._params.addParam(0),this._collect=0;break;case 12:this._dcsParser.hook(this._collect<<8|S,this._params);break;case 13:for(let L=b+1;;++L)if(L>=_||(S=p[L])===24||S===26||S===27||S>127&&S<C){this._dcsParser.put(p,b,L),b=L-1;break}break;case 14:if(y=this._dcsParser.unhook(S!==24&&S!==26),y)return this._preserveStack(6,[],0,w,b),y;S===27&&(w|=1),this._params.reset(),this._params.addParam(0),this._collect=0,this.precedingJoinState=0;break;case 4:this._oscParser.start();break;case 5:for(let L=b+1;;L++)if(L>=_||(S=p[L])<32||S>127&&S<C){this._oscParser.put(p,b,L),b=L-1;break}break;case 6:if(y=this._oscParser.end(S!==24&&S!==26),y)return this._preserveStack(5,[],0,w,b),y;S===27&&(w|=1),this._params.reset(),this._params.addParam(0),this._collect=0,this.precedingJoinState=0}this.currentState=15&w}}}r.EscapeSequenceParser=v},6242:(c,r,o)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.OscHandler=r.OscParser=void 0;const u=o(5770),f=o(482),l=[];r.OscParser=class{constructor(){this._state=0,this._active=l,this._id=-1,this._handlers=Object.create(null),this._handlerFb=()=>{},this._stack={paused:!1,loopPosition:0,fallThrough:!1}}registerHandler(m,g){this._handlers[m]===void 0&&(this._handlers[m]=[]);const C=this._handlers[m];return C.push(g),{dispose:()=>{const v=C.indexOf(g);v!==-1&&C.splice(v,1)}}}clearHandler(m){this._handlers[m]&&delete this._handlers[m]}setHandlerFallback(m){this._handlerFb=m}dispose(){this._handlers=Object.create(null),this._handlerFb=()=>{},this._active=l}reset(){if(this._state===2)for(let m=this._stack.paused?this._stack.loopPosition-1:this._active.length-1;m>=0;--m)this._active[m].end(!1);this._stack.paused=!1,this._active=l,this._id=-1,this._state=0}_start(){if(this._active=this._handlers[this._id]||l,this._active.length)for(let m=this._active.length-1;m>=0;m--)this._active[m].start();else this._handlerFb(this._id,"START")}_put(m,g,C){if(this._active.length)for(let v=this._active.length-1;v>=0;v--)this._active[v].put(m,g,C);else this._handlerFb(this._id,"PUT",(0,f.utf32ToString)(m,g,C))}start(){this.reset(),this._state=1}put(m,g,C){if(this._state!==3){if(this._state===1)for(;g<C;){const v=m[g++];if(v===59){this._state=2,this._start();break}if(v<48||57<v)return void(this._state=3);this._id===-1&&(this._id=0),this._id=10*this._id+v-48}this._state===2&&C-g>0&&this._put(m,g,C)}}end(m,g=!0){if(this._state!==0){if(this._state!==3)if(this._state===1&&this._start(),this._active.length){let C=!1,v=this._active.length-1,h=!1;if(this._stack.paused&&(v=this._stack.loopPosition-1,C=g,h=this._stack.fallThrough,this._stack.paused=!1),!h&&C===!1){for(;v>=0&&(C=this._active[v].end(m),C!==!0);v--)if(C instanceof Promise)return this._stack.paused=!0,this._stack.loopPosition=v,this._stack.fallThrough=!1,C;v--}for(;v>=0;v--)if(C=this._active[v].end(!1),C instanceof Promise)return this._stack.paused=!0,this._stack.loopPosition=v,this._stack.fallThrough=!0,C}else this._handlerFb(this._id,"END",m);this._active=l,this._id=-1,this._state=0}}},r.OscHandler=class{constructor(m){this._handler=m,this._data="",this._hitLimit=!1}start(){this._data="",this._hitLimit=!1}put(m,g,C){this._hitLimit||(this._data+=(0,f.utf32ToString)(m,g,C),this._data.length>u.PAYLOAD_LIMIT&&(this._data="",this._hitLimit=!0))}end(m){let g=!1;if(this._hitLimit)g=!1;else if(m&&(g=this._handler(this._data),g instanceof Promise))return g.then((C=>(this._data="",this._hitLimit=!1,C)));return this._data="",this._hitLimit=!1,g}}},8742:(c,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.Params=void 0;const o=2147483647;class u{static fromArray(l){const m=new u;if(!l.length)return m;for(let g=Array.isArray(l[0])?1:0;g<l.length;++g){const C=l[g];if(Array.isArray(C))for(let v=0;v<C.length;++v)m.addSubParam(C[v]);else m.addParam(C)}return m}constructor(l=32,m=32){if(this.maxLength=l,this.maxSubParamsLength=m,m>256)throw new Error("maxSubParamsLength must not be greater than 256");this.params=new Int32Array(l),this.length=0,this._subParams=new Int32Array(m),this._subParamsLength=0,this._subParamsIdx=new Uint16Array(l),this._rejectDigits=!1,this._rejectSubDigits=!1,this._digitIsSub=!1}clone(){const l=new u(this.maxLength,this.maxSubParamsLength);return l.params.set(this.params),l.length=this.length,l._subParams.set(this._subParams),l._subParamsLength=this._subParamsLength,l._subParamsIdx.set(this._subParamsIdx),l._rejectDigits=this._rejectDigits,l._rejectSubDigits=this._rejectSubDigits,l._digitIsSub=this._digitIsSub,l}toArray(){const l=[];for(let m=0;m<this.length;++m){l.push(this.params[m]);const g=this._subParamsIdx[m]>>8,C=255&this._subParamsIdx[m];C-g>0&&l.push(Array.prototype.slice.call(this._subParams,g,C))}return l}reset(){this.length=0,this._subParamsLength=0,this._rejectDigits=!1,this._rejectSubDigits=!1,this._digitIsSub=!1}addParam(l){if(this._digitIsSub=!1,this.length>=this.maxLength)this._rejectDigits=!0;else{if(l<-1)throw new Error("values lesser than -1 are not allowed");this._subParamsIdx[this.length]=this._subParamsLength<<8|this._subParamsLength,this.params[this.length++]=l>o?o:l}}addSubParam(l){if(this._digitIsSub=!0,this.length)if(this._rejectDigits||this._subParamsLength>=this.maxSubParamsLength)this._rejectSubDigits=!0;else{if(l<-1)throw new Error("values lesser than -1 are not allowed");this._subParams[this._subParamsLength++]=l>o?o:l,this._subParamsIdx[this.length-1]++}}hasSubParams(l){return(255&this._subParamsIdx[l])-(this._subParamsIdx[l]>>8)>0}getSubParams(l){const m=this._subParamsIdx[l]>>8,g=255&this._subParamsIdx[l];return g-m>0?this._subParams.subarray(m,g):null}getSubParamsAll(){const l={};for(let m=0;m<this.length;++m){const g=this._subParamsIdx[m]>>8,C=255&this._subParamsIdx[m];C-g>0&&(l[m]=this._subParams.slice(g,C))}return l}addDigit(l){let m;if(this._rejectDigits||!(m=this._digitIsSub?this._subParamsLength:this.length)||this._digitIsSub&&this._rejectSubDigits)return;const g=this._digitIsSub?this._subParams:this.params,C=g[m-1];g[m-1]=~C?Math.min(10*C+l,o):l}}r.Params=u},5741:(c,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.AddonManager=void 0,r.AddonManager=class{constructor(){this._addons=[]}dispose(){for(let o=this._addons.length-1;o>=0;o--)this._addons[o].instance.dispose()}loadAddon(o,u){const f={instance:u,dispose:u.dispose,isDisposed:!1};this._addons.push(f),u.dispose=()=>this._wrappedAddonDispose(f),u.activate(o)}_wrappedAddonDispose(o){if(o.isDisposed)return;let u=-1;for(let f=0;f<this._addons.length;f++)if(this._addons[f]===o){u=f;break}if(u===-1)throw new Error("Could not dispose an addon that has not been loaded");o.isDisposed=!0,o.dispose.apply(o.instance),this._addons.splice(u,1)}}},8771:(c,r,o)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.BufferApiView=void 0;const u=o(3785),f=o(511);r.BufferApiView=class{constructor(l,m){this._buffer=l,this.type=m}init(l){return this._buffer=l,this}get cursorY(){return this._buffer.y}get cursorX(){return this._buffer.x}get viewportY(){return this._buffer.ydisp}get baseY(){return this._buffer.ybase}get length(){return this._buffer.lines.length}getLine(l){const m=this._buffer.lines.get(l);if(m)return new u.BufferLineApiView(m)}getNullCell(){return new f.CellData}}},3785:(c,r,o)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.BufferLineApiView=void 0;const u=o(511);r.BufferLineApiView=class{constructor(f){this._line=f}get isWrapped(){return this._line.isWrapped}get length(){return this._line.length}getCell(f,l){if(!(f<0||f>=this._line.length))return l?(this._line.loadCell(f,l),l):this._line.loadCell(f,new u.CellData)}translateToString(f,l,m){return this._line.translateToString(f,l,m)}}},8285:(c,r,o)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.BufferNamespaceApi=void 0;const u=o(8771),f=o(8460),l=o(844);class m extends l.Disposable{constructor(C){super(),this._core=C,this._onBufferChange=this.register(new f.EventEmitter),this.onBufferChange=this._onBufferChange.event,this._normal=new u.BufferApiView(this._core.buffers.normal,"normal"),this._alternate=new u.BufferApiView(this._core.buffers.alt,"alternate"),this._core.buffers.onBufferActivate((()=>this._onBufferChange.fire(this.active)))}get active(){if(this._core.buffers.active===this._core.buffers.normal)return this.normal;if(this._core.buffers.active===this._core.buffers.alt)return this.alternate;throw new Error("Active buffer is neither normal nor alternate")}get normal(){return this._normal.init(this._core.buffers.normal)}get alternate(){return this._alternate.init(this._core.buffers.alt)}}r.BufferNamespaceApi=m},7975:(c,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.ParserApi=void 0,r.ParserApi=class{constructor(o){this._core=o}registerCsiHandler(o,u){return this._core.registerCsiHandler(o,(f=>u(f.toArray())))}addCsiHandler(o,u){return this.registerCsiHandler(o,u)}registerDcsHandler(o,u){return this._core.registerDcsHandler(o,((f,l)=>u(f,l.toArray())))}addDcsHandler(o,u){return this.registerDcsHandler(o,u)}registerEscHandler(o,u){return this._core.registerEscHandler(o,u)}addEscHandler(o,u){return this.registerEscHandler(o,u)}registerOscHandler(o,u){return this._core.registerOscHandler(o,u)}addOscHandler(o,u){return this.registerOscHandler(o,u)}}},7090:(c,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.UnicodeApi=void 0,r.UnicodeApi=class{constructor(o){this._core=o}register(o){this._core.unicodeService.register(o)}get versions(){return this._core.unicodeService.versions}get activeVersion(){return this._core.unicodeService.activeVersion}set activeVersion(o){this._core.unicodeService.activeVersion=o}}},744:function(c,r,o){var u=this&&this.__decorate||function(h,p,_,d){var y,S=arguments.length,w=S<3?p:d===null?d=Object.getOwnPropertyDescriptor(p,_):d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")w=Reflect.decorate(h,p,_,d);else for(var E=h.length-1;E>=0;E--)(y=h[E])&&(w=(S<3?y(w):S>3?y(p,_,w):y(p,_))||w);return S>3&&w&&Object.defineProperty(p,_,w),w},f=this&&this.__param||function(h,p){return function(_,d){p(_,d,h)}};Object.defineProperty(r,"__esModule",{value:!0}),r.BufferService=r.MINIMUM_ROWS=r.MINIMUM_COLS=void 0;const l=o(8460),m=o(844),g=o(5295),C=o(2585);r.MINIMUM_COLS=2,r.MINIMUM_ROWS=1;let v=r.BufferService=class extends m.Disposable{get buffer(){return this.buffers.active}constructor(h){super(),this.isUserScrolling=!1,this._onResize=this.register(new l.EventEmitter),this.onResize=this._onResize.event,this._onScroll=this.register(new l.EventEmitter),this.onScroll=this._onScroll.event,this.cols=Math.max(h.rawOptions.cols||0,r.MINIMUM_COLS),this.rows=Math.max(h.rawOptions.rows||0,r.MINIMUM_ROWS),this.buffers=this.register(new g.BufferSet(h,this))}resize(h,p){this.cols=h,this.rows=p,this.buffers.resize(h,p),this._onResize.fire({cols:h,rows:p})}reset(){this.buffers.reset(),this.isUserScrolling=!1}scroll(h,p=!1){const _=this.buffer;let d;d=this._cachedBlankLine,d&&d.length===this.cols&&d.getFg(0)===h.fg&&d.getBg(0)===h.bg||(d=_.getBlankLine(h,p),this._cachedBlankLine=d),d.isWrapped=p;const y=_.ybase+_.scrollTop,S=_.ybase+_.scrollBottom;if(_.scrollTop===0){const w=_.lines.isFull;S===_.lines.length-1?w?_.lines.recycle().copyFrom(d):_.lines.push(d.clone()):_.lines.splice(S+1,0,d.clone()),w?this.isUserScrolling&&(_.ydisp=Math.max(_.ydisp-1,0)):(_.ybase++,this.isUserScrolling||_.ydisp++)}else{const w=S-y+1;_.lines.shiftElements(y+1,w-1,-1),_.lines.set(S,d.clone())}this.isUserScrolling||(_.ydisp=_.ybase),this._onScroll.fire(_.ydisp)}scrollLines(h,p,_){const d=this.buffer;if(h<0){if(d.ydisp===0)return;this.isUserScrolling=!0}else h+d.ydisp>=d.ybase&&(this.isUserScrolling=!1);const y=d.ydisp;d.ydisp=Math.max(Math.min(d.ydisp+h,d.ybase),0),y!==d.ydisp&&(p||this._onScroll.fire(d.ydisp))}};r.BufferService=v=u([f(0,C.IOptionsService)],v)},7994:(c,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.CharsetService=void 0,r.CharsetService=class{constructor(){this.glevel=0,this._charsets=[]}reset(){this.charset=void 0,this._charsets=[],this.glevel=0}setgLevel(o){this.glevel=o,this.charset=this._charsets[o]}setgCharset(o,u){this._charsets[o]=u,this.glevel===o&&(this.charset=u)}}},1753:function(c,r,o){var u=this&&this.__decorate||function(d,y,S,w){var E,b=arguments.length,k=b<3?y:w===null?w=Object.getOwnPropertyDescriptor(y,S):w;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")k=Reflect.decorate(d,y,S,w);else for(var R=d.length-1;R>=0;R--)(E=d[R])&&(k=(b<3?E(k):b>3?E(y,S,k):E(y,S))||k);return b>3&&k&&Object.defineProperty(y,S,k),k},f=this&&this.__param||function(d,y){return function(S,w){y(S,w,d)}};Object.defineProperty(r,"__esModule",{value:!0}),r.CoreMouseService=void 0;const l=o(2585),m=o(8460),g=o(844),C={NONE:{events:0,restrict:()=>!1},X10:{events:1,restrict:d=>d.button!==4&&d.action===1&&(d.ctrl=!1,d.alt=!1,d.shift=!1,!0)},VT200:{events:19,restrict:d=>d.action!==32},DRAG:{events:23,restrict:d=>d.action!==32||d.button!==3},ANY:{events:31,restrict:d=>!0}};function v(d,y){let S=(d.ctrl?16:0)|(d.shift?4:0)|(d.alt?8:0);return d.button===4?(S|=64,S|=d.action):(S|=3&d.button,4&d.button&&(S|=64),8&d.button&&(S|=128),d.action===32?S|=32:d.action!==0||y||(S|=3)),S}const h=String.fromCharCode,p={DEFAULT:d=>{const y=[v(d,!1)+32,d.col+32,d.row+32];return y[0]>255||y[1]>255||y[2]>255?"":`\x1B[M${h(y[0])}${h(y[1])}${h(y[2])}`},SGR:d=>{const y=d.action===0&&d.button!==4?"m":"M";return`\x1B[<${v(d,!0)};${d.col};${d.row}${y}`},SGR_PIXELS:d=>{const y=d.action===0&&d.button!==4?"m":"M";return`\x1B[<${v(d,!0)};${d.x};${d.y}${y}`}};let _=r.CoreMouseService=class extends g.Disposable{constructor(d,y){super(),this._bufferService=d,this._coreService=y,this._protocols={},this._encodings={},this._activeProtocol="",this._activeEncoding="",this._lastEvent=null,this._onProtocolChange=this.register(new m.EventEmitter),this.onProtocolChange=this._onProtocolChange.event;for(const S of Object.keys(C))this.addProtocol(S,C[S]);for(const S of Object.keys(p))this.addEncoding(S,p[S]);this.reset()}addProtocol(d,y){this._protocols[d]=y}addEncoding(d,y){this._encodings[d]=y}get activeProtocol(){return this._activeProtocol}get areMouseEventsActive(){return this._protocols[this._activeProtocol].events!==0}set activeProtocol(d){if(!this._protocols[d])throw new Error(`unknown protocol "${d}"`);this._activeProtocol=d,this._onProtocolChange.fire(this._protocols[d].events)}get activeEncoding(){return this._activeEncoding}set activeEncoding(d){if(!this._encodings[d])throw new Error(`unknown encoding "${d}"`);this._activeEncoding=d}reset(){this.activeProtocol="NONE",this.activeEncoding="DEFAULT",this._lastEvent=null}triggerMouseEvent(d){if(d.col<0||d.col>=this._bufferService.cols||d.row<0||d.row>=this._bufferService.rows||d.button===4&&d.action===32||d.button===3&&d.action!==32||d.button!==4&&(d.action===2||d.action===3)||(d.col++,d.row++,d.action===32&&this._lastEvent&&this._equalEvents(this._lastEvent,d,this._activeEncoding==="SGR_PIXELS"))||!this._protocols[this._activeProtocol].restrict(d))return!1;const y=this._encodings[this._activeEncoding](d);return y&&(this._activeEncoding==="DEFAULT"?this._coreService.triggerBinaryEvent(y):this._coreService.triggerDataEvent(y,!0)),this._lastEvent=d,!0}explainEvents(d){return{down:!!(1&d),up:!!(2&d),drag:!!(4&d),move:!!(8&d),wheel:!!(16&d)}}_equalEvents(d,y,S){if(S){if(d.x!==y.x||d.y!==y.y)return!1}else if(d.col!==y.col||d.row!==y.row)return!1;return d.button===y.button&&d.action===y.action&&d.ctrl===y.ctrl&&d.alt===y.alt&&d.shift===y.shift}};r.CoreMouseService=_=u([f(0,l.IBufferService),f(1,l.ICoreService)],_)},6975:function(c,r,o){var u=this&&this.__decorate||function(_,d,y,S){var w,E=arguments.length,b=E<3?d:S===null?S=Object.getOwnPropertyDescriptor(d,y):S;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")b=Reflect.decorate(_,d,y,S);else for(var k=_.length-1;k>=0;k--)(w=_[k])&&(b=(E<3?w(b):E>3?w(d,y,b):w(d,y))||b);return E>3&&b&&Object.defineProperty(d,y,b),b},f=this&&this.__param||function(_,d){return function(y,S){d(y,S,_)}};Object.defineProperty(r,"__esModule",{value:!0}),r.CoreService=void 0;const l=o(1439),m=o(8460),g=o(844),C=o(2585),v=Object.freeze({insertMode:!1}),h=Object.freeze({applicationCursorKeys:!1,applicationKeypad:!1,bracketedPasteMode:!1,origin:!1,reverseWraparound:!1,sendFocus:!1,wraparound:!0});let p=r.CoreService=class extends g.Disposable{constructor(_,d,y){super(),this._bufferService=_,this._logService=d,this._optionsService=y,this.isCursorInitialized=!1,this.isCursorHidden=!1,this._onData=this.register(new m.EventEmitter),this.onData=this._onData.event,this._onUserInput=this.register(new m.EventEmitter),this.onUserInput=this._onUserInput.event,this._onBinary=this.register(new m.EventEmitter),this.onBinary=this._onBinary.event,this._onRequestScrollToBottom=this.register(new m.EventEmitter),this.onRequestScrollToBottom=this._onRequestScrollToBottom.event,this.modes=(0,l.clone)(v),this.decPrivateModes=(0,l.clone)(h)}reset(){this.modes=(0,l.clone)(v),this.decPrivateModes=(0,l.clone)(h)}triggerDataEvent(_,d=!1){if(this._optionsService.rawOptions.disableStdin)return;const y=this._bufferService.buffer;d&&this._optionsService.rawOptions.scrollOnUserInput&&y.ybase!==y.ydisp&&this._onRequestScrollToBottom.fire(),d&&this._onUserInput.fire(),this._logService.debug(`sending data "${_}"`,(()=>_.split("").map((S=>S.charCodeAt(0))))),this._onData.fire(_)}triggerBinaryEvent(_){this._optionsService.rawOptions.disableStdin||(this._logService.debug(`sending binary "${_}"`,(()=>_.split("").map((d=>d.charCodeAt(0))))),this._onBinary.fire(_))}};r.CoreService=p=u([f(0,C.IBufferService),f(1,C.ILogService),f(2,C.IOptionsService)],p)},9074:(c,r,o)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.DecorationService=void 0;const u=o(8055),f=o(8460),l=o(844),m=o(6106);let g=0,C=0;class v extends l.Disposable{get decorations(){return this._decorations.values()}constructor(){super(),this._decorations=new m.SortedList((_=>_?.marker.line)),this._onDecorationRegistered=this.register(new f.EventEmitter),this.onDecorationRegistered=this._onDecorationRegistered.event,this._onDecorationRemoved=this.register(new f.EventEmitter),this.onDecorationRemoved=this._onDecorationRemoved.event,this.register((0,l.toDisposable)((()=>this.reset())))}registerDecoration(_){if(_.marker.isDisposed)return;const d=new h(_);if(d){const y=d.marker.onDispose((()=>d.dispose()));d.onDispose((()=>{d&&(this._decorations.delete(d)&&this._onDecorationRemoved.fire(d),y.dispose())})),this._decorations.insert(d),this._onDecorationRegistered.fire(d)}return d}reset(){for(const _ of this._decorations.values())_.dispose();this._decorations.clear()}*getDecorationsAtCell(_,d,y){let S=0,w=0;for(const E of this._decorations.getKeyIterator(d))S=E.options.x??0,w=S+(E.options.width??1),_>=S&&_<w&&(!y||(E.options.layer??"bottom")===y)&&(yield E)}forEachDecorationAtCell(_,d,y,S){this._decorations.forEachByKey(d,(w=>{g=w.options.x??0,C=g+(w.options.width??1),_>=g&&_<C&&(!y||(w.options.layer??"bottom")===y)&&S(w)}))}}r.DecorationService=v;class h extends l.Disposable{get isDisposed(){return this._isDisposed}get backgroundColorRGB(){return this._cachedBg===null&&(this.options.backgroundColor?this._cachedBg=u.css.toColor(this.options.backgroundColor):this._cachedBg=void 0),this._cachedBg}get foregroundColorRGB(){return this._cachedFg===null&&(this.options.foregroundColor?this._cachedFg=u.css.toColor(this.options.foregroundColor):this._cachedFg=void 0),this._cachedFg}constructor(_){super(),this.options=_,this.onRenderEmitter=this.register(new f.EventEmitter),this.onRender=this.onRenderEmitter.event,this._onDispose=this.register(new f.EventEmitter),this.onDispose=this._onDispose.event,this._cachedBg=null,this._cachedFg=null,this.marker=_.marker,this.options.overviewRulerOptions&&!this.options.overviewRulerOptions.position&&(this.options.overviewRulerOptions.position="full")}dispose(){this._onDispose.fire(),super.dispose()}}},4348:(c,r,o)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.InstantiationService=r.ServiceCollection=void 0;const u=o(2585),f=o(8343);class l{constructor(...g){this._entries=new Map;for(const[C,v]of g)this.set(C,v)}set(g,C){const v=this._entries.get(g);return this._entries.set(g,C),v}forEach(g){for(const[C,v]of this._entries.entries())g(C,v)}has(g){return this._entries.has(g)}get(g){return this._entries.get(g)}}r.ServiceCollection=l,r.InstantiationService=class{constructor(){this._services=new l,this._services.set(u.IInstantiationService,this)}setService(m,g){this._services.set(m,g)}getService(m){return this._services.get(m)}createInstance(m,...g){const C=(0,f.getServiceDependencies)(m).sort(((p,_)=>p.index-_.index)),v=[];for(const p of C){const _=this._services.get(p.id);if(!_)throw new Error(`[createInstance] ${m.name} depends on UNKNOWN service ${p.id}.`);v.push(_)}const h=C.length>0?C[0].index:g.length;if(g.length!==h)throw new Error(`[createInstance] First service dependency of ${m.name} at position ${h+1} conflicts with ${g.length} static arguments`);return new m(...g,...v)}}},7866:function(c,r,o){var u=this&&this.__decorate||function(h,p,_,d){var y,S=arguments.length,w=S<3?p:d===null?d=Object.getOwnPropertyDescriptor(p,_):d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")w=Reflect.decorate(h,p,_,d);else for(var E=h.length-1;E>=0;E--)(y=h[E])&&(w=(S<3?y(w):S>3?y(p,_,w):y(p,_))||w);return S>3&&w&&Object.defineProperty(p,_,w),w},f=this&&this.__param||function(h,p){return function(_,d){p(_,d,h)}};Object.defineProperty(r,"__esModule",{value:!0}),r.traceCall=r.setTraceLogger=r.LogService=void 0;const l=o(844),m=o(2585),g={trace:m.LogLevelEnum.TRACE,debug:m.LogLevelEnum.DEBUG,info:m.LogLevelEnum.INFO,warn:m.LogLevelEnum.WARN,error:m.LogLevelEnum.ERROR,off:m.LogLevelEnum.OFF};let C,v=r.LogService=class extends l.Disposable{get logLevel(){return this._logLevel}constructor(h){super(),this._optionsService=h,this._logLevel=m.LogLevelEnum.OFF,this._updateLogLevel(),this.register(this._optionsService.onSpecificOptionChange("logLevel",(()=>this._updateLogLevel()))),C=this}_updateLogLevel(){this._logLevel=g[this._optionsService.rawOptions.logLevel]}_evalLazyOptionalParams(h){for(let p=0;p<h.length;p++)typeof h[p]=="function"&&(h[p]=h[p]())}_log(h,p,_){this._evalLazyOptionalParams(_),h.call(console,(this._optionsService.options.logger?"":"xterm.js: ")+p,..._)}trace(h,...p){this._logLevel<=m.LogLevelEnum.TRACE&&this._log(this._optionsService.options.logger?.trace.bind(this._optionsService.options.logger)??console.log,h,p)}debug(h,...p){this._logLevel<=m.LogLevelEnum.DEBUG&&this._log(this._optionsService.options.logger?.debug.bind(this._optionsService.options.logger)??console.log,h,p)}info(h,...p){this._logLevel<=m.LogLevelEnum.INFO&&this._log(this._optionsService.options.logger?.info.bind(this._optionsService.options.logger)??console.info,h,p)}warn(h,...p){this._logLevel<=m.LogLevelEnum.WARN&&this._log(this._optionsService.options.logger?.warn.bind(this._optionsService.options.logger)??console.warn,h,p)}error(h,...p){this._logLevel<=m.LogLevelEnum.ERROR&&this._log(this._optionsService.options.logger?.error.bind(this._optionsService.options.logger)??console.error,h,p)}};r.LogService=v=u([f(0,m.IOptionsService)],v),r.setTraceLogger=function(h){C=h},r.traceCall=function(h,p,_){if(typeof _.value!="function")throw new Error("not supported");const d=_.value;_.value=function(...y){if(C.logLevel!==m.LogLevelEnum.TRACE)return d.apply(this,y);C.trace(`GlyphRenderer#${d.name}(${y.map((w=>JSON.stringify(w))).join(", ")})`);const S=d.apply(this,y);return C.trace(`GlyphRenderer#${d.name} return`,S),S}}},7302:(c,r,o)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.OptionsService=r.DEFAULT_OPTIONS=void 0;const u=o(8460),f=o(844),l=o(6114);r.DEFAULT_OPTIONS={cols:80,rows:24,cursorBlink:!1,cursorStyle:"block",cursorWidth:1,cursorInactiveStyle:"outline",customGlyphs:!0,drawBoldTextInBrightColors:!0,documentOverride:null,fastScrollModifier:"alt",fastScrollSensitivity:5,fontFamily:"courier-new, courier, monospace",fontSize:15,fontWeight:"normal",fontWeightBold:"bold",ignoreBracketedPasteMode:!1,lineHeight:1,letterSpacing:0,linkHandler:null,logLevel:"info",logger:null,scrollback:1e3,scrollOnUserInput:!0,scrollSensitivity:1,screenReaderMode:!1,smoothScrollDuration:0,macOptionIsMeta:!1,macOptionClickForcesSelection:!1,minimumContrastRatio:1,disableStdin:!1,allowProposedApi:!1,allowTransparency:!1,tabStopWidth:8,theme:{},rescaleOverlappingGlyphs:!1,rightClickSelectsWord:l.isMac,windowOptions:{},windowsMode:!1,windowsPty:{},wordSeparator:" ()[]{}',\"`",altClickMovesCursor:!0,convertEol:!1,termName:"xterm",cancelEvents:!1,overviewRulerWidth:0};const m=["normal","bold","100","200","300","400","500","600","700","800","900"];class g extends f.Disposable{constructor(v){super(),this._onOptionChange=this.register(new u.EventEmitter),this.onOptionChange=this._onOptionChange.event;const h={...r.DEFAULT_OPTIONS};for(const p in v)if(p in h)try{const _=v[p];h[p]=this._sanitizeAndValidateOption(p,_)}catch(_){console.error(_)}this.rawOptions=h,this.options={...h},this._setupOptions(),this.register((0,f.toDisposable)((()=>{this.rawOptions.linkHandler=null,this.rawOptions.documentOverride=null})))}onSpecificOptionChange(v,h){return this.onOptionChange((p=>{p===v&&h(this.rawOptions[v])}))}onMultipleOptionChange(v,h){return this.onOptionChange((p=>{v.indexOf(p)!==-1&&h()}))}_setupOptions(){const v=p=>{if(!(p in r.DEFAULT_OPTIONS))throw new Error(`No option with key "${p}"`);return this.rawOptions[p]},h=(p,_)=>{if(!(p in r.DEFAULT_OPTIONS))throw new Error(`No option with key "${p}"`);_=this._sanitizeAndValidateOption(p,_),this.rawOptions[p]!==_&&(this.rawOptions[p]=_,this._onOptionChange.fire(p))};for(const p in this.rawOptions){const _={get:v.bind(this,p),set:h.bind(this,p)};Object.defineProperty(this.options,p,_)}}_sanitizeAndValidateOption(v,h){switch(v){case"cursorStyle":if(h||(h=r.DEFAULT_OPTIONS[v]),!(function(p){return p==="block"||p==="underline"||p==="bar"})(h))throw new Error(`"${h}" is not a valid value for ${v}`);break;case"wordSeparator":h||(h=r.DEFAULT_OPTIONS[v]);break;case"fontWeight":case"fontWeightBold":if(typeof h=="number"&&1<=h&&h<=1e3)break;h=m.includes(h)?h:r.DEFAULT_OPTIONS[v];break;case"cursorWidth":h=Math.floor(h);case"lineHeight":case"tabStopWidth":if(h<1)throw new Error(`${v} cannot be less than 1, value: ${h}`);break;case"minimumContrastRatio":h=Math.max(1,Math.min(21,Math.round(10*h)/10));break;case"scrollback":if((h=Math.min(h,4294967295))<0)throw new Error(`${v} cannot be less than 0, value: ${h}`);break;case"fastScrollSensitivity":case"scrollSensitivity":if(h<=0)throw new Error(`${v} cannot be less than or equal to 0, value: ${h}`);break;case"rows":case"cols":if(!h&&h!==0)throw new Error(`${v} must be numeric, value: ${h}`);break;case"windowsPty":h=h??{}}return h}}r.OptionsService=g},2660:function(c,r,o){var u=this&&this.__decorate||function(g,C,v,h){var p,_=arguments.length,d=_<3?C:h===null?h=Object.getOwnPropertyDescriptor(C,v):h;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(g,C,v,h);else for(var y=g.length-1;y>=0;y--)(p=g[y])&&(d=(_<3?p(d):_>3?p(C,v,d):p(C,v))||d);return _>3&&d&&Object.defineProperty(C,v,d),d},f=this&&this.__param||function(g,C){return function(v,h){C(v,h,g)}};Object.defineProperty(r,"__esModule",{value:!0}),r.OscLinkService=void 0;const l=o(2585);let m=r.OscLinkService=class{constructor(g){this._bufferService=g,this._nextId=1,this._entriesWithId=new Map,this._dataByLinkId=new Map}registerLink(g){const C=this._bufferService.buffer;if(g.id===void 0){const y=C.addMarker(C.ybase+C.y),S={data:g,id:this._nextId++,lines:[y]};return y.onDispose((()=>this._removeMarkerFromLink(S,y))),this._dataByLinkId.set(S.id,S),S.id}const v=g,h=this._getEntryIdKey(v),p=this._entriesWithId.get(h);if(p)return this.addLineToLink(p.id,C.ybase+C.y),p.id;const _=C.addMarker(C.ybase+C.y),d={id:this._nextId++,key:this._getEntryIdKey(v),data:v,lines:[_]};return _.onDispose((()=>this._removeMarkerFromLink(d,_))),this._entriesWithId.set(d.key,d),this._dataByLinkId.set(d.id,d),d.id}addLineToLink(g,C){const v=this._dataByLinkId.get(g);if(v&&v.lines.every((h=>h.line!==C))){const h=this._bufferService.buffer.addMarker(C);v.lines.push(h),h.onDispose((()=>this._removeMarkerFromLink(v,h)))}}getLinkData(g){return this._dataByLinkId.get(g)?.data}_getEntryIdKey(g){return`${g.id};;${g.uri}`}_removeMarkerFromLink(g,C){const v=g.lines.indexOf(C);v!==-1&&(g.lines.splice(v,1),g.lines.length===0&&(g.data.id!==void 0&&this._entriesWithId.delete(g.key),this._dataByLinkId.delete(g.id)))}};r.OscLinkService=m=u([f(0,l.IBufferService)],m)},8343:(c,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.createDecorator=r.getServiceDependencies=r.serviceRegistry=void 0;const o="di$target",u="di$dependencies";r.serviceRegistry=new Map,r.getServiceDependencies=function(f){return f[u]||[]},r.createDecorator=function(f){if(r.serviceRegistry.has(f))return r.serviceRegistry.get(f);const l=function(m,g,C){if(arguments.length!==3)throw new Error("@IServiceName-decorator can only be used to decorate a parameter");(function(v,h,p){h[o]===h?h[u].push({id:v,index:p}):(h[u]=[{id:v,index:p}],h[o]=h)})(l,m,C)};return l.toString=()=>f,r.serviceRegistry.set(f,l),l}},2585:(c,r,o)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.IDecorationService=r.IUnicodeService=r.IOscLinkService=r.IOptionsService=r.ILogService=r.LogLevelEnum=r.IInstantiationService=r.ICharsetService=r.ICoreService=r.ICoreMouseService=r.IBufferService=void 0;const u=o(8343);var f;r.IBufferService=(0,u.createDecorator)("BufferService"),r.ICoreMouseService=(0,u.createDecorator)("CoreMouseService"),r.ICoreService=(0,u.createDecorator)("CoreService"),r.ICharsetService=(0,u.createDecorator)("CharsetService"),r.IInstantiationService=(0,u.createDecorator)("InstantiationService"),(function(l){l[l.TRACE=0]="TRACE",l[l.DEBUG=1]="DEBUG",l[l.INFO=2]="INFO",l[l.WARN=3]="WARN",l[l.ERROR=4]="ERROR",l[l.OFF=5]="OFF"})(f||(r.LogLevelEnum=f={})),r.ILogService=(0,u.createDecorator)("LogService"),r.IOptionsService=(0,u.createDecorator)("OptionsService"),r.IOscLinkService=(0,u.createDecorator)("OscLinkService"),r.IUnicodeService=(0,u.createDecorator)("UnicodeService"),r.IDecorationService=(0,u.createDecorator)("DecorationService")},1480:(c,r,o)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.UnicodeService=void 0;const u=o(8460),f=o(225);class l{static extractShouldJoin(g){return(1&g)!=0}static extractWidth(g){return g>>1&3}static extractCharKind(g){return g>>3}static createPropertyValue(g,C,v=!1){return(16777215&g)<<3|(3&C)<<1|(v?1:0)}constructor(){this._providers=Object.create(null),this._active="",this._onChange=new u.EventEmitter,this.onChange=this._onChange.event;const g=new f.UnicodeV6;this.register(g),this._active=g.version,this._activeProvider=g}dispose(){this._onChange.dispose()}get versions(){return Object.keys(this._providers)}get activeVersion(){return this._active}set activeVersion(g){if(!this._providers[g])throw new Error(`unknown Unicode version "${g}"`);this._active=g,this._activeProvider=this._providers[g],this._onChange.fire(g)}register(g){this._providers[g.version]=g}wcwidth(g){return this._activeProvider.wcwidth(g)}getStringCellWidth(g){let C=0,v=0;const h=g.length;for(let p=0;p<h;++p){let _=g.charCodeAt(p);if(55296<=_&&_<=56319){if(++p>=h)return C+this.wcwidth(_);const S=g.charCodeAt(p);56320<=S&&S<=57343?_=1024*(_-55296)+S-56320+65536:C+=this.wcwidth(S)}const d=this.charProperties(_,v);let y=l.extractWidth(d);l.extractShouldJoin(d)&&(y-=l.extractWidth(v)),C+=y,v=d}return C}charProperties(g,C){return this._activeProvider.charProperties(g,C)}}r.UnicodeService=l}},s={};function n(c){var r=s[c];if(r!==void 0)return r.exports;var o=s[c]={exports:{}};return i[c].call(o.exports,o,o.exports,n),o.exports}var a={};return(()=>{var c=a;Object.defineProperty(c,"__esModule",{value:!0}),c.Terminal=void 0;const r=n(9042),o=n(3236),u=n(844),f=n(5741),l=n(8285),m=n(7975),g=n(7090),C=["cols","rows"];class v extends u.Disposable{constructor(p){super(),this._core=this.register(new o.Terminal(p)),this._addonManager=this.register(new f.AddonManager),this._publicOptions={...this._core.options};const _=y=>this._core.options[y],d=(y,S)=>{this._checkReadonlyOptions(y),this._core.options[y]=S};for(const y in this._core.options){const S={get:_.bind(this,y),set:d.bind(this,y)};Object.defineProperty(this._publicOptions,y,S)}}_checkReadonlyOptions(p){if(C.includes(p))throw new Error(`Option "${p}" can only be set in the constructor`)}_checkProposedApi(){if(!this._core.optionsService.rawOptions.allowProposedApi)throw new Error("You must set the allowProposedApi option to true to use proposed API")}get onBell(){return this._core.onBell}get onBinary(){return this._core.onBinary}get onCursorMove(){return this._core.onCursorMove}get onData(){return this._core.onData}get onKey(){return this._core.onKey}get onLineFeed(){return this._core.onLineFeed}get onRender(){return this._core.onRender}get onResize(){return this._core.onResize}get onScroll(){return this._core.onScroll}get onSelectionChange(){return this._core.onSelectionChange}get onTitleChange(){return this._core.onTitleChange}get onWriteParsed(){return this._core.onWriteParsed}get element(){return this._core.element}get parser(){return this._parser||(this._parser=new m.ParserApi(this._core)),this._parser}get unicode(){return this._checkProposedApi(),new g.UnicodeApi(this._core)}get textarea(){return this._core.textarea}get rows(){return this._core.rows}get cols(){return this._core.cols}get buffer(){return this._buffer||(this._buffer=this.register(new l.BufferNamespaceApi(this._core))),this._buffer}get markers(){return this._checkProposedApi(),this._core.markers}get modes(){const p=this._core.coreService.decPrivateModes;let _="none";switch(this._core.coreMouseService.activeProtocol){case"X10":_="x10";break;case"VT200":_="vt200";break;case"DRAG":_="drag";break;case"ANY":_="any"}return{applicationCursorKeysMode:p.applicationCursorKeys,applicationKeypadMode:p.applicationKeypad,bracketedPasteMode:p.bracketedPasteMode,insertMode:this._core.coreService.modes.insertMode,mouseTrackingMode:_,originMode:p.origin,reverseWraparoundMode:p.reverseWraparound,sendFocusMode:p.sendFocus,wraparoundMode:p.wraparound}}get options(){return this._publicOptions}set options(p){for(const _ in p)this._publicOptions[_]=p[_]}blur(){this._core.blur()}focus(){this._core.focus()}input(p,_=!0){this._core.input(p,_)}resize(p,_){this._verifyIntegers(p,_),this._core.resize(p,_)}open(p){this._core.open(p)}attachCustomKeyEventHandler(p){this._core.attachCustomKeyEventHandler(p)}attachCustomWheelEventHandler(p){this._core.attachCustomWheelEventHandler(p)}registerLinkProvider(p){return this._core.registerLinkProvider(p)}registerCharacterJoiner(p){return this._checkProposedApi(),this._core.registerCharacterJoiner(p)}deregisterCharacterJoiner(p){this._checkProposedApi(),this._core.deregisterCharacterJoiner(p)}registerMarker(p=0){return this._verifyIntegers(p),this._core.registerMarker(p)}registerDecoration(p){return this._checkProposedApi(),this._verifyPositiveIntegers(p.x??0,p.width??0,p.height??0),this._core.registerDecoration(p)}hasSelection(){return this._core.hasSelection()}select(p,_,d){this._verifyIntegers(p,_,d),this._core.select(p,_,d)}getSelection(){return this._core.getSelection()}getSelectionPosition(){return this._core.getSelectionPosition()}clearSelection(){this._core.clearSelection()}selectAll(){this._core.selectAll()}selectLines(p,_){this._verifyIntegers(p,_),this._core.selectLines(p,_)}dispose(){super.dispose()}scrollLines(p){this._verifyIntegers(p),this._core.scrollLines(p)}scrollPages(p){this._verifyIntegers(p),this._core.scrollPages(p)}scrollToTop(){this._core.scrollToTop()}scrollToBottom(){this._core.scrollToBottom()}scrollToLine(p){this._verifyIntegers(p),this._core.scrollToLine(p)}clear(){this._core.clear()}write(p,_){this._core.write(p,_)}writeln(p,_){this._core.write(p),this._core.write(`\r
`,_)}paste(p){this._core.paste(p)}refresh(p,_){this._verifyIntegers(p,_),this._core.refresh(p,_)}reset(){this._core.reset()}clearTextureAtlas(){this._core.clearTextureAtlas()}loadAddon(p){this._addonManager.loadAddon(this,p)}static get strings(){return r}_verifyIntegers(...p){for(const _ of p)if(_===1/0||isNaN(_)||_%1!=0)throw new Error("This API only accepts integers")}_verifyPositiveIntegers(...p){for(const _ of p)if(_&&(_===1/0||isNaN(_)||_%1!=0||_<0))throw new Error("This API only accepts positive integers")}}c.Terminal=v})(),a})()))})(tn)),tn.exports}var qp=Hp();let er={exports:{}};function ca(e,t){return(e||e===0?e+"":"").padEnd(t," ")}function be(e,t,i,s){return new Proxy({},{get:function(n,a){n=new e(t.buffer,i,s);const c=n[a];return typeof c=="function"?c.bind(n):c},set:function(n,a,c){return new e(t.buffer,i,s)[a]=c,!0}})}function A(e,t){return e=(e?e.toString(16):"").toUpperCase(),"0x"+(e||e===0?e+"":"").padStart(t||1,"0")}var tr;if(typeof crypto<"u"&&crypto.getRandomValues){const e=new Int32Array(1);tr=function(){return crypto.getRandomValues(e),e[0]}}else if(typeof require<"u"){const e=require("crypto");tr=function(){return e.randomBytes(4).readInt32LE(0)}}else typeof process<"u"&&nn(()=>import("../chunks/BIHI7g3E.js"),[],import.meta.url).then(e=>{tr=function(){return e.randomBytes(4).readInt32LE(0)}});var As;if(typeof Math.clz32=="function")As=function(e){return 31-Math.clz32(e)};else{for(var ds=new Int8Array(256),fs=0,la=-2;256>fs;fs++)fs&fs-1||la++,ds[fs]=la;As=function(e){e>>>=0;var t=e>>>16;if(t){var i=t>>>8;return i?24+ds[i]:16+ds[t]}return(i=e>>>8)?8+ds[i]:ds[e]}}function Wp(e){return 1>=e?1:1<<1+As(e-1)}function bs(e){var t=new Uint8Array(e),i,s;this.length=0,this.push=function(n){this.length!==e&&this.length++,t[s]=n,s=s+1&e-1},this.shift=function(){if(this.length){var n=t[i];return i=i+1&e-1,this.length--,n}return-1},this.peek=function(){return this.length?t[i]:-1},this.clear=function(){this.length=s=i=0},this.clear()}function Pi(e){this.size=e,this.data=new Float32Array(e),this.length=this.end=this.start=0}Pi.prototype.push=function(e){this.length===this.size?this.start=this.start+1&this.size-1:this.length++,this.data[this.end]=e,this.end=this.end+1&this.size-1};Pi.prototype.shift=function(){if(this.length){var e=this.data[this.start];return this.start=this.start+1&this.size-1,this.length--,e}};Pi.prototype.shift_block=function(e){var t=new Float32Array(e);e>this.length&&(e=this.length);var i=this.start+e,s=this.data.subarray(this.start,i);return t.set(s),i>=this.size&&(i-=this.size,t.set(this.data.subarray(0,i),s.length)),this.start=i,this.length-=e,t};Pi.prototype.peek=function(){if(this.length)return this.data[this.start]};Pi.prototype.clear=function(){this.length=this.end=this.start=0};function Is(e){typeof e=="number"?this.view=new Uint8Array(e+7>>3):e instanceof ArrayBuffer&&(this.view=new Uint8Array(e))}Is.prototype.set=function(e,t){const i=e>>3;e=1<<(e&7),this.view[i]=t?this.view[i]|e:this.view[i]&~e};Is.prototype.get=function(e){return this.view[e>>3]>>(e&7)&1};Is.prototype.get_buffer=function(){return this.view.buffer};var xt,fn;if(typeof XMLHttpRequest>"u"||typeof process<"u"&&process.versions&&process.versions.node){let e;xt=async function(t,i){if(e||(e=await nn(()=>import("../chunks/BIHI7g3E.js"),[],import.meta.url)),i.range){t=await e.open(t,"r");const s=Buffer.allocUnsafe(i.range.length);try{await t.read({buffer:s,position:i.range.start})}finally{await t.close()}i.done&&i.done(new Uint8Array(s))}else t=await e.readFile(t,{encoding:i.as_json?"utf-8":null}),t=i.as_json?JSON.parse(t):new Uint8Array(t).buffer,i.done(t)},fn=async function(t){return e||(e=await nn(()=>import("../chunks/BIHI7g3E.js"),[],import.meta.url)),(await e.stat(t)).size}}else xt=async function(e,t,i){function s(){const o=i||0;setTimeout(()=>{xt(e,t,o+1)},1e3*([1,1,2,3,5,8,13,21][o]||34))}var n=new XMLHttpRequest;if(n.open(t.method||"get",e,!0),n.responseType=t.as_json?"json":"arraybuffer",t.headers)for(var a=Object.keys(t.headers),c=0;c<a.length;c++){var r=a[c];n.setRequestHeader(r,t.headers[r])}t.range&&(a=t.range.start,n.setRequestHeader("Range","bytes="+a+"-"+(a+t.range.length-1)),n.setRequestHeader("X-Accept-Encoding","identity"),n.onreadystatechange=function(){n.status===200&&(console.error("Server sent full file in response to ranged request, aborting",{filename:e}),n.abort())}),n.onload=function(){if(n.readyState===4){if(n.status!==200&&n.status!==206)console.error("Loading the image "+e+" failed (status %d)",n.status),500<=n.status&&600>n.status&&s();else if(n.response){if(t.range){const o=n.getResponseHeader("Content-Encoding");o&&o!=="identity"&&console.error("Server sent Content-Encoding in response to ranged request",{filename:e,enc:o})}t.done&&t.done(n.response,n)}}},n.onerror=function(o){console.error("Loading the image "+e+" failed",o),s()},t.progress&&(n.onprogress=function(o){t.progress(o)}),n.send(null)},fn=async function(e){return new Promise((t,i)=>{xt(e,{done:(s,n)=>{s=n.getResponseHeader("Content-Range")||"",(n=s.match(/\/(\d+)\s*$/))?t(+n[1]):i(Error("`Range: bytes=...` header not supported (Got `"+s+"`)"))},headers:{Range:"bytes=0-0","X-Accept-Encoding":"identity"}})})};function pn(e,t,i){return String.fromCharCode(...new Uint8Array(e.buffer,t>>>0,i>>>0))}const wi={cp437:"  !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_`abcdefghijklmnopqrstuvwxyz{|}~ ",cp858:" "};wi.cp858=wi.cp437.slice(0,128)+wi.cp858;wi.ascii=wi.cp437.split("").map((e,t)=>31<t&&128>t?e:".").join("");function dh(e){return e&&wi[e]?wi[e]:wi.cp437}function $p(e,t){function i(j){return j=j.toString(16),"#"+"0".repeat(6-j.length)+j}function s(j){var G=256*R,Y=8*k,M=w?w.canvas:null;M&&M.width===G&&M.height===Y||(M?(M.width=G,M.height=Y):(M=new OffscreenCanvas(G,Y),w=M.getContext("2d")),E=w.createImageData(G,Y));const T=E.data;let K=0,H;Y=P?function(he){H=H||he,T[K+3]=he,T[K+7]=he,K+=8}:function(he){H=H||he,T[K+3]=he,K+=4},M=32-k;const X=G*(k-1)*4;G=4*(R-G*k);const Q=1020*R;for(let he=0,me=0;2048>he;++he,me+=M,K+=G){const fe=he%256;he&&!fe&&(K+=X),H=!1;for(let Ae=0;Ae<k;++Ae,++me,K+=Q){const ue=j[me];for(let ve=128;0<ve;ve>>=1)Y(ue&ve?255:0);O&&Y(L&&192<=fe&&223>=fe&&ue&1?255:0)}b[he]=H?1:0}w.putImageData(E,0,0)}function n(j,G,Y,M){if(G&&Y){j.style.width="",j.style.height="",M&&(j.style.transform="");var T=j.getBoundingClientRect();M?j.style.transform=(G===1?"":" scaleX("+G+")")+(Y===1?"":" scaleY("+Y+")"):(G%1===0&&Y%1===0?(c.style.imageRendering="crisp-edges",c.style.imageRendering="pixelated",c.style["-ms-interpolation-mode"]="nearest-neighbor"):(c.style.imageRendering="",c.style["-ms-interpolation-mode"]=""),M=window.devicePixelRatio||1,M%1!==0&&(G/=M,Y/=M)),G!==1&&(j.style.width=T.width*G+"px"),Y!==1&&(j.style.height=T.height*Y+"px")}}const a=e.container;this.screen_fill_buffer=t,console.assert(a,"options.container must be provided"),this.FLAG_BLINKING=1,this.FLAG_FONT_PAGE_B=2;var c=a.getElementsByTagName("canvas")[0],r=c.getContext("2d",{alpha:!1}),o=a.getElementsByTagName("div")[0],u=document.createElement("div"),f,l,m=e.scale!==void 0?e.scale:1,g=e.scale!==void 0?e.scale:1,C=1,v,h,p,_,d,y,S,w,E,b=new Int8Array(2048),k,R,O,P,L,q=0,J=0,re,ie=0,ee,x,B,U=dh(e.encoding),z=0,se=!1;this.init=function(){u.classList.add("cursor"),u.style.position="absolute",u.style.backgroundColor="#ccc",u.style.width="7px",u.style.display="inline-block",this.set_mode(!1),this.set_size_text(80,25),h===2&&this.set_size_graphical(720,400,720,400),this.set_scale(m,g),this.timer()},this.make_screenshot=function(){const j=new Image;if(h===1||h===2)j.src=c.toDataURL("image/png");else{const G=[9,16],Y=document.createElement("canvas");Y.width=_*G[0],Y.height=d*G[1];const M=Y.getContext("2d");M.imageSmoothingEnabled=!1,M.font=window.getComputedStyle(o).font,M.textBaseline="top";for(let T=0;T<d;T++)for(let K=0;K<_;K++){const H=4*(T*_+K),X=p[H+0],Q=p[H+3];M.fillStyle=i(p[H+2]),M.fillRect(K*G[0],T*G[1],G[0],G[1]),M.fillStyle=i(Q),M.fillText(U[X],K*G[0],T*G[1])}u.style.display!=="none"&&f<d&&l<_&&(M.fillStyle=u.style.backgroundColor,M.fillRect(l*G[0],f*G[1]+parseInt(u.style.marginTop,10),parseInt(u.style.width,10),parseInt(u.style.height,10))),j.src=Y.toDataURL("image/png")}return j},this.put_char=function(j,G,Y,M,T,K){G=4*(j*_+G),p[G+0]=Y,p[G+1]=M,p[G+2]=T,p[G+3]=K,v[j]=1},this.timer=function(){z=requestAnimationFrame(()=>this.update_screen())},this.update_screen=function(){se||(h===0?this.update_text():h===1?this.update_graphical():this.update_graphical_text()),this.timer()},this.update_text=function(){for(var j=0;j<d;j++)v[j]&&(this.text_update_row(j),v[j]=0)},this.update_graphical=function(){this.screen_fill_buffer()},this.update_graphical_text=function(){if(y){var j=performance.now();if(266<j-ie){re=!re,B&&(v[f]=1);var G=4*_;for(let X=0,Q=0;X<d;++X)if(v[X])Q+=G;else for(var Y=0;Y<_;++Y,Q+=4)if(p[Q+1]&1){v[X]=1,Q+=G-4*Y;break}ie=j}j=w.canvas,G=S.canvas,Y=4*_;const T=_*R,K=k;let H=0;for(let X=0,Q=0,he=0;X<d;++X,Q+=k){if(!v[X]){he+=Y;continue}++H,S.clearRect(0,K,T,k);let me,fe,Ae,ue;for(let ve=0;ve<T;ve+=R,he+=4){const Ie=p[he+0];var M=p[he+1];const et=p[he+2],$e=p[he+3],tt=M&2?J:q;M=(!(M&1)||re)&&b[(tt<<8)+Ie],Ae!==et&&(Ae!==void 0&&(y.fillStyle=i(Ae),y.fillRect(ue,Q,ve-ue,k)),Ae=et,ue=ve),me!==$e&&(me!==void 0&&(S.fillStyle=i(me),S.fillRect(fe,0,ve-fe,k)),me=$e,fe=ve),M&&S.drawImage(j,Ie*R,tt*k,R,k,ve,K,R,k)}S.fillStyle=i(me),S.fillRect(fe,0,T-fe,k),S.globalCompositeOperation="destination-in",S.drawImage(G,0,K,T,k,0,0,T,k),S.globalCompositeOperation="source-over",y.fillStyle=i(Ae),y.fillRect(ue,Q,T-ue,k),y.drawImage(G,0,0,T,k,0,Q,T,k)}H&&(re&&B&&v[f]&&(y.fillStyle=i(p[4*(f*_+l)+3]),y.fillRect(l*R,f*k+ee,R,x-ee+1)),v.fill(0)),H&&r.drawImage(y.canvas,0,0)}},this.destroy=function(){z&&(cancelAnimationFrame(z),z=0)},this.pause=function(){se=!0,u.classList.remove("blinking-cursor")},this.continue=function(){se=!1,u.classList.add("blinking-cursor")},this.set_mode=function(j){h=j?1:e.use_graphical_text?2:0,h===0?(o.style.display="block",c.style.display="none"):(o.style.display="none",c.style.display="block",h===2&&v&&v.fill(1))},this.set_font_bitmap=function(j,G,Y,M,T,K){const H=Y?16:G?9:8;(k!==j||R!==H||O!==G||P!==Y||L!==M||K)&&(K=R!==H||k!==j,k=j,R=H,O=G,P=Y,L=M,h===2&&(s(T),v.fill(1),K&&this.set_size_graphical_text()))},this.set_font_page=function(j,G){(q!==j||J!==G)&&(q=j,J=G,v.fill(1))},this.clear_screen=function(){r.fillStyle="#000",r.fillRect(0,0,c.width,c.height)},this.set_size_graphical_text=function(){if(w){var j=R*_,G=k*d,Y=2*k;y&&y.canvas.width===j&&y.canvas.height===G&&S.canvas.height===Y||(y?(y.canvas.width=j,y.canvas.height=G,S.canvas.width=j,S.canvas.height=Y):(y=new OffscreenCanvas(j,G).getContext("2d",{alpha:!1}),S=new OffscreenCanvas(j,Y).getContext("2d")),this.set_size_graphical(j,G,j,G),v.fill(1))}},this.set_size_text=function(j,G){if(j!==_||G!==d)if(v=new Int8Array(G),p=new Int32Array(j*G*4),_=j,d=G,h===0){for(;o.childNodes.length>G;)o.removeChild(o.firstChild);for(;o.childNodes.length<G;)o.appendChild(document.createElement("div"));for(j=0;j<G;j++)this.text_update_row(j);n(o,m,g,!0)}else h===2&&this.set_size_graphical_text()},this.set_size_graphical=function(j,G){c.style.display="block",c.width=j,c.height=G,r.imageSmoothingEnabled=!1,C=640>=j&&2*j<window.innerWidth*window.devicePixelRatio&&2*G<window.innerHeight*window.devicePixelRatio?2:1,n(c,m*C,g*C,!1)},this.set_scale=function(j,G){m=j,g=G,n(o,m,g,!0),n(c,m*C,g*C,!1)},this.update_cursor_scanline=function(j,G,Y){(j!==ee||G!==x||Y!==B)&&(h===0?Y?(u.style.display="inline",u.style.height=G-j+"px",u.style.marginTop=j+"px"):u.style.display="none":h===2&&f<d&&(v[f]=1),ee=j,x=G,B=Y)},this.update_cursor=function(j,G){(j!==f||G!==l)&&(j<d&&(v[j]=1),f<d&&(v[f]=1),f=j,l=G)},this.text_update_row=function(j){for(var G=4*j*_,Y,M=o.childNodes[j],T=document.createElement("div"),K=0;K<_;){var H=document.createElement("span"),X=p[G+1]&1,Q=p[G+2],he=p[G+3];for(X&&H.classList.add("blink"),H.style.backgroundColor=i(Q),H.style.color=i(he),Y="";K<_&&(p[G+1]&1)===X&&p[G+2]===Q&&p[G+3]===he;)if(Y+=U[p[G+0]],K++,G+=4,j===f){if(K===l)break;if(K===l+1){u.style.backgroundColor=H.style.color,T.appendChild(u);break}}H.textContent=Y,T.appendChild(H)}M.parentNode.replaceChild(T,M)},this.update_buffer=function(j){for(const G of j)r.putImageData(G.image_data,G.screen_x-G.buffer_x,G.screen_y-G.buffer_y,G.buffer_x,G.buffer_y,G.buffer_width,G.buffer_height)},this.get_text_screen=function(){for(var j=[],G=0;G<d;G++)j.push(this.get_text_row(G));return j},this.get_text_row=function(j){var G=j*_*4;j=G+4*_;let Y="";for(;G<j;G+=4)Y+=U[p[G]];return Y},this.init()}function it(e){this.buffer=e,this.byteLength=e.byteLength,this.onprogress=this.onload=void 0}it.prototype.load=function(){this.onload&&this.onload({buffer:this.buffer})};it.prototype.get=function(e,t,i){i(new Uint8Array(this.buffer,e,t))};it.prototype.set=function(e,t,i){new Uint8Array(this.buffer,e,t.byteLength).set(t),i()};it.prototype.get_buffer=function(e){e(this.buffer)};it.prototype.get_state=function(){const e=[];return e[0]=this.byteLength,e[1]=new Uint8Array(this.buffer),e};it.prototype.set_state=function(e){this.byteLength=e[0],this.buffer=e[1].slice().buffer};function lt(e,t,i){this.filename=e,this.byteLength=t,this.block_cache=new Map,this.block_cache_is_write=new Set,this.fixed_chunk_size=i,this.cache_reads=!!i,this.onprogress=this.onload=void 0}lt.prototype.load=async function(){this.byteLength===void 0&&(this.byteLength=await fn(this.filename)),this.onload&&this.onload(Object.create(null))};lt.prototype.get_from_cache=function(e,t){var i=t/256;e/=256;for(var s=0;s<i;s++)if(!this.block_cache.get(e+s))return;if(i===1)return this.block_cache.get(e);for(t=new Uint8Array(t),s=0;s<i;s++)t.set(this.block_cache.get(e+s),256*s);return t};lt.prototype.get=function(e,t,i){var s=this.get_from_cache(e,t);if(s)i(s);else{var n=e,a=t;this.fixed_chunk_size&&(n=e-e%this.fixed_chunk_size,a=Math.ceil((e-n+t)/this.fixed_chunk_size)*this.fixed_chunk_size),xt(this.filename,{done:(function(c){c=new Uint8Array(c),this.handle_read(n,a,c),i(n===e&&a===t?c:c.subarray(e-n,e-n+t))}).bind(this),range:{start:n,length:a}})}};lt.prototype.set=function(e,t,i){e/=256;for(var s=t.length/256,n=0;n<s;n++){var a=this.block_cache.get(e+n);if(a===void 0)a=t.slice(256*n,256*(n+1)),this.block_cache.set(e+n,a);else{const c=t.subarray(256*n,256*(n+1));a.set(c)}this.block_cache_is_write.add(e+n)}i()};lt.prototype.handle_read=function(e,t,i){e/=256,t/=256;for(var s=0;s<t;s++){const n=this.block_cache.get(e+s);n?i.set(n,256*s):this.cache_reads&&this.block_cache.set(e+s,i.slice(256*s,256*(s+1)))}};lt.prototype.get_buffer=function(e){e()};lt.prototype.get_state=function(){const e=[],t=[];for(const[i,s]of this.block_cache)this.block_cache_is_write.has(i)&&t.push([i,s]);return e[0]=t,e};lt.prototype.set_state=function(e){e=e[0],this.block_cache.clear(),this.block_cache_is_write.clear();for(const[t,i]of e)this.block_cache.set(t,i),this.block_cache_is_write.add(t)};function xi(e,t,i,s,n){const a=e.match(/\.[^\.]+(\.zst)?$/);this.extension=a?a[0]:"",this.basename=e.substring(0,e.length-this.extension.length),this.is_zstd=this.extension.endsWith(".zst"),this.basename.endsWith("/")||(this.basename+="-"),this.block_cache=new Map,this.block_cache_is_write=new Set,this.byteLength=t,this.fixed_chunk_size=i,this.partfile_alt_format=!!s,this.zstd_decompress=n,this.cache_reads=!!i,this.onprogress=this.onload=void 0}xi.prototype.load=function(){this.onload&&this.onload(Object.create(null))};xi.prototype.get=function(e,t,i){var s=this.get_from_cache(e,t);if(s)i(s);else if(this.fixed_chunk_size){const a=Math.floor(e/this.fixed_chunk_size),c=e-a*this.fixed_chunk_size,r=Math.ceil((c+t)/this.fixed_chunk_size),o=new Uint8Array(r*this.fixed_chunk_size);let u=0;for(let f=0;f<r;f++){var n=(a+f)*this.fixed_chunk_size;s=this.partfile_alt_format?this.basename+(a+f+"").padStart(8,"0")+this.extension:this.basename+n+"-"+(n+this.fixed_chunk_size)+this.extension,(n=this.get_from_cache(n,this.fixed_chunk_size))?(o.set(n,f*this.fixed_chunk_size),u++,u===r&&i(o.subarray(c,c+t))):xt(s,{done:(async function(l){l=new Uint8Array(l),this.is_zstd&&(l=await this.zstd_decompress(this.fixed_chunk_size,l),l=new Uint8Array(l)),o.set(l,f*this.fixed_chunk_size),this.handle_read((a+f)*this.fixed_chunk_size,this.fixed_chunk_size|0,l),u++,u===r&&i(o.subarray(c,c+t))}).bind(this)})}}else xt(this.basename+e+"-"+(e+t)+this.extension,{done:(function(a){a=new Uint8Array(a),this.handle_read(e,t,a),i(a)}).bind(this)})};xi.prototype.get_from_cache=lt.prototype.get_from_cache;xi.prototype.set=lt.prototype.set;xi.prototype.handle_read=lt.prototype.handle_read;xi.prototype.get_state=lt.prototype.get_state;xi.prototype.set_state=lt.prototype.set_state;function Ai(e){this.file=e,this.byteLength=e.size,1073741824<e.size&&console.warn("SyncFileBuffer: Allocating buffer of "+(e.size>>20)+" MB ..."),this.buffer=new ArrayBuffer(e.size),this.onprogress=this.onload=void 0}Ai.prototype.load=function(){this.load_next(0)};Ai.prototype.load_next=function(e){var t=new FileReader;if(t.onload=(function(s){s=new Uint8Array(s.target.result),new Uint8Array(this.buffer,e).set(s),this.load_next(e+4194304)}).bind(this),this.onprogress&&this.onprogress({loaded:e,total:this.byteLength,lengthComputable:!0}),e<this.byteLength){var i=this.file.slice(e,Math.min(e+4194304,this.byteLength));t.readAsArrayBuffer(i)}else this.file=void 0,this.onload&&this.onload({buffer:this.buffer})};Ai.prototype.get=it.prototype.get;Ai.prototype.set=it.prototype.set;Ai.prototype.get_buffer=it.prototype.get_buffer;Ai.prototype.get_state=it.prototype.get_state;Ai.prototype.set_state=it.prototype.set_state;function ii(e){this.file=e,this.byteLength=e.size,this.block_cache=new Map,this.block_cache_is_write=new Set,this.onprogress=this.onload=void 0}ii.prototype.load=function(){this.onload&&this.onload(Object.create(null))};ii.prototype.get=function(e,t,i){var s=this.get_from_cache(e,t);s?i(s):(s=new FileReader,s.onload=(function(n){n=new Uint8Array(n.target.result),this.handle_read(e,t,n),i(n)}).bind(this),s.readAsArrayBuffer(this.file.slice(e,e+t)))};ii.prototype.get_from_cache=lt.prototype.get_from_cache;ii.prototype.set=lt.prototype.set;ii.prototype.handle_read=lt.prototype.handle_read;ii.prototype.get_state=lt.prototype.get_state;ii.prototype.set_state=lt.prototype.set_state;ii.prototype.get_buffer=function(e){e()};ii.prototype.get_as_file=function(e){for(var t=[],i=Array.from(this.block_cache.keys()).sort(function(r,o){return r-o}),s=0,n=0;n<i.length;n++){var a=i[n],c=this.block_cache.get(a);a*=256,a!==s&&(t.push(this.file.slice(s,a)),s=a),t.push(c),s+=c.length}return s!==this.file.size&&t.push(this.file.slice(s)),new File(t,e)};function fr(e,t){if(e.buffer instanceof ArrayBuffer)return new it(e.buffer);if(typeof File<"u"&&e.buffer instanceof File)return t=e.async,t===void 0&&(t=268435456<=e.buffer.size),t?new ii(e.buffer):new Ai(e.buffer);if(e.url)return e.use_parts?new xi(e.url,e.size,e.fixed_chunk_size,!1,t):new lt(e.url,e.size,e.fixed_chunk_size)}function Ze(e){this.cpu=e,this.channel_page=new Uint8Array(8),this.channel_pagehi=new Uint8Array(8),this.channel_addr=new Uint16Array(8),this.channel_addr_init=new Uint16Array(8),this.channel_count=new Uint16Array(8),this.channel_count_init=new Uint16Array(8),this.channel_mask=new Uint8Array(8),this.channel_mode=new Uint8Array(8),this.unmask_listeners=[],this.lsb_msb_flipflop=0,e=e.io,e.register_write(0,this,this.port_addr_write.bind(this,0)),e.register_write(2,this,this.port_addr_write.bind(this,1)),e.register_write(4,this,this.port_addr_write.bind(this,2)),e.register_write(6,this,this.port_addr_write.bind(this,3)),e.register_write(1,this,this.port_count_write.bind(this,0)),e.register_write(3,this,this.port_count_write.bind(this,1)),e.register_write(5,this,this.port_count_write.bind(this,2)),e.register_write(7,this,this.port_count_write.bind(this,3)),e.register_read(0,this,this.port_addr_read.bind(this,0)),e.register_read(2,this,this.port_addr_read.bind(this,1)),e.register_read(4,this,this.port_addr_read.bind(this,2)),e.register_read(6,this,this.port_addr_read.bind(this,3)),e.register_read(1,this,this.port_count_read.bind(this,0)),e.register_read(3,this,this.port_count_read.bind(this,1)),e.register_read(5,this,this.port_count_read.bind(this,2)),e.register_read(7,this,this.port_count_read.bind(this,3)),e.register_write(192,this,this.port_addr_write.bind(this,4)),e.register_write(196,this,this.port_addr_write.bind(this,5)),e.register_write(200,this,this.port_addr_write.bind(this,6)),e.register_write(204,this,this.port_addr_write.bind(this,7)),e.register_write(194,this,this.port_count_write.bind(this,4)),e.register_write(198,this,this.port_count_write.bind(this,5)),e.register_write(202,this,this.port_count_write.bind(this,6)),e.register_write(206,this,this.port_count_write.bind(this,7)),e.register_read(192,this,this.port_addr_read.bind(this,4)),e.register_read(196,this,this.port_addr_read.bind(this,5)),e.register_read(200,this,this.port_addr_read.bind(this,6)),e.register_read(204,this,this.port_addr_read.bind(this,7)),e.register_read(194,this,this.port_count_read.bind(this,4)),e.register_read(198,this,this.port_count_read.bind(this,5)),e.register_read(202,this,this.port_count_read.bind(this,6)),e.register_read(206,this,this.port_count_read.bind(this,7)),e.register_write(135,this,this.port_page_write.bind(this,0)),e.register_write(131,this,this.port_page_write.bind(this,1)),e.register_write(129,this,this.port_page_write.bind(this,2)),e.register_write(130,this,this.port_page_write.bind(this,3)),e.register_write(143,this,this.port_page_write.bind(this,4)),e.register_write(139,this,this.port_page_write.bind(this,5)),e.register_write(137,this,this.port_page_write.bind(this,6)),e.register_write(138,this,this.port_page_write.bind(this,7)),e.register_read(135,this,this.port_page_read.bind(this,0)),e.register_read(131,this,this.port_page_read.bind(this,1)),e.register_read(129,this,this.port_page_read.bind(this,2)),e.register_read(130,this,this.port_page_read.bind(this,3)),e.register_read(143,this,this.port_page_read.bind(this,4)),e.register_read(139,this,this.port_page_read.bind(this,5)),e.register_read(137,this,this.port_page_read.bind(this,6)),e.register_read(138,this,this.port_page_read.bind(this,7)),e.register_write(1159,this,this.port_pagehi_write.bind(this,0)),e.register_write(1155,this,this.port_pagehi_write.bind(this,1)),e.register_write(1153,this,this.port_pagehi_write.bind(this,2)),e.register_write(1154,this,this.port_pagehi_write.bind(this,3)),e.register_write(1163,this,this.port_pagehi_write.bind(this,5)),e.register_write(1161,this,this.port_pagehi_write.bind(this,6)),e.register_write(1162,this,this.port_pagehi_write.bind(this,7)),e.register_read(1159,this,this.port_pagehi_read.bind(this,0)),e.register_read(1155,this,this.port_pagehi_read.bind(this,1)),e.register_read(1153,this,this.port_pagehi_read.bind(this,2)),e.register_read(1154,this,this.port_pagehi_read.bind(this,3)),e.register_read(1163,this,this.port_pagehi_read.bind(this,5)),e.register_read(1161,this,this.port_pagehi_read.bind(this,6)),e.register_read(1162,this,this.port_pagehi_read.bind(this,7)),e.register_write(10,this,this.port_singlemask_write.bind(this,0)),e.register_write(212,this,this.port_singlemask_write.bind(this,4)),e.register_write(15,this,this.port_multimask_write.bind(this,0)),e.register_write(222,this,this.port_multimask_write.bind(this,4)),e.register_read(15,this,this.port_multimask_read.bind(this,0)),e.register_read(222,this,this.port_multimask_read.bind(this,4)),e.register_write(11,this,this.port_mode_write.bind(this,0)),e.register_write(214,this,this.port_mode_write.bind(this,4)),e.register_write(12,this,this.portC_write),e.register_write(216,this,this.portC_write)}Ze.prototype.get_state=function(){return[this.channel_page,this.channel_pagehi,this.channel_addr,this.channel_addr_init,this.channel_count,this.channel_count_init,this.channel_mask,this.channel_mode,this.lsb_msb_flipflop]};Ze.prototype.set_state=function(e){this.channel_page=e[0],this.channel_pagehi=e[1],this.channel_addr=e[2],this.channel_addr_init=e[3],this.channel_count=e[4],this.channel_count_init=e[5],this.channel_mask=e[6],this.channel_mode=e[7],this.lsb_msb_flipflop=e[8]};Ze.prototype.port_count_write=function(e,t){A(t),this.channel_count[e]=this.flipflop_get(this.channel_count[e],t,!1),this.channel_count_init[e]=this.flipflop_get(this.channel_count_init[e],t,!0)};Ze.prototype.port_count_read=function(e){return A(this.channel_count[e]),this.flipflop_read(this.channel_count[e])};Ze.prototype.port_addr_write=function(e,t){A(t),this.channel_addr[e]=this.flipflop_get(this.channel_addr[e],t,!1),this.channel_addr_init[e]=this.flipflop_get(this.channel_addr_init[e],t,!0)};Ze.prototype.port_addr_read=function(e){return A(this.channel_addr[e]),this.flipflop_read(this.channel_addr[e])};Ze.prototype.port_pagehi_write=function(e,t){A(t),this.channel_pagehi[e]=t};Ze.prototype.port_pagehi_read=function(e){return this.channel_pagehi[e]};Ze.prototype.port_page_write=function(e,t){A(t),this.channel_page[e]=t};Ze.prototype.port_page_read=function(e){return this.channel_page[e]};Ze.prototype.port_singlemask_write=function(e,t){this.update_mask((t&3)+e,t&4?1:0)};Ze.prototype.port_multimask_write=function(e,t){A(t);for(var i=0;4>i;i++)this.update_mask(e+i,t&1<<i)};Ze.prototype.port_multimask_read=function(e){var t=0|this.channel_mask[e+0];return t|=this.channel_mask[e+1]<<1,t|=this.channel_mask[e+2]<<2,t|=this.channel_mask[e+3]<<3,A(t),t};Ze.prototype.port_mode_write=function(e,t){e=(t&3)+e,A(t),this.channel_mode[e]=t};Ze.prototype.portC_write=function(){this.lsb_msb_flipflop=0};Ze.prototype.on_unmask=function(e,t){this.unmask_listeners.push({fn:e,this_value:t})};Ze.prototype.update_mask=function(e,t){if(this.channel_mask[e]!==t&&(this.channel_mask[e]=t,!t))for(t=0;t<this.unmask_listeners.length;t++)this.unmask_listeners[t].fn.call(this.unmask_listeners[t].this_value,e)};Ze.prototype.do_read=function(e,t,i,s,n){var a=this.count_get_8bit(s),c=this.address_get_8bit(s);if(""+A(c)+A(a),i<a&&(""+A(i)+A(a),void 0),t+a>e.byteLength)n(!0);else{var r=this.cpu;this.channel_addr[s]+=a,e.get(t,a,function(o){r.write_blob(o,c),n(!1)})}};Ze.prototype.do_write=function(e,t,i,s,n){var a=this.channel_count[s]+1&65535,c=5<=s?2:1,r=a*c,o=this.address_get_8bit(s),u=!1,f=!1,l=this.channel_mode[s]&16;""+A(o)+A(r),i<r?(a=Math.floor(i/c),r=a*c,u=!0):i>r&&(f=!0),t+r>e.byteLength?n(!0):(this.channel_addr[s]+=a,this.channel_count[s]-=a,!u&&l&&(this.channel_addr[s]=this.channel_addr_init[s],this.channel_count[s]=this.channel_count_init[s]),e.set(t,this.cpu.mem8.subarray(o,o+r),()=>{f&&l?this.do_write(e,t+r,i-r,s,n):n(!1)}))};Ze.prototype.address_get_8bit=function(e){var t=this.channel_addr[e];return 5<=e&&(t<<=1),t=t&65535|this.channel_page[e]<<16,t|=this.channel_pagehi[e]<<24};Ze.prototype.count_get_8bit=function(e){var t=this.channel_count[e]+1;return 5<=e&&(t*=2),t};Ze.prototype.flipflop_get=function(e,t,i){return i||(this.lsb_msb_flipflop^=1),this.lsb_msb_flipflop?e&-256|t:e&-65281|t<<8};Ze.prototype.flipflop_read=function(e){return(this.lsb_msb_flipflop^=1)?e&255:e>>8&255};function ht(e){this.ports=[],this.cpu=e;for(var t=0;65536>t;t++)this.ports[t]=this.create_empty_entry();var i=e.memory_size[0];for(t=0;t<<17<i;t++)e.memory_map_read8[t]=e.memory_map_write8[t]=void 0,e.memory_map_read32[t]=e.memory_map_write32[t]=void 0;this.mmap_register(i,4294967296-i,function(s){return A(s>>>0,8),255},function(s,n){A(s>>>0,8),A(n,2)},function(s){return A(s>>>0,8),-1},function(s,n){A(s>>>0,8),A(n>>>0,8)})}ht.prototype.create_empty_entry=function(){return{read8:this.empty_port_read8,read16:this.empty_port_read16,read32:this.empty_port_read32,write8:this.empty_port_write,write16:this.empty_port_write,write32:this.empty_port_write,device:void 0}};ht.prototype.empty_port_read8=function(){return 255};ht.prototype.empty_port_read16=function(){return 65535};ht.prototype.empty_port_read32=function(){return-1};ht.prototype.empty_port_write=function(){};ht.prototype.register_read=function(e,t,i,s,n){i&&(this.ports[e].read8=i),s&&(this.ports[e].read16=s),n&&(this.ports[e].read32=n),this.ports[e].device=t};ht.prototype.register_write=function(e,t,i,s,n){i&&(this.ports[e].write8=i),s&&(this.ports[e].write16=s),n&&(this.ports[e].write32=n),this.ports[e].device=t};ht.prototype.register_read_consecutive=function(e,t,i,s,n,a){function c(){return i.call(this)|s.call(this)<<8}function r(){return n.call(this)|a.call(this)<<8}function o(){return i.call(this)|s.call(this)<<8|n.call(this)<<16|a.call(this)<<24}n&&a?(this.register_read(e,t,i,c,o),this.register_read(e+1,t,s),this.register_read(e+2,t,n,r),this.register_read(e+3,t,a)):(this.register_read(e,t,i,c),this.register_read(e+1,t,s))};ht.prototype.register_write_consecutive=function(e,t,i,s,n,a){function c(u){i.call(this,u&255),s.call(this,u>>8&255)}function r(u){n.call(this,u&255),a.call(this,u>>8&255)}function o(u){i.call(this,u&255),s.call(this,u>>8&255),n.call(this,u>>16&255),a.call(this,u>>>24)}n&&a?(this.register_write(e,t,i,c,o),this.register_write(e+1,t,s),this.register_write(e+2,t,n,r),this.register_write(e+3,t,a)):(this.register_write(e,t,i,c),this.register_write(e+1,t,s))};ht.prototype.mmap_read32_shim=function(e){var t=this.cpu.memory_map_read8[e>>>17];return t(e)|t(e+1)<<8|t(e+2)<<16|t(e+3)<<24};ht.prototype.mmap_write32_shim=function(e,t){var i=this.cpu.memory_map_write8[e>>>17];i(e,t&255),i(e+1,t>>8&255),i(e+2,t>>16&255),i(e+3,t>>>24)};ht.prototype.mmap_register=function(e,t,i,s,n,a){for(A(e>>>0,8),A(t,8),n||(n=this.mmap_read32_shim.bind(this)),a||(a=this.mmap_write32_shim.bind(this)),e>>>=17;0<t;e++)this.cpu.memory_map_read8[e]=i,this.cpu.memory_map_write8[e]=s,this.cpu.memory_map_read32[e]=n,this.cpu.memory_map_write32[e]=a,t-=131072};ht.prototype.port_write8=function(e,t){var i=this.ports[e];return i.write8===this.empty_port_write&&(A(e,4),A(t,2),this.get_port_description(e)),i.write8.call(i.device,t)};ht.prototype.port_write16=function(e,t){var i=this.ports[e];return i.write16===this.empty_port_write&&(A(e,4),A(t,4),this.get_port_description(e)),i.write16.call(i.device,t)};ht.prototype.port_write32=function(e,t){var i=this.ports[e];return i.write32===this.empty_port_write&&(A(e,4),A(t>>>0,8),this.get_port_description(e)),i.write32.call(i.device,t)};ht.prototype.port_read8=function(e){var t=this.ports[e];return t.read8===this.empty_port_read8&&(A(e,4),this.get_port_description(e)),t=t.read8.call(t.device,e),(0>t||256<=t)&&A(e),t};ht.prototype.port_read16=function(e){var t=this.ports[e];return t.read16===this.empty_port_read16&&(A(e,4),this.get_port_description(e)),t=t.read16.call(t.device,e),(0>t||65536<=t)&&A(e),t};ht.prototype.port_read32=function(e){var t=this.ports[e];return t.read32===this.empty_port_read32&&(A(e,4),this.get_port_description(e)),t.read32.call(t.device,e)};var ua={4:"PORT_DMA_ADDR_2",5:"PORT_DMA_CNT_2",10:"PORT_DMA1_MASK_REG",11:"PORT_DMA1_MODE_REG",12:"PORT_DMA1_CLEAR_FF_REG",13:"PORT_DMA1_MASTER_CLEAR",32:"PORT_PIC1_CMD",33:"PORT_PIC1_DATA",64:"PORT_PIT_COUNTER0",65:"PORT_PIT_COUNTER1",66:"PORT_PIT_COUNTER2",67:"PORT_PIT_MODE",96:"PORT_PS2_DATA",97:"PORT_PS2_CTRLB",100:"PORT_PS2_STATUS",112:"PORT_CMOS_INDEX",113:"PORT_CMOS_DATA",128:"PORT_DIAG",129:"PORT_DMA_PAGE_2",146:"PORT_A20",160:"PORT_PIC2_CMD",161:"PORT_PIC2_DATA",178:"PORT_SMI_CMD",179:"PORT_SMI_STATUS",212:"PORT_DMA2_MASK_REG",214:"PORT_DMA2_MODE_REG",218:"PORT_DMA2_MASTER_CLEAR",240:"PORT_MATH_CLEAR",368:"PORT_ATA2_CMD_BASE",496:"PORT_ATA1_CMD_BASE",632:"PORT_LPT2",744:"PORT_SERIAL4",760:"PORT_SERIAL2",884:"PORT_ATA2_CTRL_BASE",888:"PORT_LPT1",1e3:"PORT_SERIAL3",1008:"PORT_FD_BASE",1010:"PORT_FD_DOR",1012:"PORT_FD_STATUS",1013:"PORT_FD_DATA",1014:"PORT_HD_DATA",1015:"PORT_FD_DIR",1016:"PORT_SERIAL1",3320:"PORT_PCI_CMD",3321:"PORT_PCI_REBOOT",3324:"PORT_PCI_DATA",1026:"PORT_BIOS_DEBUG",1296:"PORT_QEMU_CFG_CTL",1297:"PORT_QEMU_CFG_DATA",45056:"PORT_ACPI_PM_BASE",45312:"PORT_SMB_BASE",35072:"PORT_BIOS_APM"};ht.prototype.get_port_description=function(e){return ua[e]?"  ("+ua[e]+")":""};var fh={};function Ji(){this.listeners={},this.pair=void 0}Ji.prototype.register=function(e,t,i){var s=this.listeners[e];s===void 0&&(s=this.listeners[e]=[]),s.push({fn:t,this_value:i})};Ji.prototype.unregister=function(e,t){var i=this.listeners[e];i!==void 0&&(this.listeners[e]=i.filter(function(s){return s.fn!==t}))};Ji.prototype.send=function(e,t){if(this.pair&&(e=this.pair.listeners[e],e!==void 0))for(var i=0;i<e.length;i++){var s=e[i];s.fn.call(s.this_value,t)}};Ji.prototype.send_async=function(e,t){setTimeout(this.send.bind(this,e,t),0)};fh.create=function(){var e=new Ji,t=new Ji;return e.pair=t,t.pair=e,[e,t]};var ph=new Uint8Array(256),mh=[],pr=[],mr=[],gh=new Uint8Array(256),Hn=[];function de(e,t){this.cpu=e,this.bus=t,this.write_buffer=new bs(64),this.read_buffer=new bs(64),this.mixer_current_address=this.command_size=this.command=this.read_buffer_lastvalue=0,this.mixer_registers=new Uint8Array(256),this.mixer_reset(),this.dummy_speaker_enabled=!1,this.test_register=0,this.dsp_signed=this.dsp_16bit=this.dsp_stereo=this.dsp_highspeed=!1,this.dac_buffers=[new Pi(65536),new Pi(65536)],this.dma=e.devices.dma,this.dma_channel=this.dma_irq=this.dma_bytes_block=this.dma_bytes_left=this.dma_bytes_count=this.dma_sample_count=0,this.dma_channel_8bit=1,this.dma_channel_16bit=5,this.dma_autoinit=!1,this.dma_buffer=new ArrayBuffer(65536),this.dma_buffer_int8=new Int8Array(this.dma_buffer),this.dma_buffer_uint8=new Uint8Array(this.dma_buffer),this.dma_buffer_int16=new Int16Array(this.dma_buffer),this.dma_buffer_uint16=new Uint16Array(this.dma_buffer),this.dma_syncbuffer=new it(this.dma_buffer),this.dma_paused=this.dma_waiting_transfer=!1,this.sampling_rate=22050,t.send("dac-tell-sampling-rate",this.sampling_rate),this.bytes_per_sample=1,this.e2_value=170,this.e2_count=0,this.asp_registers=new Uint8Array(256),this.mpu_read_buffer=new bs(64),this.fm_current_address1=this.fm_current_address0=this.mpu_read_buffer_lastvalue=0,this.fm_waveform_select_enable=!1,this.irq=5,this.irq_triggered=new Uint8Array(16),e.io.register_read_consecutive(544,this,this.port2x0_read,this.port2x1_read,this.port2x2_read,this.port2x3_read),e.io.register_read_consecutive(904,this,this.port2x0_read,this.port2x1_read),e.io.register_read_consecutive(548,this,this.port2x4_read,this.port2x5_read),e.io.register_read(550,this,this.port2x6_read),e.io.register_read(551,this,this.port2x7_read),e.io.register_read(552,this,this.port2x8_read),e.io.register_read(553,this,this.port2x9_read),e.io.register_read(554,this,this.port2xA_read),e.io.register_read(555,this,this.port2xB_read),e.io.register_read(556,this,this.port2xC_read),e.io.register_read(557,this,this.port2xD_read),e.io.register_read_consecutive(558,this,this.port2xE_read,this.port2xF_read),e.io.register_write_consecutive(544,this,this.port2x0_write,this.port2x1_write,this.port2x2_write,this.port2x3_write),e.io.register_write_consecutive(904,this,this.port2x0_write,this.port2x1_write),e.io.register_write_consecutive(548,this,this.port2x4_write,this.port2x5_write),e.io.register_write(550,this,this.port2x6_write),e.io.register_write(551,this,this.port2x7_write),e.io.register_write_consecutive(552,this,this.port2x8_write,this.port2x9_write),e.io.register_write(554,this,this.port2xA_write),e.io.register_write(555,this,this.port2xB_write),e.io.register_write(556,this,this.port2xC_write),e.io.register_write(557,this,this.port2xD_write),e.io.register_write(558,this,this.port2xE_write),e.io.register_write(559,this,this.port2xF_write),e.io.register_read_consecutive(816,this,this.port3x0_read,this.port3x1_read),e.io.register_write_consecutive(816,this,this.port3x0_write,this.port3x1_write),this.dma.on_unmask(this.dma_on_unmask,this),t.register("dac-request-data",function(){this.dac_handle_request()},this),t.register("speaker-has-initialized",function(){this.mixer_reset()},this),t.send("speaker-confirm-initialized"),this.dsp_reset()}de.prototype.dsp_reset=function(){this.write_buffer.clear(),this.read_buffer.clear(),this.command_size=this.command=0,this.dummy_speaker_enabled=!1,this.test_register=0,this.dsp_signed=this.dsp_16bit=this.dsp_stereo=this.dsp_highspeed=!1,this.dac_buffers[0].clear(),this.dac_buffers[1].clear(),this.dma_channel=this.dma_irq=this.dma_bytes_block=this.dma_bytes_left=this.dma_bytes_count=this.dma_sample_count=0,this.dma_autoinit=!1,this.dma_buffer_uint8.fill(0),this.dma_paused=this.dma_waiting_transfer=!1,this.e2_value=170,this.e2_count=0,this.sampling_rate=22050,this.bytes_per_sample=1,this.lower_irq(1),this.irq_triggered.fill(0),this.asp_registers.fill(0),this.asp_registers[5]=1,this.asp_registers[9]=248};de.prototype.get_state=function(){var e=[];return e[2]=this.read_buffer_lastvalue,e[3]=this.command,e[4]=this.command_size,e[5]=this.mixer_current_address,e[6]=this.mixer_registers,e[7]=this.dummy_speaker_enabled,e[8]=this.test_register,e[9]=this.dsp_highspeed,e[10]=this.dsp_stereo,e[11]=this.dsp_16bit,e[12]=this.dsp_signed,e[15]=this.dma_sample_count,e[16]=this.dma_bytes_count,e[17]=this.dma_bytes_left,e[18]=this.dma_bytes_block,e[19]=this.dma_irq,e[20]=this.dma_channel,e[21]=this.dma_channel_8bit,e[22]=this.dma_channel_16bit,e[23]=this.dma_autoinit,e[24]=this.dma_buffer_uint8,e[25]=this.dma_waiting_transfer,e[26]=this.dma_paused,e[27]=this.sampling_rate,e[28]=this.bytes_per_sample,e[29]=this.e2_value,e[30]=this.e2_count,e[31]=this.asp_registers,e[33]=this.mpu_read_buffer_last_value,e[34]=this.irq,e[35]=this.irq_triggered,e};de.prototype.set_state=function(e){this.read_buffer_lastvalue=e[2],this.command=e[3],this.command_size=e[4],this.mixer_current_address=e[5],this.mixer_registers=e[6],this.mixer_full_update(),this.dummy_speaker_enabled=e[7],this.test_register=e[8],this.dsp_highspeed=e[9],this.dsp_stereo=e[10],this.dsp_16bit=e[11],this.dsp_signed=e[12],this.dma_sample_count=e[15],this.dma_bytes_count=e[16],this.dma_bytes_left=e[17],this.dma_bytes_block=e[18],this.dma_irq=e[19],this.dma_channel=e[20],this.dma_channel_8bit=e[21],this.dma_channel_16bit=e[22],this.dma_autoinit=e[23],this.dma_buffer_uint8=e[24],this.dma_waiting_transfer=e[25],this.dma_paused=e[26],this.sampling_rate=e[27],this.bytes_per_sample=e[28],this.e2_value=e[29],this.e2_count=e[30],this.asp_registers=e[31],this.mpu_read_buffer_last_value=e[33],this.irq=e[34],this.irq_triggered=e[35],this.dma_buffer=this.dma_buffer_uint8.buffer,this.dma_buffer_int8=new Int8Array(this.dma_buffer),this.dma_buffer_int16=new Int16Array(this.dma_buffer),this.dma_buffer_uint16=new Uint16Array(this.dma_buffer),this.dma_syncbuffer=new it(this.dma_buffer),this.dma_paused?this.bus.send("dac-disable"):this.bus.send("dac-enable")};de.prototype.port2x0_read=function(){return 255};de.prototype.port2x1_read=function(){return 255};de.prototype.port2x2_read=function(){return 255};de.prototype.port2x3_read=function(){return 255};de.prototype.port2x4_read=function(){return this.mixer_current_address};de.prototype.port2x5_read=function(){return this.mixer_read(this.mixer_current_address)};de.prototype.port2x6_read=function(){return 255};de.prototype.port2x7_read=function(){return 255};de.prototype.port2x8_read=function(){return 255};de.prototype.port2x9_read=function(){return 255};de.prototype.port2xA_read=function(){return this.read_buffer.length&&(this.read_buffer_lastvalue=this.read_buffer.shift()),A(this.read_buffer_lastvalue),String.fromCharCode(this.read_buffer_lastvalue),this.read_buffer_lastvalue};de.prototype.port2xB_read=function(){return 255};de.prototype.port2xC_read=function(){return 127};de.prototype.port2xD_read=function(){return 255};de.prototype.port2xE_read=function(){return this.irq_triggered[1]&&this.lower_irq(1),(this.read_buffer.length&&!this.dsp_highspeed)<<7|127};de.prototype.port2xF_read=function(){return this.lower_irq(2),0};de.prototype.port2x0_write=function(e){A(e),this.fm_current_address0=0};de.prototype.port2x1_write=function(e){A(e);var t=Hn[this.fm_current_address0];t||(t=this.fm_default_write),t.call(this,e,0,this.fm_current_address0)};de.prototype.port2x2_write=function(e){A(e),this.fm_current_address1=0};de.prototype.port2x3_write=function(e){A(e);var t=Hn[this.fm_current_address1];t||(t=this.fm_default_write),t.call(this,e,1,this.fm_current_address1)};de.prototype.port2x4_write=function(e){A(e),this.mixer_current_address=e};de.prototype.port2x5_write=function(e){A(e),this.mixer_write(this.mixer_current_address,e)};de.prototype.port2x6_write=function(e){A(e),this.dsp_highspeed?this.dsp_highspeed=!1:e&&this.dsp_reset(),this.read_buffer.clear(),this.read_buffer.push(170)};de.prototype.port2x7_write=function(){};de.prototype.port2x8_write=function(){};de.prototype.port2x9_write=function(){};de.prototype.port2xA_write=function(){};de.prototype.port2xB_write=function(){};de.prototype.port2xC_write=function(e){this.command===0?(A(e),this.command=e,this.write_buffer.clear(),this.command_size=ph[e]):(A(e),this.write_buffer.push(e)),this.write_buffer.length>=this.command_size&&this.command_do()};de.prototype.port2xD_write=function(){};de.prototype.port2xE_write=function(){};de.prototype.port2xF_write=function(){};de.prototype.port3x0_read=function(){return this.mpu_read_buffer.length&&(this.mpu_read_buffer_lastvalue=this.mpu_read_buffer.shift()),A(this.mpu_read_buffer_lastvalue),this.mpu_read_buffer_lastvalue};de.prototype.port3x0_write=function(e){A(e)};de.prototype.port3x1_read=function(){return 0|128*!this.mpu_read_buffer.length};de.prototype.port3x1_write=function(e){A(e),e===255&&(this.mpu_read_buffer.clear(),this.mpu_read_buffer.push(254))};de.prototype.command_do=function(){var e=mh[this.command];e||(e=this.dsp_default_handler),e.call(this),this.command_size=this.command=0,this.write_buffer.clear()};de.prototype.dsp_default_handler=function(){A(this.command)};function Ee(e,t,i){i||(i=de.prototype.dsp_default_handler);for(var s=0;s<e.length;s++)ph[e[s]]=t,mh[e[s]]=i}function vh(e){for(var t=[],i=0;16>i;i++)t.push(e+i);return t}Ee([14],2,function(){this.asp_registers[this.write_buffer.shift()]=this.write_buffer.shift()});Ee([15],1,function(){this.read_buffer.clear(),this.read_buffer.push(this.asp_registers[this.write_buffer.shift()])});Ee([16],1,function(){var e=this.write_buffer.shift();e=yh(e/127.5+-1,-1,1),this.dac_buffers[0].push(e),this.dac_buffers[1].push(e),this.bus.send("dac-enable")});Ee([20,21],2,function(){this.dma_irq=1,this.dma_channel=this.dma_channel_8bit,this.dsp_highspeed=this.dsp_16bit=this.dsp_signed=this.dma_autoinit=!1,this.dma_transfer_size_set(),this.dma_transfer_start()});Ee([22],2);Ee([23],2);Ee([28],0,function(){this.dma_irq=1,this.dma_channel=this.dma_channel_8bit,this.dma_autoinit=!0,this.dsp_highspeed=this.dsp_16bit=this.dsp_signed=!1,this.dma_transfer_start()});Ee([31],0);Ee([32],0,function(){this.read_buffer.clear(),this.read_buffer.push(127)});Ee([36],2);Ee([44],0);Ee([48],0);Ee([49],0);Ee([52],0);Ee([53],0);Ee([54],0);Ee([55],0);Ee([56],0);Ee([64],1,function(){this.sampling_rate_change(1e6/(256-this.write_buffer.shift())/this.get_channel_count())});Ee([65,66],2,function(){this.sampling_rate_change(this.write_buffer.shift()<<8|this.write_buffer.shift())});Ee([72],2,function(){this.dma_transfer_size_set()});Ee([116],2);Ee([117],2);Ee([118],2);Ee([119],2);Ee([125],0);Ee([127],0);Ee([128],2);Ee([144],0,function(){this.dma_irq=1,this.dma_channel=this.dma_channel_8bit,this.dma_autoinit=!0,this.dsp_signed=!1,this.dsp_highspeed=!0,this.dsp_16bit=!1,this.dma_transfer_start()});Ee([145],0);Ee([152],0);Ee([153],0);Ee([160],0);Ee([168],0);Ee(vh(176),3,function(){if(this.command&8)this.dsp_default_handler();else{var e=this.write_buffer.shift();this.dma_irq=2,this.dma_channel=this.dma_channel_16bit,this.dma_autoinit=!!(this.command&4),this.dsp_signed=!!(e&16),this.dsp_stereo=!!(e&32),this.dsp_16bit=!0,this.dma_transfer_size_set(),this.dma_transfer_start()}});Ee(vh(192),3,function(){if(this.command&8)this.dsp_default_handler();else{var e=this.write_buffer.shift();this.dma_irq=1,this.dma_channel=this.dma_channel_8bit,this.dma_autoinit=!!(this.command&4),this.dsp_signed=!!(e&16),this.dsp_stereo=!!(e&32),this.dsp_16bit=!1,this.dma_transfer_size_set(),this.dma_transfer_start()}});Ee([208],0,function(){this.dma_paused=!0,this.bus.send("dac-disable")});Ee([209],0,function(){this.dummy_speaker_enabled=!0});Ee([211],0,function(){this.dummy_speaker_enabled=!1});Ee([212],0,function(){this.dma_paused=!1,this.bus.send("dac-enable")});Ee([213],0,function(){this.dma_paused=!0,this.bus.send("dac-disable")});Ee([214],0,function(){this.dma_paused=!1,this.bus.send("dac-enable")});Ee([216],0,function(){this.read_buffer.clear(),this.read_buffer.push(255*this.dummy_speaker_enabled)});Ee([217,218],0,function(){this.dma_autoinit=!1});Ee([224],1,function(){this.read_buffer.clear(),this.read_buffer.push(~this.write_buffer.shift())});Ee([225],0,function(){this.read_buffer.clear(),this.read_buffer.push(4),this.read_buffer.push(5)});Ee([226],1);Ee([227],0,function(){this.read_buffer.clear();for(var e=0;44>e;e++)this.read_buffer.push("COPYRIGHT (C) CREATIVE TECHNOLOGY LTD, 1992.".charCodeAt(e));this.read_buffer.push(0)});Ee([228],1,function(){this.test_register=this.write_buffer.shift()});Ee([232],0,function(){this.read_buffer.clear(),this.read_buffer.push(this.test_register)});Ee([242,243],0,function(){this.raise_irq()});var gr=new Uint8Array(256);gr[14]=255;gr[15]=7;gr[55]=56;Ee([249],1,function(){var e=this.write_buffer.shift();this.read_buffer.clear(),this.read_buffer.push(gr[e])});de.prototype.mixer_read=function(e){var t=pr[e];return t?t=t.call(this):(t=this.mixer_registers[e],A(e),A(t)),t};de.prototype.mixer_write=function(e,t){var i=mr[e];i?i.call(this,t):(A(e),A(t))};de.prototype.mixer_default_read=function(){return A(this.mixer_current_address),this.mixer_registers[this.mixer_current_address]};de.prototype.mixer_default_write=function(e){A(this.mixer_current_address),A(e),this.mixer_registers[this.mixer_current_address]=e};de.prototype.mixer_reset=function(){this.mixer_registers[4]=204,this.mixer_registers[34]=204,this.mixer_registers[38]=204,this.mixer_registers[40]=0,this.mixer_registers[46]=0,this.mixer_registers[10]=0,this.mixer_registers[48]=192,this.mixer_registers[49]=192,this.mixer_registers[50]=192,this.mixer_registers[51]=192,this.mixer_registers[52]=192,this.mixer_registers[53]=192,this.mixer_registers[54]=0,this.mixer_registers[55]=0,this.mixer_registers[56]=0,this.mixer_registers[57]=0,this.mixer_registers[59]=0,this.mixer_registers[60]=31,this.mixer_registers[61]=21,this.mixer_registers[62]=11,this.mixer_registers[63]=0,this.mixer_registers[64]=0,this.mixer_registers[65]=0,this.mixer_registers[66]=0,this.mixer_registers[67]=0,this.mixer_registers[68]=128,this.mixer_registers[69]=128,this.mixer_registers[70]=128,this.mixer_registers[71]=128,this.mixer_full_update()};de.prototype.mixer_full_update=function(){for(var e=1;e<this.mixer_registers.length;e++)gh[e]||this.mixer_write(e,this.mixer_registers[e])};function qt(e,t){t||(t=de.prototype.mixer_default_read),pr[e]=t}function si(e,t){t||(t=de.prototype.mixer_default_write),mr[e]=t}function Ps(e,t,i){gh[e]=1,pr[e]=function(){return this.mixer_registers[t]&240|this.mixer_registers[i]>>>4},mr[e]=function(s){this.mixer_registers[e]=s;var n=s<<4&240|this.mixer_registers[i]&15;this.mixer_write(t,s&240|this.mixer_registers[t]&15),this.mixer_write(i,n)}}function vr(e,t,i){pr[e]=de.prototype.mixer_default_read,mr[e]=function(s){this.mixer_registers[e]=s,this.bus.send("mixer-volume",[t,i,(s>>>2)-62])}}qt(0,function(){return this.mixer_reset(),0});si(0);Ps(4,50,51);Ps(34,48,49);Ps(38,52,53);Ps(40,54,55);Ps(46,56,57);vr(48,0,0);vr(49,0,1);vr(50,2,0);vr(51,2,1);qt(59);si(59,function(e){this.mixer_registers[59]=e,this.bus.send("mixer-volume",[1,2,6*(e>>>6)-18])});qt(65);si(65,function(e){this.mixer_registers[65]=e,this.bus.send("mixer-gain-left",6*(e>>>6))});qt(66);si(66,function(e){this.mixer_registers[66]=e,this.bus.send("mixer-gain-right",6*(e>>>6))});qt(68);si(68,function(e){this.mixer_registers[68]=e,e>>>=3,this.bus.send("mixer-treble-left",e-(16>e?14:16))});qt(69);si(69,function(e){this.mixer_registers[69]=e,e>>>=3,this.bus.send("mixer-treble-right",e-(16>e?14:16))});qt(70);si(70,function(e){this.mixer_registers[70]=e,e>>>=3,this.bus.send("mixer-bass-right",e-(16>e?14:16))});qt(71);si(71,function(e){this.mixer_registers[71]=e,e>>>=3,this.bus.send("mixer-bass-right",e-(16>e?14:16))});qt(128,function(){switch(this.irq){case 2:return 1;case 5:return 2;case 7:return 4;case 10:return 8;default:return 0}});si(128,function(e){e&1&&(this.irq=2),e&2&&(this.irq=5),e&4&&(this.irq=7),e&8&&(this.irq=10)});qt(129,function(){var e=0;switch(this.dma_channel_8bit){case 0:e|=1;break;case 1:e|=2;break;case 3:e|=8}switch(this.dma_channel_16bit){case 5:e|=32;break;case 6:e|=64;break;case 7:e|=128}return e});si(129,function(e){e&1&&(this.dma_channel_8bit=0),e&2&&(this.dma_channel_8bit=1),e&8&&(this.dma_channel_8bit=3),e&32&&(this.dma_channel_16bit=5),e&64&&(this.dma_channel_16bit=6),e&128&&(this.dma_channel_16bit=7)});qt(130,function(){for(var e=32,t=0;16>t;t++)e|=t*this.irq_triggered[t];return e});de.prototype.fm_default_write=function(e,t,i){A(i),A(e)};function Ct(e,t){t||(t=de.prototype.fm_default_write);for(var i=0;i<e.length;i++)Hn[e[i]]=t}function Ri(e,t){for(var i=[];e<=t;e++)i.push(e);return i}const _t=new Uint8Array(32);_t[0]=0;_t[1]=1;_t[2]=2;_t[3]=3;_t[4]=4;_t[5]=5;_t[8]=6;_t[9]=7;_t[10]=8;_t[11]=9;_t[12]=10;_t[13]=11;_t[16]=12;_t[17]=13;_t[18]=14;_t[19]=15;_t[20]=16;_t[21]=17;Ct([1],function(e,t){this.fm_waveform_select_enable[t]=e&1,this.fm_update_waveforms()});Ct([2]);Ct([3]);Ct([4],function(){});Ct([5],function(e,t,i){t===0&&this.fm_default_write(e,t,i)});Ct([8],function(){});Ct(Ri(32,53),function(){});Ct(Ri(64,85),function(){});Ct(Ri(96,117),function(){});Ct(Ri(128,149),function(){});Ct(Ri(160,168),function(){});Ct(Ri(176,184),function(){});Ct([189],function(){});Ct(Ri(192,200),function(){});Ct(Ri(224,245),function(){});de.prototype.fm_update_waveforms=function(){};de.prototype.sampling_rate_change=function(e){this.sampling_rate=e,this.bus.send("dac-tell-sampling-rate",e)};de.prototype.get_channel_count=function(){return this.dsp_stereo?2:1};de.prototype.dma_transfer_size_set=function(){this.dma_sample_count=1+(this.write_buffer.shift()<<0)+(this.write_buffer.shift()<<8)};de.prototype.dma_transfer_start=function(){this.bytes_per_sample=1,this.dsp_16bit&&(this.bytes_per_sample*=2),this.dma_bytes_count=this.dma_sample_count*this.bytes_per_sample,this.dma_bytes_block=1024*this.bytes_per_sample,this.dma_bytes_block=Math.min(Math.max(this.dma_bytes_count>>2&-4,32),this.dma_bytes_block),this.dma_waiting_transfer=!0,this.dma.channel_mask[this.dma_channel]||this.dma_on_unmask(this.dma_channel)};de.prototype.dma_on_unmask=function(e){e===this.dma_channel&&this.dma_waiting_transfer&&(this.dma_waiting_transfer=!1,this.dma_bytes_left=this.dma_bytes_count,this.dma_paused=!1,this.bus.send("dac-enable"))};de.prototype.dma_transfer_next=function(){var e=Math.min(this.dma_bytes_left,this.dma_bytes_block),t=Math.floor(e/this.bytes_per_sample);this.dma.do_write(this.dma_syncbuffer,0,e,this.dma_channel,i=>{i||(this.dma_to_dac(t),this.dma_bytes_left-=e,this.dma_bytes_left||(this.raise_irq(this.dma_irq),this.dma_autoinit&&(this.dma_bytes_left=this.dma_bytes_count)))})};de.prototype.dma_to_dac=function(e){for(var t=this.dsp_16bit?32767.5:127.5,i=this.dsp_signed?0:-1,s=this.dsp_stereo?1:2,n=this.dsp_16bit?this.dsp_signed?this.dma_buffer_int16:this.dma_buffer_uint16:this.dsp_signed?this.dma_buffer_int8:this.dma_buffer_uint8,a=0,c=0;c<e;c++)for(var r=yh(n[c]/t+i,-1,1),o=0;o<s;o++)this.dac_buffers[a].push(r),a^=1;this.dac_send()};de.prototype.dac_handle_request=function(){!this.dma_bytes_left||this.dma_paused?this.dac_send():this.dma_transfer_next()};de.prototype.dac_send=function(){if(this.dac_buffers[0].length){var e=this.dac_buffers[0].shift_block(this.dac_buffers[0].length),t=this.dac_buffers[1].shift_block(this.dac_buffers[1].length);this.bus.send("dac-send-data",[e,t],[e.buffer,t.buffer])}};de.prototype.raise_irq=function(e){this.irq_triggered[e]=1,this.cpu.device_raise_irq(this.irq)};de.prototype.lower_irq=function(e){this.irq_triggered[e]=0,this.cpu.device_lower_irq(this.irq)};function yh(e,t,i){return(e<t)*t+(e>i)*i+(t<=e&&e<=i)*e}function Vi(e){this.message=e}Vi.prototype=Error();const jp={Uint8Array,Int8Array,Uint16Array,Int16Array,Uint32Array,Int32Array,Float32Array,Float64Array};function mn(e,t){if(typeof e!="object"||e===null)return e;if(Array.isArray(e))return e.map(n=>mn(n,t));if(e.constructor===Object&&console.log(e),e.BYTES_PER_ELEMENT){var i=new Uint8Array(e.buffer,e.byteOffset,e.length*e.BYTES_PER_ELEMENT);return{__state_type__:e.constructor.name.replace("bound ",""),buffer_id:t.push(i)-1}}e=e.get_state(),i=[];for(var s=0;s<e.length;s++)i[s]=mn(e[s],t);return i}function gn(e,t){if(typeof e!="object"||e===null)return e;if(Array.isArray(e)){for(let i=0;i<e.length;i++)e[i]=gn(e[i],t);return e}return new jp[e.__state_type__](t[e.buffer_id])}function Vp(e,t){function i(m,g){const C=m.length;if(16>C)throw new Vi("Invalid length: "+C);if(m=new Int32Array(m.buffer,m.byteOffset,4),m[0]!==-2039052682)throw new Vi("Invalid header: "+A(m[0]>>>0));if(m[1]!==6)throw new Vi("Version mismatch: dump="+m[1]+" we=6");if(g&&m[2]!==C)throw new Vi("Length doesn't match header: real="+C+" header="+m[2]);return m[3]}function s(m){return m=new TextDecoder().decode(m),JSON.parse(m)}if(t=new Uint8Array(t),new Uint32Array(t.buffer,0,1)[0]===4247762216){var n=e.zstd_create_ctx(t.length);new Uint8Array(e.wasm_memory.buffer,e.zstd_get_src_ptr(n),t.length).set(t);var a=e.zstd_read(n,16),c=new Uint8Array(e.wasm_memory.buffer,a,16),r=i(c,!1);e.zstd_read_free(a,16),a=e.zstd_read(n,r),c=new Uint8Array(e.wasm_memory.buffer,a,r),c=s(c),e.zstd_read_free(a,r),a=c.state;var o=c.buffer_infos;c=[],r=16+r;for(var u of o){if(o=(r+3&-4)-r,1048576<u.length){var f=e.zstd_read(n,o);e.zstd_read_free(f,o),f=new Uint8Array(u.length),c.push(f.buffer);for(var l=0;l<u.length;){const m=Math.min(u.length-l,1048576),g=e.zstd_read(n,m);f.set(new Uint8Array(e.wasm_memory.buffer,g,m),l),e.zstd_read_free(g,m),l+=m}}else f=e.zstd_read(n,o+u.length),l=f+o,c.push(e.wasm_memory.buffer.slice(l,l+u.length)),e.zstd_read_free(f,o+u.length);r+=o+u.length}a=gn(a,c),e.set_state(a),e.zstd_free_ctx(n)}else{if(n=i(t,!0),0>n||n+12>=t.length)throw new Vi("Invalid info block length: "+n);u=t.subarray(16,16+n),a=s(u),u=a.state,a=a.buffer_infos;let m=16+n;m=m+3&-4,n=a.map(g=>{const C=m+g.offset;return t.buffer.slice(C,C+g.length)}),u=gn(u,n),e.set_state(u)}}function ps(e,t,i,s,n){let a="";var c=[],r=t?"compiled":i?"jit exit":s?"unguarded register":n?"wasm size":"executed";for(let f=0;256>f;f++)for(let l=0;8>l;l++)for(const m of[!1,!0]){var o=e.wm.exports.get_opstats_buffer(t,i,s,n,f,!1,m,l);c.push({opcode:f,count:o,is_mem:m,fixed_g:l}),o=e.wm.exports.get_opstats_buffer(t,i,s,n,f,!0,m,l),c.push({opcode:3840|f,count:o,is_mem:m,fixed_g:l})}e=0,t=new Set([38,46,54,62,100,101,102,103,240,242,243]);for(const{count:f,opcode:l}of c)t.has(l)||(e+=f);if(e===0)return"";i=new Uint32Array(256),t=new Uint32Array(256);for(const{opcode:f,count:l}of c)(f&65280)===3840?t[f&255]+=l:i[f&255]+=l;a=a+`------------------
Total: `+(e+`
`);const u=1e7<e?1e3:1;for(s=Math.max.apply(Math,c.map(({count:f})=>Math.round(f/u))),s=String(s).length,a+=`Instruction counts ${r} (in ${u}):
`,n=0;256>n;n++)a+=n.toString(16).padStart(2,"0")+":"+ca(Math.round(i[n]/u),s),a=n%16===15?a+`
`:a+" ";for(a=a+`
Instruction counts ${r} (0f, in ${u}):
`,r=0;256>r;r++)a+=(r&255).toString(16).padStart(2,"0")+":"+ca(Math.round(t[r]/u),s),a=r%16===15?a+`
`:a+" ";a+=`
`,c=c.filter(({count:f})=>f).sort(({count:f},{count:l})=>l-f);for(const{opcode:f,is_mem:l,fixed_g:m,count:g}of c.slice(0,200))c=f.toString(16)+"_"+m+(l?"_m":"_r"),a+=c+":"+(g/e*100).toFixed(2)+" ";return a+`
`}function Mt(e){this.cpu=e,this.cmos_index=0,this.cmos_data=new Uint8Array(128),this.last_update=this.rtc_time=Date.now(),this.next_interrupt_alarm=this.next_interrupt=0,this.periodic_interrupt=!1,this.periodic_interrupt_time=.9765625,this.cmos_a=38,this.cmos_b=2,this.nmi_disabled=this.cmos_diag_status=this.cmos_c=0,this.update_interrupt=!1,this.update_interrupt_time=0,e.io.register_write(112,this,function(t){this.cmos_index=t&127,this.nmi_disabled=t>>7}),e.io.register_write(113,this,this.cmos_port_write),e.io.register_read(113,this,this.cmos_port_read)}Mt.prototype.get_state=function(){var e=[];return e[0]=this.cmos_index,e[1]=this.cmos_data,e[2]=this.rtc_time,e[3]=this.last_update,e[4]=this.next_interrupt,e[5]=this.next_interrupt_alarm,e[6]=this.periodic_interrupt,e[7]=this.periodic_interrupt_time,e[8]=this.cmos_a,e[9]=this.cmos_b,e[10]=this.cmos_c,e[11]=this.nmi_disabled,e[12]=this.update_interrupt,e[13]=this.update_interrupt_time,e[14]=this.cmos_diag_status,e};Mt.prototype.set_state=function(e){this.cmos_index=e[0],this.cmos_data=e[1],this.rtc_time=e[2],this.last_update=e[3],this.next_interrupt=e[4],this.next_interrupt_alarm=e[5],this.periodic_interrupt=e[6],this.periodic_interrupt_time=e[7],this.cmos_a=e[8],this.cmos_b=e[9],this.cmos_c=e[10],this.nmi_disabled=e[11],this.update_interrupt=e[12]||!1,this.update_interrupt_time=e[13]||0,this.cmos_diag_status=e[14]||0};Mt.prototype.timer=function(e){e=Date.now(),this.rtc_time+=e-this.last_update,this.last_update=e,this.periodic_interrupt&&this.next_interrupt<e?(this.cpu.device_raise_irq(8),this.cmos_c|=192,this.next_interrupt+=this.periodic_interrupt_time*Math.ceil((e-this.next_interrupt)/this.periodic_interrupt_time)):this.next_interrupt_alarm&&this.next_interrupt_alarm<e?(this.cpu.device_raise_irq(8),this.cmos_c|=160,this.next_interrupt_alarm=0):this.update_interrupt&&this.update_interrupt_time<e&&(this.cpu.device_raise_irq(8),this.cmos_c|=144,this.update_interrupt_time=e+1e3);let t=100;return this.periodic_interrupt&&this.next_interrupt&&(t=Math.min(t,Math.max(0,this.next_interrupt-e))),this.next_interrupt_alarm&&(t=Math.min(t,Math.max(0,this.next_interrupt_alarm-e))),this.update_interrupt&&(t=Math.min(t,Math.max(0,this.update_interrupt_time-e))),t};Mt.prototype.bcd_pack=function(e){for(var t=0,i=0,s;e;)s=e%10,i|=s<<4*t,t++,e=(e-s)/10;return i};Mt.prototype.bcd_unpack=function(e){return(e&15)+10*(e>>4&15)};Mt.prototype.encode_time=function(e){return this.cmos_b&4?e:this.bcd_pack(e)};Mt.prototype.decode_time=function(e){return this.cmos_b&4?e:this.bcd_unpack(e)};Mt.prototype.cmos_port_read=function(){var e=this.cmos_index;switch(e){case 0:return A(this.encode_time(new Date(this.rtc_time).getUTCSeconds())),this.encode_time(new Date(this.rtc_time).getUTCSeconds());case 2:return A(this.encode_time(new Date(this.rtc_time).getUTCMinutes())),this.encode_time(new Date(this.rtc_time).getUTCMinutes());case 4:return A(this.encode_time(new Date(this.rtc_time).getUTCHours())),this.encode_time(new Date(this.rtc_time).getUTCHours());case 6:return A(this.encode_time(new Date(this.rtc_time).getUTCDay()+1)),this.encode_time(new Date(this.rtc_time).getUTCDay()+1);case 7:return A(this.encode_time(new Date(this.rtc_time).getUTCDate())),this.encode_time(new Date(this.rtc_time).getUTCDate());case 8:return A(this.encode_time(new Date(this.rtc_time).getUTCMonth()+1)),this.encode_time(new Date(this.rtc_time).getUTCMonth()+1);case 9:return A(this.encode_time(new Date(this.rtc_time).getUTCFullYear()%100)),this.encode_time(new Date(this.rtc_time).getUTCFullYear()%100);case 10:return 999<=Oe.microtick()%1e3?this.cmos_a|128:this.cmos_a;case 11:return this.cmos_b;case 12:return this.cpu.device_lower_irq(8),e=this.cmos_c,this.cmos_c&=-241,e;case 13:return 128;case 14:return this.cmos_diag_status;case 50:case 55:return A(this.encode_time(new Date(this.rtc_time).getUTCFullYear()/100|0)),this.encode_time(new Date(this.rtc_time).getUTCFullYear()/100|0);default:return A(e),this.cmos_data[this.cmos_index]}};Mt.prototype.cmos_port_write=function(e){switch(this.cmos_index){case 10:this.cmos_a=e&127,this.periodic_interrupt_time=1e3/(32768>>(this.cmos_a&15)-1),A(this.cmos_a,2);break;case 11:if(this.cmos_b=e,this.cmos_b&128&&(this.cmos_b&=239),this.cmos_b&64&&(this.next_interrupt=Date.now()),this.cmos_b&32){e=new Date;const t=this.decode_time(this.cmos_data[1]),i=this.decode_time(this.cmos_data[3]),s=this.decode_time(this.cmos_data[5]);this.next_interrupt_alarm=+new Date(Date.UTC(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate(),s,i,t))}this.cmos_b&16&&(this.update_interrupt_time=Date.now()),A(this.cmos_b,2);break;case 14:this.cmos_diag_status=e;break;case 1:case 3:case 5:this.cmos_write(this.cmos_index,e);break;default:A(this.cmos_index),A(e)}this.update_interrupt=(this.cmos_b&16)===16&&0<(this.cmos_a&15),this.periodic_interrupt=(this.cmos_b&64)===64&&0<(this.cmos_a&15)};Mt.prototype.cmos_read=function(e){return this.cmos_data[e]};Mt.prototype.cmos_write=function(e,t){A(e),A(t),this.cmos_data[e]=t};function ri(e,t){this.cpu=e,this.bus=t,this.counter_start_time=new Float64Array(3),this.counter_start_value=new Uint16Array(3),this.counter_next_low=new Uint8Array(4),this.counter_enabled=new Uint8Array(4),this.counter_mode=new Uint8Array(4),this.counter_read_mode=new Uint8Array(4),this.counter_latch=new Uint8Array(4),this.counter_latch_value=new Uint16Array(3),this.counter_reload=new Uint16Array(3),e.io.register_read(97,this,function(){var i=Oe.microtick(),s=66.66666666666667*i&1;return i=this.did_rollover(2,i),s<<4|i<<5}),e.io.register_write(97,this,function(i){i&1?this.bus.send("pcspeaker-enable"):this.bus.send("pcspeaker-disable")}),e.io.register_read(64,this,function(){return this.counter_read(0)}),e.io.register_read(65,this,function(){return this.counter_read(1)}),e.io.register_read(66,this,function(){return this.counter_read(2)}),e.io.register_write(64,this,function(i){this.counter_write(0,i)}),e.io.register_write(65,this,function(i){this.counter_write(1,i)}),e.io.register_write(66,this,function(i){this.counter_write(2,i),this.bus.send("pcspeaker-update",[this.counter_mode[2],this.counter_reload[2]])}),e.io.register_write(67,this,this.port43_write)}ri.prototype.get_state=function(){var e=[];return e[0]=this.counter_next_low,e[1]=this.counter_enabled,e[2]=this.counter_mode,e[3]=this.counter_read_mode,e[4]=this.counter_latch,e[5]=this.counter_latch_value,e[6]=this.counter_reload,e[7]=this.counter_start_time,e[8]=this.counter_start_value,e};ri.prototype.set_state=function(e){this.counter_next_low=e[0],this.counter_enabled=e[1],this.counter_mode=e[2],this.counter_read_mode=e[3],this.counter_latch=e[4],this.counter_latch_value=e[5],this.counter_reload=e[6],this.counter_start_time=e[7],this.counter_start_value=e[8]};ri.prototype.timer=function(e,t){var i=100;return t||(this.counter_enabled[0]&&this.did_rollover(0,e)?(this.counter_start_value[0]=this.get_counter_value(0,e),this.counter_start_time[0]=e,this.cpu.device_lower_irq(0),this.cpu.device_raise_irq(0),this.counter_mode[0]===0&&(this.counter_enabled[0]=0)):this.cpu.device_lower_irq(0),this.counter_enabled[0]&&(i=(this.counter_start_value[0]-Math.floor(1193.1816666*(e-this.counter_start_time[0])))/1193.1816666)),i};ri.prototype.get_counter_value=function(e,t){return this.counter_enabled[e]?(t=this.counter_start_value[e]-Math.floor(1193.1816666*(t-this.counter_start_time[e])),e=this.counter_reload[e],t>=e?t%=e:0>t&&(t=t%e+e),t):0};ri.prototype.did_rollover=function(e,t){return t-=this.counter_start_time[e],0>t?!0:this.counter_start_value[e]<Math.floor(1193.1816666*t)};ri.prototype.counter_read=function(e){var t=this.counter_latch[e];return t?(this.counter_latch[e]--,t===2?this.counter_latch_value[e]&255:this.counter_latch_value[e]>>8):(t=this.counter_next_low[e],this.counter_mode[e]===3&&(this.counter_next_low[e]^=1),e=this.get_counter_value(e,Oe.microtick()),t?e&255:e>>8)};ri.prototype.counter_write=function(e,t){this.counter_reload[e]=this.counter_next_low[e]?this.counter_reload[e]&-256|t:this.counter_reload[e]&255|t<<8,this.counter_read_mode[e]===3&&this.counter_next_low[e]||(this.counter_reload[e]||(this.counter_reload[e]=65535),this.counter_start_value[e]=this.counter_reload[e],this.counter_enabled[e]=!0,this.counter_start_time[e]=Oe.microtick(),A(this.counter_reload[e])),this.counter_read_mode[e]===3&&(this.counter_next_low[e]^=1)};ri.prototype.port43_write=function(e){var t=e>>1&7,i=e>>6&3;e=e>>4&3,i!==3&&(e===0?(this.counter_latch[i]=2,t=this.get_counter_value(i,Oe.microtick()),this.counter_latch_value[i]=t?t-1:0):(6<=t&&(t&=-5),this.counter_next_low[i]=e===1?1:e===2?0:1,i===0&&this.cpu.device_lower_irq(0),t!==0&&t!==3&&t!==2&&A(t),this.counter_mode[i]=t,this.counter_read_mode[i]=e,i===2&&this.bus.send("pcspeaker-update",[this.counter_mode[2],this.counter_reload[2]])))};ri.prototype.dump=function(){};function bh(e){if(typeof window<"u")if(window.AudioContext||window.webkitAudioContext){var t=window.AudioWorklet?qn:Wn;this.bus=e,this.audio_context=window.AudioContext?new AudioContext:new webkitAudioContext,this.mixer=new ss(e,this.audio_context),this.pcspeaker=new wh(e,this.audio_context,this.mixer),this.dac=new t(e,this.audio_context,this.mixer),this.pcspeaker.start(),e.register("emulator-stopped",function(){this.audio_context.suspend()},this),e.register("emulator-started",function(){this.audio_context.resume()},this),e.register("speaker-confirm-initialized",function(){e.send("speaker-has-initialized")},this),e.send("speaker-has-initialized")}else console.warn("Web browser doesn't support Web Audio API")}bh.prototype.destroy=function(){this.audio_context&&this.audio_context.close(),this.audio_context=null,this.dac&&this.dac.node_processor&&this.dac.node_processor.port.close(),this.dac=null};function ss(e,t){function i(s){return function(n){s.gain.setValueAtTime(n,this.audio_context.currentTime)}}this.audio_context=t,this.sources=new Map,this.gain_right=this.gain_left=this.volume_right=this.volume_left=this.volume_both=1,this.node_treble_left=this.audio_context.createBiquadFilter(),this.node_treble_right=this.audio_context.createBiquadFilter(),this.node_treble_left.type="highshelf",this.node_treble_right.type="highshelf",this.node_treble_left.frequency.setValueAtTime(2e3,this.audio_context.currentTime),this.node_treble_right.frequency.setValueAtTime(2e3,this.audio_context.currentTime),this.node_bass_left=this.audio_context.createBiquadFilter(),this.node_bass_right=this.audio_context.createBiquadFilter(),this.node_bass_left.type="lowshelf",this.node_bass_right.type="lowshelf",this.node_bass_left.frequency.setValueAtTime(200,this.audio_context.currentTime),this.node_bass_right.frequency.setValueAtTime(200,this.audio_context.currentTime),this.node_gain_left=this.audio_context.createGain(),this.node_gain_right=this.audio_context.createGain(),this.node_merger=this.audio_context.createChannelMerger(2),this.input_left=this.node_treble_left,this.input_right=this.node_treble_right,this.node_treble_left.connect(this.node_bass_left),this.node_bass_left.connect(this.node_gain_left),this.node_gain_left.connect(this.node_merger,0,0),this.node_treble_right.connect(this.node_bass_right),this.node_bass_right.connect(this.node_gain_right),this.node_gain_right.connect(this.node_merger,0,1),this.node_merger.connect(this.audio_context.destination),e.register("mixer-connect",function(s){this.connect_source(s[0],s[1])},this),e.register("mixer-disconnect",function(s){this.disconnect_source(s[0],s[1])},this),e.register("mixer-volume",function(s){var n=s[0],a=s[1];s=Math.pow(10,s[2]/20),n=n===0?this:this.sources.get(n),n===void 0||n.set_volume(s,a)},this),e.register("mixer-gain-left",function(s){this.gain_left=Math.pow(10,s/20),this.update()},this),e.register("mixer-gain-right",function(s){this.gain_right=Math.pow(10,s/20),this.update()},this),e.register("mixer-treble-left",i(this.node_treble_left),this),e.register("mixer-treble-right",i(this.node_treble_right),this),e.register("mixer-bass-left",i(this.node_bass_left),this),e.register("mixer-bass-right",i(this.node_bass_right),this)}ss.prototype.add_source=function(e,t){return e=new rs(this.audio_context,e,this.input_left,this.input_right),this.sources.has(t),this.sources.set(t,e),e};ss.prototype.connect_source=function(e,t){e=this.sources.get(e),e===void 0||e.connect(t)};ss.prototype.disconnect_source=function(e,t){e=this.sources.get(e),e===void 0||e.disconnect(t)};ss.prototype.set_volume=function(e,t){switch(t===void 0&&(t=2),t){case 0:this.volume_left=e;break;case 1:this.volume_right=e;break;case 2:this.volume_both=e;break;default:return}this.update()};ss.prototype.update=function(){var e=this.volume_both*this.volume_right*this.gain_right;this.node_gain_left.gain.setValueAtTime(this.volume_both*this.volume_left*this.gain_left,this.audio_context.currentTime),this.node_gain_right.gain.setValueAtTime(e,this.audio_context.currentTime)};function rs(e,t,i,s){this.audio_context=e,this.connected_right=this.connected_left=!0,this.volume_right=this.volume_left=this.volume_both=this.gain_hidden=1,this.node_splitter=e.createChannelSplitter(2),this.node_gain_left=e.createGain(),this.node_gain_right=e.createGain(),t.connect(this.node_splitter),this.node_splitter.connect(this.node_gain_left,0),this.node_gain_left.connect(i),this.node_splitter.connect(this.node_gain_right,1),this.node_gain_right.connect(s)}rs.prototype.update=function(){var e=this.connected_right*this.gain_hidden*this.volume_both*this.volume_right;this.node_gain_left.gain.setValueAtTime(this.connected_left*this.gain_hidden*this.volume_both*this.volume_left,this.audio_context.currentTime),this.node_gain_right.gain.setValueAtTime(e,this.audio_context.currentTime)};rs.prototype.connect=function(e){var t=!e||e===2;(t||e===0)&&(this.connected_left=!0),(t||e===1)&&(this.connected_right=!0),this.update()};rs.prototype.disconnect=function(e){var t=!e||e===2;(t||e===0)&&(this.connected_left=!1),(t||e===1)&&(this.connected_right=!1),this.update()};rs.prototype.set_volume=function(e,t){switch(t===void 0&&(t=2),t){case 0:this.volume_left=e;break;case 1:this.volume_right=e;break;case 2:this.volume_both=e;break;default:return}this.update()};rs.prototype.set_gain_hidden=function(e){this.gain_hidden=e};function wh(e,t,i){this.node_oscillator=t.createOscillator(),this.node_oscillator.type="square",this.node_oscillator.frequency.setValueAtTime(440,t.currentTime),this.mixer_connection=i.add_source(this.node_oscillator,1),this.mixer_connection.disconnect(),e.register("pcspeaker-enable",function(){i.connect_source(1)},this),e.register("pcspeaker-disable",function(){i.disconnect_source(1)},this),e.register("pcspeaker-update",function(s){var n=s[1],a=0;s[0]===3&&(a=Math.min(1.1931816665999999e6/n,this.node_oscillator.frequency.maxValue),a=Math.max(a,0)),this.node_oscillator.frequency.setValueAtTime(a,t.currentTime)},this)}wh.prototype.start=function(){this.node_oscillator.start()};function qn(e,t,i){this.bus=e,this.audio_context=t,this.enabled=!1,this.sampling_rate=48e3,t=(function(){function c(u){return u===0?1:(u*=Math.PI,Math.sin(u)/u)}function r(){var u=Reflect.construct(AudioWorkletProcessor,[],r);return u.kernel_size=3,u.queue_data=Array(1024),u.queue_start=0,u.queue_end=0,u.queue_length=0,u.queue_size=u.queue_data.length,u.queued_samples=0,u.source_buffer_previous=o,u.source_buffer_current=o,u.source_samples_per_destination=1,u.source_block_start=0,u.source_time=0,u.source_offset=0,u.port.onmessage=f=>{switch(f.data.type){case"queue":u.queue_push(f.data.value);break;case"sampling-rate":u.source_samples_per_destination=f.data.value/sampleRate}},u}var o=[new Float32Array(256),new Float32Array(256)];Reflect.setPrototypeOf(r.prototype,AudioWorkletProcessor.prototype),Reflect.setPrototypeOf(r,AudioWorkletProcessor),r.prototype.process=r.prototype.process=function(u,f){for(u=0;u<f[0][0].length;u++){for(var l=0,m=0,g=this.source_offset+this.kernel_size,C=this.source_offset-this.kernel_size+1;C<=g;C++){var v=this.source_block_start+C;l+=this.get_sample(v,0)*this.kernel(this.source_time-C),m+=this.get_sample(v,1)*this.kernel(this.source_time-C)}(isNaN(l)||isNaN(m))&&(l=m=0,this.dbg_log("ERROR: NaN values! Ignoring for now.")),f[0][0][u]=l,f[0][1][u]=m,this.source_time+=this.source_samples_per_destination,this.source_offset=Math.floor(this.source_time)}return f=this.source_offset,f+=this.kernel_size+2,this.source_time-=this.source_offset,this.source_block_start+=this.source_offset,this.source_offset=0,this.ensure_enough_data(f),!0},r.prototype.kernel=function(u){return c(u)*c(u/this.kernel_size)},r.prototype.get_sample=function(u,f){return 0>u?(u+=this.source_buffer_previous[0].length,this.source_buffer_previous[f][u]):this.source_buffer_current[f][u]},r.prototype.ensure_enough_data=function(u){var f=this.source_buffer_current[0].length;f-this.source_block_start<u&&(this.prepare_next_buffer(),this.source_block_start-=f)},r.prototype.prepare_next_buffer=function(){256>this.queued_samples&&this.queue_length&&this.dbg_log("Not enough samples - should not happen during midway of playback"),this.source_buffer_previous=this.source_buffer_current,this.source_buffer_current=this.queue_shift();var u=this.source_buffer_current[0].length;if(256>u){for(var f=this.queue_start,l=0;256>u&&l<this.queue_length;)u+=this.queue_data[f][0].length,f=f+1&this.queue_size-1,l++;u=Math.max(u,256),u=[new Float32Array(u),new Float32Array(u)],u[0].set(this.source_buffer_current[0]),u[1].set(this.source_buffer_current[1]),f=this.source_buffer_current[0].length;for(var m=0;m<l;m++){var g=this.queue_shift();u[0].set(g[0],f),u[1].set(g[1],f),f+=g[0].length}this.source_buffer_current=u}this.pump()},r.prototype.pump=function(){1024>this.queued_samples/this.source_samples_per_destination&&this.port.postMessage({type:"pump"})},r.prototype.queue_push=function(u){this.queue_length<this.queue_size&&(this.queue_data[this.queue_end]=u,this.queue_end=this.queue_end+1&this.queue_size-1,this.queue_length++,this.queued_samples+=u[0].length,this.pump())},r.prototype.queue_shift=function(){if(!this.queue_length)return o;var u=this.queue_data[this.queue_start];return this.queue_data[this.queue_start]=null,this.queue_start=this.queue_start+1&this.queue_size-1,this.queue_length--,this.queued_samples-=u[0].length,u},r.prototype.dbg_log=function(){},registerProcessor("dac-processor",r)}).toString();var s=t.indexOf("{")+1,n=t.lastIndexOf("}");t=t.substring(s,n),t=new Blob([t],{type:"application/javascript"});var a=URL.createObjectURL(t);this.node_processor=null,this.node_output=this.audio_context.createGain(),this.audio_context.audioWorklet.addModule(a).then(()=>{URL.revokeObjectURL(a),this.node_processor=new AudioWorkletNode(this.audio_context,"dac-processor",{numberOfInputs:0,numberOfOutputs:1,outputChannelCount:[2],parameterData:{},processorOptions:{}}),this.node_processor.port.postMessage({type:"sampling-rate",value:this.sampling_rate}),this.node_processor.port.onmessage=c=>{switch(c.data.type){case"pump":this.pump()}},this.node_processor.connect(this.node_output)}),this.mixer_connection=i.add_source(this.node_output,2),this.mixer_connection.set_gain_hidden(3),e.register("dac-send-data",function(c){this.queue(c)},this),e.register("dac-enable",function(){this.enabled=!0},this),e.register("dac-disable",function(){this.enabled=!1},this),e.register("dac-tell-sampling-rate",function(c){this.sampling_rate=c,this.node_processor&&this.node_processor.port.postMessage({type:"sampling-rate",value:c})},this)}qn.prototype.queue=function(e){this.node_processor&&this.node_processor.port.postMessage({type:"queue",value:e},[e[0].buffer,e[1].buffer])};qn.prototype.pump=function(){this.enabled&&this.bus.send("dac-request-data")};function Wn(e,t,i){this.bus=e,this.audio_context=t,this.enabled=!1,this.sampling_rate=22050,this.buffered_time=0,this.rate_ratio=1,this.node_lowpass=this.audio_context.createBiquadFilter(),this.node_lowpass.type="lowpass",this.node_output=this.node_lowpass,this.mixer_connection=i.add_source(this.node_output,2),this.mixer_connection.set_gain_hidden(3),e.register("dac-send-data",function(s){this.queue(s)},this),e.register("dac-enable",function(){this.enabled=!0,this.pump()},this),e.register("dac-disable",function(){this.enabled=!1},this),e.register("dac-tell-sampling-rate",function(s){this.sampling_rate=s,this.rate_ratio=Math.ceil(8e3/s),this.node_lowpass.frequency.setValueAtTime(s/2,this.audio_context.currentTime)},this)}Wn.prototype.queue=function(e){var t=e[0].length,i=t/this.sampling_rate;if(1<this.rate_ratio)for(var s=this.audio_context.createBuffer(2,t*this.rate_ratio,this.sampling_rate*this.rate_ratio),n=s.getChannelData(0),a=s.getChannelData(1),c=0,r=0;r<t;r++)for(var o=0;o<this.rate_ratio;o++,c++)n[c]=e[0][r],a[c]=e[1][r];else s=this.audio_context.createBuffer(2,t,this.sampling_rate),s.copyToChannel?(s.copyToChannel(e[0],0),s.copyToChannel(e[1],1)):(s.getChannelData(0).set(e[0]),s.getChannelData(1).set(e[1]));if(e=this.audio_context.createBufferSource(),e.buffer=s,e.connect(this.node_lowpass),e.addEventListener("ended",this.pump.bind(this)),s=this.audio_context.currentTime,this.buffered_time<s)for(this.buffered_time=s,s=.2-i,t=0;t<=s;)t+=i,this.buffered_time+=i,setTimeout(()=>this.pump(),1e3*t);e.start(this.buffered_time),this.buffered_time+=i,setTimeout(()=>this.pump(),0)};Wn.prototype.pump=function(){this.enabled&&(.2<this.buffered_time-this.audio_context.currentTime||this.bus.send("dac-request-data"))};function di(e,t,i){this.bus=t,this.socket=void 0,this.id=i||0,this.send_queue=[],this.url=e,this.reconnect_interval=1e4,this.last_connect_attempt=Date.now()-this.reconnect_interval,this.send_queue_limit=64,this.destroyed=!1,this.bus.register("net"+this.id+"-send",function(s){this.send(s)},this)}di.prototype.handle_message=function(e){this.bus&&this.bus.send("net"+this.id+"-receive",new Uint8Array(e.data))};di.prototype.handle_close=function(){this.destroyed||(this.connect(),setTimeout(this.connect.bind(this),this.reconnect_interval))};di.prototype.handle_open=function(){for(var e=0;e<this.send_queue.length;e++)this.send(this.send_queue[e]);this.send_queue=[]};di.prototype.handle_error=function(){};di.prototype.destroy=function(){this.destroyed=!0,this.socket&&this.socket.close()};di.prototype.connect=function(){if(typeof WebSocket<"u"){if(this.socket){var e=this.socket.readyState;if(e===0||e===1)return}if(e=Date.now(),!(this.last_connect_attempt+this.reconnect_interval>e)){this.last_connect_attempt=Date.now();try{this.socket=new WebSocket(this.url)}catch(t){console.error(t);return}this.socket.binaryType="arraybuffer",this.socket.onopen=this.handle_open.bind(this),this.socket.onmessage=this.handle_message.bind(this),this.socket.onclose=this.handle_close.bind(this),this.socket.onerror=this.handle_error.bind(this)}}};di.prototype.send=function(e){this.socket&&this.socket.readyState===1?this.socket.send(e):(this.send_queue.push(e),this.send_queue.length>2*this.send_queue_limit&&(this.send_queue=this.send_queue.slice(-this.send_queue_limit)),this.connect())};di.prototype.change_proxy=function(e){this.url=e,this.socket&&(this.socket.onclose=function(){},this.socket.onerror=function(){},this.socket.close(),this.socket=void 0)};const Gp=new Date("1970-01-01T00:00:00Z").getTime(),Kp=new Date("1900-01-01T00:00:00Z").getTime(),Xp=Gp-Kp,Yp=Math.pow(2,32),Jp=[118,56,54];function _a(e){return[0,1,2,3,4,5].map(t=>e[t].toString(16)).map(t=>t.length===1?"0"+t:t).join(":")}function ws(e){return e[0]<<24|e[1]<<16|e[2]<<8|e[3]}class Zp{constructor(t,i){t=Math.min(t,16),this.maximum_capacity=i?Math.max(i,t):0,this.length=this.head=this.tail=0,this.buffer=new Uint8Array(t)}write(t){const i=t.length;var s=this.length+i;let n=this.buffer.length;if(n<s){for(;n<s;)n*=2;if(this.maximum_capacity&&n>this.maximum_capacity)throw Error("stream capacity overflow in GrowableRingbuffer.write(), package dropped");s=new Uint8Array(n),this.peek(s),this.tail=0,this.head=this.length,this.buffer=s}s=this.buffer;const a=this.head+i;if(a>n){const c=n-this.head;s.set(t.subarray(0,c),this.head),s.set(t.subarray(c))}else s.set(t,this.head);this.head=a%n,this.length+=i}peek(t){const i=Math.min(this.length,t.length);if(i){const a=this.buffer;var s=a.length,n=this.tail+i;n>s?(n%=s,s-=this.tail,t.set(a.subarray(this.tail)),t.set(a.subarray(0,n),s)):t.set(a.subarray(this.tail,n))}return i}remove(t){return t>this.length&&(t=this.length),t&&(this.tail=(this.tail+t)%this.buffer.length,this.length-=t),t}}function Sh(){const e=new Uint8Array(1518),t=e.buffer,i=e.byteOffset;return{eth_frame:e,eth_frame_view:new DataView(t),eth_payload_view:new DataView(t,i+14,1500),ipv4_payload_view:new DataView(t,i+34,1480),udp_payload_view:new DataView(t,i+42,1472),text_encoder:new TextEncoder}}function kt(e,t,i,s){return s.eth_frame.set(t,i.byteOffset+e),t.length}function Ks(e,t,i,s){const n=i.byteOffset+(e&-2);for(s=s.eth_frame,i=i.byteOffset;i<n;i+=2)t+=s[i]<<8|s[i+1];for(e&1&&(t+=s[n]<<8);t>>>16;)t=(t&65535)+(t>>>16);return~t&65535}function at(e,t){e.eth_frame.fill(0);var i=e.eth_frame,s=i.subarray,n=e.eth_frame_view;if(kt(0,t.eth.dest,n,e),kt(6,t.eth.src,n,e),n.setUint16(12,t.eth.ethertype),n=14,t.arp){var a=e.eth_payload_view;a.setUint16(0,t.arp.htype),a.setUint16(2,t.arp.ptype),a.setUint8(4,t.arp.sha.length),a.setUint8(5,t.arp.spa.length),a.setUint16(6,t.arp.oper),kt(8,t.arp.sha,a,e),kt(14,t.arp.spa,a,e),kt(18,t.arp.tha,a,e),kt(24,t.arp.tpa,a,e),n+=28}else if(t.ipv4){a=e.eth_payload_view;var c=20;if(t.icmp){var r=e.ipv4_payload_view;r.setUint8(0,t.icmp.type),r.setUint8(1,t.icmp.code),r.setUint16(2,0);var o=4+kt(4,t.icmp.data,r,e);r.setUint16(2,Ks(o,0,r,e)),c+=o}else if(t.udp){r=e.ipv4_payload_view;var u=8;if(t.dhcp){o=u;var f=e.udp_payload_view;f.setUint8(0,t.dhcp.op),f.setUint8(1,t.dhcp.htype),f.setUint8(2,t.dhcp.hlen),f.setUint8(3,t.dhcp.hops),f.setUint32(4,t.dhcp.xid),f.setUint16(8,t.dhcp.secs),f.setUint16(10,t.dhcp.flags),f.setUint32(12,t.dhcp.ciaddr),f.setUint32(16,t.dhcp.yiaddr),f.setUint32(20,t.dhcp.siaddr),f.setUint32(24,t.dhcp.giaddr),kt(28,t.dhcp.chaddr,f,e),f.setUint32(236,1669485411),u=240;for(var l of t.dhcp.options)u+=kt(u,l,f,e);o+=u}else if(t.dns){l=u,u=e.udp_payload_view,u.setUint16(0,t.dns.id),u.setUint16(2,t.dns.flags),u.setUint16(4,t.dns.questions.length),u.setUint16(6,t.dns.answers.length);let C=12;for(var m=0;m<t.dns.questions.length;++m){var g=t.dns.questions[m];for(f of g.name){const v=e.text_encoder.encodeInto(f,e.eth_frame.subarray(u.byteOffset+(C+1))).written;u.setUint8(C,v),C+=1+v}u.setUint16(C,g.type),C+=2,u.setUint16(C,g.class),C+=2}for(m=0;m<t.dns.answers.length;++m){f=t.dns.answers[m];for(o of f.name)g=e.text_encoder.encodeInto(o,e.eth_frame.subarray(u.byteOffset+(C+1))).written,u.setUint8(C,g),C+=1+g;u.setUint16(C,f.type),C+=2,u.setUint16(C,f.class),C+=2,u.setUint32(C,f.ttl),C+=4,u.setUint16(C,f.data.length),C+=2,C+=kt(C,f.data,u,e)}o=l+C}else t.ntp?(o=u,f=e.udp_payload_view,f.setUint8(0,t.ntp.flags),f.setUint8(1,t.ntp.stratum),f.setUint8(2,t.ntp.poll),f.setUint8(3,t.ntp.precision),f.setUint32(4,t.ntp.root_delay),f.setUint32(8,t.ntp.root_disp),f.setUint32(12,t.ntp.ref_id),f.setUint32(16,t.ntp.ref_ts_i),f.setUint32(20,t.ntp.ref_ts_f),f.setUint32(24,t.ntp.ori_ts_i),f.setUint32(28,t.ntp.ori_ts_f),f.setUint32(32,t.ntp.rec_ts_i),f.setUint32(36,t.ntp.rec_ts_f),f.setUint32(40,t.ntp.trans_ts_i),f.setUint32(44,t.ntp.trans_ts_f),o+=48):o=u+kt(0,t.udp.data,e.udp_payload_view,e);u=o,r.setUint16(0,t.udp.sport),r.setUint16(2,t.udp.dport),r.setUint16(4,u),r.setUint16(6,0),r.setUint16(6,Ks(u,(t.ipv4.src[0]<<8|t.ipv4.src[1])+(t.ipv4.src[2]<<8|t.ipv4.src[3])+(t.ipv4.dest[0]<<8|t.ipv4.dest[1])+(t.ipv4.dest[2]<<8|t.ipv4.dest[3])+17+u,r,e)),c+=u}else t.tcp&&(r=e.ipv4_payload_view,o=0,f=t.tcp,f.fin&&(o|=1),f.syn&&(o|=2),f.rst&&(o|=4),f.psh&&(o|=8),f.ack&&(o|=16),f.urg&&(o|=32),f.ece&&(o|=64),f.cwr&&(o|=128),r.setUint16(0,f.sport),r.setUint16(2,f.dport),r.setUint32(4,f.seq),r.setUint32(8,f.ackn),r.setUint8(12,80),r.setUint8(13,o),r.setUint16(14,f.winsize),r.setUint16(16,0),r.setUint16(18,f.urgent||0),o=20,t.tcp_data&&(o+=kt(20,t.tcp_data,r,e)),r.setUint16(16,Ks(o,(t.ipv4.src[0]<<8|t.ipv4.src[1])+(t.ipv4.src[2]<<8|t.ipv4.src[3])+(t.ipv4.dest[0]<<8|t.ipv4.dest[1])+(t.ipv4.dest[2]<<8|t.ipv4.dest[3])+6+o,r,e)),c+=o);a.setUint8(0,69),a.setUint8(1,t.ipv4.tos||0),a.setUint16(2,c),a.setUint16(4,t.ipv4.id||0),a.setUint8(6,64),a.setUint8(8,t.ipv4.ttl||32),a.setUint8(9,t.ipv4.proto),a.setUint16(10,0),kt(12,t.ipv4.src,a,e),kt(16,t.ipv4.dest,a,e),a.setUint16(10,Ks(20,0,a,e)),n+=c}return s.call(i,0,n)}function Qp(e,t){return fetch(`https://${t.doh_server||"cloudflare-dns.com"}/dns-query`,{method:"POST",headers:[["content-type","application/dns-message"]],body:e.udp.data}).then(async i=>{i={eth:{ethertype:2048,src:t.router_mac,dest:e.eth.src},ipv4:{proto:17,src:t.router_ip,dest:e.ipv4.src},udp:{sport:53,dport:e.udp.sport,data:new Uint8Array(await i.arrayBuffer())}},t.receive(at(t.eth_encoder_buf,i))}),!0}function em(e,t){let i={};i.eth={ethertype:2048,src:t.router_mac,dest:e.eth.src},i.ipv4={proto:17,src:t.router_ip,dest:t.vm_ip},i.udp={sport:67,dport:68},i.dhcp={htype:1,hlen:6,hops:0,xid:e.dhcp.xid,secs:0,flags:0,ciaddr:0,yiaddr:ws(t.vm_ip),siaddr:ws(t.router_ip),giaddr:ws(t.router_ip),chaddr:e.dhcp.chaddr};let s=[],n=e.dhcp.options.find(function(a){return a[0]===53});n&&n[2]===3&&(e.dhcp.op=3),e.dhcp.op===1&&(i.dhcp.op=2,s.push(new Uint8Array([53,1,2]))),e.dhcp.op===3&&(i.dhcp.op=2,s.push(new Uint8Array([53,1,5])),s.push(new Uint8Array([51,4,8,0,0,0]))),e=[t.router_ip[0],t.router_ip[1],t.router_ip[2],t.router_ip[3]],s.push(new Uint8Array([1,4,255,255,255,0])),t.masquerade&&(s.push(new Uint8Array([3,4].concat(e))),s.push(new Uint8Array([6,4].concat(e)))),s.push(new Uint8Array([54,4].concat(e))),s.push(new Uint8Array([60,3].concat(Jp))),s.push(new Uint8Array([255,0])),i.dhcp.options=s,t.receive(at(t.eth_encoder_buf,i))}function Ch(e,t){let i={};var s=new DataView(e.buffer,e.byteOffset,e.byteLength).getUint16(12),n={ethertype:s,dest:e.subarray(0,6),dest_s:_a(e.subarray(0,6)),src:e.subarray(6,12),src_s:_a(e.subarray(6,12))};if(i.eth=n,e=e.subarray(14,e.length),s===2048){var a=new DataView(e.buffer,e.byteOffset,e.byteLength),c=e[0]>>4&15;n=e[0]&15;var r=a.getUint8(1),o=a.getUint16(2);let u=a.getUint8(8);if(s=a.getUint8(9),a=a.getUint16(10),c={version:c,ihl:n,tos:r,len:o,ttl:u,proto:s,ip_checksum:a,src:e.subarray(12,16),dest:e.subarray(16,20)},i.ipv4=c,n=e.subarray(4*n,o),s===1)e=new DataView(n.buffer,n.byteOffset,n.byteLength),e={type:e.getUint8(0),code:e.getUint8(1),checksum:e.getUint16(2),data:n.subarray(4)},i.icmp=e;else if(s===6)s=new DataView(n.buffer,n.byteOffset,n.byteLength),e={sport:s.getUint16(0),dport:s.getUint16(2),seq:s.getUint32(4),ackn:s.getUint32(8),doff:s.getUint8(12)>>4,winsize:s.getUint16(14),checksum:s.getUint16(16),urgent:s.getUint16(18)},s=s.getUint8(13),e.fin=!!(s&1),e.syn=!!(s&2),e.rst=!!(s&4),e.psh=!!(s&8),e.ack=!!(s&16),e.urg=!!(s&32),e.ece=!!(s&64),e.cwr=!!(s&128),i.tcp=e,i.tcp_data=n.subarray(4*e.doff);else if(s===17){if(e=new DataView(n.buffer,n.byteOffset,n.byteLength),e={sport:e.getUint16(0),dport:e.getUint16(2),len:e.getUint16(4),checksum:e.getUint16(6),data:n.subarray(8),data_s:new TextDecoder().decode(n.subarray(8))},e.dport===67||e.sport===67){for(n=n.subarray(8),s=new DataView(n.buffer,n.byteOffset,n.byteLength),n.subarray(44,236),s={op:s.getUint8(0),htype:s.getUint8(1),hlen:s.getUint8(2),hops:s.getUint8(3),xid:s.getUint32(4),secs:s.getUint16(8),flags:s.getUint16(10),ciaddr:s.getUint32(12),yiaddr:s.getUint32(16),siaddr:s.getUint32(20),giaddr:s.getUint32(24),chaddr:n.subarray(28,44),magic:s.getUint32(236),options:[]},n=n.subarray(240),o=0;o<n.length;++o)c=o,n[o]!==0&&(++o,r=n[o],o+=r,s.options.push(n.subarray(c,c+r+2)));i.dhcp=s,i.dhcp_options=s.options}else e.dport===53||e.sport===53?tm(n.subarray(8),i):e.dport===123&&(s=n.subarray(8),s=new DataView(s.buffer,s.byteOffset,s.byteLength),i.ntp={flags:s.getUint8(0),stratum:s.getUint8(1),poll:s.getUint8(2),precision:s.getUint8(3),root_delay:s.getUint32(4),root_disp:s.getUint32(8),ref_id:s.getUint32(12),ref_ts_i:s.getUint32(16),ref_ts_f:s.getUint32(20),ori_ts_i:s.getUint32(24),ori_ts_f:s.getUint32(28),rec_ts_i:s.getUint32(32),rec_ts_f:s.getUint32(36),trans_ts_i:s.getUint32(40),trans_ts_f:s.getUint32(44)});i.udp=e}}else s===2054?(s=new DataView(e.buffer,e.byteOffset,e.byteLength),e={htype:s.getUint16(0),ptype:s.getUint16(2),oper:s.getUint16(6),sha:e.subarray(8,14),spa:e.subarray(14,18),tha:e.subarray(18,24),tpa:e.subarray(24,28)},i.arp=e):s!==34525&&A(s);if(i.ipv4)if(i.tcp)e=`${i.ipv4.src.join(".")}:${i.tcp.sport}:${i.ipv4.dest.join(".")}:${i.tcp.dport}`,(!i.tcp.syn||!t.on_tcp_connection(i,e))&&(t.tcp_conn[e]?t.tcp_conn[e].process(i):(e=i.tcp.ackn,(i.tcp.fin||i.tcp.syn)&&(e+=1),s={},s.eth={ethertype:2048,src:t.router_mac,dest:i.eth.src},s.ipv4={proto:6,src:i.ipv4.dest,dest:i.ipv4.src},s.tcp={sport:i.tcp.dport,dport:i.tcp.sport,seq:e,ackn:i.tcp.seq+(i.tcp.syn?1:0),winsize:i.tcp.winsize,rst:!0,ack:i.tcp.syn},t.receive(at(t.eth_encoder_buf,s))));else if(i.udp)if(i.dns)if(t.dns_method==="static"){for(e={},e.eth={ethertype:2048,src:t.router_mac,dest:i.eth.src},e.ipv4={proto:17,src:t.router_ip,dest:i.ipv4.src},e.udp={sport:53,dport:i.udp.sport},s=[],n=0;n<i.dns.questions.length;++n)switch(o=i.dns.questions[n],o.type){case 1:s.push({name:o.name,type:o.type,class:o.class,ttl:600,data:[192,168,87,1]})}e.dns={id:i.dns.id,flags:33152,questions:i.dns.questions,answers:s},t.receive(at(t.eth_encoder_buf,e))}else Qp(i,t);else i.dhcp?em(i,t):i.ntp?(e=Date.now()+Xp,s=e%1e3/1e3*Yp,n={},n.eth={ethertype:2048,src:t.router_mac,dest:i.eth.src},n.ipv4={proto:17,src:i.ipv4.dest,dest:i.ipv4.src},n.udp={sport:123,dport:i.udp.sport},n.ntp=Object.assign({},i.ntp),n.ntp.flags=36,n.ntp.poll=10,n.ntp.ori_ts_i=i.ntp.trans_ts_i,n.ntp.ori_ts_f=i.ntp.trans_ts_f,n.ntp.rec_ts_i=e/1e3,n.ntp.rec_ts_f=s,n.ntp.trans_ts_i=e/1e3,n.ntp.trans_ts_f=s,n.ntp.stratum=2,t.receive(at(t.eth_encoder_buf,n))):i.udp.dport===8&&(e={},e.eth={ethertype:2048,src:t.router_mac,dest:i.eth.src},e.ipv4={proto:17,src:i.ipv4.dest,dest:i.ipv4.src},e.udp={sport:i.udp.dport,dport:i.udp.sport,data:new TextEncoder().encode(i.udp.data_s)},t.receive(at(t.eth_encoder_buf,e)));else i.icmp&&i.icmp.type===8&&(e={},e.eth={ethertype:2048,src:t.router_mac,dest:i.eth.src},e.ipv4={proto:1,src:i.ipv4.dest,dest:i.ipv4.src},e.icmp={type:0,code:i.icmp.code,data:i.icmp.data},t.receive(at(t.eth_encoder_buf,e)));else i.arp&&i.arp.oper===1&&i.arp.ptype===2048&&(e=ws(i.arp.tpa)&4294967040,s=ws(t.router_ip)&4294967040,!t.masquerade&&e!==s||e===s&&99<i.arp.tpa[3]||(e={},e.eth={ethertype:2054,src:t.router_mac,dest:i.eth.src},e.arp={htype:1,ptype:2048,oper:2,sha:t.router_mac,spa:i.arp.tpa,tha:i.eth.src,tpa:i.arp.spa},t.receive(at(t.eth_encoder_buf,e))))}function tm(e,t){function i(){let u=[],f;do f=s.getUint8(r),u.push(new TextDecoder().decode(e.subarray(r+1,r+1+f))),r+=f+1;while(0<f);return u}let s=new DataView(e.buffer,e.byteOffset,e.byteLength),n={id:s.getUint16(0),flags:s.getUint16(2),questions:[],answers:[]};var a=s.getUint16(4);let c=s.getUint16(6);s.getUint16(8),s.getUint16(10);let r=12;for(var o=0;o<a;o++)n.questions.push({name:i(),type:s.getInt16(r),class:s.getInt16(r+2)}),r+=4;for(a=0;a<c;a++){o={name:i(),type:s.getInt16(r),class:s.getUint16(r+2),ttl:s.getUint32(r+4)},r+=8;let u=s.getUint16(r);r+=2,o.data=e.subarray(r,r+u),r+=u,n.answers.push(o)}t.dns=n}function Eh(e,t){var i=t.vm_ip.join(".");const s=t.router_ip.join("."),n=16383*Math.random()|0;let a,c,r=0;do a=49152+(n+r)%16383,c=`${i}:${e}:${s}:${a}`;while(16383>++r&&t.tcp_conn[c]);if(t.tcp_conn[c])throw Error("pool of dynamic TCP port numbers exhausted, connection aborted");return i=new pt,i.tuple=c,i.hsrc=t.router_mac,i.psrc=t.router_ip,i.sport=a,i.hdest=t.vm_mac,i.dport=e,i.pdest=t.vm_ip,i.net=t,t.tcp_conn[c]=i,i.connect(),i}function im(e,t){return new Promise(i=>{let s=Eh(e,t);s.state="syn-probe",s.on("probe",i)})}function pt(){this.state="closed",this.net=null,this.send_buffer=new Zp(2048,0),this.send_chunk_buf=new Uint8Array(1460),this.delayed_send_fin=this.in_active_close=!1,this.delayed_state=void 0,this.events_handlers={}}pt.prototype.on=function(e,t){this.events_handlers[e]=t};pt.prototype.emit=function(e,...t){this.events_handlers[e]&&this.events_handlers[e].apply(this,t)};pt.prototype.ipv4_reply=function(){let e={};return e.eth={ethertype:2048,src:this.hsrc,dest:this.hdest},e.ipv4={proto:6,src:this.psrc,dest:this.pdest},e.tcp={sport:this.sport,dport:this.dport,winsize:this.winsize,ackn:this.ack,seq:this.seq,ack:!0},e};pt.prototype.packet_reply=function(e,t){if(e={sport:e.tcp.dport,dport:e.tcp.sport,winsize:e.tcp.winsize,ackn:this.ack,seq:this.seq},t)for(const i in t)e[i]=t[i];return t=this.ipv4_reply(),t.tcp=e,t};pt.prototype.connect=function(){this.seq=1338,this.ack=1,this.start_seq=0,this.winsize=64240,this.state="syn-sent";let e=this.ipv4_reply();e.ipv4.id=2345,e.tcp={sport:this.sport,dport:this.dport,seq:1337,ackn:0,winsize:0,syn:!0},this.net.receive(at(this.net.eth_encoder_buf,e))};pt.prototype.accept=function(e){this.seq=1338,this.ack=e.tcp.seq+1,this.start_seq=e.tcp.seq,this.hsrc=this.net.router_mac,this.psrc=e.ipv4.dest,this.sport=e.tcp.dport,this.hdest=e.eth.src,this.dport=e.tcp.sport,this.pdest=e.ipv4.src,this.winsize=e.tcp.winsize;let t=this.ipv4_reply();t.tcp={sport:this.sport,dport:this.dport,seq:1337,ackn:this.ack,winsize:e.tcp.winsize,syn:!0,ack:!0},this.state="established",this.net.receive(at(this.net.eth_encoder_buf,t))};pt.prototype.process=function(e){if(this.state==="closed")e=this.packet_reply(e,{rst:!0}),this.net.receive(at(this.net.eth_encoder_buf,e));else if(e.tcp.rst)this.state==="syn-probe"?this.emit("probe",!1):this.on_close(),this.release();else if(e.tcp.syn)this.state==="syn-sent"&&e.tcp.ack?(this.ack=e.tcp.seq+1,this.start_seq=e.tcp.seq,this.last_received_ackn=e.tcp.ackn,e=this.ipv4_reply(),this.net.receive(at(this.net.eth_encoder_buf,e)),this.state="established",this.emit("connect")):this.state==="syn-probe"&&e.tcp.ack&&(this.emit("probe",!0),e=this.packet_reply(e,{rst:!0}),this.net.receive(at(this.net.eth_encoder_buf,e)),this.release());else{if(e.tcp.ack){if(this.state==="syn-received")this.state="established";else if(this.state==="fin-wait-1")e.tcp.fin||(this.state="fin-wait-2");else if(this.state==="closing"||this.state==="last-ack"){this.release();return}}if(this.last_received_ackn===void 0)this.last_received_ackn=e.tcp.ackn;else{var t=e.tcp.ackn-this.last_received_ackn;if(0<t){if(this.last_received_ackn=e.tcp.ackn,this.send_buffer.remove(t),this.seq+=t,this.pending=!1,this.delayed_send_fin&&!this.send_buffer.length){this.delayed_send_fin=!1,this.state=this.delayed_state,e=this.ipv4_reply(),e.tcp.fin=!0,this.net.receive(at(this.net.eth_encoder_buf,e));return}}else if(0>t){e=this.packet_reply(e,{rst:!0}),this.net.receive(at(this.net.eth_encoder_buf,e)),this.on_close(),this.release();return}}e.tcp.fin?(++this.ack,t=this.packet_reply(e,{}),this.state==="established"?(t.tcp.ack=!0,this.state="close-wait",this.on_shutdown()):this.state==="fin-wait-1"?(e.tcp.ack?this.release():this.state="closing",t.tcp.ack=!0):this.state==="fin-wait-2"?(this.release(),t.tcp.ack=!0):(this.release(),this.on_close(),t.tcp.rst=!0),this.net.receive(at(this.net.eth_encoder_buf,t))):this.ack!==e.tcp.seq?(e=this.packet_reply(e,{ack:!0}),this.net.receive(at(this.net.eth_encoder_buf,e))):e.tcp.ack&&0<e.tcp_data.length&&(this.ack+=e.tcp_data.length,t=this.ipv4_reply(),this.net.receive(at(this.net.eth_encoder_buf,t)),this.emit("data",e.tcp_data)),this.pump()}};pt.prototype.write=function(e){this.in_active_close||this.send_buffer.write(e),this.pump()};pt.prototype.writev=function(e){if(!this.in_active_close)for(const t of e)this.send_buffer.write(t);this.pump()};pt.prototype.close=function(){if(!this.in_active_close){if(this.in_active_close=!0,this.state==="established"||this.state==="syn-received")var e="fin-wait-1";else if(this.state==="close-wait")e="last-ack";else{this.release();return}this.send_buffer.length||this.pending?(this.delayed_send_fin=!0,this.delayed_state=e):(this.state=e,e=this.ipv4_reply(),e.tcp.fin=!0,this.net.receive(at(this.net.eth_encoder_buf,e)))}this.pump()};pt.prototype.on_shutdown=function(){this.emit("shutdown")};pt.prototype.on_close=function(){this.emit("close")};pt.prototype.release=function(){this.net.tcp_conn[this.tuple]&&(this.state="closed",delete this.net.tcp_conn[this.tuple])};pt.prototype.pump=function(){if(this.send_buffer.length&&!this.pending){const e=this.send_chunk_buf,t=this.send_buffer.peek(e),i=this.ipv4_reply();i.tcp.psh=!0,i.tcp_data=e.subarray(0,t),this.net.receive(at(this.net.eth_encoder_buf,i)),this.pending=!0}};function Wt(e,t){t=t||{},this.bus=e,this.id=t.id||0,this.router_mac=new Uint8Array((t.router_mac||"52:54:0:1:2:3").split(":").map(function(i){return parseInt(i,16)})),this.router_ip=new Uint8Array((t.router_ip||"192.168.86.1").split(".").map(function(i){return parseInt(i,10)})),this.vm_ip=new Uint8Array((t.vm_ip||"192.168.86.100").split(".").map(function(i){return parseInt(i,10)})),this.masquerade=t.masquerade===void 0||!!t.masquerade,this.vm_mac=new Uint8Array(6),this.dns_method=t.dns_method||"static",this.doh_server=t.doh_server,this.tcp_conn={},this.eth_encoder_buf=Sh(),this.fetch=(...i)=>fetch(...i),this.cors_proxy=t.cors_proxy,this.bus.register("net"+this.id+"-mac",function(i){this.vm_mac=new Uint8Array(i.split(":").map(function(s){return parseInt(s,16)}))},this),this.bus.register("net"+this.id+"-send",function(i){this.send(i)},this)}Wt.prototype.destroy=function(){};Wt.prototype.on_tcp_connection=function(e,t){if(e.tcp.dport===80){let i=new pt;return i.state="syn-received",i.net=this,i.on("data",sm),i.tuple=t,i.accept(e),this.tcp_conn[t]=i,!0}return!1};Wt.prototype.connect=function(e){return Eh(e,this)};Wt.prototype.tcp_probe=function(e){return im(e,this)};async function sm(e){if(this.read=this.read||"",(this.read+=new TextDecoder().decode(e))&&this.read.indexOf(`\r
\r
`)!==-1){e=this.read.indexOf(`\r
\r
`);var t=this.read.substring(0,e).split(/\r\n/);e=this.read.substring(e+4),this.read="";let i=t[0].split(" "),s;s=/^https?:/.test(i[1])?new URL(i[1]):new URL("http://host"+i[1]),typeof window<"u"&&s.protocol==="http:"&&window.location.protocol==="https:"&&(s.protocol="https:");let n=new Headers;for(let r=1;r<t.length;++r){const o=this.net.parse_http_header(t[r]);if(!o){console.warn('The request contains an invalid header: "%s"',t[r]),this.net.respond_text_and_close(this,400,"Bad Request",`Invalid header in request: ${t[r]}`);return}o.key.toLowerCase()==="host"?s.host=o.value:n.append(o.key,o.value)}if(!this.net.cors_proxy&&/^\d+\.external$/.test(s.hostname))if(t=parseInt(s.hostname.split(".")[0],10),!isNaN(t)&&0<t&&65536>t)s.protocol="http:",s.hostname="localhost",s.port=t.toString(10);else{console.warn('Unknown port for localhost: "%s"',s.href),this.net.respond_text_and_close(this,400,"Bad Request",`Unknown port for localhost: ${s.href}`);return}this.name=s.href,t={method:i[0],headers:n},["put","post"].indexOf(t.method.toLowerCase())!==-1&&(t.body=e);const a=this.net.cors_proxy?this.net.cors_proxy+encodeURIComponent(s.href):s.href;new TextEncoder;let c=!1;this.net.fetch(a,t).then(r=>{let o=new Headers(r.headers);if(o.delete("content-encoding"),o.delete("keep-alive"),o.delete("content-length"),o.delete("transfer-encoding"),o.set("x-was-fetch-redirected",`${!!r.redirected}`),o.set("x-fetch-resp-url",r.url),o.set("connection","close"),this.write(this.net.form_response_head(r.status,r.statusText,o)),c=!0,r.body&&r.body.getReader){const u=r.body.getReader(),f=({value:l,done:m})=>{if(l&&this.write(l),m)this.close();else return u.read().then(f)};u.read().then(f)}else r.arrayBuffer().then(u=>{this.write(new Uint8Array(u)),this.close()})}).catch(r=>{console.warn("Fetch Failed: "+a+`
`+r),c||this.net.respond_text_and_close(this,502,"Fetch Error",`Fetch ${a} failed:

${r.stack||r.message}`),this.close()})}}Wt.prototype.fetch=async function(e,t){this.cors_proxy&&(e=this.cors_proxy+encodeURIComponent(e));try{const i=await fetch(e,t),s=await i.arrayBuffer();return[i,s]}catch(i){return console.warn("Fetch Failed: "+e+`
`+i),[{status:502,statusText:"Fetch Error",headers:new Headers({"Content-Type":"text/plain"})},new TextEncoder().encode(`Fetch ${e} failed:

${i.stack}`).buffer]}};Wt.prototype.form_response_head=function(e,t,i){e=[`HTTP/1.1 ${e} ${t}`];for(const[s,n]of i.entries())e.push(`${s}: ${n}`);return new TextEncoder().encode(e.join(`\r
`)+`\r
\r
`)};Wt.prototype.respond_text_and_close=function(e,t,i,s){const n=new Headers({"content-type":"text/plain","content-length":s.length.toString(10),connection:"close"});e.writev([this.form_response_head(t,i,n),new TextEncoder().encode(s)]),e.close()};Wt.prototype.parse_http_header=function(e){var t=e.match(/^([^:]*):(.*)$/);if(t&&(e=t[1],t=t[2].trim(),e.length!==0&&t.length!==0&&/^[\w-]+$/.test(e)&&/^[\x20-\x7E]+$/.test(t)))return{key:e,value:t}};Wt.prototype.send=function(e){Ch(e,this)};Wt.prototype.receive=function(e){this.bus.send("net"+this.id+"-receive",new Uint8Array(e))};function fi(e,t,i){this.register_ws(e),this.last_stream=1,this.connections={0:{congestion:0}},this.congested_buffer=[],i=i||{},this.bus=t,this.id=i.id||0,this.router_mac=new Uint8Array((i.router_mac||"52:54:0:1:2:3").split(":").map(function(s){return parseInt(s,16)})),this.router_ip=new Uint8Array((i.router_ip||"192.168.86.1").split(".").map(function(s){return parseInt(s,10)})),this.vm_ip=new Uint8Array((i.vm_ip||"192.168.86.100").split(".").map(function(s){return parseInt(s,10)})),this.masquerade=i.masquerade===void 0||!!i.masquerade,this.vm_mac=new Uint8Array(6),this.dns_method=i.dns_method||"doh",this.doh_server=i.doh_server,this.tcp_conn={},this.eth_encoder_buf=Sh(),this.bus.register("net"+this.id+"-mac",function(s){this.vm_mac=new Uint8Array(s.split(":").map(function(n){return parseInt(n,16)}))},this),this.bus.register("net"+this.id+"-send",function(s){this.send(s)},this)}fi.prototype.register_ws=function(e){this.wispws=new WebSocket(e.replace("wisp://","ws://").replace("wisps://","wss://")),this.wispws.binaryType="arraybuffer",this.wispws.onmessage=t=>{this.process_incoming_wisp_frame(new Uint8Array(t.data))},this.wispws.onclose=()=>{setTimeout(()=>{this.register_ws(e)},1e4)}};fi.prototype.send_packet=function(e,t,i){this.connections[i]&&(0<this.connections[i].congestion?(t==="DATA"&&this.connections[i].congestion--,this.wispws.send(e)):(this.connections[i].congested=!0,this.congested_buffer.push({data:e,type:t})))};fi.prototype.process_incoming_wisp_frame=function(e){const t=new DataView(e.buffer),i=t.getUint32(1,!0);switch(e[0]){case 2:if(this.connections[i])this.connections[i].data_callback(e.slice(5));else throw Error("Got a DATA packet but stream not registered. ID: "+i);break;case 3:if(this.connections[i]&&(this.connections[i].congestion=t.getUint32(5,!0)),this.connections[i].congested){for(const s of this.congested_buffer)this.send_packet(s.data,s.type,i);this.connections[i].congested=!1}break;case 4:this.connections[i]&&this.connections[i].close_callback(t.getUint8(5)),delete this.connections[i]}};fi.prototype.send_wisp_frame=function(e){let t,i;switch(e.type){case"CONNECT":const s=new TextEncoder().encode(e.hostname);t=new Uint8Array(8+s.length),i=new DataView(t.buffer),i.setUint8(0,1),i.setUint32(1,e.stream_id,!0),i.setUint8(5,1),i.setUint16(6,e.port,!0),t.set(s,8),this.connections[e.stream_id]={data_callback:e.data_callback,close_callback:e.close_callback,congestion:this.connections[0].congestion};break;case"DATA":t=new Uint8Array(5+e.data.length),i=new DataView(t.buffer),i.setUint8(0,2),i.setUint32(1,e.stream_id,!0),t.set(e.data,5);break;case"CLOSE":t=new Uint8Array(6),i=new DataView(t.buffer),i.setUint8(0,4),i.setUint32(1,e.stream_id,!0),i.setUint8(5,e.reason)}this.send_packet(t,e.type,e.stream_id)};fi.prototype.destroy=function(){this.wispws&&(this.wispws.onmessage=null,this.wispws.onclose=null,this.wispws.close(),this.wispws=null)};fi.prototype.on_tcp_connection=function(e,t){let i=new pt;return i.state="syn-received",i.net=this,i.tuple=t,i.stream_id=this.last_stream++,this.tcp_conn[t]=i,i.on("data",s=>{s.length!==0&&this.send_wisp_frame({type:"DATA",stream_id:i.stream_id,data:s})}),i.on_close=()=>{this.send_wisp_frame({type:"CLOSE",stream_id:i.stream_id,reason:2})},i.on_shutdown=i.on_close,this.send_wisp_frame({type:"CONNECT",stream_id:i.stream_id,hostname:e.ipv4.dest.join("."),port:e.tcp.dport,data_callback:s=>{i.write(s)},close_callback:()=>{i.close()}}),i.accept(e),!0};fi.prototype.send=function(e){Ch(e,this)};fi.prototype.receive=function(e){this.bus.send("net"+this.id+"-receive",new Uint8Array(e))};const rm=typeof window<"u"&&0<=window.navigator.platform.toString().toLowerCase().search("win");function nm(e){function t(d){return d.shiftKey&&d.ctrlKey&&(d.keyCode===73||d.keyCode===74||d.keyCode===75)||!C.emu_enabled?!1:d.target?d.target.classList.contains("phone_keyboard")||d.target.nodeName!=="INPUT"&&d.target.nodeName!=="TEXTAREA":!0}function i(d){return!d.altKey&&f[56]&&o(56,!1),c(d,!1)}function s(d){return!d.altKey&&f[56]&&o(56,!1),c(d,!0)}function n(){for(var d=Object.keys(f),y,S=0;S<d.length;S++)y=+d[S],f[y]&&o(y,!1);f={}}function a(d){if(C.bus&&t(d))switch(d.inputType){case"insertText":for(var y=0;y<d.data.length;y++)C.simulate_char(d.data[y]);break;case"insertLineBreak":C.simulate_press(13);break;case"deleteContentBackward":C.simulate_press(8)}}function c(d,y){if(C.bus&&t(d)&&d.code!==""&&d.key!=="Process"&&d.key!=="Unidentified"&&d.keyCode!==229)return d.preventDefault&&d.preventDefault(),rm&&(l&&(clearTimeout(g),d.getModifierState&&d.getModifierState("AltGraph")&&m===y&&l.code==="ControlLeft"&&d.code==="AltRight"||r(l,m),l=null),d.code==="ControlLeft")?(l=d,m=y,g=setTimeout(()=>{r(l,m),l=null},10),!1):(r(d,y),!1)}function r(d,y){e:{if(d.code!==void 0){var S=_[d.code];if(S!==void 0)break e}S=v[d.keyCode]}S?o(S,y,d.repeat):console.log("Missing char in map: keyCode="+(d.keyCode||-1).toString(16)+" code="+d.code)}function o(d,y,S){if(y)f[d]&&!S&&o(d,!1);else if(!f[d])return;(f[d]=y)||(d|=128),255<d?(u(d>>8),u(d&255)):u(d)}function u(d){C.bus.send("keyboard-code",d)}var f={},l=null,m=!1,g=0,C=this;this.emu_enabled=!0;const v=new Uint16Array([0,0,0,0,0,0,0,0,14,15,0,0,0,28,0,0,42,29,56,0,58,0,0,0,0,0,0,1,0,0,0,0,57,57417,57425,57423,57415,57419,57416,57421,80,0,0,0,0,82,83,0,11,2,3,4,5,6,7,8,9,10,0,39,0,13,0,0,0,30,48,46,32,18,33,34,35,23,36,37,38,50,49,24,25,16,19,31,20,22,47,17,45,21,44,57435,57436,57437,0,0,82,79,80,81,75,76,77,71,72,73,0,0,0,0,0,0,59,60,61,62,63,64,65,66,67,68,87,88,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,69,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,12,0,0,0,0,0,0,0,0,0,0,0,0,39,13,51,12,52,53,41,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,26,43,27,40,0,57435,57400,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),h={8:8,10:13,32:32,39:222,44:188,45:189,46:190,47:191,48:48,49:49,50:50,51:51,52:52,53:53,54:54,55:55,56:56,57:57,59:186,61:187,91:219,92:220,93:221,96:192,97:65,98:66,99:67,100:68,101:69,102:70,103:71,104:72,105:73,106:74,107:75,108:76,109:77,110:78,111:79,112:80,113:81,114:82,115:83,116:84,117:85,118:86,119:87,120:88,121:89,122:90},p={33:49,34:222,35:51,36:52,37:53,38:55,40:57,41:48,42:56,43:187,58:186,60:188,62:190,63:191,64:50,65:65,66:66,67:67,68:68,69:69,70:70,71:71,72:72,73:73,74:74,75:75,76:76,77:77,78:78,79:79,80:80,81:81,82:82,83:83,84:84,85:85,86:86,87:87,88:88,89:89,90:90,94:54,95:189,123:219,124:220,125:221,126:192};var _={Escape:1,Digit1:2,Digit2:3,Digit3:4,Digit4:5,Digit5:6,Digit6:7,Digit7:8,Digit8:9,Digit9:10,Digit0:11,Minus:12,Equal:13,Backspace:14,Tab:15,KeyQ:16,KeyW:17,KeyE:18,KeyR:19,KeyT:20,KeyY:21,KeyU:22,KeyI:23,KeyO:24,KeyP:25,BracketLeft:26,BracketRight:27,Enter:28,ControlLeft:29,KeyA:30,KeyS:31,KeyD:32,KeyF:33,KeyG:34,KeyH:35,KeyJ:36,KeyK:37,KeyL:38,Semicolon:39,Quote:40,Backquote:41,ShiftLeft:42,Backslash:43,KeyZ:44,KeyX:45,KeyC:46,KeyV:47,KeyB:48,KeyN:49,KeyM:50,Comma:51,Period:52,Slash:53,IntlRo:53,ShiftRight:54,NumpadMultiply:55,AltLeft:56,Space:57,CapsLock:58,F1:59,F2:60,F3:61,F4:62,F5:63,F6:64,F7:65,F8:66,F9:67,F10:68,NumLock:69,ScrollLock:70,Numpad7:71,Numpad8:72,Numpad9:73,NumpadSubtract:74,Numpad4:75,Numpad5:76,Numpad6:77,NumpadAdd:78,Numpad1:79,Numpad2:80,Numpad3:81,Numpad0:82,NumpadDecimal:83,IntlBackslash:86,F11:87,F12:88,NumpadEnter:57372,ControlRight:57373,NumpadDivide:57397,AltRight:57400,Home:57415,ArrowUp:57416,PageUp:57417,ArrowLeft:57419,ArrowRight:57421,End:57423,ArrowDown:57424,PageDown:57425,Insert:57426,Delete:57427,MetaLeft:57435,OSLeft:57435,MetaRight:57436,OSRight:57436,ContextMenu:57437};this.bus=e,this.destroy=function(){typeof window<"u"&&(window.removeEventListener("keyup",i,!1),window.removeEventListener("keydown",s,!1),window.removeEventListener("blur",n,!1),window.removeEventListener("input",a,!1))},this.init=function(){typeof window<"u"&&(this.destroy(),window.addEventListener("keyup",i,!1),window.addEventListener("keydown",s,!1),window.addEventListener("blur",n,!1),window.addEventListener("input",a,!1))},this.init(),this.simulate_press=function(d){d={keyCode:d},c(d,!0),c(d,!1)},this.simulate_char=function(d){var y=d.charCodeAt(0);y in h?this.simulate_press(h[y]):y in p?(u(42),this.simulate_press(p[y]),u(170)):console.log("ascii -> keyCode not found: ",y,d)}}function om(e,t){function i(h){if(!v.enabled||!v.emu_enabled)return!1;var p=t||document.body,_;if(!(_=document.pointerLockElement))e:{for(h=h.target;h.parentNode;){if(h===p){_=!0;break e}h=h.parentNode}_=!1}return _}function s(h){i(h)&&(h=h.changedTouches)&&h.length&&(h=h[h.length-1],g=h.clientX,C=h.clientY)}function n(){(f||m||l)&&(v.bus.send("mouse-click",[!1,!1,!1]),f=m=l=!1)}function a(h){if(v.bus&&i(h)&&v.is_running){var p=0,_=0,d=h.changedTouches;d?d.length&&(d=d[d.length-1],p=d.clientX-g,_=d.clientY-C,g=d.clientX,C=d.clientY,h.preventDefault()):typeof h.movementX=="number"?(p=h.movementX,_=h.movementY):typeof h.webkitMovementX=="number"?(p=h.webkitMovementX,_=h.webkitMovementY):typeof h.mozMovementX=="number"?(p=h.mozMovementX,_=h.mozMovementY):(p=h.clientX-g,_=h.clientY-C,g=h.clientX,C=h.clientY),v.bus.send("mouse-delta",[1*p,-(1*_)]),t&&v.bus.send("mouse-absolute",[h.pageX-t.offsetLeft,h.pageY-t.offsetTop,t.offsetWidth,t.offsetHeight])}}function c(h){i(h)&&o(h,!0)}function r(h){i(h)&&o(h,!1)}function o(h,p){v.bus&&(h.which===1?f=p:h.which===2?m=p:h.which===3&&(l=p),v.bus.send("mouse-click",[f,m,l]),h.preventDefault())}function u(h){if(i(h)){var p=h.wheelDelta||-h.detail;0>p?p=-1:0<p&&(p=1),v.bus.send("mouse-wheel",[p,0]),h.preventDefault()}}var f=!1,l=!1,m=!1,g=0,C=0,v=this;this.enabled=!1,this.emu_enabled=!0,this.bus=e,this.bus.register("mouse-enable",function(h){this.enabled=h},this),this.is_running=!1,this.bus.register("emulator-stopped",function(){this.is_running=!1},this),this.bus.register("emulator-started",function(){this.is_running=!0},this),this.destroy=function(){typeof window<"u"&&(window.removeEventListener("touchstart",s,!1),window.removeEventListener("touchend",n,!1),window.removeEventListener("touchmove",a,!1),window.removeEventListener("mousemove",a,!1),window.removeEventListener("mousedown",c,!1),window.removeEventListener("mouseup",r,!1),window.removeEventListener("wheel",u,{passive:!1}))},this.init=function(){typeof window<"u"&&(this.destroy(),window.addEventListener("touchstart",s,!1),window.addEventListener("touchend",n,!1),window.addEventListener("touchmove",a,!1),window.addEventListener("mousemove",a,!1),window.addEventListener("mousedown",c,!1),window.addEventListener("mouseup",r,!1),window.addEventListener("wheel",u,{passive:!1}))},this.init()}function am(e){var t,i=0,s=0,n=dh(e?.encoding);this.put_char=function(a,c,r){t[a*i+c]=r},this.destroy=function(){},this.pause=function(){},this.continue=function(){},this.set_mode=function(){},this.set_font_bitmap=function(){},this.set_font_page=function(){},this.clear_screen=function(){},this.set_size_text=function(a,c){(a!==i||c!==s)&&(t=new Uint8Array(a*c),i=a,s=c)},this.set_size_graphical=function(){},this.set_scale=function(){},this.update_cursor_scanline=function(){},this.update_cursor=function(){},this.update_buffer=function(){},this.get_text_screen=function(){for(var a=[],c=0;c<s;c++)a.push(this.get_text_row(c));return a},this.get_text_row=function(a){return a*=i,Array.from(t.subarray(a,a+i),c=>n[c]).join("")},this.set_size_text(80,25)}function hm(e,t){function i(r){c.bus&&c.enabled&&(c.send_char(r.which),r.preventDefault())}function s(r){var o=r.which;o===8?(c.send_char(127),r.preventDefault()):o===9&&(c.send_char(9),r.preventDefault())}function n(r){if(c.enabled){for(var o=r.clipboardData.getData("text/plain"),u=0;u<o.length;u++)c.send_char(o.charCodeAt(u));r.preventDefault()}}function a(r){r.target!==e&&e.blur()}var c=this;this.enabled=!0,this.bus=t,this.text="",this.text_new_line=!1,this.last_update=0,this.bus.register("serial0-output-byte",function(r){r=String.fromCharCode(r),this.show_char(r)},this),this.destroy=function(){e.removeEventListener("keypress",i,!1),e.removeEventListener("keydown",s,!1),e.removeEventListener("paste",n,!1),window.removeEventListener("mousedown",a,!1)},this.init=function(){this.destroy(),e.style.display="block",e.addEventListener("keypress",i,!1),e.addEventListener("keydown",s,!1),e.addEventListener("paste",n,!1),window.addEventListener("mousedown",a,!1)},this.init(),this.show_char=function(r){r==="\b"?(this.text=this.text.slice(0,-1),this.update()):r!=="\r"&&(this.text+=r,r===`
`&&(this.text_new_line=!0),this.update())},this.update=function(){var r=Date.now(),o=r-this.last_update;16>o?this.update_timer===void 0&&(this.update_timer=setTimeout(()=>{this.update_timer=void 0,this.last_update=Date.now(),this.render()},16-o)):(this.update_timer!==void 0&&(clearTimeout(this.update_timer),this.update_timer=void 0),this.last_update=r,this.render())},this.render=function(){e.value=this.text,this.text_new_line&&(this.text_new_line=!1,e.scrollTop=1e9)},this.send_char=function(r){c.bus&&c.bus.send("serial0-input",r)}}function $n(e,t){if(this.element=e,window.Terminal){var i=this.term=new window.Terminal({logLevel:"off",convertEol:"true"});i.write("This is the serial console. Whatever you type or paste here will be sent to COM1");var s=new TextEncoder,n=i.onData(function(a){for(const c of s.encode(a))t.send("serial0-input",c)});t.register("serial0-output-byte",function(a){i.write(Uint8Array.of(a))},this),this.destroy=function(){n.dispose(),i.dispose()}}}$n.prototype.show=function(){this.term&&this.term.open(this.element)};function kh(e,t){t=t.id||0,this.bus=e,this.bus_send_msgid=`net${t}-send`,this.bus_recv_msgid=`net${t}-receive`,this.channel=new BroadcastChannel(`v86-inbrowser-${t}`),this.is_open=!0,this.nic_to_hub_fn=i=>{this.channel.postMessage(i)},this.bus.register(this.bus_send_msgid,this.nic_to_hub_fn,this),this.hub_to_nic_fn=i=>{this.bus.send(this.bus_recv_msgid,i.data)},this.channel.addEventListener("message",this.hub_to_nic_fn)}kh.prototype.destroy=function(){this.is_open&&(this.bus.unregister(this.bus_send_msgid,this.nic_to_hub_fn),this.channel.removeEventListener("message",this.hub_to_nic_fn),this.channel.close(),this.is_open=!1)};function yr(){this.filedata=new Map}yr.prototype.read=async function(e,t,i){return(e=this.filedata.get(e))?e.subarray(t,t+i):null};yr.prototype.cache=async function(e,t){this.filedata.set(e,t)};yr.prototype.uncache=function(e){this.filedata.delete(e)};function Ms(e,t){t.endsWith("/")||(t+="/"),this.storage=e,this.baseurl=t}Ms.prototype.load_from_server=function(e){return new Promise(t=>{xt(this.baseurl+e,{done:async i=>{i=new Uint8Array(i),await this.cache(e,i),t(i)}})})};Ms.prototype.read=async function(e,t,i){const s=await this.storage.read(e,t,i);return s||(await this.load_from_server(e)).subarray(t,t+i)};Ms.prototype.cache=async function(e,t){return await this.storage.cache(e,t)};Ms.prototype.uncache=function(e){this.storage.uncache(e)};const cm=new TextDecoder,lm=new TextEncoder;function Ge(e,t,i,s){for(var n,a=0,c=0;c<e.length;c++)switch(n=t[c],e[c]){case"w":i[s++]=n&255,i[s++]=n>>8&255,i[s++]=n>>16&255,i[s++]=n>>24&255,a+=4;break;case"d":i[s++]=n&255,i[s++]=n>>8&255,i[s++]=n>>16&255,i[s++]=n>>24&255,i[s++]=0,i[s++]=0,i[s++]=0,i[s++]=0,a+=8;break;case"h":i[s++]=n&255,i[s++]=n>>8,a+=2;break;case"b":i[s++]=n,a+=1;break;case"s":var r=s,o=0;i[s++]=0,i[s++]=0,a+=2,n=lm.encode(n),a+=n.byteLength,o+=n.byteLength,i.set(n,s),s+=n.byteLength,i[r+0]=o&255,i[r+1]=o>>8&255;break;case"Q":Ge(["b","w","d"],[n.type,n.version,n.path],i,s),s+=13,a+=13}return a}function Le(e,t,i){let s=i.offset;for(var n=[],a=0;a<e.length;a++)switch(e[a]){case"w":var c=t[s++];c+=t[s++]<<8,c+=t[s++]<<16,c+=t[s++]<<24>>>0,n.push(c);break;case"d":c=t[s++],c+=t[s++]<<8,c+=t[s++]<<16,c+=t[s++]<<24>>>0,s+=4,n.push(c);break;case"h":c=t[s++],n.push(c+(t[s++]<<8));break;case"b":n.push(t[s++]);break;case"s":c=t[s++],c+=t[s++]<<8;var r=t.slice(s,s+c);s+=c,n.push(cm.decode(r));break;case"Q":i.offset=s,c=Le(["b","w","d"],t,i),s=i.offset,n.push({type:c[0],version:c[1],path:c[2]})}return i.offset=s,n}const da=new TextEncoder;function pe(e,t){this.inodes=[],this.storage=e,this.qidcounter=t||{last_qidnumber:0},this.inodedata={},this.total_size=274877906944,this.used_size=0,this.mounts=[],this.CreateDirectory("",-1)}pe.prototype.get_state=function(){let e=[];e[0]=this.inodes,e[1]=this.qidcounter.last_qidnumber,e[2]=[];for(const[t,i]of Object.entries(this.inodedata))(this.inodes[t].mode&16384)===0&&e[2].push([t,i]);return e[3]=this.total_size,e[4]=this.used_size,e=e.concat(this.mounts)};pe.prototype.set_state=function(e){this.inodes=e[0].map(t=>{const i=new Bs(0);return i.set_state(t),i}),this.qidcounter.last_qidnumber=e[1],this.inodedata={};for(let[t,i]of e[2])i.buffer.byteLength!==i.byteLength&&(i=i.slice()),this.inodedata[t]=i;this.total_size=e[3],this.used_size=e[4],this.mounts=e.slice(5)};pe.prototype.load_from_json=function(e){if(e.version!==3)throw"The filesystem JSON format has changed. Please recreate the filesystem JSON.";var t=e.fsroot;for(this.used_size=e.size,e=0;e<t.length;e++)this.LoadRecursive(t[e],0)};pe.prototype.LoadRecursive=function(e,t){var i=this.CreateInode();const s=e[0];i.size=e[1],i.mtime=e[2],i.ctime=i.mtime,i.atime=i.mtime,i.mode=e[3],i.uid=e[4],i.gid=e[5];var n=i.mode&61440;n===16384?(this.PushInode(i,t,s),this.LoadDir(this.inodes.length-1,e[6])):n===32768?(i.status=2,i.sha256sum=e[6],this.PushInode(i,t,s)):n===40960?(i.symlink=e[6],this.PushInode(i,t,s)):n!==49152&&A(n)};pe.prototype.LoadDir=function(e,t){for(var i=0;i<t.length;i++)this.LoadRecursive(t[i],e)};pe.prototype.should_be_linked=function(e){return!this.is_forwarder(e)||e.foreign_id===0};pe.prototype.link_under_dir=function(e,t,i){const s=this.inodes[t],n=this.inodes[e];this.is_forwarder(n),this.IsDirectory(e),this.should_be_linked(s),n.direntries.has(i),n.direntries.set(i,t),s.nlinks++,this.IsDirectory(t)&&(s.direntries.has(".."),s.direntries.has(".")||s.nlinks++,s.direntries.set(".",t),s.direntries.set("..",e),n.nlinks++)};pe.prototype.unlink_from_dir=function(e,t){const i=this.Search(e,t),s=this.inodes[i],n=this.inodes[e];this.is_forwarder(n),this.IsDirectory(e),n.direntries.delete(t)&&(s.nlinks--,this.IsDirectory(i)&&(s.direntries.get(".."),s.direntries.delete(".."),n.nlinks--))};pe.prototype.PushInode=function(e,t,i){t!==-1?(this.inodes.push(e),e.fid=this.inodes.length-1,this.link_under_dir(t,e.fid,i)):this.inodes.length===0&&(this.inodes.push(e),e.direntries.set(".",0),e.direntries.set("..",0),e.nlinks=2)};function Bs(e){this.direntries=new Map,this.minor=this.major=this.mtime=this.atime=this.ctime=this.fid=this.gid=this.uid=this.size=this.status=0,this.symlink="",this.mode=493,this.qid={type:0,version:0,path:e},this.caps=void 0,this.nlinks=0,this.sha256sum="",this.locks=[],this.foreign_id=this.mount_id=-1}Bs.prototype.get_state=function(){const e=[];return e[0]=this.mode,e[1]=(this.mode&61440)===16384?[...this.direntries]:(this.mode&61440)===32768?this.sha256sum:(this.mode&61440)===40960?this.symlink:(this.mode&61440)===49152?[this.minor,this.major]:null,e[2]=this.locks,e[3]=this.status,e[4]=this.size,e[5]=this.uid,e[6]=this.gid,e[7]=this.fid,e[8]=this.ctime,e[9]=this.atime,e[10]=this.mtime,e[11]=this.qid.version,e[12]=this.qid.path,e[13]=this.nlinks,e};Bs.prototype.set_state=function(e){if(this.mode=e[0],(this.mode&61440)===16384){this.direntries=new Map;for(const[t,i]of e[1])this.direntries.set(t,i)}else(this.mode&61440)===32768?this.sha256sum=e[1]:(this.mode&61440)===40960?this.symlink=e[1]:(this.mode&61440)===49152&&([this.minor,this.major]=e[1]);this.locks=[];for(const t of e[2]){const i=new ui;i.set_state(t),this.locks.push(i)}this.status=e[3],this.size=e[4],this.uid=e[5],this.gid=e[6],this.fid=e[7],this.ctime=e[8],this.atime=e[9],this.mtime=e[10],this.qid.type=(this.mode&61440)>>8,this.qid.version=e[11],this.qid.path=e[12],this.nlinks=e[13]};pe.prototype.divert=function(e,t){const i=this.Search(e,t),s=this.inodes[i],n=new Bs(-1);this.IsDirectory(i),Object.assign(n,s);const a=this.inodes.length;if(this.inodes.push(n),n.fid=a,this.is_forwarder(s)&&this.mounts[s.mount_id].backtrack.set(s.foreign_id,a),this.should_be_linked(s)&&(this.unlink_from_dir(e,t),this.link_under_dir(e,a,t)),this.IsDirectory(i)&&!this.is_forwarder(s))for(const[c,r]of n.direntries)c!=="."&&c!==".."&&this.IsDirectory(r)&&this.inodes[r].direntries.set("..",a);return this.inodedata[a]=this.inodedata[i],delete this.inodedata[i],s.direntries=new Map,s.nlinks=0,a};pe.prototype.copy_inode=function(e,t){Object.assign(t,e,{fid:t.fid,direntries:t.direntries,nlinks:t.nlinks})};pe.prototype.CreateInode=function(){const e=Math.round(Date.now()/1e3),t=new Bs(++this.qidcounter.last_qidnumber);return t.atime=t.ctime=t.mtime=e,t};pe.prototype.CreateDirectory=function(e,t){var i=this.inodes[t];return 0<=t&&this.is_forwarder(i)?(t=i.foreign_id,e=this.follow_fs(i).CreateDirectory(e,t),this.create_forwarder(i.mount_id,e)):(i=this.CreateInode(),i.mode=16895,0<=t&&(i.uid=this.inodes[t].uid,i.gid=this.inodes[t].gid,i.mode=this.inodes[t].mode&511|16384),i.qid.type=64,this.PushInode(i,t,e),this.NotifyListeners(this.inodes.length-1,"newdir"),this.inodes.length-1)};pe.prototype.CreateFile=function(e,t){var i=this.inodes[t];return this.is_forwarder(i)?(t=i.foreign_id,e=this.follow_fs(i).CreateFile(e,t),this.create_forwarder(i.mount_id,e)):(i=this.CreateInode(),i.uid=this.inodes[t].uid,i.gid=this.inodes[t].gid,i.qid.type=128,i.mode=this.inodes[t].mode&438|32768,this.PushInode(i,t,e),this.NotifyListeners(this.inodes.length-1,"newfile"),this.inodes.length-1)};pe.prototype.CreateNode=function(e,t,i,s){var n=this.inodes[t];return this.is_forwarder(n)?(t=n.foreign_id,e=this.follow_fs(n).CreateNode(e,t,i,s),this.create_forwarder(n.mount_id,e)):(n=this.CreateInode(),n.major=i,n.minor=s,n.uid=this.inodes[t].uid,n.gid=this.inodes[t].gid,n.qid.type=192,n.mode=this.inodes[t].mode&438,this.PushInode(n,t,e),this.inodes.length-1)};pe.prototype.CreateSymlink=function(e,t,i){var s=this.inodes[t];return this.is_forwarder(s)?(t=s.foreign_id,e=this.follow_fs(s).CreateSymlink(e,t,i),this.create_forwarder(s.mount_id,e)):(s=this.CreateInode(),s.uid=this.inodes[t].uid,s.gid=this.inodes[t].gid,s.qid.type=160,s.symlink=i,s.mode=40960,this.PushInode(s,t,e),this.inodes.length-1)};pe.prototype.CreateTextFile=async function(e,t,i){var s=this.inodes[t];if(this.is_forwarder(s))return t=s.foreign_id,i=await this.follow_fs(s).CreateTextFile(e,t,i),this.create_forwarder(s.mount_id,i);for(s=this.CreateFile(e,t),t=this.inodes[s],e=new Uint8Array(i.length),t.size=i.length,t=0;t<i.length;t++)e[t]=i.charCodeAt(t);return await this.set_data(s,e),s};pe.prototype.CreateBinaryFile=async function(e,t,i){var s=this.inodes[t];return this.is_forwarder(s)?(t=s.foreign_id,i=await this.follow_fs(s).CreateBinaryFile(e,t,i),this.create_forwarder(s.mount_id,i)):(s=this.CreateFile(e,t),e=this.inodes[s],t=new Uint8Array(i.length),t.set(i),await this.set_data(s,t),e.size=i.length,s)};pe.prototype.OpenInode=async function(e,t){var i=this.inodes[e];if(this.is_forwarder(i))return await this.follow_fs(i).OpenInode(i.foreign_id,t);(i.mode&61440)===16384&&this.FillDirectory(e)};pe.prototype.CloseInode=async function(e){var t=this.inodes[e];if(this.is_forwarder(t))return await this.follow_fs(t).CloseInode(t.foreign_id);t.status===2&&this.storage.uncache(t.sha256sum),t.status===4&&(t.status=-1,await this.DeleteData(e))};pe.prototype.Rename=async function(e,t,i,s){if(e===i&&t===s)return 0;var n=this.Search(e,t);if(n===-1)return-2;var a=this.GetFullPath(e)+"/"+t;if(this.Search(i,s)!==-1){var c=this.Unlink(i,s);if(0>c)return c}var r=this.inodes[n],o=this.inodes[e];if(c=this.inodes[i],this.is_forwarder(o)||this.is_forwarder(c))if(this.is_forwarder(o)&&o.mount_id===c.mount_id){if(e=await this.follow_fs(o).Rename(o.foreign_id,t,c.foreign_id,s),0>e)return e}else{if(this.is_a_root(n)||!this.IsDirectory(n)&&1<this.GetInode(n).nlinks)return-1;o=this.divert(e,t);const u=this.GetInode(n),f=await this.Read(o,0,u.size);if(this.is_forwarder(c)?(i=this.follow_fs(c),s=this.IsDirectory(o)?i.CreateDirectory(s,c.foreign_id):i.CreateFile(s,c.foreign_id),i=i.GetInode(s),this.copy_inode(u,i),this.set_forwarder(n,c.mount_id,s)):(this.delete_forwarder(r),this.copy_inode(u,r),this.link_under_dir(i,n,s)),await this.ChangeSize(n,u.size),f&&f.length&&await this.Write(n,0,f.length,f),this.IsDirectory(n)){for(const l of this.GetChildren(o))if(c=await this.Rename(o,l,n,l),0>c)return c}if(await this.DeleteData(o),e=this.Unlink(e,t),0>e)return e}else this.unlink_from_dir(e,t),this.link_under_dir(i,n,s),r.qid.version++;return this.NotifyListeners(n,"rename",{oldpath:a}),0};pe.prototype.Write=async function(e,t,i,s){this.NotifyListeners(e,"write");var n=this.inodes[e];if(this.is_forwarder(n))e=n.foreign_id,await this.follow_fs(n).Write(e,t,i,s);else{var a=await this.get_buffer(e);!a||a.length<t+i?(await this.ChangeSize(e,Math.floor(3*(t+i)/2)),n.size=t+i,a=await this.get_buffer(e)):n.size<t+i&&(n.size=t+i),s&&a.set(s.subarray(0,i),t),await this.set_data(e,a)}};pe.prototype.Read=async function(e,t,i){const s=this.inodes[e];return this.is_forwarder(s)?(e=s.foreign_id,await this.follow_fs(s).Read(e,t,i)):await this.get_data(e,t,i)};pe.prototype.Search=function(e,t){if(e=this.inodes[e],this.is_forwarder(e)){const i=e.foreign_id;return t=this.follow_fs(e).Search(i,t),t===-1?-1:this.get_forwarder(e.mount_id,t)}return t=e.direntries.get(t),t===void 0?-1:t};pe.prototype.CountUsedInodes=function(){let e=this.inodes.length;for(const{fs:t,backtrack:i}of this.mounts)e+=t.CountUsedInodes(),e-=i.size;return e};pe.prototype.CountFreeInodes=function(){let e=1048576;for(const{fs:t}of this.mounts)e+=t.CountFreeInodes();return e};pe.prototype.GetTotalSize=function(){let e=this.used_size;for(const{fs:t}of this.mounts)e+=t.GetTotalSize();return e};pe.prototype.GetSpace=function(){let e=this.total_size;for(const{fs:t}of this.mounts)e+=t.GetSpace();return this.total_size};pe.prototype.GetDirectoryName=function(e){const t=this.inodes[this.GetParent(e)];if(this.is_forwarder(t))return this.follow_fs(t).GetDirectoryName(this.inodes[e].foreign_id);if(!t)return"";for(const[i,s]of t.direntries)if(s===e)return i;return""};pe.prototype.GetFullPath=function(e){this.IsDirectory(e);for(var t="";e!==0;)t="/"+this.GetDirectoryName(e)+t,e=this.GetParent(e);return t.substring(1)};pe.prototype.Link=function(e,t,i){if(this.IsDirectory(t))return-1;const s=this.inodes[e],n=this.inodes[t];return this.is_forwarder(s)?this.is_forwarder(n)&&n.mount_id===s.mount_id?this.follow_fs(s).Link(s.foreign_id,n.foreign_id,i):-1:this.is_forwarder(n)?-1:(this.link_under_dir(e,t,i),0)};pe.prototype.Unlink=function(e,t){if(t==="."||t==="..")return-1;const i=this.Search(e,t),s=this.inodes[i],n=this.inodes[e];return this.is_forwarder(n)?(this.is_forwarder(s),e=n.foreign_id,this.follow_fs(n).Unlink(e,t)):this.IsDirectory(i)&&!this.IsEmpty(i)?-39:(this.unlink_from_dir(e,t),s.nlinks===0&&(s.status=4,this.NotifyListeners(i,"delete")),0)};pe.prototype.DeleteData=async function(e){const t=this.inodes[e];this.is_forwarder(t)?await this.follow_fs(t).DeleteData(t.foreign_id):(t.size=0,delete this.inodedata[e])};pe.prototype.get_buffer=async function(e){const t=this.inodes[e];return this.inodedata[e]?this.inodedata[e]:t.status===2?await this.storage.read(t.sha256sum,0,t.size):null};pe.prototype.get_data=async function(e,t,i){const s=this.inodes[e];return this.inodedata[e]?this.inodedata[e].subarray(t,t+i):s.status===2?await this.storage.read(s.sha256sum,t,i):null};pe.prototype.set_data=async function(e,t){this.inodedata[e]=t,this.inodes[e].status===2&&(this.inodes[e].status=0,this.storage.uncache(this.inodes[e].sha256sum))};pe.prototype.GetInode=function(e){return e=this.inodes[e],this.is_forwarder(e)?this.follow_fs(e).GetInode(e.foreign_id):e};pe.prototype.ChangeSize=async function(e,t){var i=this.GetInode(e),s=await this.get_data(e,0,i.size);if(t!==i.size){var n=new Uint8Array(t);i.size=t,s&&n.set(s.subarray(0,Math.min(s.length,i.size)),0),await this.set_data(e,n)}};pe.prototype.SearchPath=function(e){e=e.replace("//","/"),e=e.split("/"),0<e.length&&e[e.length-1].length===0&&e.pop(),0<e.length&&e[0].length===0&&e.shift();const t=e.length;var i=-1,s=0;let n=null;for(var a=0;a<t;a++)if(i=s,s=this.Search(i,e[a]),!n&&this.is_forwarder(this.inodes[i])&&(n="/"+e.slice(a).join("/")),s===-1)return a<t-1?{id:-1,parentid:-1,name:e[a],forward_path:n}:{id:-1,parentid:i,name:e[a],forward_path:n};return{id:s,parentid:i,name:e[a],forward_path:n}};pe.prototype.GetRecursiveList=function(e,t){if(this.is_forwarder(this.inodes[e])){const i=this.follow_fs(this.inodes[e]),s=this.inodes[e].mount_id,n=t.length;for(i.GetRecursiveList(this.inodes[e].foreign_id,t),e=n;e<t.length;e++)t[e].parentid=this.get_forwarder(s,t[e].parentid)}else for(const[i,s]of this.inodes[e].direntries)i!=="."&&i!==".."&&(t.push({parentid:e,name:i}),this.IsDirectory(s)&&this.GetRecursiveList(s,t))};pe.prototype.RecursiveDelete=function(e){var t=[];if(e=this.SearchPath(e),e.id!==-1)for(this.GetRecursiveList(e.id,t),e=t.length-1;0<=e;e--)this.Unlink(t[e].parentid,t[e].name)};pe.prototype.DeleteNode=function(e){var t=this.SearchPath(e);t.id!==-1&&((this.inodes[t.id].mode&61440)===32768?this.Unlink(t.parentid,t.name):(this.inodes[t.id].mode&61440)===16384&&(this.RecursiveDelete(e),this.Unlink(t.parentid,t.name)))};pe.prototype.NotifyListeners=function(){};pe.prototype.Check=function(){for(var e=1;e<this.inodes.length;e++)if(this.inodes[e].status!==-1&&(this.GetInode(e),this.IsDirectory(e))){const t=this.GetInode(e);this.IsDirectory(e)&&this.GetParent(e);for(const[i]of t.direntries)for(const s of i);}};pe.prototype.FillDirectory=function(e){var t=this.inodes[e];if(this.is_forwarder(t))this.follow_fs(t).FillDirectory(t.foreign_id);else{var i=0;for(const s of t.direntries.keys())i+=24+da.encode(s).length;e=this.inodedata[e]=new Uint8Array(i),t.size=i,i=0;for(const[s,n]of t.direntries)t=this.GetInode(n),i+=Ge(["Q","d","b","s"],[t.qid,i+13+8+1+2+da.encode(s).length,t.mode>>12,s],e,i)}};pe.prototype.RoundToDirentry=function(e,t){if(e=this.inodedata[e],t>=e.length)return e.length;let i=0;for(;;){const s=Le(["Q","d"],e,{offset:i})[1];if(s>t)break;i=s}return i};pe.prototype.IsDirectory=function(e){return e=this.inodes[e],this.is_forwarder(e)?this.follow_fs(e).IsDirectory(e.foreign_id):(e.mode&61440)===16384};pe.prototype.IsEmpty=function(e){if(e=this.inodes[e],this.is_forwarder(e))return this.follow_fs(e).IsDirectory(e.foreign_id);for(const t of e.direntries.keys())if(t!=="."&&t!=="..")return!1;return!0};pe.prototype.GetChildren=function(e){if(this.IsDirectory(e),e=this.inodes[e],this.is_forwarder(e))return this.follow_fs(e).GetChildren(e.foreign_id);const t=[];for(const i of e.direntries.keys())i!=="."&&i!==".."&&t.push(i);return t};pe.prototype.GetParent=function(e){if(this.IsDirectory(e),e=this.inodes[e],this.should_be_linked(e))return e.direntries.get("..");const t=this.follow_fs(e).GetParent(e.foreign_id);return this.get_forwarder(e.mount_id,t)};pe.prototype.PrepareCAPs=function(e){return e=this.GetInode(e),e.caps||(e.caps=new Uint8Array(20),e.caps[0]=0,e.caps[1]=0,e.caps[2]=0,e.caps[3]=2,e.caps[4]=255,e.caps[5]=255,e.caps[6]=255,e.caps[7]=255,e.caps[8]=255,e.caps[9]=255,e.caps[10]=255,e.caps[11]=255,e.caps[12]=63,e.caps[13]=0,e.caps[14]=0,e.caps[15]=0,e.caps[16]=63,e.caps[17]=0,e.caps[18]=0,e.caps[19]=0),e.caps.length};function jn(e){this.fs=e,this.backtrack=new Map}jn.prototype.get_state=function(){const e=[];return e[0]=this.fs,e[1]=[...this.backtrack],e};jn.prototype.set_state=function(e){this.fs=e[0],this.backtrack=new Map(e[1])};pe.prototype.set_forwarder=function(e,t,i){const s=this.inodes[e];this.is_forwarder(s)&&this.mounts[s.mount_id].backtrack.delete(s.foreign_id),s.status=5,s.mount_id=t,s.foreign_id=i,this.mounts[t].backtrack.set(i,e)};pe.prototype.create_forwarder=function(e,t){const i=this.CreateInode(),s=this.inodes.length;return this.inodes.push(i),i.fid=s,this.set_forwarder(s,e,t),s};pe.prototype.is_forwarder=function(e){return e.status===5};pe.prototype.is_a_root=function(e){return this.GetInode(e).fid===0};pe.prototype.get_forwarder=function(e,t){const i=this.mounts[e].backtrack.get(t);return i===void 0?this.create_forwarder(e,t):i};pe.prototype.delete_forwarder=function(e){this.is_forwarder(e),e.status=-1,this.mounts[e.mount_id].backtrack.delete(e.foreign_id)};pe.prototype.follow_fs=function(e){const t=this.mounts[e.mount_id];return this.is_forwarder(e),t.fs};pe.prototype.Mount=function(e,t){if(e=this.SearchPath(e),e.parentid===-1)return-2;if(e.id!==-1)return-17;if(e.forward_path){var i=this.inodes[e.parentid];return t=this.follow_fs(i).Mount(e.forward_path,t),0>t?t:this.get_forwarder(i.mount_id,t)}return i=this.mounts.length,this.mounts.push(new jn(t)),t=this.create_forwarder(i,0),this.link_under_dir(e.parentid,t,e.name),t};function ui(){this.type=2,this.start=0,this.length=1/0,this.proc_id=-1,this.client_id=""}ui.prototype.get_state=function(){const e=[];return e[0]=this.type,e[1]=this.start,e[2]=this.length===1/0?0:this.length,e[3]=this.proc_id,e[4]=this.client_id,e};ui.prototype.set_state=function(e){this.type=e[0],this.start=e[1],this.length=e[2]===0?1/0:e[2],this.proc_id=e[3],this.client_id=e[4]};ui.prototype.clone=function(){const e=new ui;return e.set_state(this.get_state()),e};ui.prototype.conflicts_with=function(e){return!(this.proc_id===e.proc_id&&this.client_id===e.client_id||this.type===2||e.type===2||this.type!==1&&e.type!==1||this.start+this.length<=e.start||e.start+e.length<=this.start)};ui.prototype.is_alike=function(e){return e.proc_id===this.proc_id&&e.client_id===this.client_id&&e.type===this.type};ui.prototype.may_merge_after=function(e){return this.is_alike(e)&&e.start+e.length===this.start};pe.prototype.DescribeLock=function(e,t,i,s,n){const a=new ui;return a.type=e,a.start=t,a.length=i,a.proc_id=s,a.client_id=n,a};pe.prototype.GetLock=function(e,t){if(e=this.inodes[e],this.is_forwarder(e)){var i=e.foreign_id;return this.follow_fs(e).GetLock(i,t)}for(i of e.locks)if(t.conflicts_with(i))return i.clone();return null};pe.prototype.Lock=function(e,t,i){const s=this.inodes[e];if(this.is_forwarder(s))return e=s.foreign_id,this.follow_fs(s).Lock(e,t,i);if(t=t.clone(),t.type!==2&&this.GetLock(e,t))return 1;for(i=0;i<s.locks.length;i++){if(e=s.locks[i],e.start+e.length<=t.start)continue;if(t.start+t.length<=e.start)break;if(e.proc_id!==t.proc_id||e.client_id!==t.client_id){e.conflicts_with(t);continue}var n=t.start+t.length;const a=t.start-e.start,c=e.start+e.length-n;if(0<a&&0<c&&e.type===t.type)return 0;if(0<a&&(e.length=a),0>=a&&0<c)e.start=n,e.length=c;else if(0<c){for(;i<s.locks.length&&s.locks[i].start<n;)i++;s.locks.splice(i,0,this.DescribeLock(e.type,n,c,e.proc_id,e.client_id))}else 0>=a&&(s.locks.splice(i,1),i--)}if(t.type!==2){for(i=t,e=!1,n=0;n<s.locks.length&&(i.may_merge_after(s.locks[n])&&(s.locks[n].length+=t.length,i=s.locks[n],e=!0),!(t.start<=s.locks[n].start));n++);for(e||(s.locks.splice(n,0,i),n++);n<s.locks.length;n++)if(s.locks[n].is_alike(i)){s.locks[n].may_merge_after(i)&&(i.length+=s.locks[n].length,s.locks.splice(n,1));break}}return 0};pe.prototype.read_dir=function(e){if(e=this.SearchPath(e),e.id!==-1)return e=this.GetInode(e.id),Array.from(e.direntries.keys()).filter(t=>t!=="."&&t!=="..")};pe.prototype.read_file=function(e){if(e=this.SearchPath(e),e.id===-1)return Promise.resolve(null);const t=this.GetInode(e.id);return this.Read(e.id,0,t.size)};function Ce(e){this.cpu_is_running=!1,this.cpu_exception_hook=function(){};var t=fh.create();this.bus=t[0],this.emulator_bus=t[1];var i,s;const n=new WebAssembly.Table({element:"anyfunc",initial:1924});t={cpu_exception_hook:c=>this.cpu_exception_hook(c),run_hardware_timers:function(c,r){return i.run_hardware_timers(c,r)},cpu_event_halt:()=>{this.emulator_bus.send("cpu-event-halt")},abort:function(){},microtick:Oe.microtick,get_rand_int:function(){return tr()},stop_idling:function(){return i.stop_idling()},io_port_read8:function(c){return i.io.port_read8(c)},io_port_read16:function(c){return i.io.port_read16(c)},io_port_read32:function(c){return i.io.port_read32(c)},io_port_write8:function(c,r){i.io.port_write8(c,r)},io_port_write16:function(c,r){i.io.port_write16(c,r)},io_port_write32:function(c,r){i.io.port_write32(c,r)},mmap_read8:function(c){return i.mmap_read8(c)},mmap_read16:function(c){return i.mmap_read16(c)},mmap_read32:function(c){return i.mmap_read32(c)},mmap_write8:function(c,r){i.mmap_write8(c,r)},mmap_write16:function(c,r){i.mmap_write16(c,r)},mmap_write32:function(c,r){i.mmap_write32(c,r)},mmap_write64:function(c,r,o){i.mmap_write64(c,r,o)},mmap_write128:function(c,r,o,u,f){i.mmap_write128(c,r,o,u,f)},log_from_wasm:function(c,r){pn(s,c,r)},console_log_from_wasm:function(c,r){c=pn(s,c,r),console.error(c)},dbg_trace_from_wasm:function(){},codegen_finalize:(c,r,o,u,f)=>{i.codegen_finalize(c,r,o,u,f)},jit_clear_func:c=>i.jit_clear_func(c),jit_clear_all_funcs:()=>i.jit_clear_all_funcs(),__indirect_function_table:n};let a=e.wasm_fn;a||(a=c=>new Promise(r=>{let o="v86.wasm",u="v86-fallback.wasm";e.wasm_path?(o=e.wasm_path,u=o.replace("v86.wasm","v86-fallback.wasm")):typeof window>"u"&&typeof __dirname=="string"?(o=__dirname+"/"+o,u=__dirname+"/"+u):(o="build/"+o,u="build/"+u),xt(o,{done:async f=>{try{const{instance:l}=await WebAssembly.instantiate(f,c);this.wasm_source=f,r(l.exports)}catch{xt(u,{done:async m=>{const{instance:g}=await WebAssembly.instantiate(m,c);this.wasm_source=m,r(g.exports)}})}},progress:f=>{this.emulator_bus.send("download-progress",{file_index:0,file_count:1,file_name:o,lengthComputable:f.lengthComputable,total:f.total,loaded:f.loaded})}})})),a({env:t}).then(c=>{s=c.memory,c.rust_init(),c=this.v86=new Oe(this.emulator_bus,{exports:c,wasm_table:n}),i=c.cpu,this.continue_init(c,e)}),this.zstd_worker=null,this.zstd_worker_request_id=0}Ce.prototype.continue_init=async function(e,t){function i(m,g){switch(m){case"hda":n.hda=this.disk_images.hda=g;break;case"hdb":n.hdb=this.disk_images.hdb=g;break;case"cdrom":n.cdrom=this.disk_images.cdrom=g;break;case"fda":n.fda=this.disk_images.fda=g;break;case"fdb":n.fdb=this.disk_images.fdb=g;break;case"multiboot":n.multiboot=this.disk_images.multiboot=g.buffer;break;case"bzimage":n.bzimage=this.disk_images.bzimage=g.buffer;break;case"initrd":n.initrd=this.disk_images.initrd=g.buffer;break;case"bios":n.bios=g.buffer;break;case"vga_bios":n.vga_bios=g.buffer;break;case"initial_state":n.initial_state=g.buffer;break;case"fs9p_json":n.fs9p_json=g}}async function s(){if(n.fs9p&&n.fs9p_json&&!n.initial_state&&(n.fs9p.load_from_json(n.fs9p_json),t.bzimage_initrd_from_filesystem)){const{bzimage_path:m,initrd_path:g}=this.get_bzimage_initrd_from_filesystem(n.fs9p),[C,v]=await Promise.all([n.fs9p.read_file(g),n.fs9p.read_file(m)]);i.call(this,"initrd",new it(C.buffer)),i.call(this,"bzimage",new it(v.buffer))}this.serial_adapter&&this.serial_adapter.show&&this.serial_adapter.show(),this.v86.init(n),n.initial_state&&(e.restore_state(n.initial_state),n.initial_state=void 0),t.autostart&&this.v86.run(),this.emulator_bus.send("emulator-loaded")}this.bus.register("emulator-stopped",function(){this.cpu_is_running=!1,this.screen_adapter.pause()},this),this.bus.register("emulator-started",function(){this.cpu_is_running=!0,this.screen_adapter.continue()},this);var n={};this.disk_images={fda:void 0,fdb:void 0,hda:void 0,hdb:void 0,cdrom:void 0};var a=t.boot_order?t.boot_order:t.fda?801:t.hda?786:291;n.acpi=t.acpi,n.disable_jit=t.disable_jit,n.load_devices=!0,n.memory_size=t.memory_size||67108864,n.vga_memory_size=t.vga_memory_size||8388608,n.boot_order=a,n.fastboot=t.fastboot||!1,n.fda=void 0,n.fdb=void 0,n.uart1=t.uart1,n.uart2=t.uart2,n.uart3=t.uart3,n.cmdline=t.cmdline,n.preserve_mac_from_state_image=t.preserve_mac_from_state_image,n.mac_address_translation=t.mac_address_translation,n.cpuid_level=t.cpuid_level,n.virtio_balloon=t.virtio_balloon,n.virtio_console=t.virtio_console,(a=t.network_relay_url||t.net_device&&t.net_device.relay_url)&&(a==="fetch"?this.network_adapter=new Wt(this.bus,t.net_device):a==="inbrowser"?this.network_adapter=new kh(this.bus,t.net_device):a.startsWith("wisp://")||a.startsWith("wisps://")?this.network_adapter=new fi(a,this.bus,t.net_device):this.network_adapter=new di(a,this.bus)),n.net_device=t.net_device||{type:"ne2k"},a=t.screen||{},t.screen_container&&(a.container=t.screen_container),t.disable_keyboard||(this.keyboard_adapter=new nm(this.bus)),t.disable_mouse||(this.mouse_adapter=new om(this.bus,a.container)),this.screen_adapter=a.container?new $p(a,()=>this.v86.cpu.devices.vga&&this.v86.cpu.devices.vga.screen_fill_buffer()):new am(a),n.screen=this.screen_adapter,n.screen_options=a,t.serial_container_xtermjs?this.serial_adapter=new $n(t.serial_container_xtermjs,this.bus):t.serial_container&&(this.serial_adapter=new hm(t.serial_container,this.bus)),t.disable_speaker||(this.speaker_adapter=new bh(this.bus));var c=[];if(a=(m,g)=>{g&&(g.get&&g.set&&g.load?c.push({name:m,loadable:g}):((m==="bios"||m==="vga_bios"||m==="initial_state"||m==="multiboot"||m==="bzimage"||m==="initrd")&&(g.async=!1),(m==="fda"||m==="fdb")&&(g.async=!1),g.url&&!g.async?c.push({name:m,url:g.url,size:g.size}):c.push({name:m,loadable:fr(g,this.zstd_decompress_worker.bind(this))})))},t.state&&console.warn("Warning: Unknown option 'state'. Did you mean 'initial_state'?"),a("bios",t.bios),a("vga_bios",t.vga_bios),a("cdrom",t.cdrom),a("hda",t.hda),a("hdb",t.hdb),a("fda",t.fda),a("fdb",t.fdb),a("initial_state",t.initial_state),a("multiboot",t.multiboot),a("bzimage",t.bzimage),a("initrd",t.initrd),t.filesystem&&t.filesystem.handle9p)n.handle9p=t.filesystem.handle9p;else if(t.filesystem&&t.filesystem.proxy_url)n.proxy9p=t.filesystem.proxy_url;else if(t.filesystem){a=t.filesystem.basefs;var r=t.filesystem.baseurl;let m=new yr;if(r&&(m=new Ms(m,r)),n.fs9p=this.fs9p=new pe(m),a){if(typeof a=="object"){var o=a.size;a=a.url}c.push({name:"fs9p_json",url:a,size:o,as_json:!0})}}var u=this,f=c.length,l=(function(m){if(m===f)setTimeout(s.bind(this),0);else{var g=c[m];g.loadable?(g.loadable.onload=(function(){i.call(this,g.name,g.loadable),l(m+1)}).bind(this),g.loadable.load()):xt(g.url,{done:(function(C){g.url.endsWith(".zst")&&g.name!=="initial_state"&&(C=this.zstd_decompress(g.size,new Uint8Array(C))),i.call(this,g.name,g.as_json?C:new it(C)),l(m+1)}).bind(this),progress:function(C){C.target.status===200?u.emulator_bus.send("download-progress",{file_index:m,file_count:f,file_name:g.url,lengthComputable:C.lengthComputable,total:C.total||g.size,loaded:C.loaded}):u.emulator_bus.send("download-error",{file_index:m,file_count:f,file_name:g.url,request:C.target})},as_json:g.as_json})}}).bind(this);l(0)};Ce.prototype.zstd_decompress=function(e,t){const i=this.v86.cpu;this.zstd_context=i.zstd_create_ctx(t.length),new Uint8Array(i.wasm_memory.buffer).set(t,i.zstd_get_src_ptr(this.zstd_context)),t=i.zstd_read(this.zstd_context,e);const s=i.wasm_memory.buffer.slice(t,t+e);return i.zstd_read_free(t,e),i.zstd_free_ctx(this.zstd_context),this.zstd_context=null,s};Ce.prototype.zstd_decompress_worker=async function(e,t){if(!this.zstd_worker){const i=URL.createObjectURL(new Blob(["("+(function(){let s;globalThis.onmessage=function(n){if(s){var{src:a,decompressed_size:c,id:r}=n.data;n=s.exports;var o=n.zstd_create_ctx(a.length);new Uint8Array(n.memory.buffer).set(a,n.zstd_get_src_ptr(o));var u=n.zstd_read(o,c),f=n.memory.buffer.slice(u,u+c);n.zstd_read_free(u,c),n.zstd_free_ctx(o),postMessage({result:f,id:r},[f])}else o=Object.fromEntries("cpu_exception_hook run_hardware_timers cpu_event_halt microtick get_rand_int stop_idling io_port_read8 io_port_read16 io_port_read32 io_port_write8 io_port_write16 io_port_write32 mmap_read8 mmap_read16 mmap_read32 mmap_write8 mmap_write16 mmap_write32 mmap_write64 mmap_write128 codegen_finalize jit_clear_func jit_clear_all_funcs".split(" ").map(l=>[l,()=>console.error("zstd worker unexpectedly called "+l)])),o.__indirect_function_table=new WebAssembly.Table({element:"anyfunc",initial:1024}),o.abort=()=>{throw Error("zstd worker aborted")},o.log_from_wasm=o.console_log_from_wasm=(l,m)=>{console.log(pn(s.exports.memory.buffer,l,m))},o.dbg_trace_from_wasm=()=>console.trace(),s=new WebAssembly.Instance(new WebAssembly.Module(n.data),{env:o})}}).toString()+")()"],{type:"text/javascript"}));this.zstd_worker=new Worker(i),URL.revokeObjectURL(i),this.zstd_worker.postMessage(this.wasm_source,[this.wasm_source])}return new Promise(i=>{const s=this.zstd_worker_request_id++,n=async a=>{a.data.id===s&&(this.zstd_worker.removeEventListener("message",n),i(a.data.result))};this.zstd_worker.addEventListener("message",n),this.zstd_worker.postMessage({src:t,decompressed_size:e,id:s},[t.buffer])})};Ce.prototype.get_bzimage_initrd_from_filesystem=function(e){const t=(e.read_dir("/")||[]).map(n=>"/"+n);e=(e.read_dir("/boot/")||[]).map(n=>"/boot/"+n);let i,s;for(const n of[].concat(t,e)){const a=/old/i.test(n)||/fallback/i.test(n),c=/vmlinuz/i.test(n)||/bzimage/i.test(n),r=/initrd/i.test(n)||/initramfs/i.test(n);!c||s&&a||(s=n),!r||i&&a||(i=n)}return i&&s||(console.log("Failed to find bzimage or initrd in filesystem. Files:"),console.log(t.join(" ")),console.log(e.join(" "))),{initrd_path:i,bzimage_path:s}};Ce.prototype.run=async function(){this.v86.run()};Ce.prototype.stop=async function(){this.cpu_is_running&&await new Promise(e=>{const t=()=>{this.remove_listener("emulator-stopped",t),e()};this.add_listener("emulator-stopped",t),this.v86.stop()})};Ce.prototype.destroy=async function(){await this.stop(),this.v86.destroy(),this.keyboard_adapter&&this.keyboard_adapter.destroy(),this.network_adapter&&this.network_adapter.destroy(),this.mouse_adapter&&this.mouse_adapter.destroy(),this.screen_adapter&&this.screen_adapter.destroy(),this.serial_adapter&&this.serial_adapter.destroy(),this.speaker_adapter&&this.speaker_adapter.destroy()};Ce.prototype.restart=function(){this.v86.restart()};Ce.prototype.add_listener=function(e,t){this.bus.register(e,t,this)};Ce.prototype.remove_listener=function(e,t){this.bus.unregister(e,t)};Ce.prototype.restore_state=async function(e){this.v86.restore_state(e)};Ce.prototype.save_state=async function(){return this.v86.save_state()};Ce.prototype.get_instruction_counter=function(){return this.v86?this.v86.cpu.instruction_counter[0]>>>0:0};Ce.prototype.is_running=function(){return this.cpu_is_running};Ce.prototype.set_fda=async function(e){const t=this.v86.cpu.devices.fdc.drives[0];if(e.url&&!e.async)await new Promise(i=>{xt(e.url,{done:s=>{t.insert_disk(new it(s)),i()}})});else{const i=fr(e,this.zstd_decompress_worker.bind(this));i.onload=()=>{t.insert_disk(i)},await i.load()}};Ce.prototype.set_fdb=async function(e){const t=this.v86.cpu.devices.fdc.drives[1];if(e.url&&!e.async)await new Promise(i=>{xt(e.url,{done:s=>{t.insert_disk(new it(s)),i()}})});else{const i=fr(e,this.zstd_decompress_worker.bind(this));i.onload=()=>{t.insert_disk(i)},await i.load()}};Ce.prototype.eject_fda=function(){this.v86.cpu.devices.fdc.drives[0].eject_disk()};Ce.prototype.eject_fdb=function(){this.v86.cpu.devices.fdc.drives[1].eject_disk()};Ce.prototype.get_disk_fda=function(){return this.v86.cpu.devices.fdc.drives[0].get_buffer()};Ce.prototype.get_disk_fdb=function(){return this.v86.cpu.devices.fdc.drives[1].get_buffer()};Ce.prototype.set_cdrom=async function(e){if(e.url&&!e.async)xt(e.url,{done:t=>{this.v86.cpu.devices.cdrom.set_cdrom(new it(t))}});else{const t=fr(e,this.zstd_decompress_worker.bind(this));t.onload=()=>{this.v86.cpu.devices.cdrom.set_cdrom(t)},await t.load()}};Ce.prototype.eject_cdrom=function(){this.v86.cpu.devices.cdrom.eject()};Ce.prototype.keyboard_send_scancodes=async function(e,t){for(var i=0;i<e.length;i++)this.bus.send("keyboard-code",e[i]),t&&await new Promise(s=>setTimeout(s,t))};Ce.prototype.keyboard_send_keys=async function(e,t){for(var i=0;i<e.length;i++)this.keyboard_adapter.simulate_press(e[i]),t&&await new Promise(s=>setTimeout(s,t))};Ce.prototype.keyboard_send_text=async function(e,t){for(var i=0;i<e.length;i++)this.keyboard_adapter.simulate_char(e[i]),t&&await new Promise(s=>setTimeout(s,t))};Ce.prototype.screen_make_screenshot=function(){return this.screen_adapter?this.screen_adapter.make_screenshot():null};Ce.prototype.screen_set_scale=function(e,t){this.screen_adapter&&this.screen_adapter.set_scale(e,t)};Ce.prototype.screen_go_fullscreen=function(){if(this.screen_adapter){var e=document.getElementById("screen_container");if(e){var t=e.requestFullScreen||e.webkitRequestFullscreen||e.mozRequestFullScreen||e.msRequestFullScreen;t&&(t.call(e),(e=document.getElementsByClassName("phone_keyboard")[0])&&e.focus());try{navigator.keyboard.lock()}catch{}this.lock_mouse()}}};Ce.prototype.lock_mouse=async function(){const e=document.body;try{await e.requestPointerLock({unadjustedMovement:!0})}catch{await e.requestPointerLock()}};Ce.prototype.mouse_set_enabled=function(e){this.mouse_adapter&&(this.mouse_adapter.emu_enabled=e)};Ce.prototype.mouse_set_status=Ce.prototype.mouse_set_enabled;Ce.prototype.keyboard_set_enabled=function(e){this.keyboard_adapter&&(this.keyboard_adapter.emu_enabled=e)};Ce.prototype.keyboard_set_status=Ce.prototype.keyboard_set_enabled;Ce.prototype.serial0_send=function(e){for(var t=0;t<e.length;t++)this.bus.send("serial0-input",e.charCodeAt(t))};Ce.prototype.serial_send_bytes=function(e,t){for(var i=0;i<t.length;i++)this.bus.send("serial"+e+"-input",t[i])};Ce.prototype.serial_set_modem_status=function(e,t){this.bus.send("serial"+e+"-modem-status-input",t)};Ce.prototype.serial_set_carrier_detect=function(e,t){this.bus.send("serial"+e+"-carrier-detect-input",t)};Ce.prototype.serial_set_ring_indicator=function(e,t){this.bus.send("serial"+e+"-ring-indicator-input",t)};Ce.prototype.serial_set_data_set_ready=function(e,t){this.bus.send("serial"+e+"-data-set-ready-input",t)};Ce.prototype.serial_set_clear_to_send=function(e,t){this.bus.send("serial"+e+"-clear-to-send-input",t)};Ce.prototype.create_file=async function(e,t){var i=this.fs9p;if(i){var s=e.split("/");if(s=s[s.length-1],e=i.SearchPath(e).parentid,s!==""&&e!==-1)await i.CreateBinaryFile(s,e,t);else return Promise.reject(new Vn)}};Ce.prototype.read_file=async function(e){var t=this.fs9p;if(t)return(e=await t.read_file(e))?e:Promise.reject(new Vn)};Ce.prototype.automatically=function(e){const t=i=>{const s=i[0];if(s){var n=i.slice(1);s.sleep?setTimeout(()=>t(n),1e3*s.sleep):s.vga_text?this.wait_until_vga_screen_contains(s.vga_text).then(()=>t(n)):s.keyboard_send?(Array.isArray(s.keyboard_send)?this.keyboard_send_scancodes(s.keyboard_send):this.keyboard_send_text(s.keyboard_send),t(n)):s.call&&(s.call(),t(n))}};t(e)};Ce.prototype.wait_until_vga_screen_contains=async function(e,t){const i=Array.isArray(e);var s=t?.timeout_msec||0;const n=new Set;t=u=>n.add(u[0]);const a=(u,f)=>f.test?f.test(u):u.startsWith(f),c=[];this.add_listener("screen-put-char",t);for(var r of this.screen_adapter.get_text_screen())if(i)c.push(r.trimRight());else if(a(r,e))return this.remove_listener("screen-put-char",t),!0;r=!1,s=s?performance.now()+s:0;e:for(;!s||performance.now()<s;){if(i){for(var o=c.length;0<o&&c[o-1]==="";)o--;if(o-=e.length,0<=o){let u=!0;for(let f=0;f<e.length&&u;f++)u=a(c[o+f],e[f]);if(u){r=!0;break}}}await new Promise(u=>setTimeout(u,100));for(const u of n)if(o=this.screen_adapter.get_text_row(u),i)c[u]=o.trimRight();else if(a(o,e)){r=!0;break e}n.clear()}return this.remove_listener("screen-put-char",t),r};Ce.prototype.read_memory=function(e,t){return this.v86.cpu.read_blob(e,t)};Ce.prototype.write_memory=function(e,t){this.v86.cpu.write_blob(e,t)};Ce.prototype.set_serial_container_xtermjs=function(e){this.serial_adapter&&this.serial_adapter.destroy&&this.serial_adapter.destroy(),this.serial_adapter=new $n(e,this.bus),this.serial_adapter.show()};Ce.prototype.get_instruction_stats=function(){var e=this.v86.cpu,t="",i="COMPILE COMPILE_SKIPPED_NO_NEW_ENTRY_POINTS COMPILE_WRONG_ADDRESS_SPACE COMPILE_CUT_OFF_AT_END_OF_PAGE COMPILE_WITH_LOOP_SAFETY COMPILE_PAGE COMPILE_PAGE/COMPILE COMPILE_BASIC_BLOCK COMPILE_DUPLICATED_BASIC_BLOCK COMPILE_WASM_BLOCK COMPILE_WASM_LOOP COMPILE_DISPATCHER COMPILE_ENTRY_POINT COMPILE_WASM_TOTAL_BYTES COMPILE_WASM_TOTAL_BYTES/COMPILE_PAGE RUN_INTERPRETED RUN_INTERPRETED_NEW_PAGE RUN_INTERPRETED_PAGE_HAS_CODE RUN_INTERPRETED_PAGE_HAS_ENTRY_AFTER_PAGE_WALK RUN_INTERPRETED_NEAR_END_OF_PAGE RUN_INTERPRETED_DIFFERENT_STATE RUN_INTERPRETED_DIFFERENT_STATE_CPL3 RUN_INTERPRETED_DIFFERENT_STATE_FLAT RUN_INTERPRETED_DIFFERENT_STATE_IS32 RUN_INTERPRETED_DIFFERENT_STATE_SS32 RUN_INTERPRETED_MISSED_COMPILED_ENTRY_RUN_INTERPRETED RUN_INTERPRETED_STEPS RUN_FROM_CACHE RUN_FROM_CACHE_STEPS RUN_FROM_CACHE_STEPS/RUN_FROM_CACHE RUN_FROM_CACHE_STEPS/RUN_INTERPRETED_STEPS DIRECT_EXIT INDIRECT_JUMP INDIRECT_JUMP_NO_ENTRY NORMAL_PAGE_CHANGE NORMAL_FALLTHRU NORMAL_FALLTHRU_WITH_TARGET_BLOCK NORMAL_BRANCH NORMAL_BRANCH_WITH_TARGET_BLOCK CONDITIONAL_JUMP CONDITIONAL_JUMP_PAGE_CHANGE CONDITIONAL_JUMP_EXIT CONDITIONAL_JUMP_FALLTHRU CONDITIONAL_JUMP_FALLTHRU_WITH_TARGET_BLOCK CONDITIONAL_JUMP_BRANCH CONDITIONAL_JUMP_BRANCH_WITH_TARGET_BLOCK DISPATCHER_SMALL DISPATCHER_LARGE LOOP LOOP_SAFETY CONDITION_OPTIMISED CONDITION_UNOPTIMISED CONDITION_UNOPTIMISED_PF CONDITION_UNOPTIMISED_UNHANDLED_L CONDITION_UNOPTIMISED_UNHANDLED_LE FAILED_PAGE_CHANGE SAFE_READ_FAST SAFE_READ_SLOW_PAGE_CROSSED SAFE_READ_SLOW_NOT_VALID SAFE_READ_SLOW_NOT_USER SAFE_READ_SLOW_IN_MAPPED_RANGE SAFE_WRITE_FAST SAFE_WRITE_SLOW_PAGE_CROSSED SAFE_WRITE_SLOW_NOT_VALID SAFE_WRITE_SLOW_NOT_USER SAFE_WRITE_SLOW_IN_MAPPED_RANGE SAFE_WRITE_SLOW_READ_ONLY SAFE_WRITE_SLOW_HAS_CODE SAFE_READ_WRITE_FAST SAFE_READ_WRITE_SLOW_PAGE_CROSSED SAFE_READ_WRITE_SLOW_NOT_VALID SAFE_READ_WRITE_SLOW_NOT_USER SAFE_READ_WRITE_SLOW_IN_MAPPED_RANGE SAFE_READ_WRITE_SLOW_READ_ONLY SAFE_READ_WRITE_SLOW_HAS_CODE PAGE_FAULT TLB_MISS MAIN_LOOP MAIN_LOOP_IDLE DO_MANY_CYCLES CYCLE_INTERNAL INVALIDATE_ALL_MODULES_NO_FREE_WASM_INDICES INVALIDATE_MODULE_WRITTEN_WHILE_COMPILED INVALIDATE_MODULE_UNUSED_AFTER_OVERWRITE INVALIDATE_MODULE_DIRTY_PAGE INVALIDATE_PAGE_HAD_CODE INVALIDATE_PAGE_HAD_ENTRY_POINTS DIRTY_PAGE_DID_NOT_HAVE_CODE RUN_FROM_CACHE_EXIT_SAME_PAGE RUN_FROM_CACHE_EXIT_NEAR_END_OF_PAGE RUN_FROM_CACHE_EXIT_DIFFERENT_PAGE CLEAR_TLB FULL_CLEAR_TLB TLB_FULL TLB_GLOBAL_FULL MODRM_SIMPLE_REG MODRM_SIMPLE_REG_WITH_OFFSET MODRM_SIMPLE_CONST_OFFSET MODRM_COMPLEX SEG_OFFSET_OPTIMISED SEG_OFFSET_NOT_OPTIMISED SEG_OFFSET_NOT_OPTIMISED_ES SEG_OFFSET_NOT_OPTIMISED_FS SEG_OFFSET_NOT_OPTIMISED_GS SEG_OFFSET_NOT_OPTIMISED_NOT_FLAT".split(" "),s=0;const n={};for(let c=0;c<i.length;c++){const r=i[c];var a=void 0;if(r.includes("/")){s++;const[o,u]=r.split("/");a=n[o]/n[u]}else a=n[r]=e.wm.exports.profiler_stat_get(c-s),a=1e8<=a?Math.round(a/1e6)+"m":1e5<=a?Math.round(a/1e3)+"k":a;t+=r+"="+a+`
`}return t+=`
`,i=e.wm.exports.get_valid_tlb_entries_count(),s=e.wm.exports.get_valid_global_tlb_entries_count(),t=t+("TLB_ENTRIES="+i+" ("+s+" global, "+(i-s)+` non-global)
WASM_TABLE_FREE=`)+(e.wm.exports.jit_get_wasm_table_index_free_list_count()+`
`),t+="JIT_CACHE_SIZE="+e.wm.exports.jit_get_cache_size()+`
`,t+="FLAT_SEGMENTS="+e.wm.exports.has_flat_segmentation()+`
`,t+="wasm memory size: "+(e.wasm_memory.buffer.byteLength>>20)+`m
`,t=t+`Config:
JIT_DISABLED=`+(e.wm.exports.get_jit_config(0)+`
`),t+="MAX_PAGES="+e.wm.exports.get_jit_config(1)+`
`,t+="JIT_USE_LOOP_SAFETY="+!!e.wm.exports.get_jit_config(2)+`
`,t+="MAX_EXTRA_BASIC_BLOCKS="+e.wm.exports.get_jit_config(3)+`
`,e=[ps(e,!1,!1,!1,!1),ps(e,!0,!1,!1,!1),ps(e,!1,!0,!1,!1),ps(e,!1,!1,!0,!1),ps(e,!1,!1,!1,!0)].join(`

`),t+e};function Vn(e){this.message=e||"File not found"}Vn.prototype=Error.prototype;typeof er<"u"&&typeof er.exports<"u"?er.exports.V86=Ce:typeof window<"u"?window.V86=Ce:typeof importScripts=="function"&&(self.V86=Ce);function Oe(e,t){this.stopping=this.running=!1,this.idle=!0,this.tick_counter=0,this.worker=null,this.cpu=new we(e,t,()=>{this.idle&&this.next_tick(0)}),this.bus=e,this.register_yield()}Oe.prototype.run=function(){this.stopping=!1,this.running||(this.running=!0,this.bus.send("emulator-started")),this.next_tick(0)};Oe.prototype.do_tick=function(){if(this.stopping||!this.running)this.stopping=this.running=!1,this.bus.send("emulator-stopped");else{this.idle=!1;var e=this.cpu.main_loop();this.next_tick(e)}};Oe.prototype.next_tick=function(e){const t=++this.tick_counter;this.idle=!0,this.yield(e,t)};Oe.prototype.yield_callback=function(e){e===this.tick_counter&&this.do_tick()};Oe.prototype.stop=function(){this.running&&(this.stopping=!0)};Oe.prototype.destroy=function(){this.unregister_yield()};Oe.prototype.restart=function(){this.cpu.reset_cpu(),this.cpu.load_bios()};Oe.prototype.init=function(e){this.cpu.init(e,this.bus),this.bus.send("emulator-ready")};if(typeof process<"u")Oe.prototype.yield=function(e,t){1>e?global.setImmediate(i=>this.yield_callback(i),t):setTimeout(i=>this.yield_callback(i),e,t)},Oe.prototype.register_yield=function(){},Oe.prototype.unregister_yield=function(){};else if(window.scheduler&&typeof window.scheduler.postTask=="function"&&location.href.includes("use-scheduling-api"))Oe.prototype.yield=function(e,t){e=Math.max(0,e),window.scheduler.postTask(()=>this.yield_callback(t),{delay:e})},Oe.prototype.register_yield=function(){},Oe.prototype.unregister_yield=function(){};else if(typeof Worker<"u"){let e=function(){let t;globalThis.onmessage=function(i){const s=i.data.t;t=t&&clearTimeout(t),1>s?postMessage(i.data.tick):t=setTimeout(()=>postMessage(i.data.tick),s)}};Oe.prototype.register_yield=function(){const t=URL.createObjectURL(new Blob(["("+e.toString()+")()"],{type:"text/javascript"}));this.worker=new Worker(t),this.worker.onmessage=i=>this.yield_callback(i.data),URL.revokeObjectURL(t)},Oe.prototype.yield=function(t,i){this.worker.postMessage({t,tick:i})},Oe.prototype.unregister_yield=function(){this.worker&&this.worker.terminate(),this.worker=null}}else Oe.prototype.yield=function(e){setTimeout(()=>{this.do_tick()},e)},Oe.prototype.register_yield=function(){},Oe.prototype.unregister_yield=function(){};Oe.prototype.save_state=function(){for(var e=[],t=mn(this.cpu,e),i=[],s=0,n=0;n<e.length;n++){var a=e[n].byteLength;i[n]={offset:s,length:a},s+=a,s=s+3&-4}n=JSON.stringify({buffer_infos:i,state:t}),n=new TextEncoder().encode(n),t=16+n.length,t=t+3&-4,a=t+s,s=new ArrayBuffer(a);var c=new Int32Array(s,0,4);for(new Uint8Array(s,16,n.length).set(n),t=new Uint8Array(s,t),c[0]=-2039052682,c[1]=6,c[2]=a,c[3]=n.length,n=0;n<e.length;n++)t.set(e[n],i[n].offset);return s};Oe.prototype.restore_state=function(e){return Vp(this.cpu,e)};if(typeof performance=="object"&&performance.now)Oe.microtick=performance.now.bind(performance);else if(typeof require=="function"){const{performance:e}=require("perf_hooks");Oe.microtick=e.now.bind(e)}else Oe.microtick=typeof process=="object"&&process.hrtime?function(){var e=process.hrtime();return 1e3*e[0]+e[1]/1e6}:Date.now;function Us(e){this.cpu=e;var t=e.io;e.devices.pci.register_device({pci_id:56,pci_space:[134,128,19,113,7,0,128,2,8,0,128,6,0,0,128,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,1,0,0],pci_bars:[],name:"acpi"}),this.timer_imprecision_offset=this.timer_last_value=0,this.status=1,this.pm1_enable=this.pm1_status=0,this.last_timer=this.get_timer(Oe.microtick()),this.gpe=new Uint8Array(4),t.register_read(45056,this,void 0,function(){return this.pm1_status}),t.register_write(45056,this,void 0,function(i){A(i,4),this.pm1_status&=~i}),t.register_read(45058,this,void 0,function(){return this.pm1_enable}),t.register_write(45058,this,void 0,function(i){A(i),this.pm1_enable=i}),t.register_read(45060,this,function(){return this.status&255},function(){return this.status}),t.register_write(45060,this,void 0,function(i){A(i),this.status=i}),t.register_read(45064,this,void 0,void 0,function(){return this.get_timer(Oe.microtick())&16777215}),t.register_read(45024,this,function(){return this.gpe[0]}),t.register_read(45025,this,function(){return this.gpe[1]}),t.register_read(45026,this,function(){return this.gpe[2]}),t.register_read(45027,this,function(){return this.gpe[3]}),t.register_write(45024,this,function(i){A(i),this.gpe[0]=i}),t.register_write(45025,this,function(i){A(i),this.gpe[1]=i}),t.register_write(45026,this,function(i){A(i),this.gpe[2]=i}),t.register_write(45027,this,function(i){A(i),this.gpe[3]=i})}Us.prototype.timer=function(e){e=this.get_timer(e);var t=((e^this.last_timer)&8388608)!==0;return this.pm1_enable&1&&t?(this.pm1_status|=1,this.cpu.device_raise_irq(9)):this.cpu.device_lower_irq(9),this.last_timer=e,100};Us.prototype.get_timer=function(e){return e=Math.round(3579.545*e),e===this.timer_last_value?3579.545>this.timer_imprecision_offset&&this.timer_imprecision_offset++:this.timer_last_value+this.timer_imprecision_offset<=e&&(this.timer_imprecision_offset=0,this.timer_last_value=e),this.timer_last_value+this.timer_imprecision_offset};Us.prototype.get_state=function(){var e=[];return e[0]=this.status,e[1]=this.pm1_status,e[2]=this.pm1_enable,e[3]=this.gpe,e};Us.prototype.set_state=function(e){this.status=e[0],this.pm1_status=e[1],this.pm1_enable=e[2],this.gpe=e[3]};function Pt(e,t,i){switch(this.bus=i,this.cpu=e,this.ints=4,this.line_control=this.baud_rate=0,this.lsr=96,this.ier=this.fifo_control=0,this.iir=1,this.irq=this.scratch_register=this.modem_status=this.modem_control=0,this.input=[],this.current_line="",t){case 1016:this.com=0,this.irq=4;break;case 760:this.com=1,this.irq=3;break;case 1e3:this.com=2,this.irq=4;break;case 744:this.irq=this.com=3;break;default:""+A(t),this.com=0,this.irq=4}this.bus.register("serial"+this.com+"-input",function(s){this.data_received(s)},this),this.bus.register("serial"+this.com+"-modem-status-input",function(s){this.set_modem_status(s)},this),this.bus.register("serial"+this.com+"-carrier-detect-input",function(s){this.set_modem_status(s?this.modem_status|136:this.modem_status&-137)},this),this.bus.register("serial"+this.com+"-ring-indicator-input",function(s){this.set_modem_status(s?this.modem_status|68:this.modem_status&-69)},this),this.bus.register("serial"+this.com+"-data-set-ready-input",function(s){this.set_modem_status(s?this.modem_status|34:this.modem_status&-35)},this),this.bus.register("serial"+this.com+"-clear-to-send-input",function(s){this.set_modem_status(s?this.modem_status|17:this.modem_status&-18)},this),e=e.io,e.register_write(t,this,function(s){this.write_data(s)},function(s){this.write_data(s&255),this.write_data(s>>8)}),e.register_write(t|1,this,function(s){this.line_control&128?(this.baud_rate=this.baud_rate&255|s<<8,A(this.baud_rate)):((this.ier&2)===0&&s&2&&this.ThrowInterrupt(2),this.ier=s&15,A(s),this.CheckInterrupt())}),e.register_read(t,this,function(){if(this.line_control&128)return this.baud_rate&255;let s=0;return this.input.length!==0&&(s=this.input.shift(),A(s)),this.input.length===0&&(this.lsr&=-2,this.ClearInterrupt(12),this.ClearInterrupt(4)),s}),e.register_read(t|1,this,function(){return this.line_control&128?this.baud_rate>>8:this.ier&15}),e.register_read(t|2,this,function(){var s=this.iir&15;return A(this.iir),this.iir===2&&this.ClearInterrupt(2),this.fifo_control&1&&(s|=192),s}),e.register_write(t|2,this,function(s){A(s),this.fifo_control=s}),e.register_read(t|3,this,function(){return A(this.line_control),this.line_control}),e.register_write(t|3,this,function(s){A(s),this.line_control=s}),e.register_read(t|4,this,function(){return this.modem_control}),e.register_write(t|4,this,function(s){A(s),this.modem_control=s}),e.register_read(t|5,this,function(){return A(this.lsr),this.lsr}),e.register_write(t|5,this,function(){}),e.register_read(t|6,this,function(){return A(this.modem_status),this.modem_status&=240}),e.register_write(t|6,this,function(s){A(s),this.set_modem_status(s)}),e.register_read(t|7,this,function(){return this.scratch_register}),e.register_write(t|7,this,function(s){this.scratch_register=s})}Pt.prototype.get_state=function(){var e=[];return e[0]=this.ints,e[1]=this.baud_rate,e[2]=this.line_control,e[3]=this.lsr,e[4]=this.fifo_control,e[5]=this.ier,e[6]=this.iir,e[7]=this.modem_control,e[8]=this.modem_status,e[9]=this.scratch_register,e[10]=this.irq,e};Pt.prototype.set_state=function(e){this.ints=e[0],this.baud_rate=e[1],this.line_control=e[2],this.lsr=e[3],this.fifo_control=e[4],this.ier=e[5],this.iir=e[6],this.modem_control=e[7],this.modem_status=e[8],this.scratch_register=e[9],this.irq=e[10]};Pt.prototype.CheckInterrupt=function(){this.ints&4096&&this.ier&1?(this.iir=12,this.cpu.device_raise_irq(this.irq)):this.ints&16&&this.ier&1?(this.iir=4,this.cpu.device_raise_irq(this.irq)):this.ints&4&&this.ier&2?(this.iir=2,this.cpu.device_raise_irq(this.irq)):this.ints&1&&this.ier&8?(this.iir=0,this.cpu.device_raise_irq(this.irq)):(this.iir=1,this.cpu.device_lower_irq(this.irq))};Pt.prototype.ThrowInterrupt=function(e){this.ints|=1<<e,this.CheckInterrupt()};Pt.prototype.ClearInterrupt=function(e){this.ints&=~(1<<e),this.CheckInterrupt()};Pt.prototype.data_received=function(e){A(e),this.input.push(e),this.lsr|=1,this.fifo_control&1?this.ThrowInterrupt(12):this.ThrowInterrupt(4)};Pt.prototype.write_data=function(e){this.line_control&128?this.baud_rate=this.baud_rate&-256|e:(A(e),this.ThrowInterrupt(2),this.modem_control&16?this.data_received(e):this.bus.send("serial"+this.com+"-output-byte",e))};Pt.prototype.set_modem_status=function(e){A(e);const t=this.modem_status&15;let i=(this.modem_status^e)>>4;this.modem_status=e,this.modem_status=this.modem_status|i|t};function $t(e){this.pci_addr=new Uint8Array(4),this.pci_value=new Uint8Array(4),this.pci_response=new Uint8Array(4),this.pci_status=new Uint8Array(4),this.pci_addr32=new Int32Array(this.pci_addr.buffer),this.pci_value32=new Int32Array(this.pci_value.buffer),this.pci_response32=new Int32Array(this.pci_response.buffer),this.pci_status32=new Int32Array(this.pci_status.buffer),this.device_spaces=[],this.devices=[],this.cpu=e;for(var t=0;256>t;t++)this.device_spaces[t]=void 0,this.devices[t]=void 0;this.io=e.io,e.io.register_write(3324,this,function(i){this.pci_write8(this.pci_addr32[0],i)},function(i){this.pci_write16(this.pci_addr32[0],i)},function(i){this.pci_write32(this.pci_addr32[0],i)}),e.io.register_write(3325,this,function(i){this.pci_write8(this.pci_addr32[0]+1|0,i)}),e.io.register_write(3326,this,function(i){this.pci_write8(this.pci_addr32[0]+2|0,i)},function(i){this.pci_write16(this.pci_addr32[0]+2|0,i)}),e.io.register_write(3327,this,function(i){this.pci_write8(this.pci_addr32[0]+3|0,i)}),e.io.register_read_consecutive(3324,this,function(){return this.pci_response[0]},function(){return this.pci_response[1]},function(){return this.pci_response[2]},function(){return this.pci_response[3]}),e.io.register_read_consecutive(3320,this,function(){return this.pci_status[0]},function(){return this.pci_status[1]},function(){return this.pci_status[2]},function(){return this.pci_status[3]}),e.io.register_write_consecutive(3320,this,function(i){this.pci_addr[0]=i&252},function(i){(this.pci_addr[1]&6)===2&&(i&6)===6?e.reboot_internal():this.pci_addr[1]=i},function(i){this.pci_addr[2]=i},function(i){this.pci_addr[3]=i,this.pci_query()}),this.register_device({pci_id:0,pci_space:[134,128,55,18,0,0,0,0,2,0,0,6,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,16,0,0,0,0,0,0],pci_bars:[],name:"82441FX PMC"}),this.isa_bridge={pci_id:8,pci_space:[134,128,0,112,7,0,0,2,0,0,1,6,0,0,128,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],pci_bars:[],name:"82371SB PIIX3 ISA"},this.isa_bridge_space=this.register_device(this.isa_bridge),this.isa_bridge_space8=new Uint8Array(this.isa_bridge_space.buffer)}$t.prototype.get_state=function(){for(var e=[],t=0;256>t;t++)e[t]=this.device_spaces[t];return e[256]=this.pci_addr,e[257]=this.pci_value,e[258]=this.pci_response,e[259]=this.pci_status,e};$t.prototype.set_state=function(e){for(var t=0;256>t;t++){var i=this.devices[t],s=e[t];if(i&&s){for(var n=0;n<i.pci_bars.length;n++){var a=s[4+n];if(a&1){var c=i.pci_bars[n];this.set_io_bars(c,c.original_bar&65534,a&65534)}}this.device_spaces[t].set(s)}else s&&A(t,2)}this.pci_addr.set(e[256]),this.pci_value.set(e[257]),this.pci_response.set(e[258]),this.pci_status.set(e[259])};$t.prototype.pci_query=function(){var e=this.pci_addr[2]<<8|this.pci_addr[1],t=this.pci_addr[0]&252,i=e>>3&31,s="query enabled="+(this.pci_addr[3]>>7)+(" bdf="+A(e,4));s+=" dev="+A(i,2),s+=" addr="+A(t,2),e=this.device_spaces[e],e!==void 0?(this.pci_status32[0]=-2147483648,this.pci_response32[0]=t<e.byteLength?e[t>>2]:0,s+=" "+A(this.pci_addr32[0]>>>0,8)+" -> "+A(this.pci_response32[0]>>>0,8)):(this.pci_response32[0]=-1,this.pci_status32[0]=0)};$t.prototype.pci_write8=function(e,t){var i=e>>8&65535;e&=255;var s=new Uint8Array(this.device_spaces[i].buffer);A(e),A(i>>3,2),A(e,4),A(t,2),s[e]=t};$t.prototype.pci_write16=function(e,t){var i=e>>8&65535;e&=255;var s=new Uint16Array(this.device_spaces[i].buffer);16<=e&&44>e?A(e):(A(e),A(i>>3,2),A(e,4),A(t,4),s[e>>>1]=t)};$t.prototype.pci_write32=function(e,t){var i=e>>8&65535;e&=255;var s=this.device_spaces[i],n=this.devices[i];if(s)if(16<=e&&40>e){if(n=n.pci_bars[e-16>>2],A(s[e>>2]),A(t>>>0),A(i>>3,2),n){i=e>>2;var a=s[i]&1;if((t|3|n.size-1)===-1?(t=~(n.size-1)|a,a===0&&(s[i]=t)):a===0&&(s[i]=n.original_bar),a===1){a=s[i]&65534;var c=t&65534;A(a>>>0,8),A(c>>>0,8),this.set_io_bars(n,a,c),s[i]=t|1}}else s[e>>2]=0;A(s[e>>2]>>>0)}else e===48?(A(i>>3,2),A(t>>>0,8),s[e>>2]=n.pci_rom_size?(t|2047)===-1?-n.pci_rom_size|0:n.pci_rom_address|0:0):e===4?(A(i>>3,2),A(e,4),A(t>>>0,8)):(A(i>>3,2),A(e,4),A(t>>>0,8),s[e>>>2]=t)};$t.prototype.register_device=function(e){var t=e.pci_id;A(t);var i=new Int32Array(64);i.set(new Int32Array(new Uint8Array(e.pci_space).buffer)),this.device_spaces[t]=i,this.devices[t]=e,t=i.slice(4,10);for(var s=0;s<e.pci_bars.length;s++){var n=e.pci_bars[s];if(n){var a=t[s],c=a&1;if(A(a),n.original_bar=a,n.entries=[],c!==0)for(a&=-2,c=0;c<n.size;c++)n.entries[c]=this.io.ports[a+c]}}return i};$t.prototype.set_io_bars=function(e,t,i){var s=e.size;A(t),A(i);for(var n=this.io.ports,a=0;a<s;a++){4096<=t+a&&(n[t+a]=this.io.create_empty_entry());var c=e.entries[a];4096<=i+a&&(n[i+a]=c)}};$t.prototype.raise_irq=function(e){this.cpu.device_raise_irq(this.isa_bridge_space8[96+((this.device_spaces[e][15]>>8&255)-1+((e>>3)-1&255)&3)])};$t.prototype.lower_irq=function(e){this.cpu.device_lower_irq(this.isa_bridge_space8[96+((this.device_spaces[e][15]>>8&255)+(e>>3&255)-2&3)])};function xh(e,t,i){e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&(e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5]),e[6]===t[0]&&e[7]===t[1]&&e[8]===t[2]&&e[9]===t[3]&&e[10]===t[4]&&e[11]===t[5]&&(e[6]=i[0],e[7]=i[1],e[8]=i[2],e[9]=i[3],e[10]=i[4],e[11]=i[5]);var s=e[12]<<8|e[13];if(s===2048){if(e=e.subarray(14),e[0]>>4===4&&e[9]===17){e=e.subarray(20),s=e[0]<<8|e[1];var n=e[2]<<8|e[3];if(A(e[6]<<8|e[7],4),s===67||n===67)if(s=e.subarray(8),n=s[236]<<24|s[237]<<16|s[238]<<8|s[239],n!==1669485411)A(n,8);else for(s[28]===t[0]&&s[29]===t[1]&&s[30]===t[2]&&s[31]===t[3]&&s[32]===t[4]&&s[33]===t[5]&&(s[28]=i[0],s[29]=i[1],s[30]=i[2],s[31]=i[3],s[32]=i[4],s[33]=i[5],e[6]=e[7]=0),n=240;n<s.length;){const a=s[n++];if(a===255)break;const c=s[n++];a===61&&s[n+0]===1&&s[n+1]===t[0]&&s[n+2]===t[1]&&s[n+3]===t[2]&&s[n+4]===t[3]&&s[n+5]===t[4]&&s[n+6]===t[5]&&(s[n+1]=i[0],s[n+2]=i[1],s[n+3]=i[2],s[n+4]=i[3],s[n+5]=i[4],s[n+6]=i[5],e[6]=e[7]=0),n+=c}}}else s===2054&&(e=e.subarray(14),Jt(e.subarray(8,14)),Jt(e.subarray(18,24)),e[8]===t[0]&&e[9]===t[1]&&e[10]===t[2]&&e[11]===t[3]&&e[12]===t[4]&&e[13]===t[5]&&(e[8]=i[0],e[9]=i[1],e[10]=i[2],e[11]=i[3],e[12]=i[4],e[13]=i[5]))}function Jt(e){return[e[0].toString(16).padStart(2,"0"),e[1].toString(16).padStart(2,"0"),e[2].toString(16).padStart(2,"0"),e[3].toString(16).padStart(2,"0"),e[4].toString(16).padStart(2,"0"),e[5].toString(16).padStart(2,"0")].join(":")}function At(e,t,i,s,n){for(this.cpu=e,this.pci=e.devices.pci,this.id=n||0,this.preserve_mac_from_state_image=i,this.mac_address_translation=s,this.bus=t,this.bus.register("net"+this.id+"-receive",function(a){this.receive(a)},this),this.port=768+256*this.id,this.name="ne2k",this.pci_space=[236,16,41,128,3,1,0,0,0,0,0,2,0,0,0,0,this.port&255|1,this.port>>8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,244,26,0,17,0,0,184,254,0,0,0,0,0,0,0,0,0,1,0,0],this.pci_id=(this.id===0?5:7+this.id)<<3,this.pci_bars=[{size:32}],this.imr=this.isr=0,this.cr=1,this.tpsr=this.tcnt=this.rcnt=this.dcfg=0,this.memory=new Uint8Array(32768),this.txcr=this.rxcr=0,this.tsr=1,this.mac=new Uint8Array([0,34,21,255*Math.random()|0,255*Math.random()|0,255*Math.random()|0]),this.bus.send("net"+this.id+"-mac",Jt(this.mac)),this.mar=Uint8Array.of(255,255,255,255,255,255,255,255),this.mac_address_in_state=null,t=0;6>t;t++)this.memory[t<<1]=this.memory[t<<1|1]=this.mac[t];this.memory[28]=this.memory[29]=87,this.memory[30]=this.memory[31]=87,""+Jt(this.mac),this.rsar=0,this.pstart=64,this.pstop=128,this.boundary=this.curpg=76,t=e.io,t.register_read(this.port|0,this,function(){return this.cr},function(){return this.cr}),t.register_write(this.port|0,this,function(a){this.cr=a,A(a,2),A(this.txcr,2),this.cr&1||(a&24&&this.rcnt===0&&this.do_interrupt(64),a&4&&(a=this.tpsr<<8,a=this.memory.subarray(a,a+this.tcnt),this.mac_address_in_state&&(a=new Uint8Array(a),xh(a,this.mac_address_in_state,this.mac)),this.bus.send("net"+this.id+"-send",a),this.bus.send("eth-transmit-end",[a.length]),this.cr&=-5,this.do_interrupt(2),A(a.byteLength)))}),t.register_read(this.port|13,this,function(){return this.get_page()===1?this.mar[5]:0}),t.register_read(this.port|14,this,function(){return this.get_page()===1?this.mar[6]:0},function(){return this.get_page(),0}),t.register_read(this.port|15,this,function(){return this.get_page()===1?this.mar[7]:0}),t.register_read(this.port|31,this,function(){return this.get_page(),this.do_interrupt(128),0}),t.register_write(this.port|31,this,function(a){this.get_page(),A(a,2)}),t.register_read(this.port|1,this,function(){var a=this.get_page();return a===0?this.pstart:a===1?this.mac[0]:a===2?this.pstart:0}),t.register_write(this.port|1,this,function(a){var c=this.get_page();c===0?(A(a,2),this.pstart=a):c===1?(A(a),this.mac[0]=a):A(a)}),t.register_read(this.port|2,this,function(){var a=this.get_page();return a===0?this.pstop:a===1?this.mac[1]:a===2?this.pstop:0}),t.register_write(this.port|2,this,function(a){var c=this.get_page();c===0?(A(a,2),a>this.memory.length>>8&&(a=this.memory.length>>8,A(a)),this.pstop=a):c===1?(A(a),this.mac[1]=a):A(a)}),t.register_read(this.port|7,this,function(){var a=this.get_page();return a===0?(A(this.isr,2),this.isr):a===1?(A(this.curpg,2),this.curpg):0}),t.register_write(this.port|7,this,function(a){var c=this.get_page();c===0?(A(a,2),this.isr&=~a,this.update_irq()):c===1&&(A(a,2),this.curpg=a)}),t.register_write(this.port|13,this,function(a){this.get_page()===0&&(this.txcr=a),A(a,2)}),t.register_write(this.port|14,this,function(a){this.get_page()===0?(A(a,2),this.dcfg=a):A(a,2)}),t.register_read(this.port|10,this,function(){var a=this.get_page();return a===0?80:a===1?this.mar[2]:0}),t.register_write(this.port|10,this,function(a){this.get_page()===0?(A(a,2),this.rcnt=this.rcnt&65280|a&255):A(a,2)}),t.register_read(this.port|11,this,function(){var a=this.get_page();return a===0?67:a===1?this.mar[3]:0}),t.register_write(this.port|11,this,function(a){this.get_page()===0?(A(a,2),this.rcnt=this.rcnt&255|a<<8&65280):A(a,2)}),t.register_read(this.port|8,this,function(){var a=this.get_page();return a===0?this.rsar&255:a===1?this.mar[0]:0}),t.register_write(this.port|8,this,function(a){this.get_page()===0?(A(a,2),this.rsar=this.rsar&65280|a&255):A(a,2)}),t.register_read(this.port|9,this,function(){var a=this.get_page();return a===0?this.rsar>>8&255:a===1?this.mar[1]:0}),t.register_write(this.port|9,this,function(a){this.get_page()===0?(A(a,2),this.rsar=this.rsar&255|a<<8&65280):A(a,2)}),t.register_write(this.port|15,this,function(a){this.get_page()===0?(A(a,2),A(this.isr,2),this.imr=a,this.update_irq()):A(a,2)}),t.register_read(this.port|3,this,function(){var a=this.get_page();return a===0?(A(this.boundary,2),this.boundary):a===1?this.mac[2]:0}),t.register_write(this.port|3,this,function(a){var c=this.get_page();c===0?(A(a,2),this.boundary=a):c===1?(A(a),this.mac[2]=a):A(a)}),t.register_read(this.port|4,this,function(){var a=this.get_page();return a===0?this.tsr:a===1?this.mac[3]:0}),t.register_write(this.port|4,this,function(a){var c=this.get_page();c===0?(A(a,2),this.tpsr=a):c===1?(A(a),this.mac[3]=a):A(a)}),t.register_read(this.port|5,this,function(){var a=this.get_page();return a===0?0:a===1?this.mac[4]:0}),t.register_write(this.port|5,this,function(a){var c=this.get_page();c===0?(A(a,2),this.tcnt=this.tcnt&-256|a):c===1?(A(a),this.mac[4]=a):A(a)}),t.register_read(this.port|6,this,function(){var a=this.get_page();return a===0?0:a===1?this.mac[5]:0}),t.register_write(this.port|6,this,function(a){var c=this.get_page();c===0?(A(a,2),this.tcnt=this.tcnt&255|a<<8):c===1?(A(a),this.mac[5]=a):A(a)}),t.register_read(this.port|12,this,function(){var a=this.get_page();return a===0?9:a===1?this.mar[4]:0}),t.register_write(this.port|12,this,function(a){this.get_page()===0?(A(a,2),this.rxcr=a):A(a)}),t.register_read(this.port|16,this,this.data_port_read8,this.data_port_read16,this.data_port_read32),t.register_write(this.port|16,this,this.data_port_write16,this.data_port_write16,this.data_port_write32),e.devices.pci.register_device(this)}At.prototype.get_state=function(){var e=[];return e[0]=this.isr,e[1]=this.imr,e[2]=this.cr,e[3]=this.dcfg,e[4]=this.rcnt,e[5]=this.tcnt,e[6]=this.tpsr,e[7]=this.rsar,e[8]=this.pstart,e[9]=this.curpg,e[10]=this.boundary,e[11]=this.pstop,e[12]=this.rxcr,e[13]=this.txcr,e[14]=this.tsr,e[15]=this.mac,e[16]=this.memory,e};At.prototype.set_state=function(e){this.isr=e[0],this.imr=e[1],this.cr=e[2],this.dcfg=e[3],this.rcnt=e[4],this.tcnt=e[5],this.tpsr=e[6],this.rsar=e[7],this.pstart=e[8],this.curpg=e[9],this.boundary=e[10],this.pstop=e[11],this.rxcr=e[12],this.txcr=e[13],this.tsr=e[14],this.preserve_mac_from_state_image?(this.mac=e[15],this.memory=e[16]):this.mac_address_translation&&(this.mac_address_in_state=e[15],this.memory=e[16],Jt(this.mac_address_in_state),Jt(this.mac)),this.bus.send("net"+this.id+"-mac",Jt(this.mac))};At.prototype.do_interrupt=function(e){A(e,2),this.isr|=e,this.update_irq()};At.prototype.update_irq=function(){this.imr&this.isr?this.pci.raise_irq(this.pci_id):this.pci.lower_irq(this.pci_id)};At.prototype.data_port_write=function(e){(16>=this.rsar||16384<=this.rsar&&32768>this.rsar)&&(this.memory[this.rsar]=e),this.rsar++,this.rcnt--,this.rsar>=this.pstop<<8&&(this.rsar+=this.pstart-this.pstop<<8),this.rcnt===0&&this.do_interrupt(64)};At.prototype.data_port_write16=function(e){this.data_port_write(e),this.dcfg&1&&this.data_port_write(e>>8)};At.prototype.data_port_write32=function(e){this.data_port_write(e),this.data_port_write(e>>8),this.data_port_write(e>>16),this.data_port_write(e>>24)};At.prototype.data_port_read=function(){let e=0;return 32768>this.rsar&&(e=this.memory[this.rsar]),this.rsar++,this.rcnt--,this.rsar>=this.pstop<<8&&(this.rsar+=this.pstart-this.pstop<<8),this.rcnt===0&&this.do_interrupt(64),e};At.prototype.data_port_read8=function(){return this.data_port_read16()&255};At.prototype.data_port_read16=function(){return this.dcfg&1?this.data_port_read()|this.data_port_read()<<8:this.data_port_read()};At.prototype.data_port_read32=function(){return this.data_port_read()|this.data_port_read()<<8|this.data_port_read()<<16|this.data_port_read()<<24};At.prototype.receive=function(e){if(!(this.cr&1)&&(this.bus.send("eth-receive-end",[e.length]),this.rxcr&16||this.rxcr&4&&e[0]===255&&e[1]===255&&e[2]===255&&e[3]===255&&e[4]===255&&e[5]===255||!(this.rxcr&8&&(e[0]&1)===1||e[0]!==this.mac[0]||e[1]!==this.mac[1]||e[2]!==this.mac[2]||e[3]!==this.mac[3]||e[4]!==this.mac[4]||e[5]!==this.mac[5]))){this.mac_address_in_state&&(e=new Uint8Array(e),xh(e,this.mac,this.mac_address_in_state));var t=this.curpg<<8,i=Math.max(60,e.length)+4,s=t+4,n=this.curpg+1+(i>>8),a=t+i,c=1+(i>>8),r=this.boundary>this.curpg?this.boundary-this.curpg:this.pstop-this.curpg+this.boundary-this.pstart;r<c&&this.boundary!==0?(A(this.pstart),A(this.pstop),A(this.curpg),A(c),A(this.boundary),A(r)):(a>this.pstop<<8?(a=(this.pstop<<8)-s,this.memory.set(e.subarray(0,a),s),this.memory.set(e.subarray(a),this.pstart<<8),A(a)):(this.memory.set(e,s),60>e.length&&this.memory.fill(0,s+e.length,s+60)),n>=this.pstop&&(n+=this.pstart-this.pstop),this.memory[t]=1,this.memory[t+1]=n,this.memory[t+2]=i,this.memory[t+3]=i>>8,this.curpg=n,A(t),A(i),A(n),this.do_interrupt(1))}};At.prototype.get_page=function(){return this.cr>>6&3};function pi(e,t){this.bus=t,this.rows=25,this.cols=80,this.ports=4,t=[{size_supported:16,notify_offset:0},{size_supported:16,notify_offset:1},{size_supported:16,notify_offset:2},{size_supported:16,notify_offset:3}];for(let i=1;i<this.ports;++i)t.push({size_supported:16,notify_offset:0}),t.push({size_supported:8,notify_offset:1});this.virtio=new dt(e,{name:"virtio-console",pci_id:96,device_id:4163,subsystem_device_id:3,common:{initial_port:47104,queues:t,features:[0,1,32],on_driver_ok:()=>{}},notification:{initial_port:47360,single_handler:!1,handlers:[()=>{},i=>{const s=this.virtio.queues[i],n=3<i?i-3>>1:0;for(;s.has_request();){const a=s.pop_request(),c=new Uint8Array(a.length_readable);a.get_next_blob(c),this.bus.send("virtio-console"+n+"-output-bytes",c),this.Ack(i,a)}},i=>{if(i===2)for(i=this.virtio.queues[i];i.count_requests()>i.size-2;)i.pop_request()},i=>{if(i===3)for(var s=this.virtio.queues[i];s.has_request();){var n=s.pop_request(),a=new Uint8Array(n.length_readable);n.get_next_blob(a);var c=Le(["w","h","h"],a,{offset:0});switch(a=c[0],c=c[1],this.Ack(i,n),c){case 0:for(n=0;n<this.ports;++n)this.SendEvent(n,1,0);break;case 3:this.Ack(i,n),this.SendEvent(a,4,1),this.SendName(a,"virtio-"+a),this.SendEvent(a,6,1);break;case 6:this.Ack(i,n),a===0&&this.SendWindowSize(a);break;default:return}}}]},isr_status:{initial_port:46848},device_specific:{initial_port:46592,struct:[{bytes:2,name:"cols",read:()=>this.cols,write:()=>{}},{bytes:2,name:"rows",read:()=>this.rows,write:()=>{}},{bytes:4,name:"max_nr_ports",read:()=>this.ports,write:()=>{}},{bytes:4,name:"emerg_wr",read:()=>0,write:()=>{}}]}});for(let i=0;i<this.ports;++i){const s=i===0?0:2*i+2;this.bus.register("virtio-console"+i+"-input-bytes",function(n){var a=this.virtio.queues[s];a.has_request()&&(a=a.pop_request(),this.Send(s,a,new Uint8Array(n)))},this),this.bus.register("virtio-console"+i+"-resize",function(n){i===0&&(this.cols=n[0],this.rows=n[1]),this.virtio.queues[2].is_configured()&&this.virtio.queues[2].has_request()&&this.SendWindowSize(i,n[0],n[1])},this)}}pi.prototype.SendWindowSize=function(e,t,i){i=i||this.rows,t=t||this.cols;const s=this.virtio.queues[2].pop_request(),n=new Uint8Array(12);Ge(["w","h","h","h","h"],[e,5,0,i,t],n,0),this.Send(2,s,n)};pi.prototype.SendName=function(e,t){const i=this.virtio.queues[2].pop_request();t=new TextEncoder().encode(t);const s=new Uint8Array(8+t.length+1);for(Ge(["w","h","h"],[e,7,1],s,0),e=0;e<t.length;++e)s[e+8]=t[e];s[8+t.length]=0,this.Send(2,i,s)};pi.prototype.get_state=function(){const e=[];return e[0]=this.virtio,e[1]=this.rows,e[2]=this.cols,e[3]=this.ports,e};pi.prototype.set_state=function(e){this.virtio.set_state(e[0]),this.rows=e[1],this.cols=e[2],this.ports=e[3]};pi.prototype.reset=function(){this.virtio.reset()};pi.prototype.SendEvent=function(e,t,i){const s=this.virtio.queues[2].pop_request(),n=new Uint8Array(8);Ge(["w","h","h"],[e,t,i],n,0),this.Send(2,s,n)};pi.prototype.Send=function(e,t,i){t.set_next_blob(i),this.virtio.queues[e].push_reply(t),this.virtio.queues[e].flush_replies()};pi.prototype.Ack=function(e,t){t.set_next_blob(new Uint8Array(0)),this.virtio.queues[e].push_reply(t),this.virtio.queues[e].flush_replies()};function gt(e,t){this.cpu=e,this.bus=t,this.reset(),this.bus.register("keyboard-code",function(i){this.kbd_send_code(i)},this),this.bus.register("mouse-click",function(i){this.mouse_send_click(i[0],i[1],i[2])},this),this.bus.register("mouse-delta",function(i){this.mouse_send_delta(i[0],i[1])},this),this.bus.register("mouse-wheel",function(i){this.wheel_movement-=i[0],this.wheel_movement-=2*i[1],this.wheel_movement=Math.min(7,Math.max(-8,this.wheel_movement)),this.send_mouse_packet(0,0)},this),e.io.register_read(96,this,this.port60_read),e.io.register_read(100,this,this.port64_read),e.io.register_write(96,this,this.port60_write),e.io.register_write(100,this,this.port64_write)}gt.prototype.reset=function(){this.use_mouse=this.enable_mouse_stream=!1,this.have_mouse=!0,this.mouse_clicks=this.mouse_delta_y=this.mouse_delta_x=0,this.have_keyboard=!0,this.next_read_resolution=this.next_read_rate=this.next_handle_scan_code_set=this.next_read_led=this.next_read_sample=this.next_is_mouse_command=this.enable_keyboard_stream=!1,this.kbd_buffer=new bs(1024),this.last_port60_byte=0,this.sample_rate=100,this.mouse_id=this.mouse_detect_state=0,this.mouse_reset_workaround=!1,this.wheel_movement=0,this.resolution=4,this.scaling2=!1,this.last_mouse_packet=-1,this.mouse_buffer=new bs(1024),this.next_byte_is_aux=this.next_byte_is_ready=!1,this.command_register=5,this.controller_output_port=0,this.read_controller_output_port=this.read_command_register=this.read_output_register=!1};gt.prototype.get_state=function(){var e=[];return e[0]=this.enable_mouse_stream,e[1]=this.use_mouse,e[2]=this.have_mouse,e[3]=this.mouse_delta_x,e[4]=this.mouse_delta_y,e[5]=this.mouse_clicks,e[6]=this.have_keyboard,e[7]=this.enable_keyboard_stream,e[8]=this.next_is_mouse_command,e[9]=this.next_read_sample,e[10]=this.next_read_led,e[11]=this.next_handle_scan_code_set,e[12]=this.next_read_rate,e[13]=this.next_read_resolution,e[15]=this.last_port60_byte,e[16]=this.sample_rate,e[17]=this.resolution,e[18]=this.scaling2,e[20]=this.command_register,e[21]=this.read_output_register,e[22]=this.read_command_register,e[23]=this.controller_output_port,e[24]=this.read_controller_output_port,e[25]=this.mouse_id,e[26]=this.mouse_detect_state,e[27]=this.mouse_reset_workaround,e};gt.prototype.set_state=function(e){this.enable_mouse_stream=e[0],this.use_mouse=e[1],this.have_mouse=e[2],this.mouse_delta_x=e[3],this.mouse_delta_y=e[4],this.mouse_clicks=e[5],this.have_keyboard=e[6],this.enable_keyboard_stream=e[7],this.next_is_mouse_command=e[8],this.next_read_sample=e[9],this.next_read_led=e[10],this.next_handle_scan_code_set=e[11],this.next_read_rate=e[12],this.next_read_resolution=e[13],this.last_port60_byte=e[15],this.sample_rate=e[16],this.resolution=e[17],this.scaling2=e[18],this.command_register=e[20],this.read_output_register=e[21],this.read_command_register=e[22],this.controller_output_port=e[23],this.read_controller_output_port=e[24],this.mouse_id=e[25]||0,this.mouse_detect_state=e[26]||0,this.mouse_reset_workaround=e[27]||!1,this.next_byte_is_aux=this.next_byte_is_ready=!1,this.kbd_buffer.clear(),this.mouse_buffer.clear(),this.bus.send("mouse-enable",this.use_mouse)};gt.prototype.raise_irq=function(){this.next_byte_is_ready||(this.kbd_buffer.length?this.kbd_irq():this.mouse_buffer.length&&this.mouse_irq())};gt.prototype.mouse_irq=function(){this.next_byte_is_aux=this.next_byte_is_ready=!0,this.command_register&2&&(this.cpu.device_lower_irq(12),this.cpu.device_raise_irq(12))};gt.prototype.kbd_irq=function(){this.next_byte_is_ready=!0,this.next_byte_is_aux=!1,this.command_register&1&&(this.cpu.device_lower_irq(1),this.cpu.device_raise_irq(1))};gt.prototype.kbd_send_code=function(e){this.enable_keyboard_stream&&(A(e),this.kbd_buffer.push(e),this.raise_irq())};gt.prototype.mouse_send_delta=function(e,t){this.have_mouse&&this.use_mouse&&(this.mouse_delta_x+=1*e,this.mouse_delta_y+=1*t,this.enable_mouse_stream&&(e=this.mouse_delta_x|0,t=this.mouse_delta_y|0,e||t))&&(this.mouse_delta_x-=e,this.mouse_delta_y-=t,this.send_mouse_packet(e,t))};gt.prototype.mouse_send_click=function(e,t,i){this.have_mouse&&this.use_mouse&&(this.mouse_clicks=e|i<<1|t<<2,this.enable_mouse_stream&&this.send_mouse_packet(0,0))};gt.prototype.send_mouse_packet=function(e,t){var i=(0>t)<<5|(0>e)<<4|8|this.mouse_clicks;this.last_mouse_packet=Date.now(),this.mouse_buffer.push(i),this.mouse_buffer.push(e),this.mouse_buffer.push(t),this.mouse_id===4?(this.mouse_buffer.push(0|this.wheel_movement&15),this.wheel_movement=0):this.mouse_id===3&&(this.mouse_buffer.push(this.wheel_movement&255),this.wheel_movement=0),this.raise_irq()};gt.prototype.apply_scaling2=function(e){var t=e>>31;switch(Math.abs(e)){case 0:case 1:case 3:return e;case 2:return t;case 4:return 6*t;case 5:return 9*t;default:return e<<1}};gt.prototype.port60_read=function(){return this.next_byte_is_ready=!1,!this.kbd_buffer.length&&!this.mouse_buffer.length?this.last_port60_byte:(this.next_byte_is_aux?(this.cpu.device_lower_irq(12),this.last_port60_byte=this.mouse_buffer.shift()):(this.cpu.device_lower_irq(1),this.last_port60_byte=this.kbd_buffer.shift()),A(this.last_port60_byte),(this.kbd_buffer.length||this.mouse_buffer.length)&&this.raise_irq(),this.last_port60_byte)};gt.prototype.port64_read=function(){var e=16;return this.next_byte_is_ready&&(e|=1),this.next_byte_is_aux&&(e|=32),A(e),e};gt.prototype.port60_write=function(e){if(A(e),this.read_command_register)this.command_register=e,this.read_command_register=!1,A(this.command_register);else if(this.read_output_register)this.read_output_register=!1,this.mouse_buffer.clear(),this.mouse_buffer.push(e),this.mouse_irq();else if(this.next_read_sample){switch(this.next_read_sample=!1,this.mouse_buffer.clear(),this.mouse_buffer.push(250),this.sample_rate=e,this.mouse_detect_state){case-1:e===60?(this.mouse_reset_workaround=!0,this.mouse_detect_state=0):(this.mouse_reset_workaround=!1,this.mouse_detect_state=e===200?1:0);break;case 0:e===200&&(this.mouse_detect_state=1);break;case 1:this.mouse_detect_state=e===100?2:e===200?3:0;break;case 2:e===80&&(this.mouse_id=3),this.mouse_detect_state=-1;break;case 3:e===80&&(this.mouse_id=4),this.mouse_detect_state=-1}A(e),A(this.mouse_id),this.sample_rate||(this.sample_rate=100),this.mouse_irq()}else if(this.next_read_resolution)this.next_read_resolution=!1,this.mouse_buffer.clear(),this.mouse_buffer.push(250),this.resolution=3<e?4:1<<e,this.mouse_irq();else if(this.next_read_led)this.next_read_led=!1,this.kbd_buffer.push(250),this.kbd_irq();else if(this.next_handle_scan_code_set)this.next_handle_scan_code_set=!1,this.kbd_buffer.push(250),this.kbd_irq(),e||this.kbd_buffer.push(1);else if(this.next_read_rate)this.next_read_rate=!1,this.kbd_buffer.push(250),this.kbd_irq();else if(this.next_is_mouse_command){if(this.next_is_mouse_command=!1,A(e),this.have_mouse){switch(this.kbd_buffer.clear(),this.mouse_buffer.clear(),this.mouse_buffer.push(250),e){case 230:this.scaling2=!1;break;case 231:this.scaling2=!0;break;case 232:this.next_read_resolution=!0;break;case 233:this.send_mouse_packet(0,0);break;case 235:this.send_mouse_packet(0,0);break;case 242:A(this.mouse_id),this.mouse_buffer.push(this.mouse_id),this.mouse_clicks=this.mouse_delta_x=this.mouse_delta_y=0,this.raise_irq();break;case 243:this.next_read_sample=!0;break;case 244:this.use_mouse=this.enable_mouse_stream=!0,this.bus.send("mouse-enable",!0),this.mouse_clicks=this.mouse_delta_x=this.mouse_delta_y=0;break;case 245:this.enable_mouse_stream=!1;break;case 246:this.enable_mouse_stream=!1,this.sample_rate=100,this.scaling2=!1,this.resolution=4;break;case 255:this.mouse_buffer.push(170),this.mouse_buffer.push(0),this.use_mouse=!0,this.bus.send("mouse-enable",!0),this.enable_mouse_stream=!1,this.sample_rate=100,this.scaling2=!1,this.resolution=4,this.mouse_reset_workaround||(this.mouse_id=0),this.mouse_clicks=this.mouse_delta_x=this.mouse_delta_y=0;break;default:A(e)}this.mouse_irq()}}else if(this.read_controller_output_port)this.read_controller_output_port=!1,this.controller_output_port=e;else{switch(A(e),this.mouse_buffer.clear(),this.kbd_buffer.clear(),this.kbd_buffer.push(250),e){case 237:this.next_read_led=!0;break;case 240:this.next_handle_scan_code_set=!0;break;case 242:this.kbd_buffer.push(171),this.kbd_buffer.push(131);break;case 243:this.next_read_rate=!0;break;case 244:this.enable_keyboard_stream=!0;break;case 245:this.enable_keyboard_stream=!1;break;case 246:break;case 255:this.kbd_buffer.clear(),this.kbd_buffer.push(250),this.kbd_buffer.push(170),this.kbd_buffer.push(0);break;default:A(e)}this.kbd_irq()}};gt.prototype.port64_write=function(e){switch(A(e),e){case 32:this.kbd_buffer.clear(),this.mouse_buffer.clear(),this.kbd_buffer.push(this.command_register),this.kbd_irq();break;case 96:this.read_command_register=!0;break;case 209:this.read_controller_output_port=!0;break;case 211:this.read_output_register=!0;break;case 212:this.next_is_mouse_command=!0;break;case 167:this.command_register|=32;break;case 168:this.command_register&=-33;break;case 169:this.kbd_buffer.clear(),this.mouse_buffer.clear(),this.kbd_buffer.push(0),this.kbd_irq();break;case 170:this.kbd_buffer.clear(),this.mouse_buffer.clear(),this.kbd_buffer.push(85),this.kbd_irq();break;case 171:this.kbd_buffer.clear(),this.mouse_buffer.clear(),this.kbd_buffer.push(0),this.kbd_irq();break;case 173:this.command_register|=16;break;case 174:this.command_register&=-17;break;case 254:this.cpu.reboot_internal();break;default:A(e)}};const Zi=DataView.prototype,ms={size:1,get:Zi.getUint8,set:Zi.setUint8},vi={size:2,get:Zi.getUint16,set:Zi.setUint16},Ke={size:4,get:Zi.getUint32,set:Zi.setUint32},Ah=Gn([{magic:Ke},{class:ms},{data:ms},{version0:ms},{osabi:ms},{abiversion:ms},{pad0:(function(e){return{size:e,get:()=>-1}})(7)},{type:vi},{machine:vi},{version1:Ke},{entry:Ke},{phoff:Ke},{shoff:Ke},{flags:Ke},{ehsize:vi},{phentsize:vi},{phnum:vi},{shentsize:vi},{shnum:vi},{shstrndx:vi}]);console.assert(Ah.reduce((e,t)=>e+t.size,0)===52);const Rh=Gn([{type:Ke},{offset:Ke},{vaddr:Ke},{paddr:Ke},{filesz:Ke},{memsz:Ke},{flags:Ke},{align:Ke}]);console.assert(Rh.reduce((e,t)=>e+t.size,0)===32);const Th=Gn([{name:Ke},{type:Ke},{flags:Ke},{addr:Ke},{offset:Ke},{size:Ke},{link:Ke},{info:Ke},{addralign:Ke},{entsize:Ke}]);console.assert(Th.reduce((e,t)=>e+t.size,0)===40);function Gn(e){return e.map(function(t){var i=Object.keys(t);return console.assert(i.length===1),i=i[0],t=t[i],console.assert(0<t.size),{name:i,type:t,size:t.size,get:t.get,set:t.set}})}function Lh(e,t){const i={};let s=0;for(const n of t)t=n.get.call(e,s,!0),console.assert(i[n.name]===void 0),i[n.name]=t,s+=n.size;return[i,s]}function fa(e,t,i){const s=[];let n=0;for(var a=0;a<i;a++){const[c,r]=Lh(new DataView(e.buffer,e.byteOffset+n,void 0),t);s.push(c),n+=r}return[s,n]}const pa={0:0,1:525,2:525,3:350,4:350,5:350};function Re(e,t,i,s){this.io=e.io,this.cpu=e,this.dma=e.devices.dma,this.cmd_table=this.build_cmd_lookup_table(),this.sra=0,this.srb=192,this.dor=12,this.tdr=0,this.msr=128,this.dsr=0,this.cmd_phase=1,this.cmd_flags=this.cmd_code=0,this.cmd_buffer=new Uint8Array(17),this.cmd_remaining=this.cmd_cursor=0,this.response_data=new Uint8Array(15),this.reset_sense_int_count=this.curr_drive_no=this.status1=this.status0=this.response_length=this.response_cursor=0,this.locked=!1,this.head_load_time=this.step_rate_interval=0,this.fdc_config=96,this.eot=this.precomp_trk=0,this.drives=[new Qt("fda",s?.fda,t,4),new Qt("fdb",s?.fdb,i,4)],Object.seal(this),this.cpu.devices.rtc.cmos_write(16,this.drives[0].drive_type<<4|this.drives[1].drive_type),this.io.register_read(1008,this,this.read_reg_sra),this.io.register_read(1009,this,this.read_reg_srb),this.io.register_read(1010,this,this.read_reg_dor),this.io.register_read(1011,this,this.read_reg_tdr),this.io.register_read(1012,this,this.read_reg_msr),this.io.register_read(1013,this,this.read_reg_fifo),this.io.register_read(1015,this,this.read_reg_dir),this.io.register_write(1010,this,this.write_reg_dor),this.io.register_write(1011,this,this.write_reg_tdr),this.io.register_write(1012,this,this.write_reg_dsr),this.io.register_write(1013,this,this.write_reg_fifo),this.io.register_write(1015,this,this.write_reg_ccr)}Re.prototype.build_cmd_lookup_table=function(){const e=[{code:6,mask:31,argc:8,name:"READ",handler:this.exec_read},{code:5,mask:63,argc:8,name:"WRITE",handler:this.exec_write},{code:15,mask:255,argc:2,name:"SEEK",handler:this.exec_seek},{code:8,mask:255,argc:0,name:"SENSE INTERRUPT STATUS",handler:this.exec_sense_interrupt_status},{code:7,mask:255,argc:1,name:"RECALIBRATE",handler:this.exec_recalibrate},{code:13,mask:191,argc:5,name:"FORMAT TRACK",handler:this.exec_format_track},{code:2,mask:191,argc:8,name:"READ TRACK",handler:this.exec_unimplemented},{code:78,mask:255,argc:17,name:"RESTORE",handler:this.exec_unimplemented},{code:46,mask:255,argc:0,name:"SAVE",handler:this.exec_unimplemented},{code:12,mask:31,argc:8,name:"READ DELETED DATA",handler:this.exec_unimplemented},{code:17,mask:31,argc:8,name:"SCAN EQUAL",handler:this.exec_unimplemented},{code:22,mask:31,argc:8,name:"VERIFY",handler:this.exec_unimplemented},{code:25,mask:31,argc:8,name:"SCAN LOW OR EQUAL",handler:this.exec_unimplemented},{code:29,mask:31,argc:8,name:"SCAN HIGH OR EQUAL",handler:this.exec_unimplemented},{code:9,mask:63,argc:8,name:"WRITE DELETED DATA",handler:this.exec_unimplemented},{code:10,mask:191,argc:1,name:"READ ID",handler:this.exec_read_id},{code:3,mask:255,argc:2,name:"SPECIFY",handler:this.exec_specify},{code:4,mask:255,argc:1,name:"SENSE DRIVE STATUS",handler:this.exec_sense_drive_status},{code:18,mask:255,argc:1,name:"PERPENDICULAR MODE",handler:this.exec_perpendicular_mode},{code:19,mask:255,argc:3,name:"CONFIGURE",handler:this.exec_configure},{code:23,mask:255,argc:2,name:"POWERDOWN MODE",handler:this.exec_unimplemented},{code:51,mask:255,argc:1,name:"OPTION",handler:this.exec_unimplemented},{code:142,mask:255,argc:5,name:"DRIVE SPECIFICATION",handler:this.exec_unimplemented},{code:143,mask:255,argc:2,name:"RELATIVE SEEK OUT",handler:this.exec_unimplemented},{code:205,mask:255,argc:10,name:"FORMAT AND WRITE",handler:this.exec_unimplemented},{code:207,mask:255,argc:2,name:"RELATIVE SEEK IN",handler:this.exec_unimplemented},{code:20,mask:127,argc:0,name:"LOCK",handler:this.exec_lock},{code:14,mask:255,argc:0,name:"DUMP REGISTERS",handler:this.exec_dump_regs},{code:16,mask:255,argc:0,name:"VERSION",handler:this.exec_version},{code:24,mask:255,argc:0,name:"PART ID",handler:this.exec_part_id},{code:0,mask:0,argc:0,name:"UNKNOWN COMMAND",handler:this.exec_unimplemented}],t=Array(256);for(let i=e.length-1;0<=i;i--){const s=e[i];if(s.mask===255)t[s.code]=s;else for(let n=0;256>n;n++)(n&s.mask)===s.code&&(t[n]=s)}return t};Re.prototype.raise_irq=function(){this.sra&128||(this.cpu.device_raise_irq(6),this.sra|=128),this.reset_sense_int_count=0};Re.prototype.lower_irq=function(){this.status0=0,this.sra&128&&(this.cpu.device_lower_irq(6),this.sra&=-129)};Re.prototype.set_curr_drive_no=function(e){return this.curr_drive_no=e&1,this.drives[this.curr_drive_no]};Re.prototype.enter_command_phase=function(){this.cmd_phase=1,this.cmd_remaining=this.cmd_cursor=0,this.msr&=-81,this.msr|=128};Re.prototype.enter_result_phase=function(e){this.cmd_phase=3,this.response_cursor=0,this.response_length=e,this.msr|=208};Re.prototype.reset_fdc=function(){this.lower_irq("controller reset"),this.sra=0,this.srb=192,this.dor=12,this.msr=128,this.curr_drive_no=0,this.status0|=192,this.response_length=this.response_cursor=0,this.drives[0].seek(0,0,1),this.drives[1].seek(0,0,1),this.enter_command_phase(),this.raise_irq("controller reset"),this.reset_sense_int_count=4};Re.prototype.read_reg_sra=function(){return A(this.sra),this.sra};Re.prototype.read_reg_srb=function(){return A(this.srb),this.srb};Re.prototype.read_reg_dor=function(){const e=this.dor&-4|this.curr_drive_no;return A(e),e};Re.prototype.read_reg_tdr=function(){return A(this.tdr),this.tdr};Re.prototype.read_reg_msr=function(){return A(this.msr),this.dsr&=-65,this.dor|=4,this.msr};Re.prototype.read_reg_fifo=function(){if(this.dsr&=-65,!(this.msr&128&&this.msr&64)||this.cmd_phase!==3)return 0;if(this.response_cursor<this.response_length){const e=this.response_data[this.response_cursor++];return this.response_cursor===this.response_length&&(this.msr&=-129,this.enter_command_phase(),this.lower_irq("")),e}return 0};Re.prototype.read_reg_dir=function(){const e=this.drives[this.curr_drive_no].media_changed?128:0;return A(e),e};Re.prototype.write_reg_dor=function(e){this.srb=this.srb&-36|(e&16?1:0)|(e&32?2:0)|(e&1?32:0),!(this.dor&4)&&e&4&&(this.reset_fdc(),this.dsr&=-65);const t=e&3;A(e),A(e>>4),this.curr_drive_no=t&1,this.dor=e};Re.prototype.write_reg_tdr=function(e){this.dor&4?(A(e),this.tdr=e&4):A(e)};Re.prototype.write_reg_dsr=function(e){this.dor&4?(A(e),e&128&&(this.dor&=-5,this.reset_fdc(),this.dor|=4),e&64&&this.reset_fdc(),this.dsr=e):A(e)};Re.prototype.write_reg_fifo=function(e){if(this.dsr&=-65,this.dor&4)if(!(this.msr&128)||this.msr&64)A(e);else if(this.cmd_phase!==1)A(e);else{if(this.cmd_remaining===0){var t=this.cmd_table[e];this.cmd_code=e,this.cmd_remaining=t.argc,this.cmd_flags=this.cmd_cursor=0,(t.code===6||t.code===5)&&this.cmd_code&128&&(this.cmd_flags|=1),this.cmd_remaining&&(this.msr|=128),this.msr|=16}else this.cmd_buffer[this.cmd_cursor++]=e,this.cmd_remaining--;this.cmd_remaining===0&&(this.cmd_phase=2,e=this.cmd_table[this.cmd_code],t=this.cmd_buffer.slice(0,this.cmd_cursor),e.handler.call(this,t))}else A(e)};Re.prototype.write_reg_ccr=function(e){this.dor&4?(A(e),this.dsr=this.dsr&-4|e&3):A(e)};Re.prototype.exec_unimplemented=function(){A(this.cmd_code),this.status0=128,this.response_data[0]=this.status0,this.enter_result_phase(1)};Re.prototype.exec_read=function(e){this.start_read_write(e,!1)};Re.prototype.exec_write=function(e){this.start_read_write(e,!0)};Re.prototype.exec_seek=function(e){const t=this.set_curr_drive_no(e[0]&1);e=e[1],this.enter_command_phase(),t.seek(t.curr_head,e,t.curr_sect),this.status0|=32,this.raise_irq("SEEK command")};Re.prototype.exec_sense_interrupt_status=function(){const e=this.drives[this.curr_drive_no];let t;if(0<this.reset_sense_int_count)t=192|4-this.reset_sense_int_count--;else if(this.sra&128)t=this.status0&-8|this.curr_drive_no;else{this.response_data[0]=128,this.enter_result_phase(1);return}this.response_data[0]=t,this.response_data[1]=e.curr_track,this.enter_result_phase(2),this.lower_irq("SENSE INTERRUPT command"),this.status0=192};Re.prototype.exec_recalibrate=function(e){this.set_curr_drive_no(e[0]&1).seek(0,0,1),this.enter_command_phase(),this.status0|=32,this.raise_irq("RECALIBRATE command")};Re.prototype.exec_format_track=function(e){let t=0,i=0;this.set_curr_drive_no(e[0]&1).read_only&&(t=96,i=2),this.end_read_write(t,i,0)};Re.prototype.exec_read_id=function(e){const t=this.drives[this.curr_drive_no];t.curr_head=e[0]>>2&1,t.max_sect!==0&&(t.curr_sect=t.curr_sect%t.max_sect+1),this.end_read_write(0,0,0)};Re.prototype.exec_specify=function(e){const t=e[1];this.step_rate_interval=e[0]>>4,this.head_load_time=t>>1,this.dor=t&1?this.dor&-9:this.dor|8,this.enter_command_phase()};Re.prototype.exec_sense_drive_status=function(e){e=e[0];const t=this.set_curr_drive_no(e&1);t.curr_head=e>>2&1,this.response_data[0]=(t.read_only?64:0)|(t.curr_track===0?16:0)|t.curr_head<<2|this.curr_drive_no|40,this.enter_result_phase(1)};Re.prototype.exec_perpendicular_mode=function(e){e=e[0],e&128&&(this.drives[this.curr_drive_no].perpendicular=e&7),this.enter_command_phase()};Re.prototype.exec_configure=function(e){this.fdc_config=e[1],this.precomp_trk=e[2],this.enter_command_phase()};Re.prototype.exec_lock=function(){this.cmd_code&128?(this.locked=!0,this.response_data[0]=16):(this.locked=!1,this.response_data[0]=0),this.enter_result_phase(1)};Re.prototype.exec_dump_regs=function(){const e=this.drives[this.curr_drive_no];this.response_data[0]=this.drives[0].curr_track,this.response_data[1]=this.drives[1].curr_track,this.response_data[2]=0,this.response_data[3]=0,this.response_data[4]=this.step_rate_interval,this.response_data[5]=this.head_load_time<<1|(this.dor&8?1:0),this.response_data[6]=e.max_sect,this.response_data[7]=(this.locked?128:0)|e.perpendicular<<2,this.response_data[8]=this.fdc_config,this.response_data[9]=this.precomp_trk,this.enter_result_phase(10)};Re.prototype.exec_version=function(){this.response_data[0]=144,this.enter_result_phase(1)};Re.prototype.exec_part_id=function(){this.response_data[0]=65,this.enter_result_phase(1)};Re.prototype.start_read_write=function(e,t){const i=this.set_curr_drive_no(e[0]&1),s=e[1],n=e[2],a=e[3];var c=e[4];const r=e[5];switch(e=128>e[7]?e[7]:128,i.seek(n,s,a)){case 2:this.end_read_write(64,0,0),this.response_data[3]=s,this.response_data[4]=n,this.response_data[5]=a;return;case 3:this.end_read_write(64,128,0),this.response_data[3]=s,this.response_data[4]=n,this.response_data[5]=a;return;case 1:this.status0|=32}const o=128<<(7<c?7:c);if(c=i.chs2lba(s,n,a)*o,o!==128&&(e=this.cmd_flags&1?(2*r-a+1)*o:(r-a+1)*o,0>=e)){this.end_read_write(64,1,0),this.response_data[3]=s,this.response_data[4]=n,this.response_data[5]=a;return}this.eot=r,t&&i.read_only?(this.end_read_write(96,2,0),this.response_data[3]=s,this.response_data[4]=n,this.response_data[5]=a):this.dor&8&&(this.msr&=-129,(t?this.dma.do_write:this.dma.do_read).call(this.dma,i.buffer,c,e,2,u=>{u?this.end_read_write(64,0,0):(this.seek_next_sect(),this.end_read_write(0,0,0))}))};Re.prototype.end_read_write=function(e,t,i){const s=this.drives[this.curr_drive_no];this.status0&=-8,this.status0|=this.curr_drive_no,s.curr_head&&(this.status0|=4),this.status0|=e,this.msr|=192,this.msr&=-33,this.response_data[0]=this.status0,this.response_data[1]=t,this.response_data[2]=i,this.response_data[3]=s.curr_track,this.response_data[4]=s.curr_head,this.response_data[5]=s.curr_sect,this.response_data[6]=2,this.enter_result_phase(7),this.raise_irq(this.cmd_table[this.cmd_code].name+" command")};Re.prototype.seek_next_sect=function(){const e=this.drives[this.curr_drive_no];let t=e.curr_track,i=e.curr_head,s=e.curr_sect,n=1;return s>=e.max_sect||s===this.eot?(s=1,this.cmd_flags&1?i===0&&e.max_head===2?i=1:(i=0,t++,this.status0|=32,e.max_head===1&&(n=0)):(this.status0|=32,t++,n=0)):s++,e.seek(i,t,s),n};Re.prototype.get_state=function(){const e=[];return e[19]=this.sra,e[20]=this.srb,e[21]=this.dor,e[22]=this.tdr,e[23]=this.msr,e[24]=this.dsr,e[25]=this.cmd_phase,e[26]=this.cmd_code,e[27]=this.cmd_flags,e[28]=this.cmd_buffer,e[29]=this.cmd_cursor,e[30]=this.cmd_remaining,e[31]=this.response_data,e[32]=this.response_cursor,e[33]=this.response_length,e[34]=this.status0,e[35]=this.status1,e[36]=this.curr_drive_no,e[37]=this.reset_sense_int_count,e[38]=this.locked,e[39]=this.step_rate_interval,e[40]=this.head_load_time,e[41]=this.fdc_config,e[42]=this.precomp_trk,e[43]=this.eot,e[44]=this.drives[0].get_state(),e[45]=this.drives[1].get_state(),e};Re.prototype.set_state=function(e){typeof e[19]<"u"&&(this.sra=e[19],this.srb=e[20],this.dor=e[21],this.tdr=e[22],this.msr=e[23],this.dsr=e[24],this.cmd_phase=e[25],this.cmd_code=e[26],this.cmd_flags=e[27],this.cmd_buffer.set(e[28]),this.cmd_cursor=e[29],this.cmd_remaining=e[30],this.response_data.set(e[31]),this.response_cursor=e[32],this.response_length=e[33],this.status0=e[34],this.status1=e[35],this.curr_drive_no=e[36],this.reset_sense_int_count=e[37],this.locked=e[38],this.step_rate_interval=e[39],this.head_load_time=e[40],this.fdc_config=e[41],this.precomp_trk=e[42],this.eot=e[43],this.drives[0].set_state(e[44]),this.drives[1].set_state(e[45]))};const Wi=[{drive_type:4,sectors:18,tracks:80,heads:2},{drive_type:4,sectors:20,tracks:80,heads:2},{drive_type:4,sectors:21,tracks:80,heads:2},{drive_type:4,sectors:21,tracks:82,heads:2},{drive_type:4,sectors:21,tracks:83,heads:2},{drive_type:4,sectors:22,tracks:80,heads:2},{drive_type:4,sectors:23,tracks:80,heads:2},{drive_type:4,sectors:24,tracks:80,heads:2},{drive_type:5,sectors:36,tracks:80,heads:2},{drive_type:5,sectors:39,tracks:80,heads:2},{drive_type:5,sectors:40,tracks:80,heads:2},{drive_type:5,sectors:44,tracks:80,heads:2},{drive_type:5,sectors:48,tracks:80,heads:2},{drive_type:4,sectors:8,tracks:80,heads:2},{drive_type:4,sectors:9,tracks:80,heads:2},{drive_type:4,sectors:10,tracks:80,heads:2},{drive_type:4,sectors:10,tracks:82,heads:2},{drive_type:4,sectors:10,tracks:83,heads:2},{drive_type:4,sectors:13,tracks:80,heads:2},{drive_type:4,sectors:14,tracks:80,heads:2},{drive_type:2,sectors:15,tracks:80,heads:2},{drive_type:2,sectors:18,tracks:80,heads:2},{drive_type:2,sectors:18,tracks:82,heads:2},{drive_type:2,sectors:18,tracks:83,heads:2},{drive_type:2,sectors:20,tracks:80,heads:2},{drive_type:2,sectors:9,tracks:80,heads:2},{drive_type:2,sectors:11,tracks:80,heads:2},{drive_type:2,sectors:9,tracks:40,heads:2},{drive_type:2,sectors:9,tracks:40,heads:1},{drive_type:2,sectors:10,tracks:41,heads:2},{drive_type:2,sectors:10,tracks:42,heads:2},{drive_type:2,sectors:8,tracks:40,heads:2},{drive_type:2,sectors:8,tracks:40,heads:1},{drive_type:4,sectors:9,tracks:80,heads:1},{drive_type:1,sectors:10,tracks:40,heads:1},{drive_type:1,sectors:10,tracks:40,heads:2}];function Qt(e,t,i,s){this.name=e,this.curr_head=this.curr_track=this.max_sect=this.max_head=this.max_track=this.drive_type=0,this.curr_sect=1,this.perpendicular=0,this.read_only=!1,this.media_changed=!0,this.buffer=null,Object.seal(this),e=t?.drive_type,e!==void 0&&0<=e&&5>=e&&(this.drive_type=e),this.insert_disk(i,!!t?.read_only),this.drive_type===0&&e===void 0&&(this.drive_type=s)}Qt.prototype.insert_disk=function(e,t){if(!e)return!1;e instanceof Uint8Array&&(e=new it(e.buffer));const[i,s]=this.find_disk_format(e,this.drive_type);return i?(this.max_track=s.tracks,this.max_head=s.heads,this.max_sect=s.sectors,this.read_only=!!t,this.media_changed=!0,this.buffer=i,this.drive_type===0&&(this.drive_type=s.drive_type),!0):!1};Qt.prototype.eject_disk=function(){this.max_sect=this.max_head=this.max_track=0,this.media_changed=!0,this.buffer=null};Qt.prototype.get_buffer=function(){return this.buffer?this.buffer.buffer:null};Qt.prototype.chs2lba=function(e,t,i){return(e*this.max_head+t)*this.max_sect+i-1};Qt.prototype.find_disk_format=function(e,t){const i=t===0,s=e.byteLength;let n=-1,a=-1,c=-1,r=-1,o=-1;for(let u=0;u<Wi.length;u++){const f=Wi[u],l=f.sectors*f.tracks*f.heads*512;if(s===l)if(i||f.drive_type===t){n=u;break}else i||pa[f.drive_type]!==pa[t]?c=c===-1?u:c:a=a===-1?u:a;else s<l&&(o===-1||l<o)&&(r=u,o=l)}return n!==-1?[e,Wi[n]]:a!==-1?[e,Wi[a]]:c!==-1?[e,Wi[c]]:r!==-1?(t=new Uint8Array(o),t.set(new Uint8Array(e.buffer)),[new it(t.buffer),Wi[r]]):[null,null]};Qt.prototype.seek=function(e,t,i){if(t>this.max_track||e!==0&&this.max_head===1)return 2;if(i>this.max_sect)return 3;let s=0;const n=this.chs2lba(this.curr_track,this.curr_head,this.curr_sect),a=this.chs2lba(t,e,i);return n!==a&&(this.curr_track!==t&&(this.buffer&&(this.media_changed=!1),s=1),this.curr_head=e,this.curr_track=t,this.curr_sect=i),this.buffer||(s=2),s};Qt.prototype.get_state=function(){const e=[];return e[0]=this.drive_type,e[1]=this.max_track,e[2]=this.max_head,e[3]=this.max_sect,e[4]=this.curr_track,e[5]=this.curr_head,e[6]=this.curr_sect,e[7]=this.perpendicular,e[8]=this.read_only,e[9]=this.media_changed,e[10]=this.buffer?this.buffer.get_state():null,e};Qt.prototype.set_state=function(e){this.drive_type=e[0],this.max_track=e[1],this.max_head=e[2],this.max_sect=e[3],this.curr_track=e[4],this.curr_head=e[5],this.curr_sect=e[6],this.perpendicular=e[7],this.read_only=e[8],this.media_changed=e[9],e[10]?(this.buffer||(this.buffer=new it(new ArrayBuffer(0))),this.buffer.set_state(e[10])):this.buffer=null};const ma={70:{name:"GET CONFIGURATION",flags:0},74:{name:"GET EVENT STATUS NOTIFICATION",flags:0},18:{name:"INQUIRY",flags:0},189:{name:"MECHANISM STATUS",flags:0},26:{name:"MODE SENSE (6)",flags:0},90:{name:"MODE SENSE (10)",flags:0},69:{name:"PAUSE",flags:1},30:{name:"PREVENT ALLOW MEDIUM REMOVAL",flags:0},40:{name:"READ (10)",flags:1},168:{name:"READ (12)",flags:1},37:{name:"READ CAPACITY",flags:1},190:{name:"READ CD",flags:1},81:{name:"READ DISK INFORMATION",flags:1},66:{name:"READ SUBCHANNEL",flags:1},67:{name:"READ TOC PMA ATIP",flags:1},82:{name:"READ TRACK INFORMATION",flags:1},3:{name:"REQUEST SENSE",flags:0},27:{name:"START STOP UNIT",flags:0},0:{name:"TEST UNIT READY",flags:1}};function br(e,t,i){this.cpu=e,this.bus=t,this.secondary=this.primary=void 0,t=i&&i[0][0];const s=i&&i[1][0];if(t||s){t&&(this.primary=new wt(this,0,i[0],496,1014,14)),s&&(this.secondary=new wt(this,1,i[1],368,886,15)),i=t?this.primary.command_base:0;const n=t?this.primary.control_base:0,a=s?this.secondary.command_base:0,c=s?this.secondary.control_base:0;this.name="ide",this.pci_id=240,this.pci_space=[134,128,16,112,5,0,160,2,0,128,1,1,0,0,0,0,i&255|1,i>>8,0,0,n&255|1,n>>8,0,0,a&255|1,a>>8,0,0,c&255|1,c>>8,0,0,1,180,0,0,0,0,0,0,0,0,0,0,67,16,212,130,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],this.pci_bars=[t?{size:8}:void 0,t?{size:1}:void 0,s?{size:8}:void 0,s?{size:1}:void 0,{size:16}],e.devices.pci.register_device(this)}Object.seal(this)}br.prototype.get_state=function(){const e=[];return e[0]=this.primary,e[1]=this.secondary,e};br.prototype.set_state=function(e){this.primary&&this.primary.set_state(e[0]),this.secondary&&this.secondary.set_state(e[1])};function wt(e,t,i,s,n,a){this.controller=e,this.channel_nr=t,this.cpu=e.cpu,this.bus=e.bus,this.command_base=s,this.control_base=n,this.irq=a,this.name="ide"+t,s=i?i[0]:void 0,i=i?i[1]:void 0,this.master=new xe(this,0,s?.buffer,s?.is_cdrom),this.slave=new xe(this,1,i?.buffer,i?.is_cdrom),this.current_interface=this.master,this.device_control_reg=2,this.dma_command=this.dma_status=this.prdt_addr=0,e=e.cpu,e.io.register_read(this.command_base|0,this,function(){return this.current_interface.read_data(1)},function(){return this.current_interface.read_data(2)},function(){return this.current_interface.read_data(4)}),e.io.register_read(this.command_base|1,this,function(){return this.current_interface.error_reg&255}),e.io.register_read(this.command_base|2,this,function(){return this.current_interface.sector_count_reg&255}),e.io.register_read(this.command_base|3,this,function(){return this.current_interface.lba_low_reg&255}),e.io.register_read(this.command_base|4,this,function(){return this.current_interface.lba_mid_reg&255}),e.io.register_read(this.command_base|5,this,function(){return this.current_interface.lba_high_reg&255}),e.io.register_read(this.command_base|6,this,function(){return this.current_interface.device_reg&255}),e.io.register_read(this.command_base|7,this,function(){const c=this.read_status();return this.cpu.device_lower_irq(this.irq),c}),e.io.register_write(this.command_base|0,this,function(c){this.current_interface.write_data_port8(c)},function(c){this.current_interface.write_data_port16(c)},function(c){this.current_interface.write_data_port32(c)}),e.io.register_write(this.command_base|1,this,function(c){this.current_interface.features_reg=(this.current_interface.features_reg<<8|c)&65535}),e.io.register_write(this.command_base|2,this,function(c){this.current_interface.sector_count_reg=(this.current_interface.sector_count_reg<<8|c)&65535}),e.io.register_write(this.command_base|3,this,function(c){this.current_interface.lba_low_reg=(this.current_interface.lba_low_reg<<8|c)&65535}),e.io.register_write(this.command_base|4,this,function(c){this.current_interface.lba_mid_reg=(this.current_interface.lba_mid_reg<<8|c)&65535}),e.io.register_write(this.command_base|5,this,function(c){this.current_interface.lba_high_reg=(this.current_interface.lba_high_reg<<8|c)&65535}),e.io.register_write(this.command_base|6,this,function(c){const r=c&16;(r&&this.current_interface===this.master||!r&&this.current_interface===this.slave)&&(this.current_interface=r?this.slave:this.master),this.current_interface.device_reg=c,this.current_interface.is_lba=c>>6&1,this.current_interface.head=c&15}),e.io.register_write(this.command_base|7,this,function(c){this.current_interface.status_reg&=-34,this.current_interface.ata_command(c),this.cpu.device_lower_irq(this.irq)}),e.io.register_read(this.control_base|0,this,this.read_status),e.io.register_write(this.control_base|0,this,this.write_control),t=46080+8*t,e.io.register_read(t|0,this,this.dma_read_command8,void 0,this.dma_read_command),e.io.register_write(t|0,this,this.dma_write_command8,void 0,this.dma_write_command),e.io.register_read(t|2,this,this.dma_read_status),e.io.register_write(t|2,this,this.dma_write_status),e.io.register_read(t|4,this,void 0,void 0,this.dma_read_addr),e.io.register_write(t|4,this,void 0,void 0,this.dma_set_addr)}wt.prototype.read_status=function(){return this.current_interface.drive_connected?this.current_interface.status_reg:0};wt.prototype.write_control=function(e){e&4&&(this.cpu.device_lower_irq(this.irq),this.master.device_reset(),this.slave.device_reset()),this.device_control_reg=e};wt.prototype.dma_read_addr=function(){return this.prdt_addr};wt.prototype.dma_set_addr=function(e){this.prdt_addr=e};wt.prototype.dma_read_status=function(){return this.dma_status};wt.prototype.dma_write_status=function(e){this.dma_status&=~(e&6)};wt.prototype.dma_read_command=function(){return this.dma_read_command8()|this.dma_read_status()<<16};wt.prototype.dma_read_command8=function(){return this.dma_command};wt.prototype.dma_write_command=function(e){this.dma_write_command8(e&255),this.dma_write_status(e>>16&255)};wt.prototype.dma_write_command8=function(e){const t=this.dma_command;if(this.dma_command=e&9,(t&1)!==(e&1))if((e&1)===0)this.dma_status&=-2;else switch(this.dma_status|=1,this.current_interface.current_command){case 200:case 37:this.current_interface.do_ata_read_sectors_dma();break;case 202:case 53:this.current_interface.do_ata_write_sectors_dma();break;case 160:this.current_interface.do_atapi_dma();break;default:A(this.current_interface.current_command),this.dma_status&=-2,this.dma_status|=2,this.push_irq()}};wt.prototype.push_irq=function(){(this.device_control_reg&2)===0&&(this.dma_status|=4,this.cpu.device_raise_irq(this.irq))};wt.prototype.get_state=function(){var e=[];return e[0]=this.master,e[1]=this.slave,e[2]=this.command_base,e[3]=this.irq,e[5]=this.control_base,e[7]=this.name,e[8]=this.device_control_reg,e[9]=this.prdt_addr,e[10]=this.dma_status,e[11]=this.current_interface===this.master,e[12]=this.dma_command,e};wt.prototype.set_state=function(e){this.master.set_state(e[0]),this.slave.set_state(e[1]),this.command_base=e[2],this.irq=e[3],this.control_base=e[5],this.name=e[7],this.device_control_reg=e[8],this.prdt_addr=e[9],this.dma_status=e[10],this.current_interface=e[11]?this.master:this.slave,this.dma_command=e[12]};function xe(e,t,i,s){this.channel=e,this.name=e.name+"."+t,this.bus=e.bus,this.channel_nr=e.channel_nr,this.interface_nr=t,this.cpu=e.cpu,this.buffer=null,this.drive_connected=s||!!i,this.sector_size=s?2048:512,this.is_atapi=s,this.sector_count=0,this.head_count=this.is_atapi?1:0,this.device_reg=this.head=this.lba_high_reg=this.lba_mid_reg=this.features_reg=this.lba_low_reg=this.sector_count_reg=this.is_lba=this.cylinder_count=this.sectors_per_track=0,this.status_reg=80,this.sectors_per_drq=128,this.data_pointer=this.error_reg=0,this.data=new Uint8Array(65536),this.data16=new Uint16Array(this.data.buffer),this.data32=new Int32Array(this.data.buffer),this.data_end=this.data_length=0,this.current_command=-1,this.last_io_id=this.write_dest=0,this.in_progress_io_ids=new Set,this.cancelled_io_ids=new Set,this.current_atapi_command=-1,this.atapi_add_sense=this.atapi_sense_key=0,this.medium_changed=!1,this.set_disk_buffer(i),Object.seal(this)}xe.prototype.has_disk=function(){return!!this.buffer};xe.prototype.eject=function(){this.is_atapi&&this.buffer&&(this.medium_changed=!0,this.buffer=null,this.status_reg=89,this.error_reg=96,this.push_irq())};xe.prototype.set_cdrom=function(e){this.is_atapi&&e&&(this.set_disk_buffer(e),this.medium_changed=!0)};xe.prototype.set_disk_buffer=function(e){if(e){if(this.buffer=e,this.is_atapi&&(this.status_reg=89,this.error_reg=96),this.sector_count=this.buffer.byteLength/this.sector_size,this.sector_count!==(this.sector_count|0)&&(this.sector_count=Math.ceil(this.sector_count)),this.is_atapi?(this.head_count=1,this.sectors_per_track=2048):(this.head_count=16,this.sectors_per_track=63),this.cylinder_count=this.sector_count/this.head_count/this.sectors_per_track,this.cylinder_count!==(this.cylinder_count|0)&&(this.cylinder_count=Math.floor(this.cylinder_count)),this.interface_nr===0){e=this.cpu.devices.rtc,e.cmos_write(57,e.cmos_read(57)|1<<4*this.channel_nr),e.cmos_write(18,e.cmos_read(18)&15|240);const t=this.channel_nr===0?27:36;e.cmos_write(t+0,this.cylinder_count&255),e.cmos_write(t+1,this.cylinder_count>>8&255),e.cmos_write(t+2,this.head_count&255),e.cmos_write(t+3,255),e.cmos_write(t+4,255),e.cmos_write(t+5,200),e.cmos_write(t+6,this.cylinder_count&255),e.cmos_write(t+7,this.cylinder_count>>8&255),e.cmos_write(t+8,this.sectors_per_track&255)}this.channel.cpu&&this.push_irq()}};xe.prototype.device_reset=function(){this.is_atapi?(this.status_reg=0,this.lba_low_reg=this.error_reg=this.sector_count_reg=1,this.lba_mid_reg=20,this.lba_high_reg=235):(this.status_reg=81,this.lba_low_reg=this.error_reg=this.sector_count_reg=1,this.lba_high_reg=this.lba_mid_reg=0),this.cancel_io_operations()};xe.prototype.push_irq=function(){this.channel.push_irq()};xe.prototype.ata_abort_command=function(){this.error_reg=4,this.status_reg=65,this.push_irq()};xe.prototype.capture_regs=function(){return`ST=${A(this.status_reg&255)} ER=${A(this.error_reg&255)} SC=${A(this.sector_count_reg&255)} LL=${A(this.lba_low_reg&255)} LM=${A(this.lba_mid_reg&255)} LH=${A(this.lba_high_reg&255)} FE=${A(this.features_reg&255)}`};xe.prototype.ata_command=function(e){if(this.drive_connected||e===144)switch(this.current_command=e,this.error_reg=0,e){case 8:this.data_length=this.data_end=this.data_pointer=0,this.device_reset(),this.push_irq();break;case 16:this.lba_mid_reg=0,this.status_reg=80,this.push_irq();break;case 248:e=this.sector_count-1,this.lba_low_reg=e&255,this.lba_mid_reg=e>>8&255,this.lba_high_reg=e>>16&255,this.device_reg=this.device_reg&240|e>>24&15,this.status_reg=80,this.push_irq();break;case 39:e=this.sector_count-1,this.lba_low_reg=e&255,this.lba_mid_reg=e>>8&255,this.lba_high_reg=e>>16&255,this.lba_low_reg|=e>>24<<8&65280,this.status_reg=80,this.push_irq();break;case 32:this.is_atapi?(this.lba_mid_reg=20,this.lba_high_reg=235,this.ata_abort_command()):this.ata_read_sectors(e);break;case 36:case 41:case 196:this.is_atapi?this.ata_abort_command():this.ata_read_sectors(e);break;case 48:case 52:case 57:case 197:this.is_atapi?this.ata_abort_command():this.ata_write_sectors(e);break;case 144:this.channel.master.status_reg=80,this.channel.master.error_reg=1,this.channel.master.push_irq(),this.channel.slave.drive_connected&&(this.channel.slave.status_reg=80,this.channel.slave.error_reg=1,this.channel.slave.push_irq());break;case 145:this.status_reg=80,this.push_irq();break;case 160:this.is_atapi?(this.data_allocate(12),this.data_end=12,this.sector_count_reg=1,this.status_reg=88,this.push_irq()):this.ata_abort_command();break;case 161:this.is_atapi?(this.create_identify_packet(),this.status_reg=88,this.push_irq()):this.ata_abort_command();break;case 198:A(this.sector_count_reg&255),this.sectors_per_drq=this.sector_count_reg&255,this.status_reg=80,this.push_irq();break;case 200:case 37:this.ata_read_sectors_dma(e);break;case 202:case 53:this.ata_write_sectors_dma(e);break;case 64:this.status_reg=80,this.push_irq();break;case 218:this.is_atapi&&(this.buffer||(this.error_reg|=2),this.medium_changed&&(this.error_reg|=32,this.medium_changed=!1),this.error_reg|=64),this.status_reg=80,this.push_irq();break;case 224:this.status_reg=80,this.push_irq();break;case 225:this.status_reg=80,this.push_irq();break;case 231:this.status_reg=80,this.push_irq();break;case 234:this.status_reg=80,this.push_irq();break;case 236:this.is_atapi?(this.lba_mid_reg=20,this.lba_high_reg=235,this.ata_abort_command()):(this.create_identify_packet(),this.status_reg=88,this.push_irq());break;case 239:this.status_reg=80,this.push_irq();break;case 222:this.status_reg=64,this.push_irq();break;case 245:this.status_reg=80,this.push_irq();break;case 249:this.ata_abort_command();break;case 0:this.ata_abort_command();break;case 240:A(e),this.capture_regs(),this.ata_abort_command();break;default:A(e),this.capture_regs(),this.ata_abort_command()}else A(e)};xe.prototype.atapi_handle=function(){var e=this.data[0],t=ma[e]?ma[e].flags:0;if(this.data_pointer=0,this.current_atapi_command=e,e!==3&&(this.atapi_add_sense=this.atapi_sense_key=0),!this.buffer&&t&1)this.atapi_check_condition_response(2,58),this.push_irq();else{switch(e){case 0:this.buffer?(this.data_allocate(0),this.data_end=this.data_length,this.status_reg=80):this.atapi_check_condition_response(2,58);break;case 3:this.data_allocate(this.data[4]),this.data_end=this.data_length,this.status_reg=88,this.data[0]=240,this.data[2]=this.atapi_sense_key,this.data[7]=8,this.data[12]=this.atapi_add_sense,this.atapi_add_sense=this.atapi_sense_key=0;break;case 18:e=this.data[4],this.status_reg=88,A(this.data[1],2),this.data.set([5,128,1,49,31,0,0,0,83,79,78,89,32,32,32,32,67,68,45,82,79,77,32,67,68,85,45,49,48,48,48,32,49,46,49,97]),this.data_end=this.data_length=Math.min(36,e);break;case 26:this.data_allocate(this.data[4]),this.data_end=this.data_length,this.status_reg=88;break;case 30:this.data_allocate(0),this.data_end=this.data_length,this.status_reg=80;break;case 37:e=this.sector_count-1,this.data_set(new Uint8Array([e>>24&255,e>>16&255,e>>8&255,e&255,0,0,this.sector_size>>8&255,this.sector_size&255])),this.data_end=this.data_length,this.status_reg=88;break;case 40:case 168:this.features_reg&1?this.atapi_read_dma(this.data):this.atapi_read(this.data);break;case 66:e=this.data[8],this.data_allocate(Math.min(8,e)),this.data_end=this.data_length,this.status_reg=88;break;case 67:e=this.data[8]|this.data[7]<<8,t=this.data[9]>>6,A(t,2),A(this.data[6]),this.data_allocate(e),this.data_end=this.data_length,t===0?(e=this.sector_count,this.data.set(new Uint8Array([0,18,1,1,0,20,1,0,0,0,0,0,0,22,170,0,e>>24,e>>16&255,e>>8&255,e&255]))):t===1&&this.data.set(new Uint8Array([0,10,1,1,0,0,0,0,0,0,0,0])),this.status_reg=88;break;case 70:e=Math.min(this.data[8]|this.data[7]<<8,32),this.data_allocate(e),this.data_end=this.data_length,this.data[0]=e-4>>24&255,this.data[1]=e-4>>16&255,this.data[2]=e-4>>8&255,this.data[3]=e-4&255,this.data[6]=8,this.data[10]=3,this.status_reg=88;break;case 81:this.data_allocate(0),this.data_end=this.data_length,this.status_reg=80;break;case 82:this.atapi_check_condition_response(5,36);break;case 90:e=this.data[8]|this.data[7]<<8,t=this.data[2],A(t),t===42&&this.data_allocate(Math.min(30,e)),this.data_end=this.data_length,this.status_reg=88;break;case 189:this.data_allocate(this.data[9]|this.data[8]<<8),this.data_end=this.data_length,this.data[5]=1,this.status_reg=88;break;case 27:e=this.data[4]&3,A(this.data[1]&1),A(e),this.buffer&&e===2&&(this.medium_changed=!0,this.buffer=null),this.status_reg=80,this.data_allocate(0),this.data_end=this.data_length;break;case 69:case 74:this.atapi_check_condition_response(5,36);break;case 190:this.data_allocate(0),this.data_end=this.data_length,this.status_reg=80;break;default:A(this.data[0]),this.atapi_check_condition_response(5,36)}this.sector_count_reg=this.sector_count_reg&-8|2,(this.status_reg&128)===0&&this.push_irq(),(this.status_reg&128)===0&&this.data_length===0&&(this.sector_count_reg|=1,this.status_reg&=-9)}};xe.prototype.atapi_check_condition_response=function(e,t){this.data_allocate(0),this.data_end=this.data_length,this.status_reg=65,this.error_reg=e<<4,this.sector_count_reg=this.sector_count_reg&-8|3,this.atapi_sense_key=e,this.atapi_add_sense=t};xe.prototype.do_write=function(){this.status_reg=80;var e=this.data.subarray(0,this.data_length);this.ata_advance(this.current_command,this.data_length/512),this.push_irq(),this.buffer.set(this.write_dest,e,function(){}),this.report_write(this.data_length)};xe.prototype.atapi_read=function(e){var t=e[2]<<24|e[3]<<16|e[4]<<8|e[5];e=e[0]===168?e[6]<<24|e[7]<<16|e[8]<<8|e[9]:e[7]<<8|e[8];var i=(e>>>0)*this.sector_size;t*=this.sector_size,this.data_length=0;var s=this.lba_high_reg<<8&65280|this.lba_mid_reg&255;this.lba_mid_reg=this.lba_high_reg=0,s===65535&&s--,s>i&&(s=i),this.buffer?t>=this.buffer.byteLength?(this.name+""+A(t+i)+A(this.buffer.byteLength),this.status_reg=255,this.push_irq()):i===0?(this.status_reg=80,this.data_pointer=0):(i=Math.min(i,this.buffer.byteLength-t),this.status_reg=208,this.report_read_start(),this.read_buffer(t,i,n=>{this.data_set(n),this.status_reg=88,this.sector_count_reg=this.sector_count_reg&-8|2,this.push_irq(),this.data_end=s&=-4,this.data_end>this.data_length&&(this.data_end=this.data_length),this.lba_mid_reg=this.data_end&255,this.lba_high_reg=this.data_end>>8&255,this.report_read_end(i)})):(this.status_reg=255,this.error_reg=65,this.push_irq())};xe.prototype.atapi_read_dma=function(e){var t=e[2]<<24|e[3]<<16|e[4]<<8|e[5],i=e[0]===168?e[6]<<24|e[7]<<16|e[8]<<8|e[9]:e[7]<<8|e[8];i>>>=0,e=e[1];var s=i*this.sector_size,n=t*this.sector_size;this.name+""+A(t)+A(i)+A(s)+A(e),n>=this.buffer.byteLength?(this.name+""+A(n+s)+A(this.buffer.byteLength),this.status_reg=255,this.push_irq()):(this.status_reg=208,this.report_read_start(),this.read_buffer(n,s,a=>{this.report_read_end(s),this.status_reg=88,this.sector_count_reg=this.sector_count_reg&-8|2,this.data_set(a),this.do_atapi_dma()}))};xe.prototype.do_atapi_dma=function(){if((this.channel.dma_status&1)!==0&&(this.status_reg&8)!==0){var e=this.channel.prdt_addr,t=0,i=this.data;do{var s=this.cpu.read32s(e),n=this.cpu.read16(e+4),a=this.cpu.read8(e+7)&128;if(n||(n=65536),this.cpu.write_blob(i.subarray(t,Math.min(t+n,this.data_length)),s),t+=n,e+=8,t>=this.data_length&&!a)break}while(!a);this.status_reg=80,this.channel.dma_status&=-2,this.sector_count_reg=this.sector_count_reg&-8|3,this.push_irq()}};xe.prototype.read_data=function(e){if(this.data_pointer<this.data_end){A(this.data_pointer);var t=e===1?this.data[this.data_pointer]:e===2?this.data16[this.data_pointer>>>1]:this.data32[this.data_pointer>>>2];return this.data_pointer+=e,this.data_pointer>=this.data_end&&this.read_end(),t}return this.data_pointer+=e,0};xe.prototype.read_end=function(){if(this.current_command===160)if(this.data_end===this.data_length)this.status_reg=80,this.sector_count_reg=this.sector_count_reg&-8|3,this.push_irq();else{this.status_reg=88,this.sector_count_reg=this.sector_count_reg&-8|2,this.push_irq();var e=this.lba_high_reg<<8&65280|this.lba_mid_reg&255;this.data_end+e>this.data_length?(this.lba_mid_reg=this.data_length-this.data_end&255,this.lba_high_reg=this.data_length-this.data_end>>8&255,this.data_end=this.data_length):this.data_end+=e}else this.error_reg=0,this.data_pointer>=this.data_length?this.status_reg=80:(e=this.current_command===41||this.current_command===196?Math.min(this.sectors_per_drq,(this.data_length-this.data_end)/512):1,this.ata_advance(this.current_command,e),this.data_end+=512*e,this.status_reg=88,this.push_irq())};xe.prototype.write_data_port=function(e,t){this.data_pointer>=this.data_end?(A(e),A(this.data_end),A(this.data_pointer)):(t===1?this.data[this.data_pointer++]=e:t===2?(this.data16[this.data_pointer>>>1]=e,this.data_pointer+=2):(this.data32[this.data_pointer>>>2]=e,this.data_pointer+=4),this.data_pointer===this.data_end&&this.write_end())};xe.prototype.write_data_port8=function(e){this.write_data_port(e,1)};xe.prototype.write_data_port16=function(e){this.write_data_port(e,2)};xe.prototype.write_data_port32=function(e){this.write_data_port(e,4)};xe.prototype.write_end=function(){this.current_command===160?this.atapi_handle():this.data_pointer>=this.data_length?this.do_write():(A(this.current_command),this.status_reg=88,this.data_end+=512,this.push_irq())};xe.prototype.ata_advance=function(e,t){this.sector_count_reg-=t,e===36||e===41||e===37||e===52||e===57||e===53?(e=t+this.get_lba48(),this.lba_low_reg=e&255|e>>16&65280,this.lba_mid_reg=e>>8&255,this.lba_high_reg=e>>16&255):this.is_lba?(e=t+this.get_lba28(),this.lba_low_reg=e&255,this.lba_mid_reg=e>>8&255,this.lba_high_reg=e>>16&255,this.head=this.head&-16|e&15):(e=t+this.get_chs(),t=e/(this.head_count*this.sectors_per_track)|0,this.lba_mid_reg=t&255,this.lba_high_reg=t>>8&255,this.head=(e/this.sectors_per_track|0)%this.head_count&15,this.lba_low_reg=e%this.sectors_per_track+1&255,this.get_chs())};xe.prototype.ata_read_sectors=function(e){var t=e===36||e===41,i=this.get_count(t);t=this.get_lba(t);var s=e===32||e===36,n=i*this.sector_size;t*=this.sector_size,t+n>this.buffer.byteLength?(this.status_reg=255,this.push_irq()):(this.status_reg=192,this.report_read_start(),this.read_buffer(t,n,a=>{this.data_set(a),this.status_reg=88,this.data_end=s?512:Math.min(n,512*this.sectors_per_drq),this.ata_advance(e,s?1:Math.min(i,this.sectors_per_track)),this.push_irq(),this.report_read_end(n)}))};xe.prototype.ata_read_sectors_dma=function(e){e=e===37;var t=this.get_count(e);this.get_lba(e)*this.sector_size+t*this.sector_size>this.buffer.byteLength?(this.status_reg=255,this.push_irq()):(this.status_reg=88,this.channel.dma_status|=1)};xe.prototype.do_ata_read_sectors_dma=function(){var e=this.current_command===37,t=this.get_count(e);e=this.get_lba(e);var i=t*this.sector_size;e*=this.sector_size,this.report_read_start(),this.read_buffer(e,i,s=>{var n=this.channel.prdt_addr,a=0;do{var c=this.cpu.read32s(n),r=this.cpu.read16(n+4),o=this.cpu.read8(n+7)&128;r||(r=65536),this.cpu.write_blob(s.subarray(a,a+r),c),a+=r,n+=8}while(!o);this.ata_advance(this.current_command,t),this.status_reg=80,this.channel.dma_status&=-2,this.current_command=-1,this.report_read_end(i),this.push_irq()})};xe.prototype.ata_write_sectors=function(e){var t=e===52||e===57,i=this.get_count(t);t=this.get_lba(t),e=e===48||e===52,i*=this.sector_size,t*=this.sector_size,t+i>this.buffer.byteLength?(this.status_reg=255,this.push_irq()):(this.status_reg=88,this.data_allocate_noclear(i),this.data_end=e?512:Math.min(i,512*this.sectors_per_drq),this.write_dest=t)};xe.prototype.ata_write_sectors_dma=function(e){e=e===53;var t=this.get_count(e);this.get_lba(e)*this.sector_size+t*this.sector_size>this.buffer.byteLength?(this.status_reg=255,this.push_irq()):(this.status_reg=88,this.channel.dma_status|=1)};xe.prototype.do_ata_write_sectors_dma=function(){var e=this.current_command===53,t=this.get_count(e),i=this.get_lba(e);e=t*this.sector_size,i*=this.sector_size;var s=this.channel.prdt_addr,n=0;const a=new Uint8Array(e);do{var c=this.cpu.read32s(s),r=this.cpu.read16(s+4),o=this.cpu.read8(s+7)&128;r||(r=65536),c=this.cpu.mem8.subarray(c,c+r),a.set(c,n),n+=r,s+=8}while(!o);this.buffer.set(i,a,()=>{this.ata_advance(this.current_command,t),this.status_reg=80,this.push_irq(),this.channel.dma_status&=-2,this.current_command=-1}),this.report_write(e)};xe.prototype.get_chs=function(){return((this.lba_mid_reg&255|this.lba_high_reg<<8&65280)*this.head_count+this.head)*this.sectors_per_track+(this.lba_low_reg&255)-1};xe.prototype.get_lba28=function(){return this.lba_low_reg&255|this.lba_mid_reg<<8&65280|this.lba_high_reg<<16&16711680|(this.head&15)<<24};xe.prototype.get_lba48=function(){return(this.lba_low_reg&255|this.lba_mid_reg<<8&65280|this.lba_high_reg<<16&16711680|this.lba_low_reg>>8<<24&4278190080)>>>0};xe.prototype.get_lba=function(e){return e?this.get_lba48():this.is_lba?this.get_lba28():this.get_chs()};xe.prototype.get_count=function(e){return e?(e=this.sector_count_reg,e===0&&(e=65536)):(e=this.sector_count_reg&255,e===0&&(e=256)),e};xe.prototype.create_identify_packet=function(){const e=Math.min(16383,this.cylinder_count),t=(c,r,o,u)=>{r<<=1;var f=o<<1;for(o=r+f,c.fill(32,r,f),f=0;f<u.length&&r<o;f++)f&1?(c[r]=u.charCodeAt(f),r+=2):c[r+1]=u.charCodeAt(f)},i=this.is_atapi?34112:64,s=this.current_command===160?0:1031,n=this.is_atapi?16928:16384,a=this.is_atapi?20480:29696;this.data.fill(0,0,512),this.data_set([i&255,i>>8&255,e&255,e>>8&255,0,0,this.head_count&255,this.head_count>>8&255,this.sectors_per_track/512&255,this.sectors_per_track/512>>8&255,0,2,this.sectors_per_track&255,this.sectors_per_track>>8&255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,2,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,128,0,1,0,0,2,0,0,0,2,0,2,7,0,e&255,e>>8&255,this.head_count&255,this.head_count>>8&255,this.sectors_per_track,0,this.sector_count&255,this.sector_count>>8&255,this.sector_count>>16&255,this.sector_count>>24&255,0,0,this.sector_count&255,this.sector_count>>8&255,this.sector_count>>16&255,this.sector_count>>24&255,0,0,s&255,s>>8&255,0,0,30,0,30,0,30,0,30,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,n&255,n>>8&255,a&255,a>>8&255,0,64,n&255,n>>8&255,a&255,a>>8&255,0,64,0,0,0,0,0,0,0,0,0,0,1,96,0,0,0,0,0,0,0,0,0,0,0,0,this.sector_count&255,this.sector_count>>8&255,this.sector_count>>16&255,this.sector_count>>24&255]),t(this.data,10,10,`8086-86${this.channel_nr}${this.interface_nr}`),t(this.data,23,4,"1.00"),t(this.data,27,20,this.is_atapi?"v86 ATAPI CD-ROM":"v86 ATA HD"),this.data_end=this.data_length=512};xe.prototype.data_allocate=function(e){this.data_allocate_noclear(e),this.data32.fill(0,0,e+3>>2)};xe.prototype.data_allocate_noclear=function(e){this.data.length<e&&(this.data=new Uint8Array(e+3&-4),this.data16=new Uint16Array(this.data.buffer),this.data32=new Int32Array(this.data.buffer)),this.data_length=e,this.data_pointer=0};xe.prototype.data_set=function(e){this.data_allocate_noclear(e.length),this.data.set(e)};xe.prototype.report_read_start=function(){this.bus.send("ide-read-start")};xe.prototype.report_read_end=function(e){this.bus.send("ide-read-end",[this.channel_nr,e,e/this.sector_size|0])};xe.prototype.report_write=function(e){this.bus.send("ide-write-end",[this.channel_nr,e,e/this.sector_size|0])};xe.prototype.read_buffer=function(e,t,i){const s=this.last_io_id++;this.in_progress_io_ids.add(s),this.buffer.get(e,t,n=>{this.cancelled_io_ids.delete(s)?this.in_progress_io_ids.has(s):(this.in_progress_io_ids.delete(s),i(n))})};xe.prototype.cancel_io_operations=function(){for(const e of this.in_progress_io_ids)this.cancelled_io_ids.add(e);this.in_progress_io_ids.clear()};xe.prototype.get_state=function(){var e=[];return e[0]=this.sector_count_reg,e[1]=this.cylinder_count,e[2]=this.lba_high_reg,e[3]=this.lba_mid_reg,e[4]=this.data_pointer,e[5]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=this.device_reg,e[10]=this.error_reg,e[11]=this.head,e[12]=this.head_count,e[13]=this.is_atapi,e[14]=this.is_lba,e[15]=this.features_reg,e[16]=this.data,e[17]=this.data_length,e[18]=this.lba_low_reg,e[19]=this.sector_count,e[20]=this.sector_size,e[21]=this.sectors_per_drq,e[22]=this.sectors_per_track,e[23]=this.status_reg,e[24]=this.write_dest,e[25]=this.current_command,e[26]=this.data_end,e[27]=this.current_atapi_command,e[28]=this.buffer,e};xe.prototype.set_state=function(e){this.sector_count_reg=e[0],this.cylinder_count=e[1],this.lba_high_reg=e[2],this.lba_mid_reg=e[3],this.data_pointer=e[4],this.device_reg=e[9],this.error_reg=e[10],this.head=e[11],this.head_count=e[12],this.is_atapi=e[13],this.is_lba=e[14],this.features_reg=e[15],this.data=e[16],this.data_length=e[17],this.lba_low_reg=e[18],this.sector_count=e[19],this.sector_size=e[20],this.sectors_per_drq=e[21],this.sectors_per_track=e[22],this.status_reg=e[23],this.write_dest=e[24],this.current_command=e[25],this.data_end=e[26],this.current_atapi_command=e[27],this.data16=new Uint16Array(this.data.buffer),this.data32=new Int32Array(this.data.buffer),this.buffer&&this.buffer.set_state(e[28]),this.drive_connected=this.is_atapi||this.buffer,this.medium_changed=!1};function ns(e,t,i){for(this.bus=t,this.id=e.devices.net?1:0,this.status=this.pairs=1,this.preserve_mac_from_state_image=i,this.mac=new Uint8Array([0,34,21,255*Math.random()|0,255*Math.random()|0,255*Math.random()|0]),this.bus.send("net"+this.id+"-mac",Jt(this.mac)),t=[],i=0;i<this.pairs;++i)t.push({size_supported:1024,notify_offset:0}),t.push({size_supported:1024,notify_offset:1});t.push({size_supported:16,notify_offset:2}),this.virtio=new dt(e,{name:"virtio-net",pci_id:80,device_id:4161,subsystem_device_id:1,common:{initial_port:51200,queues:t,features:[5,16,22,3,17,23,32],on_driver_ok:()=>{}},notification:{initial_port:51456,single_handler:!1,handlers:[()=>{},s=>{const n=this.virtio.queues[s];for(;n.has_request();){const a=n.pop_request(),c=new Uint8Array(a.length_readable);a.get_next_blob(c),this.bus.send("net"+this.id+"-send",c.subarray(12)),this.bus.send("eth-transmit-end",[c.length-12]),this.virtio.queues[s].push_reply(a)}this.virtio.queues[s].flush_replies()},s=>{if(s===2*this.pairs)for(var n=this.virtio.queues[s];n.has_request();){const a=n.pop_request(),c=new Uint8Array(a.length_readable);a.get_next_blob(c);const r=Le(["b","b"],c,{offset:0});switch(r[0]<<8|r[1]){case 1024:Le(["h"],c,{offset:2}),this.Send(s,a,new Uint8Array([0]));break;case 257:this.mac=c.subarray(2,8),this.Send(s,a,new Uint8Array([0])),this.bus.send("net"+this.id+"-mac",Jt(this.mac));break;default:this.Send(s,a,new Uint8Array([1]));return}}}]},isr_status:{initial_port:50944},device_specific:{initial_port:50688,struct:[0,1,2,3,4,5].map((s,n)=>({bytes:1,name:"mac_"+n,read:()=>this.mac[n],write:()=>{}})).concat([{bytes:2,name:"status",read:()=>this.status,write:()=>{}},{bytes:2,name:"max_pairs",read:()=>this.pairs,write:()=>{}},{bytes:2,name:"mtu",read:()=>1500,write:()=>{}}])}}),this.bus.register("net"+this.id+"-receive",s=>{this.bus.send("eth-receive-end",[s.length]);const n=new Uint8Array(12+s.byteLength);new DataView(n.buffer,n.byteOffset,n.byteLength).setInt16(10,1),n.set(s,12),s=this.virtio.queues[0],s.has_request()?(s=s.pop_request(),s.set_next_blob(n),this.virtio.queues[0].push_reply(s),this.virtio.queues[0].flush_replies()):console.log("No buffer to write into!")},this)}ns.prototype.get_state=function(){const e=[];return e[0]=this.virtio,e[1]=this.id,e[2]=this.mac,e};ns.prototype.set_state=function(e){this.virtio.set_state(e[0]),this.id=e[1],this.preserve_mac_from_state_image&&(this.mac=e[2],this.bus.send("net"+this.id+"-mac",Jt(this.mac)))};ns.prototype.reset=function(){this.virtio.reset()};ns.prototype.Send=function(e,t,i){t.set_next_blob(i),this.virtio.queues[e].push_reply(t),this.virtio.queues[e].flush_replies()};ns.prototype.Ack=function(e,t){this.virtio.queues[e].push_reply(t),this.virtio.queues[e].flush_replies()};const Dh=Uint32Array.from([655360,655360,720896,753664]),Kn=Uint32Array.from([131072,65536,32768,32768]);function _e(e,t,i,s){this.cpu=e,this.bus=t,this.screen=i,this.vga_memory_size=s,this.cursor_address=0,this.cursor_scanline_start=14,this.cursor_scanline_end=15,this.max_cols=80,this.max_rows=25,this.virtual_height=this.virtual_width=this.screen_height=this.screen_width=0,this.layers=[],this.start_address_latched=this.start_address=0,this.crtc=new Uint8Array(25),this.line_compare=this.offset_register=this.preset_row_scan=this.underline_location_register=this.vertical_blank_start=this.vertical_display_enable_end=this.horizontal_blank_start=this.horizontal_display_enable_end=this.crtc_mode=0,this.graphical_mode=!1,this.vga256_palette=new Int32Array(256),this.latch_dword=0,this.svga_version=45253,this.svga_height=this.svga_width=0,this.svga_enabled=!1,this.svga_bpp=32,this.svga_offset_y=this.svga_offset_x=this.svga_offset=this.svga_bank_offset=0,this.vga_memory_size=this.vga_memory_size===void 0||262144>this.vga_memory_size?262144:268435456<this.vga_memory_size?268435456:Wp(this.vga_memory_size),this.pci_space=[52,18,17,17,3,1,0,0,0,0,0,3,0,0,0,0,8,14680064,57344,224,0,0,0,0,0,0,191,254,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,244,26,0,17,0,0,190,254,0,0,0,0,0,0,0,0,0,0,0,0],this.pci_id=144,this.pci_bars=[{size:this.vga_memory_size}],this.pci_rom_size=65536,this.pci_rom_address=4272947200,this.name="vga",this.dac_state=this.dac_color_index_read=this.dac_color_index_write=this.index_crtc=0,this.dac_mask=255,this.dac_map=new Uint8Array(16),this.attribute_controller_index=-1,this.palette_source=32,this.color_select=this.horizontal_panning=this.color_plane_enable=this.attribute_mode=0,this.sequencer_index=-1,this.plane_write_bm=15,this.clocking_mode=this.sequencer_memory_mode=0,this.graphics_index=-1,this.planar_rotate_reg=this.planar_mode=this.plane_read=this.character_map_select=0,this.planar_bitmap=255,this.max_scan_line=this.color_dont_care=this.color_compare=this.miscellaneous_graphics_register=this.planar_setreset_enable=this.planar_setreset=0,this.port_3DA_value=this.miscellaneous_output_register=255,this.font_page_ab_enabled=!1,t=e.io,t.register_write(960,this,this.port3C0_write),t.register_read(960,this,this.port3C0_read,this.port3C0_read16),t.register_read(961,this,this.port3C1_read),t.register_write(962,this,this.port3C2_write),t.register_write_consecutive(964,this,this.port3C4_write,this.port3C5_write),t.register_read(964,this,this.port3C4_read),t.register_read(965,this,this.port3C5_read),t.register_write_consecutive(974,this,this.port3CE_write,this.port3CF_write),t.register_read(974,this,this.port3CE_read),t.register_read(975,this,this.port3CF_read),t.register_read(966,this,this.port3C6_read),t.register_write(966,this,this.port3C6_write),t.register_write(967,this,this.port3C7_write),t.register_read(967,this,this.port3C7_read),t.register_write(968,this,this.port3C8_write),t.register_read(968,this,this.port3C8_read),t.register_write(969,this,this.port3C9_write),t.register_read(969,this,this.port3C9_read),t.register_read(972,this,this.port3CC_read),t.register_write(980,this,this.port3D4_write,this.port3D4_write16),t.register_write(981,this,this.port3D5_write,this.port3D5_write16),t.register_read(980,this,this.port3D4_read),t.register_read(981,this,this.port3D5_read,this.port3D5_read16),t.register_write(948,this,this.port3D4_write,this.port3D4_write16),t.register_write(949,this,this.port3D5_write,this.port3D5_write16),t.register_read(948,this,this.port3D4_read),t.register_read(949,this,this.port3D5_read,this.port3D5_read16),t.register_read(970,this,function(){return 0}),t.register_read(986,this,this.port3DA_read),t.register_read(954,this,this.port3DA_read),this.dispi_index=-1,this.dispi_enable_value=0,t.register_write(462,this,void 0,this.port1CE_write),t.register_write(463,this,void 0,this.port1CF_write),t.register_read(463,this,void 0,this.port1CF_read),i=e.svga_allocate_memory(this.vga_memory_size)>>>0,this.svga_memory=be(Uint8Array,e.wasm_memory,i,this.vga_memory_size),this.diff_addr_min=this.vga_memory_size,this.diff_addr_max=0,this.diff_plot_min=this.vga_memory_size,this.diff_plot_max=0,this.image_data=null,this.vga_memory=new Uint8Array(262144),this.plane0=new Uint8Array(this.vga_memory.buffer,0,65536),this.plane1=new Uint8Array(this.vga_memory.buffer,65536,65536),this.plane2=new Uint8Array(this.vga_memory.buffer,131072,65536),this.plane3=new Uint8Array(this.vga_memory.buffer,196608,65536),this.pixel_buffer=new Uint8Array(524288),t.mmap_register(655360,131072,n=>this.vga_memory_read(n),(n,a)=>this.vga_memory_write(n,a)),e.devices.pci.register_device(this)}_e.prototype.get_state=function(){var e=[];return e[0]=this.vga_memory_size,e[1]=this.cursor_address,e[2]=this.cursor_scanline_start,e[3]=this.cursor_scanline_end,e[4]=this.max_cols,e[5]=this.max_rows,e[6]=this.vga_memory,e[7]=this.dac_state,e[8]=this.start_address,e[9]=this.graphical_mode,e[10]=this.vga256_palette,e[11]=this.latch_dword,e[12]=this.color_compare,e[13]=this.color_dont_care,e[14]=this.miscellaneous_graphics_register,e[15]=this.svga_width,e[16]=this.svga_height,e[17]=this.crtc_mode,e[18]=this.svga_enabled,e[19]=this.svga_bpp,e[20]=this.svga_bank_offset,e[21]=this.svga_offset,e[22]=this.index_crtc,e[23]=this.dac_color_index_write,e[24]=this.dac_color_index_read,e[25]=this.dac_map,e[26]=this.sequencer_index,e[27]=this.plane_write_bm,e[28]=this.sequencer_memory_mode,e[29]=this.graphics_index,e[30]=this.plane_read,e[31]=this.planar_mode,e[32]=this.planar_rotate_reg,e[33]=this.planar_bitmap,e[34]=this.max_scan_line,e[35]=this.miscellaneous_output_register,e[36]=this.port_3DA_value,e[37]=this.dispi_index,e[38]=this.dispi_enable_value,e[39]=this.svga_memory,e[41]=this.attribute_controller_index,e[42]=this.offset_register,e[43]=this.planar_setreset,e[44]=this.planar_setreset_enable,e[45]=this.start_address_latched,e[46]=this.crtc,e[47]=this.horizontal_display_enable_end,e[48]=this.horizontal_blank_start,e[49]=this.vertical_display_enable_end,e[50]=this.vertical_blank_start,e[51]=this.underline_location_register,e[52]=this.preset_row_scan,e[53]=this.offset_register,e[54]=this.palette_source,e[55]=this.attribute_mode,e[56]=this.color_plane_enable,e[57]=this.horizontal_panning,e[58]=this.color_select,e[59]=this.clocking_mode,e[60]=this.line_compare,e[61]=this.pixel_buffer,e[62]=this.dac_mask,e[63]=this.character_map_select,e[64]=this.font_page_ab_enabled,e};_e.prototype.set_state=function(e){this.vga_memory_size=e[0],this.cursor_address=e[1],this.cursor_scanline_start=e[2],this.cursor_scanline_end=e[3],this.max_cols=e[4],this.max_rows=e[5],e[6]&&this.vga_memory.set(e[6]),this.dac_state=e[7],this.start_address=e[8],this.graphical_mode=e[9],this.vga256_palette=e[10],this.latch_dword=e[11],this.color_compare=e[12],this.color_dont_care=e[13],this.miscellaneous_graphics_register=e[14],this.svga_width=e[15],this.svga_height=e[16],this.crtc_mode=e[17],this.svga_enabled=e[18],this.svga_bpp=e[19],this.svga_bank_offset=e[20],this.svga_offset=e[21],this.index_crtc=e[22],this.dac_color_index_write=e[23],this.dac_color_index_read=e[24],this.dac_map=e[25],this.sequencer_index=e[26],this.plane_write_bm=e[27],this.sequencer_memory_mode=e[28],this.graphics_index=e[29],this.plane_read=e[30],this.planar_mode=e[31],this.planar_rotate_reg=e[32],this.planar_bitmap=e[33],this.max_scan_line=e[34],this.miscellaneous_output_register=e[35],this.port_3DA_value=e[36],this.dispi_index=e[37],this.dispi_enable_value=e[38],this.svga_memory.set(e[39]),this.attribute_controller_index=e[41],this.offset_register=e[42],this.planar_setreset=e[43],this.planar_setreset_enable=e[44],this.start_address_latched=e[45],this.crtc.set(e[46]),this.horizontal_display_enable_end=e[47],this.horizontal_blank_start=e[48],this.vertical_display_enable_end=e[49],this.vertical_blank_start=e[50],this.underline_location_register=e[51],this.preset_row_scan=e[52],this.offset_register=e[53],this.palette_source=e[54],this.attribute_mode=e[55],this.color_plane_enable=e[56],this.horizontal_panning=e[57],this.color_select=e[58],this.clocking_mode=e[59],this.line_compare=e[60],e[61]&&this.pixel_buffer.set(e[61]),this.dac_mask=e[62]===void 0?255:e[62],this.character_map_select=e[63]===void 0?0:e[63],this.font_page_ab_enabled=e[64]===void 0?0:e[64],this.screen.set_mode(this.graphical_mode),this.graphical_mode?(this.screen_height=this.screen_width=0,this.svga_enabled?(this.set_size_graphical(this.svga_width,this.svga_height,this.svga_width,this.svga_height,this.svga_bpp),this.update_layers()):(this.update_vga_size(),this.update_layers(),this.complete_replot())):(this.set_font_bitmap(!0),this.set_size_text(this.max_cols,this.max_rows),this.set_font_page(),this.update_cursor_scanline(),this.update_cursor()),this.complete_redraw()};_e.prototype.vga_memory_read=function(e){if(this.svga_enabled)return this.cpu.read8((e-655360|this.svga_bank_offset)+3758096384|0);var t=this.miscellaneous_graphics_register>>2&3;return e-=Dh[t],0>e||e>=Kn[t]?(A(e>>>0),0):(this.latch_dword=this.plane0[e],this.latch_dword|=this.plane1[e]<<8,this.latch_dword|=this.plane2[e]<<16,this.latch_dword|=this.plane3[e]<<24,this.planar_mode&8?(t=255,this.color_dont_care&1&&(t&=this.plane0[e]^~(this.color_compare&1?255:0)),this.color_dont_care&2&&(t&=this.plane1[e]^~(this.color_compare&2?255:0)),this.color_dont_care&4&&(t&=this.plane2[e]^~(this.color_compare&4?255:0)),this.color_dont_care&8&&(t&=this.plane3[e]^~(this.color_compare&8?255:0)),t):(t=this.plane_read,this.graphical_mode?this.sequencer_memory_mode&8?(t=e&3,e&=-4):this.planar_mode&16&&(t=e&1,e&=-2):t&=3,this.vga_memory[t<<16|e]))};_e.prototype.vga_memory_write=function(e,t){if(this.svga_enabled)this.cpu.write8((e-655360|this.svga_bank_offset)+3758096384|0,t);else{var i=this.miscellaneous_graphics_register>>2&3;e-=Dh[i],0>e||e>=Kn[i]?(A(e>>>0),A(t)):this.graphical_mode?this.vga_memory_write_graphical(e,t):this.plane_write_bm&3?this.vga_memory_write_text_mode(e,t):this.plane_write_bm&4&&(this.plane2[e]=t)}};_e.prototype.vga_memory_write_graphical=function(e,t){var i=this.planar_mode&3,s=this.apply_feed(this.planar_bitmap),n=this.apply_expand(this.planar_setreset),a=this.apply_expand(this.planar_setreset_enable);switch(i){case 0:t=this.apply_rotate(t);var c=this.apply_feed(t);c=this.apply_setreset(c,a),c=this.apply_logical(c,this.latch_dword),c=this.apply_bitmask(c,s);break;case 1:c=this.latch_dword;break;case 2:c=this.apply_expand(t),c=this.apply_logical(c,this.latch_dword),c=this.apply_bitmask(c,s);break;case 3:t=this.apply_rotate(t),s&=this.apply_feed(t),c=this.apply_bitmask(n,s)}switch(t=15,this.sequencer_memory_mode&12){case 0:t=5<<(e&1),e&=-2;break;case 8:case 12:t=1<<(e&3),e&=-4}t&=this.plane_write_bm,t&1&&(this.plane0[e]=c>>0&255),t&2&&(this.plane1[e]=c>>8&255),t&4&&(this.plane2[e]=c>>16&255),t&8&&(this.plane3[e]=c>>24&255),e=this.vga_addr_to_pixel(e),this.partial_replot(e,e+7)};_e.prototype.apply_feed=function(e){return e|e<<8|e<<16|e<<24};_e.prototype.apply_expand=function(e){return(e&1?255:0)|(e&2?255:0)<<8|(e&4?255:0)<<16|(e&8?255:0)<<24};_e.prototype.apply_rotate=function(e){return(e|e<<8)>>>(this.planar_rotate_reg&7)&255};_e.prototype.apply_setreset=function(e,t){var i=this.apply_expand(this.planar_setreset);return(e|t&i)&(~t|i)};_e.prototype.apply_logical=function(e,t){switch(this.planar_rotate_reg&24){case 8:return e&t;case 16:return e|t;case 24:return e^t}return e};_e.prototype.apply_bitmask=function(e,t){return t&e|~t&this.latch_dword};_e.prototype.text_mode_redraw=function(){const e=this.scan_line_to_screen_row(this.line_compare),t=Math.max(0,2*(2*this.offset_register-this.max_cols)),i=this.attribute_mode&8,s=this.font_page_ab_enabled?7:15,n=i?7:15,a=this.screen.FLAG_BLINKING,c=this.screen.FLAG_FONT_PAGE_B;let r=this.start_address<<1;for(let o=0;o<this.max_rows;o++){o===e&&(r=0);for(let u=0;u<this.max_cols;u++){const f=this.vga_memory[r],l=this.vga_memory[r|1],m=(i&&l&128?a:0)|(!this.font_page_ab_enabled||l&8?0:c);this.bus.send("screen-put-char",[o,u,f]),this.screen.put_char(o,u,f,m,this.vga256_palette[this.dac_mask&this.dac_map[l>>4&n]],this.vga256_palette[this.dac_mask&this.dac_map[l&s]]),r+=2}r+=t}};_e.prototype.vga_memory_write_text_mode=function(e,t){this.vga_memory[e]=t;var i=Math.max(this.max_cols,2*this.offset_register);let s;if(e>>1>=this.start_address){var n=(e>>1)-this.start_address;s=n/i|0,i=n%i}else n=e>>1,s=(n/i|0)+this.scan_line_to_screen_row(this.line_compare),i=n%i;if(!(i>=this.max_cols||s>=this.max_rows)){e&1?(n=t,t=this.vga_memory[e&-2]):n=this.vga_memory[e|1];var a=this.attribute_mode&8;e=(a&&n&128?this.screen.FLAG_BLINKING:0)|(!this.font_page_ab_enabled||n&8?0:this.screen.FLAG_FONT_PAGE_B);var c=this.font_page_ab_enabled?7:15;a=a?7:15,this.bus.send("screen-put-char",[s,i,t]),this.screen.put_char(s,i,t,e,this.vga256_palette[this.dac_mask&this.dac_map[n>>4&a]],this.vga256_palette[this.dac_mask&this.dac_map[n&c]])}};_e.prototype.update_cursor=function(){var e=Math.max(this.max_cols,2*this.offset_register);let t;this.cursor_address>=this.start_address?(t=(this.cursor_address-this.start_address)/e|0,e=(this.cursor_address-this.start_address)%e):(t=(this.cursor_address/e|0)+this.scan_line_to_screen_row(this.line_compare),e=this.cursor_address%e),this.screen.update_cursor(t,e)};_e.prototype.complete_redraw=function(){this.graphical_mode?this.svga_enabled?this.cpu.svga_mark_dirty():(this.diff_addr_min=0,this.diff_addr_max=524288):this.text_mode_redraw()};_e.prototype.complete_replot=function(){this.graphical_mode&&!this.svga_enabled&&(this.diff_plot_min=0,this.diff_plot_max=524288,this.complete_redraw())};_e.prototype.partial_redraw=function(e,t){e<this.diff_addr_min&&(this.diff_addr_min=e),t>this.diff_addr_max&&(this.diff_addr_max=t)};_e.prototype.partial_replot=function(e,t){e<this.diff_plot_min&&(this.diff_plot_min=e),t>this.diff_plot_max&&(this.diff_plot_max=t),this.partial_redraw(e,t)};_e.prototype.reset_diffs=function(){this.diff_addr_min=this.vga_memory_size,this.diff_addr_max=0,this.diff_plot_min=this.vga_memory_size,this.diff_plot_max=0};_e.prototype.destroy=function(){};_e.prototype.vga_bytes_per_line=function(){var e=this.offset_register<<2;return this.underline_location_register&64?e<<=1:this.crtc_mode&64&&(e>>>=1),e};_e.prototype.vga_addr_shift_count=function(){var e=128+(~this.underline_location_register&this.crtc_mode&64);return e-=this.underline_location_register&64,e-=this.attribute_mode&64,e>>>6};_e.prototype.vga_addr_to_pixel=function(e){var t=this.vga_addr_shift_count();if(~this.crtc_mode&3){var i=e-this.start_address;i&=this.crtc_mode<<13|-24577,i<<=t;var s=i/this.virtual_width|0;switch(i%=this.virtual_width,this.crtc_mode&3){case 2:s=s<<1|e>>13&1;break;case 1:s=s<<1|e>>14&1;break;case 0:s=s<<2|e>>13&3}return s*this.virtual_width+i+(this.start_address<<t)}return e<<t};_e.prototype.scan_line_to_screen_row=function(e){return this.max_scan_line&128&&(e>>>=1),e=Math.ceil(e/(1+(this.max_scan_line&31))),this.crtc_mode&1||(e<<=1),this.crtc_mode&2||(e<<=1),e};_e.prototype.set_size_text=function(e,t){this.max_cols=e,this.max_rows=t,this.screen.set_size_text(e,t),this.bus.send("screen-set-size",[e,t,0])};_e.prototype.set_size_graphical=function(e,t,i,s,n){if(i=Math.max(i,1),s=Math.max(s,1),this.screen_width!==e||this.screen_height!==t||this.virtual_width!==i||this.virtual_height!==s){if(this.screen_width=e,this.screen_height=t,this.virtual_width=i,this.virtual_height=s,typeof ImageData<"u"){const a=i*s,c=this.cpu.svga_allocate_dest_buffer(a)>>>0;this.dest_buffet_offset=c,this.image_data=new ImageData(new Uint8ClampedArray(this.cpu.wasm_memory.buffer,c,4*a),i,s),this.cpu.svga_mark_dirty()}this.screen.set_size_graphical(e,t,i,s),this.bus.send("screen-set-size",[e,t,n])}};_e.prototype.update_vga_size=function(){if(!this.svga_enabled){var e=Math.min(1+this.horizontal_display_enable_end,this.horizontal_blank_start),t=Math.min(1+this.vertical_display_enable_end,this.vertical_blank_start);if(e&&t)if(this.graphical_mode){e<<=3;var i=this.offset_register<<4,s=4;this.attribute_mode&64?(e>>>=1,i>>>=1,s=8):this.attribute_mode&2&&(s=1),t=this.scan_line_to_screen_row(t);var n=Kn[0];const a=this.vga_bytes_per_line();this.set_size_graphical(e,t,i,a?Math.ceil(n/a):t,s),this.update_vertical_retrace(),this.update_layers()}else this.max_scan_line&128&&(t>>>=1),i=t/(1+(this.max_scan_line&31))|0,e&&i&&this.set_size_text(e,i)}};_e.prototype.update_layers=function(){if(this.graphical_mode||this.text_mode_redraw(),this.svga_enabled)this.layers=[];else if(this.virtual_width&&this.screen_width)if(!this.palette_source||this.clocking_mode&32)this.layers=[],this.screen.clear_screen();else{var e=this.start_address_latched,t=this.horizontal_panning;this.attribute_mode&64&&(t>>>=1);var i=this.preset_row_scan>>5&3,s=this.vga_addr_to_pixel(e+i);e=s/this.virtual_width|0;var n=s%this.virtual_width+t;s=this.scan_line_to_screen_row(1+this.line_compare),s=Math.min(s,this.screen_height);var a=this.screen_height-s;this.layers=[],n=-n;for(var c=0;n<this.screen_width;n+=this.virtual_width,c++)this.layers.push({image_data:this.image_data,screen_x:n,screen_y:0,buffer_x:0,buffer_y:e+c,buffer_width:this.virtual_width,buffer_height:s});for(e=0,this.attribute_mode&32||(e=this.vga_addr_to_pixel(i)+t),n=-e,c=0;n<this.screen_width;n+=this.virtual_width,c++)this.layers.push({image_data:this.image_data,screen_x:n,screen_y:s,buffer_x:0,buffer_y:c,buffer_width:this.virtual_width,buffer_height:a})}};_e.prototype.update_vertical_retrace=function(){this.port_3DA_value|=8,this.start_address_latched!==this.start_address&&(this.start_address_latched=this.start_address,this.update_layers())};_e.prototype.update_cursor_scanline=function(){var e=this.max_scan_line&31;const t=Math.min(e,this.cursor_scanline_start&31);e=Math.min(e,this.cursor_scanline_end&31),this.screen.update_cursor_scanline(t,e,!(this.cursor_scanline_start&32)&&t<e)};_e.prototype.port3C0_write=function(e){if(this.attribute_controller_index===-1)A(e),this.attribute_controller_index=e&31,A(this.attribute_controller_index),this.palette_source!==(e&32)&&(this.palette_source=e&32,this.update_layers());else{if(16>this.attribute_controller_index)A(this.attribute_controller_index),A(e),this.dac_map[this.attribute_controller_index]=e,this.attribute_mode&64||this.complete_redraw();else switch(this.attribute_controller_index){case 16:if(A(e),this.attribute_mode!==e){var t=this.attribute_mode;this.attribute_mode=e;const i=(e&1)!==0;this.svga_enabled||this.graphical_mode===i||(this.graphical_mode=i,this.screen.set_mode(this.graphical_mode)),(t^e)&64&&this.complete_replot(),this.update_vga_size(),this.complete_redraw(),this.set_font_bitmap(!1)}break;case 18:A(e),this.color_plane_enable!==e&&(this.color_plane_enable=e,this.complete_redraw());break;case 19:A(e),this.horizontal_panning!==e&&(this.horizontal_panning=e&15,this.update_layers());break;case 20:A(e),this.color_select!==e&&(this.color_select=e,this.complete_redraw());break;default:A(this.attribute_controller_index),A(e)}this.attribute_controller_index=-1}};_e.prototype.port3C0_read=function(){return(this.attribute_controller_index|this.palette_source)&255};_e.prototype.port3C0_read16=function(){return this.port3C0_read()|this.port3C1_read()<<8&65280};_e.prototype.port3C1_read=function(){if(16>this.attribute_controller_index)return A(this.attribute_controller_index),A(this.dac_map[this.attribute_controller_index]),this.dac_map[this.attribute_controller_index]&255;switch(this.attribute_controller_index){case 16:return A(this.attribute_mode),this.attribute_mode;case 18:return A(this.color_plane_enable),this.color_plane_enable;case 19:return A(this.horizontal_panning),this.horizontal_panning;case 20:return A(this.color_select),this.color_select;default:A(this.attribute_controller_index)}return 255};_e.prototype.port3C2_write=function(e){A(e),this.miscellaneous_output_register=e};_e.prototype.port3C4_write=function(e){this.sequencer_index=e};_e.prototype.port3C4_read=function(){return this.sequencer_index};_e.prototype.port3C5_write=function(e){switch(this.sequencer_index){case 1:A(e);var t=this.clocking_mode;this.clocking_mode=e,(t^e)&32&&this.update_layers(),this.set_font_bitmap(!1);break;case 2:A(e),t=this.plane_write_bm,this.plane_write_bm=e,this.graphical_mode||!(t&4)||this.plane_write_bm&4||this.set_font_bitmap(!0);break;case 3:A(e),t=this.character_map_select,this.character_map_select=e,this.graphical_mode||t===e||this.set_font_page();break;case 4:A(e),this.sequencer_memory_mode=e;break;default:A(this.sequencer_index),A(e)}};_e.prototype.port3C5_read=function(){switch(A(this.sequencer_index),this.sequencer_index){case 1:return this.clocking_mode;case 2:return this.plane_write_bm;case 3:return this.character_map_select;case 4:return this.sequencer_memory_mode;case 6:return 18}return 0};_e.prototype.port3C6_write=function(e){this.dac_mask!==e&&(this.dac_mask=e,this.complete_redraw())};_e.prototype.port3C6_read=function(){return this.dac_mask};_e.prototype.port3C7_write=function(e){A(e),this.dac_color_index_read=3*e,this.dac_state&=0};_e.prototype.port3C7_read=function(){return this.dac_state};_e.prototype.port3C8_write=function(e){this.dac_color_index_write=3*e,this.dac_state|=3};_e.prototype.port3C8_read=function(){return this.dac_color_index_write/3&255};_e.prototype.port3C9_write=function(e){var t=this.dac_color_index_write/3|0,i=this.dac_color_index_write%3,s=this.vga256_palette[t];if((this.dispi_enable_value&32)===0){e&=63;const n=e&1;e=e<<2|n<<1|n}i===0?s=s&-16711681|e<<16:i===1?s=s&-65281|e<<8:(s=s&-256|e,A(t),A(s)),this.vga256_palette[t]!==s&&(this.vga256_palette[t]=s,this.complete_redraw()),this.dac_color_index_write++};_e.prototype.port3C9_read=function(){var e=this.vga256_palette[this.dac_color_index_read/3|0]>>8*(2-this.dac_color_index_read%3)&255;return this.dac_color_index_read++,this.dispi_enable_value&32?e:e>>2};_e.prototype.port3CC_read=function(){return this.miscellaneous_output_register};_e.prototype.port3CE_write=function(e){this.graphics_index=e};_e.prototype.port3CE_read=function(){return this.graphics_index};_e.prototype.port3CF_write=function(e){switch(this.graphics_index){case 0:this.planar_setreset=e,A(e);break;case 1:this.planar_setreset_enable=e,A(e);break;case 2:this.color_compare=e,A(e);break;case 3:this.planar_rotate_reg=e,A(e);break;case 4:this.plane_read=e,A(e);break;case 5:var t=this.planar_mode;this.planar_mode=e,A(e),(t^e)&96&&this.complete_replot();break;case 6:A(e),this.miscellaneous_graphics_register!==e&&(this.miscellaneous_graphics_register=e,this.update_vga_size());break;case 7:this.color_dont_care=e,A(e);break;case 8:this.planar_bitmap=e,A(e);break;default:A(this.graphics_index),A(e)}};_e.prototype.port3CF_read=function(){switch(A(this.graphics_index),this.graphics_index){case 0:return this.planar_setreset;case 1:return this.planar_setreset_enable;case 2:return this.color_compare;case 3:return this.planar_rotate_reg;case 4:return this.plane_read;case 5:return this.planar_mode;case 6:return this.miscellaneous_graphics_register;case 7:return this.color_dont_care;case 8:return this.planar_bitmap}return 0};_e.prototype.port3D4_write=function(e){this.index_crtc=e};_e.prototype.port3D4_write16=function(e){this.port3D4_write(e&255),this.port3D5_write(e>>8&255)};_e.prototype.port3D4_read=function(){return this.index_crtc};_e.prototype.port3D5_write=function(e){switch(this.index_crtc){case 1:A(e),this.horizontal_display_enable_end!==e&&(this.horizontal_display_enable_end=e,this.update_vga_size());break;case 2:this.horizontal_blank_start!==e&&(this.horizontal_blank_start=e,this.update_vga_size());break;case 7:A(e);var t=this.vertical_display_enable_end;this.vertical_display_enable_end&=255,this.vertical_display_enable_end=this.vertical_display_enable_end|e<<3&512|e<<7&256,t!==this.vertical_display_enable_end&&this.update_vga_size(),this.line_compare=this.line_compare&767|e<<4&256,t=this.vertical_blank_start,this.vertical_blank_start=this.vertical_blank_start&767|e<<5&256,t!==this.vertical_blank_start&&this.update_vga_size(),this.update_layers();break;case 8:A(e),this.preset_row_scan=e,this.update_layers();break;case 9:A(e);var i=this.max_scan_line;this.max_scan_line=e,this.line_compare=this.line_compare&511|e<<3&512,t=this.vertical_blank_start,this.vertical_blank_start=this.vertical_blank_start&511|e<<4&512,((i^this.max_scan_line)&159||t!==this.vertical_blank_start)&&this.update_vga_size(),this.update_cursor_scanline(),this.update_layers(),this.set_font_bitmap(!1);break;case 10:A(e),this.cursor_scanline_start=e,this.update_cursor_scanline();break;case 11:A(e),this.cursor_scanline_end=e,this.update_cursor_scanline();break;case 12:(this.start_address>>8&255)!==e&&(this.start_address=this.start_address&255|e<<8,this.update_layers(),~this.crtc_mode&3&&this.complete_replot()),A(e),A(this.start_address,4);break;case 13:(this.start_address&255)!==e&&(this.start_address=this.start_address&65280|e,this.update_layers(),~this.crtc_mode&3&&this.complete_replot()),A(e),A(this.start_address,4);break;case 14:A(e),this.cursor_address=this.cursor_address&255|e<<8,this.update_cursor();break;case 15:A(e),this.cursor_address=this.cursor_address&65280|e,this.update_cursor();break;case 18:A(e),(this.vertical_display_enable_end&255)!==e&&(this.vertical_display_enable_end=this.vertical_display_enable_end&768|e,this.update_vga_size());break;case 19:A(e),this.offset_register!==e&&(this.offset_register=e,this.update_vga_size(),~this.crtc_mode&3&&this.complete_replot());break;case 20:A(e),this.underline_location_register!==e&&(t=this.underline_location_register,this.underline_location_register=e,this.update_vga_size(),(t^e)&64&&this.complete_replot());break;case 21:A(e),(this.vertical_blank_start&255)!==e&&(this.vertical_blank_start=this.vertical_blank_start&768|e,this.update_vga_size());break;case 23:A(e),this.crtc_mode!==e&&(t=this.crtc_mode,this.crtc_mode=e,this.update_vga_size(),(t^e)&67&&this.complete_replot());break;case 24:A(e),this.line_compare=this.line_compare&768|e,this.update_layers();break;default:this.index_crtc<this.crtc.length&&(this.crtc[this.index_crtc]=e),A(this.index_crtc),A(e)}};_e.prototype.port3D5_write16=function(e){A(e,4),this.port3D5_write(e&255)};_e.prototype.port3D5_read=function(){switch(A(this.index_crtc),this.index_crtc){case 1:return this.horizontal_display_enable_end;case 2:return this.horizontal_blank_start;case 7:return this.vertical_display_enable_end>>7&2|this.vertical_blank_start>>5&8|this.line_compare>>4&16|this.vertical_display_enable_end>>3&64;case 8:return this.preset_row_scan;case 9:return this.max_scan_line;case 10:return this.cursor_scanline_start;case 11:return this.cursor_scanline_end;case 12:return this.start_address&255;case 13:return this.start_address>>8;case 14:return this.cursor_address>>8;case 15:return this.cursor_address&255;case 18:return this.vertical_display_enable_end&255;case 19:return this.offset_register;case 20:return this.underline_location_register;case 21:return this.vertical_blank_start&255;case 23:return this.crtc_mode;case 24:return this.line_compare&255}return this.index_crtc<this.crtc.length?this.crtc[this.index_crtc]:0};_e.prototype.port3D5_read16=function(){return this.port3D5_read()};_e.prototype.port3DA_read=function(){var e=this.port_3DA_value;return this.graphical_mode?(this.port_3DA_value^=1,this.port_3DA_value&=1):(this.port_3DA_value&1&&(this.port_3DA_value^=8),this.port_3DA_value^=1),this.attribute_controller_index=-1,e};_e.prototype.port1CE_write=function(e){this.dispi_index=e};_e.prototype.port1CF_write=function(e){A(this.dispi_index),A(e);const t=this.svga_enabled;switch(this.dispi_index){case 0:45248<=e&&45253>=e?this.svga_version=e:A(e);break;case 1:this.svga_width=e,2560<this.svga_width&&(this.svga_width=2560);break;case 2:this.svga_height=e,1600<this.svga_height&&(this.svga_height=1600);break;case 3:this.svga_bpp=e;break;case 4:(this.svga_enabled=(e&1)===1)&&(e&128)===0&&this.svga_memory.fill(0),this.dispi_enable_value=e;break;case 5:A(e<<16),this.svga_bank_offset=e<<16;break;case 8:A(e),this.svga_offset_x!==e&&(this.svga_offset_x=e,this.svga_offset=this.svga_offset_y*this.svga_width+this.svga_offset_x,this.complete_redraw());break;case 9:A(e*this.svga_width),A(e),this.svga_offset_y!==e&&(this.svga_offset_y=e,this.svga_offset=this.svga_offset_y*this.svga_width+this.svga_offset_x,this.complete_redraw());break;default:A(this.dispi_index)}!this.svga_enabled||this.svga_width&&this.svga_height||(this.svga_enabled=!1),this.svga_enabled&&!t&&(this.svga_offset_y=this.svga_offset_x=this.svga_offset=0,this.graphical_mode=!0,this.screen.set_mode(this.graphical_mode),this.set_size_graphical(this.svga_width,this.svga_height,this.svga_width,this.svga_height,this.svga_bpp)),t&&!this.svga_enabled&&(this.graphical_mode=e=(this.attribute_mode&1)!==0,this.screen.set_mode(e),this.update_vga_size(),this.set_font_bitmap(!1),this.complete_redraw()),this.svga_enabled||(this.svga_bank_offset=0),this.update_layers()};_e.prototype.port1CF_read=function(){return A(this.dispi_index),this.svga_register_read(this.dispi_index)};_e.prototype.svga_register_read=function(e){switch(e){case 0:return this.svga_version;case 1:return this.dispi_enable_value&2?2560:this.svga_width;case 2:return this.dispi_enable_value&2?1600:this.svga_height;case 3:return this.dispi_enable_value&2?32:this.svga_bpp;case 4:return this.dispi_enable_value;case 5:return this.svga_bank_offset>>>16;case 6:return this.screen_width?this.screen_width:1;case 8:return this.svga_offset_x;case 9:return this.svga_offset_y;case 10:return this.vga_memory_size/65536|0;default:A(this.dispi_index)}return 255};_e.prototype.vga_replot=function(){for(var e=this.diff_plot_min&-16,t=Math.min(this.diff_plot_max|15,524287),i=this.vga_addr_shift_count(),s=~this.crtc_mode&3,n=this.planar_mode&96,a=this.attribute_mode&64;e<=t;){var c=e>>>i;if(s){var r=e/this.virtual_width|0,o=e-this.virtual_width*r;switch(s){case 1:c=(r&1)<<13,r>>>=1;break;case 2:c=(r&1)<<14,r>>>=1;break;case 3:c=(r&3)<<13,r>>>=2}c|=(r*this.virtual_width+o>>>i)+this.start_address}r=this.plane0[c],o=this.plane1[c];var u=this.plane2[c],f=this.plane3[c];switch(c=new Uint8Array(8),n){case 0:r<<=0,o<<=1,u<<=2,f<<=3;for(var l=7;0<=l;l--)c[7-l]=r>>l&1|o>>l&2|u>>l&4|f>>l&8;break;case 32:c[0]=r>>6&3|u>>4&12,c[1]=r>>4&3|u>>2&12,c[2]=r>>2&3|u>>0&12,c[3]=r>>0&3|u<<2&12,c[4]=o>>6&3|f>>4&12,c[5]=o>>4&3|f>>2&12,c[6]=o>>2&3|f>>0&12,c[7]=o>>0&3|f<<2&12;break;case 64:case 96:c[0]=r>>4&15,c[1]=r>>0&15,c[2]=o>>4&15,c[3]=o>>0&15,c[4]=u>>4&15,c[5]=u>>0&15,c[6]=f>>4&15,c[7]=f>>0&15}if(a)for(r=l=0;4>l;l++,e++,r+=2)this.pixel_buffer[e]=c[r]<<4|c[r+1];else for(l=0;8>l;l++,e++)this.pixel_buffer[e]=c[l]}};_e.prototype.vga_redraw=function(){var e=this.diff_addr_min,t=Math.min(this.diff_addr_max,524287);const i=new Int32Array(this.cpu.wasm_memory.buffer,this.dest_buffet_offset,this.virtual_width*this.virtual_height);var s=255,n=0;if(this.attribute_mode&128&&(s&=207,n|=this.color_select<<4&48),this.attribute_mode&64)for(;e<=t;e++){var a=this.pixel_buffer[e]&s|n;a=this.vga256_palette[a],i[e]=a&65280|a<<16|a>>16|4278190080}else for(s&=63,n|=this.color_select<<4&192;e<=t;e++)a=this.dac_map[this.pixel_buffer[e]&this.color_plane_enable]&s|n,a=this.vga256_palette[a],i[e]=a&65280|a<<16|a>>16|4278190080};_e.prototype.screen_fill_buffer=function(){if(this.graphical_mode){if(this.image_data.data.byteLength===0){var e=new Uint8ClampedArray(this.cpu.wasm_memory.buffer,this.dest_buffet_offset,4*this.virtual_width*this.virtual_height);this.image_data=new ImageData(e,this.virtual_width,this.virtual_height),this.update_layers()}if(this.svga_enabled){e=0;let s=this.svga_height;if(this.svga_bpp===8){const n=new Int32Array(this.cpu.wasm_memory.buffer,this.dest_buffet_offset,this.screen_width*this.screen_height),a=new Uint8Array(this.cpu.wasm_memory.buffer,this.svga_memory.byteOffset,this.vga_memory_size);for(var t=0;t<n.length;t++){var i=this.vga256_palette[a[t]];n[t]=i&65280|i<<16|i>>16|4278190080}}else this.cpu.svga_fill_pixel_buffer(this.svga_bpp,this.svga_offset),t=this.svga_bpp===15?2:this.svga_bpp/8,e=((this.cpu.svga_dirty_bitmap_min_offset[0]/t|0)-this.svga_offset)/this.svga_width|0,s=(((this.cpu.svga_dirty_bitmap_max_offset[0]/t|0)-this.svga_offset)/this.svga_width|0)+1;e<s&&(e=Math.max(e,0),s=Math.min(s,this.svga_height),this.screen.update_buffer([{image_data:this.image_data,screen_x:0,screen_y:e,buffer_x:0,buffer_y:e,buffer_width:this.svga_width,buffer_height:s-e}]))}else this.vga_replot(),this.vga_redraw(),this.screen.update_buffer(this.layers);this.reset_diffs()}this.update_vertical_retrace()};_e.prototype.set_font_bitmap=function(e){const t=this.max_scan_line&31;if(t&&!this.graphical_mode){const i=!!(this.clocking_mode&8);this.screen.set_font_bitmap(t+1,!i&&!(this.clocking_mode&1),i,!!(this.attribute_mode&4),this.plane2,e)}};_e.prototype.set_font_page=function(){const e=[0,2,4,6,1,3,5,7],t=(this.character_map_select&12)>>2|(this.character_map_select&32)>>3,i=this.character_map_select&3|(this.character_map_select&16)>>2;this.font_page_ab_enabled=t!==i,this.screen.set_font_page(e[t],e[i]),this.complete_redraw()};const um="SWAP_IN SWAP_OUT MAJFLT MINFLT MEMFREE MEMTOT AVAIL CACHES HTLB_PGALLOC HTLB_PGFAIL".split(" ");function Ti(e,t){this.bus=t,this.zeroed=this.fp_cmd=this.actual=this.num_pages=0,this.virtio=new dt(e,{name:"virtio-balloon",pci_id:88,device_id:4165,subsystem_device_id:5,common:{initial_port:55296,queues:[{size_supported:32,notify_offset:0},{size_supported:32,notify_offset:0},{size_supported:2,notify_offset:1},{size_supported:64,notify_offset:2}],features:[1,3,32],on_driver_ok:()=>{}},notification:{initial_port:55552,single_handler:!1,handlers:[i=>{const s=this.virtio.queues[i];for(;s.has_request();){var n=s.pop_request();const a=new Uint8Array(n.length_readable);n.get_next_blob(a),this.virtio.queues[i].push_reply(n),n=a.byteLength/4,this.actual+=i===0?n:-n}this.virtio.queues[i].flush_replies()},i=>{var s=this.virtio.queues[i];if(s.has_request()){s=s.pop_request();const n=new Uint8Array(s.length_readable);s.get_next_blob(n);let a={};for(let c=0;c<s.length_readable;c+=10){let[r,o]=Le(["h","d"],n,{offset:c});a[um[r]]=o}this.virtio.queues[i].push_reply(s),this.stats_cb&&this.stats_cb(a)}},i=>{const s=this.virtio.queues[i];for(;s.has_request();){const a=s.pop_request();if(0<a.length_readable){var n=new Uint8Array(a.length_readable);a.get_next_blob(n),[n]=Le(["w"],n,{offset:0}),n===0&&(this.free_cb&&this.free_cb(this.zeroed),1<this.fp_cmd&&(this.fp_cmd=1),this.virtio.notify_config_changes())}if(0<a.length_writable)for(n=0;n<a.write_buffers.length;++n){let c=a.write_buffers[n];this.zeroed+=c.len,this.virtio.cpu.zero_memory(c.addr_low,c.len)}this.virtio.queues[i].push_reply(a)}this.virtio.queues[i].flush_replies()}]},isr_status:{initial_port:55040},device_specific:{initial_port:54784,struct:[{bytes:4,name:"num_pages",read:()=>this.num_pages,write:()=>{}},{bytes:4,name:"actual",read:()=>this.actual,write:()=>{}},{bytes:4,name:"free_page_hint_cmd_id",read:()=>this.fp_cmd,write:()=>{}}]}})}Ti.prototype.Inflate=function(e){this.num_pages+=e,this.virtio.notify_config_changes()};Ti.prototype.Deflate=function(e){this.num_pages-=e,this.virtio.notify_config_changes()};Ti.prototype.Cleanup=function(e){this.fp_cmd=2,this.free_cb=e,this.zeroed=0,this.virtio.notify_config_changes()};Ti.prototype.get_state=function(){const e=[];return e[0]=this.virtio,e[1]=this.num_pages,e[2]=this.actual,e};Ti.prototype.set_state=function(e){this.virtio.set_state(e[0]),this.num_pages=e[1],this.actual=e[2]};Ti.prototype.GetStats=function(e){for(this.stats_cb=e,e=this.virtio.queues[2];e.has_request();){const t=e.pop_request();this.virtio.queues[2].push_reply(t)}this.virtio.queues[2].flush_replies()};Ti.prototype.Reset=function(){};function _m(e,t,i,s){var n=new Uint8Array(t);const a=new Uint16Array(t);var c=new Uint32Array(t),r=n[497]||4,o=a[255];if(o!==43605)A(o);else if(o=a[257]|a[258]<<16,o!==1400005704)A(o);else{o=a[259];var u=n[529],f=a[283],l=c[139],m=c[140],g=n[565],C=518<=o?c[142]:255,v=c[146],h=c[147],p=c[150],_=c[151],d=c[152];for(A(o),A(u),A(f),A(c[133]),A(l),A(m),A(g),A(C),A(v),A(h),A(_),A(p),A(d),n[528]=255,n[529]=u&-97|128,a[274]=56832,a[253]=65535,A(56832),s+="\0",A(581632),c[138]=581632,n=0;n<s.length;n++)e[581632+n]=s.charCodeAt(n);for(r=512*(r+1),A(r),s=new Uint8Array(t,0,r),t=new Uint8Array(t,r),n=r=0,i&&(r=67108864,n=i.byteLength,e.set(new Uint8Array(i),r)),c[134]=r,c[135]=n,e.set(s,524288),e.set(t,1048576),e=new Uint8Array(512),new Uint16Array(e.buffer)[0]=43605,e[2]=1,i=3,e[i++]=250,e[i++]=184,e[i++]=32768,e[i++]=128,e[i++]=142,e[i++]=192,e[i++]=142,e[i++]=216,e[i++]=142,e[i++]=224,e[i++]=142,e[i++]=232,e[i++]=142,e[i++]=208,e[i++]=188,e[i++]=57344,e[i++]=224,e[i++]=234,e[i++]=0,e[i++]=0,e[i++]=32800,e[i++]=128,c=e[i]=0,t=0;t<e.length;t++)c+=e[t];return e[i]=-c,{name:"genroms/kernel.bin",data:e}}}function we(e,t,i){this.stop_idling=i,this.wm=t,this.wasm_patch(),this.create_jit_imports(),this.wasm_memory=t=this.wm.exports.memory,this.memory_size=be(Uint32Array,t,812,1),this.mem8=new Uint8Array(0),this.mem32s=new Int32Array(this.mem8.buffer),this.segment_is_null=be(Uint8Array,t,724,8),this.segment_offsets=be(Int32Array,t,736,8),this.segment_limits=be(Uint32Array,t,768,8),this.segment_access_bytes=be(Uint8Array,t,512,8),this.protected_mode=be(Int32Array,t,800,1),this.idtr_size=be(Int32Array,t,564,1),this.idtr_offset=be(Int32Array,t,568,1),this.gdtr_size=be(Int32Array,t,572,1),this.gdtr_offset=be(Int32Array,t,576,1),this.tss_size_32=be(Int32Array,t,1128,1),this.page_fault=be(Uint32Array,t,540,8),this.cr=be(Int32Array,t,580,8),this.cpl=be(Uint8Array,t,612,1),this.is_32=be(Int32Array,t,804,1),this.stack_size_32=be(Int32Array,t,808,1),this.in_hlt=be(Uint8Array,t,616,1),this.last_virt_eip=be(Int32Array,t,620,1),this.eip_phys=be(Int32Array,t,624,1),this.sysenter_cs=be(Int32Array,t,636,1),this.sysenter_esp=be(Int32Array,t,640,1),this.sysenter_eip=be(Int32Array,t,644,1),this.prefixes=be(Int32Array,t,648,1),this.flags=be(Int32Array,t,120,1),this.flags_changed=be(Int32Array,t,100,1),this.last_op_size=be(Int32Array,t,96,1),this.last_op1=be(Int32Array,t,104,1),this.last_result=be(Int32Array,t,112,1),this.current_tsc=be(Uint32Array,t,960,2),this.devices={},this.instruction_pointer=be(Int32Array,t,556,1),this.previous_ip=be(Int32Array,t,560,1),this.apic_enabled=be(Uint8Array,t,548,1),this.acpi_enabled=be(Uint8Array,t,552,1),this.memory_map_read8=[],this.memory_map_write8=[],this.memory_map_read32=[],this.memory_map_write32=[],this.bios={main:null,vga:null},this.instruction_counter=be(Uint32Array,t,664,1),this.reg32=be(Int32Array,t,64,8),this.fpu_st=be(Int32Array,t,1152,32),this.fpu_stack_empty=be(Uint8Array,t,816,1),this.fpu_stack_empty[0]=255,this.fpu_stack_ptr=be(Uint8Array,t,1032,1),this.fpu_stack_ptr[0]=0,this.fpu_control_word=be(Uint16Array,t,1036,1),this.fpu_control_word[0]=895,this.fpu_status_word=be(Uint16Array,t,1040,1),this.fpu_status_word[0]=0,this.fpu_ip=be(Int32Array,t,1048,1),this.fpu_ip[0]=0,this.fpu_ip_selector=be(Int32Array,t,1052,1),this.fpu_ip_selector[0]=0,this.fpu_opcode=be(Int32Array,t,1044,1),this.fpu_opcode[0]=0,this.fpu_dp=be(Int32Array,t,1056,1),this.fpu_dp[0]=0,this.fpu_dp_selector=be(Int32Array,t,1060,1),this.fpu_dp_selector[0]=0,this.reg_xmm32s=be(Int32Array,t,832,32),this.mxcsr=be(Int32Array,t,824,1),this.sreg=be(Uint16Array,t,668,8),this.dreg=be(Int32Array,t,684,8),this.reg_pdpte=be(Int32Array,t,968,8),this.svga_dirty_bitmap_min_offset=be(Uint32Array,t,716,1),this.svga_dirty_bitmap_max_offset=be(Uint32Array,t,720,1),this.fw_value=[],this.fw_pointer=0,this.option_roms=[],this.io=void 0,this.bus=e,this.set_tsc(0,0)}we.prototype.mmap_read8=function(e){return this.memory_map_read8[e>>>17](e)};we.prototype.mmap_write8=function(e,t){this.memory_map_write8[e>>>17](e,t)};we.prototype.mmap_read16=function(e){var t=this.memory_map_read8[e>>>17];return t(e)|t(e+1|0)<<8};we.prototype.mmap_write16=function(e,t){var i=this.memory_map_write8[e>>>17];i(e,t&255),i(e+1|0,t>>8)};we.prototype.mmap_read32=function(e){return this.memory_map_read32[e>>>17](e)};we.prototype.mmap_write32=function(e,t){this.memory_map_write32[e>>>17](e,t)};we.prototype.mmap_write64=function(e,t,i){var s=this.memory_map_write32[e>>>17];s(e,t),s(e+4,i)};we.prototype.mmap_write128=function(e,t,i,s,n){var a=this.memory_map_write32[e>>>17];a(e,t),a(e+4,i),a(e+8,s),a(e+12,n)};we.prototype.write_blob=function(e,t){e.length&&(this.in_mapped_range(t),this.in_mapped_range(t+e.length-1),this.jit_dirty_cache(t,t+e.length),this.mem8.set(e,t))};we.prototype.read_blob=function(e,t){return t&&(this.in_mapped_range(e),this.in_mapped_range(e+t-1)),this.mem8.subarray(e,e+t)};we.prototype.clear_opstats=function(){new Uint8Array(this.wasm_memory.buffer,32768,131072).fill(0),this.wm.exports.profiler_init()};we.prototype.create_jit_imports=function(){const e=Object.create(null);e.m=this.wm.exports.memory;for(const t of Object.keys(this.wm.exports))t.startsWith("_")||t.startsWith("zstd")||t.endsWith("_js")||(e[t]=this.wm.exports[t]);this.jit_imports=e};we.prototype.wasm_patch=function(){const e=i=>this.wm.exports[i],t=i=>{const s=e(i);return console.assert(s,"Missing import: "+i),s};this.reset_cpu=t("reset_cpu"),this.getiopl=t("getiopl"),this.get_eflags=t("get_eflags"),this.handle_irqs=t("handle_irqs"),this.main_loop=t("main_loop"),this.set_jit_config=t("set_jit_config"),this.read8=t("read8"),this.read16=t("read16"),this.read32s=t("read32s"),this.write8=t("write8"),this.write16=t("write16"),this.write32=t("write32"),this.in_mapped_range=t("in_mapped_range"),this.fpu_load_tag_word=t("fpu_load_tag_word"),this.fpu_load_status_word=t("fpu_load_status_word"),this.fpu_get_sti_f64=t("fpu_get_sti_f64"),this.translate_address_system_read=t("translate_address_system_read_js"),this.get_seg_cs=t("get_seg_cs"),this.get_real_eip=t("get_real_eip"),this.clear_tlb=t("clear_tlb"),this.full_clear_tlb=t("full_clear_tlb"),this.update_state_flags=t("update_state_flags"),this.set_tsc=t("set_tsc"),this.store_current_tsc=t("store_current_tsc"),this.set_cpuid_level=t("set_cpuid_level"),this.device_raise_irq=t("device_raise_irq"),this.device_lower_irq=t("device_lower_irq"),this.apic_timer=t("apic_timer"),this.jit_clear_cache=t("jit_clear_cache_js"),this.jit_dirty_cache=t("jit_dirty_cache"),this.codegen_finalize_finished=t("codegen_finalize_finished"),this.allocate_memory=t("allocate_memory"),this.zero_memory=t("zero_memory"),this.is_memory_zeroed=t("is_memory_zeroed"),this.svga_allocate_memory=t("svga_allocate_memory"),this.svga_allocate_dest_buffer=t("svga_allocate_dest_buffer"),this.svga_fill_pixel_buffer=t("svga_fill_pixel_buffer"),this.svga_mark_dirty=t("svga_mark_dirty"),this.get_pic_addr_master=t("get_pic_addr_master"),this.get_pic_addr_slave=t("get_pic_addr_slave"),this.get_apic_addr=t("get_apic_addr"),this.get_ioapic_addr=t("get_ioapic_addr"),this.zstd_create_ctx=t("zstd_create_ctx"),this.zstd_get_src_ptr=t("zstd_get_src_ptr"),this.zstd_free_ctx=t("zstd_free_ctx"),this.zstd_read=t("zstd_read"),this.zstd_read_free=t("zstd_read_free")};we.prototype.jit_force_generate=function(e){this.jit_force_generate_unsafe&&this.jit_force_generate_unsafe(e)};we.prototype.jit_clear_func=function(e){this.wm.wasm_table.set(e+1024,null)};we.prototype.jit_clear_all_funcs=function(){const e=this.wm.wasm_table;for(let t=0;900>t;t++)e.set(1024+t,null)};we.prototype.get_state=function(){var e=[];e[0]=this.memory_size[0],e[1]=new Uint8Array([...this.segment_is_null,...this.segment_access_bytes]),e[2]=this.segment_offsets,e[3]=this.segment_limits,e[4]=this.protected_mode[0],e[5]=this.idtr_offset[0],e[6]=this.idtr_size[0],e[7]=this.gdtr_offset[0],e[8]=this.gdtr_size[0],e[9]=this.page_fault[0],e[10]=this.cr,e[11]=this.cpl[0],e[13]=this.is_32[0],e[16]=this.stack_size_32[0],e[17]=this.in_hlt[0],e[18]=this.last_virt_eip[0],e[19]=this.eip_phys[0],e[22]=this.sysenter_cs[0],e[23]=this.sysenter_eip[0],e[24]=this.sysenter_esp[0],e[25]=this.prefixes[0],e[26]=this.flags[0],e[27]=this.flags_changed[0],e[28]=this.last_op1[0],e[30]=this.last_op_size[0],e[37]=this.instruction_pointer[0],e[38]=this.previous_ip[0],e[39]=this.reg32,e[40]=this.sreg,e[41]=this.dreg,e[42]=this.reg_pdpte,this.store_current_tsc(),e[43]=this.current_tsc,e[45]=this.devices.virtio_9p,e[46]=this.get_state_apic(),e[47]=this.devices.rtc,e[48]=this.devices.pci,e[49]=this.devices.dma,e[50]=this.devices.acpi,e[52]=this.devices.vga,e[53]=this.devices.ps2,e[54]=this.devices.uart0,e[55]=this.devices.fdc,this.devices.ide.secondary?e[85]=this.devices.ide:this.devices.ide.primary?.master.is_atapi?e[56]=this.devices.ide.primary:e[57]=this.devices.ide.primary,e[58]=this.devices.pit,e[59]=this.devices.net,e[60]=this.get_state_pic(),e[61]=this.devices.sb16,e[62]=this.fw_value,e[63]=this.get_state_ioapic(),e[64]=this.tss_size_32[0],e[66]=this.reg_xmm32s,e[67]=this.fpu_st,e[68]=this.fpu_stack_empty[0],e[69]=this.fpu_stack_ptr[0],e[70]=this.fpu_control_word[0],e[71]=this.fpu_ip[0],e[72]=this.fpu_ip_selector[0],e[73]=this.fpu_dp[0],e[74]=this.fpu_dp_selector[0],e[75]=this.fpu_opcode[0];const{packed_memory:t,bitmap:i}=this.pack_memory();return e[77]=t,e[78]=new Uint8Array(i.get_buffer()),e[79]=this.devices.uart1,e[80]=this.devices.uart2,e[81]=this.devices.uart3,e[82]=this.devices.virtio_console,e[83]=this.devices.virtio_net,e[84]=this.devices.virtio_balloon,e};we.prototype.get_state_pic=function(){const e=new Uint8Array(this.wasm_memory.buffer,this.get_pic_addr_master(),13),t=new Uint8Array(this.wasm_memory.buffer,this.get_pic_addr_slave(),13),i=[],s=[];return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[4]=e[4],i[5]=s,i[6]=e[6],i[7]=e[7],i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=e[12],s[0]=t[0],s[1]=t[1],s[2]=t[2],s[3]=t[3],s[4]=t[4],s[5]=null,s[6]=t[6],s[7]=t[7],s[8]=t[8],s[9]=t[9],s[10]=t[10],s[11]=t[11],s[12]=t[12],i};we.prototype.get_state_apic=function(){return new Uint8Array(this.wasm_memory.buffer,this.get_apic_addr(),184)};we.prototype.get_state_ioapic=function(){return new Uint8Array(this.wasm_memory.buffer,this.get_ioapic_addr(),208)};we.prototype.set_state=function(e){if(this.memory_size[0]=e[0],this.mem8.length!==this.memory_size[0]&&console.warn("Note: Memory size mismatch. we="+this.mem8.length+" state="+this.memory_size[0]),e[1].length===8?(this.segment_is_null.set(e[1]),this.segment_access_bytes.fill(242),this.segment_access_bytes[1]=250):e[1].length===16&&(this.segment_is_null.set(e[1].subarray(0,8)),this.segment_access_bytes.set(e[1].subarray(8,16))),this.segment_offsets.set(e[2]),this.segment_limits.set(e[3]),this.protected_mode[0]=e[4],this.idtr_offset[0]=e[5],this.idtr_size[0]=e[6],this.gdtr_offset[0]=e[7],this.gdtr_size[0]=e[8],this.page_fault[0]=e[9],this.cr.set(e[10]),this.cpl[0]=e[11],this.is_32[0]=e[13],this.stack_size_32[0]=e[16],this.in_hlt[0]=e[17],this.last_virt_eip[0]=e[18],this.eip_phys[0]=e[19],this.sysenter_cs[0]=e[22],this.sysenter_eip[0]=e[23],this.sysenter_esp[0]=e[24],this.prefixes[0]=e[25],this.flags[0]=e[26],this.flags_changed[0]=e[27],this.last_op1[0]=e[28],this.last_op_size[0]=e[30],this.instruction_pointer[0]=e[37],this.previous_ip[0]=e[38],this.reg32.set(e[39]),this.sreg.set(e[40]),this.dreg.set(e[41]),e[42]&&this.reg_pdpte.set(e[42]),this.set_tsc(e[43][0],e[43][1]),this.devices.virtio_9p&&this.devices.virtio_9p.set_state(e[45]),e[46]&&this.set_state_apic(e[46]),this.devices.rtc&&this.devices.rtc.set_state(e[47]),this.devices.dma&&this.devices.dma.set_state(e[49]),this.devices.acpi&&this.devices.acpi.set_state(e[50]),this.devices.vga&&this.devices.vga.set_state(e[52]),this.devices.ps2&&this.devices.ps2.set_state(e[53]),this.devices.uart0&&this.devices.uart0.set_state(e[54]),this.devices.fdc&&this.devices.fdc.set_state(e[55]),e[56]||e[57]){var t=[[void 0,void 0],[void 0,void 0]];t[0][0]=e[56]?{is_cdrom:!0,buffer:this.devices.cdrom.buffer}:{is_cdrom:!1,buffer:this.devices.ide.primary.master.buffer},this.devices.ide=new br(this,this.devices.ide.bus,t),this.devices.cdrom=e[56]?this.devices.ide.primary.master:void 0,this.devices.ide.primary.set_state(e[56]||e[57])}else e[85]&&this.devices.ide.set_state(e[85]);this.devices.pci&&this.devices.pci.set_state(e[48]),this.devices.pit&&this.devices.pit.set_state(e[58]),this.devices.net&&this.devices.net.set_state(e[59]),this.set_state_pic(e[60]),this.devices.sb16&&this.devices.sb16.set_state(e[61]),this.devices.uart1&&this.devices.uart1.set_state(e[79]),this.devices.uart2&&this.devices.uart2.set_state(e[80]),this.devices.uart3&&this.devices.uart3.set_state(e[81]),this.devices.virtio_console&&this.devices.virtio_console.set_state(e[82]),this.devices.virtio_net&&this.devices.virtio_net.set_state(e[83]),this.devices.virtio_balloon&&this.devices.virtio_balloon.set_state(e[84]),this.fw_value=e[62],e[63]&&this.set_state_ioapic(e[63]),this.tss_size_32[0]=e[64],this.reg_xmm32s.set(e[66]),this.fpu_st.set(e[67]),this.fpu_stack_empty[0]=e[68],this.fpu_stack_ptr[0]=e[69],this.fpu_control_word[0]=e[70],this.fpu_ip[0]=e[71],this.fpu_ip_selector[0]=e[72],this.fpu_dp[0]=e[73],this.fpu_dp_selector[0]=e[74],this.fpu_opcode[0]=e[75],t=new Is(e[78].buffer),this.unpack_memory(t,e[77]),this.update_state_flags(),this.full_clear_tlb(),this.jit_clear_cache()};we.prototype.set_state_pic=function(e){const t=new Uint8Array(this.wasm_memory.buffer,this.get_pic_addr_master(),13),i=new Uint8Array(this.wasm_memory.buffer,this.get_pic_addr_slave(),13);t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4];const s=e[5];t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],i[0]=s[0],i[1]=s[1],i[2]=s[2],i[3]=s[3],i[4]=s[4],i[6]=s[6],i[7]=s[7],i[8]=s[8],i[9]=s[9],i[10]=s[10],i[11]=s[11],i[12]=s[12]};we.prototype.set_state_apic=function(e){if(e instanceof Array){const t=new Int32Array(this.wasm_memory.buffer,this.get_apic_addr(),46);t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[8]=e[6],t[9]=e[7],t[10]=e[8],t[11]=e[9],t[12]=e[10],t[13]=e[11],t[14]=e[12],t[15]=e[13],t.set(e[15],16),t.set(e[15],24),t.set(e[16],32),t[40]=e[17],t[41]=e[18],t[42]=e[19],t[43]=e[20],t[44]=e[21],t[45]=e[22]||65536}else new Uint8Array(this.wasm_memory.buffer,this.get_apic_addr(),184).set(e)};we.prototype.set_state_ioapic=function(e){if(e instanceof Array){const t=new Int32Array(this.wasm_memory.buffer,this.get_ioapic_addr(),52);t.set(e[0],0),t.set(e[1],24),t[48]=e[2],t[49]=e[3],t[50]=e[4],t[51]=e[5]}else new Uint8Array(this.wasm_memory.buffer,this.get_ioapic_addr(),208).set(e)};we.prototype.pack_memory=function(){for(var e=this.mem8.length>>12,t=[],i=0;i<e;i++)this.is_memory_zeroed(i<<12,4096)||t.push(i);e=new Is(e),i=new Uint8Array(t.length<<12);for(const[s,n]of t.entries())e.set(n,1),t=n<<12,t=this.mem8.subarray(t,t+4096),i.set(t,s<<12);return{bitmap:e,packed_memory:i}};we.prototype.unpack_memory=function(e,t){this.zero_memory(0,this.memory_size[0]);const i=this.memory_size[0]>>12;let s=0;for(let a=0;a<i;a++)if(e.get(a)){var n=s<<12;n=t.subarray(n,n+4096),this.mem8.set(n,a<<12),s++}};we.prototype.reboot_internal=function(){this.reset_cpu(),this.fw_value=[],this.devices.virtio_9p&&this.devices.virtio_9p.reset(),this.devices.virtio_console&&this.devices.virtio_console.reset(),this.devices.virtio_net&&this.devices.virtio_net.reset(),this.devices.ps2&&this.devices.ps2.reset(),this.load_bios()};we.prototype.reset_memory=function(){this.mem8.fill(0)};we.prototype.create_memory=function(e,t){e<t?e=t:0>(e|0)&&(e=Math.pow(2,31)-131072),e=(e-1|131071)+1|0,console.assert(this.memory_size[0]===0,"Expected uninitialised memory"),this.memory_size[0]=e,t=this.allocate_memory(e),this.mem8=be(Uint8Array,this.wasm_memory,t,e),this.mem32s=be(Uint32Array,this.wasm_memory,t,e>>2)};we.prototype.init=function(e,t){this.create_memory(e.memory_size||67108864,e.initrd?67108864:1048576),e.disable_jit&&this.set_jit_config(0,1),e.cpuid_level&&this.set_cpuid_level(e.cpuid_level),this.acpi_enabled[0]=+e.acpi,this.reset_cpu();var i=new ht(this);if(this.io=i,this.bios.main=e.bios,this.bios.vga=e.vga_bios,this.load_bios(),e.bzimage){const n=_m(this.mem8,e.bzimage,e.initrd,e.cmdline||"");n&&this.option_roms.push(n)}i.register_read(179,this,function(){return 0});var s=0;i.register_read(146,this,function(){return s}),i.register_write(146,this,function(n){s=n}),i.register_read(1297,this,function(){return this.fw_pointer<this.fw_value.length?this.fw_value[this.fw_pointer++]:0}),i.register_write(1296,this,void 0,function(n){function a(o){return new Uint8Array(Int32Array.of(o).buffer)}function c(o){return o>>8|o<<8&65280}function r(o){return o<<24|o<<8&16711680|o>>8&65280|o>>>24}if(""+A(n),this.fw_pointer=0,n===0)this.fw_value=a(1431127377);else if(n===1)this.fw_value=a(0);else if(n===3)this.fw_value=a(this.memory_size[0]);else if(n===5)this.fw_value=a(1);else if(n===15)this.fw_value=a(1);else if(n===13)this.fw_value=new Uint8Array(16);else if(n===25){n=new Int32Array(4+64*this.option_roms.length);const o=new Uint8Array(n.buffer);n[0]=r(this.option_roms.length);for(let u=0;u<this.option_roms.length;u++){const{name:f,data:l}=this.option_roms[u],m=4+64*u;n[m+0>>2]=r(l.length),n[m+4>>2]=c(49152+u);for(let g=0;g<f.length;g++)o[m+8+g]=f.charCodeAt(g)}this.fw_value=o}else 32768<=n&&49152>n?this.fw_value=a(0):49152<=n&&n-49152<this.option_roms.length?this.fw_value=this.option_roms[n-49152].data:(""+A(n),this.fw_value=a(0))}),this.devices={},e.load_devices&&(this.devices.pci=new $t(this),this.acpi_enabled[0]&&(this.devices.acpi=new Us(this)),this.devices.rtc=new Mt(this),this.fill_cmos(this.devices.rtc,e),this.devices.dma=new Ze(this),this.devices.vga=new _e(this,t,e.screen,e.vga_memory_size||8388608),this.devices.ps2=new gt(this,t),this.devices.uart0=new Pt(this,1016,t),e.uart1&&(this.devices.uart1=new Pt(this,760,t)),e.uart2&&(this.devices.uart2=new Pt(this,1e3,t)),e.uart3&&(this.devices.uart3=new Pt(this,744,t)),this.devices.fdc=new Re(this,e.fda,e.fdb),i=[[void 0,void 0],[void 0,void 0]],e.hda&&(i[0][0]={buffer:e.hda},i[0][1]={buffer:e.hdb}),i[1][0]={is_cdrom:!0,buffer:e.cdrom},this.devices.ide=new br(this,t,i),this.devices.cdrom=this.devices.ide.secondary.master,this.devices.pit=new ri(this,t),e.net_device.type==="ne2k"?this.devices.net=new At(this,t,e.preserve_mac_from_state_image,e.mac_address_translation):e.net_device.type==="virtio"&&(this.devices.virtio_net=new ns(this,t,e.preserve_mac_from_state_image)),e.fs9p?this.devices.virtio_9p=new ni(e.fs9p,this,t):e.handle9p?this.devices.virtio_9p=new wr(e.handle9p,this):e.proxy9p&&(this.devices.virtio_9p=new Bt(e.proxy9p,this)),e.virtio_console&&(this.devices.virtio_console=new pi(this,t)),e.virtio_balloon&&(this.devices.virtio_balloon=new Ti(this,t)),this.devices.sb16=new de(this,t)),e.multiboot&&(e=this.load_multiboot_option_rom(e.multiboot,e.initrd,e.cmdline))&&(this.bios.main?this.option_roms.push(e):this.reg32[0]=this.io.port_read32(244)),this.debug_init()};we.prototype.load_multiboot=function(e){this.load_multiboot_option_rom(e,void 0,"")&&(this.reg32[0]=this.io.port_read32(244))};we.prototype.load_multiboot_option_rom=function(e,t,i){if(8192>e.byteLength){var s=new Int32Array(2048);new Uint8Array(s.buffer).set(new Uint8Array(e))}else s=new Int32Array(e,0,2048);for(var n=0;8192>n;n+=4){if(s[n>>2]===464367618){var a=s[n+4>>2];if(464367618+a+s[n+8>>2]|0)continue}else continue;""+A(a>>>0,8);var c=this;this.io.register_read(244,this,function(){return 0},function(){return 0},function(){var f=31860,l=0;if(i){l|=4,c.write32(31760,f),i+="\0";var m=new TextEncoder().encode(i);c.write_blob(m,f),f+=m.length}if(a&2){l|=64,m=0,c.write32(31788,0),c.write32(31792,f);var g=0,C=!1;for(let h=0;4294967296>h;h+=131072)C&&c.memory_map_read8[h>>>17]!==void 0?(c.write32(f,20),c.write32(f+4,g),c.write32(f+8,0),c.write32(f+12,h-g),c.write32(f+16,0),c.write32(f+20,1),f+=24,m+=24,C=!1):C||c.memory_map_read8[h>>>17]!==void 0||(g=h,C=!0);c.write32(31788,m)}if(c.write32(31744,l),m=l=0,a&65536){C=s[n+12>>2],l=s[n+16>>2];var v=s[n+20>>2];m=s[n+24>>2],g=s[n+28>>2],A(C,8),A(l,8),A(v,8),A(m,8),A(g,8),C=new Uint8Array(e,n-(C-l),v===0?void 0:v-l),c.write_blob(C,l),l=g|0,m=Math.max(v,m)}else if(s[0]===1179403647){g=new DataView(e);const[h,p]=Lh(g,Ah);console.assert(p===52),console.assert(h.magic===1179403647,"Bad magic"),console.assert(h.class===1,"Unimplemented: 64 bit elf"),console.assert(h.data===1,"Unimplemented: big endian"),console.assert(h.version0===1,"Bad version0"),console.assert(h.type===2,"Unimplemented type"),console.assert(h.version1===1,"Bad version1"),console.assert(h.ehsize===52,"Bad header size"),console.assert(h.phentsize===32,"Bad program header size"),console.assert(h.shentsize===40,"Bad section header size"),[l]=fa(new DataView(g.buffer,g.byteOffset+h.phoff,h.phentsize*h.phnum),Rh,h.phnum),fa(new DataView(g.buffer,g.byteOffset+h.shoff,h.shentsize*h.shnum),Th,h.shnum),g=h,C=l,l=g.entry;for(v of C)v.type!==0&&(v.type===1?v.paddr+v.memsz<c.memory_size[0]?(v.filesz&&(C=new Uint8Array(e,v.offset,v.filesz),c.write_blob(C,v.paddr)),m=Math.max(m,v.paddr+v.memsz),l===g.entry&&v.vaddr<=l&&v.vaddr+v.memsz>l&&(l=l-v.vaddr+v.paddr)):A(v.paddr):v.type===2||v.type===3||v.type===4||v.type===6||v.type===7||v.type===1685382480||v.type===1685382481||v.type===1685382482||v.type===1685382483||A(v.type))}for(t&&(c.write32(31764,1),c.write32(31768,f),v=m,(v&4095)!==0&&(v=(v&-4096)+4096),m=v+t.byteLength,c.write32(f,v),c.write32(f+4,m),c.write32(f+8,0),c.write32(f+12,0),c.write_blob(new Uint8Array(t),v)),c.reg32[3]=31744,c.cr[0]=1,c.protected_mode[0]=1,c.flags[0]=2,c.is_32[0]=1,c.stack_size_32[0]=1,f=0;6>f;f++)c.segment_is_null[f]=0,c.segment_offsets[f]=0,c.segment_limits[f]=4294967295,c.sreg[f]=45058;return c.instruction_pointer[0]=c.get_seg_cs()+l|0,c.update_state_flags(),c.dump_state(),c.dump_regs_short(),732803074}),this.io.register_write_consecutive(244,this,function(f){throw console.log("Test exited with code "+A(f,2)),"HALT"},function(){},function(){},function(){});for(let f=0;15>=f;f++){let l=function(m){A(f),A(m,2),m?this.device_raise_irq(f):this.device_lower_irq(f)};this.io.register_write(8192+f,this,l,l,l)}const o=new Uint8Array(512);new Uint16Array(o.buffer)[0]=43605,o[2]=1;var r=3;o[r++]=102,o[r++]=229,o[r++]=244;let u=o[r]=0;for(let f=0;f<o.length;f++)u+=o[f];return o[r]=-u,{name:"genroms/multiboot.bin",data:o}}};we.prototype.fill_cmos=function(e,t){var i=t.boot_order||291;e.cmos_write(56,1|i>>4&240),e.cmos_write(61,i&255),e.cmos_write(21,128),e.cmos_write(22,2),i=0,1048576<=this.memory_size[0]&&(i=this.memory_size[0]-1048576>>10,i=Math.min(i,65535)),e.cmos_write(23,i&255),e.cmos_write(24,i>>8&255),e.cmos_write(48,i&255),e.cmos_write(49,i>>8&255),i=0,16777216<=this.memory_size[0]&&(i=this.memory_size[0]-16777216>>16,i=Math.min(i,65535)),e.cmos_write(52,i&255),e.cmos_write(53,i>>8&255),e.cmos_write(91,0),e.cmos_write(92,0),e.cmos_write(93,0),e.cmos_write(20,47),e.cmos_write(95,0),t.fastboot&&e.cmos_write(63,1)};we.prototype.load_bios=function(){var e=this.bios.main,t=this.bios.vga;if(e){var i=new Uint8Array(e);if(this.write_blob(i,1048576-e.byteLength),t){var s=new Uint8Array(t);this.write_blob(s,786432),this.io.mmap_register(4272947200,1048576,function(n){return n=n-4272947200|0,n<s.length?s[n]:0},function(){})}this.io.mmap_register(4293918720,1048576,(function(n){return this.mem8[n&1048575]}).bind(this),(function(n,a){this.mem8[n&1048575]=a}).bind(this))}};we.prototype.codegen_finalize=function(e,t,i,s,n){const a=new Uint8Array(this.wasm_memory.buffer,s>>>0,n>>>0);WebAssembly.instantiate(a,{e:this.jit_imports}).then(c=>{this.wm.wasm_table.set(e+1024,c.instance.exports.f),this.codegen_finalize_finished(e,t,i),this.test_hook_did_finalize_wasm&&this.test_hook_did_finalize_wasm(a)})};we.prototype.log_uncompiled_code=function(){};we.prototype.dump_function_code=function(){};we.prototype.run_hardware_timers=function(e,t){const i=this.devices.pit.timer(t,!1),s=this.devices.rtc.timer(t,!1);let n=100,a=100;return e&&(n=this.devices.acpi.timer(t),a=this.apic_timer(t)),Math.min(i,s,n,a)};we.prototype.debug_init=function(){};we.prototype.dump_stack=function(){};we.prototype.debug_get_state=function(){};we.prototype.dump_state=function(){};we.prototype.get_regs_short=function(){};we.prototype.dump_regs_short=function(){};we.prototype.dump_gdt_ldt=function(){};we.prototype.dump_idt=function(){};we.prototype.dump_page_structures=function(){if(this.cr[4]&32)for(var e=0;4>e;e++){var t=this.read32s(this.cr[3]+8*e);t&1&&this.dump_page_directory(t&4294963200,!0,e<<30)}else this.dump_page_directory(this.cr[3],!1,0)};we.prototype.dump_page_directory=function(){};we.prototype.get_memory_dump=function(){};we.prototype.memory_hex_dump=function(){};we.prototype.used_memory_dump=function(){};we.prototype.debug_interrupt=function(){};we.prototype.debug_dump_code=function(){};we.prototype.dump_wasm=function(){};function dt(e,t){this.cpu=e,this.pci=e.devices.pci,this.device_id=t.device_id,this.pci_space=[244,26,t.device_id&255,t.device_id>>8,7,5,16,0,1,0,2,0,0,0,0,0,1,168,0,0,0,16,191,254,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,244,26,t.subsystem_device_id&255,t.subsystem_device_id>>8,0,0,0,0,64,0,0,0,0,0,0,0,0,1,0,0],this.pci_space=this.pci_space.concat(Array(256-this.pci_space.length).fill(0)),this.pci_id=t.pci_id,this.pci_bars=[],this.name=t.name,this.driver_feature_select=this.device_feature_select=0,this.device_feature=new Uint32Array(4),this.driver_feature=new Uint32Array(4);for(var i of t.common.features)this.device_feature[i>>>5]|=1<<(i&31),this.driver_feature[i>>>5]|=1<<(i&31);t.common.features.includes(32),this.features_ok=!0,this.device_status=0,this.config_has_changed=!1,this.config_generation=0,this.queues=[];for(const s of t.common.queues)this.queues.push(new Qe(e,this,s));this.queue_select=0,this.queue_selected=this.queues[0],this.isr_status=0,i=[],i.push(this.create_common_capability(t.common)),i.push(this.create_notification_capability(t.notification)),i.push(this.create_isr_capability(t.isr_status)),t.device_specific&&i.push(this.create_device_specific_capability(t.device_specific)),this.init_capabilities(i),e.devices.pci.register_device(this),this.reset()}dt.prototype.create_common_capability=function(e){return{type:1,bar:0,port:e.initial_port,use_mmio:!1,offset:0,extra:new Uint8Array(0),struct:[{bytes:4,name:"device_feature_select",read:()=>this.device_feature_select,write:t=>{this.device_feature_select=t}},{bytes:4,name:"device_feature",read:()=>this.device_feature[this.device_feature_select]||0,write:()=>{}},{bytes:4,name:"driver_feature_select",read:()=>this.driver_feature_select,write:t=>{this.driver_feature_select=t}},{bytes:4,name:"driver_feature",read:()=>this.driver_feature[this.driver_feature_select]||0,write:t=>{const i=this.device_feature[this.driver_feature_select];this.driver_feature_select<this.driver_feature.length&&(this.driver_feature[this.driver_feature_select]=t&i),this.features_ok=this.features_ok&&!(t&~i)}},{bytes:2,name:"msix_config",read:()=>65535,write:()=>{}},{bytes:2,name:"num_queues",read:()=>this.queues.length,write:()=>{}},{bytes:1,name:"device_status",read:()=>this.device_status,write:t=>{t===0&&this.reset(),t&~this.device_status&4&&this.device_status&64&&this.notify_config_changes(),this.features_ok||(t&=-9),this.device_status=t,t&~this.device_status&4&&e.on_driver_ok()}},{bytes:1,name:"config_generation",read:()=>this.config_generation,write:()=>{}},{bytes:2,name:"queue_select",read:()=>this.queue_select,write:t=>{this.queue_select=t,this.queue_selected=this.queue_select<this.queues.length?this.queues[this.queue_select]:null}},{bytes:2,name:"queue_size",read:()=>this.queue_selected?this.queue_selected.size:0,write:t=>{this.queue_selected&&(t&t-1&&(t=1<<As(t-1)+1),t>this.queue_selected.size_supported&&(t=this.queue_selected.size_supported),this.queue_selected.set_size(t))}},{bytes:2,name:"queue_msix_vector",read:()=>65535,write:()=>{}},{bytes:2,name:"queue_enable",read:()=>this.queue_selected?this.queue_selected.enabled|0:0,write:t=>{this.queue_selected&&t===1&&this.queue_selected.is_configured()&&this.queue_selected.enable()}},{bytes:2,name:"queue_notify_off",read:()=>this.queue_selected?this.queue_selected.notify_offset:0,write:()=>{}},{bytes:4,name:"queue_desc (low dword)",read:()=>this.queue_selected?this.queue_selected.desc_addr:0,write:t=>{this.queue_selected&&(this.queue_selected.desc_addr=t)}},{bytes:4,name:"queue_desc (high dword)",read:()=>0,write:()=>{}},{bytes:4,name:"queue_avail (low dword)",read:()=>this.queue_selected?this.queue_selected.avail_addr:0,write:t=>{this.queue_selected&&(this.queue_selected.avail_addr=t)}},{bytes:4,name:"queue_avail (high dword)",read:()=>0,write:()=>{}},{bytes:4,name:"queue_used (low dword)",read:()=>this.queue_selected?this.queue_selected.used_addr:0,write:t=>{this.queue_selected&&(this.queue_selected.used_addr=t)}},{bytes:4,name:"queue_used (high dword)",read:()=>0,write:()=>{}}]}};dt.prototype.create_notification_capability=function(e){const t=[];let i;i=e.single_handler?0:2;for(const[s,n]of e.handlers.entries())t.push({bytes:2,name:"notify"+s,read:()=>65535,write:n||(()=>{})});return{type:2,bar:1,port:e.initial_port,use_mmio:!1,offset:0,extra:new Uint8Array([i&255,i>>8&255,i>>16&255,i>>24]),struct:t}};dt.prototype.create_isr_capability=function(e){return{type:3,bar:2,port:e.initial_port,use_mmio:!1,offset:0,extra:new Uint8Array(0),struct:[{bytes:1,name:"isr_status",read:()=>{const t=this.isr_status;return this.lower_irq(),t},write:()=>{}}]}};dt.prototype.create_device_specific_capability=function(e){return{type:4,bar:3,port:e.initial_port,use_mmio:!1,offset:0,extra:new Uint8Array(0),struct:e.struct}};dt.prototype.init_capabilities=function(e){let t=this.pci_space[52]=64;var i=t;for(const n of e){e=16+n.extra.length,i=t,t=i+e;var s=n.struct.reduce((a,c)=>a+c.bytes,0);s+=n.offset,s=16>s?16:1<<As(s-1)+1,this.pci_bars[n.bar]={size:s},this.pci_space[i]=9,this.pci_space[i+1]=t,this.pci_space[i+2]=e,this.pci_space[i+3]=n.type,this.pci_space[i+4]=n.bar,this.pci_space[i+5]=0,this.pci_space[i+6]=0,this.pci_space[i+7]=0,this.pci_space[i+8]=n.offset&255,this.pci_space[i+9]=n.offset>>>8&255,this.pci_space[i+10]=n.offset>>>16&255,this.pci_space[i+11]=n.offset>>>24,this.pci_space[i+12]=s&255,this.pci_space[i+13]=s>>>8&255,this.pci_space[i+14]=s>>>16&255,this.pci_space[i+15]=s>>>24;for(const[a,c]of n.extra.entries())this.pci_space[i+16+a]=c;i=16+4*n.bar,this.pci_space[i]=n.port&254|!n.use_mmio,this.pci_space[i+1]=n.port>>>8&255,this.pci_space[i+2]=n.port>>>16&255,this.pci_space[i+3]=n.port>>>24&255,i=n.port+n.offset;for(const a of n.struct){let c=a.read;if(e=a.write,!n.use_mmio){s=function(u){return c(u&-2)>>((u&1)<<3)&255};const r=function(u){return c(u&-4)>>((u&3)<<3)&255},o=function(u){return c(u)};switch(a.bytes){case 4:this.cpu.io.register_read(i,this,r,void 0,c),this.cpu.io.register_read(i+1,this,r),this.cpu.io.register_read(i+2,this,r),this.cpu.io.register_read(i+3,this,r),this.cpu.io.register_write(i,this,void 0,void 0,e);break;case 2:this.cpu.io.register_read(i,this,s,c,o),this.cpu.io.register_read(i+1,this,s),this.cpu.io.register_write(i,this,void 0,e);break;case 1:this.cpu.io.register_read(i,this,c),this.cpu.io.register_write(i,this,e)}}i+=a.bytes}}this.pci_space[t]=9,this.pci_space[t+1]=0,this.pci_space[t+2]=20,this.pci_space[t+3]=5,this.pci_space[t+4]=0,this.pci_space[t+5]=0,this.pci_space[t+6]=0,this.pci_space[t+7]=0,this.pci_space[t+8]=0,this.pci_space[t+9]=0,this.pci_space[t+10]=0,this.pci_space[t+11]=0,this.pci_space[t+12]=0,this.pci_space[t+13]=0,this.pci_space[t+14]=0,this.pci_space[t+15]=0,this.pci_space[t+16]=0,this.pci_space[t+17]=0,this.pci_space[t+18]=0,this.pci_space[t+19]=0};dt.prototype.get_state=function(){let e=[];return e[0]=this.device_feature_select,e[1]=this.driver_feature_select,e[2]=this.device_feature,e[3]=this.driver_feature,e[4]=this.features_ok,e[5]=this.device_status,e[6]=this.config_has_changed,e[7]=this.config_generation,e[8]=this.isr_status,e[9]=this.queue_select,e=e.concat(this.queues)};dt.prototype.set_state=function(e){this.device_feature_select=e[0],this.driver_feature_select=e[1],this.device_feature=e[2],this.driver_feature=e[3],this.features_ok=e[4],this.device_status=e[5],this.config_has_changed=e[6],this.config_generation=e[7],this.isr_status=e[8],this.queue_select=e[9];let t=0;for(const i of e.slice(10))this.queues[t].set_state(i),t++;this.queue_selected=this.queues[this.queue_select]||null};dt.prototype.reset=function(){this.driver_feature_select=this.device_feature_select=0,this.driver_feature.set(this.device_feature),this.features_ok=!0,this.queue_select=this.device_status=0,this.queue_selected=this.queues[0];for(const e of this.queues)e.reset();this.config_has_changed=!1,this.config_generation=0,this.lower_irq()};dt.prototype.notify_config_changes=function(){this.config_has_changed=!0,this.device_status&4&&this.raise_irq(2)};dt.prototype.update_config_generation=function(){this.config_has_changed&&(this.config_generation++,this.config_generation&=255,this.config_has_changed=!1)};dt.prototype.is_feature_negotiated=function(e){return 0<(this.driver_feature[e>>>5]&1<<(e&31))};dt.prototype.needs_reset=function(){this.device_status|=64,this.device_status&4&&this.notify_config_changes()};dt.prototype.raise_irq=function(e){A(e),this.isr_status|=e,this.pci.raise_irq(this.pci_id)};dt.prototype.lower_irq=function(){this.isr_status=0,this.pci.lower_irq(this.pci_id)};function Qe(e,t,i){this.cpu=e,this.virtio=t,this.size_supported=this.size=i.size_supported,this.mask=this.size-1,this.enabled=!1,this.notify_offset=i.notify_offset,this.num_staged_replies=this.used_addr=this.avail_last_idx=this.avail_addr=this.desc_addr=0,this.reset()}Qe.prototype.get_state=function(){const e=[];return e[0]=this.size,e[1]=this.size_supported,e[2]=this.enabled,e[3]=this.notify_offset,e[4]=this.desc_addr,e[5]=this.avail_addr,e[6]=this.avail_last_idx,e[7]=this.used_addr,e[8]=this.num_staged_replies,e[9]=1,e};Qe.prototype.set_state=function(e){this.size=e[0],this.size_supported=e[1],this.enabled=e[2],this.notify_offset=e[3],this.desc_addr=e[4],this.avail_addr=e[5],this.avail_last_idx=e[6],this.used_addr=e[7],this.num_staged_replies=e[8],this.mask=this.size-1,this.fix_wrapping=e[9]!==1};Qe.prototype.reset=function(){this.enabled=!1,this.num_staged_replies=this.used_addr=this.avail_last_idx=this.avail_addr=this.desc_addr=0,this.set_size(this.size_supported)};Qe.prototype.is_configured=function(){return this.desc_addr&&this.avail_addr&&this.used_addr};Qe.prototype.enable=function(){this.is_configured(),this.enabled=!0};Qe.prototype.set_size=function(e){this.size=e,this.mask=e-1};Qe.prototype.count_requests=function(){return this.fix_wrapping&&(this.fix_wrapping=!1,this.avail_last_idx=(this.avail_get_idx()&~this.mask)+(this.avail_last_idx&this.mask)),this.avail_get_idx()-this.avail_last_idx&65535};Qe.prototype.has_request=function(){return this.count_requests()!==0};Qe.prototype.pop_request=function(){this.has_request();var e=this.avail_get_entry(this.avail_last_idx);return e=new Xn(this,e),this.avail_last_idx=this.avail_last_idx+1&65535,e};Qe.prototype.push_reply=function(e){const t=this.used_get_idx()+this.num_staged_replies&this.mask;this.used_set_entry(t,e.head_idx,e.length_written),this.num_staged_replies++};Qe.prototype.flush_replies=function(){if(this.num_staged_replies!==0){var e=this.used_get_idx()+this.num_staged_replies&65535;this.used_set_idx(e),this.num_staged_replies=0,this.virtio.is_feature_negotiated(29)?(this.avail_get_used_event(),this.virtio.raise_irq(1)):~this.avail_get_flags()&1&&this.virtio.raise_irq(1)}};Qe.prototype.notify_me_after=function(e){e=this.avail_get_idx()+e&65535,this.used_set_avail_event(e)};Qe.prototype.get_descriptor=function(e,t){return{addr_low:this.cpu.read32s(e+16*t),addr_high:this.cpu.read32s(e+16*t+4),len:this.cpu.read32s(e+16*t+8),flags:this.cpu.read16(e+16*t+12),next:this.cpu.read16(e+16*t+14)}};Qe.prototype.avail_get_flags=function(){return this.cpu.read16(this.avail_addr)};Qe.prototype.avail_get_idx=function(){return this.cpu.read16(this.avail_addr+2)};Qe.prototype.avail_get_entry=function(e){return this.cpu.read16(this.avail_addr+4+2*(e&this.mask))};Qe.prototype.avail_get_used_event=function(){return this.cpu.read16(this.avail_addr+4+2*this.size)};Qe.prototype.used_get_flags=function(){return this.cpu.read16(this.used_addr)};Qe.prototype.used_set_flags=function(e){this.cpu.write16(this.used_addr,e)};Qe.prototype.used_get_idx=function(){return this.cpu.read16(this.used_addr+2)};Qe.prototype.used_set_idx=function(e){this.cpu.write16(this.used_addr+2,e)};Qe.prototype.used_set_entry=function(e,t,i){this.cpu.write32(this.used_addr+4+8*e,t),this.cpu.write32(this.used_addr+8+8*e,i)};Qe.prototype.used_set_avail_event=function(e){this.cpu.write16(this.used_addr+4+8*this.size,e)};function Xn(e,t){this.cpu=e.cpu,this.virtio=e.virtio,this.head_idx=t,this.read_buffers=[],this.length_readable=this.read_buffer_offset=this.read_buffer_idx=0,this.write_buffers=[],this.length_writable=this.length_written=this.write_buffer_offset=this.write_buffer_idx=0;let i=e.desc_addr,s=0,n=e.size,a=!1;const c=this.virtio.is_feature_negotiated(28);do{const r=e.get_descriptor(i,t);if(A(r.addr_high,8),A(r.addr_low,8),A(r.len,8),A(r.flags,4),A(r.next,4),c&&r.flags&4)i=r.addr_low,s=t=0,n=r.len/16;else{if(r.flags&2)a=!0,this.write_buffers.push(r),this.length_writable+=r.len;else{if(a)break;this.read_buffers.push(r),this.length_readable+=r.len}if(s++,s>n)break;if(r.flags&1)t=r.next;else break}}while(!0)}Xn.prototype.get_next_blob=function(e){let t=0,i=e.length;for(;i&&this.read_buffer_idx!==this.read_buffers.length;){var s=this.read_buffers[this.read_buffer_idx];const n=s.addr_low+this.read_buffer_offset;s=s.len-this.read_buffer_offset,s>i?(s=i,this.read_buffer_offset+=i):(this.read_buffer_idx++,this.read_buffer_offset=0),e.set(this.cpu.read_blob(n,s),t),t+=s,i-=s}return t};Xn.prototype.set_next_blob=function(e){let t=0,i=e.length;for(;i&&this.write_buffer_idx!==this.write_buffers.length;){var s=this.write_buffers[this.write_buffer_idx];const n=s.addr_low+this.write_buffer_offset;s=s.len-this.write_buffer_offset,s>i?(s=i,this.write_buffer_offset+=i):(this.write_buffer_idx++,this.write_buffer_offset=0),this.cpu.write_blob(e.subarray(t,t+s),n),t+=s,i-=s}return this.length_written+=t,t};function Yn(e,t,i,s){const n=new dt(e,{name:"virtio-9p",pci_id:48,device_id:4169,subsystem_device_id:9,common:{initial_port:43008,queues:[{size_supported:32,notify_offset:0}],features:[0,32,29,28],on_driver_ok:()=>{}},notification:{initial_port:43264,single_handler:!1,handlers:[a=>{if(a===0){for(a=n.queues[0];a.has_request();){const c=a.pop_request();s(c)}a.notify_me_after(0)}}]},isr_status:{initial_port:42752},device_specific:{initial_port:42496,struct:[{bytes:2,name:"mount tag length",read:()=>t,write:()=>{}}].concat(Array.from(Array(254).keys()).map(a=>({bytes:1,name:"mount tag name "+a,read:()=>i[a]||0,write:()=>{}})))}});return n}function ni(e,t,i){this.fs=e,this.bus=i,this.configspace_tagname=[104,111,115,116,57,112],this.configspace_taglen=this.configspace_tagname.length,this.virtio=Yn(t,this.configspace_taglen,this.configspace_tagname,this.ReceiveRequest.bind(this)),this.virtqueue=this.virtio.queues[0],this.VERSION="9P2000.L",this.msize=this.BLOCKSIZE=8192,this.replybuffer=new Uint8Array(2*this.msize),this.replybuffersize=0,this.fids=[]}ni.prototype.get_state=function(){var e=[];return e[0]=this.configspace_tagname,e[1]=this.configspace_taglen,e[2]=this.virtio,e[3]=this.VERSION,e[4]=this.BLOCKSIZE,e[5]=this.msize,e[6]=this.replybuffer,e[7]=this.replybuffersize,e[8]=this.fids.map(function(t){return[t.inodeid,t.type,t.uid,t.dbg_name]}),e[9]=this.fs,e};ni.prototype.set_state=function(e){this.configspace_tagname=e[0],this.configspace_taglen=e[1],this.virtio.set_state(e[2]),this.virtqueue=this.virtio.queues[0],this.VERSION=e[3],this.BLOCKSIZE=e[4],this.msize=e[5],this.replybuffer=e[6],this.replybuffersize=e[7],this.fids=e[8].map(function(t){return{inodeid:t[0],type:t[1],uid:t[2],dbg_name:t[3]}}),this.fs.set_state(e[9])};ni.prototype.Createfid=function(e,t,i,s){return{inodeid:e,type:t,uid:i,dbg_name:s}};ni.prototype.update_dbg_name=function(e,t){for(const i of this.fids)i.inodeid===e&&(i.dbg_name=t)};ni.prototype.reset=function(){this.fids=[],this.virtio.reset()};ni.prototype.BuildReply=function(e,t,i){Ge(["w","b","h"],[i+7,e+1,t],this.replybuffer,0),this.replybuffersize=i+7};ni.prototype.SendError=function(e,t,i){t=Ge(["w"],[i],this.replybuffer,7),this.BuildReply(6,e,t)};ni.prototype.SendReply=function(e){e.set_next_blob(this.replybuffer.subarray(0,this.replybuffersize)),this.virtqueue.push_reply(e),this.virtqueue.flush_replies()};ni.prototype.ReceiveRequest=async function(e){var t=new Uint8Array(e.length_readable);e.get_next_blob(t);var i={offset:0},s=Le(["w","b","h"],t,i),n=s[1];switch(s=s[2],n){case 8:var a=this.fs.GetTotalSize(),c=this.fs.GetSpace(),r=[16914839];r[1]=this.BLOCKSIZE,r[2]=Math.floor(c/r[1]),r[3]=r[2]-Math.floor(a/r[1]),r[4]=r[2]-Math.floor(a/r[1]),r[5]=this.fs.CountUsedInodes(),r[6]=this.fs.CountFreeInodes(),r[7]=0,r[8]=256,a=Ge("wwddddddw".split(""),r,this.replybuffer,7),this.BuildReply(n,s,a),this.SendReply(e);break;case 112:case 12:r=Le(["w","w"],t,i),a=r[0];var o=r[1];t=this.fids[a].inodeid,i=this.fs.GetInode(t),await this.fs.OpenInode(t,o),r=[],r[0]=i.qid,r[1]=this.msize-24,Ge(["Q","w"],r,this.replybuffer,7),this.BuildReply(n,s,17),this.SendReply(e);break;case 70:if(r=Le(["w","w","s"],t,i),t=r[0],a=r[1],c=r[2],a=this.fs.Link(this.fids[t].inodeid,this.fids[a].inodeid,c),0>a){this.SendError(s,a===-1?"Operation not permitted":"Unknown error: "+-a,-a),this.SendReply(e);break}this.BuildReply(n,s,0),this.SendReply(e);break;case 16:r=Le(["w","s","s","w"],t,i),a=r[0],c=r[1];var u=r[3];t=this.fs.CreateSymlink(c,this.fids[a].inodeid,r[2]),i=this.fs.GetInode(t),i.uid=this.fids[a].uid,i.gid=u,Ge(["Q"],[i.qid],this.replybuffer,7),this.BuildReply(n,s,13),this.SendReply(e);break;case 18:r=Le("wswwww".split(""),t,i),a=r[0],c=r[1],o=r[2],t=r[3],i=r[4],u=r[5],t=this.fs.CreateNode(c,this.fids[a].inodeid,t,i),i=this.fs.GetInode(t),i.mode=o,i.uid=this.fids[a].uid,i.gid=u,Ge(["Q"],[i.qid],this.replybuffer,7),this.BuildReply(n,s,13),this.SendReply(e);break;case 22:r=Le(["w"],t,i),a=r[0],i=this.fs.GetInode(this.fids[a].inodeid),a=Ge(["s"],[i.symlink],this.replybuffer,7),this.BuildReply(n,s,a),this.SendReply(e);break;case 72:r=Le(["w","s","w","w"],t,i),a=r[0],c=r[1],o=r[2],u=r[3],t=this.fs.CreateDirectory(c,this.fids[a].inodeid),i=this.fs.GetInode(t),i.mode=o|16384,i.uid=this.fids[a].uid,i.gid=u,Ge(["Q"],[i.qid],this.replybuffer,7),this.BuildReply(n,s,13),this.SendReply(e);break;case 14:r=Le(["w","s","w","w","w"],t,i),a=r[0],c=r[1],o=r[3],u=r[4],this.bus.send("9p-create",[c,this.fids[a].inodeid]),t=this.fs.CreateFile(c,this.fids[a].inodeid),this.fids[a].inodeid=t,this.fids[a].type=1,this.fids[a].dbg_name=c,i=this.fs.GetInode(t),i.uid=this.fids[a].uid,i.gid=u,i.mode=o|32768,Ge(["Q","w"],[i.qid,this.msize-24],this.replybuffer,7),this.BuildReply(n,s,17),this.SendReply(e);break;case 52:r=Le("wbwddws".split(""),t,i),a=r[0],c=r[2],t=r[4]===0?1/0:r[4],r=this.fs.DescribeLock(r[1],r[3],t,r[5],r[6]),a=this.fs.Lock(this.fids[a].inodeid,r,c),Ge(["b"],[a],this.replybuffer,7),this.BuildReply(n,s,1),this.SendReply(e);break;case 54:r=Le("wbddws".split(""),t,i),a=r[0],t=r[3]===0?1/0:r[3],r=this.fs.DescribeLock(r[1],r[2],t,r[4],r[5]),a=this.fs.GetLock(this.fids[a].inodeid,r),a||(a=r,a.type=2),a=Ge(["b","d","d","w","s"],[a.type,a.start,a.length===1/0?0:a.length,a.proc_id,a.client_id],this.replybuffer,7),this.BuildReply(n,s,a),this.SendReply(e);break;case 24:if(r=Le(["w","d"],t,i),a=r[0],i=this.fs.GetInode(this.fids[a].inodeid),!i||i.status===4){this.SendError(s,"No such file or directory",2),this.SendReply(e);break}r[0]=r[1],r[1]=i.qid,r[2]=i.mode,r[3]=i.uid,r[4]=i.gid,r[5]=i.nlinks,r[6]=i.major<<8|i.minor,r[7]=i.size,r[8]=this.BLOCKSIZE,r[9]=Math.floor(i.size/512+1),r[10]=i.atime,r[11]=0,r[12]=i.mtime,r[13]=0,r[14]=i.ctime,r[15]=0,r[16]=0,r[17]=0,r[18]=0,r[19]=0,Ge("dQwwwddddddddddddddd".split(""),r,this.replybuffer,7),this.BuildReply(n,s,153),this.SendReply(e);break;case 26:r=Le("wwwwwddddd".split(""),t,i),a=r[0],i=this.fs.GetInode(this.fids[a].inodeid),r[1]&1&&(i.mode=r[2]),r[1]&2&&(i.uid=r[3]),r[1]&4&&(i.gid=r[4]),r[1]&16&&(i.atime=Math.floor(new Date().getTime()/1e3)),r[1]&32&&(i.mtime=Math.floor(new Date().getTime()/1e3)),r[1]&64&&(i.ctime=Math.floor(new Date().getTime()/1e3)),r[1]&128&&(i.atime=r[6]),r[1]&256&&(i.mtime=r[8]),r[1]&8&&await this.fs.ChangeSize(this.fids[a].inodeid,r[5]),this.BuildReply(n,s,0),this.SendReply(e);break;case 50:Le(["w","d"],t,i),this.BuildReply(n,s,0),this.SendReply(e);break;case 40:case 116:if(r=Le(["w","d","w"],t,i),a=r[0],c=r[1],o=r[2],i=this.fs.GetInode(this.fids[a].inodeid),!i||i.status===4){this.SendError(s,"No such file or directory",2),this.SendReply(e);break}if(this.fids[a].type===2)for(i.caps.length<c+o&&(o=i.caps.length-c),r=0;r<o;r++)this.replybuffer[11+r]=i.caps[c+r];else await this.fs.OpenInode(this.fids[a].inodeid,void 0),r=this.fids[a].inodeid,o=Math.min(o,this.replybuffer.length-11),i.size<c+o?o=i.size-c:n===40&&(o=this.fs.RoundToDirentry(r,c+o)-c),c>i.size&&(o=0),this.bus.send("9p-read-start",[this.fids[a].dbg_name]),r=await this.fs.Read(r,c,o),this.bus.send("9p-read-end",[this.fids[a].dbg_name,o]),r&&this.replybuffer.set(r,11);Ge(["w"],[o],this.replybuffer,7),this.BuildReply(n,s,4+o),this.SendReply(e);break;case 118:if(r=Le(["w","d","w"],t,i),a=r[0],c=r[1],o=r[2],r=this.fids[a].dbg_name,this.fids[a].type===2){this.SendError(s,"Setxattr not supported",95),this.SendReply(e);break}else await this.fs.Write(this.fids[a].inodeid,c,o,t.subarray(i.offset));this.bus.send("9p-write-end",[r,o]),Ge(["w"],[o],this.replybuffer,7),this.BuildReply(n,s,4),this.SendReply(e);break;case 74:if(r=Le(["w","s","w","s"],t,i),a=await this.fs.Rename(this.fids[r[0]].inodeid,r[1],this.fids[r[2]].inodeid,r[3]),0>a){this.SendError(s,a===-2?"No such file or directory":a===-1?"Operation not permitted":a===-39?"Directory not empty":"Unknown error: "+-a,-a),this.SendReply(e);break}this.BuildReply(n,s,0),this.SendReply(e);break;case 76:if(r=Le(["w","s","w"],t,i),t=r[0],c=r[1],a=this.fs.Search(this.fids[t].inodeid,c),a===-1){this.SendError(s,"No such file or directory",2),this.SendReply(e);break}if(a=this.fs.Unlink(this.fids[t].inodeid,c),0>a){this.SendError(s,a===-39?"Directory not empty":a===-1?"Operation not permitted":"Unknown error: "+-a,-a),this.SendReply(e);break}this.BuildReply(n,s,0),this.SendReply(e);break;case 100:a=Le(["w","s"],t,i),this.msize!==a[0]&&(this.msize=a[0],this.replybuffer=new Uint8Array(Math.min(16777216,2*this.msize))),a=Ge(["w","s"],[this.msize,this.VERSION],this.replybuffer,7),this.BuildReply(n,s,a),this.SendReply(e);break;case 104:r=Le(["w","w","s","s","w"],t,i),a=r[0],c=r[4],A(r[1]),this.fids[a]=this.Createfid(0,1,c,""),i=this.fs.GetInode(this.fids[a].inodeid),Ge(["Q"],[i.qid],this.replybuffer,7),this.BuildReply(n,s,13),this.SendReply(e),this.bus.send("9p-attach");break;case 108:Le(["h"],t,i),this.BuildReply(n,s,0),this.SendReply(e);break;case 110:if(r=Le(["w","w","h"],t,i),a=r[0],o=r[1],u=r[2],u===0){this.fids[o]=this.Createfid(this.fids[a].inodeid,1,this.fids[a].uid,this.fids[a].dbg_name),Ge(["h"],[0],this.replybuffer,7),this.BuildReply(n,s,2),this.SendReply(e);break}for(c=[],r=0;r<u;r++)c.push("s");i=Le(c,t,i),t=this.fids[a].inodeid,c=9;var f=0;for(r=0;r<u&&(t=this.fs.Search(t,i[r]),t!==-1);r++)c+=Ge(["Q"],[this.fs.GetInode(t).qid],this.replybuffer,c),f++,this.fids[o]=this.Createfid(t,1,this.fids[a].uid,i[r]);Ge(["h"],[f],this.replybuffer,7),this.BuildReply(n,s,c-7),this.SendReply(e);break;case 120:r=Le(["w"],t,i),this.fids[r[0]]&&0<=this.fids[r[0]].inodeid&&(await this.fs.CloseInode(this.fids[r[0]].inodeid),this.fids[r[0]].inodeid=-1,this.fids[r[0]].type=-1),this.BuildReply(n,s,0),this.SendReply(e);break;case 32:r=Le(["w","s","d","w"],t,i),a=r[0],this.fids[a].type=2,this.BuildReply(n,s,0),this.SendReply(e);break;case 30:Le(["w","w","s"],t,i),this.SendError(s,"Setxattr not supported",95),this.SendReply(e)}};function wr(e,t){this.handle_fn=e,this.tag_bufchain=new Map,this.configspace_tagname=[104,111,115,116,57,112],this.configspace_taglen=this.configspace_tagname.length,this.virtio=Yn(t,this.configspace_taglen,this.configspace_tagname,async i=>{const s=new Uint8Array(i.length_readable);i.get_next_blob(s);var n=Le(["w","b","h"],s,{offset:0})[2];this.tag_bufchain.set(n,i),this.handle_fn(s,a=>{var c=Le(["w","b","h"],a,{offset:0})[2];const r=this.tag_bufchain.get(c);r?(r.set_next_blob(a),this.virtqueue.push_reply(r),this.virtqueue.flush_replies(),this.tag_bufchain.delete(c)):console.error("No bufchain found for tag: "+c)})}),this.virtqueue=this.virtio.queues[0]}wr.prototype.get_state=function(){var e=[];return e[0]=this.configspace_tagname,e[1]=this.configspace_taglen,e[2]=this.virtio,e[3]=this.tag_bufchain,e};wr.prototype.set_state=function(e){this.configspace_tagname=e[0],this.configspace_taglen=e[1],this.virtio.set_state(e[2]),this.virtqueue=this.virtio.queues[0],this.tag_bufchain=e[3]};wr.prototype.reset=function(){this.virtio.reset()};function Bt(e,t){this.socket=void 0,this.cpu=t,this.send_queue=[],this.url=e,this.reconnect_interval=1e4,this.last_connect_attempt=Date.now()-this.reconnect_interval,this.send_queue_limit=64,this.destroyed=!1,this.tag_bufchain=new Map,this.configspace_tagname=[104,111,115,116,57,112],this.configspace_taglen=this.configspace_tagname.length,this.virtio=Yn(t,this.configspace_taglen,this.configspace_tagname,async i=>{const s=new Uint8Array(i.length_readable);i.get_next_blob(s);const n=Le(["w","b","h"],s,{offset:0})[2];this.tag_bufchain.set(n,i),this.send(s)}),this.virtqueue=this.virtio.queues[0]}Bt.prototype.get_state=function(){var e=[];return e[0]=this.configspace_tagname,e[1]=this.configspace_taglen,e[2]=this.virtio,e[3]=this.tag_bufchain,e};Bt.prototype.set_state=function(e){this.configspace_tagname=e[0],this.configspace_taglen=e[1],this.virtio.set_state(e[2]),this.virtqueue=this.virtio.queues[0],this.tag_bufchain=e[3]};Bt.prototype.reset=function(){this.virtio.reset()};Bt.prototype.handle_message=function(e){e=new Uint8Array(e.data);const t=Le(["w","b","h"],e,{offset:0})[2],i=this.tag_bufchain.get(t);i?(i.set_next_blob(e),this.virtqueue.push_reply(i),this.virtqueue.flush_replies(),this.tag_bufchain.delete(t)):console.error("Virtio9pProxy: No bufchain found for tag: "+t)};Bt.prototype.handle_close=function(){this.destroyed||(this.connect(),setTimeout(this.connect.bind(this),this.reconnect_interval))};Bt.prototype.handle_open=function(){for(var e=0;e<this.send_queue.length;e++)this.send(this.send_queue[e]);this.send_queue=[]};Bt.prototype.handle_error=function(){};Bt.prototype.destroy=function(){this.destroyed=!0,this.socket&&this.socket.close()};Bt.prototype.connect=function(){if(typeof WebSocket<"u"){if(this.socket){var e=this.socket.readyState;if(e===0||e===1)return}if(e=Date.now(),!(this.last_connect_attempt+this.reconnect_interval>e)){this.last_connect_attempt=Date.now();try{this.socket=new WebSocket(this.url)}catch(t){console.error(t);return}this.socket.binaryType="arraybuffer",this.socket.onopen=this.handle_open.bind(this),this.socket.onmessage=this.handle_message.bind(this),this.socket.onclose=this.handle_close.bind(this),this.socket.onerror=this.handle_error.bind(this)}}};Bt.prototype.send=function(e){this.socket&&this.socket.readyState===1?this.socket.send(e):(this.send_queue.push(e),this.send_queue.length>2*this.send_queue_limit&&(this.send_queue=this.send_queue.slice(-this.send_queue_limit)),this.connect())};Bt.prototype.change_proxy=function(e){this.url=e,this.socket&&(this.socket.onclose=function(){},this.socket.onerror=function(){},this.socket.close(),this.socket=void 0)};let{V86:dm}=er.exports;const fm=1,pm="/root/tutorial",ga=1,mm=2,vn="serial0-input",Ss="serial0-output-byte",gm="serial1-output-byte",vm="/dev/ttyS2",va="serial2-output-byte";function Xs(e){throw new Error('Could not dynamically require "'+e+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var sn={exports:{}};var ya;function ym(){return ya||(ya=1,(function(e,t){(function(i){e.exports=i()})(function(){return(function i(s,n,a){function c(u,f){if(!n[u]){if(!s[u]){var l=typeof Xs=="function"&&Xs;if(!f&&l)return l(u,!0);if(r)return r(u,!0);var m=new Error("Cannot find module '"+u+"'");throw m.code="MODULE_NOT_FOUND",m}var g=n[u]={exports:{}};s[u][0].call(g.exports,function(C){var v=s[u][1][C];return c(v||C)},g,g.exports,i,s,n,a)}return n[u].exports}for(var r=typeof Xs=="function"&&Xs,o=0;o<a.length;o++)c(a[o]);return c})({1:[function(i,s,n){(function(a){var c=a.MutationObserver||a.WebKitMutationObserver,r;if(c){var o=0,u=new c(C),f=a.document.createTextNode("");u.observe(f,{characterData:!0}),r=function(){f.data=o=++o%2}}else if(!a.setImmediate&&typeof a.MessageChannel<"u"){var l=new a.MessageChannel;l.port1.onmessage=C,r=function(){l.port2.postMessage(0)}}else"document"in a&&"onreadystatechange"in a.document.createElement("script")?r=function(){var h=a.document.createElement("script");h.onreadystatechange=function(){C(),h.onreadystatechange=null,h.parentNode.removeChild(h),h=null},a.document.documentElement.appendChild(h)}:r=function(){setTimeout(C,0)};var m,g=[];function C(){m=!0;for(var h,p,_=g.length;_;){for(p=g,g=[],h=-1;++h<_;)p[h]();_=g.length}m=!1}s.exports=v;function v(h){g.push(h)===1&&!m&&r()}}).call(this,typeof Vs<"u"?Vs:typeof self<"u"?self:typeof window<"u"?window:{})},{}],2:[function(i,s,n){var a=i(1);function c(){}var r={},o=["REJECTED"],u=["FULFILLED"],f=["PENDING"];s.exports=l;function l(S){if(typeof S!="function")throw new TypeError("resolver must be a function");this.state=f,this.queue=[],this.outcome=void 0,S!==c&&v(this,S)}l.prototype.catch=function(S){return this.then(null,S)},l.prototype.then=function(S,w){if(typeof S!="function"&&this.state===u||typeof w!="function"&&this.state===o)return this;var E=new this.constructor(c);if(this.state!==f){var b=this.state===u?S:w;g(E,b,this.outcome)}else this.queue.push(new m(E,S,w));return E};function m(S,w,E){this.promise=S,typeof w=="function"&&(this.onFulfilled=w,this.callFulfilled=this.otherCallFulfilled),typeof E=="function"&&(this.onRejected=E,this.callRejected=this.otherCallRejected)}m.prototype.callFulfilled=function(S){r.resolve(this.promise,S)},m.prototype.otherCallFulfilled=function(S){g(this.promise,this.onFulfilled,S)},m.prototype.callRejected=function(S){r.reject(this.promise,S)},m.prototype.otherCallRejected=function(S){g(this.promise,this.onRejected,S)};function g(S,w,E){a(function(){var b;try{b=w(E)}catch(k){return r.reject(S,k)}b===S?r.reject(S,new TypeError("Cannot resolve promise with itself")):r.resolve(S,b)})}r.resolve=function(S,w){var E=h(C,w);if(E.status==="error")return r.reject(S,E.value);var b=E.value;if(b)v(S,b);else{S.state=u,S.outcome=w;for(var k=-1,R=S.queue.length;++k<R;)S.queue[k].callFulfilled(w)}return S},r.reject=function(S,w){S.state=o,S.outcome=w;for(var E=-1,b=S.queue.length;++E<b;)S.queue[E].callRejected(w);return S};function C(S){var w=S&&S.then;if(S&&(typeof S=="object"||typeof S=="function")&&typeof w=="function")return function(){w.apply(S,arguments)}}function v(S,w){var E=!1;function b(P){E||(E=!0,r.reject(S,P))}function k(P){E||(E=!0,r.resolve(S,P))}function R(){w(k,b)}var O=h(R);O.status==="error"&&b(O.value)}function h(S,w){var E={};try{E.value=S(w),E.status="success"}catch(b){E.status="error",E.value=b}return E}l.resolve=p;function p(S){return S instanceof this?S:r.resolve(new this(c),S)}l.reject=_;function _(S){var w=new this(c);return r.reject(w,S)}l.all=d;function d(S){var w=this;if(Object.prototype.toString.call(S)!=="[object Array]")return this.reject(new TypeError("must be an array"));var E=S.length,b=!1;if(!E)return this.resolve([]);for(var k=new Array(E),R=0,O=-1,P=new this(c);++O<E;)L(S[O],O);return P;function L(q,J){w.resolve(q).then(re,function(ie){b||(b=!0,r.reject(P,ie))});function re(ie){k[J]=ie,++R===E&&!b&&(b=!0,r.resolve(P,k))}}}l.race=y;function y(S){var w=this;if(Object.prototype.toString.call(S)!=="[object Array]")return this.reject(new TypeError("must be an array"));var E=S.length,b=!1;if(!E)return this.resolve([]);for(var k=-1,R=new this(c);++k<E;)O(S[k]);return R;function O(P){w.resolve(P).then(function(L){b||(b=!0,r.resolve(R,L))},function(L){b||(b=!0,r.reject(R,L))})}}},{1:1}],3:[function(i,s,n){(function(a){typeof a.Promise!="function"&&(a.Promise=i(2))}).call(this,typeof Vs<"u"?Vs:typeof self<"u"?self:typeof window<"u"?window:{})},{2:2}],4:[function(i,s,n){var a=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(D){return typeof D}:function(D){return D&&typeof Symbol=="function"&&D.constructor===Symbol&&D!==Symbol.prototype?"symbol":typeof D};function c(D,F){if(!(D instanceof F))throw new TypeError("Cannot call a class as a function")}function r(){try{if(typeof indexedDB<"u")return indexedDB;if(typeof webkitIndexedDB<"u")return webkitIndexedDB;if(typeof mozIndexedDB<"u")return mozIndexedDB;if(typeof OIndexedDB<"u")return OIndexedDB;if(typeof msIndexedDB<"u")return msIndexedDB}catch{return}}var o=r();function u(){try{if(!o||!o.open)return!1;var D=typeof openDatabase<"u"&&/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform),F=typeof fetch=="function"&&fetch.toString().indexOf("[native code")!==-1;return(!D||F)&&typeof indexedDB<"u"&&typeof IDBKeyRange<"u"}catch{return!1}}function f(D,F){D=D||[],F=F||{};try{return new Blob(D,F)}catch(W){if(W.name!=="TypeError")throw W;for(var I=typeof BlobBuilder<"u"?BlobBuilder:typeof MSBlobBuilder<"u"?MSBlobBuilder:typeof MozBlobBuilder<"u"?MozBlobBuilder:WebKitBlobBuilder,$=new I,V=0;V<D.length;V+=1)$.append(D[V]);return $.getBlob(F.type)}}typeof Promise>"u"&&i(3);var l=Promise;function m(D,F){F&&D.then(function(I){F(null,I)},function(I){F(I)})}function g(D,F,I){typeof F=="function"&&D.then(F),typeof I=="function"&&D.catch(I)}function C(D){return typeof D!="string"&&(console.warn(D+" used as a key, but it is not a string."),D=String(D)),D}function v(){if(arguments.length&&typeof arguments[arguments.length-1]=="function")return arguments[arguments.length-1]}var h="local-forage-detect-blob-support",p=void 0,_={},d=Object.prototype.toString,y="readonly",S="readwrite";function w(D){for(var F=D.length,I=new ArrayBuffer(F),$=new Uint8Array(I),V=0;V<F;V++)$[V]=D.charCodeAt(V);return I}function E(D){return new l(function(F){var I=D.transaction(h,S),$=f([""]);I.objectStore(h).put($,"key"),I.onabort=function(V){V.preventDefault(),V.stopPropagation(),F(!1)},I.oncomplete=function(){var V=navigator.userAgent.match(/Chrome\/(\d+)/),W=navigator.userAgent.match(/Edge\//);F(W||!V||parseInt(V[1],10)>=43)}}).catch(function(){return!1})}function b(D){return typeof p=="boolean"?l.resolve(p):E(D).then(function(F){return p=F,p})}function k(D){var F=_[D.name],I={};I.promise=new l(function($,V){I.resolve=$,I.reject=V}),F.deferredOperations.push(I),F.dbReady?F.dbReady=F.dbReady.then(function(){return I.promise}):F.dbReady=I.promise}function R(D){var F=_[D.name],I=F.deferredOperations.pop();if(I)return I.resolve(),I.promise}function O(D,F){var I=_[D.name],$=I.deferredOperations.pop();if($)return $.reject(F),$.promise}function P(D,F){return new l(function(I,$){if(_[D.name]=_[D.name]||z(),D.db)if(F)k(D),D.db.close();else return I(D.db);var V=[D.name];F&&V.push(D.version);var W=o.open.apply(o,V);F&&(W.onupgradeneeded=function(te){var ne=W.result;try{ne.createObjectStore(D.storeName),te.oldVersion<=1&&ne.createObjectStore(h)}catch(oe){if(oe.name==="ConstraintError")console.warn('The database "'+D.name+'" has been upgraded from version '+te.oldVersion+" to version "+te.newVersion+', but the storage "'+D.storeName+'" already exists.');else throw oe}}),W.onerror=function(te){te.preventDefault(),$(W.error)},W.onsuccess=function(){var te=W.result;te.onversionchange=function(ne){ne.target.close()},I(te),R(D)}})}function L(D){return P(D,!1)}function q(D){return P(D,!0)}function J(D,F){if(!D.db)return!0;var I=!D.db.objectStoreNames.contains(D.storeName),$=D.version<D.db.version,V=D.version>D.db.version;if($&&(D.version!==F&&console.warn('The database "'+D.name+`" can't be downgraded from version `+D.db.version+" to version "+D.version+"."),D.version=D.db.version),V||I){if(I){var W=D.db.version+1;W>D.version&&(D.version=W)}return!0}return!1}function re(D){return new l(function(F,I){var $=new FileReader;$.onerror=I,$.onloadend=function(V){var W=btoa(V.target.result||"");F({__local_forage_encoded_blob:!0,data:W,type:D.type})},$.readAsBinaryString(D)})}function ie(D){var F=w(atob(D.data));return f([F],{type:D.type})}function ee(D){return D&&D.__local_forage_encoded_blob}function x(D){var F=this,I=F._initReady().then(function(){var $=_[F._dbInfo.name];if($&&$.dbReady)return $.dbReady});return g(I,D,D),I}function B(D){k(D);for(var F=_[D.name],I=F.forages,$=0;$<I.length;$++){var V=I[$];V._dbInfo.db&&(V._dbInfo.db.close(),V._dbInfo.db=null)}return D.db=null,L(D).then(function(W){return D.db=W,J(D)?q(D):W}).then(function(W){D.db=F.db=W;for(var te=0;te<I.length;te++)I[te]._dbInfo.db=W}).catch(function(W){throw O(D,W),W})}function U(D,F,I,$){$===void 0&&($=1);try{var V=D.db.transaction(D.storeName,F);I(null,V)}catch(W){if($>0&&(!D.db||W.name==="InvalidStateError"||W.name==="NotFoundError"))return l.resolve().then(function(){if(!D.db||W.name==="NotFoundError"&&!D.db.objectStoreNames.contains(D.storeName)&&D.version<=D.db.version)return D.db&&(D.version=D.db.version+1),q(D)}).then(function(){return B(D).then(function(){U(D,F,I,$-1)})}).catch(I);I(W)}}function z(){return{forages:[],db:null,dbReady:null,deferredOperations:[]}}function se(D){var F=this,I={db:null};if(D)for(var $ in D)I[$]=D[$];var V=_[I.name];V||(V=z(),_[I.name]=V),V.forages.push(F),F._initReady||(F._initReady=F.ready,F.ready=x);var W=[];function te(){return l.resolve()}for(var ne=0;ne<V.forages.length;ne++){var oe=V.forages[ne];oe!==F&&W.push(oe._initReady().catch(te))}var ce=V.forages.slice(0);return l.all(W).then(function(){return I.db=V.db,L(I)}).then(function(le){return I.db=le,J(I,F._defaultConfig.version)?q(I):le}).then(function(le){I.db=V.db=le,F._dbInfo=I;for(var ge=0;ge<ce.length;ge++){var Te=ce[ge];Te!==F&&(Te._dbInfo.db=I.db,Te._dbInfo.version=I.version)}})}function j(D,F){var I=this;D=C(D);var $=new l(function(V,W){I.ready().then(function(){U(I._dbInfo,y,function(te,ne){if(te)return W(te);try{var oe=ne.objectStore(I._dbInfo.storeName),ce=oe.get(D);ce.onsuccess=function(){var le=ce.result;le===void 0&&(le=null),ee(le)&&(le=ie(le)),V(le)},ce.onerror=function(){W(ce.error)}}catch(le){W(le)}})}).catch(W)});return m($,F),$}function G(D,F){var I=this,$=new l(function(V,W){I.ready().then(function(){U(I._dbInfo,y,function(te,ne){if(te)return W(te);try{var oe=ne.objectStore(I._dbInfo.storeName),ce=oe.openCursor(),le=1;ce.onsuccess=function(){var ge=ce.result;if(ge){var Te=ge.value;ee(Te)&&(Te=ie(Te));var Be=D(Te,ge.key,le++);Be!==void 0?V(Be):ge.continue()}else V()},ce.onerror=function(){W(ce.error)}}catch(ge){W(ge)}})}).catch(W)});return m($,F),$}function Y(D,F,I){var $=this;D=C(D);var V=new l(function(W,te){var ne;$.ready().then(function(){return ne=$._dbInfo,d.call(F)==="[object Blob]"?b(ne.db).then(function(oe){return oe?F:re(F)}):F}).then(function(oe){U($._dbInfo,S,function(ce,le){if(ce)return te(ce);try{var ge=le.objectStore($._dbInfo.storeName);oe===null&&(oe=void 0);var Te=ge.put(oe,D);le.oncomplete=function(){oe===void 0&&(oe=null),W(oe)},le.onabort=le.onerror=function(){var Be=Te.error?Te.error:Te.transaction.error;te(Be)}}catch(Be){te(Be)}})}).catch(te)});return m(V,I),V}function M(D,F){var I=this;D=C(D);var $=new l(function(V,W){I.ready().then(function(){U(I._dbInfo,S,function(te,ne){if(te)return W(te);try{var oe=ne.objectStore(I._dbInfo.storeName),ce=oe.delete(D);ne.oncomplete=function(){V()},ne.onerror=function(){W(ce.error)},ne.onabort=function(){var le=ce.error?ce.error:ce.transaction.error;W(le)}}catch(le){W(le)}})}).catch(W)});return m($,F),$}function T(D){var F=this,I=new l(function($,V){F.ready().then(function(){U(F._dbInfo,S,function(W,te){if(W)return V(W);try{var ne=te.objectStore(F._dbInfo.storeName),oe=ne.clear();te.oncomplete=function(){$()},te.onabort=te.onerror=function(){var ce=oe.error?oe.error:oe.transaction.error;V(ce)}}catch(ce){V(ce)}})}).catch(V)});return m(I,D),I}function K(D){var F=this,I=new l(function($,V){F.ready().then(function(){U(F._dbInfo,y,function(W,te){if(W)return V(W);try{var ne=te.objectStore(F._dbInfo.storeName),oe=ne.count();oe.onsuccess=function(){$(oe.result)},oe.onerror=function(){V(oe.error)}}catch(ce){V(ce)}})}).catch(V)});return m(I,D),I}function H(D,F){var I=this,$=new l(function(V,W){if(D<0){V(null);return}I.ready().then(function(){U(I._dbInfo,y,function(te,ne){if(te)return W(te);try{var oe=ne.objectStore(I._dbInfo.storeName),ce=!1,le=oe.openKeyCursor();le.onsuccess=function(){var ge=le.result;if(!ge){V(null);return}D===0||ce?V(ge.key):(ce=!0,ge.advance(D))},le.onerror=function(){W(le.error)}}catch(ge){W(ge)}})}).catch(W)});return m($,F),$}function X(D){var F=this,I=new l(function($,V){F.ready().then(function(){U(F._dbInfo,y,function(W,te){if(W)return V(W);try{var ne=te.objectStore(F._dbInfo.storeName),oe=ne.openKeyCursor(),ce=[];oe.onsuccess=function(){var le=oe.result;if(!le){$(ce);return}ce.push(le.key),le.continue()},oe.onerror=function(){V(oe.error)}}catch(le){V(le)}})}).catch(V)});return m(I,D),I}function Q(D,F){F=v.apply(this,arguments);var I=this.config();D=typeof D!="function"&&D||{},D.name||(D.name=D.name||I.name,D.storeName=D.storeName||I.storeName);var $=this,V;if(!D.name)V=l.reject("Invalid arguments");else{var W=D.name===I.name&&$._dbInfo.db,te=W?l.resolve($._dbInfo.db):L(D).then(function(ne){var oe=_[D.name],ce=oe.forages;oe.db=ne;for(var le=0;le<ce.length;le++)ce[le]._dbInfo.db=ne;return ne});D.storeName?V=te.then(function(ne){if(ne.objectStoreNames.contains(D.storeName)){var oe=ne.version+1;k(D);var ce=_[D.name],le=ce.forages;ne.close();for(var ge=0;ge<le.length;ge++){var Te=le[ge];Te._dbInfo.db=null,Te._dbInfo.version=oe}var Be=new l(function(Fe,ot){var nt=o.open(D.name,oe);nt.onerror=function(Lt){var cs=nt.result;cs.close(),ot(Lt)},nt.onupgradeneeded=function(){var Lt=nt.result;Lt.deleteObjectStore(D.storeName)},nt.onsuccess=function(){var Lt=nt.result;Lt.close(),Fe(Lt)}});return Be.then(function(Fe){ce.db=Fe;for(var ot=0;ot<le.length;ot++){var nt=le[ot];nt._dbInfo.db=Fe,R(nt._dbInfo)}}).catch(function(Fe){throw(O(D,Fe)||l.resolve()).catch(function(){}),Fe})}}):V=te.then(function(ne){k(D);var oe=_[D.name],ce=oe.forages;ne.close();for(var le=0;le<ce.length;le++){var ge=ce[le];ge._dbInfo.db=null}var Te=new l(function(Be,Fe){var ot=o.deleteDatabase(D.name);ot.onerror=function(){var nt=ot.result;nt&&nt.close(),Fe(ot.error)},ot.onblocked=function(){console.warn('dropInstance blocked for database "'+D.name+'" until all open connections are closed')},ot.onsuccess=function(){var nt=ot.result;nt&&nt.close(),Be(nt)}});return Te.then(function(Be){oe.db=Be;for(var Fe=0;Fe<ce.length;Fe++){var ot=ce[Fe];R(ot._dbInfo)}}).catch(function(Be){throw(O(D,Be)||l.resolve()).catch(function(){}),Be})})}return m(V,F),V}var he={_driver:"asyncStorage",_initStorage:se,_support:u(),iterate:G,getItem:j,setItem:Y,removeItem:M,clear:T,length:K,key:H,keys:X,dropInstance:Q};function me(){return typeof openDatabase=="function"}var fe="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Ae="~~local_forage_type~",ue=/^~~local_forage_type~([^~]+)~/,ve="__lfsc__:",Ie=ve.length,et="arbf",$e="blob",tt="si08",He="ui08",Ut="uic8",ut="si16",Nt="si32",oi="ur16",Et="ui32",je="fl32",rt="fl64",vt=Ie+et.length,De=Object.prototype.toString;function Ui(D){var F=D.length*.75,I=D.length,$,V=0,W,te,ne,oe;D[D.length-1]==="="&&(F--,D[D.length-2]==="="&&F--);var ce=new ArrayBuffer(F),le=new Uint8Array(ce);for($=0;$<I;$+=4)W=fe.indexOf(D[$]),te=fe.indexOf(D[$+1]),ne=fe.indexOf(D[$+2]),oe=fe.indexOf(D[$+3]),le[V++]=W<<2|te>>4,le[V++]=(te&15)<<4|ne>>2,le[V++]=(ne&3)<<6|oe&63;return ce}function mi(D){var F=new Uint8Array(D),I="",$;for($=0;$<F.length;$+=3)I+=fe[F[$]>>2],I+=fe[(F[$]&3)<<4|F[$+1]>>4],I+=fe[(F[$+1]&15)<<2|F[$+2]>>6],I+=fe[F[$+2]&63];return F.length%3===2?I=I.substring(0,I.length-1)+"=":F.length%3===1&&(I=I.substring(0,I.length-2)+"=="),I}function Sr(D,F){var I="";if(D&&(I=De.call(D)),D&&(I==="[object ArrayBuffer]"||D.buffer&&De.call(D.buffer)==="[object ArrayBuffer]")){var $,V=ve;D instanceof ArrayBuffer?($=D,V+=et):($=D.buffer,I==="[object Int8Array]"?V+=tt:I==="[object Uint8Array]"?V+=He:I==="[object Uint8ClampedArray]"?V+=Ut:I==="[object Int16Array]"?V+=ut:I==="[object Uint16Array]"?V+=oi:I==="[object Int32Array]"?V+=Nt:I==="[object Uint32Array]"?V+=Et:I==="[object Float32Array]"?V+=je:I==="[object Float64Array]"?V+=rt:F(new Error("Failed to get type for BinaryArray"))),F(V+mi($))}else if(I==="[object Blob]"){var W=new FileReader;W.onload=function(){var te=Ae+D.type+"~"+mi(this.result);F(ve+$e+te)},W.readAsArrayBuffer(D)}else try{F(JSON.stringify(D))}catch(te){console.error("Couldn't convert value into a JSON string: ",D),F(null,te)}}function os(D){if(D.substring(0,Ie)!==ve)return JSON.parse(D);var F=D.substring(vt),I=D.substring(Ie,vt),$;if(I===$e&&ue.test(F)){var V=F.match(ue);$=V[1],F=F.substring(V[0].length)}var W=Ui(F);switch(I){case et:return W;case $e:return f([W],{type:$});case tt:return new Int8Array(W);case He:return new Uint8Array(W);case Ut:return new Uint8ClampedArray(W);case ut:return new Int16Array(W);case oi:return new Uint16Array(W);case Nt:return new Int32Array(W);case Et:return new Uint32Array(W);case je:return new Float32Array(W);case rt:return new Float64Array(W);default:throw new Error("Unkown type: "+I)}}var as={serialize:Sr,deserialize:os,stringToBuffer:Ui,bufferToString:mi};function Jn(D,F,I,$){D.executeSql("CREATE TABLE IF NOT EXISTS "+F.storeName+" (id INTEGER PRIMARY KEY, key unique, value)",[],I,$)}function Ih(D){var F=this,I={db:null};if(D)for(var $ in D)I[$]=typeof D[$]!="string"?D[$].toString():D[$];var V=new l(function(W,te){try{I.db=openDatabase(I.name,String(I.version),I.description,I.size)}catch(ne){return te(ne)}I.db.transaction(function(ne){Jn(ne,I,function(){F._dbInfo=I,W()},function(oe,ce){te(ce)})},te)});return I.serializer=as,V}function gi(D,F,I,$,V,W){D.executeSql(I,$,V,function(te,ne){ne.code===ne.SYNTAX_ERR?te.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name = ?",[F.storeName],function(oe,ce){ce.rows.length?W(oe,ne):Jn(oe,F,function(){oe.executeSql(I,$,V,W)},W)},W):W(te,ne)},W)}function Ph(D,F){var I=this;D=C(D);var $=new l(function(V,W){I.ready().then(function(){var te=I._dbInfo;te.db.transaction(function(ne){gi(ne,te,"SELECT * FROM "+te.storeName+" WHERE key = ? LIMIT 1",[D],function(oe,ce){var le=ce.rows.length?ce.rows.item(0).value:null;le&&(le=te.serializer.deserialize(le)),V(le)},function(oe,ce){W(ce)})})}).catch(W)});return m($,F),$}function Mh(D,F){var I=this,$=new l(function(V,W){I.ready().then(function(){var te=I._dbInfo;te.db.transaction(function(ne){gi(ne,te,"SELECT * FROM "+te.storeName,[],function(oe,ce){for(var le=ce.rows,ge=le.length,Te=0;Te<ge;Te++){var Be=le.item(Te),Fe=Be.value;if(Fe&&(Fe=te.serializer.deserialize(Fe)),Fe=D(Fe,Be.key,Te+1),Fe!==void 0){V(Fe);return}}V()},function(oe,ce){W(ce)})})}).catch(W)});return m($,F),$}function Zn(D,F,I,$){var V=this;D=C(D);var W=new l(function(te,ne){V.ready().then(function(){F===void 0&&(F=null);var oe=F,ce=V._dbInfo;ce.serializer.serialize(F,function(le,ge){ge?ne(ge):ce.db.transaction(function(Te){gi(Te,ce,"INSERT OR REPLACE INTO "+ce.storeName+" (key, value) VALUES (?, ?)",[D,le],function(){te(oe)},function(Be,Fe){ne(Fe)})},function(Te){if(Te.code===Te.QUOTA_ERR){if($>0){te(Zn.apply(V,[D,oe,I,$-1]));return}ne(Te)}})})}).catch(ne)});return m(W,I),W}function Bh(D,F,I){return Zn.apply(this,[D,F,I,1])}function Uh(D,F){var I=this;D=C(D);var $=new l(function(V,W){I.ready().then(function(){var te=I._dbInfo;te.db.transaction(function(ne){gi(ne,te,"DELETE FROM "+te.storeName+" WHERE key = ?",[D],function(){V()},function(oe,ce){W(ce)})})}).catch(W)});return m($,F),$}function Nh(D){var F=this,I=new l(function($,V){F.ready().then(function(){var W=F._dbInfo;W.db.transaction(function(te){gi(te,W,"DELETE FROM "+W.storeName,[],function(){$()},function(ne,oe){V(oe)})})}).catch(V)});return m(I,D),I}function Fh(D){var F=this,I=new l(function($,V){F.ready().then(function(){var W=F._dbInfo;W.db.transaction(function(te){gi(te,W,"SELECT COUNT(key) as c FROM "+W.storeName,[],function(ne,oe){var ce=oe.rows.item(0).c;$(ce)},function(ne,oe){V(oe)})})}).catch(V)});return m(I,D),I}function zh(D,F){var I=this,$=new l(function(V,W){I.ready().then(function(){var te=I._dbInfo;te.db.transaction(function(ne){gi(ne,te,"SELECT key FROM "+te.storeName+" WHERE id = ? LIMIT 1",[D+1],function(oe,ce){var le=ce.rows.length?ce.rows.item(0).key:null;V(le)},function(oe,ce){W(ce)})})}).catch(W)});return m($,F),$}function Hh(D){var F=this,I=new l(function($,V){F.ready().then(function(){var W=F._dbInfo;W.db.transaction(function(te){gi(te,W,"SELECT key FROM "+W.storeName,[],function(ne,oe){for(var ce=[],le=0;le<oe.rows.length;le++)ce.push(oe.rows.item(le).key);$(ce)},function(ne,oe){V(oe)})})}).catch(V)});return m(I,D),I}function qh(D){return new l(function(F,I){D.transaction(function($){$.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name <> '__WebKitDatabaseInfoTable__'",[],function(V,W){for(var te=[],ne=0;ne<W.rows.length;ne++)te.push(W.rows.item(ne).name);F({db:D,storeNames:te})},function(V,W){I(W)})},function($){I($)})})}function Wh(D,F){F=v.apply(this,arguments);var I=this.config();D=typeof D!="function"&&D||{},D.name||(D.name=D.name||I.name,D.storeName=D.storeName||I.storeName);var $=this,V;return D.name?V=new l(function(W){var te;D.name===I.name?te=$._dbInfo.db:te=openDatabase(D.name,"","",0),D.storeName?W({db:te,storeNames:[D.storeName]}):W(qh(te))}).then(function(W){return new l(function(te,ne){W.db.transaction(function(oe){function ce(Be){return new l(function(Fe,ot){oe.executeSql("DROP TABLE IF EXISTS "+Be,[],function(){Fe()},function(nt,Lt){ot(Lt)})})}for(var le=[],ge=0,Te=W.storeNames.length;ge<Te;ge++)le.push(ce(W.storeNames[ge]));l.all(le).then(function(){te()}).catch(function(Be){ne(Be)})},function(oe){ne(oe)})})}):V=l.reject("Invalid arguments"),m(V,F),V}var $h={_driver:"webSQLStorage",_initStorage:Ih,_support:me(),iterate:Mh,getItem:Ph,setItem:Bh,removeItem:Uh,clear:Nh,length:Fh,key:zh,keys:Hh,dropInstance:Wh};function jh(){try{return typeof localStorage<"u"&&"setItem"in localStorage&&!!localStorage.setItem}catch{return!1}}function Qn(D,F){var I=D.name+"/";return D.storeName!==F.storeName&&(I+=D.storeName+"/"),I}function Vh(){var D="_localforage_support_test";try{return localStorage.setItem(D,!0),localStorage.removeItem(D),!1}catch{return!0}}function Gh(){return!Vh()||localStorage.length>0}function Kh(D){var F=this,I={};if(D)for(var $ in D)I[$]=D[$];return I.keyPrefix=Qn(D,F._defaultConfig),Gh()?(F._dbInfo=I,I.serializer=as,l.resolve()):l.reject()}function Xh(D){var F=this,I=F.ready().then(function(){for(var $=F._dbInfo.keyPrefix,V=localStorage.length-1;V>=0;V--){var W=localStorage.key(V);W.indexOf($)===0&&localStorage.removeItem(W)}});return m(I,D),I}function Yh(D,F){var I=this;D=C(D);var $=I.ready().then(function(){var V=I._dbInfo,W=localStorage.getItem(V.keyPrefix+D);return W&&(W=V.serializer.deserialize(W)),W});return m($,F),$}function Jh(D,F){var I=this,$=I.ready().then(function(){for(var V=I._dbInfo,W=V.keyPrefix,te=W.length,ne=localStorage.length,oe=1,ce=0;ce<ne;ce++){var le=localStorage.key(ce);if(le.indexOf(W)===0){var ge=localStorage.getItem(le);if(ge&&(ge=V.serializer.deserialize(ge)),ge=D(ge,le.substring(te),oe++),ge!==void 0)return ge}}});return m($,F),$}function Zh(D,F){var I=this,$=I.ready().then(function(){var V=I._dbInfo,W;try{W=localStorage.key(D)}catch{W=null}return W&&(W=W.substring(V.keyPrefix.length)),W});return m($,F),$}function Qh(D){var F=this,I=F.ready().then(function(){for(var $=F._dbInfo,V=localStorage.length,W=[],te=0;te<V;te++){var ne=localStorage.key(te);ne.indexOf($.keyPrefix)===0&&W.push(ne.substring($.keyPrefix.length))}return W});return m(I,D),I}function ec(D){var F=this,I=F.keys().then(function($){return $.length});return m(I,D),I}function tc(D,F){var I=this;D=C(D);var $=I.ready().then(function(){var V=I._dbInfo;localStorage.removeItem(V.keyPrefix+D)});return m($,F),$}function ic(D,F,I){var $=this;D=C(D);var V=$.ready().then(function(){F===void 0&&(F=null);var W=F;return new l(function(te,ne){var oe=$._dbInfo;oe.serializer.serialize(F,function(ce,le){if(le)ne(le);else try{localStorage.setItem(oe.keyPrefix+D,ce),te(W)}catch(ge){(ge.name==="QuotaExceededError"||ge.name==="NS_ERROR_DOM_QUOTA_REACHED")&&ne(ge),ne(ge)}})})});return m(V,I),V}function sc(D,F){if(F=v.apply(this,arguments),D=typeof D!="function"&&D||{},!D.name){var I=this.config();D.name=D.name||I.name,D.storeName=D.storeName||I.storeName}var $=this,V;return D.name?V=new l(function(W){D.storeName?W(Qn(D,$._defaultConfig)):W(D.name+"/")}).then(function(W){for(var te=localStorage.length-1;te>=0;te--){var ne=localStorage.key(te);ne.indexOf(W)===0&&localStorage.removeItem(ne)}}):V=l.reject("Invalid arguments"),m(V,F),V}var rc={_driver:"localStorageWrapper",_initStorage:Kh,_support:jh(),iterate:Jh,getItem:Yh,setItem:ic,removeItem:tc,clear:Xh,length:ec,key:Zh,keys:Qh,dropInstance:sc},nc=function(F,I){return F===I||typeof F=="number"&&typeof I=="number"&&isNaN(F)&&isNaN(I)},oc=function(F,I){for(var $=F.length,V=0;V<$;){if(nc(F[V],I))return!0;V++}return!1},eo=Array.isArray||function(D){return Object.prototype.toString.call(D)==="[object Array]"},hs={},to={},Ni={INDEXEDDB:he,WEBSQL:$h,LOCALSTORAGE:rc},ac=[Ni.INDEXEDDB._driver,Ni.WEBSQL._driver,Ni.LOCALSTORAGE._driver],Ns=["dropInstance"],Cr=["clear","getItem","iterate","key","keys","length","removeItem","setItem"].concat(Ns),hc={description:"",driver:ac.slice(),name:"localforage",size:4980736,storeName:"keyvaluepairs",version:1};function cc(D,F){D[F]=function(){var I=arguments;return D.ready().then(function(){return D[F].apply(D,I)})}}function Er(){for(var D=1;D<arguments.length;D++){var F=arguments[D];if(F)for(var I in F)F.hasOwnProperty(I)&&(eo(F[I])?arguments[0][I]=F[I].slice():arguments[0][I]=F[I])}return arguments[0]}var lc=(function(){function D(F){c(this,D);for(var I in Ni)if(Ni.hasOwnProperty(I)){var $=Ni[I],V=$._driver;this[I]=V,hs[V]||this.defineDriver($)}this._defaultConfig=Er({},hc),this._config=Er({},this._defaultConfig,F),this._driverSet=null,this._initDriver=null,this._ready=!1,this._dbInfo=null,this._wrapLibraryMethodsWithReady(),this.setDriver(this._config.driver).catch(function(){})}return D.prototype.config=function(I){if((typeof I>"u"?"undefined":a(I))==="object"){if(this._ready)return new Error("Can't call config() after localforage has been used.");for(var $ in I){if($==="storeName"&&(I[$]=I[$].replace(/\W/g,"_")),$==="version"&&typeof I[$]!="number")return new Error("Database version must be a number.");this._config[$]=I[$]}return"driver"in I&&I.driver?this.setDriver(this._config.driver):!0}else return typeof I=="string"?this._config[I]:this._config},D.prototype.defineDriver=function(I,$,V){var W=new l(function(te,ne){try{var oe=I._driver,ce=new Error("Custom driver not compliant; see https://mozilla.github.io/localForage/#definedriver");if(!I._driver){ne(ce);return}for(var le=Cr.concat("_initStorage"),ge=0,Te=le.length;ge<Te;ge++){var Be=le[ge],Fe=!oc(Ns,Be);if((Fe||I[Be])&&typeof I[Be]!="function"){ne(ce);return}}var ot=function(){for(var cs=function(dc){return function(){var fc=new Error("Method "+dc+" is not implemented by the current driver"),io=l.reject(fc);return m(io,arguments[arguments.length-1]),io}},kr=0,_c=Ns.length;kr<_c;kr++){var xr=Ns[kr];I[xr]||(I[xr]=cs(xr))}};ot();var nt=function(cs){hs[oe]&&console.info("Redefining LocalForage driver: "+oe),hs[oe]=I,to[oe]=cs,te()};"_support"in I?I._support&&typeof I._support=="function"?I._support().then(nt,ne):nt(!!I._support):nt(!0)}catch(Lt){ne(Lt)}});return g(W,$,V),W},D.prototype.driver=function(){return this._driver||null},D.prototype.getDriver=function(I,$,V){var W=hs[I]?l.resolve(hs[I]):l.reject(new Error("Driver not found."));return g(W,$,V),W},D.prototype.getSerializer=function(I){var $=l.resolve(as);return g($,I),$},D.prototype.ready=function(I){var $=this,V=$._driverSet.then(function(){return $._ready===null&&($._ready=$._initDriver()),$._ready});return g(V,I,I),V},D.prototype.setDriver=function(I,$,V){var W=this;eo(I)||(I=[I]);var te=this._getSupportedDrivers(I);function ne(){W._config.driver=W.driver()}function oe(ge){return W._extend(ge),ne(),W._ready=W._initStorage(W._config),W._ready}function ce(ge){return function(){var Te=0;function Be(){for(;Te<ge.length;){var Fe=ge[Te];return Te++,W._dbInfo=null,W._ready=null,W.getDriver(Fe).then(oe).catch(Be)}ne();var ot=new Error("No available storage method found.");return W._driverSet=l.reject(ot),W._driverSet}return Be()}}var le=this._driverSet!==null?this._driverSet.catch(function(){return l.resolve()}):l.resolve();return this._driverSet=le.then(function(){var ge=te[0];return W._dbInfo=null,W._ready=null,W.getDriver(ge).then(function(Te){W._driver=Te._driver,ne(),W._wrapLibraryMethodsWithReady(),W._initDriver=ce(te)})}).catch(function(){ne();var ge=new Error("No available storage method found.");return W._driverSet=l.reject(ge),W._driverSet}),g(this._driverSet,$,V),this._driverSet},D.prototype.supports=function(I){return!!to[I]},D.prototype._extend=function(I){Er(this,I)},D.prototype._getSupportedDrivers=function(I){for(var $=[],V=0,W=I.length;V<W;V++){var te=I[V];this.supports(te)&&$.push(te)}return $},D.prototype._wrapLibraryMethodsWithReady=function(){for(var I=0,$=Cr.length;I<$;I++)cc(this,Cr[I])},D.prototype.createInstance=function(I){return new D(I)},D})(),uc=new lc;s.exports=uc},{3:3}]},{},[4])(4)})})(sn)),sn.exports}var bm=ym();const $i=ch(bm),ba="fs",wa="ide";class wm{static async getKey(t,i=""){return`guest:${t}:${i}`}static async get(t){const i=await this.getKey(t);return await $i.getItem(i)}static async set(t,i){const s=await this.getKey(t);return await $i.setItem(s,i)}static async getIDE(t){const i=await this.getKey(wa,t);return await $i.getItem(i)}static async setIDE(t,i){const s=await this.getKey(wa,t);return await $i.setItem(s,i)}static async getFS(t){if(!t)return[];const i=await this.getKey(ba,t);return await $i.getItem(i)||[]}static async setFS(t,i){if(!t)throw"Stopped saving FS state because moved away from terminal.";yn(mm,"Saving FS state...");const s=await this.getKey(ba,t);return await $i.setItem(s,i)}}function yn(e,...t){fm>=e&&console.log(...t)}function Sa(e){return e.split("").map(i=>i.charCodeAt(0))}const Ca="terminal",Oh="terminal-hidden",Cs="bus",Ea="__sandbox__",mt=Vc({emulator:null,listeners:[],xterm:null,addons:{serialize:null,fit:null,links:null},exec:(e,{mode:t=Ca,callbackExercise:i=null}={})=>{let s=`${e}
`;s=s.replace(/ \\ /g,"");const n=Sa(s),a=jt(mt).emulator;if(!a){console.error("Emulator not ready");return}if(i){s=`(${e} && echo ${Ea}) > ${vm}
`;let c="";const r=o=>{const u=String.fromCharCode(o);c+=u;const f=c.indexOf(Ea);f>-1&&(i(c.slice(0,f)),a.remove_listener(va,r))};a.add_listener(va,r)}t===Ca&&n.forEach(c=>a.bus.send(vn,c)),t===Cs&&a.keyboard_send_text(s),t===Oh&&(a.bus.listeners[Ss]=[],n.forEach(c=>a.bus.send(vn,c)),setTimeout(()=>{a.bus.listeners[Ss]=jt(mt).listeners},500))},ls:e=>{const t=jt(mt).emulator;if(!t)return console.error("Emulator not ready"),[];let i=[];const s=t.fs9p.read_dir(e);for(const n of s){const a=`${e}/${n}`,c=t.fs9p.SearchPath(a),r=t.fs9p.IsDirectory(c.id);i.push({path:a,isDir:r}),t.fs9p.IsDirectory(c.id)&&(i=i.concat(jt(mt).ls(a)))}return i},mountFile:async(e,t)=>{let i;if(typeof t=="string"){const a=t;i=await fetch(a).then(r=>r.blob()),a.split("/").pop()}else i=t,t.name;const s=await i.arrayBuffer(),n=new Uint8Array(s);return await jt(mt).createFile(`${pm}/${e}`,n),e},readFile:async e=>{const t=jt(mt).emulator;if(!t){console.error("FS not ready yet");return}if(t.fs9p.SearchPath(e).id===-1){console.error("File not found");return}try{return await t.read_file(e)}catch(s){if(s instanceof Error&&s.message==="File not found")return new Uint8Array(0);s instanceof Error&&console.error(s.message)}},createFile:async(e,t)=>{const i=jt(mt).emulator;if(!i){console.error("Emulator not ready");return}let s;t instanceof Uint8Array?s=t:(s=new Uint8Array(t.length),s.set(Sa(t)));const n=e.split("/").slice(0,-1).join("/");await jt(mt).createFolder(n),await i.create_file(e,s)},createFolder:async e=>{const t=jt(mt).emulator;if(!t){console.error("Emulator not ready");return}let i="";const s=e.split("/");for(const n of s){i+=`${n}/`;const a=t.fs9p.SearchPath(i);a.id===-1&&t.fs9p.CreateDirectory(n,a.parentid)}},clearCache:async()=>{jt(mt).exec("sync; echo 3 >/proc/sys/vm/drop_caches",{mode:Cs}),await new Promise(e=>setTimeout(e,200))}});var Sm=ze("<!> <!>",1),Cm=ze('<span class="text-success fw-bold">ok</span>'),Em=ze("<span> </span> <!> <br/>",1),km=ze('<div style="position:absolute"><div class="text-light font-monospace small"><!> <!></div></div>'),xm=hr('<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M9.5 13a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0m0-5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0m0-5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0"></path></svg>'),Am=ze("<!> <!> <!>",1),Rm=ze("<!> <!>",1),Tm=ze('<!> <div id="terminal"><div class="cli-options svelte-k4so18"><!></div></div> <div id="screen_container"><div style="white-space: pre; font: 14px monospace; line-height: 14px"></div> <canvas style="display: none"></canvas></div> <input type="file" style="display:none" multiple/> <input type="file" style="display:none" multiple webkitdirectory/>',1);function Lm(e,t){Ue(t,!1);const i=()=>Kc(mt,"$cli",s),[s,n]=Gc();window.Terminal=qp.Terminal;let a=Fi(t,"terminalId",8,"terminal"),c=Fi(t,"files",24,()=>[]),r=Fi(t,"assets",24,()=>[]),o=Fi(t,"init",8,""),u=Fi(t,"tools",24,()=>[]),f=Fi(t,"intro",8,""),l=Di(!0),m=Di([]),g=Di(!1),C=Di(),v=Di(),h=Di(),p,_,d=!1,y=0;const S=1;function w(){return{url:"",v86:""}}Oa(()=>Gt(g,!0)),Cn(E);function E(){clearTimeout(p),clearInterval(_)}function b(Y){Gt(m,[...N(m),Y])}function k(Y){if(d){console.log("Already initializing, skipping...");return}if(y>=S){console.error("Max initialization retries reached. Terminal failed to load."),d=!1,Gt(l,!1);return}console.log("Initializing terminal...",Y),d=!0,Gt(l,!0),console.time("initialize"),b("Setting up your terminal..."),E(),console.log(i().emulator),i().emulator&&i().emulator.serial_adapter&&i().emulator.destroy,us(mt,bt(i).emulator=null,bt(i));const M=w();us(mt,bt(i).emulator=new dm({wasm_path:`${M.url}/v86/v86.wasm`,memory_size:512*1024*1024,vga_memory_size:8*1024*1024,initial_state:{url:`${M.url}/v86/alpine-state.bin.zst`,size:50*1024*1024},filesystem:{baseurl:`${M.url}/v86/alpine-rootfs-flat/`,basefs:`${M.url}/v86/alpine-fs.json`},bios:{url:`${M.url}/v86/bios/seabios.bin`,size:512*1024},vga_bios:{url:`${M.url}/v86/bios/vgabios.bin`,size:512*1024},autostart:!0,screen_container:null,serial_container_xtermjs:N(C),disable_mouse:!0,disable_speaker:!0,bzimage_initrd_from_filesystem:!0,cmdline:"rw root=host9p rootfstype=9p rootflags=trans=virtio,cache=loose modules=virtio_pci tsc=reliable"}),bt(i));let T="";i().emulator.add_listener(gm,async X=>{const Q=String.fromCharCode(X);if(Q!==`
`)T+=Q;else{try{const he=JSON.parse(T),me=he.params;if(console.log("Command:",he),he.type==="open"){const fe=await i().emulator.read_file(me.path),Ae=new Blob([fe],{type:me.path.endsWith(".html")?"text/html":"text/plain"}),ue=URL.createObjectURL(Ae);window.open(ue)}else if(he.type==="download"){const fe=await i().emulator.read_file(me.path),Ae=new Blob([fe],{type:"application/octet-stream"}),ue=URL.createObjectURL(Ae),ve=document.createElement("a");ve.href=ue,ve.download=me.path.split("/").pop()||"download",ve.click()}else if(he.type==="fetch"&&me.url&&me.output&&me.sentinel){const fe=await fetch(me.url).then(Ae=>Ae.arrayBuffer());await i().emulator.create_file(me.output,new Uint8Array(fe)),await i().emulator.create_file(me.sentinel,new Uint8Array([]))}}catch(he){console.log("Received:",T),console.error(he)}T=""}});let K="";const H=async X=>K+=String.fromCharCode(X);i().emulator.add_listener(Ss,H),i().emulator.bus.register("emulator-loaded",async()=>{if(us(mt,bt(i).xterm=i().emulator.serial_adapter.term,bt(i)),console.log("Xterm.js terminal:",i().xterm),us(mt,bt(i).listeners=i().emulator.bus.listeners[Ss],bt(i)),!i().xterm){Gt(l,!1),d=!1,y++,console.warn("Could not load terminal; serial_adapter not defined."),setTimeout(()=>k(a()),500);return}y=0,us(mt,bt(i).addons={serialize:new zp.SerializeAddon,fit:new Mp.FitAddon,links:new Up.WebLinksAddon},bt(i));for(const X in i().addons){const Q=i().addons[X];Q&&i().xterm.loadAddon(Q)}console.log("Terminal ready.",i()),b("Loading files..."),await q(),await L(),i().exec("sync & echo & ls & ll & pwd",{mode:Cs}),i().exec(u().map(X=>`timeout 2 ${X}`).join(" & "),{mode:Cs}),b("Initializing environment..."),i().exec(o()),O(!0),i().xterm.focus(),i().exec(`date -s "${new Date().toString()}"`,{mode:Cs}),b("Putting the finishing touches..."),_=setInterval(()=>{K.includes("(none)")?(i().emulator.remove_listener(Ss,H),clearInterval(_),Gt(l,!1),d=!1,console.timeEnd("initialize"),P()):(i().exec(""),i().emulator.bus.send(vn,12),f()&&i().exec(f()))},200),console.log("Emulator setup complete.")})}let R={cols:null,rows:null};function O(Y=!1){if(N(l)&&!Y||!i().addons.fit)return;i().addons.fit.fit();const M=i().addons.fit.proposeDimensions();!M?.cols||!M?.rows||R.cols===M.cols&&R.rows===M.rows||(R=M,Y?yn(ga,"Set terminal size",M):yn(ga,"Resize terminal",M),i().exec(`stty rows ${M.rows} cols ${M.cols}`,{mode:Y?Oh:void 0}))}async function P(){}async function L(){const Y=await wm.getFS(a());for(const M of Y)M.isDir?await i().createFolder(M.path):M.contents?await i().createFile(M.path,M.contents):console.warn(`Skipping file ${M?.path} because too large to save in browser.`)}async function q(){await i().clearCache();for(const Y of c()){const M=`/data/${a()}/${Y}`;await i().mountFile(Y,M)}for(const Y of r()||[]){const M=`https://assets.sandbox.bio/tutorials/${a()}/${Y}`;await i().mountFile(Y,M)}}function J(){const Y=i().addons.serialize?.serialize();if(!Y){console.warn("Could not export terminal contents; terminal not ready yet.");return}const M="<pre>"+new vp().ansi_to_html(Y)+"</pre>",T=new Blob([M],{type:"text/html"}),K=URL.createObjectURL(T);window.open(K)}async function re(Y){const M=Y.target,T=M.files;if(!T){console.warn("No file specified.");return}const K=[];for(const X of T){const Q=X?.webkitRelativePath||X.name;K.push(await i().mountFile(Q,X))}const H=K.join(`
\r# `);i().xterm?.write(`

\r\x1B[0;32m# Files mounted:
\r# ${H}\x1B[0m

\r`),i().exec(""),M.value=""}qc(()=>(N(g),La(a())),()=>{N(g)&&a()&&k(a())}),Wc(),ka();var ie=Tm(),ee=ye(ie);{var x=Y=>{var M=km(),T=Pe(M),K=Pe(T);js(K,{value:null,class:"w-fit inline-block align-middle",children:(X,Q)=>{js.Circle(X,{style:"--size: 20px; --thickness: 3px;",children:(he,me)=>{var fe=Sm(),Ae=ye(fe);js.CircleTrack(Ae,{});var ue=Ot(Ae,2);js.CircleRange(ue,{}),ae(he,fe)},$$slots:{default:!0}})},$$slots:{default:!0}});var H=Ot(K,2);Jc(H,1,()=>N(m),Xc,(X,Q,he)=>{var me=Em(),fe=ye(me);ao(fe,1,"",null,{},{"ps-4":he>0});var Ae=Pe(fe,!0);Me(fe);var ue=Ot(fe,2);{var ve=Ie=>{var et=Cm();ae(Ie,et)};We(ue,Ie=>{N(m),bt(()=>he<N(m).length-1)&&Ie(ve)})}zs(2),ir(()=>Sn(Ae,N(Q))),ae(X,me)}),Me(T),Me(M),ae(Y,M)};We(ee,Y=>{N(l)&&Y(x)})}var B=Ot(ee,2);let U;var z=Pe(B),se=Pe(z);Vt(se,{children:(Y,M)=>{var T=Rm(),K=ye(T);Vt.Trigger(K,{class:"btn btn-dark btn-sm",children:(X,Q)=>{var he=xm();ae(X,he)},$$slots:{default:!0}});var H=Ot(K,2);Vt.Positioner(H,{children:(X,Q)=>{Vt.Content(X,{class:"bg-dark text-light border border-secondary rounded shadow-lg p-1",children:(he,me)=>{var fe=Am(),Ae=ye(fe);Vt.Item(Ae,{value:"mount-files",onclick:()=>N(v).click(),class:"menu-item",children:(Ie,et)=>{Vt.ItemText(Ie,{children:($e,tt)=>{zs();var He=Ys("Mount local files");ae($e,He)},$$slots:{default:!0}})},$$slots:{default:!0}});var ue=Ot(Ae,2);Vt.Item(ue,{value:"mount-folder",onclick:()=>N(h).click(),class:"menu-item",children:(Ie,et)=>{Vt.ItemText(Ie,{children:($e,tt)=>{zs();var He=Ys("Mount local folder");ae($e,He)},$$slots:{default:!0}})},$$slots:{default:!0}});var ve=Ot(ue,2);Vt.Item(ve,{value:"export",onclick:J,class:"menu-item",children:(Ie,et)=>{Vt.ItemText(Ie,{children:($e,tt)=>{zs();var He=Ys("Export as HTML");ae($e,He)},$$slots:{default:!0}})},$$slots:{default:!0}}),ae(he,fe)},$$slots:{default:!0}})},$$slots:{default:!0}}),ae(Y,T)},$$slots:{default:!0}}),Me(z),Me(B),Tr(B,Y=>Gt(C,Y),()=>N(C)),el(B,(Y,M)=>Ip?.(Y,M),()=>()=>O());var j=Ot(B,4);Tr(j,Y=>Gt(v,Y),()=>N(v));var G=Ot(j,2);Tr(G,Y=>Gt(h,Y),()=>N(h)),ir(()=>U=ao(B,1,"svelte-k4so18",null,U,{"opacity-0":N(l)})),so("change",j,re),so("change",G,re),ae(e,ie),Ne(),n()}var Dm=ze('<main class="container mx-auto p-4 h-screen"><div class="card preset-filled-surface-100-900 border border-surface-200-800 divide-surface-200-800 divide-y overflow-hidden"><header class="p-6 space-y-2"><h2 class="h6 opacity-60">ABACBS</h2> <h3 class="h3">WebAssembly Workshop</h3></header> <article class="p-0"><!></article> <footer class="flex items-center justify-between gap-4 p-4"><small class="opacity-60">WASM Workshop</small> <small class="opacity-60"> </small></footer></div></main>');function zm(e,t){Ue(t,!1),ka();var i=Dm();jc("1uha8ag",u=>{Ta(()=>{$c.title="Terminal"})});var s=Pe(i),n=Ot(Pe(s),2),a=Pe(n);Lm(a,{$$events:{status:u=>console.log("Terminal status:",u.detail)}}),Me(n);var c=Ot(n,2),r=Ot(Pe(c),2),o=Pe(r);Me(r),Me(c),Me(s),Me(i),ir(u=>Sn(o,`On ${u??""}`),[()=>new Date().toLocaleDateString()]),ae(e,i),Ne()}export{zm as component};
