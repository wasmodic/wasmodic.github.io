import{d as Se,a as oe,f as Be,p as kn,l as cr,t as Qs,m as ao}from"../chunks/Dc7VsmyU.js";import{i as wc}from"../chunks/BdkPBI3B.js";import{a as on,H as Sc,S as Rr,h as zi,a0 as Cc,I as Ec,l as U,ar as kc,af as xc,K as Ac,U as ho,a4 as Tr,e as qs,J as Rc,a9 as Tc,R as co,c as Lc,b as an,s as Dc,ai as Di,C as lo,a7 as La,aK as Ic,aU as Da,r as Ia,p as Oc,aV as Oa,aW as Pc,aX as Lr,a2 as Mc,aY as Bc,aZ as Uc,a6 as Nc,d as Fc,a_ as Pa,F as zc,a$ as Hc,ag as Ma,i as ft,D as qc,n as Ba,ac as Wc,b0 as $c,b1 as jc,az as Gc,ap as Vc,u as Kc,aB as Q,ay as Ua,al as Kt,g as xn,t as Fe,v as ye,x as ze,y as De,ab as st,z as Te,b2 as Ye,b3 as Bi,w as xs,b4 as Yc,b5 as Xc,A as vt,T as Xi,b6 as Jc}from"../chunks/C7jNEJJc.js";import{s as Ii}from"../chunks/DOzqH-Bc.js";import{s as ke,b as Xe,c as uo,h as Qc,a as Zc}from"../chunks/DWckCwnL.js";import{a as An,o as Na,w as el,g as Gt}from"../chunks/BTjudjz_.js";import{i as We,r as Ge,_ as hn,p as Hi,b as Dr,s as tl,a as il,c as qi}from"../chunks/Doiqh2tE.js";function cn(e,t){return t}function sl(e,t,i){for(var s=[],n=t.length,o=0;o<n;o++)Bc(t[o].e,s,!0);Uc(s,()=>{var c=s.length===0&&i!==null;if(c){var r=i,a=r.parentNode;Nc(a),a.append(r),e.items.clear(),Ft(e,t[0].prev,t[n-1].next)}for(var u=0;u<n;u++){var _=t[u];c||(e.items.delete(_.k),Ft(e,_.prev,_.next)),Fc(_.e,!c)}e.first===t[0]&&(e.first=t[0].prev)})}function ln(e,t,i,s,n,o=null){var c=e,r=new Map,a=null,u=(t&Pa)!==0,_=(t&Oa)!==0,l=(t&Da)!==0;if(u){var m=e;c=zi?Rr(Cc(m)):m.appendChild(on())}zi&&Ec();var g=null,C=kc(()=>{var v=i();return Ic(v)?v:v==null?[]:La(v)}),y,h=!0;function f(){rl(p,y,c,t,s),g!==null&&(y.length===0?(g.fragment?(c.before(g.fragment),g.fragment=null):Ia(g.effect),d.first=g.effect):Oc(g.effect,()=>{g=null}))}var d=Sc(()=>{y=U(C);var v=y.length;let S=!1;if(zi){var w=xc(c)===Ac;w!==(v===0)&&(c=ho(),Rr(c),Tr(!1),S=!0)}for(var E=new Set,b=Lc,k=null,R=Dc(),I=0;I<v;I+=1){zi&&qs.nodeType===Rc&&qs.data===Tc&&(c=qs,S=!0,Tr(!1));var P=y[I],L=s(P,I),z=h?null:r.get(L);z?(_&&co(z.v,P),l?co(z.i,I):z.i=I,R&&b.skipped_effects.delete(z.e)):(z=nl(h?c:null,k,P,L,I,n,t,i),h&&(z.o=!0,k===null?a=z:k.next=z,k=z),r.set(L,z)),E.add(L)}if(v===0&&o&&!g)if(h)g={fragment:null,effect:an(()=>o(c))};else{var J=document.createDocumentFragment(),re=on();J.append(re),g={fragment:J,effect:an(()=>o(re))}}if(zi&&v>0&&Rr(ho()),!h)if(R){for(const[te,ee]of r)E.has(te)||b.skipped_effects.add(ee.e);b.oncommit(f),b.ondiscard(()=>{})}else f();S&&Tr(!0),U(C)}),p={effect:d,items:r,first:a};h=!1,zi&&(c=qs)}function rl(e,t,i,s,n){var o=(s&Hc)!==0,c=t.length,r=e.items,a=e.first,u,_=null,l,m=[],g=[],C,y,h,f;if(o)for(f=0;f<c;f+=1)C=t[f],y=n(C,f),h=r.get(y),h.o&&(h.a?.measure(),(l??=new Set).add(h));for(f=0;f<c;f+=1){if(C=t[f],y=n(C,f),h=r.get(y),e.first??=h,!h.o){h.o=!0;var d=_?_.next:a;Ft(e,_,h),Ft(e,h,d),Ir(h,d,i),_=h,m=[],g=[],a=_.next;continue}if((h.e.f&Lr)!==0&&(Ia(h.e),o&&(h.a?.unfix(),(l??=new Set).delete(h))),h!==a){if(u!==void 0&&u.has(h)){if(m.length<g.length){var p=g[0],v;_=p.prev;var S=m[0],w=m[m.length-1];for(v=0;v<m.length;v+=1)Ir(m[v],p,i);for(v=0;v<g.length;v+=1)u.delete(g[v]);Ft(e,S.prev,w.next),Ft(e,_,S),Ft(e,w,p),a=p,_=w,f-=1,m=[],g=[]}else u.delete(h),Ir(h,a,i),Ft(e,h.prev,h.next),Ft(e,h,_===null?e.first:_.next),Ft(e,_,h),_=h;continue}for(m=[],g=[];a!==null&&a.k!==y;)(a.e.f&Lr)===0&&(u??=new Set).add(a),g.push(a),a=a.next;if(a===null)continue;h=a}m.push(h),_=h,a=h.next}let E=r.size>c;if(a!==null||u!==void 0){for(var b=u===void 0?[]:La(u);a!==null;)(a.e.f&Lr)===0&&b.push(a),a=a.next;var k=b.length;if(E=r.size-k>c,k>0){var R=(s&Pa)!==0&&c===0?i:null;if(o){for(f=0;f<k;f+=1)b[f].a?.measure();for(f=0;f<k;f+=1)b[f].a?.fix()}sl(e,b,R)}}if(E)for(const I of r.values())I.o||(Ft(e,_,I),_=I);e.effect.last=_&&_.e,o&&zc(()=>{if(l!==void 0)for(h of l)h.a?.apply()})}function nl(e,t,i,s,n,o,c,r){var a=(c&Oa)!==0,u=(c&Pc)===0,_=a?u?Di(i,!1,!1):lo(i):i,l=(c&Da)===0?n:lo(n),m={i:l,v:_,k:s,a:null,e:null,o:!1,prev:t,next:null};try{if(e===null){var g=document.createDocumentFragment();g.append(e=on())}return m.e=an(()=>o(e,_,l,r)),t!==null&&(t.next=m),m}finally{}}function Ir(e,t,i){for(var s=e.next?e.next.e.nodes_start:i,n=t?t.e.nodes_start:i,o=e.e.nodes_start;o!==null&&o!==s;){var c=Mc(o);n.before(o),o=c}}function Ft(e,t,i){t===null?(e.first=i,e.effect.first=i&&i.e):(t.e.next&&(t.e.next.prev=null),t.next=i,t.e.next=i&&i.e),i!==null&&(i.e.prev&&(i.e.prev.next=null),i.prev=t,i.e.prev=t&&t.e)}function ol(e,t,i){Ma(()=>{var s=ft(()=>t(e,i?.())||{});if(i&&s?.update){var n=!1,o={};qc(()=>{var c=i();Ba(c),n&&Wc(o,c)&&(o=c,s.update(c))}),n=!0}if(s?.destroy)return()=>s.destroy()})}function Ds(e){const t=Symbol();return{key:t,consume(){return jc(t)||e},provide(i){return $c(t,i)}}}const Ct={trigger:"",contextTrigger:"",positioner:"",indicator:"",content:"skb:card skb:bg-surface-50-950 skb:border skb:border-surface-200-800 skb:p-2 skb:flex skb:flex-col skb:items-stretch skb:gap-2 skb:shadow-lg skb:min-w-48",arrow:"",arrowTip:"",itemGroup:"",itemGroupLabel:"skb:text-surface-600-400 skb:text-xs skb:px-2 skb:py-1",item:"skb:flex skb:justify-between skb:items-center skb:px-2 skb:py-1 skb:rounded skb:cursor-pointer skb:data-highlighted:preset-tonal",itemText:"",itemIndicator:"",separator:"skb:hr"},di={root:"skb:flex skb:flex-col skb:gap-2 skb:data-[orientation=horizontal]:w-full skb:data-[orientation=vertical]:items-center",label:"skb:whitespace-nowrap",valueText:"",track:"skb:bg-surface-200-800 skb:rounded-base skb:overflow-hidden skb:data-[orientation=horizontal]:w-full skb:data-[orientation=horizontal]:h-2 skb:data-[orientation=vertical]:w-2 skb:data-[orientation=vertical]:h-[100px] skb:data-[orientation=vertical]:flex skb:data-[orientation=vertical]:flex-col-reverse",range:"skb:h-full skb:bg-surface-950-50 skb:rounded-base skb:data-[orientation=horizontal]:transition-[width] skb:data-[orientation=horizontal]:data-[state=indeterminate]:animate-progress-linear-indeterminate-horizontal skb:data-[orientation=vertical]:transition-[height] skb:data-[orientation=vertical]:data-[state=indeterminate]:animate-progress-linear-indeterminate-vertical",circle:"",circleTrack:"skb:stroke-surface-200-800",circleRange:"skb:stroke-primary-500 skb:transition-[stroke-dashoffset] skb:ease-in-out skb:data-[state=indeterminate]:animate-progress-circular-indeterminate"};function al(e){return e==null?[]:Array.isArray(e)?e:[e]}var hl=e=>e[0],cl=e=>e[e.length-1];function Fa(e,t,i={}){const{step:s=1,loop:n=!0}=i,o=t+s,c=e.length,r=c-1;return t===-1?s>0?0:r:o<0?n?r:0:o>=c?n?0:t>c?c:t:o}function ll(e,t,i={}){return e[Fa(e,t,i)]}function ul(e,t,i={}){const{step:s=1,loop:n=!0}=i;return Fa(e,t,{step:-s,loop:n})}function dl(e,t,i={}){return e[ul(e,t,i)]}var _o=e=>e?.constructor.name==="Array",_l=(e,t)=>{if(e.length!==t.length)return!1;for(let i=0;i<e.length;i++)if(!Is(e[i],t[i]))return!1;return!0},Is=(e,t)=>{if(Object.is(e,t))return!0;if(e==null&&t!=null||e!=null&&t==null)return!1;if(typeof e?.isEqual=="function"&&typeof t?.isEqual=="function")return e.isEqual(t);if(typeof e=="function"&&typeof t=="function")return e.toString()===t.toString();if(_o(e)&&_o(t))return _l(Array.from(e),Array.from(t));if(typeof e!="object"||typeof t!="object")return!1;const i=Object.keys(t??Object.create(null)),s=i.length;for(let n=0;n<s;n++)if(!Reflect.has(e,i[n]))return!1;for(let n=0;n<s;n++){const o=i[n];if(!Is(e[o],t[o]))return!1}return!0},fl=e=>e!=null&&typeof e=="object",za=e=>typeof e=="number"&&!Number.isNaN(e),Zs=e=>typeof e=="string",Oi=e=>typeof e=="function",pl=e=>e==null,er=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),ml=e=>Object.prototype.toString.call(e),Ha=Function.prototype.toString,gl=Ha.call(Object),vl=e=>{if(!fl(e)||ml(e)!="[object Object]"||wl(e))return!1;const t=Object.getPrototypeOf(e);if(t===null)return!0;const i=er(t,"constructor")&&t.constructor;return typeof i=="function"&&i instanceof i&&Ha.call(i)==gl},yl=e=>typeof e=="object"&&e!==null&&"$$typeof"in e&&"props"in e,bl=e=>typeof e=="object"&&e!==null&&"__v_isVNode"in e,wl=e=>yl(e)||bl(e),fo=e=>e,Sl=e=>e(),Cl=()=>{},un=(...e)=>(...t)=>{e.forEach(function(i){i?.(...t)})},El=e=>Number.isNaN(e),kl=e=>El(e)?0:e,xl=(e,t,i)=>(kl(e)-t)/(i-t);function Rn(e){if(!vl(e)||e===void 0)return e;const t=Reflect.ownKeys(e).filter(s=>typeof s=="string"),i={};for(const s of t){const n=e[s];n!==void 0&&(i[s]=Rn(n))}return i}function Al(e,t){const i={},s={},n=new Set(t),o=Reflect.ownKeys(e);for(const c of o)n.has(c)?s[c]=e[c]:i[c]=e[c];return[s,i]}var ss=e=>function(i){return Al(i,e)};function dn(...e){e.length===1?e[0]:e[1],e.length===2&&e[0]}function Rl(e,t){if(e==null)throw new Error(t())}var Tl=Object.defineProperty,Ll=(e,t,i)=>t in e?Tl(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,Or=(e,t,i)=>Ll(e,typeof t!="symbol"?t+"":t,i),Dl=(e,t)=>e.map((i,s)=>e[(Math.max(t,0)+s)%e.length]),Il=()=>{},lr=e=>typeof e=="object"&&e!==null,Wi=e=>e?"":void 0,Ol=e=>e?"true":void 0,Pl=1,Ml=9,Bl=11,mt=e=>lr(e)&&e.nodeType===Pl&&typeof e.nodeName=="string",Tn=e=>lr(e)&&e.nodeType===Ml,Ul=e=>lr(e)&&e===e.window,qa=e=>mt(e)?e.localName||"":"#document";function Nl(e){return["html","body","#document"].includes(qa(e))}var Fl=e=>lr(e)&&e.nodeType!==void 0,Zi=e=>Fl(e)&&e.nodeType===Bl&&"host"in e,zl=e=>mt(e)&&e.localName==="input",Hl=e=>!!e?.matches("a[href]"),ql=e=>mt(e)?e.offsetWidth>0||e.offsetHeight>0||e.getClientRects().length>0:!1;function _n(e){if(!e)return!1;const t=e.getRootNode();return $a(t)===e}var Wl=/(textarea|select)/;function Wa(e){if(e==null||!mt(e))return!1;try{return zl(e)&&e.selectionStart!=null||Wl.test(e.localName)||e.isContentEditable||e.getAttribute("contenteditable")==="true"||e.getAttribute("contenteditable")===""}catch{return!1}}function bi(e,t){if(!e||!t||!mt(e)||!mt(t))return!1;const i=t.getRootNode?.();if(e===t||e.contains(t))return!0;if(i&&Zi(i)){let s=t;for(;s;){if(e===s)return!0;s=s.parentNode||s.host}}return!1}function Ui(e){return Tn(e)?e:Ul(e)?e.document:e?.ownerDocument??document}function $l(e){return Ui(e).documentElement}function ki(e){return Zi(e)?ki(e.host):Tn(e)?e.defaultView??window:mt(e)?e.ownerDocument?.defaultView??window:window}function $a(e){let t=e.activeElement;for(;t?.shadowRoot;){const i=t.shadowRoot.activeElement;if(!i||i===t)break;t=i}return t}function jl(e){if(qa(e)==="html")return e;const t=e.assignedSlot||e.parentNode||Zi(e)&&e.host||$l(e);return Zi(t)?t.host:t}function Gl(e){let t;try{if(t=e.getRootNode({composed:!0}),Tn(t)||Zi(t))return t}catch{}return e.ownerDocument??document}var Pr=new WeakMap;function Vl(e){return Pr.has(e)||Pr.set(e,ki(e).getComputedStyle(e)),Pr.get(e)}var Kl=new Set(["menu","listbox","dialog","grid","tree","region"]),Yl=e=>Kl.has(e),Xl=e=>e.getAttribute("aria-controls")?.split(" ")||[];function Jl(e,t){const i=new Set,s=Gl(e),n=o=>{const c=o.querySelectorAll("[aria-controls]");for(const r of c){if(r.getAttribute("aria-expanded")!=="true")continue;const a=Xl(r);for(const u of a){if(!u||i.has(u))continue;i.add(u);const _=s.getElementById(u);if(_){const l=_.getAttribute("role"),m=_.getAttribute("aria-modal")==="true";if(l&&Yl(l)&&!m&&(_===t||_.contains(t)||n(_)))return!0}}}return!1};return n(e)}var Ln=()=>typeof document<"u";function Ql(){return navigator.userAgentData?.platform??navigator.platform}function Zl(){const e=navigator.userAgentData;return e&&Array.isArray(e.brands)?e.brands.map(({brand:t,version:i})=>`${t}/${i}`).join(" "):navigator.userAgent}var eu=e=>Ln()&&e.test(Ql()),tu=e=>Ln()&&e.test(Zl()),po=()=>Ln()&&!!navigator.maxTouchPoints,ja=()=>eu(/^Mac/i),iu=()=>tu(/Firefox/i);function su(e){return e.composedPath?.()??e.nativeEvent?.composedPath?.()}function Si(e){return su(e)?.[0]??e.target}function mo(e){const t=e.currentTarget;if(!t||!t.matches("a[href], button[type='submit'], input[type='submit']"))return!1;const s=e.button===1,n=ru(e);return s||n}function go(e){const t=e.currentTarget;if(!t)return!1;const i=t.localName;return e.altKey?i==="a"||i==="button"&&t.type==="submit"||i==="input"&&t.type==="submit":!1}function ru(e){return ja()?e.metaKey:e.ctrlKey}function nu(e){return e.key.length===1&&!e.ctrlKey&&!e.metaKey}var Ga=e=>e.button===2||ja()&&e.ctrlKey&&e.button===0,ou=e=>e.ctrlKey||e.altKey||e.metaKey,au=e=>"touches"in e&&e.touches.length>0,hu={Up:"ArrowUp",Down:"ArrowDown",Esc:"Escape"," ":"Space",",":"Comma",Left:"ArrowLeft",Right:"ArrowRight"},vo={ArrowLeft:"ArrowRight",ArrowRight:"ArrowLeft"};function yo(e,t={}){const{dir:i="ltr",orientation:s="horizontal"}=t;let n=e.key;return n=hu[n]??n,i==="rtl"&&s==="horizontal"&&n in vo&&(n=vo[n]),n}function Ws(e,t="client"){const i=au(e)?e.touches[0]||e.changedTouches[0]:e;return{x:i[`${t}X`],y:i[`${t}Y`]}}var bs=(e,t,i,s)=>{const n=typeof e=="function"?e():e;return n?.addEventListener(t,i,s),()=>{n?.removeEventListener(t,i,s)}},cu=e=>mt(e)&&e.tagName==="IFRAME";function lu(e){const t=e.getAttribute("tabindex");return t?parseInt(t,10):NaN}var uu=e=>lu(e)<0;function du(e,t){if(!t)return null;if(t===!0)return e.shadowRoot||null;const i=t(e);return(i===!0?e.shadowRoot:i)||null}function _u(e,t,i){const s=[...e],n=[...e],o=new Set,c=new Map;e.forEach((a,u)=>c.set(a,u));let r=0;for(;r<n.length;){const a=n[r++];if(!a||o.has(a))continue;o.add(a);const u=du(a,t);if(u){const _=Array.from(u.querySelectorAll(Dn)).filter(i),l=c.get(a);if(l!==void 0){const m=l+1;s.splice(m,0,..._),_.forEach((g,C)=>{c.set(g,m+C)});for(let g=m+_.length;g<s.length;g++)c.set(s[g],g)}else{const m=s.length;s.push(..._),_.forEach((g,C)=>{c.set(g,m+C)})}n.push(..._)}}return s}var Dn="input:not([type='hidden']):not([disabled]), select:not([disabled]), textarea:not([disabled]), a[href], button:not([disabled]), [tabindex], iframe, object, embed, area[href], audio[controls], video[controls], [contenteditable]:not([contenteditable='false']), details > summary:first-of-type";function In(e){return!mt(e)||e.closest("[inert]")?!1:e.matches(Dn)&&ql(e)}function On(e,t={}){if(!e)return[];const{includeContainer:i,getShadowRoot:s}=t,n=Array.from(e.querySelectorAll(Dn));i&&Mr(e)&&n.unshift(e);const o=[];for(const c of n)if(Mr(c)){if(cu(c)&&c.contentDocument){const r=c.contentDocument.body;o.push(...On(r,{getShadowRoot:s}));continue}o.push(c)}if(s){const c=_u(o,s,Mr);return!c.length&&i?n:c}return!o.length&&i?n:o}function Mr(e){return mt(e)&&e.tabIndex>0?!0:In(e)&&!uu(e)}function fu(e,t={}){const i=On(e,t),s=i[0]||null,n=i[i.length-1]||null;return[s,n]}function pu(e){const{root:t,getInitialEl:i,filter:s,enabled:n=!0}=e;if(!n)return;let o=null;if(o||(o=typeof i=="function"?i():i),o||(o=t?.querySelector("[data-autofocus],[autofocus]")),!o){const c=On(t);o=s?c.filter(s)[0]:c[0]}return o||t||void 0}function mu(e){const t=e.currentTarget;if(!t)return!1;const[i,s]=fu(t);return!(_n(i)&&e.shiftKey||_n(s)&&!e.shiftKey||!i&&!s)}var gu=class Va{constructor(){Or(this,"id",null),Or(this,"fn_cleanup"),Or(this,"cleanup",()=>{this.cancel()})}static create(){return new Va}request(t){this.cancel(),this.id=globalThis.requestAnimationFrame(()=>{this.id=null,this.fn_cleanup=t?.()})}cancel(){this.id!==null&&(globalThis.cancelAnimationFrame(this.id),this.id=null),this.fn_cleanup?.(),this.fn_cleanup=void 0}isActive(){return this.id!==null}};function zt(e){const t=gu.create();return t.request(e),t.cleanup}function vu(e,t,i){const s=zt(()=>{e.removeEventListener(t,n,!0),i()}),n=()=>{s(),i()};return e.addEventListener(t,n,{once:!0,capture:!0}),s}function yu(e,t){if(!e)return;const{attributes:i,callback:s}=t,n=e.ownerDocument.defaultView||window,o=new n.MutationObserver(c=>{for(const r of c)r.type==="attributes"&&r.attributeName&&i.includes(r.attributeName)&&s(r)});return o.observe(e,{attributes:!0,attributeFilter:i}),()=>o.disconnect()}function bu(e,t){const i=zt,s=[];return s.push(i(()=>{const n=typeof e=="function"?e():e;s.push(yu(n,t))})),()=>{s.forEach(n=>n?.())}}function wu(e){const t=()=>{const i=ki(e);e.dispatchEvent(new i.MouseEvent("click"))};iu()?vu(e,"keyup",t):queueMicrotask(t)}function fn(e){const t=jl(e);return Nl(t)?Ui(t).body:mt(t)&&Ka(t)?t:fn(t)}var Su=/auto|scroll|overlay|hidden|clip/,Cu=new Set(["inline","contents"]);function Ka(e){const t=ki(e),{overflow:i,overflowX:s,overflowY:n,display:o}=t.getComputedStyle(e);return Su.test(i+n+s)&&!Cu.has(o)}function Eu(e){return e.scrollHeight>e.clientHeight||e.scrollWidth>e.clientWidth}function ku(e,t){const{rootEl:i,...s}=t||{};!e||!i||!Ka(i)||!Eu(i)||e.scrollIntoView(s)}function xu(e,t){return Array.from(e?.querySelectorAll(t)??[])}var Pn=e=>e.id;function Au(e,t,i=Pn){return e.find(s=>i(s)===t)}function Ru(e,t,i=Pn){const s=Au(e,t,i);return s?e.indexOf(s):-1}var Tu=e=>e.split("").map(t=>{const i=t.charCodeAt(0);return i>0&&i<128?t:i>=128&&i<=255?`/x${i.toString(16)}`.replace("/","\\"):""}).join("").trim(),Lu=e=>Tu(e.dataset?.valuetext??e.textContent??""),Du=(e,t)=>e.trim().toLowerCase().startsWith(t.toLowerCase());function Iu(e,t,i,s=Pn){const n=i?Ru(e,i,s):-1;let o=i?Dl(e,n):e;return t.length===1&&(o=o.filter(r=>s(r)!==i)),o.find(r=>Du(Lu(r),t))}function Ou(e,t){if(!e)return Il;const i=Object.keys(t).reduce((s,n)=>(s[n]=e.style.getPropertyValue(n),s),{});return Object.assign(e.style,t),()=>{Object.assign(e.style,i),e.style.length===0&&e.removeAttribute("style")}}function Pu(e,t){const{state:i,activeId:s,key:n,timeout:o=350,itemToId:c}=t,r=i.keysSoFar+n,u=r.length>1&&Array.from(r).every(C=>C===r[0])?r[0]:r;let _=e.slice();const l=Iu(_,u,s,c);function m(){clearTimeout(i.timer),i.timer=-1}function g(C){i.keysSoFar=C,m(),C!==""&&(i.timer=+setTimeout(()=>{g(""),m()},o))}return g(r),l}var Ya=Object.assign(Pu,{defaultOptions:{keysSoFar:"",timer:-1},isValidEvent:Mu});function Mu(e){return e.key.length===1&&!e.ctrlKey&&!e.metaKey}function Bu(e,t,i){const{signal:s}=t;return[new Promise((c,r)=>{const a=setTimeout(()=>{r(new Error(`Timeout of ${i}ms exceeded`))},i);s.addEventListener("abort",()=>{clearTimeout(a),r(new Error("Promise aborted"))}),e.then(u=>{s.aborted||(clearTimeout(a),c(u))}).catch(u=>{s.aborted||(clearTimeout(a),r(u))})}),()=>t.abort()]}function Uu(e,t){const{timeout:i,rootNode:s}=t,n=ki(s),o=Ui(s),c=new n.AbortController;return Bu(new Promise(r=>{const a=e();if(a){r(a);return}const u=new n.MutationObserver(()=>{const _=e();_&&_.isConnected&&(u.disconnect(),r(_))});u.observe(o.body,{childList:!0,subtree:!0})}),c,i)}var Nu=(...e)=>e.map(t=>t?.trim?.()).filter(Boolean).join(" "),Fu=/((?:--)?(?:\w+-?)+)\s*:\s*([^;]*)/g,bo=e=>{const t={};let i;for(;i=Fu.exec(e);)t[i[1]]=i[2];return t},zu=(e,t)=>{if(Zs(e)){if(Zs(t))return`${e};${t}`;e=bo(e)}else Zs(t)&&(t=bo(t));return Object.assign({},e??{},t??{})};function Xa(...e){let t={};for(let i of e){if(!i)continue;for(let n in t){if(n.startsWith("on")&&typeof t[n]=="function"&&typeof i[n]=="function"){t[n]=un(i[n],t[n]);continue}if(n==="className"||n==="class"){t[n]=Nu(t[n],i[n]);continue}if(n==="style"){t[n]=zu(t[n],i[n]);continue}t[n]=i[n]!==void 0?i[n]:t[n]}for(let n in i)t[n]===void 0&&(t[n]=i[n]);const s=Object.getOwnPropertySymbols(i);for(let n of s)t[n]=i[n]}return t}function Hu(e,t,i){let s=[],n;return o=>{const c=e(o);return(c.length!==s.length||c.some((a,u)=>!Is(s[u],a)))&&(s=c,n=t(c,o)),n}}function qu(){return{and:(...e)=>function(i){return e.every(s=>i.guard(s))},or:(...e)=>function(i){return e.some(s=>i.guard(s))},not:e=>function(i){return!i.guard(e)}}}var Ki=(e=>(e.NotStarted="Not Started",e.Started="Started",e.Stopped="Stopped",e))(Ki||{}),Br="__init__";function Wu(e){const t=()=>e.getRootNode?.()??document,i=()=>Ui(t());return{...e,getRootNode:t,getDoc:i,getWin:()=>i().defaultView??window,getActiveElement:()=>$a(t()),isActiveElement:_n,getById:c=>t().getElementById(c)}}function $u(e){return new Proxy({},{get(t,i){return i==="style"?s=>e({style:s}).style:e}})}var rs=()=>e=>Array.from(new Set(e));const wo={className:"class",defaultChecked:"checked",defaultValue:"value",htmlFor:"for",onBlur:"onfocusout",onChange:"oninput",onFocus:"onfocusin",onDoubleClick:"ondblclick"};function Ja(e){let t="";for(let i in e){const s=e[i];s!=null&&(i.startsWith("--")||(i=i.replace(/[A-Z]/g,n=>`-${n.toLowerCase()}`)),t+=`${i}:${s};`)}return t}const ju=new Set("viewBox,className,preserveAspectRatio,fillRule,clipPath,clipRule,strokeWidth,strokeLinecap,strokeLinejoin,strokeDasharray,strokeDashoffset,strokeMiterlimit".split(","));function Gu(e){return e in wo?wo[e]:ju.has(e)?e:e.toLowerCase()}function Vu(e,t){return e==="style"&&typeof t=="object"?Ja(t):t}const Qa=$u(e=>{const t={};for(const i in e)t[Gu(i)]=Vu(i,e[i]);return t}),Ku=/((?:--)?(?:\w+-?)+)\s*:\s*([^;]*)/g,Yu=e=>{const t={};let i;for(;i=Ku.exec(e);)t[i[1]]=i[2];return t};function Je(...e){const t=[];for(const s of e)s&&"class"in s&&s.class!=null&&t.push(s.class);const i=Xa(...e);return t.length>0&&(i.class=t.length===1?t[0]:t),"style"in i&&(typeof i.style=="string"&&(i.style=Yu(i.style)),i.style=Ja(i.style)),i}function rr(e){const t=e().defaultValue??e().value,i=e().isEqual??Object.is;let s=Gc(Vc(t));const n=Q(()=>e().value!==void 0);let o={current:ft(()=>U(s))},c={current:void 0};Kc(()=>{const u=U(n)?e().value:U(s);o={current:u},c={current:u}});const r=u=>{const _=Oi(u)?u(o.current):u,l=c.current;e().debug&&console.log(`[bindable > ${e().debug}] setValue`,{next:_,prev:l}),U(n)||Kt(s,_,!0),i(_,l)||e().onChange?.(_,l)};function a(){return U(n)?e().value:U(s)}return{initial:t,ref:o,get:a,set(u){(e().sync?Ua:Sl)(()=>r(u))},invoke(u,_){e().onChange?.(u,_)},hash(u){return e().hash?.(u)??String(u)}}}rr.cleanup=e=>{An(()=>e())};rr.ref=e=>{let t=e;return{get:()=>t,set:i=>{t=i}}};function Xu(e){const t={current:e};return{get(i){return t.current[i]},set(i,s){t.current[i]=s}}}const Ur=e=>typeof e=="function"?e():e,Ju=(e,t)=>{let i=[],s=!0;xn(()=>{if(s){i=e.map(o=>Ur(o)),s=!1;return}let n=!1;for(let o=0;o<e.length;o++)if(!Is(i[o],Ur(e[o]))){n=!0;break}n&&(i=e.map(o=>Ur(o)),t())})};function Nr(e){return Oi(e)?e():e}function Za(e,t){const i=Q(()=>{const{id:b,ids:k,getRootNode:R}=Nr(t);return Wu({id:b,ids:k,getRootNode:R})}),s=(...b)=>{e.debug&&console.log(...b)},n=Q(()=>e.props?.({props:Rn(Nr(t)),scope:U(i)})??Nr(t)),o=Qu(()=>U(n)),c=e.context?.({prop:o,bindable:rr,get scope(){return U(i)},flush:So,getContext(){return r},getComputed(){return v},getRefs(){return C},getEvent(){return m()}}),r={get(b){return c?.[b].get()},set(b,k){c?.[b].set(k)},initial(b){return c?.[b].initial},hash(b){const k=c?.[b].get();return c?.[b].hash(k)}};let a=new Map,u={current:null},_={current:null},l={current:{type:""}};const m=()=>({...l.current,current(){return l.current},previous(){return _.current}}),g=()=>({...S,hasTag(b){const k=S.get();return!!e.states[k]?.tags?.includes(b)},matches(...b){const k=S.get();return b.includes(k)}}),C=Xu(e.refs?.({prop:o,context:r})??{}),y=()=>({state:g(),context:r,event:m(),prop:o,send:E,action:h,guard:f,track:Ju,refs:C,computed:v,flush:So,scope:U(i),choose:p}),h=b=>{const k=Oi(b)?b(y()):b;if(!k)return;const R=k.map(I=>{const P=e.implementations?.actions?.[I];return P||dn(`[zag-js] No implementation found for action "${JSON.stringify(I)}"`),P});for(const I of R)I?.(y())},f=b=>Oi(b)?b(y()):e.implementations?.guards?.[b](y()),d=b=>{const k=Oi(b)?b(y()):b;if(!k)return;const R=k.map(P=>{const L=e.implementations?.effects?.[P];return L||dn(`[zag-js] No implementation found for effect "${JSON.stringify(P)}"`),L}),I=[];for(const P of R){const L=P?.(y());L&&I.push(L)}return()=>I.forEach(P=>P?.())},p=b=>al(b).find(k=>{let R=!k.guard;return Zs(k.guard)?R=!!f(k.guard):Oi(k.guard)&&(R=k.guard(y())),R}),v=b=>{Rl(e.computed,()=>"[zag-js] No computed object found on machine");const k=e.computed[b];return k({context:r,event:m(),prop:o,refs:C,scope:U(i),computed:v})},S=rr(()=>({defaultValue:e.initialState({prop:o}),onChange(b,k){k&&(a.get(k)?.(),a.delete(k)),k&&h(e.states[k]?.exit),h(u.current?.actions);const R=d(e.states[b]?.effects);if(R&&a.set(b,R),k===Br){h(e.entry);const I=d(e.effects);I&&a.set(Br,I)}h(e.states[b]?.entry)}}));let w=Ki.NotStarted;Na(()=>{const b=w===Ki.Started;w=Ki.Started,s(b?"rehydrating...":"initializing..."),S.invoke(S.initial,Br)}),An(()=>{s("unmounting..."),w=Ki.Stopped,a.forEach(b=>b?.()),a=new Map,u.current=null,h(e.exit)});const E=b=>{if(w!==Ki.Started)return;_.current=l.current,l.current=b;let k=S.get();const R=e.states[k].on?.[b.type]??e.on?.[b.type],I=p(R);if(!I)return;u.current=I;const P=I.target??k;s("transition",b.type,I.target||k,`(${I.actions})`);const L=P!==k;L?S.set(P):I.reenter&&!L?S.invoke(k,k):h(I.actions)};return e.watch?.(y()),{get state(){return g()},send:E,context:r,prop:o,get scope(){return U(i)},refs:C,computed:v,get event(){return m()},getStatus:()=>w}}function Qu(e){return function(i){return e()[i]}}function So(e){Ua(()=>{queueMicrotask(()=>e())})}var Ji=(e,t=[])=>({parts:(...i)=>{if(Zu(t))return Ji(e,i);throw new Error("createAnatomy().parts(...) should only be called once. Did you mean to use .extendWith(...) ?")},extendWith:(...i)=>Ji(e,[...t,...i]),omit:(...i)=>Ji(e,t.filter(s=>!i.includes(s))),rename:i=>Ji(i,t),keys:()=>t,build:()=>[...new Set(t)].reduce((i,s)=>Object.assign(i,{[s]:{selector:[`&[data-scope="${$i(e)}"][data-part="${$i(s)}"]`,`& [data-scope="${$i(e)}"][data-part="${$i(s)}"]`].join(", "),attrs:{"data-scope":$i(e),"data-part":$i(s)}}}),{})}),$i=e=>e.replace(/([A-Z])([A-Z])/g,"$1-$2").replace(/([a-z])([A-Z])/g,"$1-$2").replace(/[\s_]+/g,"-").toLowerCase(),Zu=e=>e.length===0;const ed=["top","right","bottom","left"],Ci=Math.min,Tt=Math.max,nr=Math.round,$s=Math.floor,Xt=e=>({x:e,y:e}),td={left:"right",right:"left",bottom:"top",top:"bottom"},id={start:"end",end:"start"};function pn(e,t,i){return Tt(e,Ci(t,i))}function ci(e,t){return typeof e=="function"?e(t):e}function li(e){return e.split("-")[0]}function ns(e){return e.split("-")[1]}function Mn(e){return e==="x"?"y":"x"}function Bn(e){return e==="y"?"height":"width"}const sd=new Set(["top","bottom"]);function Yt(e){return sd.has(li(e))?"y":"x"}function Un(e){return Mn(Yt(e))}function rd(e,t,i){i===void 0&&(i=!1);const s=ns(e),n=Un(e),o=Bn(n);let c=n==="x"?s===(i?"end":"start")?"right":"left":s==="start"?"bottom":"top";return t.reference[o]>t.floating[o]&&(c=or(c)),[c,or(c)]}function nd(e){const t=or(e);return[mn(e),t,mn(t)]}function mn(e){return e.replace(/start|end/g,t=>id[t])}const Co=["left","right"],Eo=["right","left"],od=["top","bottom"],ad=["bottom","top"];function hd(e,t,i){switch(e){case"top":case"bottom":return i?t?Eo:Co:t?Co:Eo;case"left":case"right":return t?od:ad;default:return[]}}function cd(e,t,i,s){const n=ns(e);let o=hd(li(e),i==="start",s);return n&&(o=o.map(c=>c+"-"+n),t&&(o=o.concat(o.map(mn)))),o}function or(e){return e.replace(/left|right|bottom|top/g,t=>td[t])}function ld(e){return{top:0,right:0,bottom:0,left:0,...e}}function eh(e){return typeof e!="number"?ld(e):{top:e,right:e,bottom:e,left:e}}function ar(e){const{x:t,y:i,width:s,height:n}=e;return{width:s,height:n,top:i,left:t,right:t+s,bottom:i+n,x:t,y:i}}function ko(e,t,i){let{reference:s,floating:n}=e;const o=Yt(t),c=Un(t),r=Bn(c),a=li(t),u=o==="y",_=s.x+s.width/2-n.width/2,l=s.y+s.height/2-n.height/2,m=s[r]/2-n[r]/2;let g;switch(a){case"top":g={x:_,y:s.y-n.height};break;case"bottom":g={x:_,y:s.y+s.height};break;case"right":g={x:s.x+s.width,y:l};break;case"left":g={x:s.x-n.width,y:l};break;default:g={x:s.x,y:s.y}}switch(ns(t)){case"start":g[c]-=m*(i&&u?-1:1);break;case"end":g[c]+=m*(i&&u?-1:1);break}return g}const ud=async(e,t,i)=>{const{placement:s="bottom",strategy:n="absolute",middleware:o=[],platform:c}=i,r=o.filter(Boolean),a=await(c.isRTL==null?void 0:c.isRTL(t));let u=await c.getElementRects({reference:e,floating:t,strategy:n}),{x:_,y:l}=ko(u,s,a),m=s,g={},C=0;for(let y=0;y<r.length;y++){const{name:h,fn:f}=r[y],{x:d,y:p,data:v,reset:S}=await f({x:_,y:l,initialPlacement:s,placement:m,strategy:n,middlewareData:g,rects:u,platform:c,elements:{reference:e,floating:t}});_=d??_,l=p??l,g={...g,[h]:{...g[h],...v}},S&&C<=50&&(C++,typeof S=="object"&&(S.placement&&(m=S.placement),S.rects&&(u=S.rects===!0?await c.getElementRects({reference:e,floating:t,strategy:n}):S.rects),{x:_,y:l}=ko(u,m,a)),y=-1)}return{x:_,y:l,placement:m,strategy:n,middlewareData:g}};async function As(e,t){var i;t===void 0&&(t={});const{x:s,y:n,platform:o,rects:c,elements:r,strategy:a}=e,{boundary:u="clippingAncestors",rootBoundary:_="viewport",elementContext:l="floating",altBoundary:m=!1,padding:g=0}=ci(t,e),C=eh(g),h=r[m?l==="floating"?"reference":"floating":l],f=ar(await o.getClippingRect({element:(i=await(o.isElement==null?void 0:o.isElement(h)))==null||i?h:h.contextElement||await(o.getDocumentElement==null?void 0:o.getDocumentElement(r.floating)),boundary:u,rootBoundary:_,strategy:a})),d=l==="floating"?{x:s,y:n,width:c.floating.width,height:c.floating.height}:c.reference,p=await(o.getOffsetParent==null?void 0:o.getOffsetParent(r.floating)),v=await(o.isElement==null?void 0:o.isElement(p))?await(o.getScale==null?void 0:o.getScale(p))||{x:1,y:1}:{x:1,y:1},S=ar(o.convertOffsetParentRelativeRectToViewportRelativeRect?await o.convertOffsetParentRelativeRectToViewportRelativeRect({elements:r,rect:d,offsetParent:p,strategy:a}):d);return{top:(f.top-S.top+C.top)/v.y,bottom:(S.bottom-f.bottom+C.bottom)/v.y,left:(f.left-S.left+C.left)/v.x,right:(S.right-f.right+C.right)/v.x}}const dd=e=>({name:"arrow",options:e,async fn(t){const{x:i,y:s,placement:n,rects:o,platform:c,elements:r,middlewareData:a}=t,{element:u,padding:_=0}=ci(e,t)||{};if(u==null)return{};const l=eh(_),m={x:i,y:s},g=Un(n),C=Bn(g),y=await c.getDimensions(u),h=g==="y",f=h?"top":"left",d=h?"bottom":"right",p=h?"clientHeight":"clientWidth",v=o.reference[C]+o.reference[g]-m[g]-o.floating[C],S=m[g]-o.reference[g],w=await(c.getOffsetParent==null?void 0:c.getOffsetParent(u));let E=w?w[p]:0;(!E||!await(c.isElement==null?void 0:c.isElement(w)))&&(E=r.floating[p]||o.floating[C]);const b=v/2-S/2,k=E/2-y[C]/2-1,R=Ci(l[f],k),I=Ci(l[d],k),P=R,L=E-y[C]-I,z=E/2-y[C]/2+b,J=pn(P,z,L),re=!a.arrow&&ns(n)!=null&&z!==J&&o.reference[C]/2-(z<P?R:I)-y[C]/2<0,te=re?z<P?z-P:z-L:0;return{[g]:m[g]+te,data:{[g]:J,centerOffset:z-J-te,...re&&{alignmentOffset:te}},reset:re}}}),_d=function(e){return e===void 0&&(e={}),{name:"flip",options:e,async fn(t){var i,s;const{placement:n,middlewareData:o,rects:c,initialPlacement:r,platform:a,elements:u}=t,{mainAxis:_=!0,crossAxis:l=!0,fallbackPlacements:m,fallbackStrategy:g="bestFit",fallbackAxisSideDirection:C="none",flipAlignment:y=!0,...h}=ci(e,t);if((i=o.arrow)!=null&&i.alignmentOffset)return{};const f=li(n),d=Yt(r),p=li(r)===r,v=await(a.isRTL==null?void 0:a.isRTL(u.floating)),S=m||(p||!y?[or(r)]:nd(r)),w=C!=="none";!m&&w&&S.push(...cd(r,y,C,v));const E=[r,...S],b=await As(t,h),k=[];let R=((s=o.flip)==null?void 0:s.overflows)||[];if(_&&k.push(b[f]),l){const z=rd(n,c,v);k.push(b[z[0]],b[z[1]])}if(R=[...R,{placement:n,overflows:k}],!k.every(z=>z<=0)){var I,P;const z=(((I=o.flip)==null?void 0:I.index)||0)+1,J=E[z];if(J&&(!(l==="alignment"?d!==Yt(J):!1)||R.every(ee=>Yt(ee.placement)===d?ee.overflows[0]>0:!0)))return{data:{index:z,overflows:R},reset:{placement:J}};let re=(P=R.filter(te=>te.overflows[0]<=0).sort((te,ee)=>te.overflows[1]-ee.overflows[1])[0])==null?void 0:P.placement;if(!re)switch(g){case"bestFit":{var L;const te=(L=R.filter(ee=>{if(w){const x=Yt(ee.placement);return x===d||x==="y"}return!0}).map(ee=>[ee.placement,ee.overflows.filter(x=>x>0).reduce((x,B)=>x+B,0)]).sort((ee,x)=>ee[1]-x[1])[0])==null?void 0:L[0];te&&(re=te);break}case"initialPlacement":re=r;break}if(n!==re)return{reset:{placement:re}}}return{}}}};function xo(e,t){return{top:e.top-t.height,right:e.right-t.width,bottom:e.bottom-t.height,left:e.left-t.width}}function Ao(e){return ed.some(t=>e[t]>=0)}const fd=function(e){return e===void 0&&(e={}),{name:"hide",options:e,async fn(t){const{rects:i}=t,{strategy:s="referenceHidden",...n}=ci(e,t);switch(s){case"referenceHidden":{const o=await As(t,{...n,elementContext:"reference"}),c=xo(o,i.reference);return{data:{referenceHiddenOffsets:c,referenceHidden:Ao(c)}}}case"escaped":{const o=await As(t,{...n,altBoundary:!0}),c=xo(o,i.floating);return{data:{escapedOffsets:c,escaped:Ao(c)}}}default:return{}}}}},th=new Set(["left","top"]);async function pd(e,t){const{placement:i,platform:s,elements:n}=e,o=await(s.isRTL==null?void 0:s.isRTL(n.floating)),c=li(i),r=ns(i),a=Yt(i)==="y",u=th.has(c)?-1:1,_=o&&a?-1:1,l=ci(t,e);let{mainAxis:m,crossAxis:g,alignmentAxis:C}=typeof l=="number"?{mainAxis:l,crossAxis:0,alignmentAxis:null}:{mainAxis:l.mainAxis||0,crossAxis:l.crossAxis||0,alignmentAxis:l.alignmentAxis};return r&&typeof C=="number"&&(g=r==="end"?C*-1:C),a?{x:g*_,y:m*u}:{x:m*u,y:g*_}}const md=function(e){return e===void 0&&(e=0),{name:"offset",options:e,async fn(t){var i,s;const{x:n,y:o,placement:c,middlewareData:r}=t,a=await pd(t,e);return c===((i=r.offset)==null?void 0:i.placement)&&(s=r.arrow)!=null&&s.alignmentOffset?{}:{x:n+a.x,y:o+a.y,data:{...a,placement:c}}}}},gd=function(e){return e===void 0&&(e={}),{name:"shift",options:e,async fn(t){const{x:i,y:s,placement:n}=t,{mainAxis:o=!0,crossAxis:c=!1,limiter:r={fn:h=>{let{x:f,y:d}=h;return{x:f,y:d}}},...a}=ci(e,t),u={x:i,y:s},_=await As(t,a),l=Yt(li(n)),m=Mn(l);let g=u[m],C=u[l];if(o){const h=m==="y"?"top":"left",f=m==="y"?"bottom":"right",d=g+_[h],p=g-_[f];g=pn(d,g,p)}if(c){const h=l==="y"?"top":"left",f=l==="y"?"bottom":"right",d=C+_[h],p=C-_[f];C=pn(d,C,p)}const y=r.fn({...t,[m]:g,[l]:C});return{...y,data:{x:y.x-i,y:y.y-s,enabled:{[m]:o,[l]:c}}}}}},vd=function(e){return e===void 0&&(e={}),{options:e,fn(t){const{x:i,y:s,placement:n,rects:o,middlewareData:c}=t,{offset:r=0,mainAxis:a=!0,crossAxis:u=!0}=ci(e,t),_={x:i,y:s},l=Yt(n),m=Mn(l);let g=_[m],C=_[l];const y=ci(r,t),h=typeof y=="number"?{mainAxis:y,crossAxis:0}:{mainAxis:0,crossAxis:0,...y};if(a){const p=m==="y"?"height":"width",v=o.reference[m]-o.floating[p]+h.mainAxis,S=o.reference[m]+o.reference[p]-h.mainAxis;g<v?g=v:g>S&&(g=S)}if(u){var f,d;const p=m==="y"?"width":"height",v=th.has(li(n)),S=o.reference[l]-o.floating[p]+(v&&((f=c.offset)==null?void 0:f[l])||0)+(v?0:h.crossAxis),w=o.reference[l]+o.reference[p]+(v?0:((d=c.offset)==null?void 0:d[l])||0)-(v?h.crossAxis:0);C<S?C=S:C>w&&(C=w)}return{[m]:g,[l]:C}}}},yd=function(e){return e===void 0&&(e={}),{name:"size",options:e,async fn(t){var i,s;const{placement:n,rects:o,platform:c,elements:r}=t,{apply:a=()=>{},...u}=ci(e,t),_=await As(t,u),l=li(n),m=ns(n),g=Yt(n)==="y",{width:C,height:y}=o.floating;let h,f;l==="top"||l==="bottom"?(h=l,f=m===(await(c.isRTL==null?void 0:c.isRTL(r.floating))?"start":"end")?"left":"right"):(f=l,h=m==="end"?"top":"bottom");const d=y-_.top-_.bottom,p=C-_.left-_.right,v=Ci(y-_[h],d),S=Ci(C-_[f],p),w=!t.middlewareData.shift;let E=v,b=S;if((i=t.middlewareData.shift)!=null&&i.enabled.x&&(b=p),(s=t.middlewareData.shift)!=null&&s.enabled.y&&(E=d),w&&!m){const R=Tt(_.left,0),I=Tt(_.right,0),P=Tt(_.top,0),L=Tt(_.bottom,0);g?b=C-2*(R!==0||I!==0?R+I:Tt(_.left,_.right)):E=y-2*(P!==0||L!==0?P+L:Tt(_.top,_.bottom))}await a({...t,availableWidth:b,availableHeight:E});const k=await c.getDimensions(r.floating);return C!==k.width||y!==k.height?{reset:{rects:!0}}:{}}}};function ur(){return typeof window<"u"}function os(e){return ih(e)?(e.nodeName||"").toLowerCase():"#document"}function Lt(e){var t;return(e==null||(t=e.ownerDocument)==null?void 0:t.defaultView)||window}function ei(e){var t;return(t=(ih(e)?e.ownerDocument:e.document)||window.document)==null?void 0:t.documentElement}function ih(e){return ur()?e instanceof Node||e instanceof Lt(e).Node:!1}function Ht(e){return ur()?e instanceof Element||e instanceof Lt(e).Element:!1}function Qt(e){return ur()?e instanceof HTMLElement||e instanceof Lt(e).HTMLElement:!1}function Ro(e){return!ur()||typeof ShadowRoot>"u"?!1:e instanceof ShadowRoot||e instanceof Lt(e).ShadowRoot}const bd=new Set(["inline","contents"]);function Os(e){const{overflow:t,overflowX:i,overflowY:s,display:n}=qt(e);return/auto|scroll|overlay|hidden|clip/.test(t+s+i)&&!bd.has(n)}const wd=new Set(["table","td","th"]);function Sd(e){return wd.has(os(e))}const Cd=[":popover-open",":modal"];function dr(e){return Cd.some(t=>{try{return e.matches(t)}catch{return!1}})}const Ed=["transform","translate","scale","rotate","perspective"],kd=["transform","translate","scale","rotate","perspective","filter"],xd=["paint","layout","strict","content"];function Nn(e){const t=Fn(),i=Ht(e)?qt(e):e;return Ed.some(s=>i[s]?i[s]!=="none":!1)||(i.containerType?i.containerType!=="normal":!1)||!t&&(i.backdropFilter?i.backdropFilter!=="none":!1)||!t&&(i.filter?i.filter!=="none":!1)||kd.some(s=>(i.willChange||"").includes(s))||xd.some(s=>(i.contain||"").includes(s))}function Ad(e){let t=Ei(e);for(;Qt(t)&&!es(t);){if(Nn(t))return t;if(dr(t))return null;t=Ei(t)}return null}function Fn(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}const Rd=new Set(["html","body","#document"]);function es(e){return Rd.has(os(e))}function qt(e){return Lt(e).getComputedStyle(e)}function _r(e){return Ht(e)?{scrollLeft:e.scrollLeft,scrollTop:e.scrollTop}:{scrollLeft:e.scrollX,scrollTop:e.scrollY}}function Ei(e){if(os(e)==="html")return e;const t=e.assignedSlot||e.parentNode||Ro(e)&&e.host||ei(e);return Ro(t)?t.host:t}function sh(e){const t=Ei(e);return es(t)?e.ownerDocument?e.ownerDocument.body:e.body:Qt(t)&&Os(t)?t:sh(t)}function Rs(e,t,i){var s;t===void 0&&(t=[]),i===void 0&&(i=!0);const n=sh(e),o=n===((s=e.ownerDocument)==null?void 0:s.body),c=Lt(n);if(o){const r=gn(c);return t.concat(c,c.visualViewport||[],Os(n)?n:[],r&&i?Rs(r):[])}return t.concat(n,Rs(n,[],i))}function gn(e){return e.parent&&Object.getPrototypeOf(e.parent)?e.frameElement:null}function rh(e){const t=qt(e);let i=parseFloat(t.width)||0,s=parseFloat(t.height)||0;const n=Qt(e),o=n?e.offsetWidth:i,c=n?e.offsetHeight:s,r=nr(i)!==o||nr(s)!==c;return r&&(i=o,s=c),{width:i,height:s,$:r}}function zn(e){return Ht(e)?e:e.contextElement}function Qi(e){const t=zn(e);if(!Qt(t))return Xt(1);const i=t.getBoundingClientRect(),{width:s,height:n,$:o}=rh(t);let c=(o?nr(i.width):i.width)/s,r=(o?nr(i.height):i.height)/n;return(!c||!Number.isFinite(c))&&(c=1),(!r||!Number.isFinite(r))&&(r=1),{x:c,y:r}}const Td=Xt(0);function nh(e){const t=Lt(e);return!Fn()||!t.visualViewport?Td:{x:t.visualViewport.offsetLeft,y:t.visualViewport.offsetTop}}function Ld(e,t,i){return t===void 0&&(t=!1),!i||t&&i!==Lt(e)?!1:t}function Pi(e,t,i,s){t===void 0&&(t=!1),i===void 0&&(i=!1);const n=e.getBoundingClientRect(),o=zn(e);let c=Xt(1);t&&(s?Ht(s)&&(c=Qi(s)):c=Qi(e));const r=Ld(o,i,s)?nh(o):Xt(0);let a=(n.left+r.x)/c.x,u=(n.top+r.y)/c.y,_=n.width/c.x,l=n.height/c.y;if(o){const m=Lt(o),g=s&&Ht(s)?Lt(s):s;let C=m,y=gn(C);for(;y&&s&&g!==C;){const h=Qi(y),f=y.getBoundingClientRect(),d=qt(y),p=f.left+(y.clientLeft+parseFloat(d.paddingLeft))*h.x,v=f.top+(y.clientTop+parseFloat(d.paddingTop))*h.y;a*=h.x,u*=h.y,_*=h.x,l*=h.y,a+=p,u+=v,C=Lt(y),y=gn(C)}}return ar({width:_,height:l,x:a,y:u})}function fr(e,t){const i=_r(e).scrollLeft;return t?t.left+i:Pi(ei(e)).left+i}function oh(e,t){const i=e.getBoundingClientRect(),s=i.left+t.scrollLeft-fr(e,i),n=i.top+t.scrollTop;return{x:s,y:n}}function Dd(e){let{elements:t,rect:i,offsetParent:s,strategy:n}=e;const o=n==="fixed",c=ei(s),r=t?dr(t.floating):!1;if(s===c||r&&o)return i;let a={scrollLeft:0,scrollTop:0},u=Xt(1);const _=Xt(0),l=Qt(s);if((l||!l&&!o)&&((os(s)!=="body"||Os(c))&&(a=_r(s)),Qt(s))){const g=Pi(s);u=Qi(s),_.x=g.x+s.clientLeft,_.y=g.y+s.clientTop}const m=c&&!l&&!o?oh(c,a):Xt(0);return{width:i.width*u.x,height:i.height*u.y,x:i.x*u.x-a.scrollLeft*u.x+_.x+m.x,y:i.y*u.y-a.scrollTop*u.y+_.y+m.y}}function Id(e){return Array.from(e.getClientRects())}function Od(e){const t=ei(e),i=_r(e),s=e.ownerDocument.body,n=Tt(t.scrollWidth,t.clientWidth,s.scrollWidth,s.clientWidth),o=Tt(t.scrollHeight,t.clientHeight,s.scrollHeight,s.clientHeight);let c=-i.scrollLeft+fr(e);const r=-i.scrollTop;return qt(s).direction==="rtl"&&(c+=Tt(t.clientWidth,s.clientWidth)-n),{width:n,height:o,x:c,y:r}}const To=25;function Pd(e,t){const i=Lt(e),s=ei(e),n=i.visualViewport;let o=s.clientWidth,c=s.clientHeight,r=0,a=0;if(n){o=n.width,c=n.height;const _=Fn();(!_||_&&t==="fixed")&&(r=n.offsetLeft,a=n.offsetTop)}const u=fr(s);if(u<=0){const _=s.ownerDocument,l=_.body,m=getComputedStyle(l),g=_.compatMode==="CSS1Compat"&&parseFloat(m.marginLeft)+parseFloat(m.marginRight)||0,C=Math.abs(s.clientWidth-l.clientWidth-g);C<=To&&(o-=C)}else u<=To&&(o+=u);return{width:o,height:c,x:r,y:a}}const Md=new Set(["absolute","fixed"]);function Bd(e,t){const i=Pi(e,!0,t==="fixed"),s=i.top+e.clientTop,n=i.left+e.clientLeft,o=Qt(e)?Qi(e):Xt(1),c=e.clientWidth*o.x,r=e.clientHeight*o.y,a=n*o.x,u=s*o.y;return{width:c,height:r,x:a,y:u}}function Lo(e,t,i){let s;if(t==="viewport")s=Pd(e,i);else if(t==="document")s=Od(ei(e));else if(Ht(t))s=Bd(t,i);else{const n=nh(e);s={x:t.x-n.x,y:t.y-n.y,width:t.width,height:t.height}}return ar(s)}function ah(e,t){const i=Ei(e);return i===t||!Ht(i)||es(i)?!1:qt(i).position==="fixed"||ah(i,t)}function Ud(e,t){const i=t.get(e);if(i)return i;let s=Rs(e,[],!1).filter(r=>Ht(r)&&os(r)!=="body"),n=null;const o=qt(e).position==="fixed";let c=o?Ei(e):e;for(;Ht(c)&&!es(c);){const r=qt(c),a=Nn(c);!a&&r.position==="fixed"&&(n=null),(o?!a&&!n:!a&&r.position==="static"&&!!n&&Md.has(n.position)||Os(c)&&!a&&ah(e,c))?s=s.filter(_=>_!==c):n=r,c=Ei(c)}return t.set(e,s),s}function Nd(e){let{element:t,boundary:i,rootBoundary:s,strategy:n}=e;const c=[...i==="clippingAncestors"?dr(t)?[]:Ud(t,this._c):[].concat(i),s],r=c[0],a=c.reduce((u,_)=>{const l=Lo(t,_,n);return u.top=Tt(l.top,u.top),u.right=Ci(l.right,u.right),u.bottom=Ci(l.bottom,u.bottom),u.left=Tt(l.left,u.left),u},Lo(t,r,n));return{width:a.right-a.left,height:a.bottom-a.top,x:a.left,y:a.top}}function Fd(e){const{width:t,height:i}=rh(e);return{width:t,height:i}}function zd(e,t,i){const s=Qt(t),n=ei(t),o=i==="fixed",c=Pi(e,!0,o,t);let r={scrollLeft:0,scrollTop:0};const a=Xt(0);function u(){a.x=fr(n)}if(s||!s&&!o)if((os(t)!=="body"||Os(n))&&(r=_r(t)),s){const g=Pi(t,!0,o,t);a.x=g.x+t.clientLeft,a.y=g.y+t.clientTop}else n&&u();o&&!s&&n&&u();const _=n&&!s&&!o?oh(n,r):Xt(0),l=c.left+r.scrollLeft-a.x-_.x,m=c.top+r.scrollTop-a.y-_.y;return{x:l,y:m,width:c.width,height:c.height}}function Fr(e){return qt(e).position==="static"}function Do(e,t){if(!Qt(e)||qt(e).position==="fixed")return null;if(t)return t(e);let i=e.offsetParent;return ei(e)===i&&(i=i.ownerDocument.body),i}function hh(e,t){const i=Lt(e);if(dr(e))return i;if(!Qt(e)){let n=Ei(e);for(;n&&!es(n);){if(Ht(n)&&!Fr(n))return n;n=Ei(n)}return i}let s=Do(e,t);for(;s&&Sd(s)&&Fr(s);)s=Do(s,t);return s&&es(s)&&Fr(s)&&!Nn(s)?i:s||Ad(e)||i}const Hd=async function(e){const t=this.getOffsetParent||hh,i=this.getDimensions,s=await i(e.floating);return{reference:zd(e.reference,await t(e.floating),e.strategy),floating:{x:0,y:0,width:s.width,height:s.height}}};function qd(e){return qt(e).direction==="rtl"}const Wd={convertOffsetParentRelativeRectToViewportRelativeRect:Dd,getDocumentElement:ei,getClippingRect:Nd,getOffsetParent:hh,getElementRects:Hd,getClientRects:Id,getDimensions:Fd,getScale:Qi,isElement:Ht,isRTL:qd};function ch(e,t){return e.x===t.x&&e.y===t.y&&e.width===t.width&&e.height===t.height}function $d(e,t){let i=null,s;const n=ei(e);function o(){var r;clearTimeout(s),(r=i)==null||r.disconnect(),i=null}function c(r,a){r===void 0&&(r=!1),a===void 0&&(a=1),o();const u=e.getBoundingClientRect(),{left:_,top:l,width:m,height:g}=u;if(r||t(),!m||!g)return;const C=$s(l),y=$s(n.clientWidth-(_+m)),h=$s(n.clientHeight-(l+g)),f=$s(_),p={rootMargin:-C+"px "+-y+"px "+-h+"px "+-f+"px",threshold:Tt(0,Ci(1,a))||1};let v=!0;function S(w){const E=w[0].intersectionRatio;if(E!==a){if(!v)return c();E?c(!1,E):s=setTimeout(()=>{c(!1,1e-7)},1e3)}E===1&&!ch(u,e.getBoundingClientRect())&&c(),v=!1}try{i=new IntersectionObserver(S,{...p,root:n.ownerDocument})}catch{i=new IntersectionObserver(S,p)}i.observe(e)}return c(!0),o}function jd(e,t,i,s){s===void 0&&(s={});const{ancestorScroll:n=!0,ancestorResize:o=!0,elementResize:c=typeof ResizeObserver=="function",layoutShift:r=typeof IntersectionObserver=="function",animationFrame:a=!1}=s,u=zn(e),_=n||o?[...u?Rs(u):[],...Rs(t)]:[];_.forEach(f=>{n&&f.addEventListener("scroll",i,{passive:!0}),o&&f.addEventListener("resize",i)});const l=u&&r?$d(u,i):null;let m=-1,g=null;c&&(g=new ResizeObserver(f=>{let[d]=f;d&&d.target===u&&g&&(g.unobserve(t),cancelAnimationFrame(m),m=requestAnimationFrame(()=>{var p;(p=g)==null||p.observe(t)})),i()}),u&&!a&&g.observe(u),g.observe(t));let C,y=a?Pi(e):null;a&&h();function h(){const f=Pi(e);y&&!ch(y,f)&&i(),y=f,C=requestAnimationFrame(h)}return i(),()=>{var f;_.forEach(d=>{n&&d.removeEventListener("scroll",i),o&&d.removeEventListener("resize",i)}),l?.(),(f=g)==null||f.disconnect(),g=null,a&&cancelAnimationFrame(C)}}const Gd=md,Vd=gd,Kd=_d,Yd=yd,Xd=fd,Jd=dd,Qd=vd,Zd=(e,t,i)=>{const s=new Map,n={platform:Wd,...i},o={...n.platform,_c:s};return ud(e,t,{...n,platform:o})};function Io(e=0,t=0,i=0,s=0){if(typeof DOMRect=="function")return new DOMRect(e,t,i,s);const n={x:e,y:t,width:i,height:s,top:t,right:e+i,bottom:t+s,left:e};return{...n,toJSON:()=>n}}function e_(e){if(!e)return Io();const{x:t,y:i,width:s,height:n}=e;return Io(t,i,s,n)}function t_(e,t){return{contextElement:mt(e)?e:void 0,getBoundingClientRect:()=>{const i=e,s=t?.(i);return s||!i?e_(s):i.getBoundingClientRect()}}}var fs=e=>({variable:e,reference:`var(${e})`}),hi={arrowSize:fs("--arrow-size"),arrowSizeHalf:fs("--arrow-size-half"),arrowBg:fs("--arrow-background"),transformOrigin:fs("--transform-origin"),arrowOffset:fs("--arrow-offset")},i_=e=>e==="top"||e==="bottom"?"y":"x";function s_(e,t){return{name:"transformOrigin",fn(i){const{elements:s,middlewareData:n,placement:o,rects:c,y:r}=i,a=o.split("-")[0],u=i_(a),_=n.arrow?.x||0,l=n.arrow?.y||0,m=t?.clientWidth||0,g=t?.clientHeight||0,C=_+m/2,y=l+g/2,h=Math.abs(n.shift?.y||0),f=c.reference.height/2,d=g/2,p=e.offset?.mainAxis??e.gutter,v=typeof p=="number"?p+d:p??d,S=h>v,w={top:`${C}px calc(100% + ${v}px)`,bottom:`${C}px ${-v}px`,left:`calc(100% + ${v}px) ${y}px`,right:`${-v}px ${y}px`}[a],E=`${C}px ${c.reference.y+f-r}px`,b=!!e.overlap&&u==="y"&&S;return s.floating.style.setProperty(hi.transformOrigin.variable,b?E:w),{data:{transformOrigin:b?E:w}}}}}var r_={name:"rects",fn({rects:e}){return{data:e}}},n_=e=>{if(e)return{name:"shiftArrow",fn({placement:t,middlewareData:i}){if(!i.arrow)return{};const{x:s,y:n}=i.arrow,o=t.split("-")[0];return Object.assign(e.style,{left:s!=null?`${s}px`:"",top:n!=null?`${n}px`:"",[o]:`calc(100% + ${hi.arrowOffset.reference})`}),{}}}};function o_(e){const[t,i]=e.split("-");return{side:t,align:i,hasAlign:i!=null}}function a_(e){return e.split("-")[0]}var h_={strategy:"absolute",placement:"bottom",listeners:!0,gutter:8,flip:!0,slide:!0,overlap:!1,sameWidth:!1,fitViewport:!1,overflowPadding:8,arrowPadding:4};function Oo(e,t){const i=e.devicePixelRatio||1;return Math.round(t*i)/i}function Hn(e){return typeof e=="function"?e():e==="clipping-ancestors"?"clippingAncestors":e}function c_(e,t,i){const s=e||t.createElement("div");return Jd({element:s,padding:i.arrowPadding})}function l_(e,t){if(!pl(t.offset??t.gutter))return Gd(({placement:i})=>{const s=(e?.clientHeight||0)/2,n=t.offset?.mainAxis??t.gutter,o=typeof n=="number"?n+s:n??s,{hasAlign:c}=o_(i),r=c?void 0:t.shift,a=t.offset?.crossAxis??r;return Rn({crossAxis:a,mainAxis:o,alignmentAxis:t.shift})})}function u_(e){if(!e.flip)return;const t=Hn(e.boundary);return Kd({...t?{boundary:t}:void 0,padding:e.overflowPadding,fallbackPlacements:e.flip===!0?void 0:e.flip})}function d_(e){if(!e.slide&&!e.overlap)return;const t=Hn(e.boundary);return Vd({...t?{boundary:t}:void 0,mainAxis:e.slide,crossAxis:e.overlap,padding:e.overflowPadding,limiter:Qd()})}function __(e){return Yd({padding:e.overflowPadding,apply({elements:t,rects:i,availableHeight:s,availableWidth:n}){const o=t.floating,c=Math.round(i.reference.width),r=Math.round(i.reference.height);n=Math.floor(n),s=Math.floor(s),o.style.setProperty("--reference-width",`${c}px`),o.style.setProperty("--reference-height",`${r}px`),o.style.setProperty("--available-width",`${n}px`),o.style.setProperty("--available-height",`${s}px`)}})}function f_(e){if(e.hideWhenDetached)return Xd({strategy:"referenceHidden",boundary:Hn(e.boundary)??"clippingAncestors"})}function p_(e){return e?e===!0?{ancestorResize:!0,ancestorScroll:!0,elementResize:!0,layoutShift:!0}:e:{}}function m_(e,t,i={}){const s=t_(e,i.getAnchorRect);if(!t||!s)return;const n=Object.assign({},h_,i),o=t.querySelector("[data-part=arrow]"),c=[l_(o,n),u_(n),d_(n),c_(o,t.ownerDocument,n),n_(o),s_({gutter:n.gutter,offset:n.offset,overlap:n.overlap},o),__(n),f_(n),r_],{placement:r,strategy:a,onComplete:u,onPositioned:_}=n,l=async()=>{if(!s||!t)return;const y=await Zd(s,t,{placement:r,middleware:c,strategy:a});u?.(y),_?.({placed:!0});const h=ki(t),f=Oo(h,y.x),d=Oo(h,y.y);t.style.setProperty("--x",`${f}px`),t.style.setProperty("--y",`${d}px`),n.hideWhenDetached&&(y.middlewareData.hide?.referenceHidden?(t.style.setProperty("visibility","hidden"),t.style.setProperty("pointer-events","none")):(t.style.removeProperty("visibility"),t.style.removeProperty("pointer-events")));const p=t.firstElementChild;if(p){const v=Vl(p);t.style.setProperty("--z-index",v.zIndex)}},m=async()=>{i.updatePosition?(await i.updatePosition({updatePosition:l,floatingElement:t}),_?.({placed:!0})):await l()},g=p_(n.listeners),C=n.listeners?jd(s,t,m,g):Cl;return m(),()=>{C?.(),_?.({placed:!1})}}function Po(e,t,i={}){const{defer:s,...n}=i,o=s?zt:r=>r(),c=[];return c.push(o(()=>{const r=typeof e=="function"?e():e,a=typeof t=="function"?t():t;c.push(m_(r,a,n))})),()=>{c.forEach(r=>r?.())}}var g_={bottom:"rotate(45deg)",left:"rotate(135deg)",top:"rotate(225deg)",right:"rotate(315deg)"};function v_(e={}){const{placement:t,sameWidth:i,fitViewport:s,strategy:n="absolute"}=e;return{arrow:{position:"absolute",width:hi.arrowSize.reference,height:hi.arrowSize.reference,[hi.arrowSizeHalf.variable]:`calc(${hi.arrowSize.reference} / 2)`,[hi.arrowOffset.variable]:`calc(${hi.arrowSizeHalf.reference} * -1)`},arrowTip:{transform:t?g_[t.split("-")[0]]:void 0,background:hi.arrowBg.reference,top:"0",left:"0",width:"100%",height:"100%",position:"absolute",zIndex:"inherit"},floating:{position:n,isolation:"isolate",minWidth:i?void 0:"max-content",width:i?"var(--reference-width)":void 0,maxWidth:s?"var(--available-width)":void 0,maxHeight:s?"var(--available-height)":void 0,pointerEvents:t?void 0:"none",top:"0px",left:"0px",transform:t?"translate3d(var(--x), var(--y), 0)":"translate3d(0, -100vh, 0)",zIndex:"var(--z-index)"}}}function y_(e){const t={each(i){for(let s=0;s<e.frames?.length;s+=1){const n=e.frames[s];n&&i(n)}},addEventListener(i,s,n){return t.each(o=>{try{o.document.addEventListener(i,s,n)}catch{}}),()=>{try{t.removeEventListener(i,s,n)}catch{}}},removeEventListener(i,s,n){t.each(o=>{try{o.document.removeEventListener(i,s,n)}catch{}})}};return t}function b_(e){const t=e.frameElement!=null?e.parent:null;return{addEventListener:(i,s,n)=>{try{t?.addEventListener(i,s,n)}catch{}return()=>{try{t?.removeEventListener(i,s,n)}catch{}}},removeEventListener:(i,s,n)=>{try{t?.removeEventListener(i,s,n)}catch{}}}}var Mo="pointerdown.outside",Bo="focus.outside";function w_(e){for(const t of e)if(mt(t)&&In(t))return!0;return!1}var lh=e=>"clientY"in e;function S_(e,t){if(!lh(t)||!e)return!1;const i=e.getBoundingClientRect();return i.width===0||i.height===0?!1:i.top<=t.clientY&&t.clientY<=i.top+i.height&&i.left<=t.clientX&&t.clientX<=i.left+i.width}function C_(e,t){return e.y<=t.y&&t.y<=e.y+e.height&&e.x<=t.x&&t.x<=e.x+e.width}function Uo(e,t){if(!t||!lh(e))return!1;const i=t.scrollHeight>t.clientHeight,s=i&&e.clientX>t.offsetLeft+t.clientWidth,n=t.scrollWidth>t.clientWidth,o=n&&e.clientY>t.offsetTop+t.clientHeight,c={x:t.offsetLeft,y:t.offsetTop,width:t.clientWidth+(i?16:0),height:t.clientHeight+(n?16:0)},r={x:e.clientX,y:e.clientY};return C_(c,r)?s||o:!1}function E_(e,t){const{exclude:i,onFocusOutside:s,onPointerDownOutside:n,onInteractOutside:o,defer:c,followControlledElements:r=!0}=t;if(!e)return;const a=Ui(e),u=ki(e),_=y_(u),l=b_(u);function m(p,v){if(!mt(v)||!v.isConnected||bi(e,v)||S_(e,p)||r&&Jl(e,v))return!1;const S=a.querySelector(`[aria-controls="${e.id}"]`);if(S){const E=fn(S);if(Uo(p,E))return!1}const w=fn(e);return Uo(p,w)?!1:!i?.(v)}const g=new Set,C=Zi(e?.getRootNode());function y(p){function v(S){const w=c&&!po()?zt:k=>k(),E=S??p,b=E?.composedPath?.()??[E?.target];w(()=>{const k=C?b[0]:Si(p);if(!(!e||!m(p,k))){if(n||o){const R=un(n,o);e.addEventListener(Mo,R,{once:!0})}No(e,Mo,{bubbles:!1,cancelable:!0,detail:{originalEvent:E,contextmenu:Ga(E),focusable:w_(b),target:k}})}})}p.pointerType==="touch"?(g.forEach(S=>S()),g.add(bs(a,"click",v,{once:!0})),g.add(l.addEventListener("click",v,{once:!0})),g.add(_.addEventListener("click",v,{once:!0}))):v()}const h=new Set,f=setTimeout(()=>{h.add(bs(a,"pointerdown",y,!0)),h.add(l.addEventListener("pointerdown",y,!0)),h.add(_.addEventListener("pointerdown",y,!0))},0);function d(p){(c?zt:S=>S())(()=>{const S=p?.composedPath?.()??[p?.target],w=C?S[0]:Si(p);if(!(!e||!m(p,w))){if(s||o){const E=un(s,o);e.addEventListener(Bo,E,{once:!0})}No(e,Bo,{bubbles:!1,cancelable:!0,detail:{originalEvent:p,contextmenu:!1,focusable:In(w),target:w}})}})}return po()||(h.add(bs(a,"focusin",d,!0)),h.add(l.addEventListener("focusin",d,!0)),h.add(_.addEventListener("focusin",d,!0))),()=>{clearTimeout(f),g.forEach(p=>p()),h.forEach(p=>p())}}function k_(e,t){const{defer:i}=t,s=i?zt:o=>o(),n=[];return n.push(s(()=>{const o=typeof e=="function"?e():e;n.push(E_(o,t))})),()=>{n.forEach(o=>o?.())}}function No(e,t,i){const s=e.ownerDocument.defaultView||window,n=new s.CustomEvent(t,i);return e.dispatchEvent(n)}function x_(e,t){const i=s=>{s.key==="Escape"&&(s.isComposing||t?.(s))};return bs(Ui(e),"keydown",i,{capture:!0})}var Fo="layer:request-dismiss",Ot={layers:[],branches:[],count(){return this.layers.length},pointerBlockingLayers(){return this.layers.filter(e=>e.pointerBlocking)},topMostPointerBlockingLayer(){return[...this.pointerBlockingLayers()].slice(-1)[0]},hasPointerBlockingLayer(){return this.pointerBlockingLayers().length>0},isBelowPointerBlockingLayer(e){const t=this.indexOf(e),i=this.topMostPointerBlockingLayer()?this.indexOf(this.topMostPointerBlockingLayer()?.node):-1;return t<i},isTopMost(e){return this.layers[this.count()-1]?.node===e},getNestedLayers(e){return Array.from(this.layers).slice(this.indexOf(e)+1)},getLayersByType(e){return this.layers.filter(t=>t.type===e)},getNestedLayersByType(e,t){const i=this.indexOf(e);return i===-1?[]:this.layers.slice(i+1).filter(s=>s.type===t)},getParentLayerOfType(e,t){const i=this.indexOf(e);if(!(i<=0))return this.layers.slice(0,i).reverse().find(s=>s.type===t)},countNestedLayersOfType(e,t){return this.getNestedLayersByType(e,t).length},isInNestedLayer(e,t){return this.getNestedLayers(e).some(i=>bi(i.node,t))},isInBranch(e){return Array.from(this.branches).some(t=>bi(t,e))},add(e){this.layers.push(e),this.syncLayers()},addBranch(e){this.branches.push(e)},remove(e){const t=this.indexOf(e);t<0||(t<this.count()-1&&this.getNestedLayers(e).forEach(s=>Ot.dismiss(s.node,e)),this.layers.splice(t,1),this.syncLayers())},removeBranch(e){const t=this.branches.indexOf(e);t>=0&&this.branches.splice(t,1)},syncLayers(){this.layers.forEach((e,t)=>{e.node.style.setProperty("--layer-index",`${t}`),e.node.removeAttribute("data-nested"),e.node.removeAttribute("data-has-nested"),this.getParentLayerOfType(e.node,e.type)&&e.node.setAttribute("data-nested",e.type);const s=this.countNestedLayersOfType(e.node,e.type);s>0&&e.node.setAttribute("data-has-nested",e.type),e.node.style.setProperty("--nested-layer-count",`${s}`)})},indexOf(e){return this.layers.findIndex(t=>t.node===e)},dismiss(e,t){const i=this.indexOf(e);if(i===-1)return;const s=this.layers[i];R_(e,Fo,n=>{s.requestDismiss?.(n),n.defaultPrevented||s?.dismiss()}),A_(e,Fo,{originalLayer:e,targetLayer:t,originalIndex:i,targetIndex:t?this.indexOf(t):-1}),this.syncLayers()},clear(){this.remove(this.layers[0].node)}};function A_(e,t,i){const s=e.ownerDocument.defaultView||window,n=new s.CustomEvent(t,{cancelable:!0,bubbles:!0,detail:i});return e.dispatchEvent(n)}function R_(e,t,i){e.addEventListener(t,i,{once:!0})}var zo;function Ho(){Ot.layers.forEach(({node:e})=>{e.style.pointerEvents=Ot.isBelowPointerBlockingLayer(e)?"none":"auto"})}function T_(e){e.style.pointerEvents=""}function L_(e,t){const i=Ui(e),s=[];return Ot.hasPointerBlockingLayer()&&!i.body.hasAttribute("data-inert")&&(zo=document.body.style.pointerEvents,queueMicrotask(()=>{i.body.style.pointerEvents="none",i.body.setAttribute("data-inert","")})),t?.forEach(n=>{const[o,c]=Uu(()=>{const r=n();return mt(r)?r:null},{timeout:1e3});o.then(r=>s.push(Ou(r,{pointerEvents:"auto"}))),s.push(c)}),()=>{Ot.hasPointerBlockingLayer()||(queueMicrotask(()=>{i.body.style.pointerEvents=zo,i.body.removeAttribute("data-inert"),i.body.style.length===0&&i.body.removeAttribute("style")}),s.forEach(n=>n()))}}function D_(e,t){const{warnOnMissingNode:i=!0}=t;if(i&&!e){dn("[@zag-js/dismissable] node is `null` or `undefined`");return}if(!e)return;const{onDismiss:s,onRequestDismiss:n,pointerBlocking:o,exclude:c,debug:r,type:a="dialog"}=t,u={dismiss:s,node:e,type:a,pointerBlocking:o,requestDismiss:n};Ot.add(u),Ho();function _(y){const h=Si(y.detail.originalEvent);Ot.isBelowPointerBlockingLayer(e)||Ot.isInBranch(h)||(t.onPointerDownOutside?.(y),t.onInteractOutside?.(y),!y.defaultPrevented&&(r&&console.log("onPointerDownOutside:",y.detail.originalEvent),s?.()))}function l(y){const h=Si(y.detail.originalEvent);Ot.isInBranch(h)||(t.onFocusOutside?.(y),t.onInteractOutside?.(y),!y.defaultPrevented&&(r&&console.log("onFocusOutside:",y.detail.originalEvent),s?.()))}function m(y){Ot.isTopMost(e)&&(t.onEscapeKeyDown?.(y),!y.defaultPrevented&&s&&(y.preventDefault(),s()))}function g(y){if(!e)return!1;const h=typeof c=="function"?c():c,f=Array.isArray(h)?h:[h],d=t.persistentElements?.map(p=>p()).filter(mt);return d&&f.push(...d),f.some(p=>bi(p,y))||Ot.isInNestedLayer(e,y)}const C=[o?L_(e,t.persistentElements):void 0,x_(e,m),k_(e,{exclude:g,onFocusOutside:l,onPointerDownOutside:_,defer:t.defer})];return()=>{Ot.remove(e),Ho(),T_(e),C.forEach(y=>y?.())}}function I_(e,t){const{defer:i}=t,s=i?zt:o=>o(),n=[];return n.push(s(()=>{const o=Oi(e)?e():e;n.push(D_(o,t))})),()=>{n.forEach(o=>o?.())}}const ct=Ds();var O_=Be("<div><!></div>");function P_(e,t){Fe(t,!0);const i=Ge(t,["$$slots","$$events","$$legacy"]),s=ct.consume(),n=Q(()=>t.element),o=Q(()=>t.children),c=Q(()=>Ye(i,["element","children"])),r=Q(()=>Je(s().getArrowTipProps(),{class:Ct.arrowTip},U(c)));var a=Se(),u=ye(a);{var _=m=>{var g=Se(),C=ye(g);ke(C,()=>U(n),()=>U(r)),oe(m,g)},l=m=>{var g=O_();Xe(g,()=>({...U(r)}));var C=De(g);ke(C,()=>U(o)??st),Te(g),oe(m,g)};We(u,m=>{U(n)?m(_):m(l,!1)})}oe(e,a),ze()}var M_=Be("<div><!></div>");function B_(e,t){Fe(t,!0);const i=Ge(t,["$$slots","$$events","$$legacy"]),s=ct.consume(),n=Q(()=>t.element),o=Q(()=>t.children),c=Q(()=>Ye(i,["element","children"])),r=Q(()=>Je(s().getArrowProps(),{class:Ct.arrow},U(c)));var a=Se(),u=ye(a);{var _=m=>{var g=Se(),C=ye(g);ke(C,()=>U(n),()=>U(r)),oe(m,g)},l=m=>{var g=M_();Xe(g,()=>({...U(r)}));var C=De(g);ke(C,()=>U(o)??st),Te(g),oe(m,g)};We(u,m=>{U(n)?m(_):m(l,!1)})}oe(e,a),ze()}var U_=Be("<div><!></div>");function N_(e,t){Fe(t,!0);const i=Ge(t,["$$slots","$$events","$$legacy"]),s=ct.consume(),n=Q(()=>t.element),o=Q(()=>t.children),c=Q(()=>Ye(i,["element","children"])),r=Q(()=>Je(s().getContentProps(),{class:Ct.content},U(c)));var a=Se(),u=ye(a);{var _=m=>{var g=Se(),C=ye(g);ke(C,()=>U(n),()=>U(r)),oe(m,g)},l=m=>{var g=U_();Xe(g,()=>({...U(r)}));var C=De(g);ke(C,()=>U(o)??st),Te(g),oe(m,g)};We(u,m=>{U(n)?m(_):m(l,!1)})}oe(e,a),ze()}var F_=Be("<button><!></button>");function z_(e,t){Fe(t,!0);const i=Ge(t,["$$slots","$$events","$$legacy"]),s=ct.consume(),n=Q(()=>t.element),o=Q(()=>t.children),c=Q(()=>Ye(i,["element","children"])),r=Q(()=>Je(s().getContextTriggerProps(),{class:Ct.contextTrigger},U(c)));var a=Se(),u=ye(a);{var _=m=>{var g=Se(),C=ye(g);ke(C,()=>U(n),()=>U(r)),oe(m,g)},l=m=>{var g=F_();Xe(g,()=>({...U(r)}));var C=De(g);ke(C,()=>U(o)??st),Te(g),oe(m,g)};We(u,m=>{U(n)?m(_):m(l,!1)})}oe(e,a),ze()}var H_=Be("<div><!></div>");function q_(e,t){Fe(t,!0);const i=Ge(t,["$$slots","$$events","$$legacy"]),s=ct.consume(),n=Q(()=>t.element),o=Q(()=>t.children),c=Q(()=>Ye(i,["element","children"])),r=Q(()=>Je(s().getIndicatorProps(),{class:Ct.indicator},U(c)));var a=Se(),u=ye(a);{var _=m=>{var g=Se(),C=ye(g);ke(C,()=>U(n),()=>U(r)),oe(m,g)},l=m=>{var g=H_();Xe(g,()=>({...U(r)}));var C=De(g);ke(C,()=>U(o)??st),Te(g),oe(m,g)};We(u,m=>{U(n)?m(_):m(l,!1)})}oe(e,a),ze()}const uh=Ds();var ys=(e,t)=>({x:e,y:t});function W_(e){const{x:t,y:i,width:s,height:n}=e,o=t+s/2,c=i+n/2;return{x:t,y:i,width:s,height:n,minX:t,minY:i,maxX:t+s,maxY:i+n,midX:o,midY:c,center:ys(o,c)}}function $_(e){const t=ys(e.minX,e.minY),i=ys(e.maxX,e.minY),s=ys(e.maxX,e.maxY),n=ys(e.minX,e.maxY);return{top:t,right:i,bottom:s,left:n}}function j_(e,t){const i=W_(e),{top:s,right:n,left:o,bottom:c}=$_(i),[r]=t.split("-");return{top:[o,s,n,c],right:[s,n,c,o],bottom:[s,o,c,n],left:[n,s,o,c]}[r]}function G_(e,t){const{x:i,y:s}=t;let n=!1;for(let o=0,c=e.length-1;o<e.length;c=o++){const r=e[o].x,a=e[o].y,u=e[c].x,_=e[c].y;a>s!=_>s&&i<(u-r)*(s-a)/(_-a)+r&&(n=!n)}return n}var V_=Ji("menu").parts("arrow","arrowTip","content","contextTrigger","indicator","item","itemGroup","itemGroupLabel","itemIndicator","itemText","positioner","separator","trigger","triggerItem"),wt=V_.build(),hr=e=>e.ids?.trigger??`menu:${e.id}:trigger`,dh=e=>e.ids?.contextTrigger??`menu:${e.id}:ctx-trigger`,ws=e=>e.ids?.content??`menu:${e.id}:content`,K_=e=>e.ids?.arrow??`menu:${e.id}:arrow`,_h=e=>e.ids?.positioner??`menu:${e.id}:popper`,Y_=(e,t)=>e.ids?.group?.(t)??`menu:${e.id}:group:${t}`,Ts=(e,t)=>`${e.id}/${t}`,Li=e=>e?.dataset.value??null,qo=(e,t)=>e.ids?.groupLabel?.(t)??`menu:${e.id}:group-label:${t}`,yi=e=>e.getById(ws(e)),Wo=e=>e.getById(_h(e)),js=e=>e.getById(hr(e)),X_=(e,t)=>t?e.getById(Ts(e,t)):null,zr=e=>e.getById(dh(e)),Ps=e=>{const i=`[role^="menuitem"][data-ownedby=${CSS.escape(ws(e))}]:not([data-disabled])`;return xu(yi(e),i)},J_=e=>hl(Ps(e)),Q_=e=>cl(Ps(e)),qn=(e,t)=>t?e.id===t||e.dataset.value===t:!1,Z_=(e,t)=>{const i=Ps(e),s=i.findIndex(n=>qn(n,t.value));return ll(i,s,{loop:t.loop??t.loopFocus})},ef=(e,t)=>{const i=Ps(e),s=i.findIndex(n=>qn(n,t.value));return dl(i,s,{loop:t.loop??t.loopFocus})},tf=(e,t)=>{const i=Ps(e),s=i.find(n=>qn(n,t.value));return Ya(i,{state:t.typeaheadState,key:t.key,activeId:s?.id??null})},Gs=e=>mt(e)&&(e.dataset.disabled===""||e.hasAttribute("disabled")),sf=e=>!!e?.getAttribute("role")?.startsWith("menuitem")&&!!e?.hasAttribute("aria-controls"),vn="menu:select";function rf(e,t){if(!e)return;const i=ki(e),s=new i.CustomEvent(vn,{detail:{value:t}});e.dispatchEvent(s)}function nf(e,t){const{context:i,send:s,state:n,computed:o,prop:c,scope:r}=e,a=n.hasTag("open"),u=i.get("isSubmenu"),_=o("isTypingAhead"),l=c("composite"),m=i.get("currentPlacement"),g=i.get("anchorPoint"),C=i.get("highlightedValue"),y=v_({...c("positioning"),placement:g?"bottom":m});function h(v){return{id:Ts(r,v.value),disabled:!!v.disabled,highlighted:C===v.value}}function f(v){const S=v.valueText??v.value;return{...v,id:v.value,valueText:S}}function d(v){return{...h(f(v)),checked:!!v.checked}}function p(v){const{closeOnSelect:S,valueText:w,value:E}=v,b=h(v),k=Ts(r,E);return t.element({...wt.item.attrs,id:k,role:"menuitem","aria-disabled":Ol(b.disabled),"data-disabled":Wi(b.disabled),"data-ownedby":ws(r),"data-highlighted":Wi(b.highlighted),"data-value":E,"data-valuetext":w,onDragStart(R){R.currentTarget.matches("a[href]")&&R.preventDefault()},onPointerMove(R){if(b.disabled||R.pointerType!=="mouse")return;const I=R.currentTarget;b.highlighted||s({type:"ITEM_POINTERMOVE",id:k,target:I,closeOnSelect:S})},onPointerLeave(R){if(b.disabled||R.pointerType!=="mouse"||!e.event.previous()?.type.includes("POINTER"))return;const P=R.currentTarget;s({type:"ITEM_POINTERLEAVE",id:k,target:P,closeOnSelect:S})},onPointerDown(R){if(b.disabled)return;const I=R.currentTarget;s({type:"ITEM_POINTERDOWN",target:I,id:k,closeOnSelect:S})},onClick(R){if(go(R)||mo(R)||b.disabled)return;const I=R.currentTarget;s({type:"ITEM_CLICK",target:I,id:k,closeOnSelect:S})}})}return{highlightedValue:C,open:a,setOpen(v){n.hasTag("open")!==v&&s({type:v?"OPEN":"CLOSE"})},setHighlightedValue(v){s({type:"HIGHLIGHTED.SET",value:v})},setParent(v){s({type:"PARENT.SET",value:v,id:v.prop("id")})},setChild(v){s({type:"CHILD.SET",value:v,id:v.prop("id")})},reposition(v={}){s({type:"POSITIONING.SET",options:v})},addItemListener(v){const S=r.getById(v.id);if(!S)return;const w=()=>v.onSelect?.();return S.addEventListener(vn,w),()=>S.removeEventListener(vn,w)},getContextTriggerProps(){return t.element({...wt.contextTrigger.attrs,dir:c("dir"),id:dh(r),"data-state":a?"open":"closed",onPointerDown(v){if(v.pointerType==="mouse")return;const S=Ws(v);s({type:"CONTEXT_MENU_START",point:S})},onPointerCancel(v){v.pointerType!=="mouse"&&s({type:"CONTEXT_MENU_CANCEL"})},onPointerMove(v){v.pointerType!=="mouse"&&s({type:"CONTEXT_MENU_CANCEL"})},onPointerUp(v){v.pointerType!=="mouse"&&s({type:"CONTEXT_MENU_CANCEL"})},onContextMenu(v){const S=Ws(v);s({type:"CONTEXT_MENU",point:S}),v.preventDefault()},style:{WebkitTouchCallout:"none",WebkitUserSelect:"none",userSelect:"none"}})},getTriggerItemProps(v){const S=v.getTriggerProps();return Xa(p({value:S.id}),S)},getTriggerProps(){return t.button({...u?wt.triggerItem.attrs:wt.trigger.attrs,"data-placement":i.get("currentPlacement"),type:"button",dir:c("dir"),id:hr(r),"data-uid":c("id"),"aria-haspopup":l?"menu":"dialog","aria-controls":ws(r),"aria-expanded":a||void 0,"data-state":a?"open":"closed",onPointerMove(v){if(v.pointerType!=="mouse"||Gs(v.currentTarget)||!u)return;const w=Ws(v);s({type:"TRIGGER_POINTERMOVE",target:v.currentTarget,point:w})},onPointerLeave(v){if(Gs(v.currentTarget)||v.pointerType!=="mouse"||!u)return;const S=Ws(v);s({type:"TRIGGER_POINTERLEAVE",target:v.currentTarget,point:S})},onPointerDown(v){Gs(v.currentTarget)||Ga(v)||v.preventDefault()},onClick(v){v.defaultPrevented||Gs(v.currentTarget)||s({type:"TRIGGER_CLICK",target:v.currentTarget})},onBlur(){s({type:"TRIGGER_BLUR"})},onFocus(){s({type:"TRIGGER_FOCUS"})},onKeyDown(v){if(v.defaultPrevented)return;const S={ArrowDown(){s({type:"ARROW_DOWN"})},ArrowUp(){s({type:"ARROW_UP"})},Enter(){s({type:"ARROW_DOWN",src:"enter"})},Space(){s({type:"ARROW_DOWN",src:"space"})}},w=yo(v,{orientation:"vertical",dir:c("dir")}),E=S[w];E&&(v.preventDefault(),E(v))}})},getIndicatorProps(){return t.element({...wt.indicator.attrs,dir:c("dir"),"data-state":a?"open":"closed"})},getPositionerProps(){return t.element({...wt.positioner.attrs,dir:c("dir"),id:_h(r),style:y.floating})},getArrowProps(){return t.element({id:K_(r),...wt.arrow.attrs,dir:c("dir"),style:y.arrow})},getArrowTipProps(){return t.element({...wt.arrowTip.attrs,dir:c("dir"),style:y.arrowTip})},getContentProps(){return t.element({...wt.content.attrs,id:ws(r),"aria-label":c("aria-label"),hidden:!a,"data-state":a?"open":"closed",role:l?"menu":"dialog",tabIndex:0,dir:c("dir"),"aria-activedescendant":o("highlightedId")||void 0,"aria-labelledby":hr(r),"data-placement":m,onPointerEnter(v){v.pointerType==="mouse"&&s({type:"MENU_POINTERENTER"})},onKeyDown(v){if(v.defaultPrevented||!bi(v.currentTarget,Si(v)))return;const S=Si(v);if(!(S?.closest("[role=menu]")===v.currentTarget||S===v.currentTarget))return;if(v.key==="Tab"&&!mu(v)){v.preventDefault();return}const E={ArrowDown(){s({type:"ARROW_DOWN"})},ArrowUp(){s({type:"ARROW_UP"})},ArrowLeft(){s({type:"ARROW_LEFT"})},ArrowRight(){s({type:"ARROW_RIGHT"})},Enter(){s({type:"ENTER"})},Space(R){_?s({type:"TYPEAHEAD",key:R.key}):E.Enter?.(R)},Home(){s({type:"HOME"})},End(){s({type:"END"})}},b=yo(v,{dir:c("dir")}),k=E[b];if(k){k(v),v.stopPropagation(),v.preventDefault();return}c("typeahead")&&nu(v)&&(ou(v)||Wa(S)||(s({type:"TYPEAHEAD",key:v.key}),v.preventDefault()))}})},getSeparatorProps(){return t.element({...wt.separator.attrs,role:"separator",dir:c("dir"),"aria-orientation":"horizontal"})},getItemState:h,getItemProps:p,getOptionItemState:d,getOptionItemProps(v){const{type:S,disabled:w,closeOnSelect:E}=v,b=f(v),k=d(v);return{...p(b),...t.element({"data-type":S,...wt.item.attrs,dir:c("dir"),"data-value":b.value,role:`menuitem${S}`,"aria-checked":!!k.checked,"data-state":k.checked?"checked":"unchecked",onClick(R){if(w||go(R)||mo(R))return;const I=R.currentTarget;s({type:"ITEM_CLICK",target:I,option:b,closeOnSelect:E})}})}},getItemIndicatorProps(v){const S=d(fo(v)),w=S.checked?"checked":"unchecked";return t.element({...wt.itemIndicator.attrs,dir:c("dir"),"data-disabled":Wi(S.disabled),"data-highlighted":Wi(S.highlighted),"data-state":er(v,"checked")?w:void 0,hidden:er(v,"checked")?!S.checked:void 0})},getItemTextProps(v){const S=d(fo(v)),w=S.checked?"checked":"unchecked";return t.element({...wt.itemText.attrs,dir:c("dir"),"data-disabled":Wi(S.disabled),"data-highlighted":Wi(S.highlighted),"data-state":er(v,"checked")?w:void 0})},getItemGroupLabelProps(v){return t.element({...wt.itemGroupLabel.attrs,id:qo(r,v.htmlFor),dir:c("dir")})},getItemGroupProps(v){return t.element({id:Y_(r,v.id),...wt.itemGroup.attrs,dir:c("dir"),"aria-labelledby":qo(r,v.id),role:"group"})}}}var{not:It,and:ji,or:of}=qu(),af={props({props:e}){return{closeOnSelect:!0,typeahead:!0,composite:!0,loopFocus:!1,navigate(t){wu(t.node)},...e,positioning:{placement:"bottom-start",gutter:8,...e.positioning}}},initialState({prop:e}){return e("open")||e("defaultOpen")?"open":"idle"},context({bindable:e,prop:t}){return{suspendPointer:e(()=>({defaultValue:!1})),highlightedValue:e(()=>({defaultValue:t("defaultHighlightedValue")||null,value:t("highlightedValue"),onChange(i){t("onHighlightChange")?.({highlightedValue:i})}})),lastHighlightedValue:e(()=>({defaultValue:null})),currentPlacement:e(()=>({defaultValue:void 0})),intentPolygon:e(()=>({defaultValue:null})),anchorPoint:e(()=>({defaultValue:null,hash(i){return`x: ${i?.x}, y: ${i?.y}`}})),isSubmenu:e(()=>({defaultValue:!1}))}},refs(){return{parent:null,children:{},typeaheadState:{...Ya.defaultOptions},positioningOverride:{}}},computed:{isRtl:({prop:e})=>e("dir")==="rtl",isTypingAhead:({refs:e})=>e.get("typeaheadState").keysSoFar!=="",highlightedId:({context:e,scope:t,refs:i})=>cf(i.get("children"),e.get("highlightedValue"),t)},watch({track:e,action:t,context:i,prop:s}){e([()=>i.get("isSubmenu")],()=>{t(["setSubmenuPlacement"])}),e([()=>i.hash("anchorPoint")],()=>{i.get("anchorPoint")&&t(["reposition"])}),e([()=>s("open")],()=>{t(["toggleVisibility"])})},on:{"PARENT.SET":{actions:["setParentMenu"]},"CHILD.SET":{actions:["setChildMenu"]},OPEN:[{guard:"isOpenControlled",actions:["invokeOnOpen"]},{target:"open",actions:["invokeOnOpen"]}],OPEN_AUTOFOCUS:[{guard:"isOpenControlled",actions:["invokeOnOpen"]},{target:"open",actions:["highlightFirstItem","invokeOnOpen"]}],CLOSE:[{guard:"isOpenControlled",actions:["invokeOnClose"]},{target:"closed",actions:["invokeOnClose"]}],"HIGHLIGHTED.RESTORE":{actions:["restoreHighlightedItem"]},"HIGHLIGHTED.SET":{actions:["setHighlightedItem"]}},states:{idle:{tags:["closed"],on:{"CONTROLLED.OPEN":{target:"open"},"CONTROLLED.CLOSE":{target:"closed"},CONTEXT_MENU_START:{target:"opening:contextmenu",actions:["setAnchorPoint"]},CONTEXT_MENU:[{guard:"isOpenControlled",actions:["setAnchorPoint","invokeOnOpen"]},{target:"open",actions:["setAnchorPoint","invokeOnOpen"]}],TRIGGER_CLICK:[{guard:"isOpenControlled",actions:["invokeOnOpen"]},{target:"open",actions:["invokeOnOpen"]}],TRIGGER_FOCUS:{guard:It("isSubmenu"),target:"closed"},TRIGGER_POINTERMOVE:{guard:"isSubmenu",target:"opening"}}},"opening:contextmenu":{tags:["closed"],effects:["waitForLongPress"],on:{"CONTROLLED.OPEN":{target:"open"},"CONTROLLED.CLOSE":{target:"closed"},CONTEXT_MENU_CANCEL:[{guard:"isOpenControlled",actions:["invokeOnClose"]},{target:"closed",actions:["invokeOnClose"]}],"LONG_PRESS.OPEN":[{guard:"isOpenControlled",actions:["invokeOnOpen"]},{target:"open",actions:["invokeOnOpen"]}]}},opening:{tags:["closed"],effects:["waitForOpenDelay"],on:{"CONTROLLED.OPEN":{target:"open"},"CONTROLLED.CLOSE":{target:"closed"},BLUR:[{guard:"isOpenControlled",actions:["invokeOnClose"]},{target:"closed",actions:["invokeOnClose"]}],TRIGGER_POINTERLEAVE:[{guard:"isOpenControlled",actions:["invokeOnClose"]},{target:"closed",actions:["invokeOnClose"]}],"DELAY.OPEN":[{guard:"isOpenControlled",actions:["invokeOnOpen"]},{target:"open",actions:["invokeOnOpen"]}]}},closing:{tags:["open"],effects:["trackPointerMove","trackInteractOutside","waitForCloseDelay"],on:{"CONTROLLED.OPEN":{target:"open"},"CONTROLLED.CLOSE":{target:"closed",actions:["focusParentMenu","restoreParentHighlightedItem"]},MENU_POINTERENTER:{target:"open",actions:["clearIntentPolygon"]},POINTER_MOVED_AWAY_FROM_SUBMENU:[{guard:"isOpenControlled",actions:["invokeOnClose"]},{target:"closed",actions:["focusParentMenu","restoreParentHighlightedItem"]}],"DELAY.CLOSE":[{guard:"isOpenControlled",actions:["invokeOnClose"]},{target:"closed",actions:["focusParentMenu","restoreParentHighlightedItem","invokeOnClose"]}]}},closed:{tags:["closed"],entry:["clearHighlightedItem","focusTrigger","resumePointer","clearAnchorPoint"],on:{"CONTROLLED.OPEN":[{guard:of("isOpenAutoFocusEvent","isArrowDownEvent"),target:"open",actions:["highlightFirstItem"]},{guard:"isArrowUpEvent",target:"open",actions:["highlightLastItem"]},{target:"open"}],CONTEXT_MENU_START:{target:"opening:contextmenu",actions:["setAnchorPoint"]},CONTEXT_MENU:[{guard:"isOpenControlled",actions:["setAnchorPoint","invokeOnOpen"]},{target:"open",actions:["setAnchorPoint","invokeOnOpen"]}],TRIGGER_CLICK:[{guard:"isOpenControlled",actions:["invokeOnOpen"]},{target:"open",actions:["invokeOnOpen"]}],TRIGGER_POINTERMOVE:{guard:"isTriggerItem",target:"opening"},TRIGGER_BLUR:{target:"idle"},ARROW_DOWN:[{guard:"isOpenControlled",actions:["invokeOnOpen"]},{target:"open",actions:["highlightFirstItem","invokeOnOpen"]}],ARROW_UP:[{guard:"isOpenControlled",actions:["invokeOnOpen"]},{target:"open",actions:["highlightLastItem","invokeOnOpen"]}]}},open:{tags:["open"],effects:["trackInteractOutside","trackPositioning","scrollToHighlightedItem"],entry:["focusMenu","resumePointer"],on:{"CONTROLLED.CLOSE":[{target:"closed",guard:"isArrowLeftEvent",actions:["focusParentMenu"]},{target:"closed"}],TRIGGER_CLICK:[{guard:ji(It("isTriggerItem"),"isOpenControlled"),actions:["invokeOnClose"]},{guard:It("isTriggerItem"),target:"closed",actions:["invokeOnClose"]}],CONTEXT_MENU:{actions:["setAnchorPoint","focusMenu"]},ARROW_UP:{actions:["highlightPrevItem","focusMenu"]},ARROW_DOWN:{actions:["highlightNextItem","focusMenu"]},ARROW_LEFT:[{guard:ji("isSubmenu","isOpenControlled"),actions:["invokeOnClose"]},{guard:"isSubmenu",target:"closed",actions:["focusParentMenu","invokeOnClose"]}],HOME:{actions:["highlightFirstItem","focusMenu"]},END:{actions:["highlightLastItem","focusMenu"]},ARROW_RIGHT:{guard:"isTriggerItemHighlighted",actions:["openSubmenu"]},ENTER:[{guard:"isTriggerItemHighlighted",actions:["openSubmenu"]},{actions:["clickHighlightedItem"]}],ITEM_POINTERMOVE:[{guard:It("isPointerSuspended"),actions:["setHighlightedItem","focusMenu"]},{actions:["setLastHighlightedItem"]}],ITEM_POINTERLEAVE:{guard:ji(It("isPointerSuspended"),It("isTriggerItem")),actions:["clearHighlightedItem"]},ITEM_CLICK:[{guard:ji(It("isTriggerItemHighlighted"),It("isHighlightedItemEditable"),"closeOnSelect","isOpenControlled"),actions:["invokeOnSelect","setOptionState","closeRootMenu","invokeOnClose"]},{guard:ji(It("isTriggerItemHighlighted"),It("isHighlightedItemEditable"),"closeOnSelect"),target:"closed",actions:["invokeOnSelect","setOptionState","closeRootMenu","invokeOnClose"]},{guard:ji(It("isTriggerItemHighlighted"),It("isHighlightedItemEditable")),actions:["invokeOnSelect","setOptionState"]},{actions:["setHighlightedItem"]}],TRIGGER_POINTERMOVE:{guard:"isTriggerItem",actions:["setIntentPolygon"]},TRIGGER_POINTERLEAVE:{target:"closing"},ITEM_POINTERDOWN:{actions:["setHighlightedItem"]},TYPEAHEAD:{actions:["highlightMatchedItem"]},FOCUS_MENU:{actions:["focusMenu"]},"POSITIONING.SET":{actions:["reposition"]}}}},implementations:{guards:{closeOnSelect:({prop:e,event:t})=>!!(t?.closeOnSelect??e("closeOnSelect")),isTriggerItem:({event:e})=>sf(e.target),isTriggerItemHighlighted:({event:e,scope:t,computed:i})=>!!(e.target??t.getById(i("highlightedId")))?.hasAttribute("aria-controls"),isSubmenu:({context:e})=>e.get("isSubmenu"),isPointerSuspended:({context:e})=>e.get("suspendPointer"),isHighlightedItemEditable:({scope:e,computed:t})=>Wa(e.getById(t("highlightedId"))),isOpenControlled:({prop:e})=>e("open")!==void 0,isArrowLeftEvent:({event:e})=>e.previousEvent?.type==="ARROW_LEFT",isArrowUpEvent:({event:e})=>e.previousEvent?.type==="ARROW_UP",isArrowDownEvent:({event:e})=>e.previousEvent?.type==="ARROW_DOWN",isOpenAutoFocusEvent:({event:e})=>e.previousEvent?.type==="OPEN_AUTOFOCUS"},effects:{waitForOpenDelay({send:e}){const t=setTimeout(()=>{e({type:"DELAY.OPEN"})},100);return()=>clearTimeout(t)},waitForCloseDelay({send:e}){const t=setTimeout(()=>{e({type:"DELAY.CLOSE"})},300);return()=>clearTimeout(t)},waitForLongPress({send:e}){const t=setTimeout(()=>{e({type:"LONG_PRESS.OPEN"})},700);return()=>clearTimeout(t)},trackPositioning({context:e,prop:t,scope:i,refs:s}){if(zr(i))return;const n={...t("positioning"),...s.get("positioningOverride")};e.set("currentPlacement",n.placement);const o=()=>Wo(i);return Po(js(i),o,{...n,defer:!0,onComplete(c){e.set("currentPlacement",c.placement)}})},trackInteractOutside({refs:e,scope:t,prop:i,context:s,send:n}){const o=()=>yi(t);let c=!0;return I_(o,{type:"menu",defer:!0,exclude:[js(t)],onInteractOutside:i("onInteractOutside"),onRequestDismiss:i("onRequestDismiss"),onFocusOutside(r){i("onFocusOutside")?.(r);const a=Si(r.detail.originalEvent);if(bi(zr(t),a)){r.preventDefault();return}},onEscapeKeyDown(r){i("onEscapeKeyDown")?.(r),s.get("isSubmenu")&&r.preventDefault(),$o({parent:e.get("parent")})},onPointerDownOutside(r){i("onPointerDownOutside")?.(r);const a=Si(r.detail.originalEvent);if(bi(zr(t),a)&&r.detail.contextmenu){r.preventDefault();return}c=!r.detail.focusable},onDismiss(){n({type:"CLOSE",src:"interact-outside",restoreFocus:c})}})},trackPointerMove({context:e,scope:t,send:i,refs:s,flush:n}){const o=s.get("parent");n(()=>{o.context.set("suspendPointer",!0)});const c=t.getDoc();return bs(c,"pointermove",r=>{hf(e.get("intentPolygon"),{x:r.clientX,y:r.clientY})||(i({type:"POINTER_MOVED_AWAY_FROM_SUBMENU"}),o.context.set("suspendPointer",!1))})},scrollToHighlightedItem({event:e,scope:t,computed:i}){const s=()=>{if(e.current().type.startsWith("ITEM_POINTER"))return;const o=t.getById(i("highlightedId")),c=yi(t);ku(o,{rootEl:c,block:"nearest"})};return zt(()=>s()),bu(()=>yi(t),{attributes:["aria-activedescendant"],callback:s})}},actions:{setAnchorPoint({context:e,event:t}){e.set("anchorPoint",i=>Is(i,t.point)?i:t.point)},setSubmenuPlacement({context:e,computed:t,refs:i}){if(!e.get("isSubmenu"))return;const s=t("isRtl")?"left-start":"right-start";i.set("positioningOverride",{placement:s,gutter:0})},reposition({context:e,scope:t,prop:i,event:s,refs:n}){const o=()=>Wo(t),c=e.get("anchorPoint"),r=c?()=>({width:0,height:0,...c}):void 0,a={...i("positioning"),...n.get("positioningOverride")};Po(js(t),o,{...a,defer:!0,getAnchorRect:r,...s.options??{},listeners:!1,onComplete(u){e.set("currentPlacement",u.placement)}})},setOptionState({event:e}){if(!e.option)return;const{checked:t,onCheckedChange:i,type:s}=e.option;s==="radio"?i?.(!0):s==="checkbox"&&i?.(!t)},clickHighlightedItem({scope:e,computed:t,prop:i,context:s}){const n=e.getById(t("highlightedId"));if(!n||n.dataset.disabled)return;const o=s.get("highlightedValue");Hl(n)?i("navigate")?.({value:o,node:n,href:n.href}):queueMicrotask(()=>n.click())},setIntentPolygon({context:e,scope:t,event:i}){const s=yi(t),n=e.get("currentPlacement");if(!s||!n)return;const o=s.getBoundingClientRect(),c=j_(o,n);if(!c)return;const a=a_(n)==="right"?-5:5;e.set("intentPolygon",[{...i.point,x:i.point.x+a},...c])},clearIntentPolygon({context:e}){e.set("intentPolygon",null)},clearAnchorPoint({context:e}){e.set("anchorPoint",null)},resumePointer({refs:e,flush:t}){const i=e.get("parent");i&&t(()=>{i.context.set("suspendPointer",!1)})},setHighlightedItem({context:e,event:t}){const i=t.value||Li(t.target);e.set("highlightedValue",i)},clearHighlightedItem({context:e}){e.set("highlightedValue",null)},focusMenu({scope:e}){zt(()=>{const t=yi(e);pu({root:t,enabled:!bi(t,e.getActiveElement()),filter(s){return!s.role?.startsWith("menuitem")}})?.focus({preventScroll:!0})})},highlightFirstItem({context:e,scope:t}){(yi(t)?queueMicrotask:zt)(()=>{const s=J_(t);s&&e.set("highlightedValue",Li(s))})},highlightLastItem({context:e,scope:t}){(yi(t)?queueMicrotask:zt)(()=>{const s=Q_(t);s&&e.set("highlightedValue",Li(s))})},highlightNextItem({context:e,scope:t,event:i,prop:s}){const n=Z_(t,{loop:i.loop,value:e.get("highlightedValue"),loopFocus:s("loopFocus")});e.set("highlightedValue",Li(n))},highlightPrevItem({context:e,scope:t,event:i,prop:s}){const n=ef(t,{loop:i.loop,value:e.get("highlightedValue"),loopFocus:s("loopFocus")});e.set("highlightedValue",Li(n))},invokeOnSelect({context:e,prop:t,scope:i}){const s=e.get("highlightedValue");if(s==null)return;const n=X_(i,s);rf(n,s),t("onSelect")?.({value:s})},focusTrigger({scope:e,context:t,event:i}){t.get("isSubmenu")||t.get("anchorPoint")||i.restoreFocus===!1||queueMicrotask(()=>js(e)?.focus({preventScroll:!0}))},highlightMatchedItem({scope:e,context:t,event:i,refs:s}){const n=tf(e,{key:i.key,value:t.get("highlightedValue"),typeaheadState:s.get("typeaheadState")});n&&t.set("highlightedValue",Li(n))},setParentMenu({refs:e,event:t,context:i}){e.set("parent",t.value),i.set("isSubmenu",!0)},setChildMenu({refs:e,event:t}){const i=e.get("children");i[t.id]=t.value,e.set("children",i)},closeRootMenu({refs:e}){$o({parent:e.get("parent")})},openSubmenu({refs:e,scope:t,computed:i}){const n=t.getById(i("highlightedId"))?.getAttribute("data-uid"),o=e.get("children");(n?o[n]:null)?.send({type:"OPEN_AUTOFOCUS"})},focusParentMenu({refs:e}){e.get("parent")?.send({type:"FOCUS_MENU"})},setLastHighlightedItem({context:e,event:t}){e.set("lastHighlightedValue",Li(t.target))},restoreHighlightedItem({context:e}){e.get("lastHighlightedValue")&&(e.set("highlightedValue",e.get("lastHighlightedValue")),e.set("lastHighlightedValue",null))},restoreParentHighlightedItem({refs:e}){e.get("parent")?.send({type:"HIGHLIGHTED.RESTORE"})},invokeOnOpen({prop:e}){e("onOpenChange")?.({open:!0})},invokeOnClose({prop:e}){e("onOpenChange")?.({open:!1})},toggleVisibility({prop:e,event:t,send:i}){i({type:e("open")?"CONTROLLED.OPEN":"CONTROLLED.CLOSE",previousEvent:t})}}}};function $o(e){let t=e.parent;for(;t&&t.context.get("isSubmenu");)t=t.refs.get("parent");t?.send({type:"CLOSE"})}function hf(e,t){return e?G_(e,t):!1}function cf(e,t,i){const s=Object.keys(e).length>0;if(!t)return null;if(!s)return Ts(i,t);for(const n in e){const o=e[n],c=hr(o.scope);if(c===t)return c}return Ts(i,t)}var lf=rs()(["anchorPoint","aria-label","closeOnSelect","composite","defaultHighlightedValue","defaultOpen","dir","getRootNode","highlightedValue","id","ids","loopFocus","navigate","onEscapeKeyDown","onFocusOutside","onHighlightChange","onInteractOutside","onOpenChange","onPointerDownOutside","onRequestDismiss","onSelect","open","positioning","typeahead"]),uf=ss(lf),df=rs()(["closeOnSelect","disabled","value","valueText"]),fh=ss(df),_f=rs()(["htmlFor"]),ff=ss(_f),pf=rs()(["id"]),mf=ss(pf),gf=rs()(["checked","closeOnSelect","disabled","onCheckedChange","type","value","valueText"]),vf=ss(gf),yf=Be("<div><!></div>");function bf(e,t){Fe(t,!0);const i=Ge(t,["$$slots","$$events","$$legacy"]),s=ct.consume(),n=uh.consume(),o=Q(()=>ff({htmlFor:n().id,...i})),c=Q(()=>Bi(U(o),2)),r=Q(()=>U(c)[0]),a=Q(()=>U(c)[1]),u=Q(()=>U(a).element),_=Q(()=>U(a).children),l=Q(()=>Ye(U(a),["element","children"])),m=Q(()=>Je(s().getItemGroupLabelProps(U(r)),{class:Ct.itemGroupLabel},U(l)));var g=Se(),C=ye(g);{var y=f=>{var d=Se(),p=ye(d);ke(p,()=>U(u),()=>U(m)),oe(f,d)},h=f=>{var d=yf();Xe(d,()=>({...U(m)}));var p=De(d);ke(p,()=>U(_)??st),Te(d),oe(f,d)};We(C,f=>{U(u)?f(y):f(h,!1)})}oe(e,g),ze()}var wf=Be("<div><!></div>");function Sf(e,t){const i=kn();Fe(t,!0);const s=Ge(t,["$$slots","$$events","$$legacy"]),n=ct.consume(),o=Q(()=>mf({id:i,...s})),c=Q(()=>Bi(U(o),2)),r=Q(()=>U(c)[0]),a=Q(()=>U(c)[1]),u=Q(()=>U(a).element),_=Q(()=>U(a).children),l=Q(()=>Ye(U(a),["element","children"])),m=Q(()=>Je(n().getItemGroupProps(U(r)),{class:Ct.itemGroup},U(l)));uh.provide(()=>U(r));var g=Se(),C=ye(g);{var y=f=>{var d=Se(),p=ye(d);ke(p,()=>U(u),()=>U(m)),oe(f,d)},h=f=>{var d=wf();Xe(d,()=>({...U(m)}));var p=De(d);ke(p,()=>U(_)??st),Te(d),oe(f,d)};We(C,f=>{U(u)?f(y):f(h,!1)})}oe(e,g),ze()}const Ms=Ds();var Cf=Be("<div><!></div>");function Ef(e,t){Fe(t,!0);const i=Ge(t,["$$slots","$$events","$$legacy"]),s=ct.consume(),n=Ms.consume(),o=Q(()=>t.element),c=Q(()=>t.children),r=Q(()=>Ye(i,["element","children"])),a=Q(()=>Je(s().getItemIndicatorProps(n()),{class:Ct.itemIndicator},U(r)));var u=Se(),_=ye(u);{var l=g=>{var C=Se(),y=ye(C);ke(y,()=>U(o),()=>U(a)),oe(g,C)},m=g=>{var C=Cf();Xe(C,()=>({...U(a)}));var y=De(C);ke(y,()=>U(c)??st),Te(C),oe(g,C)};We(_,g=>{U(o)?g(l):g(m,!1)})}oe(e,u),ze()}var kf=Be("<div><!></div>");function xf(e,t){Fe(t,!0);const i=Ge(t,["$$slots","$$events","$$legacy"]),s=ct.consume(),n=Ms.consume(),o=Q(()=>t.element),c=Q(()=>t.children),r=Q(()=>Ye(i,["element","children"])),a=Q(()=>Je(s().getItemTextProps(n()),{class:Ct.itemText},U(r)));var u=Se(),_=ye(u);{var l=g=>{var C=Se(),y=ye(C);ke(y,()=>U(o),()=>U(a)),oe(g,C)},m=g=>{var C=kf();Xe(C,()=>({...U(a)}));var y=De(C);ke(y,()=>U(c)??st),Te(C),oe(g,C)};We(_,g=>{U(o)?g(l):g(m,!1)})}oe(e,u),ze()}var Af=Be("<div><!></div>");function Rf(e,t){Fe(t,!0);const i=Ge(t,["$$slots","$$events","$$legacy"]),s=ct.consume(),n=Q(()=>fh(i)),o=Q(()=>Bi(U(n),2)),c=Q(()=>U(o)[0]),r=Q(()=>U(o)[1]),a=Q(()=>U(r).element),u=Q(()=>U(r).children),_=Q(()=>Ye(U(r),["element","children"])),l=Q(()=>Je(s().getItemProps(U(c)),{class:Ct.item},U(_)));Ms.provide(()=>U(c));var m=Se(),g=ye(m);{var C=h=>{var f=Se(),d=ye(f);ke(d,()=>U(a),()=>U(l)),oe(h,f)},y=h=>{var f=Af();Xe(f,()=>({...U(l)}));var d=De(f);ke(d,()=>U(u)??st),Te(f),oe(h,f)};We(g,h=>{U(a)?h(C):h(y,!1)})}oe(e,m),ze()}var Tf=Be("<div><!></div>");function Lf(e,t){Fe(t,!0);const i=Ge(t,["$$slots","$$events","$$legacy"]),s=ct.consume(),n=Q(()=>vf(i)),o=Q(()=>Bi(U(n),2)),c=Q(()=>U(o)[0]),r=Q(()=>U(o)[1]),a=Q(()=>U(r).element),u=Q(()=>U(r).children),_=Q(()=>Ye(U(r),["element","children"])),l=Q(()=>Je(s().getOptionItemProps(U(c)),{class:Ct.item},U(_)));Ms.provide(()=>U(c));var m=Se(),g=ye(m);{var C=h=>{var f=Se(),d=ye(f);ke(d,()=>U(a),()=>U(l)),oe(h,f)},y=h=>{var f=Tf();Xe(f,()=>({...U(l)}));var d=De(f);ke(d,()=>U(u)??st),Te(f),oe(h,f)};We(g,h=>{U(a)?h(C):h(y,!1)})}oe(e,m),ze()}var Df=Be("<div><!></div>");function If(e,t){Fe(t,!0);const i=Ge(t,["$$slots","$$events","$$legacy"]),s=ct.consume(),n=Q(()=>t.element),o=Q(()=>t.children),c=Q(()=>Ye(i,["element","children"])),r=Q(()=>Je(s().getPositionerProps(),{class:Ct.positioner},U(c)));var a=Se(),u=ye(a);{var _=m=>{var g=Se(),C=ye(g);ke(C,()=>U(n),()=>U(r)),oe(m,g)},l=m=>{var g=Df();Xe(g,()=>({...U(r)}));var C=De(g);ke(C,()=>U(o)??st),Te(g),oe(m,g)};We(u,m=>{U(n)?m(_):m(l,!1)})}oe(e,a),ze()}function Of(e,t){Fe(t,!0);const i=ct.consume(),s=Q(()=>t.children);var n=Se(),o=ye(n);ke(o,()=>U(s),()=>i),oe(e,n),ze()}const Wn=Ds();function Pf(e,t){Fe(t,!0);const i=ct.consume(),s=Q(()=>t.children),n=Q(()=>t.value);xn(()=>ft(()=>{i&&(U(n)().setParent(i().service),i().setChild(U(n)().service))})),ct.provide(()=>U(n)()),Wn.provide(()=>i?.().getTriggerItemProps(U(n)()));var o=Se(),c=ye(o);ke(c,()=>U(s)??st),oe(e,o),ze()}function Mf(e){const t=Za(af,e),i=Q(()=>nf(t,Qa));return()=>({...U(i),get service(){return t}})}function Bf(e,t){const i=kn();Fe(t,!0);const s=Ge(t,["$$slots","$$events","$$legacy"]),n=ct.consume(),o=Q(()=>uf(s)),c=Q(()=>Bi(U(o),2)),r=Q(()=>U(c)[0]),a=Q(()=>U(c)[1]),u=Q(()=>U(a).children),_=Mf(()=>({...U(r),id:i}));xn(()=>ft(()=>{n&&(_().setParent(n().service),n().setChild(_().service))})),ct.provide(()=>_()),Wn.provide(()=>n?.().getTriggerItemProps(_()));var l=Se(),m=ye(l);ke(m,()=>U(u)??st),oe(e,l),ze()}var Uf=Be("<hr/>");function Nf(e,t){Fe(t,!0);const i=Ge(t,["$$slots","$$events","$$legacy"]),s=ct.consume(),n=Q(()=>t.element),o=Q(()=>Ye(i,["element"])),c=Q(()=>Je(s().getSeparatorProps(),{class:Ct.separator},U(o)));var r=Se(),a=ye(r);{var u=l=>{var m=Se(),g=ye(m);ke(g,()=>U(n),()=>U(c)),oe(l,m)},_=l=>{var m=Uf();Xe(m,()=>({...U(c)})),oe(l,m)};We(a,l=>{U(n)?l(u):l(_,!1)})}oe(e,r),ze()}var Ff=Be("<div><!></div>");function zf(e,t){Fe(t,!0);const i=Ge(t,["$$slots","$$events","$$legacy"]),s=Wn.consume(),n=Q(()=>fh(i)),o=Q(()=>Bi(U(n),2)),c=Q(()=>U(o)[0]),r=Q(()=>U(o)[1]),a=Q(()=>U(r).element),u=Q(()=>U(r).children),_=Q(()=>Ye(U(r),["element","children"])),l=Q(()=>Je(s(),{class:Ct.item},U(_)));Ms.provide(()=>U(c));var m=Se(),g=ye(m);{var C=h=>{var f=Se(),d=ye(f);ke(d,()=>U(a),()=>U(l)),oe(h,f)},y=h=>{var f=Ff();Xe(f,()=>({...U(l)}));var d=De(f);ke(d,()=>U(u)??st),Te(f),oe(h,f)};We(g,h=>{U(a)?h(C):h(y,!1)})}oe(e,m),ze()}var Hf=Be("<button><!></button>");function qf(e,t){Fe(t,!0);const i=Ge(t,["$$slots","$$events","$$legacy"]),s=ct.consume(),n=Q(()=>t.element),o=Q(()=>t.children),c=Q(()=>Ye(i,["element","children"])),r=Q(()=>Je(s().getTriggerProps(),{class:Ct.trigger},U(c)));var a=Se(),u=ye(a);{var _=m=>{var g=Se(),C=ye(g);ke(C,()=>U(n),()=>U(r)),oe(m,g)},l=m=>{var g=Hf();Xe(g,()=>({...U(r)}));var C=De(g);ke(C,()=>U(o)??st),Te(g),oe(m,g)};We(u,m=>{U(n)?m(_):m(l,!1)})}oe(e,a),ze()}const Vt=Object.assign(Bf,{Provider:Pf,Context:Of,Trigger:qf,ContextTrigger:z_,Indicator:q_,Positioner:If,Content:N_,ItemGroup:Sf,ItemGroupLabel:bf,Item:Rf,OptionItem:Lf,TriggerItem:zf,ItemText:xf,ItemIndicator:Ef,Separator:Nf,Arrow:B_,ArrowTip:P_}),ti=Ds();var Wf=cr("<circle></circle>");function $f(e,t){Fe(t,!0);const i=Ge(t,["$$slots","$$events","$$legacy"]),s=ti.consume(),n=Q(()=>t.element),o=Q(()=>Ye(i,["element"])),c=Q(()=>Je(s().getCircleRangeProps(),{class:di.circleRange,"stroke-linecap":"round"},U(o)));var r=Se(),a=ye(r);{var u=l=>{var m=Se(),g=ye(m);ke(g,()=>U(n),()=>U(c)),oe(l,m)},_=l=>{var m=Wf();Xe(m,()=>({...U(c)})),oe(l,m)};We(a,l=>{U(n)?l(u):l(_,!1)})}oe(e,r),ze()}var jf=cr("<circle></circle>");function Gf(e,t){Fe(t,!0);const i=Ge(t,["$$slots","$$events","$$legacy"]),s=ti.consume(),n=Q(()=>t.element),o=Q(()=>Ye(i,["element"])),c=Q(()=>Je(s().getCircleTrackProps(),{class:di.circleTrack},U(o)));var r=Se(),a=ye(r);{var u=l=>{var m=Se(),g=ye(m);ke(g,()=>U(n),()=>U(c)),oe(l,m)},_=l=>{var m=jf();Xe(m,()=>({...U(c)})),oe(l,m)};We(a,l=>{U(n)?l(u):l(_,!1)})}oe(e,r),ze()}var Vf=cr("<svg><!></svg>");function Kf(e,t){Fe(t,!0);const i=Ge(t,["$$slots","$$events","$$legacy"]),s=ti.consume(),n=Q(()=>t.element),o=Q(()=>t.children),c=Q(()=>Ye(i,["element","children"])),r=Q(()=>Je(s().getCircleProps(),{class:di.circle,style:"--size: 100px; --thickness: 10px;"},U(c)));var a=Se(),u=ye(a);{var _=m=>{var g=Se(),C=ye(g);ke(C,()=>U(n),()=>U(r)),oe(m,g)},l=m=>{var g=Vf();Xe(g,()=>({...U(r)}));var C=De(g);ke(C,()=>U(o)??st),Te(g),oe(m,g)};We(u,m=>{U(n)?m(_):m(l,!1)})}oe(e,a),ze()}var Yf=Be("<div><!></div>");function Xf(e,t){Fe(t,!0);const i=Ge(t,["$$slots","$$events","$$legacy"]),s=ti.consume(),n=Q(()=>t.element),o=Q(()=>t.children),c=Q(()=>Ye(i,["element","children"])),r=Q(()=>Je(s().getLabelProps(),{class:di.label},U(c)));var a=Se(),u=ye(a);{var _=m=>{var g=Se(),C=ye(g);ke(C,()=>U(n),()=>U(r)),oe(m,g)},l=m=>{var g=Yf();Xe(g,()=>({...U(r)}));var C=De(g);ke(C,()=>U(o)??st),Te(g),oe(m,g)};We(u,m=>{U(n)?m(_):m(l,!1)})}oe(e,a),ze()}var Jf=Be("<div><!></div>");function Qf(e,t){Fe(t,!0);const i=Ge(t,["$$slots","$$events","$$legacy"]),s=ti.consume(),n=Q(()=>t.element),o=Q(()=>t.children),c=Q(()=>Ye(i,["element","children"])),r=Q(()=>Je(s().getRangeProps(),{class:di.range},U(c)));var a=Se(),u=ye(a);{var _=m=>{var g=Se(),C=ye(g);ke(C,()=>U(n),()=>U(r)),oe(m,g)},l=m=>{var g=Jf();Xe(g,()=>({...U(r)}));var C=De(g);ke(C,()=>U(o)??st),Te(g),oe(m,g)};We(u,m=>{U(n)?m(_):m(l,!1)})}oe(e,a),ze()}function Zf(e,t){Fe(t,!0);const i=ti.consume(),s=Q(()=>t.children);var n=Se(),o=ye(n);ke(o,()=>U(s),()=>i),oe(e,n),ze()}var ep=Be("<div><!></div>");function tp(e,t){Fe(t,!0);const i=Ge(t,["$$slots","$$events","$$legacy"]),s=Q(()=>t.element),n=Q(()=>t.children),o=Q(()=>t.value),c=Q(()=>Ye(i,["element","children","value"])),r=Q(()=>Je(U(o)().getRootProps(),{class:di.root},U(c)));ti.provide(()=>U(o)());var a=Se(),u=ye(a);{var _=m=>{var g=Se(),C=ye(g);ke(C,()=>U(s),()=>U(r)),oe(m,g)},l=m=>{var g=ep();Xe(g,()=>({...U(r)}));var C=De(g);ke(C,()=>U(n)??st),Te(g),oe(m,g)};We(u,m=>{U(s)?m(_):m(l,!1)})}oe(e,a),ze()}var ip=Ji("progress").parts("root","label","track","range","valueText","view","circle","circleTrack","circleRange"),ai=ip.build(),sp=e=>e.ids?.root??`progress-${e.id}`,rp=e=>e.ids?.track??`progress-${e.id}-track`,np=e=>e.ids?.label??`progress-${e.id}-label`,op=e=>e.ids?.circle??`progress-${e.id}-circle`;function ap(e,t){const{context:i,computed:s,prop:n,send:o,scope:c}=e,r=s("percent"),a=s("isIndeterminate")?"":s("formatter").format(r/100),u=n("max"),_=n("min"),l=n("orientation"),m=n("translations"),g=s("isIndeterminate"),C=i.get("value"),y=m?.value({value:C,max:u,percent:r,min:_,formatter:s("formatter")})??"",h=hp(C,u),f={role:"progressbar","aria-label":y,"data-max":u,"aria-valuemin":_,"aria-valuemax":u,"aria-valuenow":C??void 0,"data-orientation":l,"data-state":h},d=lp(e);return{value:C,valueAsString:y,min:_,max:u,percent:r,percentAsString:a,indeterminate:g,setValue(p){o({type:"VALUE.SET",value:p})},setToMax(){o({type:"VALUE.SET",value:u})},setToMin(){o({type:"VALUE.SET",value:_})},getRootProps(){return t.element({dir:n("dir"),...ai.root.attrs,id:sp(c),"data-max":u,"data-value":C??void 0,"data-state":h,"data-orientation":l,style:{"--percent":g?void 0:r}})},getLabelProps(){return t.element({dir:n("dir"),id:np(c),...ai.label.attrs,"data-orientation":l})},getValueTextProps(){return t.element({dir:n("dir"),"aria-live":"polite",...ai.valueText.attrs})},getTrackProps(){return t.element({dir:n("dir"),id:rp(c),...ai.track.attrs,...f})},getRangeProps(){return t.element({dir:n("dir"),...ai.range.attrs,"data-orientation":l,"data-state":h,style:{[s("isHorizontal")?"width":"height"]:g?void 0:`${r}%`}})},getCircleProps(){return t.element({dir:n("dir"),id:op(c),...ai.circle.attrs,...f,...d.root})},getCircleTrackProps(){return t.element({dir:n("dir"),"data-orientation":l,...ai.circleTrack.attrs,...d.track})},getCircleRangeProps(){return t.element({dir:n("dir"),...ai.circleRange.attrs,...d.range,"data-state":h})},getViewProps(p){return t.element({dir:n("dir"),...ai.view.attrs,"data-state":p.state,hidden:p.state!==h})}}}function hp(e,t){return e==null?"indeterminate":e===t?"complete":"loading"}var jo={style:{"--radius":"calc(var(--size) / 2 - var(--thickness) / 2)",cx:"calc(var(--size) / 2)",cy:"calc(var(--size) / 2)",r:"var(--radius)",fill:"transparent",strokeWidth:"var(--thickness)"}},cp={style:{width:"var(--size)",height:"var(--size)"}};function lp(e){const{context:t,computed:i}=e;return{root:cp,track:jo,range:{opacity:t.get("value")===0?0:void 0,style:{...jo.style,"--percent":i("percent"),"--circumference":"calc(2 * 3.14159 * var(--radius))","--offset":"calc(var(--circumference) * (100 - var(--percent)) / 100)",strokeDashoffset:"calc(var(--circumference) * ((100 - var(--percent)) / 100))",strokeDasharray:i("isIndeterminate")?void 0:"var(--circumference)",transformOrigin:"center",transform:"rotate(-90deg)"}}}}var up={props({props:e}){const t=e.min??0,i=e.max??100;return{orientation:"horizontal",...e,max:i,min:t,defaultValue:e.defaultValue!==void 0?e.defaultValue:fp(t,i),formatOptions:{style:"percent",...e.formatOptions},translations:{value:({value:s,percent:n,formatter:o})=>{if(s===null)return"loading...";if(o){const r=o.resolvedOptions().style==="percent"?n/100:s;return o.format(r)}return s.toString()},...e.translations}}},initialState(){return"idle"},entry:["validateContext"],context({bindable:e,prop:t}){return{value:e(()=>({defaultValue:t("defaultValue"),value:t("value"),onChange(i){t("onValueChange")?.({value:i})}}))}},computed:{isIndeterminate:({context:e})=>e.get("value")===null,percent({context:e,prop:t}){const i=e.get("value");return za(i)?xl(i,t("min"),t("max"))*100:-1},formatter:Hu(({prop:e})=>[e("locale"),e("formatOptions")],([e,t])=>new Intl.NumberFormat(e,t)),isHorizontal:({prop:e})=>e("orientation")==="horizontal"},states:{idle:{on:{"VALUE.SET":{actions:["setValue"]}}}},implementations:{actions:{setValue:({context:e,event:t,prop:i})=>{const s=t.value===null?null:Math.max(0,Math.min(t.value,i("max")));e.set("value",s)},validateContext:({context:e,prop:t})=>{const i=t("max"),s=t("min"),n=e.get("value");if(n!=null){if(!$n(i))throw new Error(`[progress] The max value passed \`${i}\` is not a valid number`);if(!dp(n,i))throw new Error(`[progress] The value passed \`${n}\` exceeds the max value \`${i}\``);if(!_p(n,s))throw new Error(`[progress] The value passed \`${n}\` exceeds the min value \`${s}\``)}}}}},$n=e=>za(e)&&!isNaN(e),dp=(e,t)=>$n(e)&&e<=t,_p=(e,t)=>$n(e)&&e>=t,fp=(e,t)=>e+(t-e)/2,pp=rs()(["dir","getRootNode","id","ids","max","min","orientation","translations","value","onValueChange","defaultValue","formatOptions","locale"]),mp=ss(pp);function gp(e){const t=Za(up,e),i=Q(()=>ap(t,Qa));return()=>U(i)}var vp=Be("<div><!></div>");function yp(e,t){const i=kn();Fe(t,!0);const s=Ge(t,["$$slots","$$events","$$legacy"]),n=Q(()=>mp(s)),o=Q(()=>Bi(U(n),2)),c=Q(()=>U(o)[0]),r=Q(()=>U(o)[1]),a=Q(()=>U(r).element),u=Q(()=>U(r).children),_=Q(()=>Ye(U(r),["element","children"])),l=gp(()=>({...U(c),id:i})),m=Q(()=>Je(l().getRootProps(),{class:di.root},U(_)));ti.provide(()=>l());var g=Se(),C=ye(g);{var y=f=>{var d=Se(),p=ye(d);ke(p,()=>U(a),()=>U(m)),oe(f,d)},h=f=>{var d=vp();Xe(d,()=>({...U(m)}));var p=De(d);ke(p,()=>U(u)??st),Te(d),oe(f,d)};We(C,f=>{U(a)?f(y):f(h,!1)})}oe(e,g),ze()}var bp=Be("<div><!></div>");function wp(e,t){Fe(t,!0);const i=Ge(t,["$$slots","$$events","$$legacy"]),s=ti.consume(),n=Q(()=>t.element),o=Q(()=>t.children),c=Q(()=>Ye(i,["element","children"])),r=Q(()=>Je(s().getTrackProps(),{class:di.track},U(c)));var a=Se(),u=ye(a);{var _=m=>{var g=Se(),C=ye(g);ke(C,()=>U(n),()=>U(r)),oe(m,g)},l=m=>{var g=bp();Xe(g,()=>({...U(r)}));var C=De(g);ke(C,()=>U(o)??st),Te(g),oe(m,g)};We(u,m=>{U(n)?m(_):m(l,!1)})}oe(e,a),ze()}var Sp=Be("<span><!></span>");function Cp(e,t){Fe(t,!0);const i=Ge(t,["$$slots","$$events","$$legacy"]),s=ti.consume(),n=Q(()=>t.element),o=Q(()=>t.children),c=Q(()=>Ye(i,["element","children"])),r=Q(()=>Je(s().getValueTextProps(),{class:di.valueText},U(c)));var a=Se(),u=ye(a);{var _=m=>{var g=Se(),C=ye(g);ke(C,()=>U(n),()=>U(r)),oe(m,g)},l=m=>{var g=Sp();Xe(g,()=>({...U(r)}));var C=De(g);{var y=f=>{var d=Se(),p=ye(d);ke(p,()=>U(o)??st),oe(f,d)},h=f=>{var d=Qs();xs(p=>Ii(d,p),[()=>s().percentAsString]),oe(f,d)};We(C,f=>{U(o)?f(y):f(h,!1)})}Te(g),oe(m,g)};We(u,m=>{U(n)?m(_):m(l,!1)})}oe(e,a),ze()}const Vs=Object.assign(yp,{Provider:tp,Context:Zf,Label:Xf,ValueText:Cp,Track:wp,Range:Qf,Circle:Kf,CircleTrack:Gf,CircleRange:$f});var Hr=function(e,t){return Object.defineProperty?Object.defineProperty(e,"raw",{value:t}):e.raw=t,e},qe;(function(e){e[e.EOS=0]="EOS",e[e.Text=1]="Text",e[e.Incomplete=2]="Incomplete",e[e.ESC=3]="ESC",e[e.Unknown=4]="Unknown",e[e.SGR=5]="SGR",e[e.OSCURL=6]="OSCURL"})(qe||(qe={}));class Ep{constructor(){this.VERSION="6.0.6",this.setup_palettes(),this._use_classes=!1,this.bold=!1,this.faint=!1,this.italic=!1,this.underline=!1,this.fg=this.bg=null,this._buffer="",this._url_allowlist={http:1,https:1},this._escape_html=!0,this.boldStyle="font-weight:bold",this.faintStyle="opacity:0.7",this.italicStyle="font-style:italic",this.underlineStyle="text-decoration:underline"}set use_classes(t){this._use_classes=t}get use_classes(){return this._use_classes}set url_allowlist(t){this._url_allowlist=t}get url_allowlist(){return this._url_allowlist}set escape_html(t){this._escape_html=t}get escape_html(){return this._escape_html}set boldStyle(t){this._boldStyle=t}get boldStyle(){return this._boldStyle}set faintStyle(t){this._faintStyle=t}get faintStyle(){return this._faintStyle}set italicStyle(t){this._italicStyle=t}get italicStyle(){return this._italicStyle}set underlineStyle(t){this._underlineStyle=t}get underlineStyle(){return this._underlineStyle}setup_palettes(){this.ansi_colors=[[{rgb:[0,0,0],class_name:"ansi-black"},{rgb:[187,0,0],class_name:"ansi-red"},{rgb:[0,187,0],class_name:"ansi-green"},{rgb:[187,187,0],class_name:"ansi-yellow"},{rgb:[0,0,187],class_name:"ansi-blue"},{rgb:[187,0,187],class_name:"ansi-magenta"},{rgb:[0,187,187],class_name:"ansi-cyan"},{rgb:[255,255,255],class_name:"ansi-white"}],[{rgb:[85,85,85],class_name:"ansi-bright-black"},{rgb:[255,85,85],class_name:"ansi-bright-red"},{rgb:[0,255,0],class_name:"ansi-bright-green"},{rgb:[255,255,85],class_name:"ansi-bright-yellow"},{rgb:[85,85,255],class_name:"ansi-bright-blue"},{rgb:[255,85,255],class_name:"ansi-bright-magenta"},{rgb:[85,255,255],class_name:"ansi-bright-cyan"},{rgb:[255,255,255],class_name:"ansi-bright-white"}]],this.palette_256=[],this.ansi_colors.forEach(s=>{s.forEach(n=>{this.palette_256.push(n)})});let t=[0,95,135,175,215,255];for(let s=0;s<6;++s)for(let n=0;n<6;++n)for(let o=0;o<6;++o){let c={rgb:[t[s],t[n],t[o]],class_name:"truecolor"};this.palette_256.push(c)}let i=8;for(let s=0;s<24;++s,i+=10){let n={rgb:[i,i,i],class_name:"truecolor"};this.palette_256.push(n)}}escape_txt_for_html(t){return this._escape_html?t.replace(/[&<>"']/gm,i=>{if(i==="&")return"&amp;";if(i==="<")return"&lt;";if(i===">")return"&gt;";if(i==='"')return"&quot;";if(i==="'")return"&#x27;"}):t}append_buffer(t){var i=this._buffer+t;this._buffer=i}get_next_packet(){var t={kind:qe.EOS,text:"",url:""},i=this._buffer.length;if(i==0)return t;var s=this._buffer.indexOf("\x1B");if(s==-1)return t.kind=qe.Text,t.text=this._buffer,this._buffer="",t;if(s>0)return t.kind=qe.Text,t.text=this._buffer.slice(0,s),this._buffer=this._buffer.slice(s),t;if(s==0){if(i<3)return t.kind=qe.Incomplete,t;var n=this._buffer.charAt(1);if(n!="["&&n!="]"&&n!="(")return t.kind=qe.ESC,t.text=this._buffer.slice(0,1),this._buffer=this._buffer.slice(1),t;if(n=="["){this._csi_regex||(this._csi_regex=Go(Vo||(Vo=Hr([`
                        ^                           # beginning of line
                                                    #
                                                    # First attempt
                        (?:                         # legal sequence
                          \x1B[                      # CSI
                          ([<-?]?)              # private-mode char
                          ([d;]*)                    # any digits or semicolons
                          ([ -/]?               # an intermediate modifier
                          [@-~])                # the command
                        )
                        |                           # alternate (second attempt)
                        (?:                         # illegal sequence
                          \x1B[                      # CSI
                          [ -~]*                # anything legal
                          ([\0-:])              # anything illegal
                        )
                    `],[`
                        ^                           # beginning of line
                                                    #
                                                    # First attempt
                        (?:                         # legal sequence
                          \\x1b\\[                      # CSI
                          ([\\x3c-\\x3f]?)              # private-mode char
                          ([\\d;]*)                    # any digits or semicolons
                          ([\\x20-\\x2f]?               # an intermediate modifier
                          [\\x40-\\x7e])                # the command
                        )
                        |                           # alternate (second attempt)
                        (?:                         # illegal sequence
                          \\x1b\\[                      # CSI
                          [\\x20-\\x7e]*                # anything legal
                          ([\\x00-\\x1f:])              # anything illegal
                        )
                    `]))));let c=this._buffer.match(this._csi_regex);if(c===null)return t.kind=qe.Incomplete,t;if(c[4])return t.kind=qe.ESC,t.text=this._buffer.slice(0,1),this._buffer=this._buffer.slice(1),t;c[1]!=""||c[3]!="m"?t.kind=qe.Unknown:t.kind=qe.SGR,t.text=c[2];var o=c[0].length;return this._buffer=this._buffer.slice(o),t}else if(n=="]"){if(i<4)return t.kind=qe.Incomplete,t;if(this._buffer.charAt(2)!="8"||this._buffer.charAt(3)!=";")return t.kind=qe.ESC,t.text=this._buffer.slice(0,1),this._buffer=this._buffer.slice(1),t;this._osc_st||(this._osc_st=kp(Ko||(Ko=Hr([`
                        (?:                         # legal sequence
                          (\x1B\\)                    # ESC                           |                           # alternate
                          (\x07)                      # BEL (what xterm did)
                        )
                        |                           # alternate (second attempt)
                        (                           # illegal sequence
                          [\0-]                 # anything illegal
                          |                           # alternate
                          [\b-]                 # anything illegal
                          |                           # alternate
                          [-]                 # anything illegal
                        )
                    `],[`
                        (?:                         # legal sequence
                          (\\x1b\\\\)                    # ESC \\
                          |                           # alternate
                          (\\x07)                      # BEL (what xterm did)
                        )
                        |                           # alternate (second attempt)
                        (                           # illegal sequence
                          [\\x00-\\x06]                 # anything illegal
                          |                           # alternate
                          [\\x08-\\x1a]                 # anything illegal
                          |                           # alternate
                          [\\x1c-\\x1f]                 # anything illegal
                        )
                    `])))),this._osc_st.lastIndex=0;{let a=this._osc_st.exec(this._buffer);if(a===null)return t.kind=qe.Incomplete,t;if(a[3])return t.kind=qe.ESC,t.text=this._buffer.slice(0,1),this._buffer=this._buffer.slice(1),t}{let a=this._osc_st.exec(this._buffer);if(a===null)return t.kind=qe.Incomplete,t;if(a[3])return t.kind=qe.ESC,t.text=this._buffer.slice(0,1),this._buffer=this._buffer.slice(1),t}this._osc_regex||(this._osc_regex=Go(Yo||(Yo=Hr([`
                        ^                           # beginning of line
                                                    #
                        \x1B]8;                    # OSC Hyperlink
                        [ -:<-~]*       # params (excluding ;)
                        ;                           # end of params
                        ([!-~]{0,512})        # URL capture
                        (?:                         # ST
                          (?:\x1B\\)                  # ESC                           |                           # alternate
                          (?:\x07)                    # BEL (what xterm did)
                        )
                        ([ -~]+)              # TEXT capture
                        \x1B]8;;                   # OSC Hyperlink End
                        (?:                         # ST
                          (?:\x1B\\)                  # ESC                           |                           # alternate
                          (?:\x07)                    # BEL (what xterm did)
                        )
                    `],[`
                        ^                           # beginning of line
                                                    #
                        \\x1b\\]8;                    # OSC Hyperlink
                        [\\x20-\\x3a\\x3c-\\x7e]*       # params (excluding ;)
                        ;                           # end of params
                        ([\\x21-\\x7e]{0,512})        # URL capture
                        (?:                         # ST
                          (?:\\x1b\\\\)                  # ESC \\
                          |                           # alternate
                          (?:\\x07)                    # BEL (what xterm did)
                        )
                        ([\\x20-\\x7e]+)              # TEXT capture
                        \\x1b\\]8;;                   # OSC Hyperlink End
                        (?:                         # ST
                          (?:\\x1b\\\\)                  # ESC \\
                          |                           # alternate
                          (?:\\x07)                    # BEL (what xterm did)
                        )
                    `]))));let c=this._buffer.match(this._osc_regex);if(c===null)return t.kind=qe.ESC,t.text=this._buffer.slice(0,1),this._buffer=this._buffer.slice(1),t;t.kind=qe.OSCURL,t.url=c[1],t.text=c[2];var o=c[0].length;return this._buffer=this._buffer.slice(o),t}else if(n=="(")return t.kind=qe.Unknown,this._buffer=this._buffer.slice(3),t}}ansi_to_html(t){this.append_buffer(t);for(var i=[];;){var s=this.get_next_packet();if(s.kind==qe.EOS||s.kind==qe.Incomplete)break;s.kind==qe.ESC||s.kind==qe.Unknown||(s.kind==qe.Text?i.push(this.transform_to_html(this.with_state(s))):s.kind==qe.SGR?this.process_ansi(s):s.kind==qe.OSCURL&&i.push(this.process_hyperlink(s)))}return i.join("")}with_state(t){return{bold:this.bold,faint:this.faint,italic:this.italic,underline:this.underline,fg:this.fg,bg:this.bg,text:t.text}}process_ansi(t){let i=t.text.split(";");for(;i.length>0;){let s=i.shift(),n=parseInt(s,10);if(isNaN(n)||n===0)this.fg=null,this.bg=null,this.bold=!1,this.faint=!1,this.italic=!1,this.underline=!1;else if(n===1)this.bold=!0;else if(n===2)this.faint=!0;else if(n===3)this.italic=!0;else if(n===4)this.underline=!0;else if(n===21)this.bold=!1;else if(n===22)this.faint=!1,this.bold=!1;else if(n===23)this.italic=!1;else if(n===24)this.underline=!1;else if(n===39)this.fg=null;else if(n===49)this.bg=null;else if(n>=30&&n<38)this.fg=this.ansi_colors[0][n-30];else if(n>=40&&n<48)this.bg=this.ansi_colors[0][n-40];else if(n>=90&&n<98)this.fg=this.ansi_colors[1][n-90];else if(n>=100&&n<108)this.bg=this.ansi_colors[1][n-100];else if((n===38||n===48)&&i.length>0){let o=n===38,c=i.shift();if(c==="5"&&i.length>0){let r=parseInt(i.shift(),10);r>=0&&r<=255&&(o?this.fg=this.palette_256[r]:this.bg=this.palette_256[r])}if(c==="2"&&i.length>2){let r=parseInt(i.shift(),10),a=parseInt(i.shift(),10),u=parseInt(i.shift(),10);if(r>=0&&r<=255&&a>=0&&a<=255&&u>=0&&u<=255){let _={rgb:[r,a,u],class_name:"truecolor"};o?this.fg=_:this.bg=_}}}}}transform_to_html(t){let i=t.text;if(i.length===0||(i=this.escape_txt_for_html(i),!t.bold&&!t.italic&&!t.faint&&!t.underline&&t.fg===null&&t.bg===null))return i;let s=[],n=[],o=t.fg,c=t.bg;t.bold&&s.push(this._boldStyle),t.faint&&s.push(this._faintStyle),t.italic&&s.push(this._italicStyle),t.underline&&s.push(this._underlineStyle),this._use_classes?(o&&(o.class_name!=="truecolor"?n.push(`${o.class_name}-fg`):s.push(`color:rgb(${o.rgb.join(",")})`)),c&&(c.class_name!=="truecolor"?n.push(`${c.class_name}-bg`):s.push(`background-color:rgb(${c.rgb.join(",")})`))):(o&&s.push(`color:rgb(${o.rgb.join(",")})`),c&&s.push(`background-color:rgb(${c.rgb})`));let r="",a="";return n.length&&(r=` class="${n.join(" ")}"`),s.length&&(a=` style="${s.join(";")}"`),`<span${a}${r}>${i}</span>`}process_hyperlink(t){let i=t.url.split(":");return i.length<1||!this._url_allowlist[i[0]]?"":`<a href="${this.escape_txt_for_html(t.url)}">${this.escape_txt_for_html(t.text)}</a>`}}function Go(e,...t){let i=e.raw[0],s=/^\s+|\s+\n|\s*#[\s\S]*?\n|\n/gm,n=i.replace(s,"");return new RegExp(n)}function kp(e,...t){let i=e.raw[0],s=/^\s+|\s+\n|\s*#[\s\S]*?\n|\n/gm,n=i.replace(s,"");return new RegExp(n,"g")}var Vo,Ko,Yo,Ks=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function ph(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var qr={exports:{}},Xo;function mh(){if(Xo)return qr.exports;Xo=1;var e=qr.exports={};return e.forEach=function(t,i){for(var s=0;s<t.length;s++){var n=i(t[s]);if(n)return n}},qr.exports}var Wr,Jo;function xp(){return Jo||(Jo=1,Wr=function(e){var t=e.stateHandler.getState;function i(c){var r=t(c);return r&&!!r.isDetectable}function s(c){t(c).isDetectable=!0}function n(c){return!!t(c).busy}function o(c,r){t(c).busy=!!r}return{isDetectable:i,markAsDetectable:s,isBusy:n,markBusy:o}}),Wr}var $r,Qo;function Ap(){return Qo||(Qo=1,$r=function(e){var t={};function i(c){var r=e.get(c);return r===void 0?[]:t[r]||[]}function s(c,r){var a=e.get(c);t[a]||(t[a]=[]),t[a].push(r)}function n(c,r){for(var a=i(c),u=0,_=a.length;u<_;++u)if(a[u]===r){a.splice(u,1);break}}function o(c){var r=i(c);r&&(r.length=0)}return{get:i,add:s,removeListener:n,removeAllListeners:o}}),$r}var jr,Zo;function Rp(){return Zo||(Zo=1,jr=function(){var e=1;function t(){return e++}return{generate:t}}),jr}var Gr,ea;function Tp(){return ea||(ea=1,Gr=function(e){var t=e.idGenerator,i=e.stateHandler.getState;function s(o){var c=i(o);return c&&c.id!==void 0?c.id:null}function n(o){var c=i(o);if(!c)throw new Error("setId required the element to have a resize detection state.");var r=t.generate();return c.id=r,r}return{get:s,set:n}}),Gr}var Vr,ta;function Lp(){return ta||(ta=1,Vr=function(e){function t(){}var i={log:t,warn:t,error:t};if(!e&&window.console){var s=function(n,o){n[o]=function(){var r=console[o];if(r.apply)r.apply(console,arguments);else for(var a=0;a<arguments.length;a++)r(arguments[a])}};s(i,"log"),s(i,"warn"),s(i,"error")}return i}),Vr}var Kr={exports:{}},ia;function gh(){if(ia)return Kr.exports;ia=1;var e=Kr.exports={};return e.isIE=function(t){function i(){var n=navigator.userAgent.toLowerCase();return n.indexOf("msie")!==-1||n.indexOf("trident")!==-1||n.indexOf(" edge/")!==-1}if(!i())return!1;if(!t)return!0;var s=(function(){var n,o=3,c=document.createElement("div"),r=c.getElementsByTagName("i");do c.innerHTML="<!--[if gt IE "+ ++o+"]><i></i><![endif]-->";while(r[0]);return o>4?o:n})();return t===s},e.isLegacyOpera=function(){return!!window.opera},Kr.exports}var Yr={exports:{}},sa;function Dp(){if(sa)return Yr.exports;sa=1;var e=Yr.exports={};e.getOption=t;function t(i,s,n){var o=i[s];return o==null&&n!==void 0?n:o}return Yr.exports}var Xr,ra;function Ip(){if(ra)return Xr;ra=1;var e=Dp();Xr=function(s){s=s||{};var n=s.reporter,o=e.getOption(s,"async",!0),c=e.getOption(s,"auto",!0);c&&!o&&(n&&n.warn("Invalid options combination. auto=true and async=false is invalid. Setting async=true."),o=!0);var r=t(),a,u=!1;function _(h,f){!u&&c&&o&&r.size()===0&&g(),r.add(h,f)}function l(){for(u=!0;r.size();){var h=r;r=t(),h.process()}u=!1}function m(h){u||(h===void 0&&(h=o),a&&(C(a),a=null),h?g():l())}function g(){a=y(l)}function C(h){var f=clearTimeout;return f(h)}function y(h){var f=function(d){return setTimeout(d,0)};return f(h)}return{add:_,force:m}};function t(){var i={},s=0,n=0,o=0;function c(u,_){_||(_=u,u=0),u>n?n=u:u<o&&(o=u),i[u]||(i[u]=[]),i[u].push(_),s++}function r(){for(var u=o;u<=n;u++)for(var _=i[u],l=0;l<_.length;l++){var m=_[l];m()}}function a(){return s}return{add:c,process:r,size:a}}return Xr}var Jr,na;function Op(){if(na)return Jr;na=1;var e="_erd";function t(n){return n[e]={},i(n)}function i(n){return n[e]}function s(n){delete n[e]}return Jr={initState:t,getState:i,cleanState:s},Jr}var Qr,oa;function Pp(){if(oa)return Qr;oa=1;var e=gh();return Qr=function(t){t=t||{};var i=t.reporter,s=t.batchProcessor,n=t.stateHandler.getState;if(!i)throw new Error("Missing required dependency: reporter.");function o(_,l){function m(){l(_)}if(e.isIE(8))n(_).object={proxy:m},_.attachEvent("onresize",m);else{var g=a(_);if(!g)throw new Error("Element is not detectable by this strategy.");g.contentDocument.defaultView.addEventListener("resize",m)}}function c(_){var l=t.important?" !important; ":"; ";return(_.join(l)+l).trim()}function r(_,l,m){m||(m=l,l=_,_=null),_=_||{},_.debug;function g(C,y){var h=c(["display: block","position: absolute","top: 0","left: 0","width: 100%","height: 100%","border: none","padding: 0","margin: 0","opacity: 0","z-index: -1000","pointer-events: none"]),f=!1,d=window.getComputedStyle(C),p=C.offsetWidth,v=C.offsetHeight;n(C).startSize={width:p,height:v};function S(){function w(){if(d.position==="static"){C.style.setProperty("position","relative",_.important?"important":"");var k=function(R,I,P,L){function z(re){return re.replace(/[^-\d\.]/g,"")}var J=P[L];J!=="auto"&&z(J)!=="0"&&(R.warn("An element that is positioned static has style."+L+"="+J+" which is ignored due to the static positioning. The element will need to be positioned relative, so the style."+L+" will be set to 0. Element: ",I),I.style.setProperty(L,"0",_.important?"important":""))};k(i,C,d,"top"),k(i,C,d,"right"),k(i,C,d,"bottom"),k(i,C,d,"left")}}function E(){f||w();function k(I,P){if(!I.contentDocument){var L=n(I);L.checkForObjectDocumentTimeoutId&&window.clearTimeout(L.checkForObjectDocumentTimeoutId),L.checkForObjectDocumentTimeoutId=setTimeout(function(){L.checkForObjectDocumentTimeoutId=0,k(I,P)},100);return}P(I.contentDocument)}var R=this;k(R,function(P){y(C)})}d.position!==""&&(w(),f=!0);var b=document.createElement("object");b.style.cssText=h,b.tabIndex=-1,b.type="text/html",b.setAttribute("aria-hidden","true"),b.onload=E,e.isIE()||(b.data="about:blank"),n(C)&&(C.appendChild(b),n(C).object=b,e.isIE()&&(b.data="about:blank"))}s?s.add(S):S()}e.isIE(8)?m(l):g(l,m)}function a(_){return n(_).object}function u(_){if(n(_)){var l=a(_);l&&(e.isIE(8)?_.detachEvent("onresize",l.proxy):_.removeChild(l),n(_).checkForObjectDocumentTimeoutId&&window.clearTimeout(n(_).checkForObjectDocumentTimeoutId),delete n(_).object)}}return{makeDetectable:r,addListener:o,uninstall:u}},Qr}var Zr,aa;function Mp(){if(aa)return Zr;aa=1;var e=mh().forEach;return Zr=function(t){t=t||{};var i=t.reporter,s=t.batchProcessor,n=t.stateHandler.getState;t.stateHandler.hasState;var o=t.idHandler;if(!s)throw new Error("Missing required dependency: batchProcessor");if(!i)throw new Error("Missing required dependency: reporter.");var c=l(),r="erd_scroll_detection_scrollbar_style",a="erd_scroll_detection_container";function u(S){m(S,r,a)}u(window.document);function _(S){var w=t.important?" !important; ":"; ";return(S.join(w)+w).trim()}function l(){var S=500,w=500,E=document.createElement("div");E.style.cssText=_(["position: absolute","width: "+S*2+"px","height: "+w*2+"px","visibility: hidden","margin: 0","padding: 0"]);var b=document.createElement("div");b.style.cssText=_(["position: absolute","width: "+S+"px","height: "+w+"px","overflow: scroll","visibility: none","top: "+-S*3+"px","left: "+-w*3+"px","visibility: hidden","margin: 0","padding: 0"]),b.appendChild(E),document.body.insertBefore(b,document.body.firstChild);var k=S-b.clientWidth,R=w-b.clientHeight;return document.body.removeChild(b),{width:k,height:R}}function m(S,w,E){function b(P,L){L=L||function(J){S.head.appendChild(J)};var z=S.createElement("style");return z.innerHTML=P,z.id=w,L(z),z}if(!S.getElementById(w)){var k=E+"_animation",R=E+"_animation_active",I=`/* Created by the element-resize-detector library. */
`;I+="."+E+" > div::-webkit-scrollbar { "+_(["display: none"])+` }

`,I+="."+R+" { "+_(["-webkit-animation-duration: 0.1s","animation-duration: 0.1s","-webkit-animation-name: "+k,"animation-name: "+k])+` }
`,I+="@-webkit-keyframes "+k+` { 0% { opacity: 1; } 50% { opacity: 0; } 100% { opacity: 1; } }
`,I+="@keyframes "+k+" { 0% { opacity: 1; } 50% { opacity: 0; } 100% { opacity: 1; } }",b(I)}}function g(S){S.className+=" "+a+"_animation_active"}function C(S,w,E){if(S.addEventListener)S.addEventListener(w,E);else if(S.attachEvent)S.attachEvent("on"+w,E);else return i.error("[scroll] Don't know how to add event listeners.")}function y(S,w,E){if(S.removeEventListener)S.removeEventListener(w,E);else if(S.detachEvent)S.detachEvent("on"+w,E);else return i.error("[scroll] Don't know how to remove event listeners.")}function h(S){return n(S).container.childNodes[0].childNodes[0].childNodes[0]}function f(S){return n(S).container.childNodes[0].childNodes[0].childNodes[1]}function d(S,w){var E=n(S).listeners;if(!E.push)throw new Error("Cannot add listener to an element that is not detectable.");n(S).listeners.push(w)}function p(S,w,E){E||(E=w,w=S,S=null),S=S||{};function b(){if(S.debug){var q=Array.prototype.slice.call(arguments);if(q.unshift(o.get(w),"Scroll: "),i.log.apply)i.log.apply(null,q);else for(var Y=0;Y<q.length;Y++)i.log(q[Y])}}function k(q){function Y(Z){var he=Z.getRootNode&&Z.getRootNode().contains(Z);return Z===Z.ownerDocument.body||Z.ownerDocument.body.contains(Z)||he}return!Y(q)||window.getComputedStyle(q)===null}function R(q){var Y=n(q).container.childNodes[0],Z=window.getComputedStyle(Y);return!Z.width||Z.width.indexOf("px")===-1}function I(){var q=window.getComputedStyle(w),Y={};return Y.position=q.position,Y.width=w.offsetWidth,Y.height=w.offsetHeight,Y.top=q.top,Y.right=q.right,Y.bottom=q.bottom,Y.left=q.left,Y.widthCSS=q.width,Y.heightCSS=q.height,Y}function P(){var q=I();n(w).startSize={width:q.width,height:q.height},b("Element start size",n(w).startSize)}function L(){n(w).listeners=[]}function z(){if(b("storeStyle invoked."),!n(w)){b("Aborting because element has been uninstalled");return}var q=I();n(w).style=q}function J(q,Y,Z){n(q).lastWidth=Y,n(q).lastHeight=Z}function re(q){return h(q).childNodes[0]}function te(){return 2*c.width+1}function ee(){return 2*c.height+1}function x(q){return q+10+te()}function B(q){return q+10+ee()}function N(q){return q*2+te()}function H(q){return q*2+ee()}function se(q,Y,Z){var he=h(q),me=f(q),fe=x(Y),Ae=B(Z),ue=N(Y),ve=H(Z);he.scrollLeft=fe,he.scrollTop=Ae,me.scrollLeft=ue,me.scrollTop=ve}function j(){var q=n(w).container;if(!q){q=document.createElement("div"),q.className=a,q.style.cssText=_(["visibility: hidden","display: inline","width: 0px","height: 0px","z-index: -1","overflow: hidden","margin: 0","padding: 0"]),n(w).container=q,g(q),w.appendChild(q);var Y=function(){n(w).onRendered&&n(w).onRendered()};C(q,"animationstart",Y),n(w).onAnimationStart=Y}return q}function V(){function q(){var je=n(w).style;if(je.position==="static"){w.style.setProperty("position","relative",S.important?"important":"");var rt=function(bt,Oe,Ni,mi){function Cr(us){return us.replace(/[^-\d\.]/g,"")}var ls=Ni[mi];ls!=="auto"&&Cr(ls)!=="0"&&(bt.warn("An element that is positioned static has style."+mi+"="+ls+" which is ignored due to the static positioning. The element will need to be positioned relative, so the style."+mi+" will be set to 0. Element: ",Oe),Oe.style[mi]=0)};rt(i,w,je,"top"),rt(i,w,je,"right"),rt(i,w,je,"bottom"),rt(i,w,je,"left")}}function Y(je,rt,bt,Oe){return je=je?je+"px":"0",rt=rt?rt+"px":"0",bt=bt?bt+"px":"0",Oe=Oe?Oe+"px":"0",["left: "+je,"top: "+rt,"right: "+Oe,"bottom: "+bt]}if(b("Injecting elements"),!n(w)){b("Aborting because element has been uninstalled");return}q();var Z=n(w).container;Z||(Z=j());var he=c.width,me=c.height,fe=_(["position: absolute","flex: none","overflow: hidden","z-index: -1","visibility: hidden","width: 100%","height: 100%","left: 0px","top: 0px"]),Ae=_(["position: absolute","flex: none","overflow: hidden","z-index: -1","visibility: hidden"].concat(Y(-(1+he),-(1+me),-me,-he))),ue=_(["position: absolute","flex: none","overflow: scroll","z-index: -1","visibility: hidden","width: 100%","height: 100%"]),ve=_(["position: absolute","flex: none","overflow: scroll","z-index: -1","visibility: hidden","width: 100%","height: 100%"]),Me=_(["position: absolute","left: 0","top: 0"]),et=_(["position: absolute","width: 200%","height: 200%"]),$e=document.createElement("div"),tt=document.createElement("div"),He=document.createElement("div"),Ut=document.createElement("div"),ut=document.createElement("div"),Nt=document.createElement("div");$e.dir="ltr",$e.style.cssText=fe,$e.className=a,tt.className=a,tt.style.cssText=Ae,He.style.cssText=ue,Ut.style.cssText=Me,ut.style.cssText=ve,Nt.style.cssText=et,He.appendChild(Ut),ut.appendChild(Nt),tt.appendChild(He),tt.appendChild(ut),$e.appendChild(tt),Z.appendChild($e);function oi(){var je=n(w);je&&je.onExpand?je.onExpand():b("Aborting expand scroll handler: element has been uninstalled")}function kt(){var je=n(w);je&&je.onShrink?je.onShrink():b("Aborting shrink scroll handler: element has been uninstalled")}C(He,"scroll",oi),C(ut,"scroll",kt),n(w).onExpandScroll=oi,n(w).onShrinkScroll=kt}function X(){function q(ue,ve,Me){var et=re(ue),$e=x(ve),tt=B(Me);et.style.setProperty("width",$e+"px",S.important?"important":""),et.style.setProperty("height",tt+"px",S.important?"important":"")}function Y(ue){var ve=w.offsetWidth,Me=w.offsetHeight,et=ve!==n(w).lastWidth||Me!==n(w).lastHeight;b("Storing current size",ve,Me),J(w,ve,Me),s.add(0,function(){if(et){if(!n(w)){b("Aborting because element has been uninstalled");return}if(!Z()){b("Aborting because element container has not been initialized");return}if(S.debug){var tt=w.offsetWidth,He=w.offsetHeight;(tt!==ve||He!==Me)&&i.warn(o.get(w),"Scroll: Size changed before updating detector elements.")}q(w,ve,Me)}}),s.add(1,function(){if(!n(w)){b("Aborting because element has been uninstalled");return}if(!Z()){b("Aborting because element container has not been initialized");return}se(w,ve,Me)}),et&&ue&&s.add(2,function(){if(!n(w)){b("Aborting because element has been uninstalled");return}if(!Z()){b("Aborting because element container has not been initialized");return}ue()})}function Z(){return!!n(w).container}function he(){function ue(){return n(w).lastNotifiedWidth===void 0}b("notifyListenersIfNeeded invoked");var ve=n(w);if(ue()&&ve.lastWidth===ve.startSize.width&&ve.lastHeight===ve.startSize.height)return b("Not notifying: Size is the same as the start size, and there has been no notification yet.");if(ve.lastWidth===ve.lastNotifiedWidth&&ve.lastHeight===ve.lastNotifiedHeight)return b("Not notifying: Size already notified");b("Current size not notified, notifying..."),ve.lastNotifiedWidth=ve.lastWidth,ve.lastNotifiedHeight=ve.lastHeight,e(n(w).listeners,function(Me){Me(w)})}function me(){if(b("startanimation triggered."),R(w)){b("Ignoring since element is still unrendered...");return}b("Element rendered.");var ue=h(w),ve=f(w);(ue.scrollLeft===0||ue.scrollTop===0||ve.scrollLeft===0||ve.scrollTop===0)&&(b("Scrollbars out of sync. Updating detector elements..."),Y(he))}function fe(){if(b("Scroll detected."),R(w)){b("Scroll event fired while unrendered. Ignoring...");return}Y(he)}if(b("registerListenersAndPositionElements invoked."),!n(w)){b("Aborting because element has been uninstalled");return}n(w).onRendered=me,n(w).onExpand=fe,n(w).onShrink=fe;var Ae=n(w).style;q(w,Ae.width,Ae.height)}function M(){if(b("finalizeDomMutation invoked."),!n(w)){b("Aborting because element has been uninstalled");return}var q=n(w).style;J(w,q.width,q.height),se(w,q.width,q.height)}function T(){E(w)}function K(){b("Installing..."),L(),P(),s.add(0,z),s.add(1,V),s.add(2,X),s.add(3,M),s.add(4,T)}b("Making detectable..."),k(w)?(b("Element is detached"),j(),b("Waiting until element is attached..."),n(w).onRendered=function(){b("Element is now attached"),K()}):K()}function v(S){var w=n(S);w&&(w.onExpandScroll&&y(h(S),"scroll",w.onExpandScroll),w.onShrinkScroll&&y(f(S),"scroll",w.onShrinkScroll),w.onAnimationStart&&y(w.container,"animationstart",w.onAnimationStart),w.container&&S.removeChild(w.container))}return{makeDetectable:p,addListener:d,uninstall:v,initDocument:u}},Zr}var en,ha;function Bp(){if(ha)return en;ha=1;var e=mh().forEach,t=xp(),i=Ap(),s=Rp(),n=Tp(),o=Lp(),c=gh(),r=Ip(),a=Op(),u=Pp(),_=Mp();function l(y){return Array.isArray(y)||y.length!==void 0}function m(y){if(Array.isArray(y))return y;var h=[];return e(y,function(f){h.push(f)}),h}function g(y){return y&&y.nodeType===1}en=function(y){y=y||{};var h;if(y.idHandler)h={get:function(te){return y.idHandler.get(te,!0)},set:y.idHandler.set};else{var f=s(),d=n({idGenerator:f,stateHandler:a});h=d}var p=y.reporter;if(!p){var v=p===!1;p=o(v)}var S=C(y,"batchProcessor",r({reporter:p})),w={};w.callOnAdd=!!C(y,"callOnAdd",!0),w.debug=!!C(y,"debug",!1);var E=i(h),b=t({stateHandler:a}),k,R=C(y,"strategy","object"),I=C(y,"important",!1),P={reporter:p,batchProcessor:S,stateHandler:a,idHandler:h,important:I};if(R==="scroll"&&(c.isLegacyOpera()?(p.warn("Scroll strategy is not supported on legacy Opera. Changing to object strategy."),R="object"):c.isIE(9)&&(p.warn("Scroll strategy is not supported on IE9. Changing to object strategy."),R="object")),R==="scroll")k=_(P);else if(R==="object")k=u(P);else throw new Error("Invalid strategy name: "+R);var L={};function z(te,ee,x){function B(X){var M=E.get(X);e(M,function(K){K(X)})}function N(X,M,T){E.add(M,T),X&&T(M)}if(x||(x=ee,ee=te,te={}),!ee)throw new Error("At least one element required.");if(!x)throw new Error("Listener required.");if(g(ee))ee=[ee];else if(l(ee))ee=m(ee);else return p.error("Invalid arguments. Must be a DOM element or a collection of DOM elements.");var H=0,se=C(te,"callOnAdd",w.callOnAdd),j=C(te,"onReady",function(){}),V=C(te,"debug",w.debug);e(ee,function(M){a.getState(M)||(a.initState(M),h.set(M));var T=h.get(M);if(V&&p.log("Attaching listener to element",T,M),!b.isDetectable(M)){if(V&&p.log(T,"Not detectable."),b.isBusy(M)){V&&p.log(T,"System busy making it detectable"),N(se,M,x),L[T]=L[T]||[],L[T].push(function(){H++,H===ee.length&&j()});return}return V&&p.log(T,"Making detectable..."),b.markBusy(M,!0),k.makeDetectable({debug:V,important:I},M,function(q){if(V&&p.log(T,"onElementDetectable"),a.getState(q)){b.markAsDetectable(q),b.markBusy(q,!1),k.addListener(q,B),N(se,q,x);var Y=a.getState(q);if(Y&&Y.startSize){var Z=q.offsetWidth,he=q.offsetHeight;(Y.startSize.width!==Z||Y.startSize.height!==he)&&B(q)}L[T]&&e(L[T],function(me){me()})}else V&&p.log(T,"Element uninstalled before being detectable.");delete L[T],H++,H===ee.length&&j()})}V&&p.log(T,"Already detecable, adding listener."),N(se,M,x),H++}),H===ee.length&&j()}function J(te){if(!te)return p.error("At least one element is required.");if(g(te))te=[te];else if(l(te))te=m(te);else return p.error("Invalid arguments. Must be a DOM element or a collection of DOM elements.");e(te,function(ee){E.removeAllListeners(ee),k.uninstall(ee),a.cleanState(ee)})}function re(te){k.initDocument&&k.initDocument(te)}return{listenTo:z,removeListener:E.removeListener,removeAllListeners:E.removeAllListeners,uninstall:J,initDocument:re}};function C(y,h,f){var d=y[h];return d==null&&f!==void 0?f:d}return en}var Up=Bp();const Np=ph(Up);var Ys=Np({strategy:"scroll"});function Fp(e,t){Ys.listenTo(e,t);var i=t;return{update:function(s){Ys.removeListener(e,i),Ys.listenTo(e,s),i=s},destroy:function(){Ys.removeListener(e,i)}}}var tn={exports:{}},ca;function zp(){return ca||(ca=1,(function(e,t){(function(i,s){e.exports=s()})(self,(()=>(()=>{var i={};return(()=>{var s=i;Object.defineProperty(s,"__esModule",{value:!0}),s.FitAddon=void 0,s.FitAddon=class{activate(n){this._terminal=n}dispose(){}fit(){const n=this.proposeDimensions();if(!n||!this._terminal||isNaN(n.cols)||isNaN(n.rows))return;const o=this._terminal._core;this._terminal.rows===n.rows&&this._terminal.cols===n.cols||(o._renderService.clear(),this._terminal.resize(n.cols,n.rows))}proposeDimensions(){if(!this._terminal||!this._terminal.element||!this._terminal.element.parentElement)return;const n=this._terminal._core,o=n._renderService.dimensions;if(o.css.cell.width===0||o.css.cell.height===0)return;const c=this._terminal.options.scrollback===0?0:n.viewport.scrollBarWidth,r=window.getComputedStyle(this._terminal.element.parentElement),a=parseInt(r.getPropertyValue("height")),u=Math.max(0,parseInt(r.getPropertyValue("width"))),_=window.getComputedStyle(this._terminal.element),l=a-(parseInt(_.getPropertyValue("padding-top"))+parseInt(_.getPropertyValue("padding-bottom"))),m=u-(parseInt(_.getPropertyValue("padding-right"))+parseInt(_.getPropertyValue("padding-left")))-c;return{cols:Math.max(2,Math.floor(m/o.css.cell.width)),rows:Math.max(1,Math.floor(l/o.css.cell.height))}}}})(),i})()))})(tn)),tn.exports}var Hp=zp(),sn={exports:{}},la;function qp(){return la||(la=1,(function(e,t){(function(i,s){e.exports=s()})(self,(()=>(()=>{var i={6:(c,r)=>{function a(_){try{const l=new URL(_),m=l.password&&l.username?`${l.protocol}//${l.username}:${l.password}@${l.host}`:l.username?`${l.protocol}//${l.username}@${l.host}`:`${l.protocol}//${l.host}`;return _.toLocaleLowerCase().startsWith(m.toLocaleLowerCase())}catch{return!1}}Object.defineProperty(r,"__esModule",{value:!0}),r.LinkComputer=r.WebLinkProvider=void 0,r.WebLinkProvider=class{constructor(_,l,m,g={}){this._terminal=_,this._regex=l,this._handler=m,this._options=g}provideLinks(_,l){const m=u.computeLink(_,this._regex,this._terminal,this._handler);l(this._addCallbacks(m))}_addCallbacks(_){return _.map((l=>(l.leave=this._options.leave,l.hover=(m,g)=>{if(this._options.hover){const{range:C}=l;this._options.hover(m,g,C)}},l)))}};class u{static computeLink(l,m,g,C){const y=new RegExp(m.source,(m.flags||"")+"g"),[h,f]=u._getWindowedLineStrings(l-1,g),d=h.join("");let p;const v=[];for(;p=y.exec(d);){const S=p[0];if(!a(S))continue;const[w,E]=u._mapStrIdx(g,f,0,p.index),[b,k]=u._mapStrIdx(g,w,E,S.length);if(w===-1||E===-1||b===-1||k===-1)continue;const R={start:{x:E+1,y:w+1},end:{x:k,y:b+1}};v.push({range:R,text:S,activate:C})}return v}static _getWindowedLineStrings(l,m){let g,C=l,y=l,h=0,f="";const d=[];if(g=m.buffer.active.getLine(l)){const p=g.translateToString(!0);if(g.isWrapped&&p[0]!==" "){for(h=0;(g=m.buffer.active.getLine(--C))&&h<2048&&(f=g.translateToString(!0),h+=f.length,d.push(f),g.isWrapped&&f.indexOf(" ")===-1););d.reverse()}for(d.push(p),h=0;(g=m.buffer.active.getLine(++y))&&g.isWrapped&&h<2048&&(f=g.translateToString(!0),h+=f.length,d.push(f),f.indexOf(" ")===-1););}return[d,C]}static _mapStrIdx(l,m,g,C){const y=l.buffer.active,h=y.getNullCell();let f=g;for(;C;){const d=y.getLine(m);if(!d)return[-1,-1];for(let p=f;p<d.length;++p){d.getCell(p,h);const v=h.getChars();if(h.getWidth()&&(C-=v.length||1,p===d.length-1&&v==="")){const S=y.getLine(m+1);S&&S.isWrapped&&(S.getCell(0,h),h.getWidth()===2&&(C+=1))}if(C<0)return[m,p]}m++,f=0}return[m,f]}}r.LinkComputer=u}},s={};function n(c){var r=s[c];if(r!==void 0)return r.exports;var a=s[c]={exports:{}};return i[c](a,a.exports,n),a.exports}var o={};return(()=>{var c=o;Object.defineProperty(c,"__esModule",{value:!0}),c.WebLinksAddon=void 0;const r=n(6),a=/(https?|HTTPS?):[/]{2}[^\s"'!*(){}|\\\^<>`]*[^\s"':,.!?{}|\\\^~\[\]`()<>]/;function u(_,l){const m=window.open();if(m){try{m.opener=null}catch{}m.location.href=l}else console.warn("Opening link blocked as opener could not be cleared")}c.WebLinksAddon=class{constructor(_=u,l={}){this._handler=_,this._options=l}activate(_){this._terminal=_;const l=this._options,m=l.urlRegex||a;this._linkProvider=this._terminal.registerLinkProvider(new r.WebLinkProvider(this._terminal,m,this._handler,l))}dispose(){this._linkProvider?.dispose()}}})(),o})()))})(sn)),sn.exports}var Wp=qp(),tr={exports:{}},$p=tr.exports,ua;function jp(){return ua||(ua=1,(function(e,t){(function(i,s){e.exports=s()})($p,(()=>(()=>{var i={930:(c,r,a)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.ColorContrastCache=void 0;const u=a(485);r.ColorContrastCache=class{constructor(){this._color=new u.TwoKeyMap,this._css=new u.TwoKeyMap}setCss(_,l,m){this._css.set(_,l,m)}getCss(_,l){return this._css.get(_,l)}setColor(_,l,m){this._color.set(_,l,m)}getColor(_,l){return this._color.get(_,l)}clear(){this._color.clear(),this._css.clear()}}},997:function(c,r,a){var u=this&&this.__decorate||function(E,b,k,R){var I,P=arguments.length,L=P<3?b:R===null?R=Object.getOwnPropertyDescriptor(b,k):R;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")L=Reflect.decorate(E,b,k,R);else for(var z=E.length-1;z>=0;z--)(I=E[z])&&(L=(P<3?I(L):P>3?I(b,k,L):I(b,k))||L);return P>3&&L&&Object.defineProperty(b,k,L),L},_=this&&this.__param||function(E,b){return function(k,R){b(k,R,E)}};Object.defineProperty(r,"__esModule",{value:!0}),r.ThemeService=r.DEFAULT_ANSI_COLORS=void 0;const l=a(930),m=a(160),g=a(345),C=a(859),y=a(97),h=m.css.toColor("#ffffff"),f=m.css.toColor("#000000"),d=m.css.toColor("#ffffff"),p=m.css.toColor("#000000"),v={css:"rgba(255, 255, 255, 0.3)",rgba:4294967117};r.DEFAULT_ANSI_COLORS=Object.freeze((()=>{const E=[m.css.toColor("#2e3436"),m.css.toColor("#cc0000"),m.css.toColor("#4e9a06"),m.css.toColor("#c4a000"),m.css.toColor("#3465a4"),m.css.toColor("#75507b"),m.css.toColor("#06989a"),m.css.toColor("#d3d7cf"),m.css.toColor("#555753"),m.css.toColor("#ef2929"),m.css.toColor("#8ae234"),m.css.toColor("#fce94f"),m.css.toColor("#729fcf"),m.css.toColor("#ad7fa8"),m.css.toColor("#34e2e2"),m.css.toColor("#eeeeec")],b=[0,95,135,175,215,255];for(let k=0;k<216;k++){const R=b[k/36%6|0],I=b[k/6%6|0],P=b[k%6];E.push({css:m.channels.toCss(R,I,P),rgba:m.channels.toRgba(R,I,P)})}for(let k=0;k<24;k++){const R=8+10*k;E.push({css:m.channels.toCss(R,R,R),rgba:m.channels.toRgba(R,R,R)})}return E})());let S=r.ThemeService=class extends C.Disposable{get colors(){return this._colors}constructor(E){super(),this._optionsService=E,this._contrastCache=new l.ColorContrastCache,this._halfContrastCache=new l.ColorContrastCache,this._onChangeColors=this.register(new g.EventEmitter),this.onChangeColors=this._onChangeColors.event,this._colors={foreground:h,background:f,cursor:d,cursorAccent:p,selectionForeground:void 0,selectionBackgroundTransparent:v,selectionBackgroundOpaque:m.color.blend(f,v),selectionInactiveBackgroundTransparent:v,selectionInactiveBackgroundOpaque:m.color.blend(f,v),ansi:r.DEFAULT_ANSI_COLORS.slice(),contrastCache:this._contrastCache,halfContrastCache:this._halfContrastCache},this._updateRestoreColors(),this._setTheme(this._optionsService.rawOptions.theme),this.register(this._optionsService.onSpecificOptionChange("minimumContrastRatio",(()=>this._contrastCache.clear()))),this.register(this._optionsService.onSpecificOptionChange("theme",(()=>this._setTheme(this._optionsService.rawOptions.theme))))}_setTheme(E={}){const b=this._colors;if(b.foreground=w(E.foreground,h),b.background=w(E.background,f),b.cursor=w(E.cursor,d),b.cursorAccent=w(E.cursorAccent,p),b.selectionBackgroundTransparent=w(E.selectionBackground,v),b.selectionBackgroundOpaque=m.color.blend(b.background,b.selectionBackgroundTransparent),b.selectionInactiveBackgroundTransparent=w(E.selectionInactiveBackground,b.selectionBackgroundTransparent),b.selectionInactiveBackgroundOpaque=m.color.blend(b.background,b.selectionInactiveBackgroundTransparent),b.selectionForeground=E.selectionForeground?w(E.selectionForeground,m.NULL_COLOR):void 0,b.selectionForeground===m.NULL_COLOR&&(b.selectionForeground=void 0),m.color.isOpaque(b.selectionBackgroundTransparent)&&(b.selectionBackgroundTransparent=m.color.opacity(b.selectionBackgroundTransparent,.3)),m.color.isOpaque(b.selectionInactiveBackgroundTransparent)&&(b.selectionInactiveBackgroundTransparent=m.color.opacity(b.selectionInactiveBackgroundTransparent,.3)),b.ansi=r.DEFAULT_ANSI_COLORS.slice(),b.ansi[0]=w(E.black,r.DEFAULT_ANSI_COLORS[0]),b.ansi[1]=w(E.red,r.DEFAULT_ANSI_COLORS[1]),b.ansi[2]=w(E.green,r.DEFAULT_ANSI_COLORS[2]),b.ansi[3]=w(E.yellow,r.DEFAULT_ANSI_COLORS[3]),b.ansi[4]=w(E.blue,r.DEFAULT_ANSI_COLORS[4]),b.ansi[5]=w(E.magenta,r.DEFAULT_ANSI_COLORS[5]),b.ansi[6]=w(E.cyan,r.DEFAULT_ANSI_COLORS[6]),b.ansi[7]=w(E.white,r.DEFAULT_ANSI_COLORS[7]),b.ansi[8]=w(E.brightBlack,r.DEFAULT_ANSI_COLORS[8]),b.ansi[9]=w(E.brightRed,r.DEFAULT_ANSI_COLORS[9]),b.ansi[10]=w(E.brightGreen,r.DEFAULT_ANSI_COLORS[10]),b.ansi[11]=w(E.brightYellow,r.DEFAULT_ANSI_COLORS[11]),b.ansi[12]=w(E.brightBlue,r.DEFAULT_ANSI_COLORS[12]),b.ansi[13]=w(E.brightMagenta,r.DEFAULT_ANSI_COLORS[13]),b.ansi[14]=w(E.brightCyan,r.DEFAULT_ANSI_COLORS[14]),b.ansi[15]=w(E.brightWhite,r.DEFAULT_ANSI_COLORS[15]),E.extendedAnsi){const k=Math.min(b.ansi.length-16,E.extendedAnsi.length);for(let R=0;R<k;R++)b.ansi[R+16]=w(E.extendedAnsi[R],r.DEFAULT_ANSI_COLORS[R+16])}this._contrastCache.clear(),this._halfContrastCache.clear(),this._updateRestoreColors(),this._onChangeColors.fire(this.colors)}restoreColor(E){this._restoreColor(E),this._onChangeColors.fire(this.colors)}_restoreColor(E){if(E!==void 0)switch(E){case 256:this._colors.foreground=this._restoreColors.foreground;break;case 257:this._colors.background=this._restoreColors.background;break;case 258:this._colors.cursor=this._restoreColors.cursor;break;default:this._colors.ansi[E]=this._restoreColors.ansi[E]}else for(let b=0;b<this._restoreColors.ansi.length;++b)this._colors.ansi[b]=this._restoreColors.ansi[b]}modifyColors(E){E(this._colors),this._onChangeColors.fire(this.colors)}_updateRestoreColors(){this._restoreColors={foreground:this._colors.foreground,background:this._colors.background,cursor:this._colors.cursor,ansi:this._colors.ansi.slice()}}};function w(E,b){if(E!==void 0)try{return m.css.toColor(E)}catch{}return b}r.ThemeService=S=u([_(0,y.IOptionsService)],S)},160:(c,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.contrastRatio=r.toPaddedHex=r.rgba=r.rgb=r.css=r.color=r.channels=r.NULL_COLOR=void 0;let a=0,u=0,_=0,l=0;var m,g,C,y,h;function f(p){const v=p.toString(16);return v.length<2?"0"+v:v}function d(p,v){return p<v?(v+.05)/(p+.05):(p+.05)/(v+.05)}r.NULL_COLOR={css:"#00000000",rgba:0},(function(p){p.toCss=function(v,S,w,E){return E!==void 0?`#${f(v)}${f(S)}${f(w)}${f(E)}`:`#${f(v)}${f(S)}${f(w)}`},p.toRgba=function(v,S,w,E=255){return(v<<24|S<<16|w<<8|E)>>>0},p.toColor=function(v,S,w,E){return{css:p.toCss(v,S,w,E),rgba:p.toRgba(v,S,w,E)}}})(m||(r.channels=m={})),(function(p){function v(S,w){return l=Math.round(255*w),[a,u,_]=h.toChannels(S.rgba),{css:m.toCss(a,u,_,l),rgba:m.toRgba(a,u,_,l)}}p.blend=function(S,w){if(l=(255&w.rgba)/255,l===1)return{css:w.css,rgba:w.rgba};const E=w.rgba>>24&255,b=w.rgba>>16&255,k=w.rgba>>8&255,R=S.rgba>>24&255,I=S.rgba>>16&255,P=S.rgba>>8&255;return a=R+Math.round((E-R)*l),u=I+Math.round((b-I)*l),_=P+Math.round((k-P)*l),{css:m.toCss(a,u,_),rgba:m.toRgba(a,u,_)}},p.isOpaque=function(S){return(255&S.rgba)==255},p.ensureContrastRatio=function(S,w,E){const b=h.ensureContrastRatio(S.rgba,w.rgba,E);if(b)return m.toColor(b>>24&255,b>>16&255,b>>8&255)},p.opaque=function(S){const w=(255|S.rgba)>>>0;return[a,u,_]=h.toChannels(w),{css:m.toCss(a,u,_),rgba:w}},p.opacity=v,p.multiplyOpacity=function(S,w){return l=255&S.rgba,v(S,l*w/255)},p.toColorRGB=function(S){return[S.rgba>>24&255,S.rgba>>16&255,S.rgba>>8&255]}})(g||(r.color=g={})),(function(p){let v,S;try{const w=document.createElement("canvas");w.width=1,w.height=1;const E=w.getContext("2d",{willReadFrequently:!0});E&&(v=E,v.globalCompositeOperation="copy",S=v.createLinearGradient(0,0,1,1))}catch{}p.toColor=function(w){if(w.match(/#[\da-f]{3,8}/i))switch(w.length){case 4:return a=parseInt(w.slice(1,2).repeat(2),16),u=parseInt(w.slice(2,3).repeat(2),16),_=parseInt(w.slice(3,4).repeat(2),16),m.toColor(a,u,_);case 5:return a=parseInt(w.slice(1,2).repeat(2),16),u=parseInt(w.slice(2,3).repeat(2),16),_=parseInt(w.slice(3,4).repeat(2),16),l=parseInt(w.slice(4,5).repeat(2),16),m.toColor(a,u,_,l);case 7:return{css:w,rgba:(parseInt(w.slice(1),16)<<8|255)>>>0};case 9:return{css:w,rgba:parseInt(w.slice(1),16)>>>0}}const E=w.match(/rgba?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(,\s*(0|1|\d?\.(\d+))\s*)?\)/);if(E)return a=parseInt(E[1]),u=parseInt(E[2]),_=parseInt(E[3]),l=Math.round(255*(E[5]===void 0?1:parseFloat(E[5]))),m.toColor(a,u,_,l);if(!v||!S)throw new Error("css.toColor: Unsupported css format");if(v.fillStyle=S,v.fillStyle=w,typeof v.fillStyle!="string")throw new Error("css.toColor: Unsupported css format");if(v.fillRect(0,0,1,1),[a,u,_,l]=v.getImageData(0,0,1,1).data,l!==255)throw new Error("css.toColor: Unsupported css format");return{rgba:m.toRgba(a,u,_,l),css:w}}})(C||(r.css=C={})),(function(p){function v(S,w,E){const b=S/255,k=w/255,R=E/255;return .2126*(b<=.03928?b/12.92:Math.pow((b+.055)/1.055,2.4))+.7152*(k<=.03928?k/12.92:Math.pow((k+.055)/1.055,2.4))+.0722*(R<=.03928?R/12.92:Math.pow((R+.055)/1.055,2.4))}p.relativeLuminance=function(S){return v(S>>16&255,S>>8&255,255&S)},p.relativeLuminance2=v})(y||(r.rgb=y={})),(function(p){function v(w,E,b){const k=w>>24&255,R=w>>16&255,I=w>>8&255;let P=E>>24&255,L=E>>16&255,z=E>>8&255,J=d(y.relativeLuminance2(P,L,z),y.relativeLuminance2(k,R,I));for(;J<b&&(P>0||L>0||z>0);)P-=Math.max(0,Math.ceil(.1*P)),L-=Math.max(0,Math.ceil(.1*L)),z-=Math.max(0,Math.ceil(.1*z)),J=d(y.relativeLuminance2(P,L,z),y.relativeLuminance2(k,R,I));return(P<<24|L<<16|z<<8|255)>>>0}function S(w,E,b){const k=w>>24&255,R=w>>16&255,I=w>>8&255;let P=E>>24&255,L=E>>16&255,z=E>>8&255,J=d(y.relativeLuminance2(P,L,z),y.relativeLuminance2(k,R,I));for(;J<b&&(P<255||L<255||z<255);)P=Math.min(255,P+Math.ceil(.1*(255-P))),L=Math.min(255,L+Math.ceil(.1*(255-L))),z=Math.min(255,z+Math.ceil(.1*(255-z))),J=d(y.relativeLuminance2(P,L,z),y.relativeLuminance2(k,R,I));return(P<<24|L<<16|z<<8|255)>>>0}p.blend=function(w,E){if(l=(255&E)/255,l===1)return E;const b=E>>24&255,k=E>>16&255,R=E>>8&255,I=w>>24&255,P=w>>16&255,L=w>>8&255;return a=I+Math.round((b-I)*l),u=P+Math.round((k-P)*l),_=L+Math.round((R-L)*l),m.toRgba(a,u,_)},p.ensureContrastRatio=function(w,E,b){const k=y.relativeLuminance(w>>8),R=y.relativeLuminance(E>>8);if(d(k,R)<b){if(R<k){const L=v(w,E,b),z=d(k,y.relativeLuminance(L>>8));if(z<b){const J=S(w,E,b);return z>d(k,y.relativeLuminance(J>>8))?L:J}return L}const I=S(w,E,b),P=d(k,y.relativeLuminance(I>>8));if(P<b){const L=v(w,E,b);return P>d(k,y.relativeLuminance(L>>8))?I:L}return I}},p.reduceLuminance=v,p.increaseLuminance=S,p.toChannels=function(w){return[w>>24&255,w>>16&255,w>>8&255,255&w]}})(h||(r.rgba=h={})),r.toPaddedHex=f,r.contrastRatio=d},345:(c,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.runAndSubscribe=r.forwardEvent=r.EventEmitter=void 0,r.EventEmitter=class{constructor(){this._listeners=[],this._disposed=!1}get event(){return this._event||(this._event=a=>(this._listeners.push(a),{dispose:()=>{if(!this._disposed){for(let u=0;u<this._listeners.length;u++)if(this._listeners[u]===a)return void this._listeners.splice(u,1)}}})),this._event}fire(a,u){const _=[];for(let l=0;l<this._listeners.length;l++)_.push(this._listeners[l]);for(let l=0;l<_.length;l++)_[l].call(void 0,a,u)}dispose(){this.clearListeners(),this._disposed=!0}clearListeners(){this._listeners&&(this._listeners.length=0)}},r.forwardEvent=function(a,u){return a((_=>u.fire(_)))},r.runAndSubscribe=function(a,u){return u(void 0),a((_=>u(_)))}},859:(c,r)=>{function a(u){for(const _ of u)_.dispose();u.length=0}Object.defineProperty(r,"__esModule",{value:!0}),r.getDisposeArrayDisposable=r.disposeArray=r.toDisposable=r.MutableDisposable=r.Disposable=void 0,r.Disposable=class{constructor(){this._disposables=[],this._isDisposed=!1}dispose(){this._isDisposed=!0;for(const u of this._disposables)u.dispose();this._disposables.length=0}register(u){return this._disposables.push(u),u}unregister(u){const _=this._disposables.indexOf(u);_!==-1&&this._disposables.splice(_,1)}},r.MutableDisposable=class{constructor(){this._isDisposed=!1}get value(){return this._isDisposed?void 0:this._value}set value(u){this._isDisposed||u===this._value||(this._value?.dispose(),this._value=u)}clear(){this.value=void 0}dispose(){this._isDisposed=!0,this._value?.dispose(),this._value=void 0}},r.toDisposable=function(u){return{dispose:u}},r.disposeArray=a,r.getDisposeArrayDisposable=function(u){return{dispose:()=>a(u)}}},485:(c,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.FourKeyMap=r.TwoKeyMap=void 0;class a{constructor(){this._data={}}set(_,l,m){this._data[_]||(this._data[_]={}),this._data[_][l]=m}get(_,l){return this._data[_]?this._data[_][l]:void 0}clear(){this._data={}}}r.TwoKeyMap=a,r.FourKeyMap=class{constructor(){this._data=new a}set(u,_,l,m,g){this._data.get(u,_)||this._data.set(u,_,new a),this._data.get(u,_).set(l,m,g)}get(u,_,l,m){return this._data.get(u,_)?.get(l,m)}clear(){this._data.clear()}}},726:(c,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.createDecorator=r.getServiceDependencies=r.serviceRegistry=void 0;const a="di$target",u="di$dependencies";r.serviceRegistry=new Map,r.getServiceDependencies=function(_){return _[u]||[]},r.createDecorator=function(_){if(r.serviceRegistry.has(_))return r.serviceRegistry.get(_);const l=function(m,g,C){if(arguments.length!==3)throw new Error("@IServiceName-decorator can only be used to decorate a parameter");(function(y,h,f){h[a]===h?h[u].push({id:y,index:f}):(h[u]=[{id:y,index:f}],h[a]=h)})(l,m,C)};return l.toString=()=>_,r.serviceRegistry.set(_,l),l}},97:(c,r,a)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.IDecorationService=r.IUnicodeService=r.IOscLinkService=r.IOptionsService=r.ILogService=r.LogLevelEnum=r.IInstantiationService=r.ICharsetService=r.ICoreService=r.ICoreMouseService=r.IBufferService=void 0;const u=a(726);var _;r.IBufferService=(0,u.createDecorator)("BufferService"),r.ICoreMouseService=(0,u.createDecorator)("CoreMouseService"),r.ICoreService=(0,u.createDecorator)("CoreService"),r.ICharsetService=(0,u.createDecorator)("CharsetService"),r.IInstantiationService=(0,u.createDecorator)("InstantiationService"),(function(l){l[l.TRACE=0]="TRACE",l[l.DEBUG=1]="DEBUG",l[l.INFO=2]="INFO",l[l.WARN=3]="WARN",l[l.ERROR=4]="ERROR",l[l.OFF=5]="OFF"})(_||(r.LogLevelEnum=_={})),r.ILogService=(0,u.createDecorator)("LogService"),r.IOptionsService=(0,u.createDecorator)("OptionsService"),r.IOscLinkService=(0,u.createDecorator)("OscLinkService"),r.IUnicodeService=(0,u.createDecorator)("UnicodeService"),r.IDecorationService=(0,u.createDecorator)("DecorationService")}},s={};function n(c){var r=s[c];if(r!==void 0)return r.exports;var a=s[c]={exports:{}};return i[c].call(a.exports,a,a.exports,n),a.exports}var o={};return(()=>{var c=o;Object.defineProperty(c,"__esModule",{value:!0}),c.HTMLSerializeHandler=c.SerializeAddon=void 0;const r=n(997);function a(y,h,f){return Math.max(h,Math.min(y,f))}class u{constructor(h){this._buffer=h}serialize(h,f){const d=this._buffer.getNullCell(),p=this._buffer.getNullCell();let v=d;const S=h.start.y,w=h.end.y,E=h.start.x,b=h.end.x;this._beforeSerialize(w-S,S,w);for(let k=S;k<=w;k++){const R=this._buffer.getLine(k);if(R){const I=k===h.start.y?E:0,P=k===h.end.y?b:R.length;for(let L=I;L<P;L++){const z=R.getCell(L,v===d?p:d);z?(this._nextCell(z,v,k,L),v=z):console.warn(`Can't get cell at row=${k}, col=${L}`)}}this._rowEnd(k,k===w)}return this._afterSerialize(),this._serializeString(f)}_nextCell(h,f,d,p){}_rowEnd(h,f){}_beforeSerialize(h,f,d){}_afterSerialize(){}_serializeString(h){return""}}function _(y,h){return y.getFgColorMode()===h.getFgColorMode()&&y.getFgColor()===h.getFgColor()}function l(y,h){return y.getBgColorMode()===h.getBgColorMode()&&y.getBgColor()===h.getBgColor()}function m(y,h){return y.isInverse()===h.isInverse()&&y.isBold()===h.isBold()&&y.isUnderline()===h.isUnderline()&&y.isOverline()===h.isOverline()&&y.isBlink()===h.isBlink()&&y.isInvisible()===h.isInvisible()&&y.isItalic()===h.isItalic()&&y.isDim()===h.isDim()&&y.isStrikethrough()===h.isStrikethrough()}class g extends u{constructor(h,f){super(h),this._terminal=f,this._rowIndex=0,this._allRows=new Array,this._allRowSeparators=new Array,this._currentRow="",this._nullCellCount=0,this._cursorStyle=this._buffer.getNullCell(),this._cursorStyleRow=0,this._cursorStyleCol=0,this._backgroundCell=this._buffer.getNullCell(),this._firstRow=0,this._lastCursorRow=0,this._lastCursorCol=0,this._lastContentCursorRow=0,this._lastContentCursorCol=0,this._thisRowLastChar=this._buffer.getNullCell(),this._thisRowLastSecondChar=this._buffer.getNullCell(),this._nextRowFirstChar=this._buffer.getNullCell()}_beforeSerialize(h,f,d){this._allRows=new Array(h),this._lastContentCursorRow=f,this._lastCursorRow=f,this._firstRow=f}_rowEnd(h,f){this._nullCellCount>0&&!l(this._cursorStyle,this._backgroundCell)&&(this._currentRow+=`\x1B[${this._nullCellCount}X`);let d="";if(!f){h-this._firstRow>=this._terminal.rows&&this._buffer.getLine(this._cursorStyleRow)?.getCell(this._cursorStyleCol,this._backgroundCell);const p=this._buffer.getLine(h),v=this._buffer.getLine(h+1);if(v.isWrapped){d="";const S=p.getCell(p.length-1,this._thisRowLastChar),w=p.getCell(p.length-2,this._thisRowLastSecondChar),E=v.getCell(0,this._nextRowFirstChar),b=E.getWidth()>1;let k=!1;(E.getChars()&&b?this._nullCellCount<=1:this._nullCellCount<=0)&&((S.getChars()||S.getWidth()===0)&&l(S,E)&&(k=!0),b&&(w.getChars()||w.getWidth()===0)&&l(S,E)&&l(w,E)&&(k=!0)),k||(d="-".repeat(this._nullCellCount+1),d+="\x1B[1D\x1B[1X",this._nullCellCount>0&&(d+="\x1B[A",d+=`\x1B[${p.length-this._nullCellCount}C`,d+=`\x1B[${this._nullCellCount}X`,d+=`\x1B[${p.length-this._nullCellCount}D`,d+="\x1B[B"),this._lastContentCursorRow=h+1,this._lastContentCursorCol=0,this._lastCursorRow=h+1,this._lastCursorCol=0)}else d=`\r
`,this._lastCursorRow=h+1,this._lastCursorCol=0}this._allRows[this._rowIndex]=this._currentRow,this._allRowSeparators[this._rowIndex++]=d,this._currentRow="",this._nullCellCount=0}_diffStyle(h,f){const d=[],p=!_(h,f),v=!l(h,f),S=!m(h,f);if(p||v||S)if(h.isAttributeDefault())f.isAttributeDefault()||d.push(0);else{if(p){const w=h.getFgColor();h.isFgRGB()?d.push(38,2,w>>>16&255,w>>>8&255,255&w):h.isFgPalette()?w>=16?d.push(38,5,w):d.push(8&w?90+(7&w):30+(7&w)):d.push(39)}if(v){const w=h.getBgColor();h.isBgRGB()?d.push(48,2,w>>>16&255,w>>>8&255,255&w):h.isBgPalette()?w>=16?d.push(48,5,w):d.push(8&w?100+(7&w):40+(7&w)):d.push(49)}S&&(h.isInverse()!==f.isInverse()&&d.push(h.isInverse()?7:27),h.isBold()!==f.isBold()&&d.push(h.isBold()?1:22),h.isUnderline()!==f.isUnderline()&&d.push(h.isUnderline()?4:24),h.isOverline()!==f.isOverline()&&d.push(h.isOverline()?53:55),h.isBlink()!==f.isBlink()&&d.push(h.isBlink()?5:25),h.isInvisible()!==f.isInvisible()&&d.push(h.isInvisible()?8:28),h.isItalic()!==f.isItalic()&&d.push(h.isItalic()?3:23),h.isDim()!==f.isDim()&&d.push(h.isDim()?2:22),h.isStrikethrough()!==f.isStrikethrough()&&d.push(h.isStrikethrough()?9:29))}return d}_nextCell(h,f,d,p){if(h.getWidth()===0)return;const v=h.getChars()==="",S=this._diffStyle(h,this._cursorStyle);if(v?!l(this._cursorStyle,h):S.length>0){this._nullCellCount>0&&(l(this._cursorStyle,this._backgroundCell)||(this._currentRow+=`\x1B[${this._nullCellCount}X`),this._currentRow+=`\x1B[${this._nullCellCount}C`,this._nullCellCount=0),this._lastContentCursorRow=this._lastCursorRow=d,this._lastContentCursorCol=this._lastCursorCol=p,this._currentRow+=`\x1B[${S.join(";")}m`;const w=this._buffer.getLine(d);w!==void 0&&(w.getCell(p,this._cursorStyle),this._cursorStyleRow=d,this._cursorStyleCol=p)}v?this._nullCellCount+=h.getWidth():(this._nullCellCount>0&&(l(this._cursorStyle,this._backgroundCell)||(this._currentRow+=`\x1B[${this._nullCellCount}X`),this._currentRow+=`\x1B[${this._nullCellCount}C`,this._nullCellCount=0),this._currentRow+=h.getChars(),this._lastContentCursorRow=this._lastCursorRow=d,this._lastContentCursorCol=this._lastCursorCol=p+h.getWidth())}_serializeString(h){let f=this._allRows.length;this._buffer.length-this._firstRow<=this._terminal.rows&&(f=this._lastContentCursorRow+1-this._firstRow,this._lastCursorCol=this._lastContentCursorCol,this._lastCursorRow=this._lastContentCursorRow);let d="";for(let w=0;w<f;w++)d+=this._allRows[w],w+1<f&&(d+=this._allRowSeparators[w]);if(!h){const w=this._buffer.baseY+this._buffer.cursorY,E=this._buffer.cursorX,b=k=>{k>0?d+=`\x1B[${k}C`:k<0&&(d+=`\x1B[${-k}D`)};(w!==this._lastCursorRow||E!==this._lastCursorCol)&&((p=w-this._lastCursorRow)>0?d+=`\x1B[${p}B`:p<0&&(d+=`\x1B[${-p}A`),b(E-this._lastCursorCol))}var p;const v=this._terminal._core._inputHandler._curAttrData,S=this._diffStyle(v,this._cursorStyle);return S.length>0&&(d+=`\x1B[${S.join(";")}m`),d}}c.SerializeAddon=class{activate(y){this._terminal=y}_serializeBufferByScrollback(y,h,f){const d=h.length,p=f===void 0?d:a(f+y.rows,0,d);return this._serializeBufferByRange(y,h,{start:d-p,end:d-1},!1)}_serializeBufferByRange(y,h,f,d){return new g(h,y).serialize({start:{x:0,y:typeof f.start=="number"?f.start:f.start.line},end:{x:y.cols,y:typeof f.end=="number"?f.end:f.end.line}},d)}_serializeBufferAsHTML(y,h){const f=y.buffer.active,d=new C(f,y,h);if(!h.onlySelection){const v=f.length,S=h.scrollback,w=S===void 0?v:a(S+y.rows,0,v);return d.serialize({start:{x:0,y:v-w},end:{x:y.cols,y:v-1}})}const p=this._terminal?.getSelectionPosition();return p!==void 0?d.serialize({start:{x:p.start.x,y:p.start.y},end:{x:p.end.x,y:p.end.y}}):""}_serializeModes(y){let h="";const f=y.modes;if(f.applicationCursorKeysMode&&(h+="\x1B[?1h"),f.applicationKeypadMode&&(h+="\x1B[?66h"),f.bracketedPasteMode&&(h+="\x1B[?2004h"),f.insertMode&&(h+="\x1B[4h"),f.originMode&&(h+="\x1B[?6h"),f.reverseWraparoundMode&&(h+="\x1B[?45h"),f.sendFocusMode&&(h+="\x1B[?1004h"),f.wraparoundMode===!1&&(h+="\x1B[?7l"),f.mouseTrackingMode!=="none")switch(f.mouseTrackingMode){case"x10":h+="\x1B[?9h";break;case"vt200":h+="\x1B[?1000h";break;case"drag":h+="\x1B[?1002h";break;case"any":h+="\x1B[?1003h"}return h}serialize(y){if(!this._terminal)throw new Error("Cannot use addon until it has been loaded");let h=y?.range?this._serializeBufferByRange(this._terminal,this._terminal.buffer.normal,y.range,!0):this._serializeBufferByScrollback(this._terminal,this._terminal.buffer.normal,y?.scrollback);return y?.excludeAltBuffer||this._terminal.buffer.active.type!=="alternate"||(h+=`\x1B[?1049h\x1B[H${this._serializeBufferByScrollback(this._terminal,this._terminal.buffer.alternate,void 0)}`),y?.excludeModes||(h+=this._serializeModes(this._terminal)),h}serializeAsHTML(y){if(!this._terminal)throw new Error("Cannot use addon until it has been loaded");return this._serializeBufferAsHTML(this._terminal,y||{})}dispose(){}};class C extends u{constructor(h,f,d){super(h),this._terminal=f,this._options=d,this._currentRow="",this._htmlContent="",f._core._themeService?this._ansiColors=f._core._themeService.colors.ansi:this._ansiColors=r.DEFAULT_ANSI_COLORS}_padStart(h,f,d){return f>>=0,d=d??" ",h.length>f?h:((f-=h.length)>d.length&&(d+=d.repeat(f/d.length)),d.slice(0,f)+h)}_beforeSerialize(h,f,d){this._htmlContent+="<html><body><!--StartFragment--><pre>";let p="#000000",v="#ffffff";this._options.includeGlobalBackground&&(p=this._terminal.options.theme?.foreground??"#ffffff",v=this._terminal.options.theme?.background??"#000000");const S=[];S.push("color: "+p+";"),S.push("background-color: "+v+";"),S.push("font-family: "+this._terminal.options.fontFamily+";"),S.push("font-size: "+this._terminal.options.fontSize+"px;"),this._htmlContent+="<div style='"+S.join(" ")+"'>"}_afterSerialize(){this._htmlContent+="</div>",this._htmlContent+="</pre><!--EndFragment--></body></html>"}_rowEnd(h,f){this._htmlContent+="<div><span>"+this._currentRow+"</span></div>",this._currentRow=""}_getHexColor(h,f){const d=f?h.getFgColor():h.getBgColor();return(f?h.isFgRGB():h.isBgRGB())?"#"+[d>>16&255,d>>8&255,255&d].map((p=>this._padStart(p.toString(16),2,"0"))).join(""):(f?h.isFgPalette():h.isBgPalette())?this._ansiColors[d].css:void 0}_diffStyle(h,f){const d=[],p=!_(h,f),v=!l(h,f),S=!m(h,f);if(p||v||S){const w=this._getHexColor(h,!0);w&&d.push("color: "+w+";");const E=this._getHexColor(h,!1);return E&&d.push("background-color: "+E+";"),h.isInverse()&&d.push("color: #000000; background-color: #BFBFBF;"),h.isBold()&&d.push("font-weight: bold;"),h.isUnderline()&&h.isOverline()?d.push("text-decoration: overline underline;"):h.isUnderline()?d.push("text-decoration: underline;"):h.isOverline()&&d.push("text-decoration: overline;"),h.isBlink()&&d.push("text-decoration: blink;"),h.isInvisible()&&d.push("visibility: hidden;"),h.isItalic()&&d.push("font-style: italic;"),h.isDim()&&d.push("opacity: 0.5;"),h.isStrikethrough()&&d.push("text-decoration: line-through;"),d}}_nextCell(h,f,d,p){if(h.getWidth()===0)return;const v=h.getChars()==="",S=this._diffStyle(h,f);S&&(this._currentRow+=S.length===0?"</span><span>":"</span><span style='"+S.join(" ")+"'>"),this._currentRow+=v?" ":h.getChars()}_serializeString(){return this._htmlContent}}c.HTMLSerializeHandler=C})(),o})()))})(tr)),tr.exports}var Gp=jp(),rn={exports:{}},da;function Vp(){return da||(da=1,(function(e,t){(function(i,s){e.exports=s()})(globalThis,(()=>(()=>{var i={4567:function(c,r,a){var u=this&&this.__decorate||function(d,p,v,S){var w,E=arguments.length,b=E<3?p:S===null?S=Object.getOwnPropertyDescriptor(p,v):S;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")b=Reflect.decorate(d,p,v,S);else for(var k=d.length-1;k>=0;k--)(w=d[k])&&(b=(E<3?w(b):E>3?w(p,v,b):w(p,v))||b);return E>3&&b&&Object.defineProperty(p,v,b),b},_=this&&this.__param||function(d,p){return function(v,S){p(v,S,d)}};Object.defineProperty(r,"__esModule",{value:!0}),r.AccessibilityManager=void 0;const l=a(9042),m=a(9924),g=a(844),C=a(4725),y=a(2585),h=a(3656);let f=r.AccessibilityManager=class extends g.Disposable{constructor(d,p,v,S){super(),this._terminal=d,this._coreBrowserService=v,this._renderService=S,this._rowColumns=new WeakMap,this._liveRegionLineCount=0,this._charsToConsume=[],this._charsToAnnounce="",this._accessibilityContainer=this._coreBrowserService.mainDocument.createElement("div"),this._accessibilityContainer.classList.add("xterm-accessibility"),this._rowContainer=this._coreBrowserService.mainDocument.createElement("div"),this._rowContainer.setAttribute("role","list"),this._rowContainer.classList.add("xterm-accessibility-tree"),this._rowElements=[];for(let w=0;w<this._terminal.rows;w++)this._rowElements[w]=this._createAccessibilityTreeNode(),this._rowContainer.appendChild(this._rowElements[w]);if(this._topBoundaryFocusListener=w=>this._handleBoundaryFocus(w,0),this._bottomBoundaryFocusListener=w=>this._handleBoundaryFocus(w,1),this._rowElements[0].addEventListener("focus",this._topBoundaryFocusListener),this._rowElements[this._rowElements.length-1].addEventListener("focus",this._bottomBoundaryFocusListener),this._refreshRowsDimensions(),this._accessibilityContainer.appendChild(this._rowContainer),this._liveRegion=this._coreBrowserService.mainDocument.createElement("div"),this._liveRegion.classList.add("live-region"),this._liveRegion.setAttribute("aria-live","assertive"),this._accessibilityContainer.appendChild(this._liveRegion),this._liveRegionDebouncer=this.register(new m.TimeBasedDebouncer(this._renderRows.bind(this))),!this._terminal.element)throw new Error("Cannot enable accessibility before Terminal.open");this._terminal.element.insertAdjacentElement("afterbegin",this._accessibilityContainer),this.register(this._terminal.onResize((w=>this._handleResize(w.rows)))),this.register(this._terminal.onRender((w=>this._refreshRows(w.start,w.end)))),this.register(this._terminal.onScroll((()=>this._refreshRows()))),this.register(this._terminal.onA11yChar((w=>this._handleChar(w)))),this.register(this._terminal.onLineFeed((()=>this._handleChar(`
`)))),this.register(this._terminal.onA11yTab((w=>this._handleTab(w)))),this.register(this._terminal.onKey((w=>this._handleKey(w.key)))),this.register(this._terminal.onBlur((()=>this._clearLiveRegion()))),this.register(this._renderService.onDimensionsChange((()=>this._refreshRowsDimensions()))),this.register((0,h.addDisposableDomListener)(document,"selectionchange",(()=>this._handleSelectionChange()))),this.register(this._coreBrowserService.onDprChange((()=>this._refreshRowsDimensions()))),this._refreshRows(),this.register((0,g.toDisposable)((()=>{this._accessibilityContainer.remove(),this._rowElements.length=0})))}_handleTab(d){for(let p=0;p<d;p++)this._handleChar(" ")}_handleChar(d){this._liveRegionLineCount<21&&(this._charsToConsume.length>0?this._charsToConsume.shift()!==d&&(this._charsToAnnounce+=d):this._charsToAnnounce+=d,d===`
`&&(this._liveRegionLineCount++,this._liveRegionLineCount===21&&(this._liveRegion.textContent+=l.tooMuchOutput)))}_clearLiveRegion(){this._liveRegion.textContent="",this._liveRegionLineCount=0}_handleKey(d){this._clearLiveRegion(),new RegExp("\\p{Control}","u").test(d)||this._charsToConsume.push(d)}_refreshRows(d,p){this._liveRegionDebouncer.refresh(d,p,this._terminal.rows)}_renderRows(d,p){const v=this._terminal.buffer,S=v.lines.length.toString();for(let w=d;w<=p;w++){const E=v.lines.get(v.ydisp+w),b=[],k=E?.translateToString(!0,void 0,void 0,b)||"",R=(v.ydisp+w+1).toString(),I=this._rowElements[w];I&&(k.length===0?(I.innerText="",this._rowColumns.set(I,[0,1])):(I.textContent=k,this._rowColumns.set(I,b)),I.setAttribute("aria-posinset",R),I.setAttribute("aria-setsize",S))}this._announceCharacters()}_announceCharacters(){this._charsToAnnounce.length!==0&&(this._liveRegion.textContent+=this._charsToAnnounce,this._charsToAnnounce="")}_handleBoundaryFocus(d,p){const v=d.target,S=this._rowElements[p===0?1:this._rowElements.length-2];if(v.getAttribute("aria-posinset")===(p===0?"1":`${this._terminal.buffer.lines.length}`)||d.relatedTarget!==S)return;let w,E;if(p===0?(w=v,E=this._rowElements.pop(),this._rowContainer.removeChild(E)):(w=this._rowElements.shift(),E=v,this._rowContainer.removeChild(w)),w.removeEventListener("focus",this._topBoundaryFocusListener),E.removeEventListener("focus",this._bottomBoundaryFocusListener),p===0){const b=this._createAccessibilityTreeNode();this._rowElements.unshift(b),this._rowContainer.insertAdjacentElement("afterbegin",b)}else{const b=this._createAccessibilityTreeNode();this._rowElements.push(b),this._rowContainer.appendChild(b)}this._rowElements[0].addEventListener("focus",this._topBoundaryFocusListener),this._rowElements[this._rowElements.length-1].addEventListener("focus",this._bottomBoundaryFocusListener),this._terminal.scrollLines(p===0?-1:1),this._rowElements[p===0?1:this._rowElements.length-2].focus(),d.preventDefault(),d.stopImmediatePropagation()}_handleSelectionChange(){if(this._rowElements.length===0)return;const d=document.getSelection();if(!d)return;if(d.isCollapsed)return void(this._rowContainer.contains(d.anchorNode)&&this._terminal.clearSelection());if(!d.anchorNode||!d.focusNode)return void console.error("anchorNode and/or focusNode are null");let p={node:d.anchorNode,offset:d.anchorOffset},v={node:d.focusNode,offset:d.focusOffset};if((p.node.compareDocumentPosition(v.node)&Node.DOCUMENT_POSITION_PRECEDING||p.node===v.node&&p.offset>v.offset)&&([p,v]=[v,p]),p.node.compareDocumentPosition(this._rowElements[0])&(Node.DOCUMENT_POSITION_CONTAINED_BY|Node.DOCUMENT_POSITION_FOLLOWING)&&(p={node:this._rowElements[0].childNodes[0],offset:0}),!this._rowContainer.contains(p.node))return;const S=this._rowElements.slice(-1)[0];if(v.node.compareDocumentPosition(S)&(Node.DOCUMENT_POSITION_CONTAINED_BY|Node.DOCUMENT_POSITION_PRECEDING)&&(v={node:S,offset:S.textContent?.length??0}),!this._rowContainer.contains(v.node))return;const w=({node:k,offset:R})=>{const I=k instanceof Text?k.parentNode:k;let P=parseInt(I?.getAttribute("aria-posinset"),10)-1;if(isNaN(P))return console.warn("row is invalid. Race condition?"),null;const L=this._rowColumns.get(I);if(!L)return console.warn("columns is null. Race condition?"),null;let z=R<L.length?L[R]:L.slice(-1)[0]+1;return z>=this._terminal.cols&&(++P,z=0),{row:P,column:z}},E=w(p),b=w(v);if(E&&b){if(E.row>b.row||E.row===b.row&&E.column>=b.column)throw new Error("invalid range");this._terminal.select(E.column,E.row,(b.row-E.row)*this._terminal.cols-E.column+b.column)}}_handleResize(d){this._rowElements[this._rowElements.length-1].removeEventListener("focus",this._bottomBoundaryFocusListener);for(let p=this._rowContainer.children.length;p<this._terminal.rows;p++)this._rowElements[p]=this._createAccessibilityTreeNode(),this._rowContainer.appendChild(this._rowElements[p]);for(;this._rowElements.length>d;)this._rowContainer.removeChild(this._rowElements.pop());this._rowElements[this._rowElements.length-1].addEventListener("focus",this._bottomBoundaryFocusListener),this._refreshRowsDimensions()}_createAccessibilityTreeNode(){const d=this._coreBrowserService.mainDocument.createElement("div");return d.setAttribute("role","listitem"),d.tabIndex=-1,this._refreshRowDimensions(d),d}_refreshRowsDimensions(){if(this._renderService.dimensions.css.cell.height){this._accessibilityContainer.style.width=`${this._renderService.dimensions.css.canvas.width}px`,this._rowElements.length!==this._terminal.rows&&this._handleResize(this._terminal.rows);for(let d=0;d<this._terminal.rows;d++)this._refreshRowDimensions(this._rowElements[d])}}_refreshRowDimensions(d){d.style.height=`${this._renderService.dimensions.css.cell.height}px`}};r.AccessibilityManager=f=u([_(1,y.IInstantiationService),_(2,C.ICoreBrowserService),_(3,C.IRenderService)],f)},3614:(c,r)=>{function a(m){return m.replace(/\r?\n/g,"\r")}function u(m,g){return g?"\x1B[200~"+m+"\x1B[201~":m}function _(m,g,C,y){m=u(m=a(m),C.decPrivateModes.bracketedPasteMode&&y.rawOptions.ignoreBracketedPasteMode!==!0),C.triggerDataEvent(m,!0),g.value=""}function l(m,g,C){const y=C.getBoundingClientRect(),h=m.clientX-y.left-10,f=m.clientY-y.top-10;g.style.width="20px",g.style.height="20px",g.style.left=`${h}px`,g.style.top=`${f}px`,g.style.zIndex="1000",g.focus()}Object.defineProperty(r,"__esModule",{value:!0}),r.rightClickHandler=r.moveTextAreaUnderMouseCursor=r.paste=r.handlePasteEvent=r.copyHandler=r.bracketTextForPaste=r.prepareTextForTerminal=void 0,r.prepareTextForTerminal=a,r.bracketTextForPaste=u,r.copyHandler=function(m,g){m.clipboardData&&m.clipboardData.setData("text/plain",g.selectionText),m.preventDefault()},r.handlePasteEvent=function(m,g,C,y){m.stopPropagation(),m.clipboardData&&_(m.clipboardData.getData("text/plain"),g,C,y)},r.paste=_,r.moveTextAreaUnderMouseCursor=l,r.rightClickHandler=function(m,g,C,y,h){l(m,g,C),h&&y.rightClickSelect(m),g.value=y.selectionText,g.select()}},7239:(c,r,a)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.ColorContrastCache=void 0;const u=a(1505);r.ColorContrastCache=class{constructor(){this._color=new u.TwoKeyMap,this._css=new u.TwoKeyMap}setCss(_,l,m){this._css.set(_,l,m)}getCss(_,l){return this._css.get(_,l)}setColor(_,l,m){this._color.set(_,l,m)}getColor(_,l){return this._color.get(_,l)}clear(){this._color.clear(),this._css.clear()}}},3656:(c,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.addDisposableDomListener=void 0,r.addDisposableDomListener=function(a,u,_,l){a.addEventListener(u,_,l);let m=!1;return{dispose:()=>{m||(m=!0,a.removeEventListener(u,_,l))}}}},3551:function(c,r,a){var u=this&&this.__decorate||function(f,d,p,v){var S,w=arguments.length,E=w<3?d:v===null?v=Object.getOwnPropertyDescriptor(d,p):v;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")E=Reflect.decorate(f,d,p,v);else for(var b=f.length-1;b>=0;b--)(S=f[b])&&(E=(w<3?S(E):w>3?S(d,p,E):S(d,p))||E);return w>3&&E&&Object.defineProperty(d,p,E),E},_=this&&this.__param||function(f,d){return function(p,v){d(p,v,f)}};Object.defineProperty(r,"__esModule",{value:!0}),r.Linkifier=void 0;const l=a(3656),m=a(8460),g=a(844),C=a(2585),y=a(4725);let h=r.Linkifier=class extends g.Disposable{get currentLink(){return this._currentLink}constructor(f,d,p,v,S){super(),this._element=f,this._mouseService=d,this._renderService=p,this._bufferService=v,this._linkProviderService=S,this._linkCacheDisposables=[],this._isMouseOut=!0,this._wasResized=!1,this._activeLine=-1,this._onShowLinkUnderline=this.register(new m.EventEmitter),this.onShowLinkUnderline=this._onShowLinkUnderline.event,this._onHideLinkUnderline=this.register(new m.EventEmitter),this.onHideLinkUnderline=this._onHideLinkUnderline.event,this.register((0,g.getDisposeArrayDisposable)(this._linkCacheDisposables)),this.register((0,g.toDisposable)((()=>{this._lastMouseEvent=void 0,this._activeProviderReplies?.clear()}))),this.register(this._bufferService.onResize((()=>{this._clearCurrentLink(),this._wasResized=!0}))),this.register((0,l.addDisposableDomListener)(this._element,"mouseleave",(()=>{this._isMouseOut=!0,this._clearCurrentLink()}))),this.register((0,l.addDisposableDomListener)(this._element,"mousemove",this._handleMouseMove.bind(this))),this.register((0,l.addDisposableDomListener)(this._element,"mousedown",this._handleMouseDown.bind(this))),this.register((0,l.addDisposableDomListener)(this._element,"mouseup",this._handleMouseUp.bind(this)))}_handleMouseMove(f){this._lastMouseEvent=f;const d=this._positionFromMouseEvent(f,this._element,this._mouseService);if(!d)return;this._isMouseOut=!1;const p=f.composedPath();for(let v=0;v<p.length;v++){const S=p[v];if(S.classList.contains("xterm"))break;if(S.classList.contains("xterm-hover"))return}this._lastBufferCell&&d.x===this._lastBufferCell.x&&d.y===this._lastBufferCell.y||(this._handleHover(d),this._lastBufferCell=d)}_handleHover(f){if(this._activeLine!==f.y||this._wasResized)return this._clearCurrentLink(),this._askForLink(f,!1),void(this._wasResized=!1);this._currentLink&&this._linkAtPosition(this._currentLink.link,f)||(this._clearCurrentLink(),this._askForLink(f,!0))}_askForLink(f,d){this._activeProviderReplies&&d||(this._activeProviderReplies?.forEach((v=>{v?.forEach((S=>{S.link.dispose&&S.link.dispose()}))})),this._activeProviderReplies=new Map,this._activeLine=f.y);let p=!1;for(const[v,S]of this._linkProviderService.linkProviders.entries())d?this._activeProviderReplies?.get(v)&&(p=this._checkLinkProviderResult(v,f,p)):S.provideLinks(f.y,(w=>{if(this._isMouseOut)return;const E=w?.map((b=>({link:b})));this._activeProviderReplies?.set(v,E),p=this._checkLinkProviderResult(v,f,p),this._activeProviderReplies?.size===this._linkProviderService.linkProviders.length&&this._removeIntersectingLinks(f.y,this._activeProviderReplies)}))}_removeIntersectingLinks(f,d){const p=new Set;for(let v=0;v<d.size;v++){const S=d.get(v);if(S)for(let w=0;w<S.length;w++){const E=S[w],b=E.link.range.start.y<f?0:E.link.range.start.x,k=E.link.range.end.y>f?this._bufferService.cols:E.link.range.end.x;for(let R=b;R<=k;R++){if(p.has(R)){S.splice(w--,1);break}p.add(R)}}}}_checkLinkProviderResult(f,d,p){if(!this._activeProviderReplies)return p;const v=this._activeProviderReplies.get(f);let S=!1;for(let w=0;w<f;w++)this._activeProviderReplies.has(w)&&!this._activeProviderReplies.get(w)||(S=!0);if(!S&&v){const w=v.find((E=>this._linkAtPosition(E.link,d)));w&&(p=!0,this._handleNewLink(w))}if(this._activeProviderReplies.size===this._linkProviderService.linkProviders.length&&!p)for(let w=0;w<this._activeProviderReplies.size;w++){const E=this._activeProviderReplies.get(w)?.find((b=>this._linkAtPosition(b.link,d)));if(E){p=!0,this._handleNewLink(E);break}}return p}_handleMouseDown(){this._mouseDownLink=this._currentLink}_handleMouseUp(f){if(!this._currentLink)return;const d=this._positionFromMouseEvent(f,this._element,this._mouseService);d&&this._mouseDownLink===this._currentLink&&this._linkAtPosition(this._currentLink.link,d)&&this._currentLink.link.activate(f,this._currentLink.link.text)}_clearCurrentLink(f,d){this._currentLink&&this._lastMouseEvent&&(!f||!d||this._currentLink.link.range.start.y>=f&&this._currentLink.link.range.end.y<=d)&&(this._linkLeave(this._element,this._currentLink.link,this._lastMouseEvent),this._currentLink=void 0,(0,g.disposeArray)(this._linkCacheDisposables))}_handleNewLink(f){if(!this._lastMouseEvent)return;const d=this._positionFromMouseEvent(this._lastMouseEvent,this._element,this._mouseService);d&&this._linkAtPosition(f.link,d)&&(this._currentLink=f,this._currentLink.state={decorations:{underline:f.link.decorations===void 0||f.link.decorations.underline,pointerCursor:f.link.decorations===void 0||f.link.decorations.pointerCursor},isHovered:!0},this._linkHover(this._element,f.link,this._lastMouseEvent),f.link.decorations={},Object.defineProperties(f.link.decorations,{pointerCursor:{get:()=>this._currentLink?.state?.decorations.pointerCursor,set:p=>{this._currentLink?.state&&this._currentLink.state.decorations.pointerCursor!==p&&(this._currentLink.state.decorations.pointerCursor=p,this._currentLink.state.isHovered&&this._element.classList.toggle("xterm-cursor-pointer",p))}},underline:{get:()=>this._currentLink?.state?.decorations.underline,set:p=>{this._currentLink?.state&&this._currentLink?.state?.decorations.underline!==p&&(this._currentLink.state.decorations.underline=p,this._currentLink.state.isHovered&&this._fireUnderlineEvent(f.link,p))}}}),this._linkCacheDisposables.push(this._renderService.onRenderedViewportChange((p=>{if(!this._currentLink)return;const v=p.start===0?0:p.start+1+this._bufferService.buffer.ydisp,S=this._bufferService.buffer.ydisp+1+p.end;if(this._currentLink.link.range.start.y>=v&&this._currentLink.link.range.end.y<=S&&(this._clearCurrentLink(v,S),this._lastMouseEvent)){const w=this._positionFromMouseEvent(this._lastMouseEvent,this._element,this._mouseService);w&&this._askForLink(w,!1)}}))))}_linkHover(f,d,p){this._currentLink?.state&&(this._currentLink.state.isHovered=!0,this._currentLink.state.decorations.underline&&this._fireUnderlineEvent(d,!0),this._currentLink.state.decorations.pointerCursor&&f.classList.add("xterm-cursor-pointer")),d.hover&&d.hover(p,d.text)}_fireUnderlineEvent(f,d){const p=f.range,v=this._bufferService.buffer.ydisp,S=this._createLinkUnderlineEvent(p.start.x-1,p.start.y-v-1,p.end.x,p.end.y-v-1,void 0);(d?this._onShowLinkUnderline:this._onHideLinkUnderline).fire(S)}_linkLeave(f,d,p){this._currentLink?.state&&(this._currentLink.state.isHovered=!1,this._currentLink.state.decorations.underline&&this._fireUnderlineEvent(d,!1),this._currentLink.state.decorations.pointerCursor&&f.classList.remove("xterm-cursor-pointer")),d.leave&&d.leave(p,d.text)}_linkAtPosition(f,d){const p=f.range.start.y*this._bufferService.cols+f.range.start.x,v=f.range.end.y*this._bufferService.cols+f.range.end.x,S=d.y*this._bufferService.cols+d.x;return p<=S&&S<=v}_positionFromMouseEvent(f,d,p){const v=p.getCoords(f,d,this._bufferService.cols,this._bufferService.rows);if(v)return{x:v[0],y:v[1]+this._bufferService.buffer.ydisp}}_createLinkUnderlineEvent(f,d,p,v,S){return{x1:f,y1:d,x2:p,y2:v,cols:this._bufferService.cols,fg:S}}};r.Linkifier=h=u([_(1,y.IMouseService),_(2,y.IRenderService),_(3,C.IBufferService),_(4,y.ILinkProviderService)],h)},9042:(c,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.tooMuchOutput=r.promptLabel=void 0,r.promptLabel="Terminal input",r.tooMuchOutput="Too much output to announce, navigate to rows manually to read"},3730:function(c,r,a){var u=this&&this.__decorate||function(y,h,f,d){var p,v=arguments.length,S=v<3?h:d===null?d=Object.getOwnPropertyDescriptor(h,f):d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")S=Reflect.decorate(y,h,f,d);else for(var w=y.length-1;w>=0;w--)(p=y[w])&&(S=(v<3?p(S):v>3?p(h,f,S):p(h,f))||S);return v>3&&S&&Object.defineProperty(h,f,S),S},_=this&&this.__param||function(y,h){return function(f,d){h(f,d,y)}};Object.defineProperty(r,"__esModule",{value:!0}),r.OscLinkProvider=void 0;const l=a(511),m=a(2585);let g=r.OscLinkProvider=class{constructor(y,h,f){this._bufferService=y,this._optionsService=h,this._oscLinkService=f}provideLinks(y,h){const f=this._bufferService.buffer.lines.get(y-1);if(!f)return void h(void 0);const d=[],p=this._optionsService.rawOptions.linkHandler,v=new l.CellData,S=f.getTrimmedLength();let w=-1,E=-1,b=!1;for(let k=0;k<S;k++)if(E!==-1||f.hasContent(k)){if(f.loadCell(k,v),v.hasExtendedAttrs()&&v.extended.urlId){if(E===-1){E=k,w=v.extended.urlId;continue}b=v.extended.urlId!==w}else E!==-1&&(b=!0);if(b||E!==-1&&k===S-1){const R=this._oscLinkService.getLinkData(w)?.uri;if(R){const I={start:{x:E+1,y},end:{x:k+(b||k!==S-1?0:1),y}};let P=!1;if(!p?.allowNonHttpProtocols)try{const L=new URL(R);["http:","https:"].includes(L.protocol)||(P=!0)}catch{P=!0}P||d.push({text:R,range:I,activate:(L,z)=>p?p.activate(L,z,I):C(0,z),hover:(L,z)=>p?.hover?.(L,z,I),leave:(L,z)=>p?.leave?.(L,z,I)})}b=!1,v.hasExtendedAttrs()&&v.extended.urlId?(E=k,w=v.extended.urlId):(E=-1,w=-1)}}h(d)}};function C(y,h){if(confirm(`Do you want to navigate to ${h}?

WARNING: This link could potentially be dangerous`)){const f=window.open();if(f){try{f.opener=null}catch{}f.location.href=h}else console.warn("Opening link blocked as opener could not be cleared")}}r.OscLinkProvider=g=u([_(0,m.IBufferService),_(1,m.IOptionsService),_(2,m.IOscLinkService)],g)},6193:(c,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.RenderDebouncer=void 0,r.RenderDebouncer=class{constructor(a,u){this._renderCallback=a,this._coreBrowserService=u,this._refreshCallbacks=[]}dispose(){this._animationFrame&&(this._coreBrowserService.window.cancelAnimationFrame(this._animationFrame),this._animationFrame=void 0)}addRefreshCallback(a){return this._refreshCallbacks.push(a),this._animationFrame||(this._animationFrame=this._coreBrowserService.window.requestAnimationFrame((()=>this._innerRefresh()))),this._animationFrame}refresh(a,u,_){this._rowCount=_,a=a!==void 0?a:0,u=u!==void 0?u:this._rowCount-1,this._rowStart=this._rowStart!==void 0?Math.min(this._rowStart,a):a,this._rowEnd=this._rowEnd!==void 0?Math.max(this._rowEnd,u):u,this._animationFrame||(this._animationFrame=this._coreBrowserService.window.requestAnimationFrame((()=>this._innerRefresh())))}_innerRefresh(){if(this._animationFrame=void 0,this._rowStart===void 0||this._rowEnd===void 0||this._rowCount===void 0)return void this._runRefreshCallbacks();const a=Math.max(this._rowStart,0),u=Math.min(this._rowEnd,this._rowCount-1);this._rowStart=void 0,this._rowEnd=void 0,this._renderCallback(a,u),this._runRefreshCallbacks()}_runRefreshCallbacks(){for(const a of this._refreshCallbacks)a(0);this._refreshCallbacks=[]}}},3236:(c,r,a)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.Terminal=void 0;const u=a(3614),_=a(3656),l=a(3551),m=a(9042),g=a(3730),C=a(1680),y=a(3107),h=a(5744),f=a(2950),d=a(1296),p=a(428),v=a(4269),S=a(5114),w=a(8934),E=a(3230),b=a(9312),k=a(4725),R=a(6731),I=a(8055),P=a(8969),L=a(8460),z=a(844),J=a(6114),re=a(8437),te=a(2584),ee=a(7399),x=a(5941),B=a(9074),N=a(2585),H=a(5435),se=a(4567),j=a(779);class V extends P.CoreTerminal{get onFocus(){return this._onFocus.event}get onBlur(){return this._onBlur.event}get onA11yChar(){return this._onA11yCharEmitter.event}get onA11yTab(){return this._onA11yTabEmitter.event}get onWillOpen(){return this._onWillOpen.event}constructor(M={}){super(M),this.browser=J,this._keyDownHandled=!1,this._keyDownSeen=!1,this._keyPressHandled=!1,this._unprocessedDeadKey=!1,this._accessibilityManager=this.register(new z.MutableDisposable),this._onCursorMove=this.register(new L.EventEmitter),this.onCursorMove=this._onCursorMove.event,this._onKey=this.register(new L.EventEmitter),this.onKey=this._onKey.event,this._onRender=this.register(new L.EventEmitter),this.onRender=this._onRender.event,this._onSelectionChange=this.register(new L.EventEmitter),this.onSelectionChange=this._onSelectionChange.event,this._onTitleChange=this.register(new L.EventEmitter),this.onTitleChange=this._onTitleChange.event,this._onBell=this.register(new L.EventEmitter),this.onBell=this._onBell.event,this._onFocus=this.register(new L.EventEmitter),this._onBlur=this.register(new L.EventEmitter),this._onA11yCharEmitter=this.register(new L.EventEmitter),this._onA11yTabEmitter=this.register(new L.EventEmitter),this._onWillOpen=this.register(new L.EventEmitter),this._setup(),this._decorationService=this._instantiationService.createInstance(B.DecorationService),this._instantiationService.setService(N.IDecorationService,this._decorationService),this._linkProviderService=this._instantiationService.createInstance(j.LinkProviderService),this._instantiationService.setService(k.ILinkProviderService,this._linkProviderService),this._linkProviderService.registerLinkProvider(this._instantiationService.createInstance(g.OscLinkProvider)),this.register(this._inputHandler.onRequestBell((()=>this._onBell.fire()))),this.register(this._inputHandler.onRequestRefreshRows(((T,K)=>this.refresh(T,K)))),this.register(this._inputHandler.onRequestSendFocus((()=>this._reportFocus()))),this.register(this._inputHandler.onRequestReset((()=>this.reset()))),this.register(this._inputHandler.onRequestWindowsOptionsReport((T=>this._reportWindowsOptions(T)))),this.register(this._inputHandler.onColor((T=>this._handleColorEvent(T)))),this.register((0,L.forwardEvent)(this._inputHandler.onCursorMove,this._onCursorMove)),this.register((0,L.forwardEvent)(this._inputHandler.onTitleChange,this._onTitleChange)),this.register((0,L.forwardEvent)(this._inputHandler.onA11yChar,this._onA11yCharEmitter)),this.register((0,L.forwardEvent)(this._inputHandler.onA11yTab,this._onA11yTabEmitter)),this.register(this._bufferService.onResize((T=>this._afterResize(T.cols,T.rows)))),this.register((0,z.toDisposable)((()=>{this._customKeyEventHandler=void 0,this.element?.parentNode?.removeChild(this.element)})))}_handleColorEvent(M){if(this._themeService)for(const T of M){let K,q="";switch(T.index){case 256:K="foreground",q="10";break;case 257:K="background",q="11";break;case 258:K="cursor",q="12";break;default:K="ansi",q="4;"+T.index}switch(T.type){case 0:const Y=I.color.toColorRGB(K==="ansi"?this._themeService.colors.ansi[T.index]:this._themeService.colors[K]);this.coreService.triggerDataEvent(`${te.C0.ESC}]${q};${(0,x.toRgbString)(Y)}${te.C1_ESCAPED.ST}`);break;case 1:if(K==="ansi")this._themeService.modifyColors((Z=>Z.ansi[T.index]=I.channels.toColor(...T.color)));else{const Z=K;this._themeService.modifyColors((he=>he[Z]=I.channels.toColor(...T.color)))}break;case 2:this._themeService.restoreColor(T.index)}}}_setup(){super._setup(),this._customKeyEventHandler=void 0}get buffer(){return this.buffers.active}focus(){this.textarea&&this.textarea.focus({preventScroll:!0})}_handleScreenReaderModeOptionChange(M){M?!this._accessibilityManager.value&&this._renderService&&(this._accessibilityManager.value=this._instantiationService.createInstance(se.AccessibilityManager,this)):this._accessibilityManager.clear()}_handleTextAreaFocus(M){this.coreService.decPrivateModes.sendFocus&&this.coreService.triggerDataEvent(te.C0.ESC+"[I"),this.element.classList.add("focus"),this._showCursor(),this._onFocus.fire()}blur(){return this.textarea?.blur()}_handleTextAreaBlur(){this.textarea.value="",this.refresh(this.buffer.y,this.buffer.y),this.coreService.decPrivateModes.sendFocus&&this.coreService.triggerDataEvent(te.C0.ESC+"[O"),this.element.classList.remove("focus"),this._onBlur.fire()}_syncTextArea(){if(!this.textarea||!this.buffer.isCursorInViewport||this._compositionHelper.isComposing||!this._renderService)return;const M=this.buffer.ybase+this.buffer.y,T=this.buffer.lines.get(M);if(!T)return;const K=Math.min(this.buffer.x,this.cols-1),q=this._renderService.dimensions.css.cell.height,Y=T.getWidth(K),Z=this._renderService.dimensions.css.cell.width*Y,he=this.buffer.y*this._renderService.dimensions.css.cell.height,me=K*this._renderService.dimensions.css.cell.width;this.textarea.style.left=me+"px",this.textarea.style.top=he+"px",this.textarea.style.width=Z+"px",this.textarea.style.height=q+"px",this.textarea.style.lineHeight=q+"px",this.textarea.style.zIndex="-5"}_initGlobal(){this._bindKeys(),this.register((0,_.addDisposableDomListener)(this.element,"copy",(T=>{this.hasSelection()&&(0,u.copyHandler)(T,this._selectionService)})));const M=T=>(0,u.handlePasteEvent)(T,this.textarea,this.coreService,this.optionsService);this.register((0,_.addDisposableDomListener)(this.textarea,"paste",M)),this.register((0,_.addDisposableDomListener)(this.element,"paste",M)),J.isFirefox?this.register((0,_.addDisposableDomListener)(this.element,"mousedown",(T=>{T.button===2&&(0,u.rightClickHandler)(T,this.textarea,this.screenElement,this._selectionService,this.options.rightClickSelectsWord)}))):this.register((0,_.addDisposableDomListener)(this.element,"contextmenu",(T=>{(0,u.rightClickHandler)(T,this.textarea,this.screenElement,this._selectionService,this.options.rightClickSelectsWord)}))),J.isLinux&&this.register((0,_.addDisposableDomListener)(this.element,"auxclick",(T=>{T.button===1&&(0,u.moveTextAreaUnderMouseCursor)(T,this.textarea,this.screenElement)})))}_bindKeys(){this.register((0,_.addDisposableDomListener)(this.textarea,"keyup",(M=>this._keyUp(M)),!0)),this.register((0,_.addDisposableDomListener)(this.textarea,"keydown",(M=>this._keyDown(M)),!0)),this.register((0,_.addDisposableDomListener)(this.textarea,"keypress",(M=>this._keyPress(M)),!0)),this.register((0,_.addDisposableDomListener)(this.textarea,"compositionstart",(()=>this._compositionHelper.compositionstart()))),this.register((0,_.addDisposableDomListener)(this.textarea,"compositionupdate",(M=>this._compositionHelper.compositionupdate(M)))),this.register((0,_.addDisposableDomListener)(this.textarea,"compositionend",(()=>this._compositionHelper.compositionend()))),this.register((0,_.addDisposableDomListener)(this.textarea,"input",(M=>this._inputEvent(M)),!0)),this.register(this.onRender((()=>this._compositionHelper.updateCompositionElements())))}open(M){if(!M)throw new Error("Terminal requires a parent element.");if(M.isConnected||this._logService.debug("Terminal.open was called on an element that was not attached to the DOM"),this.element?.ownerDocument.defaultView&&this._coreBrowserService)return void(this.element.ownerDocument.defaultView!==this._coreBrowserService.window&&(this._coreBrowserService.window=this.element.ownerDocument.defaultView));this._document=M.ownerDocument,this.options.documentOverride&&this.options.documentOverride instanceof Document&&(this._document=this.optionsService.rawOptions.documentOverride),this.element=this._document.createElement("div"),this.element.dir="ltr",this.element.classList.add("terminal"),this.element.classList.add("xterm"),M.appendChild(this.element);const T=this._document.createDocumentFragment();this._viewportElement=this._document.createElement("div"),this._viewportElement.classList.add("xterm-viewport"),T.appendChild(this._viewportElement),this._viewportScrollArea=this._document.createElement("div"),this._viewportScrollArea.classList.add("xterm-scroll-area"),this._viewportElement.appendChild(this._viewportScrollArea),this.screenElement=this._document.createElement("div"),this.screenElement.classList.add("xterm-screen"),this.register((0,_.addDisposableDomListener)(this.screenElement,"mousemove",(K=>this.updateCursorStyle(K)))),this._helperContainer=this._document.createElement("div"),this._helperContainer.classList.add("xterm-helpers"),this.screenElement.appendChild(this._helperContainer),T.appendChild(this.screenElement),this.textarea=this._document.createElement("textarea"),this.textarea.classList.add("xterm-helper-textarea"),this.textarea.setAttribute("aria-label",m.promptLabel),J.isChromeOS||this.textarea.setAttribute("aria-multiline","false"),this.textarea.setAttribute("autocorrect","off"),this.textarea.setAttribute("autocapitalize","off"),this.textarea.setAttribute("spellcheck","false"),this.textarea.tabIndex=0,this._coreBrowserService=this.register(this._instantiationService.createInstance(S.CoreBrowserService,this.textarea,M.ownerDocument.defaultView??window,this._document??typeof window<"u"?window.document:null)),this._instantiationService.setService(k.ICoreBrowserService,this._coreBrowserService),this.register((0,_.addDisposableDomListener)(this.textarea,"focus",(K=>this._handleTextAreaFocus(K)))),this.register((0,_.addDisposableDomListener)(this.textarea,"blur",(()=>this._handleTextAreaBlur()))),this._helperContainer.appendChild(this.textarea),this._charSizeService=this._instantiationService.createInstance(p.CharSizeService,this._document,this._helperContainer),this._instantiationService.setService(k.ICharSizeService,this._charSizeService),this._themeService=this._instantiationService.createInstance(R.ThemeService),this._instantiationService.setService(k.IThemeService,this._themeService),this._characterJoinerService=this._instantiationService.createInstance(v.CharacterJoinerService),this._instantiationService.setService(k.ICharacterJoinerService,this._characterJoinerService),this._renderService=this.register(this._instantiationService.createInstance(E.RenderService,this.rows,this.screenElement)),this._instantiationService.setService(k.IRenderService,this._renderService),this.register(this._renderService.onRenderedViewportChange((K=>this._onRender.fire(K)))),this.onResize((K=>this._renderService.resize(K.cols,K.rows))),this._compositionView=this._document.createElement("div"),this._compositionView.classList.add("composition-view"),this._compositionHelper=this._instantiationService.createInstance(f.CompositionHelper,this.textarea,this._compositionView),this._helperContainer.appendChild(this._compositionView),this._mouseService=this._instantiationService.createInstance(w.MouseService),this._instantiationService.setService(k.IMouseService,this._mouseService),this.linkifier=this.register(this._instantiationService.createInstance(l.Linkifier,this.screenElement)),this.element.appendChild(T);try{this._onWillOpen.fire(this.element)}catch{}this._renderService.hasRenderer()||this._renderService.setRenderer(this._createRenderer()),this.viewport=this._instantiationService.createInstance(C.Viewport,this._viewportElement,this._viewportScrollArea),this.viewport.onRequestScrollLines((K=>this.scrollLines(K.amount,K.suppressScrollEvent,1))),this.register(this._inputHandler.onRequestSyncScrollBar((()=>this.viewport.syncScrollArea()))),this.register(this.viewport),this.register(this.onCursorMove((()=>{this._renderService.handleCursorMove(),this._syncTextArea()}))),this.register(this.onResize((()=>this._renderService.handleResize(this.cols,this.rows)))),this.register(this.onBlur((()=>this._renderService.handleBlur()))),this.register(this.onFocus((()=>this._renderService.handleFocus()))),this.register(this._renderService.onDimensionsChange((()=>this.viewport.syncScrollArea()))),this._selectionService=this.register(this._instantiationService.createInstance(b.SelectionService,this.element,this.screenElement,this.linkifier)),this._instantiationService.setService(k.ISelectionService,this._selectionService),this.register(this._selectionService.onRequestScrollLines((K=>this.scrollLines(K.amount,K.suppressScrollEvent)))),this.register(this._selectionService.onSelectionChange((()=>this._onSelectionChange.fire()))),this.register(this._selectionService.onRequestRedraw((K=>this._renderService.handleSelectionChanged(K.start,K.end,K.columnSelectMode)))),this.register(this._selectionService.onLinuxMouseSelection((K=>{this.textarea.value=K,this.textarea.focus(),this.textarea.select()}))),this.register(this._onScroll.event((K=>{this.viewport.syncScrollArea(),this._selectionService.refresh()}))),this.register((0,_.addDisposableDomListener)(this._viewportElement,"scroll",(()=>this._selectionService.refresh()))),this.register(this._instantiationService.createInstance(y.BufferDecorationRenderer,this.screenElement)),this.register((0,_.addDisposableDomListener)(this.element,"mousedown",(K=>this._selectionService.handleMouseDown(K)))),this.coreMouseService.areMouseEventsActive?(this._selectionService.disable(),this.element.classList.add("enable-mouse-events")):this._selectionService.enable(),this.options.screenReaderMode&&(this._accessibilityManager.value=this._instantiationService.createInstance(se.AccessibilityManager,this)),this.register(this.optionsService.onSpecificOptionChange("screenReaderMode",(K=>this._handleScreenReaderModeOptionChange(K)))),this.options.overviewRulerWidth&&(this._overviewRulerRenderer=this.register(this._instantiationService.createInstance(h.OverviewRulerRenderer,this._viewportElement,this.screenElement))),this.optionsService.onSpecificOptionChange("overviewRulerWidth",(K=>{!this._overviewRulerRenderer&&K&&this._viewportElement&&this.screenElement&&(this._overviewRulerRenderer=this.register(this._instantiationService.createInstance(h.OverviewRulerRenderer,this._viewportElement,this.screenElement)))})),this._charSizeService.measure(),this.refresh(0,this.rows-1),this._initGlobal(),this.bindMouse()}_createRenderer(){return this._instantiationService.createInstance(d.DomRenderer,this,this._document,this.element,this.screenElement,this._viewportElement,this._helperContainer,this.linkifier)}bindMouse(){const M=this,T=this.element;function K(Z){const he=M._mouseService.getMouseReportCoords(Z,M.screenElement);if(!he)return!1;let me,fe;switch(Z.overrideType||Z.type){case"mousemove":fe=32,Z.buttons===void 0?(me=3,Z.button!==void 0&&(me=Z.button<3?Z.button:3)):me=1&Z.buttons?0:4&Z.buttons?1:2&Z.buttons?2:3;break;case"mouseup":fe=0,me=Z.button<3?Z.button:3;break;case"mousedown":fe=1,me=Z.button<3?Z.button:3;break;case"wheel":if(M._customWheelEventHandler&&M._customWheelEventHandler(Z)===!1||M.viewport.getLinesScrolled(Z)===0)return!1;fe=Z.deltaY<0?0:1,me=4;break;default:return!1}return!(fe===void 0||me===void 0||me>4)&&M.coreMouseService.triggerMouseEvent({col:he.col,row:he.row,x:he.x,y:he.y,button:me,action:fe,ctrl:Z.ctrlKey,alt:Z.altKey,shift:Z.shiftKey})}const q={mouseup:null,wheel:null,mousedrag:null,mousemove:null},Y={mouseup:Z=>(K(Z),Z.buttons||(this._document.removeEventListener("mouseup",q.mouseup),q.mousedrag&&this._document.removeEventListener("mousemove",q.mousedrag)),this.cancel(Z)),wheel:Z=>(K(Z),this.cancel(Z,!0)),mousedrag:Z=>{Z.buttons&&K(Z)},mousemove:Z=>{Z.buttons||K(Z)}};this.register(this.coreMouseService.onProtocolChange((Z=>{Z?(this.optionsService.rawOptions.logLevel==="debug"&&this._logService.debug("Binding to mouse events:",this.coreMouseService.explainEvents(Z)),this.element.classList.add("enable-mouse-events"),this._selectionService.disable()):(this._logService.debug("Unbinding from mouse events."),this.element.classList.remove("enable-mouse-events"),this._selectionService.enable()),8&Z?q.mousemove||(T.addEventListener("mousemove",Y.mousemove),q.mousemove=Y.mousemove):(T.removeEventListener("mousemove",q.mousemove),q.mousemove=null),16&Z?q.wheel||(T.addEventListener("wheel",Y.wheel,{passive:!1}),q.wheel=Y.wheel):(T.removeEventListener("wheel",q.wheel),q.wheel=null),2&Z?q.mouseup||(q.mouseup=Y.mouseup):(this._document.removeEventListener("mouseup",q.mouseup),q.mouseup=null),4&Z?q.mousedrag||(q.mousedrag=Y.mousedrag):(this._document.removeEventListener("mousemove",q.mousedrag),q.mousedrag=null)}))),this.coreMouseService.activeProtocol=this.coreMouseService.activeProtocol,this.register((0,_.addDisposableDomListener)(T,"mousedown",(Z=>{if(Z.preventDefault(),this.focus(),this.coreMouseService.areMouseEventsActive&&!this._selectionService.shouldForceSelection(Z))return K(Z),q.mouseup&&this._document.addEventListener("mouseup",q.mouseup),q.mousedrag&&this._document.addEventListener("mousemove",q.mousedrag),this.cancel(Z)}))),this.register((0,_.addDisposableDomListener)(T,"wheel",(Z=>{if(!q.wheel){if(this._customWheelEventHandler&&this._customWheelEventHandler(Z)===!1)return!1;if(!this.buffer.hasScrollback){const he=this.viewport.getLinesScrolled(Z);if(he===0)return;const me=te.C0.ESC+(this.coreService.decPrivateModes.applicationCursorKeys?"O":"[")+(Z.deltaY<0?"A":"B");let fe="";for(let Ae=0;Ae<Math.abs(he);Ae++)fe+=me;return this.coreService.triggerDataEvent(fe,!0),this.cancel(Z,!0)}return this.viewport.handleWheel(Z)?this.cancel(Z):void 0}}),{passive:!1})),this.register((0,_.addDisposableDomListener)(T,"touchstart",(Z=>{if(!this.coreMouseService.areMouseEventsActive)return this.viewport.handleTouchStart(Z),this.cancel(Z)}),{passive:!0})),this.register((0,_.addDisposableDomListener)(T,"touchmove",(Z=>{if(!this.coreMouseService.areMouseEventsActive)return this.viewport.handleTouchMove(Z)?void 0:this.cancel(Z)}),{passive:!1}))}refresh(M,T){this._renderService?.refreshRows(M,T)}updateCursorStyle(M){this._selectionService?.shouldColumnSelect(M)?this.element.classList.add("column-select"):this.element.classList.remove("column-select")}_showCursor(){this.coreService.isCursorInitialized||(this.coreService.isCursorInitialized=!0,this.refresh(this.buffer.y,this.buffer.y))}scrollLines(M,T,K=0){K===1?(super.scrollLines(M,T,K),this.refresh(0,this.rows-1)):this.viewport?.scrollLines(M)}paste(M){(0,u.paste)(M,this.textarea,this.coreService,this.optionsService)}attachCustomKeyEventHandler(M){this._customKeyEventHandler=M}attachCustomWheelEventHandler(M){this._customWheelEventHandler=M}registerLinkProvider(M){return this._linkProviderService.registerLinkProvider(M)}registerCharacterJoiner(M){if(!this._characterJoinerService)throw new Error("Terminal must be opened first");const T=this._characterJoinerService.register(M);return this.refresh(0,this.rows-1),T}deregisterCharacterJoiner(M){if(!this._characterJoinerService)throw new Error("Terminal must be opened first");this._characterJoinerService.deregister(M)&&this.refresh(0,this.rows-1)}get markers(){return this.buffer.markers}registerMarker(M){return this.buffer.addMarker(this.buffer.ybase+this.buffer.y+M)}registerDecoration(M){return this._decorationService.registerDecoration(M)}hasSelection(){return!!this._selectionService&&this._selectionService.hasSelection}select(M,T,K){this._selectionService.setSelection(M,T,K)}getSelection(){return this._selectionService?this._selectionService.selectionText:""}getSelectionPosition(){if(this._selectionService&&this._selectionService.hasSelection)return{start:{x:this._selectionService.selectionStart[0],y:this._selectionService.selectionStart[1]},end:{x:this._selectionService.selectionEnd[0],y:this._selectionService.selectionEnd[1]}}}clearSelection(){this._selectionService?.clearSelection()}selectAll(){this._selectionService?.selectAll()}selectLines(M,T){this._selectionService?.selectLines(M,T)}_keyDown(M){if(this._keyDownHandled=!1,this._keyDownSeen=!0,this._customKeyEventHandler&&this._customKeyEventHandler(M)===!1)return!1;const T=this.browser.isMac&&this.options.macOptionIsMeta&&M.altKey;if(!T&&!this._compositionHelper.keydown(M))return this.options.scrollOnUserInput&&this.buffer.ybase!==this.buffer.ydisp&&this.scrollToBottom(),!1;T||M.key!=="Dead"&&M.key!=="AltGraph"||(this._unprocessedDeadKey=!0);const K=(0,ee.evaluateKeyboardEvent)(M,this.coreService.decPrivateModes.applicationCursorKeys,this.browser.isMac,this.options.macOptionIsMeta);if(this.updateCursorStyle(M),K.type===3||K.type===2){const q=this.rows-1;return this.scrollLines(K.type===2?-q:q),this.cancel(M,!0)}return K.type===1&&this.selectAll(),!!this._isThirdLevelShift(this.browser,M)||(K.cancel&&this.cancel(M,!0),!K.key||!!(M.key&&!M.ctrlKey&&!M.altKey&&!M.metaKey&&M.key.length===1&&M.key.charCodeAt(0)>=65&&M.key.charCodeAt(0)<=90)||(this._unprocessedDeadKey?(this._unprocessedDeadKey=!1,!0):(K.key!==te.C0.ETX&&K.key!==te.C0.CR||(this.textarea.value=""),this._onKey.fire({key:K.key,domEvent:M}),this._showCursor(),this.coreService.triggerDataEvent(K.key,!0),!this.optionsService.rawOptions.screenReaderMode||M.altKey||M.ctrlKey?this.cancel(M,!0):void(this._keyDownHandled=!0))))}_isThirdLevelShift(M,T){const K=M.isMac&&!this.options.macOptionIsMeta&&T.altKey&&!T.ctrlKey&&!T.metaKey||M.isWindows&&T.altKey&&T.ctrlKey&&!T.metaKey||M.isWindows&&T.getModifierState("AltGraph");return T.type==="keypress"?K:K&&(!T.keyCode||T.keyCode>47)}_keyUp(M){this._keyDownSeen=!1,this._customKeyEventHandler&&this._customKeyEventHandler(M)===!1||((function(T){return T.keyCode===16||T.keyCode===17||T.keyCode===18})(M)||this.focus(),this.updateCursorStyle(M),this._keyPressHandled=!1)}_keyPress(M){let T;if(this._keyPressHandled=!1,this._keyDownHandled||this._customKeyEventHandler&&this._customKeyEventHandler(M)===!1)return!1;if(this.cancel(M),M.charCode)T=M.charCode;else if(M.which===null||M.which===void 0)T=M.keyCode;else{if(M.which===0||M.charCode===0)return!1;T=M.which}return!(!T||(M.altKey||M.ctrlKey||M.metaKey)&&!this._isThirdLevelShift(this.browser,M)||(T=String.fromCharCode(T),this._onKey.fire({key:T,domEvent:M}),this._showCursor(),this.coreService.triggerDataEvent(T,!0),this._keyPressHandled=!0,this._unprocessedDeadKey=!1,0))}_inputEvent(M){if(M.data&&M.inputType==="insertText"&&(!M.composed||!this._keyDownSeen)&&!this.optionsService.rawOptions.screenReaderMode){if(this._keyPressHandled)return!1;this._unprocessedDeadKey=!1;const T=M.data;return this.coreService.triggerDataEvent(T,!0),this.cancel(M),!0}return!1}resize(M,T){M!==this.cols||T!==this.rows?super.resize(M,T):this._charSizeService&&!this._charSizeService.hasValidSize&&this._charSizeService.measure()}_afterResize(M,T){this._charSizeService?.measure(),this.viewport?.syncScrollArea(!0)}clear(){if(this.buffer.ybase!==0||this.buffer.y!==0){this.buffer.clearAllMarkers(),this.buffer.lines.set(0,this.buffer.lines.get(this.buffer.ybase+this.buffer.y)),this.buffer.lines.length=1,this.buffer.ydisp=0,this.buffer.ybase=0,this.buffer.y=0;for(let M=1;M<this.rows;M++)this.buffer.lines.push(this.buffer.getBlankLine(re.DEFAULT_ATTR_DATA));this._onScroll.fire({position:this.buffer.ydisp,source:0}),this.viewport?.reset(),this.refresh(0,this.rows-1)}}reset(){this.options.rows=this.rows,this.options.cols=this.cols;const M=this._customKeyEventHandler;this._setup(),super.reset(),this._selectionService?.reset(),this._decorationService.reset(),this.viewport?.reset(),this._customKeyEventHandler=M,this.refresh(0,this.rows-1)}clearTextureAtlas(){this._renderService?.clearTextureAtlas()}_reportFocus(){this.element?.classList.contains("focus")?this.coreService.triggerDataEvent(te.C0.ESC+"[I"):this.coreService.triggerDataEvent(te.C0.ESC+"[O")}_reportWindowsOptions(M){if(this._renderService)switch(M){case H.WindowsOptionsReportType.GET_WIN_SIZE_PIXELS:const T=this._renderService.dimensions.css.canvas.width.toFixed(0),K=this._renderService.dimensions.css.canvas.height.toFixed(0);this.coreService.triggerDataEvent(`${te.C0.ESC}[4;${K};${T}t`);break;case H.WindowsOptionsReportType.GET_CELL_SIZE_PIXELS:const q=this._renderService.dimensions.css.cell.width.toFixed(0),Y=this._renderService.dimensions.css.cell.height.toFixed(0);this.coreService.triggerDataEvent(`${te.C0.ESC}[6;${Y};${q}t`)}}cancel(M,T){if(this.options.cancelEvents||T)return M.preventDefault(),M.stopPropagation(),!1}}r.Terminal=V},9924:(c,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.TimeBasedDebouncer=void 0,r.TimeBasedDebouncer=class{constructor(a,u=1e3){this._renderCallback=a,this._debounceThresholdMS=u,this._lastRefreshMs=0,this._additionalRefreshRequested=!1}dispose(){this._refreshTimeoutID&&clearTimeout(this._refreshTimeoutID)}refresh(a,u,_){this._rowCount=_,a=a!==void 0?a:0,u=u!==void 0?u:this._rowCount-1,this._rowStart=this._rowStart!==void 0?Math.min(this._rowStart,a):a,this._rowEnd=this._rowEnd!==void 0?Math.max(this._rowEnd,u):u;const l=Date.now();if(l-this._lastRefreshMs>=this._debounceThresholdMS)this._lastRefreshMs=l,this._innerRefresh();else if(!this._additionalRefreshRequested){const m=l-this._lastRefreshMs,g=this._debounceThresholdMS-m;this._additionalRefreshRequested=!0,this._refreshTimeoutID=window.setTimeout((()=>{this._lastRefreshMs=Date.now(),this._innerRefresh(),this._additionalRefreshRequested=!1,this._refreshTimeoutID=void 0}),g)}}_innerRefresh(){if(this._rowStart===void 0||this._rowEnd===void 0||this._rowCount===void 0)return;const a=Math.max(this._rowStart,0),u=Math.min(this._rowEnd,this._rowCount-1);this._rowStart=void 0,this._rowEnd=void 0,this._renderCallback(a,u)}}},1680:function(c,r,a){var u=this&&this.__decorate||function(f,d,p,v){var S,w=arguments.length,E=w<3?d:v===null?v=Object.getOwnPropertyDescriptor(d,p):v;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")E=Reflect.decorate(f,d,p,v);else for(var b=f.length-1;b>=0;b--)(S=f[b])&&(E=(w<3?S(E):w>3?S(d,p,E):S(d,p))||E);return w>3&&E&&Object.defineProperty(d,p,E),E},_=this&&this.__param||function(f,d){return function(p,v){d(p,v,f)}};Object.defineProperty(r,"__esModule",{value:!0}),r.Viewport=void 0;const l=a(3656),m=a(4725),g=a(8460),C=a(844),y=a(2585);let h=r.Viewport=class extends C.Disposable{constructor(f,d,p,v,S,w,E,b){super(),this._viewportElement=f,this._scrollArea=d,this._bufferService=p,this._optionsService=v,this._charSizeService=S,this._renderService=w,this._coreBrowserService=E,this.scrollBarWidth=0,this._currentRowHeight=0,this._currentDeviceCellHeight=0,this._lastRecordedBufferLength=0,this._lastRecordedViewportHeight=0,this._lastRecordedBufferHeight=0,this._lastTouchY=0,this._lastScrollTop=0,this._wheelPartialScroll=0,this._refreshAnimationFrame=null,this._ignoreNextScrollEvent=!1,this._smoothScrollState={startTime:0,origin:-1,target:-1},this._onRequestScrollLines=this.register(new g.EventEmitter),this.onRequestScrollLines=this._onRequestScrollLines.event,this.scrollBarWidth=this._viewportElement.offsetWidth-this._scrollArea.offsetWidth||15,this.register((0,l.addDisposableDomListener)(this._viewportElement,"scroll",this._handleScroll.bind(this))),this._activeBuffer=this._bufferService.buffer,this.register(this._bufferService.buffers.onBufferActivate((k=>this._activeBuffer=k.activeBuffer))),this._renderDimensions=this._renderService.dimensions,this.register(this._renderService.onDimensionsChange((k=>this._renderDimensions=k))),this._handleThemeChange(b.colors),this.register(b.onChangeColors((k=>this._handleThemeChange(k)))),this.register(this._optionsService.onSpecificOptionChange("scrollback",(()=>this.syncScrollArea()))),setTimeout((()=>this.syncScrollArea()))}_handleThemeChange(f){this._viewportElement.style.backgroundColor=f.background.css}reset(){this._currentRowHeight=0,this._currentDeviceCellHeight=0,this._lastRecordedBufferLength=0,this._lastRecordedViewportHeight=0,this._lastRecordedBufferHeight=0,this._lastTouchY=0,this._lastScrollTop=0,this._coreBrowserService.window.requestAnimationFrame((()=>this.syncScrollArea()))}_refresh(f){if(f)return this._innerRefresh(),void(this._refreshAnimationFrame!==null&&this._coreBrowserService.window.cancelAnimationFrame(this._refreshAnimationFrame));this._refreshAnimationFrame===null&&(this._refreshAnimationFrame=this._coreBrowserService.window.requestAnimationFrame((()=>this._innerRefresh())))}_innerRefresh(){if(this._charSizeService.height>0){this._currentRowHeight=this._renderDimensions.device.cell.height/this._coreBrowserService.dpr,this._currentDeviceCellHeight=this._renderDimensions.device.cell.height,this._lastRecordedViewportHeight=this._viewportElement.offsetHeight;const d=Math.round(this._currentRowHeight*this._lastRecordedBufferLength)+(this._lastRecordedViewportHeight-this._renderDimensions.css.canvas.height);this._lastRecordedBufferHeight!==d&&(this._lastRecordedBufferHeight=d,this._scrollArea.style.height=this._lastRecordedBufferHeight+"px")}const f=this._bufferService.buffer.ydisp*this._currentRowHeight;this._viewportElement.scrollTop!==f&&(this._ignoreNextScrollEvent=!0,this._viewportElement.scrollTop=f),this._refreshAnimationFrame=null}syncScrollArea(f=!1){if(this._lastRecordedBufferLength!==this._bufferService.buffer.lines.length)return this._lastRecordedBufferLength=this._bufferService.buffer.lines.length,void this._refresh(f);this._lastRecordedViewportHeight===this._renderService.dimensions.css.canvas.height&&this._lastScrollTop===this._activeBuffer.ydisp*this._currentRowHeight&&this._renderDimensions.device.cell.height===this._currentDeviceCellHeight||this._refresh(f)}_handleScroll(f){if(this._lastScrollTop=this._viewportElement.scrollTop,!this._viewportElement.offsetParent)return;if(this._ignoreNextScrollEvent)return this._ignoreNextScrollEvent=!1,void this._onRequestScrollLines.fire({amount:0,suppressScrollEvent:!0});const d=Math.round(this._lastScrollTop/this._currentRowHeight)-this._bufferService.buffer.ydisp;this._onRequestScrollLines.fire({amount:d,suppressScrollEvent:!0})}_smoothScroll(){if(this._isDisposed||this._smoothScrollState.origin===-1||this._smoothScrollState.target===-1)return;const f=this._smoothScrollPercent();this._viewportElement.scrollTop=this._smoothScrollState.origin+Math.round(f*(this._smoothScrollState.target-this._smoothScrollState.origin)),f<1?this._coreBrowserService.window.requestAnimationFrame((()=>this._smoothScroll())):this._clearSmoothScrollState()}_smoothScrollPercent(){return this._optionsService.rawOptions.smoothScrollDuration&&this._smoothScrollState.startTime?Math.max(Math.min((Date.now()-this._smoothScrollState.startTime)/this._optionsService.rawOptions.smoothScrollDuration,1),0):1}_clearSmoothScrollState(){this._smoothScrollState.startTime=0,this._smoothScrollState.origin=-1,this._smoothScrollState.target=-1}_bubbleScroll(f,d){const p=this._viewportElement.scrollTop+this._lastRecordedViewportHeight;return!(d<0&&this._viewportElement.scrollTop!==0||d>0&&p<this._lastRecordedBufferHeight)||(f.cancelable&&f.preventDefault(),!1)}handleWheel(f){const d=this._getPixelsScrolled(f);return d!==0&&(this._optionsService.rawOptions.smoothScrollDuration?(this._smoothScrollState.startTime=Date.now(),this._smoothScrollPercent()<1?(this._smoothScrollState.origin=this._viewportElement.scrollTop,this._smoothScrollState.target===-1?this._smoothScrollState.target=this._viewportElement.scrollTop+d:this._smoothScrollState.target+=d,this._smoothScrollState.target=Math.max(Math.min(this._smoothScrollState.target,this._viewportElement.scrollHeight),0),this._smoothScroll()):this._clearSmoothScrollState()):this._viewportElement.scrollTop+=d,this._bubbleScroll(f,d))}scrollLines(f){if(f!==0)if(this._optionsService.rawOptions.smoothScrollDuration){const d=f*this._currentRowHeight;this._smoothScrollState.startTime=Date.now(),this._smoothScrollPercent()<1?(this._smoothScrollState.origin=this._viewportElement.scrollTop,this._smoothScrollState.target=this._smoothScrollState.origin+d,this._smoothScrollState.target=Math.max(Math.min(this._smoothScrollState.target,this._viewportElement.scrollHeight),0),this._smoothScroll()):this._clearSmoothScrollState()}else this._onRequestScrollLines.fire({amount:f,suppressScrollEvent:!1})}_getPixelsScrolled(f){if(f.deltaY===0||f.shiftKey)return 0;let d=this._applyScrollModifier(f.deltaY,f);return f.deltaMode===WheelEvent.DOM_DELTA_LINE?d*=this._currentRowHeight:f.deltaMode===WheelEvent.DOM_DELTA_PAGE&&(d*=this._currentRowHeight*this._bufferService.rows),d}getBufferElements(f,d){let p,v="";const S=[],w=d??this._bufferService.buffer.lines.length,E=this._bufferService.buffer.lines;for(let b=f;b<w;b++){const k=E.get(b);if(!k)continue;const R=E.get(b+1)?.isWrapped;if(v+=k.translateToString(!R),!R||b===E.length-1){const I=document.createElement("div");I.textContent=v,S.push(I),v.length>0&&(p=I),v=""}}return{bufferElements:S,cursorElement:p}}getLinesScrolled(f){if(f.deltaY===0||f.shiftKey)return 0;let d=this._applyScrollModifier(f.deltaY,f);return f.deltaMode===WheelEvent.DOM_DELTA_PIXEL?(d/=this._currentRowHeight+0,this._wheelPartialScroll+=d,d=Math.floor(Math.abs(this._wheelPartialScroll))*(this._wheelPartialScroll>0?1:-1),this._wheelPartialScroll%=1):f.deltaMode===WheelEvent.DOM_DELTA_PAGE&&(d*=this._bufferService.rows),d}_applyScrollModifier(f,d){const p=this._optionsService.rawOptions.fastScrollModifier;return p==="alt"&&d.altKey||p==="ctrl"&&d.ctrlKey||p==="shift"&&d.shiftKey?f*this._optionsService.rawOptions.fastScrollSensitivity*this._optionsService.rawOptions.scrollSensitivity:f*this._optionsService.rawOptions.scrollSensitivity}handleTouchStart(f){this._lastTouchY=f.touches[0].pageY}handleTouchMove(f){const d=this._lastTouchY-f.touches[0].pageY;return this._lastTouchY=f.touches[0].pageY,d!==0&&(this._viewportElement.scrollTop+=d,this._bubbleScroll(f,d))}};r.Viewport=h=u([_(2,y.IBufferService),_(3,y.IOptionsService),_(4,m.ICharSizeService),_(5,m.IRenderService),_(6,m.ICoreBrowserService),_(7,m.IThemeService)],h)},3107:function(c,r,a){var u=this&&this.__decorate||function(y,h,f,d){var p,v=arguments.length,S=v<3?h:d===null?d=Object.getOwnPropertyDescriptor(h,f):d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")S=Reflect.decorate(y,h,f,d);else for(var w=y.length-1;w>=0;w--)(p=y[w])&&(S=(v<3?p(S):v>3?p(h,f,S):p(h,f))||S);return v>3&&S&&Object.defineProperty(h,f,S),S},_=this&&this.__param||function(y,h){return function(f,d){h(f,d,y)}};Object.defineProperty(r,"__esModule",{value:!0}),r.BufferDecorationRenderer=void 0;const l=a(4725),m=a(844),g=a(2585);let C=r.BufferDecorationRenderer=class extends m.Disposable{constructor(y,h,f,d,p){super(),this._screenElement=y,this._bufferService=h,this._coreBrowserService=f,this._decorationService=d,this._renderService=p,this._decorationElements=new Map,this._altBufferIsActive=!1,this._dimensionsChanged=!1,this._container=document.createElement("div"),this._container.classList.add("xterm-decoration-container"),this._screenElement.appendChild(this._container),this.register(this._renderService.onRenderedViewportChange((()=>this._doRefreshDecorations()))),this.register(this._renderService.onDimensionsChange((()=>{this._dimensionsChanged=!0,this._queueRefresh()}))),this.register(this._coreBrowserService.onDprChange((()=>this._queueRefresh()))),this.register(this._bufferService.buffers.onBufferActivate((()=>{this._altBufferIsActive=this._bufferService.buffer===this._bufferService.buffers.alt}))),this.register(this._decorationService.onDecorationRegistered((()=>this._queueRefresh()))),this.register(this._decorationService.onDecorationRemoved((v=>this._removeDecoration(v)))),this.register((0,m.toDisposable)((()=>{this._container.remove(),this._decorationElements.clear()})))}_queueRefresh(){this._animationFrame===void 0&&(this._animationFrame=this._renderService.addRefreshCallback((()=>{this._doRefreshDecorations(),this._animationFrame=void 0})))}_doRefreshDecorations(){for(const y of this._decorationService.decorations)this._renderDecoration(y);this._dimensionsChanged=!1}_renderDecoration(y){this._refreshStyle(y),this._dimensionsChanged&&this._refreshXPosition(y)}_createElement(y){const h=this._coreBrowserService.mainDocument.createElement("div");h.classList.add("xterm-decoration"),h.classList.toggle("xterm-decoration-top-layer",y?.options?.layer==="top"),h.style.width=`${Math.round((y.options.width||1)*this._renderService.dimensions.css.cell.width)}px`,h.style.height=(y.options.height||1)*this._renderService.dimensions.css.cell.height+"px",h.style.top=(y.marker.line-this._bufferService.buffers.active.ydisp)*this._renderService.dimensions.css.cell.height+"px",h.style.lineHeight=`${this._renderService.dimensions.css.cell.height}px`;const f=y.options.x??0;return f&&f>this._bufferService.cols&&(h.style.display="none"),this._refreshXPosition(y,h),h}_refreshStyle(y){const h=y.marker.line-this._bufferService.buffers.active.ydisp;if(h<0||h>=this._bufferService.rows)y.element&&(y.element.style.display="none",y.onRenderEmitter.fire(y.element));else{let f=this._decorationElements.get(y);f||(f=this._createElement(y),y.element=f,this._decorationElements.set(y,f),this._container.appendChild(f),y.onDispose((()=>{this._decorationElements.delete(y),f.remove()}))),f.style.top=h*this._renderService.dimensions.css.cell.height+"px",f.style.display=this._altBufferIsActive?"none":"block",y.onRenderEmitter.fire(f)}}_refreshXPosition(y,h=y.element){if(!h)return;const f=y.options.x??0;(y.options.anchor||"left")==="right"?h.style.right=f?f*this._renderService.dimensions.css.cell.width+"px":"":h.style.left=f?f*this._renderService.dimensions.css.cell.width+"px":""}_removeDecoration(y){this._decorationElements.get(y)?.remove(),this._decorationElements.delete(y),y.dispose()}};r.BufferDecorationRenderer=C=u([_(1,g.IBufferService),_(2,l.ICoreBrowserService),_(3,g.IDecorationService),_(4,l.IRenderService)],C)},5871:(c,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.ColorZoneStore=void 0,r.ColorZoneStore=class{constructor(){this._zones=[],this._zonePool=[],this._zonePoolIndex=0,this._linePadding={full:0,left:0,center:0,right:0}}get zones(){return this._zonePool.length=Math.min(this._zonePool.length,this._zones.length),this._zones}clear(){this._zones.length=0,this._zonePoolIndex=0}addDecoration(a){if(a.options.overviewRulerOptions){for(const u of this._zones)if(u.color===a.options.overviewRulerOptions.color&&u.position===a.options.overviewRulerOptions.position){if(this._lineIntersectsZone(u,a.marker.line))return;if(this._lineAdjacentToZone(u,a.marker.line,a.options.overviewRulerOptions.position))return void this._addLineToZone(u,a.marker.line)}if(this._zonePoolIndex<this._zonePool.length)return this._zonePool[this._zonePoolIndex].color=a.options.overviewRulerOptions.color,this._zonePool[this._zonePoolIndex].position=a.options.overviewRulerOptions.position,this._zonePool[this._zonePoolIndex].startBufferLine=a.marker.line,this._zonePool[this._zonePoolIndex].endBufferLine=a.marker.line,void this._zones.push(this._zonePool[this._zonePoolIndex++]);this._zones.push({color:a.options.overviewRulerOptions.color,position:a.options.overviewRulerOptions.position,startBufferLine:a.marker.line,endBufferLine:a.marker.line}),this._zonePool.push(this._zones[this._zones.length-1]),this._zonePoolIndex++}}setPadding(a){this._linePadding=a}_lineIntersectsZone(a,u){return u>=a.startBufferLine&&u<=a.endBufferLine}_lineAdjacentToZone(a,u,_){return u>=a.startBufferLine-this._linePadding[_||"full"]&&u<=a.endBufferLine+this._linePadding[_||"full"]}_addLineToZone(a,u){a.startBufferLine=Math.min(a.startBufferLine,u),a.endBufferLine=Math.max(a.endBufferLine,u)}}},5744:function(c,r,a){var u=this&&this.__decorate||function(p,v,S,w){var E,b=arguments.length,k=b<3?v:w===null?w=Object.getOwnPropertyDescriptor(v,S):w;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")k=Reflect.decorate(p,v,S,w);else for(var R=p.length-1;R>=0;R--)(E=p[R])&&(k=(b<3?E(k):b>3?E(v,S,k):E(v,S))||k);return b>3&&k&&Object.defineProperty(v,S,k),k},_=this&&this.__param||function(p,v){return function(S,w){v(S,w,p)}};Object.defineProperty(r,"__esModule",{value:!0}),r.OverviewRulerRenderer=void 0;const l=a(5871),m=a(4725),g=a(844),C=a(2585),y={full:0,left:0,center:0,right:0},h={full:0,left:0,center:0,right:0},f={full:0,left:0,center:0,right:0};let d=r.OverviewRulerRenderer=class extends g.Disposable{get _width(){return this._optionsService.options.overviewRulerWidth||0}constructor(p,v,S,w,E,b,k){super(),this._viewportElement=p,this._screenElement=v,this._bufferService=S,this._decorationService=w,this._renderService=E,this._optionsService=b,this._coreBrowserService=k,this._colorZoneStore=new l.ColorZoneStore,this._shouldUpdateDimensions=!0,this._shouldUpdateAnchor=!0,this._lastKnownBufferLength=0,this._canvas=this._coreBrowserService.mainDocument.createElement("canvas"),this._canvas.classList.add("xterm-decoration-overview-ruler"),this._refreshCanvasDimensions(),this._viewportElement.parentElement?.insertBefore(this._canvas,this._viewportElement);const R=this._canvas.getContext("2d");if(!R)throw new Error("Ctx cannot be null");this._ctx=R,this._registerDecorationListeners(),this._registerBufferChangeListeners(),this._registerDimensionChangeListeners(),this.register((0,g.toDisposable)((()=>{this._canvas?.remove()})))}_registerDecorationListeners(){this.register(this._decorationService.onDecorationRegistered((()=>this._queueRefresh(void 0,!0)))),this.register(this._decorationService.onDecorationRemoved((()=>this._queueRefresh(void 0,!0))))}_registerBufferChangeListeners(){this.register(this._renderService.onRenderedViewportChange((()=>this._queueRefresh()))),this.register(this._bufferService.buffers.onBufferActivate((()=>{this._canvas.style.display=this._bufferService.buffer===this._bufferService.buffers.alt?"none":"block"}))),this.register(this._bufferService.onScroll((()=>{this._lastKnownBufferLength!==this._bufferService.buffers.normal.lines.length&&(this._refreshDrawHeightConstants(),this._refreshColorZonePadding())})))}_registerDimensionChangeListeners(){this.register(this._renderService.onRender((()=>{this._containerHeight&&this._containerHeight===this._screenElement.clientHeight||(this._queueRefresh(!0),this._containerHeight=this._screenElement.clientHeight)}))),this.register(this._optionsService.onSpecificOptionChange("overviewRulerWidth",(()=>this._queueRefresh(!0)))),this.register(this._coreBrowserService.onDprChange((()=>this._queueRefresh(!0)))),this._queueRefresh(!0)}_refreshDrawConstants(){const p=Math.floor(this._canvas.width/3),v=Math.ceil(this._canvas.width/3);h.full=this._canvas.width,h.left=p,h.center=v,h.right=p,this._refreshDrawHeightConstants(),f.full=0,f.left=0,f.center=h.left,f.right=h.left+h.center}_refreshDrawHeightConstants(){y.full=Math.round(2*this._coreBrowserService.dpr);const p=this._canvas.height/this._bufferService.buffer.lines.length,v=Math.round(Math.max(Math.min(p,12),6)*this._coreBrowserService.dpr);y.left=v,y.center=v,y.right=v}_refreshColorZonePadding(){this._colorZoneStore.setPadding({full:Math.floor(this._bufferService.buffers.active.lines.length/(this._canvas.height-1)*y.full),left:Math.floor(this._bufferService.buffers.active.lines.length/(this._canvas.height-1)*y.left),center:Math.floor(this._bufferService.buffers.active.lines.length/(this._canvas.height-1)*y.center),right:Math.floor(this._bufferService.buffers.active.lines.length/(this._canvas.height-1)*y.right)}),this._lastKnownBufferLength=this._bufferService.buffers.normal.lines.length}_refreshCanvasDimensions(){this._canvas.style.width=`${this._width}px`,this._canvas.width=Math.round(this._width*this._coreBrowserService.dpr),this._canvas.style.height=`${this._screenElement.clientHeight}px`,this._canvas.height=Math.round(this._screenElement.clientHeight*this._coreBrowserService.dpr),this._refreshDrawConstants(),this._refreshColorZonePadding()}_refreshDecorations(){this._shouldUpdateDimensions&&this._refreshCanvasDimensions(),this._ctx.clearRect(0,0,this._canvas.width,this._canvas.height),this._colorZoneStore.clear();for(const v of this._decorationService.decorations)this._colorZoneStore.addDecoration(v);this._ctx.lineWidth=1;const p=this._colorZoneStore.zones;for(const v of p)v.position!=="full"&&this._renderColorZone(v);for(const v of p)v.position==="full"&&this._renderColorZone(v);this._shouldUpdateDimensions=!1,this._shouldUpdateAnchor=!1}_renderColorZone(p){this._ctx.fillStyle=p.color,this._ctx.fillRect(f[p.position||"full"],Math.round((this._canvas.height-1)*(p.startBufferLine/this._bufferService.buffers.active.lines.length)-y[p.position||"full"]/2),h[p.position||"full"],Math.round((this._canvas.height-1)*((p.endBufferLine-p.startBufferLine)/this._bufferService.buffers.active.lines.length)+y[p.position||"full"]))}_queueRefresh(p,v){this._shouldUpdateDimensions=p||this._shouldUpdateDimensions,this._shouldUpdateAnchor=v||this._shouldUpdateAnchor,this._animationFrame===void 0&&(this._animationFrame=this._coreBrowserService.window.requestAnimationFrame((()=>{this._refreshDecorations(),this._animationFrame=void 0})))}};r.OverviewRulerRenderer=d=u([_(2,C.IBufferService),_(3,C.IDecorationService),_(4,m.IRenderService),_(5,C.IOptionsService),_(6,m.ICoreBrowserService)],d)},2950:function(c,r,a){var u=this&&this.__decorate||function(y,h,f,d){var p,v=arguments.length,S=v<3?h:d===null?d=Object.getOwnPropertyDescriptor(h,f):d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")S=Reflect.decorate(y,h,f,d);else for(var w=y.length-1;w>=0;w--)(p=y[w])&&(S=(v<3?p(S):v>3?p(h,f,S):p(h,f))||S);return v>3&&S&&Object.defineProperty(h,f,S),S},_=this&&this.__param||function(y,h){return function(f,d){h(f,d,y)}};Object.defineProperty(r,"__esModule",{value:!0}),r.CompositionHelper=void 0;const l=a(4725),m=a(2585),g=a(2584);let C=r.CompositionHelper=class{get isComposing(){return this._isComposing}constructor(y,h,f,d,p,v){this._textarea=y,this._compositionView=h,this._bufferService=f,this._optionsService=d,this._coreService=p,this._renderService=v,this._isComposing=!1,this._isSendingComposition=!1,this._compositionPosition={start:0,end:0},this._dataAlreadySent=""}compositionstart(){this._isComposing=!0,this._compositionPosition.start=this._textarea.value.length,this._compositionView.textContent="",this._dataAlreadySent="",this._compositionView.classList.add("active")}compositionupdate(y){this._compositionView.textContent=y.data,this.updateCompositionElements(),setTimeout((()=>{this._compositionPosition.end=this._textarea.value.length}),0)}compositionend(){this._finalizeComposition(!0)}keydown(y){if(this._isComposing||this._isSendingComposition){if(y.keyCode===229||y.keyCode===16||y.keyCode===17||y.keyCode===18)return!1;this._finalizeComposition(!1)}return y.keyCode!==229||(this._handleAnyTextareaChanges(),!1)}_finalizeComposition(y){if(this._compositionView.classList.remove("active"),this._isComposing=!1,y){const h={start:this._compositionPosition.start,end:this._compositionPosition.end};this._isSendingComposition=!0,setTimeout((()=>{if(this._isSendingComposition){let f;this._isSendingComposition=!1,h.start+=this._dataAlreadySent.length,f=this._isComposing?this._textarea.value.substring(h.start,h.end):this._textarea.value.substring(h.start),f.length>0&&this._coreService.triggerDataEvent(f,!0)}}),0)}else{this._isSendingComposition=!1;const h=this._textarea.value.substring(this._compositionPosition.start,this._compositionPosition.end);this._coreService.triggerDataEvent(h,!0)}}_handleAnyTextareaChanges(){const y=this._textarea.value;setTimeout((()=>{if(!this._isComposing){const h=this._textarea.value,f=h.replace(y,"");this._dataAlreadySent=f,h.length>y.length?this._coreService.triggerDataEvent(f,!0):h.length<y.length?this._coreService.triggerDataEvent(`${g.C0.DEL}`,!0):h.length===y.length&&h!==y&&this._coreService.triggerDataEvent(h,!0)}}),0)}updateCompositionElements(y){if(this._isComposing){if(this._bufferService.buffer.isCursorInViewport){const h=Math.min(this._bufferService.buffer.x,this._bufferService.cols-1),f=this._renderService.dimensions.css.cell.height,d=this._bufferService.buffer.y*this._renderService.dimensions.css.cell.height,p=h*this._renderService.dimensions.css.cell.width;this._compositionView.style.left=p+"px",this._compositionView.style.top=d+"px",this._compositionView.style.height=f+"px",this._compositionView.style.lineHeight=f+"px",this._compositionView.style.fontFamily=this._optionsService.rawOptions.fontFamily,this._compositionView.style.fontSize=this._optionsService.rawOptions.fontSize+"px";const v=this._compositionView.getBoundingClientRect();this._textarea.style.left=p+"px",this._textarea.style.top=d+"px",this._textarea.style.width=Math.max(v.width,1)+"px",this._textarea.style.height=Math.max(v.height,1)+"px",this._textarea.style.lineHeight=v.height+"px"}y||setTimeout((()=>this.updateCompositionElements(!0)),0)}}};r.CompositionHelper=C=u([_(2,m.IBufferService),_(3,m.IOptionsService),_(4,m.ICoreService),_(5,l.IRenderService)],C)},9806:(c,r)=>{function a(u,_,l){const m=l.getBoundingClientRect(),g=u.getComputedStyle(l),C=parseInt(g.getPropertyValue("padding-left")),y=parseInt(g.getPropertyValue("padding-top"));return[_.clientX-m.left-C,_.clientY-m.top-y]}Object.defineProperty(r,"__esModule",{value:!0}),r.getCoords=r.getCoordsRelativeToElement=void 0,r.getCoordsRelativeToElement=a,r.getCoords=function(u,_,l,m,g,C,y,h,f){if(!C)return;const d=a(u,_,l);return d?(d[0]=Math.ceil((d[0]+(f?y/2:0))/y),d[1]=Math.ceil(d[1]/h),d[0]=Math.min(Math.max(d[0],1),m+(f?1:0)),d[1]=Math.min(Math.max(d[1],1),g),d):void 0}},9504:(c,r,a)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.moveToCellSequence=void 0;const u=a(2584);function _(h,f,d,p){const v=h-l(h,d),S=f-l(f,d),w=Math.abs(v-S)-(function(E,b,k){let R=0;const I=E-l(E,k),P=b-l(b,k);for(let L=0;L<Math.abs(I-P);L++){const z=m(E,b)==="A"?-1:1;k.buffer.lines.get(I+z*L)?.isWrapped&&R++}return R})(h,f,d);return y(w,C(m(h,f),p))}function l(h,f){let d=0,p=f.buffer.lines.get(h),v=p?.isWrapped;for(;v&&h>=0&&h<f.rows;)d++,p=f.buffer.lines.get(--h),v=p?.isWrapped;return d}function m(h,f){return h>f?"A":"B"}function g(h,f,d,p,v,S){let w=h,E=f,b="";for(;w!==d||E!==p;)w+=v?1:-1,v&&w>S.cols-1?(b+=S.buffer.translateBufferLineToString(E,!1,h,w),w=0,h=0,E++):!v&&w<0&&(b+=S.buffer.translateBufferLineToString(E,!1,0,h+1),w=S.cols-1,h=w,E--);return b+S.buffer.translateBufferLineToString(E,!1,h,w)}function C(h,f){const d=f?"O":"[";return u.C0.ESC+d+h}function y(h,f){h=Math.floor(h);let d="";for(let p=0;p<h;p++)d+=f;return d}r.moveToCellSequence=function(h,f,d,p){const v=d.buffer.x,S=d.buffer.y;if(!d.buffer.hasScrollback)return(function(b,k,R,I,P,L){return _(k,I,P,L).length===0?"":y(g(b,k,b,k-l(k,P),!1,P).length,C("D",L))})(v,S,0,f,d,p)+_(S,f,d,p)+(function(b,k,R,I,P,L){let z;z=_(k,I,P,L).length>0?I-l(I,P):k;const J=I,re=(function(te,ee,x,B,N,H){let se;return se=_(x,B,N,H).length>0?B-l(B,N):ee,te<x&&se<=B||te>=x&&se<B?"C":"D"})(b,k,R,I,P,L);return y(g(b,z,R,J,re==="C",P).length,C(re,L))})(v,S,h,f,d,p);let w;if(S===f)return w=v>h?"D":"C",y(Math.abs(v-h),C(w,p));w=S>f?"D":"C";const E=Math.abs(S-f);return y((function(b,k){return k.cols-b})(S>f?h:v,d)+(E-1)*d.cols+1+((S>f?v:h)-1),C(w,p))}},1296:function(c,r,a){var u=this&&this.__decorate||function(L,z,J,re){var te,ee=arguments.length,x=ee<3?z:re===null?re=Object.getOwnPropertyDescriptor(z,J):re;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")x=Reflect.decorate(L,z,J,re);else for(var B=L.length-1;B>=0;B--)(te=L[B])&&(x=(ee<3?te(x):ee>3?te(z,J,x):te(z,J))||x);return ee>3&&x&&Object.defineProperty(z,J,x),x},_=this&&this.__param||function(L,z){return function(J,re){z(J,re,L)}};Object.defineProperty(r,"__esModule",{value:!0}),r.DomRenderer=void 0;const l=a(3787),m=a(2550),g=a(2223),C=a(6171),y=a(6052),h=a(4725),f=a(8055),d=a(8460),p=a(844),v=a(2585),S="xterm-dom-renderer-owner-",w="xterm-rows",E="xterm-fg-",b="xterm-bg-",k="xterm-focus",R="xterm-selection";let I=1,P=r.DomRenderer=class extends p.Disposable{constructor(L,z,J,re,te,ee,x,B,N,H,se,j,V){super(),this._terminal=L,this._document=z,this._element=J,this._screenElement=re,this._viewportElement=te,this._helperContainer=ee,this._linkifier2=x,this._charSizeService=N,this._optionsService=H,this._bufferService=se,this._coreBrowserService=j,this._themeService=V,this._terminalClass=I++,this._rowElements=[],this._selectionRenderModel=(0,y.createSelectionRenderModel)(),this.onRequestRedraw=this.register(new d.EventEmitter).event,this._rowContainer=this._document.createElement("div"),this._rowContainer.classList.add(w),this._rowContainer.style.lineHeight="normal",this._rowContainer.setAttribute("aria-hidden","true"),this._refreshRowElements(this._bufferService.cols,this._bufferService.rows),this._selectionContainer=this._document.createElement("div"),this._selectionContainer.classList.add(R),this._selectionContainer.setAttribute("aria-hidden","true"),this.dimensions=(0,C.createRenderDimensions)(),this._updateDimensions(),this.register(this._optionsService.onOptionChange((()=>this._handleOptionsChanged()))),this.register(this._themeService.onChangeColors((X=>this._injectCss(X)))),this._injectCss(this._themeService.colors),this._rowFactory=B.createInstance(l.DomRendererRowFactory,document),this._element.classList.add(S+this._terminalClass),this._screenElement.appendChild(this._rowContainer),this._screenElement.appendChild(this._selectionContainer),this.register(this._linkifier2.onShowLinkUnderline((X=>this._handleLinkHover(X)))),this.register(this._linkifier2.onHideLinkUnderline((X=>this._handleLinkLeave(X)))),this.register((0,p.toDisposable)((()=>{this._element.classList.remove(S+this._terminalClass),this._rowContainer.remove(),this._selectionContainer.remove(),this._widthCache.dispose(),this._themeStyleElement.remove(),this._dimensionsStyleElement.remove()}))),this._widthCache=new m.WidthCache(this._document,this._helperContainer),this._widthCache.setFont(this._optionsService.rawOptions.fontFamily,this._optionsService.rawOptions.fontSize,this._optionsService.rawOptions.fontWeight,this._optionsService.rawOptions.fontWeightBold),this._setDefaultSpacing()}_updateDimensions(){const L=this._coreBrowserService.dpr;this.dimensions.device.char.width=this._charSizeService.width*L,this.dimensions.device.char.height=Math.ceil(this._charSizeService.height*L),this.dimensions.device.cell.width=this.dimensions.device.char.width+Math.round(this._optionsService.rawOptions.letterSpacing),this.dimensions.device.cell.height=Math.floor(this.dimensions.device.char.height*this._optionsService.rawOptions.lineHeight),this.dimensions.device.char.left=0,this.dimensions.device.char.top=0,this.dimensions.device.canvas.width=this.dimensions.device.cell.width*this._bufferService.cols,this.dimensions.device.canvas.height=this.dimensions.device.cell.height*this._bufferService.rows,this.dimensions.css.canvas.width=Math.round(this.dimensions.device.canvas.width/L),this.dimensions.css.canvas.height=Math.round(this.dimensions.device.canvas.height/L),this.dimensions.css.cell.width=this.dimensions.css.canvas.width/this._bufferService.cols,this.dimensions.css.cell.height=this.dimensions.css.canvas.height/this._bufferService.rows;for(const J of this._rowElements)J.style.width=`${this.dimensions.css.canvas.width}px`,J.style.height=`${this.dimensions.css.cell.height}px`,J.style.lineHeight=`${this.dimensions.css.cell.height}px`,J.style.overflow="hidden";this._dimensionsStyleElement||(this._dimensionsStyleElement=this._document.createElement("style"),this._screenElement.appendChild(this._dimensionsStyleElement));const z=`${this._terminalSelector} .${w} span { display: inline-block; height: 100%; vertical-align: top;}`;this._dimensionsStyleElement.textContent=z,this._selectionContainer.style.height=this._viewportElement.style.height,this._screenElement.style.width=`${this.dimensions.css.canvas.width}px`,this._screenElement.style.height=`${this.dimensions.css.canvas.height}px`}_injectCss(L){this._themeStyleElement||(this._themeStyleElement=this._document.createElement("style"),this._screenElement.appendChild(this._themeStyleElement));let z=`${this._terminalSelector} .${w} { color: ${L.foreground.css}; font-family: ${this._optionsService.rawOptions.fontFamily}; font-size: ${this._optionsService.rawOptions.fontSize}px; font-kerning: none; white-space: pre}`;z+=`${this._terminalSelector} .${w} .xterm-dim { color: ${f.color.multiplyOpacity(L.foreground,.5).css};}`,z+=`${this._terminalSelector} span:not(.xterm-bold) { font-weight: ${this._optionsService.rawOptions.fontWeight};}${this._terminalSelector} span.xterm-bold { font-weight: ${this._optionsService.rawOptions.fontWeightBold};}${this._terminalSelector} span.xterm-italic { font-style: italic;}`;const J=`blink_underline_${this._terminalClass}`,re=`blink_bar_${this._terminalClass}`,te=`blink_block_${this._terminalClass}`;z+=`@keyframes ${J} { 50% {  border-bottom-style: hidden; }}`,z+=`@keyframes ${re} { 50% {  box-shadow: none; }}`,z+=`@keyframes ${te} { 0% {  background-color: ${L.cursor.css};  color: ${L.cursorAccent.css}; } 50% {  background-color: inherit;  color: ${L.cursor.css}; }}`,z+=`${this._terminalSelector} .${w}.${k} .xterm-cursor.xterm-cursor-blink.xterm-cursor-underline { animation: ${J} 1s step-end infinite;}${this._terminalSelector} .${w}.${k} .xterm-cursor.xterm-cursor-blink.xterm-cursor-bar { animation: ${re} 1s step-end infinite;}${this._terminalSelector} .${w}.${k} .xterm-cursor.xterm-cursor-blink.xterm-cursor-block { animation: ${te} 1s step-end infinite;}${this._terminalSelector} .${w} .xterm-cursor.xterm-cursor-block { background-color: ${L.cursor.css}; color: ${L.cursorAccent.css};}${this._terminalSelector} .${w} .xterm-cursor.xterm-cursor-block:not(.xterm-cursor-blink) { background-color: ${L.cursor.css} !important; color: ${L.cursorAccent.css} !important;}${this._terminalSelector} .${w} .xterm-cursor.xterm-cursor-outline { outline: 1px solid ${L.cursor.css}; outline-offset: -1px;}${this._terminalSelector} .${w} .xterm-cursor.xterm-cursor-bar { box-shadow: ${this._optionsService.rawOptions.cursorWidth}px 0 0 ${L.cursor.css} inset;}${this._terminalSelector} .${w} .xterm-cursor.xterm-cursor-underline { border-bottom: 1px ${L.cursor.css}; border-bottom-style: solid; height: calc(100% - 1px);}`,z+=`${this._terminalSelector} .${R} { position: absolute; top: 0; left: 0; z-index: 1; pointer-events: none;}${this._terminalSelector}.focus .${R} div { position: absolute; background-color: ${L.selectionBackgroundOpaque.css};}${this._terminalSelector} .${R} div { position: absolute; background-color: ${L.selectionInactiveBackgroundOpaque.css};}`;for(const[ee,x]of L.ansi.entries())z+=`${this._terminalSelector} .${E}${ee} { color: ${x.css}; }${this._terminalSelector} .${E}${ee}.xterm-dim { color: ${f.color.multiplyOpacity(x,.5).css}; }${this._terminalSelector} .${b}${ee} { background-color: ${x.css}; }`;z+=`${this._terminalSelector} .${E}${g.INVERTED_DEFAULT_COLOR} { color: ${f.color.opaque(L.background).css}; }${this._terminalSelector} .${E}${g.INVERTED_DEFAULT_COLOR}.xterm-dim { color: ${f.color.multiplyOpacity(f.color.opaque(L.background),.5).css}; }${this._terminalSelector} .${b}${g.INVERTED_DEFAULT_COLOR} { background-color: ${L.foreground.css}; }`,this._themeStyleElement.textContent=z}_setDefaultSpacing(){const L=this.dimensions.css.cell.width-this._widthCache.get("W",!1,!1);this._rowContainer.style.letterSpacing=`${L}px`,this._rowFactory.defaultSpacing=L}handleDevicePixelRatioChange(){this._updateDimensions(),this._widthCache.clear(),this._setDefaultSpacing()}_refreshRowElements(L,z){for(let J=this._rowElements.length;J<=z;J++){const re=this._document.createElement("div");this._rowContainer.appendChild(re),this._rowElements.push(re)}for(;this._rowElements.length>z;)this._rowContainer.removeChild(this._rowElements.pop())}handleResize(L,z){this._refreshRowElements(L,z),this._updateDimensions(),this.handleSelectionChanged(this._selectionRenderModel.selectionStart,this._selectionRenderModel.selectionEnd,this._selectionRenderModel.columnSelectMode)}handleCharSizeChanged(){this._updateDimensions(),this._widthCache.clear(),this._setDefaultSpacing()}handleBlur(){this._rowContainer.classList.remove(k),this.renderRows(0,this._bufferService.rows-1)}handleFocus(){this._rowContainer.classList.add(k),this.renderRows(this._bufferService.buffer.y,this._bufferService.buffer.y)}handleSelectionChanged(L,z,J){if(this._selectionContainer.replaceChildren(),this._rowFactory.handleSelectionChanged(L,z,J),this.renderRows(0,this._bufferService.rows-1),!L||!z)return;this._selectionRenderModel.update(this._terminal,L,z,J);const re=this._selectionRenderModel.viewportStartRow,te=this._selectionRenderModel.viewportEndRow,ee=this._selectionRenderModel.viewportCappedStartRow,x=this._selectionRenderModel.viewportCappedEndRow;if(ee>=this._bufferService.rows||x<0)return;const B=this._document.createDocumentFragment();if(J){const N=L[0]>z[0];B.appendChild(this._createSelectionElement(ee,N?z[0]:L[0],N?L[0]:z[0],x-ee+1))}else{const N=re===ee?L[0]:0,H=ee===te?z[0]:this._bufferService.cols;B.appendChild(this._createSelectionElement(ee,N,H));const se=x-ee-1;if(B.appendChild(this._createSelectionElement(ee+1,0,this._bufferService.cols,se)),ee!==x){const j=te===x?z[0]:this._bufferService.cols;B.appendChild(this._createSelectionElement(x,0,j))}}this._selectionContainer.appendChild(B)}_createSelectionElement(L,z,J,re=1){const te=this._document.createElement("div"),ee=z*this.dimensions.css.cell.width;let x=this.dimensions.css.cell.width*(J-z);return ee+x>this.dimensions.css.canvas.width&&(x=this.dimensions.css.canvas.width-ee),te.style.height=re*this.dimensions.css.cell.height+"px",te.style.top=L*this.dimensions.css.cell.height+"px",te.style.left=`${ee}px`,te.style.width=`${x}px`,te}handleCursorMove(){}_handleOptionsChanged(){this._updateDimensions(),this._injectCss(this._themeService.colors),this._widthCache.setFont(this._optionsService.rawOptions.fontFamily,this._optionsService.rawOptions.fontSize,this._optionsService.rawOptions.fontWeight,this._optionsService.rawOptions.fontWeightBold),this._setDefaultSpacing()}clear(){for(const L of this._rowElements)L.replaceChildren()}renderRows(L,z){const J=this._bufferService.buffer,re=J.ybase+J.y,te=Math.min(J.x,this._bufferService.cols-1),ee=this._optionsService.rawOptions.cursorBlink,x=this._optionsService.rawOptions.cursorStyle,B=this._optionsService.rawOptions.cursorInactiveStyle;for(let N=L;N<=z;N++){const H=N+J.ydisp,se=this._rowElements[N],j=J.lines.get(H);if(!se||!j)break;se.replaceChildren(...this._rowFactory.createRow(j,H,H===re,x,B,te,ee,this.dimensions.css.cell.width,this._widthCache,-1,-1))}}get _terminalSelector(){return`.${S}${this._terminalClass}`}_handleLinkHover(L){this._setCellUnderline(L.x1,L.x2,L.y1,L.y2,L.cols,!0)}_handleLinkLeave(L){this._setCellUnderline(L.x1,L.x2,L.y1,L.y2,L.cols,!1)}_setCellUnderline(L,z,J,re,te,ee){J<0&&(L=0),re<0&&(z=0);const x=this._bufferService.rows-1;J=Math.max(Math.min(J,x),0),re=Math.max(Math.min(re,x),0),te=Math.min(te,this._bufferService.cols);const B=this._bufferService.buffer,N=B.ybase+B.y,H=Math.min(B.x,te-1),se=this._optionsService.rawOptions.cursorBlink,j=this._optionsService.rawOptions.cursorStyle,V=this._optionsService.rawOptions.cursorInactiveStyle;for(let X=J;X<=re;++X){const M=X+B.ydisp,T=this._rowElements[X],K=B.lines.get(M);if(!T||!K)break;T.replaceChildren(...this._rowFactory.createRow(K,M,M===N,j,V,H,se,this.dimensions.css.cell.width,this._widthCache,ee?X===J?L:0:-1,ee?(X===re?z:te)-1:-1))}}};r.DomRenderer=P=u([_(7,v.IInstantiationService),_(8,h.ICharSizeService),_(9,v.IOptionsService),_(10,v.IBufferService),_(11,h.ICoreBrowserService),_(12,h.IThemeService)],P)},3787:function(c,r,a){var u=this&&this.__decorate||function(w,E,b,k){var R,I=arguments.length,P=I<3?E:k===null?k=Object.getOwnPropertyDescriptor(E,b):k;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")P=Reflect.decorate(w,E,b,k);else for(var L=w.length-1;L>=0;L--)(R=w[L])&&(P=(I<3?R(P):I>3?R(E,b,P):R(E,b))||P);return I>3&&P&&Object.defineProperty(E,b,P),P},_=this&&this.__param||function(w,E){return function(b,k){E(b,k,w)}};Object.defineProperty(r,"__esModule",{value:!0}),r.DomRendererRowFactory=void 0;const l=a(2223),m=a(643),g=a(511),C=a(2585),y=a(8055),h=a(4725),f=a(4269),d=a(6171),p=a(3734);let v=r.DomRendererRowFactory=class{constructor(w,E,b,k,R,I,P){this._document=w,this._characterJoinerService=E,this._optionsService=b,this._coreBrowserService=k,this._coreService=R,this._decorationService=I,this._themeService=P,this._workCell=new g.CellData,this._columnSelectMode=!1,this.defaultSpacing=0}handleSelectionChanged(w,E,b){this._selectionStart=w,this._selectionEnd=E,this._columnSelectMode=b}createRow(w,E,b,k,R,I,P,L,z,J,re){const te=[],ee=this._characterJoinerService.getJoinedCharacters(E),x=this._themeService.colors;let B,N=w.getNoBgTrimmedLength();b&&N<I+1&&(N=I+1);let H=0,se="",j=0,V=0,X=0,M=!1,T=0,K=!1,q=0;const Y=[],Z=J!==-1&&re!==-1;for(let he=0;he<N;he++){w.loadCell(he,this._workCell);let me=this._workCell.getWidth();if(me===0)continue;let fe=!1,Ae=he,ue=this._workCell;if(ee.length>0&&he===ee[0][0]){fe=!0;const Oe=ee.shift();ue=new f.JoinedCellData(this._workCell,w.translateToString(!0,Oe[0],Oe[1]),Oe[1]-Oe[0]),Ae=Oe[1]-1,me=ue.getWidth()}const ve=this._isCellInSelection(he,E),Me=b&&he===I,et=Z&&he>=J&&he<=re;let $e=!1;this._decorationService.forEachDecorationAtCell(he,E,void 0,(Oe=>{$e=!0}));let tt=ue.getChars()||m.WHITESPACE_CELL_CHAR;if(tt===" "&&(ue.isUnderline()||ue.isOverline())&&(tt=""),q=me*L-z.get(tt,ue.isBold(),ue.isItalic()),B){if(H&&(ve&&K||!ve&&!K&&ue.bg===j)&&(ve&&K&&x.selectionForeground||ue.fg===V)&&ue.extended.ext===X&&et===M&&q===T&&!Me&&!fe&&!$e){ue.isInvisible()?se+=m.WHITESPACE_CELL_CHAR:se+=tt,H++;continue}H&&(B.textContent=se),B=this._document.createElement("span"),H=0,se=""}else B=this._document.createElement("span");if(j=ue.bg,V=ue.fg,X=ue.extended.ext,M=et,T=q,K=ve,fe&&I>=he&&I<=Ae&&(I=he),!this._coreService.isCursorHidden&&Me&&this._coreService.isCursorInitialized){if(Y.push("xterm-cursor"),this._coreBrowserService.isFocused)P&&Y.push("xterm-cursor-blink"),Y.push(k==="bar"?"xterm-cursor-bar":k==="underline"?"xterm-cursor-underline":"xterm-cursor-block");else if(R)switch(R){case"outline":Y.push("xterm-cursor-outline");break;case"block":Y.push("xterm-cursor-block");break;case"bar":Y.push("xterm-cursor-bar");break;case"underline":Y.push("xterm-cursor-underline")}}if(ue.isBold()&&Y.push("xterm-bold"),ue.isItalic()&&Y.push("xterm-italic"),ue.isDim()&&Y.push("xterm-dim"),se=ue.isInvisible()?m.WHITESPACE_CELL_CHAR:ue.getChars()||m.WHITESPACE_CELL_CHAR,ue.isUnderline()&&(Y.push(`xterm-underline-${ue.extended.underlineStyle}`),se===" "&&(se=""),!ue.isUnderlineColorDefault()))if(ue.isUnderlineColorRGB())B.style.textDecorationColor=`rgb(${p.AttributeData.toColorRGB(ue.getUnderlineColor()).join(",")})`;else{let Oe=ue.getUnderlineColor();this._optionsService.rawOptions.drawBoldTextInBrightColors&&ue.isBold()&&Oe<8&&(Oe+=8),B.style.textDecorationColor=x.ansi[Oe].css}ue.isOverline()&&(Y.push("xterm-overline"),se===" "&&(se="")),ue.isStrikethrough()&&Y.push("xterm-strikethrough"),et&&(B.style.textDecoration="underline");let He=ue.getFgColor(),Ut=ue.getFgColorMode(),ut=ue.getBgColor(),Nt=ue.getBgColorMode();const oi=!!ue.isInverse();if(oi){const Oe=He;He=ut,ut=Oe;const Ni=Ut;Ut=Nt,Nt=Ni}let kt,je,rt,bt=!1;switch(this._decorationService.forEachDecorationAtCell(he,E,void 0,(Oe=>{Oe.options.layer!=="top"&&bt||(Oe.backgroundColorRGB&&(Nt=50331648,ut=Oe.backgroundColorRGB.rgba>>8&16777215,kt=Oe.backgroundColorRGB),Oe.foregroundColorRGB&&(Ut=50331648,He=Oe.foregroundColorRGB.rgba>>8&16777215,je=Oe.foregroundColorRGB),bt=Oe.options.layer==="top")})),!bt&&ve&&(kt=this._coreBrowserService.isFocused?x.selectionBackgroundOpaque:x.selectionInactiveBackgroundOpaque,ut=kt.rgba>>8&16777215,Nt=50331648,bt=!0,x.selectionForeground&&(Ut=50331648,He=x.selectionForeground.rgba>>8&16777215,je=x.selectionForeground)),bt&&Y.push("xterm-decoration-top"),Nt){case 16777216:case 33554432:rt=x.ansi[ut],Y.push(`xterm-bg-${ut}`);break;case 50331648:rt=y.channels.toColor(ut>>16,ut>>8&255,255&ut),this._addStyle(B,`background-color:#${S((ut>>>0).toString(16),"0",6)}`);break;default:oi?(rt=x.foreground,Y.push(`xterm-bg-${l.INVERTED_DEFAULT_COLOR}`)):rt=x.background}switch(kt||ue.isDim()&&(kt=y.color.multiplyOpacity(rt,.5)),Ut){case 16777216:case 33554432:ue.isBold()&&He<8&&this._optionsService.rawOptions.drawBoldTextInBrightColors&&(He+=8),this._applyMinimumContrast(B,rt,x.ansi[He],ue,kt,void 0)||Y.push(`xterm-fg-${He}`);break;case 50331648:const Oe=y.channels.toColor(He>>16&255,He>>8&255,255&He);this._applyMinimumContrast(B,rt,Oe,ue,kt,je)||this._addStyle(B,`color:#${S(He.toString(16),"0",6)}`);break;default:this._applyMinimumContrast(B,rt,x.foreground,ue,kt,je)||oi&&Y.push(`xterm-fg-${l.INVERTED_DEFAULT_COLOR}`)}Y.length&&(B.className=Y.join(" "),Y.length=0),Me||fe||$e?B.textContent=se:H++,q!==this.defaultSpacing&&(B.style.letterSpacing=`${q}px`),te.push(B),he=Ae}return B&&H&&(B.textContent=se),te}_applyMinimumContrast(w,E,b,k,R,I){if(this._optionsService.rawOptions.minimumContrastRatio===1||(0,d.treatGlyphAsBackgroundColor)(k.getCode()))return!1;const P=this._getContrastCache(k);let L;if(R||I||(L=P.getColor(E.rgba,b.rgba)),L===void 0){const z=this._optionsService.rawOptions.minimumContrastRatio/(k.isDim()?2:1);L=y.color.ensureContrastRatio(R||E,I||b,z),P.setColor((R||E).rgba,(I||b).rgba,L??null)}return!!L&&(this._addStyle(w,`color:${L.css}`),!0)}_getContrastCache(w){return w.isDim()?this._themeService.colors.halfContrastCache:this._themeService.colors.contrastCache}_addStyle(w,E){w.setAttribute("style",`${w.getAttribute("style")||""}${E};`)}_isCellInSelection(w,E){const b=this._selectionStart,k=this._selectionEnd;return!(!b||!k)&&(this._columnSelectMode?b[0]<=k[0]?w>=b[0]&&E>=b[1]&&w<k[0]&&E<=k[1]:w<b[0]&&E>=b[1]&&w>=k[0]&&E<=k[1]:E>b[1]&&E<k[1]||b[1]===k[1]&&E===b[1]&&w>=b[0]&&w<k[0]||b[1]<k[1]&&E===k[1]&&w<k[0]||b[1]<k[1]&&E===b[1]&&w>=b[0])}};function S(w,E,b){for(;w.length<b;)w=E+w;return w}r.DomRendererRowFactory=v=u([_(1,h.ICharacterJoinerService),_(2,C.IOptionsService),_(3,h.ICoreBrowserService),_(4,C.ICoreService),_(5,C.IDecorationService),_(6,h.IThemeService)],v)},2550:(c,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.WidthCache=void 0,r.WidthCache=class{constructor(a,u){this._flat=new Float32Array(256),this._font="",this._fontSize=0,this._weight="normal",this._weightBold="bold",this._measureElements=[],this._container=a.createElement("div"),this._container.classList.add("xterm-width-cache-measure-container"),this._container.setAttribute("aria-hidden","true"),this._container.style.whiteSpace="pre",this._container.style.fontKerning="none";const _=a.createElement("span");_.classList.add("xterm-char-measure-element");const l=a.createElement("span");l.classList.add("xterm-char-measure-element"),l.style.fontWeight="bold";const m=a.createElement("span");m.classList.add("xterm-char-measure-element"),m.style.fontStyle="italic";const g=a.createElement("span");g.classList.add("xterm-char-measure-element"),g.style.fontWeight="bold",g.style.fontStyle="italic",this._measureElements=[_,l,m,g],this._container.appendChild(_),this._container.appendChild(l),this._container.appendChild(m),this._container.appendChild(g),u.appendChild(this._container),this.clear()}dispose(){this._container.remove(),this._measureElements.length=0,this._holey=void 0}clear(){this._flat.fill(-9999),this._holey=new Map}setFont(a,u,_,l){a===this._font&&u===this._fontSize&&_===this._weight&&l===this._weightBold||(this._font=a,this._fontSize=u,this._weight=_,this._weightBold=l,this._container.style.fontFamily=this._font,this._container.style.fontSize=`${this._fontSize}px`,this._measureElements[0].style.fontWeight=`${_}`,this._measureElements[1].style.fontWeight=`${l}`,this._measureElements[2].style.fontWeight=`${_}`,this._measureElements[3].style.fontWeight=`${l}`,this.clear())}get(a,u,_){let l=0;if(!u&&!_&&a.length===1&&(l=a.charCodeAt(0))<256){if(this._flat[l]!==-9999)return this._flat[l];const C=this._measure(a,0);return C>0&&(this._flat[l]=C),C}let m=a;u&&(m+="B"),_&&(m+="I");let g=this._holey.get(m);if(g===void 0){let C=0;u&&(C|=1),_&&(C|=2),g=this._measure(a,C),g>0&&this._holey.set(m,g)}return g}_measure(a,u){const _=this._measureElements[u];return _.textContent=a.repeat(32),_.offsetWidth/32}}},2223:(c,r,a)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.TEXT_BASELINE=r.DIM_OPACITY=r.INVERTED_DEFAULT_COLOR=void 0;const u=a(6114);r.INVERTED_DEFAULT_COLOR=257,r.DIM_OPACITY=.5,r.TEXT_BASELINE=u.isFirefox||u.isLegacyEdge?"bottom":"ideographic"},6171:(c,r)=>{function a(_){return 57508<=_&&_<=57558}function u(_){return _>=128512&&_<=128591||_>=127744&&_<=128511||_>=128640&&_<=128767||_>=9728&&_<=9983||_>=9984&&_<=10175||_>=65024&&_<=65039||_>=129280&&_<=129535||_>=127462&&_<=127487}Object.defineProperty(r,"__esModule",{value:!0}),r.computeNextVariantOffset=r.createRenderDimensions=r.treatGlyphAsBackgroundColor=r.allowRescaling=r.isEmoji=r.isRestrictedPowerlineGlyph=r.isPowerlineGlyph=r.throwIfFalsy=void 0,r.throwIfFalsy=function(_){if(!_)throw new Error("value must not be falsy");return _},r.isPowerlineGlyph=a,r.isRestrictedPowerlineGlyph=function(_){return 57520<=_&&_<=57527},r.isEmoji=u,r.allowRescaling=function(_,l,m,g){return l===1&&m>Math.ceil(1.5*g)&&_!==void 0&&_>255&&!u(_)&&!a(_)&&!(function(C){return 57344<=C&&C<=63743})(_)},r.treatGlyphAsBackgroundColor=function(_){return a(_)||(function(l){return 9472<=l&&l<=9631})(_)},r.createRenderDimensions=function(){return{css:{canvas:{width:0,height:0},cell:{width:0,height:0}},device:{canvas:{width:0,height:0},cell:{width:0,height:0},char:{width:0,height:0,left:0,top:0}}}},r.computeNextVariantOffset=function(_,l,m=0){return(_-(2*Math.round(l)-m))%(2*Math.round(l))}},6052:(c,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.createSelectionRenderModel=void 0;class a{constructor(){this.clear()}clear(){this.hasSelection=!1,this.columnSelectMode=!1,this.viewportStartRow=0,this.viewportEndRow=0,this.viewportCappedStartRow=0,this.viewportCappedEndRow=0,this.startCol=0,this.endCol=0,this.selectionStart=void 0,this.selectionEnd=void 0}update(_,l,m,g=!1){if(this.selectionStart=l,this.selectionEnd=m,!l||!m||l[0]===m[0]&&l[1]===m[1])return void this.clear();const C=_.buffers.active.ydisp,y=l[1]-C,h=m[1]-C,f=Math.max(y,0),d=Math.min(h,_.rows-1);f>=_.rows||d<0?this.clear():(this.hasSelection=!0,this.columnSelectMode=g,this.viewportStartRow=y,this.viewportEndRow=h,this.viewportCappedStartRow=f,this.viewportCappedEndRow=d,this.startCol=l[0],this.endCol=m[0])}isCellSelected(_,l,m){return!!this.hasSelection&&(m-=_.buffer.active.viewportY,this.columnSelectMode?this.startCol<=this.endCol?l>=this.startCol&&m>=this.viewportCappedStartRow&&l<this.endCol&&m<=this.viewportCappedEndRow:l<this.startCol&&m>=this.viewportCappedStartRow&&l>=this.endCol&&m<=this.viewportCappedEndRow:m>this.viewportStartRow&&m<this.viewportEndRow||this.viewportStartRow===this.viewportEndRow&&m===this.viewportStartRow&&l>=this.startCol&&l<this.endCol||this.viewportStartRow<this.viewportEndRow&&m===this.viewportEndRow&&l<this.endCol||this.viewportStartRow<this.viewportEndRow&&m===this.viewportStartRow&&l>=this.startCol)}}r.createSelectionRenderModel=function(){return new a}},456:(c,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.SelectionModel=void 0,r.SelectionModel=class{constructor(a){this._bufferService=a,this.isSelectAllActive=!1,this.selectionStartLength=0}clearSelection(){this.selectionStart=void 0,this.selectionEnd=void 0,this.isSelectAllActive=!1,this.selectionStartLength=0}get finalSelectionStart(){return this.isSelectAllActive?[0,0]:this.selectionEnd&&this.selectionStart&&this.areSelectionValuesReversed()?this.selectionEnd:this.selectionStart}get finalSelectionEnd(){if(this.isSelectAllActive)return[this._bufferService.cols,this._bufferService.buffer.ybase+this._bufferService.rows-1];if(this.selectionStart){if(!this.selectionEnd||this.areSelectionValuesReversed()){const a=this.selectionStart[0]+this.selectionStartLength;return a>this._bufferService.cols?a%this._bufferService.cols==0?[this._bufferService.cols,this.selectionStart[1]+Math.floor(a/this._bufferService.cols)-1]:[a%this._bufferService.cols,this.selectionStart[1]+Math.floor(a/this._bufferService.cols)]:[a,this.selectionStart[1]]}if(this.selectionStartLength&&this.selectionEnd[1]===this.selectionStart[1]){const a=this.selectionStart[0]+this.selectionStartLength;return a>this._bufferService.cols?[a%this._bufferService.cols,this.selectionStart[1]+Math.floor(a/this._bufferService.cols)]:[Math.max(a,this.selectionEnd[0]),this.selectionEnd[1]]}return this.selectionEnd}}areSelectionValuesReversed(){const a=this.selectionStart,u=this.selectionEnd;return!(!a||!u)&&(a[1]>u[1]||a[1]===u[1]&&a[0]>u[0])}handleTrim(a){return this.selectionStart&&(this.selectionStart[1]-=a),this.selectionEnd&&(this.selectionEnd[1]-=a),this.selectionEnd&&this.selectionEnd[1]<0?(this.clearSelection(),!0):(this.selectionStart&&this.selectionStart[1]<0&&(this.selectionStart[1]=0),!1)}}},428:function(c,r,a){var u=this&&this.__decorate||function(d,p,v,S){var w,E=arguments.length,b=E<3?p:S===null?S=Object.getOwnPropertyDescriptor(p,v):S;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")b=Reflect.decorate(d,p,v,S);else for(var k=d.length-1;k>=0;k--)(w=d[k])&&(b=(E<3?w(b):E>3?w(p,v,b):w(p,v))||b);return E>3&&b&&Object.defineProperty(p,v,b),b},_=this&&this.__param||function(d,p){return function(v,S){p(v,S,d)}};Object.defineProperty(r,"__esModule",{value:!0}),r.CharSizeService=void 0;const l=a(2585),m=a(8460),g=a(844);let C=r.CharSizeService=class extends g.Disposable{get hasValidSize(){return this.width>0&&this.height>0}constructor(d,p,v){super(),this._optionsService=v,this.width=0,this.height=0,this._onCharSizeChange=this.register(new m.EventEmitter),this.onCharSizeChange=this._onCharSizeChange.event;try{this._measureStrategy=this.register(new f(this._optionsService))}catch{this._measureStrategy=this.register(new h(d,p,this._optionsService))}this.register(this._optionsService.onMultipleOptionChange(["fontFamily","fontSize"],(()=>this.measure())))}measure(){const d=this._measureStrategy.measure();d.width===this.width&&d.height===this.height||(this.width=d.width,this.height=d.height,this._onCharSizeChange.fire())}};r.CharSizeService=C=u([_(2,l.IOptionsService)],C);class y extends g.Disposable{constructor(){super(...arguments),this._result={width:0,height:0}}_validateAndSet(p,v){p!==void 0&&p>0&&v!==void 0&&v>0&&(this._result.width=p,this._result.height=v)}}class h extends y{constructor(p,v,S){super(),this._document=p,this._parentElement=v,this._optionsService=S,this._measureElement=this._document.createElement("span"),this._measureElement.classList.add("xterm-char-measure-element"),this._measureElement.textContent="W".repeat(32),this._measureElement.setAttribute("aria-hidden","true"),this._measureElement.style.whiteSpace="pre",this._measureElement.style.fontKerning="none",this._parentElement.appendChild(this._measureElement)}measure(){return this._measureElement.style.fontFamily=this._optionsService.rawOptions.fontFamily,this._measureElement.style.fontSize=`${this._optionsService.rawOptions.fontSize}px`,this._validateAndSet(Number(this._measureElement.offsetWidth)/32,Number(this._measureElement.offsetHeight)),this._result}}class f extends y{constructor(p){super(),this._optionsService=p,this._canvas=new OffscreenCanvas(100,100),this._ctx=this._canvas.getContext("2d");const v=this._ctx.measureText("W");if(!("width"in v&&"fontBoundingBoxAscent"in v&&"fontBoundingBoxDescent"in v))throw new Error("Required font metrics not supported")}measure(){this._ctx.font=`${this._optionsService.rawOptions.fontSize}px ${this._optionsService.rawOptions.fontFamily}`;const p=this._ctx.measureText("W");return this._validateAndSet(p.width,p.fontBoundingBoxAscent+p.fontBoundingBoxDescent),this._result}}},4269:function(c,r,a){var u=this&&this.__decorate||function(f,d,p,v){var S,w=arguments.length,E=w<3?d:v===null?v=Object.getOwnPropertyDescriptor(d,p):v;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")E=Reflect.decorate(f,d,p,v);else for(var b=f.length-1;b>=0;b--)(S=f[b])&&(E=(w<3?S(E):w>3?S(d,p,E):S(d,p))||E);return w>3&&E&&Object.defineProperty(d,p,E),E},_=this&&this.__param||function(f,d){return function(p,v){d(p,v,f)}};Object.defineProperty(r,"__esModule",{value:!0}),r.CharacterJoinerService=r.JoinedCellData=void 0;const l=a(3734),m=a(643),g=a(511),C=a(2585);class y extends l.AttributeData{constructor(d,p,v){super(),this.content=0,this.combinedData="",this.fg=d.fg,this.bg=d.bg,this.combinedData=p,this._width=v}isCombined(){return 2097152}getWidth(){return this._width}getChars(){return this.combinedData}getCode(){return 2097151}setFromCharData(d){throw new Error("not implemented")}getAsCharData(){return[this.fg,this.getChars(),this.getWidth(),this.getCode()]}}r.JoinedCellData=y;let h=r.CharacterJoinerService=class vh{constructor(d){this._bufferService=d,this._characterJoiners=[],this._nextCharacterJoinerId=0,this._workCell=new g.CellData}register(d){const p={id:this._nextCharacterJoinerId++,handler:d};return this._characterJoiners.push(p),p.id}deregister(d){for(let p=0;p<this._characterJoiners.length;p++)if(this._characterJoiners[p].id===d)return this._characterJoiners.splice(p,1),!0;return!1}getJoinedCharacters(d){if(this._characterJoiners.length===0)return[];const p=this._bufferService.buffer.lines.get(d);if(!p||p.length===0)return[];const v=[],S=p.translateToString(!0);let w=0,E=0,b=0,k=p.getFg(0),R=p.getBg(0);for(let I=0;I<p.getTrimmedLength();I++)if(p.loadCell(I,this._workCell),this._workCell.getWidth()!==0){if(this._workCell.fg!==k||this._workCell.bg!==R){if(I-w>1){const P=this._getJoinedRanges(S,b,E,p,w);for(let L=0;L<P.length;L++)v.push(P[L])}w=I,b=E,k=this._workCell.fg,R=this._workCell.bg}E+=this._workCell.getChars().length||m.WHITESPACE_CELL_CHAR.length}if(this._bufferService.cols-w>1){const I=this._getJoinedRanges(S,b,E,p,w);for(let P=0;P<I.length;P++)v.push(I[P])}return v}_getJoinedRanges(d,p,v,S,w){const E=d.substring(p,v);let b=[];try{b=this._characterJoiners[0].handler(E)}catch(k){console.error(k)}for(let k=1;k<this._characterJoiners.length;k++)try{const R=this._characterJoiners[k].handler(E);for(let I=0;I<R.length;I++)vh._mergeRanges(b,R[I])}catch(R){console.error(R)}return this._stringRangesToCellRanges(b,S,w),b}_stringRangesToCellRanges(d,p,v){let S=0,w=!1,E=0,b=d[S];if(b){for(let k=v;k<this._bufferService.cols;k++){const R=p.getWidth(k),I=p.getString(k).length||m.WHITESPACE_CELL_CHAR.length;if(R!==0){if(!w&&b[0]<=E&&(b[0]=k,w=!0),b[1]<=E){if(b[1]=k,b=d[++S],!b)break;b[0]<=E?(b[0]=k,w=!0):w=!1}E+=I}}b&&(b[1]=this._bufferService.cols)}}static _mergeRanges(d,p){let v=!1;for(let S=0;S<d.length;S++){const w=d[S];if(v){if(p[1]<=w[0])return d[S-1][1]=p[1],d;if(p[1]<=w[1])return d[S-1][1]=Math.max(p[1],w[1]),d.splice(S,1),d;d.splice(S,1),S--}else{if(p[1]<=w[0])return d.splice(S,0,p),d;if(p[1]<=w[1])return w[0]=Math.min(p[0],w[0]),d;p[0]<w[1]&&(w[0]=Math.min(p[0],w[0]),v=!0)}}return v?d[d.length-1][1]=p[1]:d.push(p),d}};r.CharacterJoinerService=h=u([_(0,C.IBufferService)],h)},5114:(c,r,a)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.CoreBrowserService=void 0;const u=a(844),_=a(8460),l=a(3656);class m extends u.Disposable{constructor(y,h,f){super(),this._textarea=y,this._window=h,this.mainDocument=f,this._isFocused=!1,this._cachedIsFocused=void 0,this._screenDprMonitor=new g(this._window),this._onDprChange=this.register(new _.EventEmitter),this.onDprChange=this._onDprChange.event,this._onWindowChange=this.register(new _.EventEmitter),this.onWindowChange=this._onWindowChange.event,this.register(this.onWindowChange((d=>this._screenDprMonitor.setWindow(d)))),this.register((0,_.forwardEvent)(this._screenDprMonitor.onDprChange,this._onDprChange)),this._textarea.addEventListener("focus",(()=>this._isFocused=!0)),this._textarea.addEventListener("blur",(()=>this._isFocused=!1))}get window(){return this._window}set window(y){this._window!==y&&(this._window=y,this._onWindowChange.fire(this._window))}get dpr(){return this.window.devicePixelRatio}get isFocused(){return this._cachedIsFocused===void 0&&(this._cachedIsFocused=this._isFocused&&this._textarea.ownerDocument.hasFocus(),queueMicrotask((()=>this._cachedIsFocused=void 0))),this._cachedIsFocused}}r.CoreBrowserService=m;class g extends u.Disposable{constructor(y){super(),this._parentWindow=y,this._windowResizeListener=this.register(new u.MutableDisposable),this._onDprChange=this.register(new _.EventEmitter),this.onDprChange=this._onDprChange.event,this._outerListener=()=>this._setDprAndFireIfDiffers(),this._currentDevicePixelRatio=this._parentWindow.devicePixelRatio,this._updateDpr(),this._setWindowResizeListener(),this.register((0,u.toDisposable)((()=>this.clearListener())))}setWindow(y){this._parentWindow=y,this._setWindowResizeListener(),this._setDprAndFireIfDiffers()}_setWindowResizeListener(){this._windowResizeListener.value=(0,l.addDisposableDomListener)(this._parentWindow,"resize",(()=>this._setDprAndFireIfDiffers()))}_setDprAndFireIfDiffers(){this._parentWindow.devicePixelRatio!==this._currentDevicePixelRatio&&this._onDprChange.fire(this._parentWindow.devicePixelRatio),this._updateDpr()}_updateDpr(){this._outerListener&&(this._resolutionMediaMatchList?.removeListener(this._outerListener),this._currentDevicePixelRatio=this._parentWindow.devicePixelRatio,this._resolutionMediaMatchList=this._parentWindow.matchMedia(`screen and (resolution: ${this._parentWindow.devicePixelRatio}dppx)`),this._resolutionMediaMatchList.addListener(this._outerListener))}clearListener(){this._resolutionMediaMatchList&&this._outerListener&&(this._resolutionMediaMatchList.removeListener(this._outerListener),this._resolutionMediaMatchList=void 0,this._outerListener=void 0)}}},779:(c,r,a)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.LinkProviderService=void 0;const u=a(844);class _ extends u.Disposable{constructor(){super(),this.linkProviders=[],this.register((0,u.toDisposable)((()=>this.linkProviders.length=0)))}registerLinkProvider(m){return this.linkProviders.push(m),{dispose:()=>{const g=this.linkProviders.indexOf(m);g!==-1&&this.linkProviders.splice(g,1)}}}}r.LinkProviderService=_},8934:function(c,r,a){var u=this&&this.__decorate||function(C,y,h,f){var d,p=arguments.length,v=p<3?y:f===null?f=Object.getOwnPropertyDescriptor(y,h):f;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")v=Reflect.decorate(C,y,h,f);else for(var S=C.length-1;S>=0;S--)(d=C[S])&&(v=(p<3?d(v):p>3?d(y,h,v):d(y,h))||v);return p>3&&v&&Object.defineProperty(y,h,v),v},_=this&&this.__param||function(C,y){return function(h,f){y(h,f,C)}};Object.defineProperty(r,"__esModule",{value:!0}),r.MouseService=void 0;const l=a(4725),m=a(9806);let g=r.MouseService=class{constructor(C,y){this._renderService=C,this._charSizeService=y}getCoords(C,y,h,f,d){return(0,m.getCoords)(window,C,y,h,f,this._charSizeService.hasValidSize,this._renderService.dimensions.css.cell.width,this._renderService.dimensions.css.cell.height,d)}getMouseReportCoords(C,y){const h=(0,m.getCoordsRelativeToElement)(window,C,y);if(this._charSizeService.hasValidSize)return h[0]=Math.min(Math.max(h[0],0),this._renderService.dimensions.css.canvas.width-1),h[1]=Math.min(Math.max(h[1],0),this._renderService.dimensions.css.canvas.height-1),{col:Math.floor(h[0]/this._renderService.dimensions.css.cell.width),row:Math.floor(h[1]/this._renderService.dimensions.css.cell.height),x:Math.floor(h[0]),y:Math.floor(h[1])}}};r.MouseService=g=u([_(0,l.IRenderService),_(1,l.ICharSizeService)],g)},3230:function(c,r,a){var u=this&&this.__decorate||function(d,p,v,S){var w,E=arguments.length,b=E<3?p:S===null?S=Object.getOwnPropertyDescriptor(p,v):S;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")b=Reflect.decorate(d,p,v,S);else for(var k=d.length-1;k>=0;k--)(w=d[k])&&(b=(E<3?w(b):E>3?w(p,v,b):w(p,v))||b);return E>3&&b&&Object.defineProperty(p,v,b),b},_=this&&this.__param||function(d,p){return function(v,S){p(v,S,d)}};Object.defineProperty(r,"__esModule",{value:!0}),r.RenderService=void 0;const l=a(6193),m=a(4725),g=a(8460),C=a(844),y=a(7226),h=a(2585);let f=r.RenderService=class extends C.Disposable{get dimensions(){return this._renderer.value.dimensions}constructor(d,p,v,S,w,E,b,k){super(),this._rowCount=d,this._charSizeService=S,this._renderer=this.register(new C.MutableDisposable),this._pausedResizeTask=new y.DebouncedIdleTask,this._observerDisposable=this.register(new C.MutableDisposable),this._isPaused=!1,this._needsFullRefresh=!1,this._isNextRenderRedrawOnly=!0,this._needsSelectionRefresh=!1,this._canvasWidth=0,this._canvasHeight=0,this._selectionState={start:void 0,end:void 0,columnSelectMode:!1},this._onDimensionsChange=this.register(new g.EventEmitter),this.onDimensionsChange=this._onDimensionsChange.event,this._onRenderedViewportChange=this.register(new g.EventEmitter),this.onRenderedViewportChange=this._onRenderedViewportChange.event,this._onRender=this.register(new g.EventEmitter),this.onRender=this._onRender.event,this._onRefreshRequest=this.register(new g.EventEmitter),this.onRefreshRequest=this._onRefreshRequest.event,this._renderDebouncer=new l.RenderDebouncer(((R,I)=>this._renderRows(R,I)),b),this.register(this._renderDebouncer),this.register(b.onDprChange((()=>this.handleDevicePixelRatioChange()))),this.register(E.onResize((()=>this._fullRefresh()))),this.register(E.buffers.onBufferActivate((()=>this._renderer.value?.clear()))),this.register(v.onOptionChange((()=>this._handleOptionsChanged()))),this.register(this._charSizeService.onCharSizeChange((()=>this.handleCharSizeChanged()))),this.register(w.onDecorationRegistered((()=>this._fullRefresh()))),this.register(w.onDecorationRemoved((()=>this._fullRefresh()))),this.register(v.onMultipleOptionChange(["customGlyphs","drawBoldTextInBrightColors","letterSpacing","lineHeight","fontFamily","fontSize","fontWeight","fontWeightBold","minimumContrastRatio","rescaleOverlappingGlyphs"],(()=>{this.clear(),this.handleResize(E.cols,E.rows),this._fullRefresh()}))),this.register(v.onMultipleOptionChange(["cursorBlink","cursorStyle"],(()=>this.refreshRows(E.buffer.y,E.buffer.y,!0)))),this.register(k.onChangeColors((()=>this._fullRefresh()))),this._registerIntersectionObserver(b.window,p),this.register(b.onWindowChange((R=>this._registerIntersectionObserver(R,p))))}_registerIntersectionObserver(d,p){if("IntersectionObserver"in d){const v=new d.IntersectionObserver((S=>this._handleIntersectionChange(S[S.length-1])),{threshold:0});v.observe(p),this._observerDisposable.value=(0,C.toDisposable)((()=>v.disconnect()))}}_handleIntersectionChange(d){this._isPaused=d.isIntersecting===void 0?d.intersectionRatio===0:!d.isIntersecting,this._isPaused||this._charSizeService.hasValidSize||this._charSizeService.measure(),!this._isPaused&&this._needsFullRefresh&&(this._pausedResizeTask.flush(),this.refreshRows(0,this._rowCount-1),this._needsFullRefresh=!1)}refreshRows(d,p,v=!1){this._isPaused?this._needsFullRefresh=!0:(v||(this._isNextRenderRedrawOnly=!1),this._renderDebouncer.refresh(d,p,this._rowCount))}_renderRows(d,p){this._renderer.value&&(d=Math.min(d,this._rowCount-1),p=Math.min(p,this._rowCount-1),this._renderer.value.renderRows(d,p),this._needsSelectionRefresh&&(this._renderer.value.handleSelectionChanged(this._selectionState.start,this._selectionState.end,this._selectionState.columnSelectMode),this._needsSelectionRefresh=!1),this._isNextRenderRedrawOnly||this._onRenderedViewportChange.fire({start:d,end:p}),this._onRender.fire({start:d,end:p}),this._isNextRenderRedrawOnly=!0)}resize(d,p){this._rowCount=p,this._fireOnCanvasResize()}_handleOptionsChanged(){this._renderer.value&&(this.refreshRows(0,this._rowCount-1),this._fireOnCanvasResize())}_fireOnCanvasResize(){this._renderer.value&&(this._renderer.value.dimensions.css.canvas.width===this._canvasWidth&&this._renderer.value.dimensions.css.canvas.height===this._canvasHeight||this._onDimensionsChange.fire(this._renderer.value.dimensions))}hasRenderer(){return!!this._renderer.value}setRenderer(d){this._renderer.value=d,this._renderer.value&&(this._renderer.value.onRequestRedraw((p=>this.refreshRows(p.start,p.end,!0))),this._needsSelectionRefresh=!0,this._fullRefresh())}addRefreshCallback(d){return this._renderDebouncer.addRefreshCallback(d)}_fullRefresh(){this._isPaused?this._needsFullRefresh=!0:this.refreshRows(0,this._rowCount-1)}clearTextureAtlas(){this._renderer.value&&(this._renderer.value.clearTextureAtlas?.(),this._fullRefresh())}handleDevicePixelRatioChange(){this._charSizeService.measure(),this._renderer.value&&(this._renderer.value.handleDevicePixelRatioChange(),this.refreshRows(0,this._rowCount-1))}handleResize(d,p){this._renderer.value&&(this._isPaused?this._pausedResizeTask.set((()=>this._renderer.value?.handleResize(d,p))):this._renderer.value.handleResize(d,p),this._fullRefresh())}handleCharSizeChanged(){this._renderer.value?.handleCharSizeChanged()}handleBlur(){this._renderer.value?.handleBlur()}handleFocus(){this._renderer.value?.handleFocus()}handleSelectionChanged(d,p,v){this._selectionState.start=d,this._selectionState.end=p,this._selectionState.columnSelectMode=v,this._renderer.value?.handleSelectionChanged(d,p,v)}handleCursorMove(){this._renderer.value?.handleCursorMove()}clear(){this._renderer.value?.clear()}};r.RenderService=f=u([_(2,h.IOptionsService),_(3,m.ICharSizeService),_(4,h.IDecorationService),_(5,h.IBufferService),_(6,m.ICoreBrowserService),_(7,m.IThemeService)],f)},9312:function(c,r,a){var u=this&&this.__decorate||function(b,k,R,I){var P,L=arguments.length,z=L<3?k:I===null?I=Object.getOwnPropertyDescriptor(k,R):I;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")z=Reflect.decorate(b,k,R,I);else for(var J=b.length-1;J>=0;J--)(P=b[J])&&(z=(L<3?P(z):L>3?P(k,R,z):P(k,R))||z);return L>3&&z&&Object.defineProperty(k,R,z),z},_=this&&this.__param||function(b,k){return function(R,I){k(R,I,b)}};Object.defineProperty(r,"__esModule",{value:!0}),r.SelectionService=void 0;const l=a(9806),m=a(9504),g=a(456),C=a(4725),y=a(8460),h=a(844),f=a(6114),d=a(4841),p=a(511),v=a(2585),S="",w=new RegExp(S,"g");let E=r.SelectionService=class extends h.Disposable{constructor(b,k,R,I,P,L,z,J,re){super(),this._element=b,this._screenElement=k,this._linkifier=R,this._bufferService=I,this._coreService=P,this._mouseService=L,this._optionsService=z,this._renderService=J,this._coreBrowserService=re,this._dragScrollAmount=0,this._enabled=!0,this._workCell=new p.CellData,this._mouseDownTimeStamp=0,this._oldHasSelection=!1,this._oldSelectionStart=void 0,this._oldSelectionEnd=void 0,this._onLinuxMouseSelection=this.register(new y.EventEmitter),this.onLinuxMouseSelection=this._onLinuxMouseSelection.event,this._onRedrawRequest=this.register(new y.EventEmitter),this.onRequestRedraw=this._onRedrawRequest.event,this._onSelectionChange=this.register(new y.EventEmitter),this.onSelectionChange=this._onSelectionChange.event,this._onRequestScrollLines=this.register(new y.EventEmitter),this.onRequestScrollLines=this._onRequestScrollLines.event,this._mouseMoveListener=te=>this._handleMouseMove(te),this._mouseUpListener=te=>this._handleMouseUp(te),this._coreService.onUserInput((()=>{this.hasSelection&&this.clearSelection()})),this._trimListener=this._bufferService.buffer.lines.onTrim((te=>this._handleTrim(te))),this.register(this._bufferService.buffers.onBufferActivate((te=>this._handleBufferActivate(te)))),this.enable(),this._model=new g.SelectionModel(this._bufferService),this._activeSelectionMode=0,this.register((0,h.toDisposable)((()=>{this._removeMouseDownListeners()})))}reset(){this.clearSelection()}disable(){this.clearSelection(),this._enabled=!1}enable(){this._enabled=!0}get selectionStart(){return this._model.finalSelectionStart}get selectionEnd(){return this._model.finalSelectionEnd}get hasSelection(){const b=this._model.finalSelectionStart,k=this._model.finalSelectionEnd;return!(!b||!k||b[0]===k[0]&&b[1]===k[1])}get selectionText(){const b=this._model.finalSelectionStart,k=this._model.finalSelectionEnd;if(!b||!k)return"";const R=this._bufferService.buffer,I=[];if(this._activeSelectionMode===3){if(b[0]===k[0])return"";const P=b[0]<k[0]?b[0]:k[0],L=b[0]<k[0]?k[0]:b[0];for(let z=b[1];z<=k[1];z++){const J=R.translateBufferLineToString(z,!0,P,L);I.push(J)}}else{const P=b[1]===k[1]?k[0]:void 0;I.push(R.translateBufferLineToString(b[1],!0,b[0],P));for(let L=b[1]+1;L<=k[1]-1;L++){const z=R.lines.get(L),J=R.translateBufferLineToString(L,!0);z?.isWrapped?I[I.length-1]+=J:I.push(J)}if(b[1]!==k[1]){const L=R.lines.get(k[1]),z=R.translateBufferLineToString(k[1],!0,0,k[0]);L&&L.isWrapped?I[I.length-1]+=z:I.push(z)}}return I.map((P=>P.replace(w," "))).join(f.isWindows?`\r
`:`
`)}clearSelection(){this._model.clearSelection(),this._removeMouseDownListeners(),this.refresh(),this._onSelectionChange.fire()}refresh(b){this._refreshAnimationFrame||(this._refreshAnimationFrame=this._coreBrowserService.window.requestAnimationFrame((()=>this._refresh()))),f.isLinux&&b&&this.selectionText.length&&this._onLinuxMouseSelection.fire(this.selectionText)}_refresh(){this._refreshAnimationFrame=void 0,this._onRedrawRequest.fire({start:this._model.finalSelectionStart,end:this._model.finalSelectionEnd,columnSelectMode:this._activeSelectionMode===3})}_isClickInSelection(b){const k=this._getMouseBufferCoords(b),R=this._model.finalSelectionStart,I=this._model.finalSelectionEnd;return!!(R&&I&&k)&&this._areCoordsInSelection(k,R,I)}isCellInSelection(b,k){const R=this._model.finalSelectionStart,I=this._model.finalSelectionEnd;return!(!R||!I)&&this._areCoordsInSelection([b,k],R,I)}_areCoordsInSelection(b,k,R){return b[1]>k[1]&&b[1]<R[1]||k[1]===R[1]&&b[1]===k[1]&&b[0]>=k[0]&&b[0]<R[0]||k[1]<R[1]&&b[1]===R[1]&&b[0]<R[0]||k[1]<R[1]&&b[1]===k[1]&&b[0]>=k[0]}_selectWordAtCursor(b,k){const R=this._linkifier.currentLink?.link?.range;if(R)return this._model.selectionStart=[R.start.x-1,R.start.y-1],this._model.selectionStartLength=(0,d.getRangeLength)(R,this._bufferService.cols),this._model.selectionEnd=void 0,!0;const I=this._getMouseBufferCoords(b);return!!I&&(this._selectWordAt(I,k),this._model.selectionEnd=void 0,!0)}selectAll(){this._model.isSelectAllActive=!0,this.refresh(),this._onSelectionChange.fire()}selectLines(b,k){this._model.clearSelection(),b=Math.max(b,0),k=Math.min(k,this._bufferService.buffer.lines.length-1),this._model.selectionStart=[0,b],this._model.selectionEnd=[this._bufferService.cols,k],this.refresh(),this._onSelectionChange.fire()}_handleTrim(b){this._model.handleTrim(b)&&this.refresh()}_getMouseBufferCoords(b){const k=this._mouseService.getCoords(b,this._screenElement,this._bufferService.cols,this._bufferService.rows,!0);if(k)return k[0]--,k[1]--,k[1]+=this._bufferService.buffer.ydisp,k}_getMouseEventScrollAmount(b){let k=(0,l.getCoordsRelativeToElement)(this._coreBrowserService.window,b,this._screenElement)[1];const R=this._renderService.dimensions.css.canvas.height;return k>=0&&k<=R?0:(k>R&&(k-=R),k=Math.min(Math.max(k,-50),50),k/=50,k/Math.abs(k)+Math.round(14*k))}shouldForceSelection(b){return f.isMac?b.altKey&&this._optionsService.rawOptions.macOptionClickForcesSelection:b.shiftKey}handleMouseDown(b){if(this._mouseDownTimeStamp=b.timeStamp,(b.button!==2||!this.hasSelection)&&b.button===0){if(!this._enabled){if(!this.shouldForceSelection(b))return;b.stopPropagation()}b.preventDefault(),this._dragScrollAmount=0,this._enabled&&b.shiftKey?this._handleIncrementalClick(b):b.detail===1?this._handleSingleClick(b):b.detail===2?this._handleDoubleClick(b):b.detail===3&&this._handleTripleClick(b),this._addMouseDownListeners(),this.refresh(!0)}}_addMouseDownListeners(){this._screenElement.ownerDocument&&(this._screenElement.ownerDocument.addEventListener("mousemove",this._mouseMoveListener),this._screenElement.ownerDocument.addEventListener("mouseup",this._mouseUpListener)),this._dragScrollIntervalTimer=this._coreBrowserService.window.setInterval((()=>this._dragScroll()),50)}_removeMouseDownListeners(){this._screenElement.ownerDocument&&(this._screenElement.ownerDocument.removeEventListener("mousemove",this._mouseMoveListener),this._screenElement.ownerDocument.removeEventListener("mouseup",this._mouseUpListener)),this._coreBrowserService.window.clearInterval(this._dragScrollIntervalTimer),this._dragScrollIntervalTimer=void 0}_handleIncrementalClick(b){this._model.selectionStart&&(this._model.selectionEnd=this._getMouseBufferCoords(b))}_handleSingleClick(b){if(this._model.selectionStartLength=0,this._model.isSelectAllActive=!1,this._activeSelectionMode=this.shouldColumnSelect(b)?3:0,this._model.selectionStart=this._getMouseBufferCoords(b),!this._model.selectionStart)return;this._model.selectionEnd=void 0;const k=this._bufferService.buffer.lines.get(this._model.selectionStart[1]);k&&k.length!==this._model.selectionStart[0]&&k.hasWidth(this._model.selectionStart[0])===0&&this._model.selectionStart[0]++}_handleDoubleClick(b){this._selectWordAtCursor(b,!0)&&(this._activeSelectionMode=1)}_handleTripleClick(b){const k=this._getMouseBufferCoords(b);k&&(this._activeSelectionMode=2,this._selectLineAt(k[1]))}shouldColumnSelect(b){return b.altKey&&!(f.isMac&&this._optionsService.rawOptions.macOptionClickForcesSelection)}_handleMouseMove(b){if(b.stopImmediatePropagation(),!this._model.selectionStart)return;const k=this._model.selectionEnd?[this._model.selectionEnd[0],this._model.selectionEnd[1]]:null;if(this._model.selectionEnd=this._getMouseBufferCoords(b),!this._model.selectionEnd)return void this.refresh(!0);this._activeSelectionMode===2?this._model.selectionEnd[1]<this._model.selectionStart[1]?this._model.selectionEnd[0]=0:this._model.selectionEnd[0]=this._bufferService.cols:this._activeSelectionMode===1&&this._selectToWordAt(this._model.selectionEnd),this._dragScrollAmount=this._getMouseEventScrollAmount(b),this._activeSelectionMode!==3&&(this._dragScrollAmount>0?this._model.selectionEnd[0]=this._bufferService.cols:this._dragScrollAmount<0&&(this._model.selectionEnd[0]=0));const R=this._bufferService.buffer;if(this._model.selectionEnd[1]<R.lines.length){const I=R.lines.get(this._model.selectionEnd[1]);I&&I.hasWidth(this._model.selectionEnd[0])===0&&this._model.selectionEnd[0]<this._bufferService.cols&&this._model.selectionEnd[0]++}k&&k[0]===this._model.selectionEnd[0]&&k[1]===this._model.selectionEnd[1]||this.refresh(!0)}_dragScroll(){if(this._model.selectionEnd&&this._model.selectionStart&&this._dragScrollAmount){this._onRequestScrollLines.fire({amount:this._dragScrollAmount,suppressScrollEvent:!1});const b=this._bufferService.buffer;this._dragScrollAmount>0?(this._activeSelectionMode!==3&&(this._model.selectionEnd[0]=this._bufferService.cols),this._model.selectionEnd[1]=Math.min(b.ydisp+this._bufferService.rows,b.lines.length-1)):(this._activeSelectionMode!==3&&(this._model.selectionEnd[0]=0),this._model.selectionEnd[1]=b.ydisp),this.refresh()}}_handleMouseUp(b){const k=b.timeStamp-this._mouseDownTimeStamp;if(this._removeMouseDownListeners(),this.selectionText.length<=1&&k<500&&b.altKey&&this._optionsService.rawOptions.altClickMovesCursor){if(this._bufferService.buffer.ybase===this._bufferService.buffer.ydisp){const R=this._mouseService.getCoords(b,this._element,this._bufferService.cols,this._bufferService.rows,!1);if(R&&R[0]!==void 0&&R[1]!==void 0){const I=(0,m.moveToCellSequence)(R[0]-1,R[1]-1,this._bufferService,this._coreService.decPrivateModes.applicationCursorKeys);this._coreService.triggerDataEvent(I,!0)}}}else this._fireEventIfSelectionChanged()}_fireEventIfSelectionChanged(){const b=this._model.finalSelectionStart,k=this._model.finalSelectionEnd,R=!(!b||!k||b[0]===k[0]&&b[1]===k[1]);R?b&&k&&(this._oldSelectionStart&&this._oldSelectionEnd&&b[0]===this._oldSelectionStart[0]&&b[1]===this._oldSelectionStart[1]&&k[0]===this._oldSelectionEnd[0]&&k[1]===this._oldSelectionEnd[1]||this._fireOnSelectionChange(b,k,R)):this._oldHasSelection&&this._fireOnSelectionChange(b,k,R)}_fireOnSelectionChange(b,k,R){this._oldSelectionStart=b,this._oldSelectionEnd=k,this._oldHasSelection=R,this._onSelectionChange.fire()}_handleBufferActivate(b){this.clearSelection(),this._trimListener.dispose(),this._trimListener=b.activeBuffer.lines.onTrim((k=>this._handleTrim(k)))}_convertViewportColToCharacterIndex(b,k){let R=k;for(let I=0;k>=I;I++){const P=b.loadCell(I,this._workCell).getChars().length;this._workCell.getWidth()===0?R--:P>1&&k!==I&&(R+=P-1)}return R}setSelection(b,k,R){this._model.clearSelection(),this._removeMouseDownListeners(),this._model.selectionStart=[b,k],this._model.selectionStartLength=R,this.refresh(),this._fireEventIfSelectionChanged()}rightClickSelect(b){this._isClickInSelection(b)||(this._selectWordAtCursor(b,!1)&&this.refresh(!0),this._fireEventIfSelectionChanged())}_getWordAt(b,k,R=!0,I=!0){if(b[0]>=this._bufferService.cols)return;const P=this._bufferService.buffer,L=P.lines.get(b[1]);if(!L)return;const z=P.translateBufferLineToString(b[1],!1);let J=this._convertViewportColToCharacterIndex(L,b[0]),re=J;const te=b[0]-J;let ee=0,x=0,B=0,N=0;if(z.charAt(J)===" "){for(;J>0&&z.charAt(J-1)===" ";)J--;for(;re<z.length&&z.charAt(re+1)===" ";)re++}else{let j=b[0],V=b[0];L.getWidth(j)===0&&(ee++,j--),L.getWidth(V)===2&&(x++,V++);const X=L.getString(V).length;for(X>1&&(N+=X-1,re+=X-1);j>0&&J>0&&!this._isCharWordSeparator(L.loadCell(j-1,this._workCell));){L.loadCell(j-1,this._workCell);const M=this._workCell.getChars().length;this._workCell.getWidth()===0?(ee++,j--):M>1&&(B+=M-1,J-=M-1),J--,j--}for(;V<L.length&&re+1<z.length&&!this._isCharWordSeparator(L.loadCell(V+1,this._workCell));){L.loadCell(V+1,this._workCell);const M=this._workCell.getChars().length;this._workCell.getWidth()===2?(x++,V++):M>1&&(N+=M-1,re+=M-1),re++,V++}}re++;let H=J+te-ee+B,se=Math.min(this._bufferService.cols,re-J+ee+x-B-N);if(k||z.slice(J,re).trim()!==""){if(R&&H===0&&L.getCodePoint(0)!==32){const j=P.lines.get(b[1]-1);if(j&&L.isWrapped&&j.getCodePoint(this._bufferService.cols-1)!==32){const V=this._getWordAt([this._bufferService.cols-1,b[1]-1],!1,!0,!1);if(V){const X=this._bufferService.cols-V.start;H-=X,se+=X}}}if(I&&H+se===this._bufferService.cols&&L.getCodePoint(this._bufferService.cols-1)!==32){const j=P.lines.get(b[1]+1);if(j?.isWrapped&&j.getCodePoint(0)!==32){const V=this._getWordAt([0,b[1]+1],!1,!1,!0);V&&(se+=V.length)}}return{start:H,length:se}}}_selectWordAt(b,k){const R=this._getWordAt(b,k);if(R){for(;R.start<0;)R.start+=this._bufferService.cols,b[1]--;this._model.selectionStart=[R.start,b[1]],this._model.selectionStartLength=R.length}}_selectToWordAt(b){const k=this._getWordAt(b,!0);if(k){let R=b[1];for(;k.start<0;)k.start+=this._bufferService.cols,R--;if(!this._model.areSelectionValuesReversed())for(;k.start+k.length>this._bufferService.cols;)k.length-=this._bufferService.cols,R++;this._model.selectionEnd=[this._model.areSelectionValuesReversed()?k.start:k.start+k.length,R]}}_isCharWordSeparator(b){return b.getWidth()!==0&&this._optionsService.rawOptions.wordSeparator.indexOf(b.getChars())>=0}_selectLineAt(b){const k=this._bufferService.buffer.getWrappedRangeForLine(b),R={start:{x:0,y:k.first},end:{x:this._bufferService.cols-1,y:k.last}};this._model.selectionStart=[0,k.first],this._model.selectionEnd=void 0,this._model.selectionStartLength=(0,d.getRangeLength)(R,this._bufferService.cols)}};r.SelectionService=E=u([_(3,v.IBufferService),_(4,v.ICoreService),_(5,C.IMouseService),_(6,v.IOptionsService),_(7,C.IRenderService),_(8,C.ICoreBrowserService)],E)},4725:(c,r,a)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.ILinkProviderService=r.IThemeService=r.ICharacterJoinerService=r.ISelectionService=r.IRenderService=r.IMouseService=r.ICoreBrowserService=r.ICharSizeService=void 0;const u=a(8343);r.ICharSizeService=(0,u.createDecorator)("CharSizeService"),r.ICoreBrowserService=(0,u.createDecorator)("CoreBrowserService"),r.IMouseService=(0,u.createDecorator)("MouseService"),r.IRenderService=(0,u.createDecorator)("RenderService"),r.ISelectionService=(0,u.createDecorator)("SelectionService"),r.ICharacterJoinerService=(0,u.createDecorator)("CharacterJoinerService"),r.IThemeService=(0,u.createDecorator)("ThemeService"),r.ILinkProviderService=(0,u.createDecorator)("LinkProviderService")},6731:function(c,r,a){var u=this&&this.__decorate||function(E,b,k,R){var I,P=arguments.length,L=P<3?b:R===null?R=Object.getOwnPropertyDescriptor(b,k):R;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")L=Reflect.decorate(E,b,k,R);else for(var z=E.length-1;z>=0;z--)(I=E[z])&&(L=(P<3?I(L):P>3?I(b,k,L):I(b,k))||L);return P>3&&L&&Object.defineProperty(b,k,L),L},_=this&&this.__param||function(E,b){return function(k,R){b(k,R,E)}};Object.defineProperty(r,"__esModule",{value:!0}),r.ThemeService=r.DEFAULT_ANSI_COLORS=void 0;const l=a(7239),m=a(8055),g=a(8460),C=a(844),y=a(2585),h=m.css.toColor("#ffffff"),f=m.css.toColor("#000000"),d=m.css.toColor("#ffffff"),p=m.css.toColor("#000000"),v={css:"rgba(255, 255, 255, 0.3)",rgba:4294967117};r.DEFAULT_ANSI_COLORS=Object.freeze((()=>{const E=[m.css.toColor("#2e3436"),m.css.toColor("#cc0000"),m.css.toColor("#4e9a06"),m.css.toColor("#c4a000"),m.css.toColor("#3465a4"),m.css.toColor("#75507b"),m.css.toColor("#06989a"),m.css.toColor("#d3d7cf"),m.css.toColor("#555753"),m.css.toColor("#ef2929"),m.css.toColor("#8ae234"),m.css.toColor("#fce94f"),m.css.toColor("#729fcf"),m.css.toColor("#ad7fa8"),m.css.toColor("#34e2e2"),m.css.toColor("#eeeeec")],b=[0,95,135,175,215,255];for(let k=0;k<216;k++){const R=b[k/36%6|0],I=b[k/6%6|0],P=b[k%6];E.push({css:m.channels.toCss(R,I,P),rgba:m.channels.toRgba(R,I,P)})}for(let k=0;k<24;k++){const R=8+10*k;E.push({css:m.channels.toCss(R,R,R),rgba:m.channels.toRgba(R,R,R)})}return E})());let S=r.ThemeService=class extends C.Disposable{get colors(){return this._colors}constructor(E){super(),this._optionsService=E,this._contrastCache=new l.ColorContrastCache,this._halfContrastCache=new l.ColorContrastCache,this._onChangeColors=this.register(new g.EventEmitter),this.onChangeColors=this._onChangeColors.event,this._colors={foreground:h,background:f,cursor:d,cursorAccent:p,selectionForeground:void 0,selectionBackgroundTransparent:v,selectionBackgroundOpaque:m.color.blend(f,v),selectionInactiveBackgroundTransparent:v,selectionInactiveBackgroundOpaque:m.color.blend(f,v),ansi:r.DEFAULT_ANSI_COLORS.slice(),contrastCache:this._contrastCache,halfContrastCache:this._halfContrastCache},this._updateRestoreColors(),this._setTheme(this._optionsService.rawOptions.theme),this.register(this._optionsService.onSpecificOptionChange("minimumContrastRatio",(()=>this._contrastCache.clear()))),this.register(this._optionsService.onSpecificOptionChange("theme",(()=>this._setTheme(this._optionsService.rawOptions.theme))))}_setTheme(E={}){const b=this._colors;if(b.foreground=w(E.foreground,h),b.background=w(E.background,f),b.cursor=w(E.cursor,d),b.cursorAccent=w(E.cursorAccent,p),b.selectionBackgroundTransparent=w(E.selectionBackground,v),b.selectionBackgroundOpaque=m.color.blend(b.background,b.selectionBackgroundTransparent),b.selectionInactiveBackgroundTransparent=w(E.selectionInactiveBackground,b.selectionBackgroundTransparent),b.selectionInactiveBackgroundOpaque=m.color.blend(b.background,b.selectionInactiveBackgroundTransparent),b.selectionForeground=E.selectionForeground?w(E.selectionForeground,m.NULL_COLOR):void 0,b.selectionForeground===m.NULL_COLOR&&(b.selectionForeground=void 0),m.color.isOpaque(b.selectionBackgroundTransparent)&&(b.selectionBackgroundTransparent=m.color.opacity(b.selectionBackgroundTransparent,.3)),m.color.isOpaque(b.selectionInactiveBackgroundTransparent)&&(b.selectionInactiveBackgroundTransparent=m.color.opacity(b.selectionInactiveBackgroundTransparent,.3)),b.ansi=r.DEFAULT_ANSI_COLORS.slice(),b.ansi[0]=w(E.black,r.DEFAULT_ANSI_COLORS[0]),b.ansi[1]=w(E.red,r.DEFAULT_ANSI_COLORS[1]),b.ansi[2]=w(E.green,r.DEFAULT_ANSI_COLORS[2]),b.ansi[3]=w(E.yellow,r.DEFAULT_ANSI_COLORS[3]),b.ansi[4]=w(E.blue,r.DEFAULT_ANSI_COLORS[4]),b.ansi[5]=w(E.magenta,r.DEFAULT_ANSI_COLORS[5]),b.ansi[6]=w(E.cyan,r.DEFAULT_ANSI_COLORS[6]),b.ansi[7]=w(E.white,r.DEFAULT_ANSI_COLORS[7]),b.ansi[8]=w(E.brightBlack,r.DEFAULT_ANSI_COLORS[8]),b.ansi[9]=w(E.brightRed,r.DEFAULT_ANSI_COLORS[9]),b.ansi[10]=w(E.brightGreen,r.DEFAULT_ANSI_COLORS[10]),b.ansi[11]=w(E.brightYellow,r.DEFAULT_ANSI_COLORS[11]),b.ansi[12]=w(E.brightBlue,r.DEFAULT_ANSI_COLORS[12]),b.ansi[13]=w(E.brightMagenta,r.DEFAULT_ANSI_COLORS[13]),b.ansi[14]=w(E.brightCyan,r.DEFAULT_ANSI_COLORS[14]),b.ansi[15]=w(E.brightWhite,r.DEFAULT_ANSI_COLORS[15]),E.extendedAnsi){const k=Math.min(b.ansi.length-16,E.extendedAnsi.length);for(let R=0;R<k;R++)b.ansi[R+16]=w(E.extendedAnsi[R],r.DEFAULT_ANSI_COLORS[R+16])}this._contrastCache.clear(),this._halfContrastCache.clear(),this._updateRestoreColors(),this._onChangeColors.fire(this.colors)}restoreColor(E){this._restoreColor(E),this._onChangeColors.fire(this.colors)}_restoreColor(E){if(E!==void 0)switch(E){case 256:this._colors.foreground=this._restoreColors.foreground;break;case 257:this._colors.background=this._restoreColors.background;break;case 258:this._colors.cursor=this._restoreColors.cursor;break;default:this._colors.ansi[E]=this._restoreColors.ansi[E]}else for(let b=0;b<this._restoreColors.ansi.length;++b)this._colors.ansi[b]=this._restoreColors.ansi[b]}modifyColors(E){E(this._colors),this._onChangeColors.fire(this.colors)}_updateRestoreColors(){this._restoreColors={foreground:this._colors.foreground,background:this._colors.background,cursor:this._colors.cursor,ansi:this._colors.ansi.slice()}}};function w(E,b){if(E!==void 0)try{return m.css.toColor(E)}catch{}return b}r.ThemeService=S=u([_(0,y.IOptionsService)],S)},6349:(c,r,a)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.CircularList=void 0;const u=a(8460),_=a(844);class l extends _.Disposable{constructor(g){super(),this._maxLength=g,this.onDeleteEmitter=this.register(new u.EventEmitter),this.onDelete=this.onDeleteEmitter.event,this.onInsertEmitter=this.register(new u.EventEmitter),this.onInsert=this.onInsertEmitter.event,this.onTrimEmitter=this.register(new u.EventEmitter),this.onTrim=this.onTrimEmitter.event,this._array=new Array(this._maxLength),this._startIndex=0,this._length=0}get maxLength(){return this._maxLength}set maxLength(g){if(this._maxLength===g)return;const C=new Array(g);for(let y=0;y<Math.min(g,this.length);y++)C[y]=this._array[this._getCyclicIndex(y)];this._array=C,this._maxLength=g,this._startIndex=0}get length(){return this._length}set length(g){if(g>this._length)for(let C=this._length;C<g;C++)this._array[C]=void 0;this._length=g}get(g){return this._array[this._getCyclicIndex(g)]}set(g,C){this._array[this._getCyclicIndex(g)]=C}push(g){this._array[this._getCyclicIndex(this._length)]=g,this._length===this._maxLength?(this._startIndex=++this._startIndex%this._maxLength,this.onTrimEmitter.fire(1)):this._length++}recycle(){if(this._length!==this._maxLength)throw new Error("Can only recycle when the buffer is full");return this._startIndex=++this._startIndex%this._maxLength,this.onTrimEmitter.fire(1),this._array[this._getCyclicIndex(this._length-1)]}get isFull(){return this._length===this._maxLength}pop(){return this._array[this._getCyclicIndex(this._length---1)]}splice(g,C,...y){if(C){for(let h=g;h<this._length-C;h++)this._array[this._getCyclicIndex(h)]=this._array[this._getCyclicIndex(h+C)];this._length-=C,this.onDeleteEmitter.fire({index:g,amount:C})}for(let h=this._length-1;h>=g;h--)this._array[this._getCyclicIndex(h+y.length)]=this._array[this._getCyclicIndex(h)];for(let h=0;h<y.length;h++)this._array[this._getCyclicIndex(g+h)]=y[h];if(y.length&&this.onInsertEmitter.fire({index:g,amount:y.length}),this._length+y.length>this._maxLength){const h=this._length+y.length-this._maxLength;this._startIndex+=h,this._length=this._maxLength,this.onTrimEmitter.fire(h)}else this._length+=y.length}trimStart(g){g>this._length&&(g=this._length),this._startIndex+=g,this._length-=g,this.onTrimEmitter.fire(g)}shiftElements(g,C,y){if(!(C<=0)){if(g<0||g>=this._length)throw new Error("start argument out of range");if(g+y<0)throw new Error("Cannot shift elements in list beyond index 0");if(y>0){for(let f=C-1;f>=0;f--)this.set(g+f+y,this.get(g+f));const h=g+C+y-this._length;if(h>0)for(this._length+=h;this._length>this._maxLength;)this._length--,this._startIndex++,this.onTrimEmitter.fire(1)}else for(let h=0;h<C;h++)this.set(g+h+y,this.get(g+h))}}_getCyclicIndex(g){return(this._startIndex+g)%this._maxLength}}r.CircularList=l},1439:(c,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.clone=void 0,r.clone=function a(u,_=5){if(typeof u!="object")return u;const l=Array.isArray(u)?[]:{};for(const m in u)l[m]=_<=1?u[m]:u[m]&&a(u[m],_-1);return l}},8055:(c,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.contrastRatio=r.toPaddedHex=r.rgba=r.rgb=r.css=r.color=r.channels=r.NULL_COLOR=void 0;let a=0,u=0,_=0,l=0;var m,g,C,y,h;function f(p){const v=p.toString(16);return v.length<2?"0"+v:v}function d(p,v){return p<v?(v+.05)/(p+.05):(p+.05)/(v+.05)}r.NULL_COLOR={css:"#00000000",rgba:0},(function(p){p.toCss=function(v,S,w,E){return E!==void 0?`#${f(v)}${f(S)}${f(w)}${f(E)}`:`#${f(v)}${f(S)}${f(w)}`},p.toRgba=function(v,S,w,E=255){return(v<<24|S<<16|w<<8|E)>>>0},p.toColor=function(v,S,w,E){return{css:p.toCss(v,S,w,E),rgba:p.toRgba(v,S,w,E)}}})(m||(r.channels=m={})),(function(p){function v(S,w){return l=Math.round(255*w),[a,u,_]=h.toChannels(S.rgba),{css:m.toCss(a,u,_,l),rgba:m.toRgba(a,u,_,l)}}p.blend=function(S,w){if(l=(255&w.rgba)/255,l===1)return{css:w.css,rgba:w.rgba};const E=w.rgba>>24&255,b=w.rgba>>16&255,k=w.rgba>>8&255,R=S.rgba>>24&255,I=S.rgba>>16&255,P=S.rgba>>8&255;return a=R+Math.round((E-R)*l),u=I+Math.round((b-I)*l),_=P+Math.round((k-P)*l),{css:m.toCss(a,u,_),rgba:m.toRgba(a,u,_)}},p.isOpaque=function(S){return(255&S.rgba)==255},p.ensureContrastRatio=function(S,w,E){const b=h.ensureContrastRatio(S.rgba,w.rgba,E);if(b)return m.toColor(b>>24&255,b>>16&255,b>>8&255)},p.opaque=function(S){const w=(255|S.rgba)>>>0;return[a,u,_]=h.toChannels(w),{css:m.toCss(a,u,_),rgba:w}},p.opacity=v,p.multiplyOpacity=function(S,w){return l=255&S.rgba,v(S,l*w/255)},p.toColorRGB=function(S){return[S.rgba>>24&255,S.rgba>>16&255,S.rgba>>8&255]}})(g||(r.color=g={})),(function(p){let v,S;try{const w=document.createElement("canvas");w.width=1,w.height=1;const E=w.getContext("2d",{willReadFrequently:!0});E&&(v=E,v.globalCompositeOperation="copy",S=v.createLinearGradient(0,0,1,1))}catch{}p.toColor=function(w){if(w.match(/#[\da-f]{3,8}/i))switch(w.length){case 4:return a=parseInt(w.slice(1,2).repeat(2),16),u=parseInt(w.slice(2,3).repeat(2),16),_=parseInt(w.slice(3,4).repeat(2),16),m.toColor(a,u,_);case 5:return a=parseInt(w.slice(1,2).repeat(2),16),u=parseInt(w.slice(2,3).repeat(2),16),_=parseInt(w.slice(3,4).repeat(2),16),l=parseInt(w.slice(4,5).repeat(2),16),m.toColor(a,u,_,l);case 7:return{css:w,rgba:(parseInt(w.slice(1),16)<<8|255)>>>0};case 9:return{css:w,rgba:parseInt(w.slice(1),16)>>>0}}const E=w.match(/rgba?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(,\s*(0|1|\d?\.(\d+))\s*)?\)/);if(E)return a=parseInt(E[1]),u=parseInt(E[2]),_=parseInt(E[3]),l=Math.round(255*(E[5]===void 0?1:parseFloat(E[5]))),m.toColor(a,u,_,l);if(!v||!S)throw new Error("css.toColor: Unsupported css format");if(v.fillStyle=S,v.fillStyle=w,typeof v.fillStyle!="string")throw new Error("css.toColor: Unsupported css format");if(v.fillRect(0,0,1,1),[a,u,_,l]=v.getImageData(0,0,1,1).data,l!==255)throw new Error("css.toColor: Unsupported css format");return{rgba:m.toRgba(a,u,_,l),css:w}}})(C||(r.css=C={})),(function(p){function v(S,w,E){const b=S/255,k=w/255,R=E/255;return .2126*(b<=.03928?b/12.92:Math.pow((b+.055)/1.055,2.4))+.7152*(k<=.03928?k/12.92:Math.pow((k+.055)/1.055,2.4))+.0722*(R<=.03928?R/12.92:Math.pow((R+.055)/1.055,2.4))}p.relativeLuminance=function(S){return v(S>>16&255,S>>8&255,255&S)},p.relativeLuminance2=v})(y||(r.rgb=y={})),(function(p){function v(w,E,b){const k=w>>24&255,R=w>>16&255,I=w>>8&255;let P=E>>24&255,L=E>>16&255,z=E>>8&255,J=d(y.relativeLuminance2(P,L,z),y.relativeLuminance2(k,R,I));for(;J<b&&(P>0||L>0||z>0);)P-=Math.max(0,Math.ceil(.1*P)),L-=Math.max(0,Math.ceil(.1*L)),z-=Math.max(0,Math.ceil(.1*z)),J=d(y.relativeLuminance2(P,L,z),y.relativeLuminance2(k,R,I));return(P<<24|L<<16|z<<8|255)>>>0}function S(w,E,b){const k=w>>24&255,R=w>>16&255,I=w>>8&255;let P=E>>24&255,L=E>>16&255,z=E>>8&255,J=d(y.relativeLuminance2(P,L,z),y.relativeLuminance2(k,R,I));for(;J<b&&(P<255||L<255||z<255);)P=Math.min(255,P+Math.ceil(.1*(255-P))),L=Math.min(255,L+Math.ceil(.1*(255-L))),z=Math.min(255,z+Math.ceil(.1*(255-z))),J=d(y.relativeLuminance2(P,L,z),y.relativeLuminance2(k,R,I));return(P<<24|L<<16|z<<8|255)>>>0}p.blend=function(w,E){if(l=(255&E)/255,l===1)return E;const b=E>>24&255,k=E>>16&255,R=E>>8&255,I=w>>24&255,P=w>>16&255,L=w>>8&255;return a=I+Math.round((b-I)*l),u=P+Math.round((k-P)*l),_=L+Math.round((R-L)*l),m.toRgba(a,u,_)},p.ensureContrastRatio=function(w,E,b){const k=y.relativeLuminance(w>>8),R=y.relativeLuminance(E>>8);if(d(k,R)<b){if(R<k){const L=v(w,E,b),z=d(k,y.relativeLuminance(L>>8));if(z<b){const J=S(w,E,b);return z>d(k,y.relativeLuminance(J>>8))?L:J}return L}const I=S(w,E,b),P=d(k,y.relativeLuminance(I>>8));if(P<b){const L=v(w,E,b);return P>d(k,y.relativeLuminance(L>>8))?I:L}return I}},p.reduceLuminance=v,p.increaseLuminance=S,p.toChannels=function(w){return[w>>24&255,w>>16&255,w>>8&255,255&w]}})(h||(r.rgba=h={})),r.toPaddedHex=f,r.contrastRatio=d},8969:(c,r,a)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.CoreTerminal=void 0;const u=a(844),_=a(2585),l=a(4348),m=a(7866),g=a(744),C=a(7302),y=a(6975),h=a(8460),f=a(1753),d=a(1480),p=a(7994),v=a(9282),S=a(5435),w=a(5981),E=a(2660);let b=!1;class k extends u.Disposable{get onScroll(){return this._onScrollApi||(this._onScrollApi=this.register(new h.EventEmitter),this._onScroll.event((I=>{this._onScrollApi?.fire(I.position)}))),this._onScrollApi.event}get cols(){return this._bufferService.cols}get rows(){return this._bufferService.rows}get buffers(){return this._bufferService.buffers}get options(){return this.optionsService.options}set options(I){for(const P in I)this.optionsService.options[P]=I[P]}constructor(I){super(),this._windowsWrappingHeuristics=this.register(new u.MutableDisposable),this._onBinary=this.register(new h.EventEmitter),this.onBinary=this._onBinary.event,this._onData=this.register(new h.EventEmitter),this.onData=this._onData.event,this._onLineFeed=this.register(new h.EventEmitter),this.onLineFeed=this._onLineFeed.event,this._onResize=this.register(new h.EventEmitter),this.onResize=this._onResize.event,this._onWriteParsed=this.register(new h.EventEmitter),this.onWriteParsed=this._onWriteParsed.event,this._onScroll=this.register(new h.EventEmitter),this._instantiationService=new l.InstantiationService,this.optionsService=this.register(new C.OptionsService(I)),this._instantiationService.setService(_.IOptionsService,this.optionsService),this._bufferService=this.register(this._instantiationService.createInstance(g.BufferService)),this._instantiationService.setService(_.IBufferService,this._bufferService),this._logService=this.register(this._instantiationService.createInstance(m.LogService)),this._instantiationService.setService(_.ILogService,this._logService),this.coreService=this.register(this._instantiationService.createInstance(y.CoreService)),this._instantiationService.setService(_.ICoreService,this.coreService),this.coreMouseService=this.register(this._instantiationService.createInstance(f.CoreMouseService)),this._instantiationService.setService(_.ICoreMouseService,this.coreMouseService),this.unicodeService=this.register(this._instantiationService.createInstance(d.UnicodeService)),this._instantiationService.setService(_.IUnicodeService,this.unicodeService),this._charsetService=this._instantiationService.createInstance(p.CharsetService),this._instantiationService.setService(_.ICharsetService,this._charsetService),this._oscLinkService=this._instantiationService.createInstance(E.OscLinkService),this._instantiationService.setService(_.IOscLinkService,this._oscLinkService),this._inputHandler=this.register(new S.InputHandler(this._bufferService,this._charsetService,this.coreService,this._logService,this.optionsService,this._oscLinkService,this.coreMouseService,this.unicodeService)),this.register((0,h.forwardEvent)(this._inputHandler.onLineFeed,this._onLineFeed)),this.register(this._inputHandler),this.register((0,h.forwardEvent)(this._bufferService.onResize,this._onResize)),this.register((0,h.forwardEvent)(this.coreService.onData,this._onData)),this.register((0,h.forwardEvent)(this.coreService.onBinary,this._onBinary)),this.register(this.coreService.onRequestScrollToBottom((()=>this.scrollToBottom()))),this.register(this.coreService.onUserInput((()=>this._writeBuffer.handleUserInput()))),this.register(this.optionsService.onMultipleOptionChange(["windowsMode","windowsPty"],(()=>this._handleWindowsPtyOptionChange()))),this.register(this._bufferService.onScroll((P=>{this._onScroll.fire({position:this._bufferService.buffer.ydisp,source:0}),this._inputHandler.markRangeDirty(this._bufferService.buffer.scrollTop,this._bufferService.buffer.scrollBottom)}))),this.register(this._inputHandler.onScroll((P=>{this._onScroll.fire({position:this._bufferService.buffer.ydisp,source:0}),this._inputHandler.markRangeDirty(this._bufferService.buffer.scrollTop,this._bufferService.buffer.scrollBottom)}))),this._writeBuffer=this.register(new w.WriteBuffer(((P,L)=>this._inputHandler.parse(P,L)))),this.register((0,h.forwardEvent)(this._writeBuffer.onWriteParsed,this._onWriteParsed))}write(I,P){this._writeBuffer.write(I,P)}writeSync(I,P){this._logService.logLevel<=_.LogLevelEnum.WARN&&!b&&(this._logService.warn("writeSync is unreliable and will be removed soon."),b=!0),this._writeBuffer.writeSync(I,P)}input(I,P=!0){this.coreService.triggerDataEvent(I,P)}resize(I,P){isNaN(I)||isNaN(P)||(I=Math.max(I,g.MINIMUM_COLS),P=Math.max(P,g.MINIMUM_ROWS),this._bufferService.resize(I,P))}scroll(I,P=!1){this._bufferService.scroll(I,P)}scrollLines(I,P,L){this._bufferService.scrollLines(I,P,L)}scrollPages(I){this.scrollLines(I*(this.rows-1))}scrollToTop(){this.scrollLines(-this._bufferService.buffer.ydisp)}scrollToBottom(){this.scrollLines(this._bufferService.buffer.ybase-this._bufferService.buffer.ydisp)}scrollToLine(I){const P=I-this._bufferService.buffer.ydisp;P!==0&&this.scrollLines(P)}registerEscHandler(I,P){return this._inputHandler.registerEscHandler(I,P)}registerDcsHandler(I,P){return this._inputHandler.registerDcsHandler(I,P)}registerCsiHandler(I,P){return this._inputHandler.registerCsiHandler(I,P)}registerOscHandler(I,P){return this._inputHandler.registerOscHandler(I,P)}_setup(){this._handleWindowsPtyOptionChange()}reset(){this._inputHandler.reset(),this._bufferService.reset(),this._charsetService.reset(),this.coreService.reset(),this.coreMouseService.reset()}_handleWindowsPtyOptionChange(){let I=!1;const P=this.optionsService.rawOptions.windowsPty;P&&P.buildNumber!==void 0&&P.buildNumber!==void 0?I=P.backend==="conpty"&&P.buildNumber<21376:this.optionsService.rawOptions.windowsMode&&(I=!0),I?this._enableWindowsWrappingHeuristics():this._windowsWrappingHeuristics.clear()}_enableWindowsWrappingHeuristics(){if(!this._windowsWrappingHeuristics.value){const I=[];I.push(this.onLineFeed(v.updateWindowsModeWrappedState.bind(null,this._bufferService))),I.push(this.registerCsiHandler({final:"H"},(()=>((0,v.updateWindowsModeWrappedState)(this._bufferService),!1)))),this._windowsWrappingHeuristics.value=(0,u.toDisposable)((()=>{for(const P of I)P.dispose()}))}}}r.CoreTerminal=k},8460:(c,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.runAndSubscribe=r.forwardEvent=r.EventEmitter=void 0,r.EventEmitter=class{constructor(){this._listeners=[],this._disposed=!1}get event(){return this._event||(this._event=a=>(this._listeners.push(a),{dispose:()=>{if(!this._disposed){for(let u=0;u<this._listeners.length;u++)if(this._listeners[u]===a)return void this._listeners.splice(u,1)}}})),this._event}fire(a,u){const _=[];for(let l=0;l<this._listeners.length;l++)_.push(this._listeners[l]);for(let l=0;l<_.length;l++)_[l].call(void 0,a,u)}dispose(){this.clearListeners(),this._disposed=!0}clearListeners(){this._listeners&&(this._listeners.length=0)}},r.forwardEvent=function(a,u){return a((_=>u.fire(_)))},r.runAndSubscribe=function(a,u){return u(void 0),a((_=>u(_)))}},5435:function(c,r,a){var u=this&&this.__decorate||function(ee,x,B,N){var H,se=arguments.length,j=se<3?x:N===null?N=Object.getOwnPropertyDescriptor(x,B):N;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")j=Reflect.decorate(ee,x,B,N);else for(var V=ee.length-1;V>=0;V--)(H=ee[V])&&(j=(se<3?H(j):se>3?H(x,B,j):H(x,B))||j);return se>3&&j&&Object.defineProperty(x,B,j),j},_=this&&this.__param||function(ee,x){return function(B,N){x(B,N,ee)}};Object.defineProperty(r,"__esModule",{value:!0}),r.InputHandler=r.WindowsOptionsReportType=void 0;const l=a(2584),m=a(7116),g=a(2015),C=a(844),y=a(482),h=a(8437),f=a(8460),d=a(643),p=a(511),v=a(3734),S=a(2585),w=a(1480),E=a(6242),b=a(6351),k=a(5941),R={"(":0,")":1,"*":2,"+":3,"-":1,".":2},I=131072;function P(ee,x){if(ee>24)return x.setWinLines||!1;switch(ee){case 1:return!!x.restoreWin;case 2:return!!x.minimizeWin;case 3:return!!x.setWinPosition;case 4:return!!x.setWinSizePixels;case 5:return!!x.raiseWin;case 6:return!!x.lowerWin;case 7:return!!x.refreshWin;case 8:return!!x.setWinSizeChars;case 9:return!!x.maximizeWin;case 10:return!!x.fullscreenWin;case 11:return!!x.getWinState;case 13:return!!x.getWinPosition;case 14:return!!x.getWinSizePixels;case 15:return!!x.getScreenSizePixels;case 16:return!!x.getCellSizePixels;case 18:return!!x.getWinSizeChars;case 19:return!!x.getScreenSizeChars;case 20:return!!x.getIconTitle;case 21:return!!x.getWinTitle;case 22:return!!x.pushTitle;case 23:return!!x.popTitle;case 24:return!!x.setWinLines}return!1}var L;(function(ee){ee[ee.GET_WIN_SIZE_PIXELS=0]="GET_WIN_SIZE_PIXELS",ee[ee.GET_CELL_SIZE_PIXELS=1]="GET_CELL_SIZE_PIXELS"})(L||(r.WindowsOptionsReportType=L={}));let z=0;class J extends C.Disposable{getAttrData(){return this._curAttrData}constructor(x,B,N,H,se,j,V,X,M=new g.EscapeSequenceParser){super(),this._bufferService=x,this._charsetService=B,this._coreService=N,this._logService=H,this._optionsService=se,this._oscLinkService=j,this._coreMouseService=V,this._unicodeService=X,this._parser=M,this._parseBuffer=new Uint32Array(4096),this._stringDecoder=new y.StringToUtf32,this._utf8Decoder=new y.Utf8ToUtf32,this._workCell=new p.CellData,this._windowTitle="",this._iconName="",this._windowTitleStack=[],this._iconNameStack=[],this._curAttrData=h.DEFAULT_ATTR_DATA.clone(),this._eraseAttrDataInternal=h.DEFAULT_ATTR_DATA.clone(),this._onRequestBell=this.register(new f.EventEmitter),this.onRequestBell=this._onRequestBell.event,this._onRequestRefreshRows=this.register(new f.EventEmitter),this.onRequestRefreshRows=this._onRequestRefreshRows.event,this._onRequestReset=this.register(new f.EventEmitter),this.onRequestReset=this._onRequestReset.event,this._onRequestSendFocus=this.register(new f.EventEmitter),this.onRequestSendFocus=this._onRequestSendFocus.event,this._onRequestSyncScrollBar=this.register(new f.EventEmitter),this.onRequestSyncScrollBar=this._onRequestSyncScrollBar.event,this._onRequestWindowsOptionsReport=this.register(new f.EventEmitter),this.onRequestWindowsOptionsReport=this._onRequestWindowsOptionsReport.event,this._onA11yChar=this.register(new f.EventEmitter),this.onA11yChar=this._onA11yChar.event,this._onA11yTab=this.register(new f.EventEmitter),this.onA11yTab=this._onA11yTab.event,this._onCursorMove=this.register(new f.EventEmitter),this.onCursorMove=this._onCursorMove.event,this._onLineFeed=this.register(new f.EventEmitter),this.onLineFeed=this._onLineFeed.event,this._onScroll=this.register(new f.EventEmitter),this.onScroll=this._onScroll.event,this._onTitleChange=this.register(new f.EventEmitter),this.onTitleChange=this._onTitleChange.event,this._onColor=this.register(new f.EventEmitter),this.onColor=this._onColor.event,this._parseStack={paused:!1,cursorStartX:0,cursorStartY:0,decodedLength:0,position:0},this._specialColors=[256,257,258],this.register(this._parser),this._dirtyRowTracker=new re(this._bufferService),this._activeBuffer=this._bufferService.buffer,this.register(this._bufferService.buffers.onBufferActivate((T=>this._activeBuffer=T.activeBuffer))),this._parser.setCsiHandlerFallback(((T,K)=>{this._logService.debug("Unknown CSI code: ",{identifier:this._parser.identToString(T),params:K.toArray()})})),this._parser.setEscHandlerFallback((T=>{this._logService.debug("Unknown ESC code: ",{identifier:this._parser.identToString(T)})})),this._parser.setExecuteHandlerFallback((T=>{this._logService.debug("Unknown EXECUTE code: ",{code:T})})),this._parser.setOscHandlerFallback(((T,K,q)=>{this._logService.debug("Unknown OSC code: ",{identifier:T,action:K,data:q})})),this._parser.setDcsHandlerFallback(((T,K,q)=>{K==="HOOK"&&(q=q.toArray()),this._logService.debug("Unknown DCS code: ",{identifier:this._parser.identToString(T),action:K,payload:q})})),this._parser.setPrintHandler(((T,K,q)=>this.print(T,K,q))),this._parser.registerCsiHandler({final:"@"},(T=>this.insertChars(T))),this._parser.registerCsiHandler({intermediates:" ",final:"@"},(T=>this.scrollLeft(T))),this._parser.registerCsiHandler({final:"A"},(T=>this.cursorUp(T))),this._parser.registerCsiHandler({intermediates:" ",final:"A"},(T=>this.scrollRight(T))),this._parser.registerCsiHandler({final:"B"},(T=>this.cursorDown(T))),this._parser.registerCsiHandler({final:"C"},(T=>this.cursorForward(T))),this._parser.registerCsiHandler({final:"D"},(T=>this.cursorBackward(T))),this._parser.registerCsiHandler({final:"E"},(T=>this.cursorNextLine(T))),this._parser.registerCsiHandler({final:"F"},(T=>this.cursorPrecedingLine(T))),this._parser.registerCsiHandler({final:"G"},(T=>this.cursorCharAbsolute(T))),this._parser.registerCsiHandler({final:"H"},(T=>this.cursorPosition(T))),this._parser.registerCsiHandler({final:"I"},(T=>this.cursorForwardTab(T))),this._parser.registerCsiHandler({final:"J"},(T=>this.eraseInDisplay(T,!1))),this._parser.registerCsiHandler({prefix:"?",final:"J"},(T=>this.eraseInDisplay(T,!0))),this._parser.registerCsiHandler({final:"K"},(T=>this.eraseInLine(T,!1))),this._parser.registerCsiHandler({prefix:"?",final:"K"},(T=>this.eraseInLine(T,!0))),this._parser.registerCsiHandler({final:"L"},(T=>this.insertLines(T))),this._parser.registerCsiHandler({final:"M"},(T=>this.deleteLines(T))),this._parser.registerCsiHandler({final:"P"},(T=>this.deleteChars(T))),this._parser.registerCsiHandler({final:"S"},(T=>this.scrollUp(T))),this._parser.registerCsiHandler({final:"T"},(T=>this.scrollDown(T))),this._parser.registerCsiHandler({final:"X"},(T=>this.eraseChars(T))),this._parser.registerCsiHandler({final:"Z"},(T=>this.cursorBackwardTab(T))),this._parser.registerCsiHandler({final:"`"},(T=>this.charPosAbsolute(T))),this._parser.registerCsiHandler({final:"a"},(T=>this.hPositionRelative(T))),this._parser.registerCsiHandler({final:"b"},(T=>this.repeatPrecedingCharacter(T))),this._parser.registerCsiHandler({final:"c"},(T=>this.sendDeviceAttributesPrimary(T))),this._parser.registerCsiHandler({prefix:">",final:"c"},(T=>this.sendDeviceAttributesSecondary(T))),this._parser.registerCsiHandler({final:"d"},(T=>this.linePosAbsolute(T))),this._parser.registerCsiHandler({final:"e"},(T=>this.vPositionRelative(T))),this._parser.registerCsiHandler({final:"f"},(T=>this.hVPosition(T))),this._parser.registerCsiHandler({final:"g"},(T=>this.tabClear(T))),this._parser.registerCsiHandler({final:"h"},(T=>this.setMode(T))),this._parser.registerCsiHandler({prefix:"?",final:"h"},(T=>this.setModePrivate(T))),this._parser.registerCsiHandler({final:"l"},(T=>this.resetMode(T))),this._parser.registerCsiHandler({prefix:"?",final:"l"},(T=>this.resetModePrivate(T))),this._parser.registerCsiHandler({final:"m"},(T=>this.charAttributes(T))),this._parser.registerCsiHandler({final:"n"},(T=>this.deviceStatus(T))),this._parser.registerCsiHandler({prefix:"?",final:"n"},(T=>this.deviceStatusPrivate(T))),this._parser.registerCsiHandler({intermediates:"!",final:"p"},(T=>this.softReset(T))),this._parser.registerCsiHandler({intermediates:" ",final:"q"},(T=>this.setCursorStyle(T))),this._parser.registerCsiHandler({final:"r"},(T=>this.setScrollRegion(T))),this._parser.registerCsiHandler({final:"s"},(T=>this.saveCursor(T))),this._parser.registerCsiHandler({final:"t"},(T=>this.windowOptions(T))),this._parser.registerCsiHandler({final:"u"},(T=>this.restoreCursor(T))),this._parser.registerCsiHandler({intermediates:"'",final:"}"},(T=>this.insertColumns(T))),this._parser.registerCsiHandler({intermediates:"'",final:"~"},(T=>this.deleteColumns(T))),this._parser.registerCsiHandler({intermediates:'"',final:"q"},(T=>this.selectProtected(T))),this._parser.registerCsiHandler({intermediates:"$",final:"p"},(T=>this.requestMode(T,!0))),this._parser.registerCsiHandler({prefix:"?",intermediates:"$",final:"p"},(T=>this.requestMode(T,!1))),this._parser.setExecuteHandler(l.C0.BEL,(()=>this.bell())),this._parser.setExecuteHandler(l.C0.LF,(()=>this.lineFeed())),this._parser.setExecuteHandler(l.C0.VT,(()=>this.lineFeed())),this._parser.setExecuteHandler(l.C0.FF,(()=>this.lineFeed())),this._parser.setExecuteHandler(l.C0.CR,(()=>this.carriageReturn())),this._parser.setExecuteHandler(l.C0.BS,(()=>this.backspace())),this._parser.setExecuteHandler(l.C0.HT,(()=>this.tab())),this._parser.setExecuteHandler(l.C0.SO,(()=>this.shiftOut())),this._parser.setExecuteHandler(l.C0.SI,(()=>this.shiftIn())),this._parser.setExecuteHandler(l.C1.IND,(()=>this.index())),this._parser.setExecuteHandler(l.C1.NEL,(()=>this.nextLine())),this._parser.setExecuteHandler(l.C1.HTS,(()=>this.tabSet())),this._parser.registerOscHandler(0,new E.OscHandler((T=>(this.setTitle(T),this.setIconName(T),!0)))),this._parser.registerOscHandler(1,new E.OscHandler((T=>this.setIconName(T)))),this._parser.registerOscHandler(2,new E.OscHandler((T=>this.setTitle(T)))),this._parser.registerOscHandler(4,new E.OscHandler((T=>this.setOrReportIndexedColor(T)))),this._parser.registerOscHandler(8,new E.OscHandler((T=>this.setHyperlink(T)))),this._parser.registerOscHandler(10,new E.OscHandler((T=>this.setOrReportFgColor(T)))),this._parser.registerOscHandler(11,new E.OscHandler((T=>this.setOrReportBgColor(T)))),this._parser.registerOscHandler(12,new E.OscHandler((T=>this.setOrReportCursorColor(T)))),this._parser.registerOscHandler(104,new E.OscHandler((T=>this.restoreIndexedColor(T)))),this._parser.registerOscHandler(110,new E.OscHandler((T=>this.restoreFgColor(T)))),this._parser.registerOscHandler(111,new E.OscHandler((T=>this.restoreBgColor(T)))),this._parser.registerOscHandler(112,new E.OscHandler((T=>this.restoreCursorColor(T)))),this._parser.registerEscHandler({final:"7"},(()=>this.saveCursor())),this._parser.registerEscHandler({final:"8"},(()=>this.restoreCursor())),this._parser.registerEscHandler({final:"D"},(()=>this.index())),this._parser.registerEscHandler({final:"E"},(()=>this.nextLine())),this._parser.registerEscHandler({final:"H"},(()=>this.tabSet())),this._parser.registerEscHandler({final:"M"},(()=>this.reverseIndex())),this._parser.registerEscHandler({final:"="},(()=>this.keypadApplicationMode())),this._parser.registerEscHandler({final:">"},(()=>this.keypadNumericMode())),this._parser.registerEscHandler({final:"c"},(()=>this.fullReset())),this._parser.registerEscHandler({final:"n"},(()=>this.setgLevel(2))),this._parser.registerEscHandler({final:"o"},(()=>this.setgLevel(3))),this._parser.registerEscHandler({final:"|"},(()=>this.setgLevel(3))),this._parser.registerEscHandler({final:"}"},(()=>this.setgLevel(2))),this._parser.registerEscHandler({final:"~"},(()=>this.setgLevel(1))),this._parser.registerEscHandler({intermediates:"%",final:"@"},(()=>this.selectDefaultCharset())),this._parser.registerEscHandler({intermediates:"%",final:"G"},(()=>this.selectDefaultCharset()));for(const T in m.CHARSETS)this._parser.registerEscHandler({intermediates:"(",final:T},(()=>this.selectCharset("("+T))),this._parser.registerEscHandler({intermediates:")",final:T},(()=>this.selectCharset(")"+T))),this._parser.registerEscHandler({intermediates:"*",final:T},(()=>this.selectCharset("*"+T))),this._parser.registerEscHandler({intermediates:"+",final:T},(()=>this.selectCharset("+"+T))),this._parser.registerEscHandler({intermediates:"-",final:T},(()=>this.selectCharset("-"+T))),this._parser.registerEscHandler({intermediates:".",final:T},(()=>this.selectCharset("."+T))),this._parser.registerEscHandler({intermediates:"/",final:T},(()=>this.selectCharset("/"+T)));this._parser.registerEscHandler({intermediates:"#",final:"8"},(()=>this.screenAlignmentPattern())),this._parser.setErrorHandler((T=>(this._logService.error("Parsing error: ",T),T))),this._parser.registerDcsHandler({intermediates:"$",final:"q"},new b.DcsHandler(((T,K)=>this.requestStatusString(T,K))))}_preserveStack(x,B,N,H){this._parseStack.paused=!0,this._parseStack.cursorStartX=x,this._parseStack.cursorStartY=B,this._parseStack.decodedLength=N,this._parseStack.position=H}_logSlowResolvingAsync(x){this._logService.logLevel<=S.LogLevelEnum.WARN&&Promise.race([x,new Promise(((B,N)=>setTimeout((()=>N("#SLOW_TIMEOUT")),5e3)))]).catch((B=>{if(B!=="#SLOW_TIMEOUT")throw B;console.warn("async parser handler taking longer than 5000 ms")}))}_getCurrentLinkId(){return this._curAttrData.extended.urlId}parse(x,B){let N,H=this._activeBuffer.x,se=this._activeBuffer.y,j=0;const V=this._parseStack.paused;if(V){if(N=this._parser.parse(this._parseBuffer,this._parseStack.decodedLength,B))return this._logSlowResolvingAsync(N),N;H=this._parseStack.cursorStartX,se=this._parseStack.cursorStartY,this._parseStack.paused=!1,x.length>I&&(j=this._parseStack.position+I)}if(this._logService.logLevel<=S.LogLevelEnum.DEBUG&&this._logService.debug("parsing data"+(typeof x=="string"?` "${x}"`:` "${Array.prototype.map.call(x,(T=>String.fromCharCode(T))).join("")}"`),typeof x=="string"?x.split("").map((T=>T.charCodeAt(0))):x),this._parseBuffer.length<x.length&&this._parseBuffer.length<I&&(this._parseBuffer=new Uint32Array(Math.min(x.length,I))),V||this._dirtyRowTracker.clearRange(),x.length>I)for(let T=j;T<x.length;T+=I){const K=T+I<x.length?T+I:x.length,q=typeof x=="string"?this._stringDecoder.decode(x.substring(T,K),this._parseBuffer):this._utf8Decoder.decode(x.subarray(T,K),this._parseBuffer);if(N=this._parser.parse(this._parseBuffer,q))return this._preserveStack(H,se,q,T),this._logSlowResolvingAsync(N),N}else if(!V){const T=typeof x=="string"?this._stringDecoder.decode(x,this._parseBuffer):this._utf8Decoder.decode(x,this._parseBuffer);if(N=this._parser.parse(this._parseBuffer,T))return this._preserveStack(H,se,T,0),this._logSlowResolvingAsync(N),N}this._activeBuffer.x===H&&this._activeBuffer.y===se||this._onCursorMove.fire();const X=this._dirtyRowTracker.end+(this._bufferService.buffer.ybase-this._bufferService.buffer.ydisp),M=this._dirtyRowTracker.start+(this._bufferService.buffer.ybase-this._bufferService.buffer.ydisp);M<this._bufferService.rows&&this._onRequestRefreshRows.fire(Math.min(M,this._bufferService.rows-1),Math.min(X,this._bufferService.rows-1))}print(x,B,N){let H,se;const j=this._charsetService.charset,V=this._optionsService.rawOptions.screenReaderMode,X=this._bufferService.cols,M=this._coreService.decPrivateModes.wraparound,T=this._coreService.modes.insertMode,K=this._curAttrData;let q=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);this._dirtyRowTracker.markDirty(this._activeBuffer.y),this._activeBuffer.x&&N-B>0&&q.getWidth(this._activeBuffer.x-1)===2&&q.setCellFromCodepoint(this._activeBuffer.x-1,0,1,K);let Y=this._parser.precedingJoinState;for(let Z=B;Z<N;++Z){if(H=x[Z],H<127&&j){const Ae=j[String.fromCharCode(H)];Ae&&(H=Ae.charCodeAt(0))}const he=this._unicodeService.charProperties(H,Y);se=w.UnicodeService.extractWidth(he);const me=w.UnicodeService.extractShouldJoin(he),fe=me?w.UnicodeService.extractWidth(Y):0;if(Y=he,V&&this._onA11yChar.fire((0,y.stringFromCodePoint)(H)),this._getCurrentLinkId()&&this._oscLinkService.addLineToLink(this._getCurrentLinkId(),this._activeBuffer.ybase+this._activeBuffer.y),this._activeBuffer.x+se-fe>X){if(M){const Ae=q;let ue=this._activeBuffer.x-fe;for(this._activeBuffer.x=fe,this._activeBuffer.y++,this._activeBuffer.y===this._activeBuffer.scrollBottom+1?(this._activeBuffer.y--,this._bufferService.scroll(this._eraseAttrData(),!0)):(this._activeBuffer.y>=this._bufferService.rows&&(this._activeBuffer.y=this._bufferService.rows-1),this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y).isWrapped=!0),q=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y),fe>0&&q instanceof h.BufferLine&&q.copyCellsFrom(Ae,ue,0,fe,!1);ue<X;)Ae.setCellFromCodepoint(ue++,0,1,K)}else if(this._activeBuffer.x=X-1,se===2)continue}if(me&&this._activeBuffer.x){const Ae=q.getWidth(this._activeBuffer.x-1)?1:2;q.addCodepointToCell(this._activeBuffer.x-Ae,H,se);for(let ue=se-fe;--ue>=0;)q.setCellFromCodepoint(this._activeBuffer.x++,0,0,K)}else if(T&&(q.insertCells(this._activeBuffer.x,se-fe,this._activeBuffer.getNullCell(K)),q.getWidth(X-1)===2&&q.setCellFromCodepoint(X-1,d.NULL_CELL_CODE,d.NULL_CELL_WIDTH,K)),q.setCellFromCodepoint(this._activeBuffer.x++,H,se,K),se>0)for(;--se;)q.setCellFromCodepoint(this._activeBuffer.x++,0,0,K)}this._parser.precedingJoinState=Y,this._activeBuffer.x<X&&N-B>0&&q.getWidth(this._activeBuffer.x)===0&&!q.hasContent(this._activeBuffer.x)&&q.setCellFromCodepoint(this._activeBuffer.x,0,1,K),this._dirtyRowTracker.markDirty(this._activeBuffer.y)}registerCsiHandler(x,B){return x.final!=="t"||x.prefix||x.intermediates?this._parser.registerCsiHandler(x,B):this._parser.registerCsiHandler(x,(N=>!P(N.params[0],this._optionsService.rawOptions.windowOptions)||B(N)))}registerDcsHandler(x,B){return this._parser.registerDcsHandler(x,new b.DcsHandler(B))}registerEscHandler(x,B){return this._parser.registerEscHandler(x,B)}registerOscHandler(x,B){return this._parser.registerOscHandler(x,new E.OscHandler(B))}bell(){return this._onRequestBell.fire(),!0}lineFeed(){return this._dirtyRowTracker.markDirty(this._activeBuffer.y),this._optionsService.rawOptions.convertEol&&(this._activeBuffer.x=0),this._activeBuffer.y++,this._activeBuffer.y===this._activeBuffer.scrollBottom+1?(this._activeBuffer.y--,this._bufferService.scroll(this._eraseAttrData())):this._activeBuffer.y>=this._bufferService.rows?this._activeBuffer.y=this._bufferService.rows-1:this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y).isWrapped=!1,this._activeBuffer.x>=this._bufferService.cols&&this._activeBuffer.x--,this._dirtyRowTracker.markDirty(this._activeBuffer.y),this._onLineFeed.fire(),!0}carriageReturn(){return this._activeBuffer.x=0,!0}backspace(){if(!this._coreService.decPrivateModes.reverseWraparound)return this._restrictCursor(),this._activeBuffer.x>0&&this._activeBuffer.x--,!0;if(this._restrictCursor(this._bufferService.cols),this._activeBuffer.x>0)this._activeBuffer.x--;else if(this._activeBuffer.x===0&&this._activeBuffer.y>this._activeBuffer.scrollTop&&this._activeBuffer.y<=this._activeBuffer.scrollBottom&&this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y)?.isWrapped){this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y).isWrapped=!1,this._activeBuffer.y--,this._activeBuffer.x=this._bufferService.cols-1;const x=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);x.hasWidth(this._activeBuffer.x)&&!x.hasContent(this._activeBuffer.x)&&this._activeBuffer.x--}return this._restrictCursor(),!0}tab(){if(this._activeBuffer.x>=this._bufferService.cols)return!0;const x=this._activeBuffer.x;return this._activeBuffer.x=this._activeBuffer.nextStop(),this._optionsService.rawOptions.screenReaderMode&&this._onA11yTab.fire(this._activeBuffer.x-x),!0}shiftOut(){return this._charsetService.setgLevel(1),!0}shiftIn(){return this._charsetService.setgLevel(0),!0}_restrictCursor(x=this._bufferService.cols-1){this._activeBuffer.x=Math.min(x,Math.max(0,this._activeBuffer.x)),this._activeBuffer.y=this._coreService.decPrivateModes.origin?Math.min(this._activeBuffer.scrollBottom,Math.max(this._activeBuffer.scrollTop,this._activeBuffer.y)):Math.min(this._bufferService.rows-1,Math.max(0,this._activeBuffer.y)),this._dirtyRowTracker.markDirty(this._activeBuffer.y)}_setCursor(x,B){this._dirtyRowTracker.markDirty(this._activeBuffer.y),this._coreService.decPrivateModes.origin?(this._activeBuffer.x=x,this._activeBuffer.y=this._activeBuffer.scrollTop+B):(this._activeBuffer.x=x,this._activeBuffer.y=B),this._restrictCursor(),this._dirtyRowTracker.markDirty(this._activeBuffer.y)}_moveCursor(x,B){this._restrictCursor(),this._setCursor(this._activeBuffer.x+x,this._activeBuffer.y+B)}cursorUp(x){const B=this._activeBuffer.y-this._activeBuffer.scrollTop;return B>=0?this._moveCursor(0,-Math.min(B,x.params[0]||1)):this._moveCursor(0,-(x.params[0]||1)),!0}cursorDown(x){const B=this._activeBuffer.scrollBottom-this._activeBuffer.y;return B>=0?this._moveCursor(0,Math.min(B,x.params[0]||1)):this._moveCursor(0,x.params[0]||1),!0}cursorForward(x){return this._moveCursor(x.params[0]||1,0),!0}cursorBackward(x){return this._moveCursor(-(x.params[0]||1),0),!0}cursorNextLine(x){return this.cursorDown(x),this._activeBuffer.x=0,!0}cursorPrecedingLine(x){return this.cursorUp(x),this._activeBuffer.x=0,!0}cursorCharAbsolute(x){return this._setCursor((x.params[0]||1)-1,this._activeBuffer.y),!0}cursorPosition(x){return this._setCursor(x.length>=2?(x.params[1]||1)-1:0,(x.params[0]||1)-1),!0}charPosAbsolute(x){return this._setCursor((x.params[0]||1)-1,this._activeBuffer.y),!0}hPositionRelative(x){return this._moveCursor(x.params[0]||1,0),!0}linePosAbsolute(x){return this._setCursor(this._activeBuffer.x,(x.params[0]||1)-1),!0}vPositionRelative(x){return this._moveCursor(0,x.params[0]||1),!0}hVPosition(x){return this.cursorPosition(x),!0}tabClear(x){const B=x.params[0];return B===0?delete this._activeBuffer.tabs[this._activeBuffer.x]:B===3&&(this._activeBuffer.tabs={}),!0}cursorForwardTab(x){if(this._activeBuffer.x>=this._bufferService.cols)return!0;let B=x.params[0]||1;for(;B--;)this._activeBuffer.x=this._activeBuffer.nextStop();return!0}cursorBackwardTab(x){if(this._activeBuffer.x>=this._bufferService.cols)return!0;let B=x.params[0]||1;for(;B--;)this._activeBuffer.x=this._activeBuffer.prevStop();return!0}selectProtected(x){const B=x.params[0];return B===1&&(this._curAttrData.bg|=536870912),B!==2&&B!==0||(this._curAttrData.bg&=-536870913),!0}_eraseInBufferLine(x,B,N,H=!1,se=!1){const j=this._activeBuffer.lines.get(this._activeBuffer.ybase+x);j.replaceCells(B,N,this._activeBuffer.getNullCell(this._eraseAttrData()),se),H&&(j.isWrapped=!1)}_resetBufferLine(x,B=!1){const N=this._activeBuffer.lines.get(this._activeBuffer.ybase+x);N&&(N.fill(this._activeBuffer.getNullCell(this._eraseAttrData()),B),this._bufferService.buffer.clearMarkers(this._activeBuffer.ybase+x),N.isWrapped=!1)}eraseInDisplay(x,B=!1){let N;switch(this._restrictCursor(this._bufferService.cols),x.params[0]){case 0:for(N=this._activeBuffer.y,this._dirtyRowTracker.markDirty(N),this._eraseInBufferLine(N++,this._activeBuffer.x,this._bufferService.cols,this._activeBuffer.x===0,B);N<this._bufferService.rows;N++)this._resetBufferLine(N,B);this._dirtyRowTracker.markDirty(N);break;case 1:for(N=this._activeBuffer.y,this._dirtyRowTracker.markDirty(N),this._eraseInBufferLine(N,0,this._activeBuffer.x+1,!0,B),this._activeBuffer.x+1>=this._bufferService.cols&&(this._activeBuffer.lines.get(N+1).isWrapped=!1);N--;)this._resetBufferLine(N,B);this._dirtyRowTracker.markDirty(0);break;case 2:for(N=this._bufferService.rows,this._dirtyRowTracker.markDirty(N-1);N--;)this._resetBufferLine(N,B);this._dirtyRowTracker.markDirty(0);break;case 3:const H=this._activeBuffer.lines.length-this._bufferService.rows;H>0&&(this._activeBuffer.lines.trimStart(H),this._activeBuffer.ybase=Math.max(this._activeBuffer.ybase-H,0),this._activeBuffer.ydisp=Math.max(this._activeBuffer.ydisp-H,0),this._onScroll.fire(0))}return!0}eraseInLine(x,B=!1){switch(this._restrictCursor(this._bufferService.cols),x.params[0]){case 0:this._eraseInBufferLine(this._activeBuffer.y,this._activeBuffer.x,this._bufferService.cols,this._activeBuffer.x===0,B);break;case 1:this._eraseInBufferLine(this._activeBuffer.y,0,this._activeBuffer.x+1,!1,B);break;case 2:this._eraseInBufferLine(this._activeBuffer.y,0,this._bufferService.cols,!0,B)}return this._dirtyRowTracker.markDirty(this._activeBuffer.y),!0}insertLines(x){this._restrictCursor();let B=x.params[0]||1;if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;const N=this._activeBuffer.ybase+this._activeBuffer.y,H=this._bufferService.rows-1-this._activeBuffer.scrollBottom,se=this._bufferService.rows-1+this._activeBuffer.ybase-H+1;for(;B--;)this._activeBuffer.lines.splice(se-1,1),this._activeBuffer.lines.splice(N,0,this._activeBuffer.getBlankLine(this._eraseAttrData()));return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.y,this._activeBuffer.scrollBottom),this._activeBuffer.x=0,!0}deleteLines(x){this._restrictCursor();let B=x.params[0]||1;if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;const N=this._activeBuffer.ybase+this._activeBuffer.y;let H;for(H=this._bufferService.rows-1-this._activeBuffer.scrollBottom,H=this._bufferService.rows-1+this._activeBuffer.ybase-H;B--;)this._activeBuffer.lines.splice(N,1),this._activeBuffer.lines.splice(H,0,this._activeBuffer.getBlankLine(this._eraseAttrData()));return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.y,this._activeBuffer.scrollBottom),this._activeBuffer.x=0,!0}insertChars(x){this._restrictCursor();const B=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);return B&&(B.insertCells(this._activeBuffer.x,x.params[0]||1,this._activeBuffer.getNullCell(this._eraseAttrData())),this._dirtyRowTracker.markDirty(this._activeBuffer.y)),!0}deleteChars(x){this._restrictCursor();const B=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);return B&&(B.deleteCells(this._activeBuffer.x,x.params[0]||1,this._activeBuffer.getNullCell(this._eraseAttrData())),this._dirtyRowTracker.markDirty(this._activeBuffer.y)),!0}scrollUp(x){let B=x.params[0]||1;for(;B--;)this._activeBuffer.lines.splice(this._activeBuffer.ybase+this._activeBuffer.scrollTop,1),this._activeBuffer.lines.splice(this._activeBuffer.ybase+this._activeBuffer.scrollBottom,0,this._activeBuffer.getBlankLine(this._eraseAttrData()));return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}scrollDown(x){let B=x.params[0]||1;for(;B--;)this._activeBuffer.lines.splice(this._activeBuffer.ybase+this._activeBuffer.scrollBottom,1),this._activeBuffer.lines.splice(this._activeBuffer.ybase+this._activeBuffer.scrollTop,0,this._activeBuffer.getBlankLine(h.DEFAULT_ATTR_DATA));return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}scrollLeft(x){if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;const B=x.params[0]||1;for(let N=this._activeBuffer.scrollTop;N<=this._activeBuffer.scrollBottom;++N){const H=this._activeBuffer.lines.get(this._activeBuffer.ybase+N);H.deleteCells(0,B,this._activeBuffer.getNullCell(this._eraseAttrData())),H.isWrapped=!1}return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}scrollRight(x){if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;const B=x.params[0]||1;for(let N=this._activeBuffer.scrollTop;N<=this._activeBuffer.scrollBottom;++N){const H=this._activeBuffer.lines.get(this._activeBuffer.ybase+N);H.insertCells(0,B,this._activeBuffer.getNullCell(this._eraseAttrData())),H.isWrapped=!1}return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}insertColumns(x){if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;const B=x.params[0]||1;for(let N=this._activeBuffer.scrollTop;N<=this._activeBuffer.scrollBottom;++N){const H=this._activeBuffer.lines.get(this._activeBuffer.ybase+N);H.insertCells(this._activeBuffer.x,B,this._activeBuffer.getNullCell(this._eraseAttrData())),H.isWrapped=!1}return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}deleteColumns(x){if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;const B=x.params[0]||1;for(let N=this._activeBuffer.scrollTop;N<=this._activeBuffer.scrollBottom;++N){const H=this._activeBuffer.lines.get(this._activeBuffer.ybase+N);H.deleteCells(this._activeBuffer.x,B,this._activeBuffer.getNullCell(this._eraseAttrData())),H.isWrapped=!1}return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}eraseChars(x){this._restrictCursor();const B=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);return B&&(B.replaceCells(this._activeBuffer.x,this._activeBuffer.x+(x.params[0]||1),this._activeBuffer.getNullCell(this._eraseAttrData())),this._dirtyRowTracker.markDirty(this._activeBuffer.y)),!0}repeatPrecedingCharacter(x){const B=this._parser.precedingJoinState;if(!B)return!0;const N=x.params[0]||1,H=w.UnicodeService.extractWidth(B),se=this._activeBuffer.x-H,j=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y).getString(se),V=new Uint32Array(j.length*N);let X=0;for(let T=0;T<j.length;){const K=j.codePointAt(T)||0;V[X++]=K,T+=K>65535?2:1}let M=X;for(let T=1;T<N;++T)V.copyWithin(M,0,X),M+=X;return this.print(V,0,M),!0}sendDeviceAttributesPrimary(x){return x.params[0]>0||(this._is("xterm")||this._is("rxvt-unicode")||this._is("screen")?this._coreService.triggerDataEvent(l.C0.ESC+"[?1;2c"):this._is("linux")&&this._coreService.triggerDataEvent(l.C0.ESC+"[?6c")),!0}sendDeviceAttributesSecondary(x){return x.params[0]>0||(this._is("xterm")?this._coreService.triggerDataEvent(l.C0.ESC+"[>0;276;0c"):this._is("rxvt-unicode")?this._coreService.triggerDataEvent(l.C0.ESC+"[>85;95;0c"):this._is("linux")?this._coreService.triggerDataEvent(x.params[0]+"c"):this._is("screen")&&this._coreService.triggerDataEvent(l.C0.ESC+"[>83;40003;0c")),!0}_is(x){return(this._optionsService.rawOptions.termName+"").indexOf(x)===0}setMode(x){for(let B=0;B<x.length;B++)switch(x.params[B]){case 4:this._coreService.modes.insertMode=!0;break;case 20:this._optionsService.options.convertEol=!0}return!0}setModePrivate(x){for(let B=0;B<x.length;B++)switch(x.params[B]){case 1:this._coreService.decPrivateModes.applicationCursorKeys=!0;break;case 2:this._charsetService.setgCharset(0,m.DEFAULT_CHARSET),this._charsetService.setgCharset(1,m.DEFAULT_CHARSET),this._charsetService.setgCharset(2,m.DEFAULT_CHARSET),this._charsetService.setgCharset(3,m.DEFAULT_CHARSET);break;case 3:this._optionsService.rawOptions.windowOptions.setWinLines&&(this._bufferService.resize(132,this._bufferService.rows),this._onRequestReset.fire());break;case 6:this._coreService.decPrivateModes.origin=!0,this._setCursor(0,0);break;case 7:this._coreService.decPrivateModes.wraparound=!0;break;case 12:this._optionsService.options.cursorBlink=!0;break;case 45:this._coreService.decPrivateModes.reverseWraparound=!0;break;case 66:this._logService.debug("Serial port requested application keypad."),this._coreService.decPrivateModes.applicationKeypad=!0,this._onRequestSyncScrollBar.fire();break;case 9:this._coreMouseService.activeProtocol="X10";break;case 1e3:this._coreMouseService.activeProtocol="VT200";break;case 1002:this._coreMouseService.activeProtocol="DRAG";break;case 1003:this._coreMouseService.activeProtocol="ANY";break;case 1004:this._coreService.decPrivateModes.sendFocus=!0,this._onRequestSendFocus.fire();break;case 1005:this._logService.debug("DECSET 1005 not supported (see #2507)");break;case 1006:this._coreMouseService.activeEncoding="SGR";break;case 1015:this._logService.debug("DECSET 1015 not supported (see #2507)");break;case 1016:this._coreMouseService.activeEncoding="SGR_PIXELS";break;case 25:this._coreService.isCursorHidden=!1;break;case 1048:this.saveCursor();break;case 1049:this.saveCursor();case 47:case 1047:this._bufferService.buffers.activateAltBuffer(this._eraseAttrData()),this._coreService.isCursorInitialized=!0,this._onRequestRefreshRows.fire(0,this._bufferService.rows-1),this._onRequestSyncScrollBar.fire();break;case 2004:this._coreService.decPrivateModes.bracketedPasteMode=!0}return!0}resetMode(x){for(let B=0;B<x.length;B++)switch(x.params[B]){case 4:this._coreService.modes.insertMode=!1;break;case 20:this._optionsService.options.convertEol=!1}return!0}resetModePrivate(x){for(let B=0;B<x.length;B++)switch(x.params[B]){case 1:this._coreService.decPrivateModes.applicationCursorKeys=!1;break;case 3:this._optionsService.rawOptions.windowOptions.setWinLines&&(this._bufferService.resize(80,this._bufferService.rows),this._onRequestReset.fire());break;case 6:this._coreService.decPrivateModes.origin=!1,this._setCursor(0,0);break;case 7:this._coreService.decPrivateModes.wraparound=!1;break;case 12:this._optionsService.options.cursorBlink=!1;break;case 45:this._coreService.decPrivateModes.reverseWraparound=!1;break;case 66:this._logService.debug("Switching back to normal keypad."),this._coreService.decPrivateModes.applicationKeypad=!1,this._onRequestSyncScrollBar.fire();break;case 9:case 1e3:case 1002:case 1003:this._coreMouseService.activeProtocol="NONE";break;case 1004:this._coreService.decPrivateModes.sendFocus=!1;break;case 1005:this._logService.debug("DECRST 1005 not supported (see #2507)");break;case 1006:case 1016:this._coreMouseService.activeEncoding="DEFAULT";break;case 1015:this._logService.debug("DECRST 1015 not supported (see #2507)");break;case 25:this._coreService.isCursorHidden=!0;break;case 1048:this.restoreCursor();break;case 1049:case 47:case 1047:this._bufferService.buffers.activateNormalBuffer(),x.params[B]===1049&&this.restoreCursor(),this._coreService.isCursorInitialized=!0,this._onRequestRefreshRows.fire(0,this._bufferService.rows-1),this._onRequestSyncScrollBar.fire();break;case 2004:this._coreService.decPrivateModes.bracketedPasteMode=!1}return!0}requestMode(x,B){const N=this._coreService.decPrivateModes,{activeProtocol:H,activeEncoding:se}=this._coreMouseService,j=this._coreService,{buffers:V,cols:X}=this._bufferService,{active:M,alt:T}=V,K=this._optionsService.rawOptions,q=me=>me?1:2,Y=x.params[0];return Z=Y,he=B?Y===2?4:Y===4?q(j.modes.insertMode):Y===12?3:Y===20?q(K.convertEol):0:Y===1?q(N.applicationCursorKeys):Y===3?K.windowOptions.setWinLines?X===80?2:X===132?1:0:0:Y===6?q(N.origin):Y===7?q(N.wraparound):Y===8?3:Y===9?q(H==="X10"):Y===12?q(K.cursorBlink):Y===25?q(!j.isCursorHidden):Y===45?q(N.reverseWraparound):Y===66?q(N.applicationKeypad):Y===67?4:Y===1e3?q(H==="VT200"):Y===1002?q(H==="DRAG"):Y===1003?q(H==="ANY"):Y===1004?q(N.sendFocus):Y===1005?4:Y===1006?q(se==="SGR"):Y===1015?4:Y===1016?q(se==="SGR_PIXELS"):Y===1048?1:Y===47||Y===1047||Y===1049?q(M===T):Y===2004?q(N.bracketedPasteMode):0,j.triggerDataEvent(`${l.C0.ESC}[${B?"":"?"}${Z};${he}$y`),!0;var Z,he}_updateAttrColor(x,B,N,H,se){return B===2?(x|=50331648,x&=-16777216,x|=v.AttributeData.fromColorRGB([N,H,se])):B===5&&(x&=-50331904,x|=33554432|255&N),x}_extractColor(x,B,N){const H=[0,0,-1,0,0,0];let se=0,j=0;do{if(H[j+se]=x.params[B+j],x.hasSubParams(B+j)){const V=x.getSubParams(B+j);let X=0;do H[1]===5&&(se=1),H[j+X+1+se]=V[X];while(++X<V.length&&X+j+1+se<H.length);break}if(H[1]===5&&j+se>=2||H[1]===2&&j+se>=5)break;H[1]&&(se=1)}while(++j+B<x.length&&j+se<H.length);for(let V=2;V<H.length;++V)H[V]===-1&&(H[V]=0);switch(H[0]){case 38:N.fg=this._updateAttrColor(N.fg,H[1],H[3],H[4],H[5]);break;case 48:N.bg=this._updateAttrColor(N.bg,H[1],H[3],H[4],H[5]);break;case 58:N.extended=N.extended.clone(),N.extended.underlineColor=this._updateAttrColor(N.extended.underlineColor,H[1],H[3],H[4],H[5])}return j}_processUnderline(x,B){B.extended=B.extended.clone(),(!~x||x>5)&&(x=1),B.extended.underlineStyle=x,B.fg|=268435456,x===0&&(B.fg&=-268435457),B.updateExtended()}_processSGR0(x){x.fg=h.DEFAULT_ATTR_DATA.fg,x.bg=h.DEFAULT_ATTR_DATA.bg,x.extended=x.extended.clone(),x.extended.underlineStyle=0,x.extended.underlineColor&=-67108864,x.updateExtended()}charAttributes(x){if(x.length===1&&x.params[0]===0)return this._processSGR0(this._curAttrData),!0;const B=x.length;let N;const H=this._curAttrData;for(let se=0;se<B;se++)N=x.params[se],N>=30&&N<=37?(H.fg&=-50331904,H.fg|=16777216|N-30):N>=40&&N<=47?(H.bg&=-50331904,H.bg|=16777216|N-40):N>=90&&N<=97?(H.fg&=-50331904,H.fg|=16777224|N-90):N>=100&&N<=107?(H.bg&=-50331904,H.bg|=16777224|N-100):N===0?this._processSGR0(H):N===1?H.fg|=134217728:N===3?H.bg|=67108864:N===4?(H.fg|=268435456,this._processUnderline(x.hasSubParams(se)?x.getSubParams(se)[0]:1,H)):N===5?H.fg|=536870912:N===7?H.fg|=67108864:N===8?H.fg|=1073741824:N===9?H.fg|=2147483648:N===2?H.bg|=134217728:N===21?this._processUnderline(2,H):N===22?(H.fg&=-134217729,H.bg&=-134217729):N===23?H.bg&=-67108865:N===24?(H.fg&=-268435457,this._processUnderline(0,H)):N===25?H.fg&=-536870913:N===27?H.fg&=-67108865:N===28?H.fg&=-1073741825:N===29?H.fg&=2147483647:N===39?(H.fg&=-67108864,H.fg|=16777215&h.DEFAULT_ATTR_DATA.fg):N===49?(H.bg&=-67108864,H.bg|=16777215&h.DEFAULT_ATTR_DATA.bg):N===38||N===48||N===58?se+=this._extractColor(x,se,H):N===53?H.bg|=1073741824:N===55?H.bg&=-1073741825:N===59?(H.extended=H.extended.clone(),H.extended.underlineColor=-1,H.updateExtended()):N===100?(H.fg&=-67108864,H.fg|=16777215&h.DEFAULT_ATTR_DATA.fg,H.bg&=-67108864,H.bg|=16777215&h.DEFAULT_ATTR_DATA.bg):this._logService.debug("Unknown SGR attribute: %d.",N);return!0}deviceStatus(x){switch(x.params[0]){case 5:this._coreService.triggerDataEvent(`${l.C0.ESC}[0n`);break;case 6:const B=this._activeBuffer.y+1,N=this._activeBuffer.x+1;this._coreService.triggerDataEvent(`${l.C0.ESC}[${B};${N}R`)}return!0}deviceStatusPrivate(x){if(x.params[0]===6){const B=this._activeBuffer.y+1,N=this._activeBuffer.x+1;this._coreService.triggerDataEvent(`${l.C0.ESC}[?${B};${N}R`)}return!0}softReset(x){return this._coreService.isCursorHidden=!1,this._onRequestSyncScrollBar.fire(),this._activeBuffer.scrollTop=0,this._activeBuffer.scrollBottom=this._bufferService.rows-1,this._curAttrData=h.DEFAULT_ATTR_DATA.clone(),this._coreService.reset(),this._charsetService.reset(),this._activeBuffer.savedX=0,this._activeBuffer.savedY=this._activeBuffer.ybase,this._activeBuffer.savedCurAttrData.fg=this._curAttrData.fg,this._activeBuffer.savedCurAttrData.bg=this._curAttrData.bg,this._activeBuffer.savedCharset=this._charsetService.charset,this._coreService.decPrivateModes.origin=!1,!0}setCursorStyle(x){const B=x.params[0]||1;switch(B){case 1:case 2:this._optionsService.options.cursorStyle="block";break;case 3:case 4:this._optionsService.options.cursorStyle="underline";break;case 5:case 6:this._optionsService.options.cursorStyle="bar"}const N=B%2==1;return this._optionsService.options.cursorBlink=N,!0}setScrollRegion(x){const B=x.params[0]||1;let N;return(x.length<2||(N=x.params[1])>this._bufferService.rows||N===0)&&(N=this._bufferService.rows),N>B&&(this._activeBuffer.scrollTop=B-1,this._activeBuffer.scrollBottom=N-1,this._setCursor(0,0)),!0}windowOptions(x){if(!P(x.params[0],this._optionsService.rawOptions.windowOptions))return!0;const B=x.length>1?x.params[1]:0;switch(x.params[0]){case 14:B!==2&&this._onRequestWindowsOptionsReport.fire(L.GET_WIN_SIZE_PIXELS);break;case 16:this._onRequestWindowsOptionsReport.fire(L.GET_CELL_SIZE_PIXELS);break;case 18:this._bufferService&&this._coreService.triggerDataEvent(`${l.C0.ESC}[8;${this._bufferService.rows};${this._bufferService.cols}t`);break;case 22:B!==0&&B!==2||(this._windowTitleStack.push(this._windowTitle),this._windowTitleStack.length>10&&this._windowTitleStack.shift()),B!==0&&B!==1||(this._iconNameStack.push(this._iconName),this._iconNameStack.length>10&&this._iconNameStack.shift());break;case 23:B!==0&&B!==2||this._windowTitleStack.length&&this.setTitle(this._windowTitleStack.pop()),B!==0&&B!==1||this._iconNameStack.length&&this.setIconName(this._iconNameStack.pop())}return!0}saveCursor(x){return this._activeBuffer.savedX=this._activeBuffer.x,this._activeBuffer.savedY=this._activeBuffer.ybase+this._activeBuffer.y,this._activeBuffer.savedCurAttrData.fg=this._curAttrData.fg,this._activeBuffer.savedCurAttrData.bg=this._curAttrData.bg,this._activeBuffer.savedCharset=this._charsetService.charset,!0}restoreCursor(x){return this._activeBuffer.x=this._activeBuffer.savedX||0,this._activeBuffer.y=Math.max(this._activeBuffer.savedY-this._activeBuffer.ybase,0),this._curAttrData.fg=this._activeBuffer.savedCurAttrData.fg,this._curAttrData.bg=this._activeBuffer.savedCurAttrData.bg,this._charsetService.charset=this._savedCharset,this._activeBuffer.savedCharset&&(this._charsetService.charset=this._activeBuffer.savedCharset),this._restrictCursor(),!0}setTitle(x){return this._windowTitle=x,this._onTitleChange.fire(x),!0}setIconName(x){return this._iconName=x,!0}setOrReportIndexedColor(x){const B=[],N=x.split(";");for(;N.length>1;){const H=N.shift(),se=N.shift();if(/^\d+$/.exec(H)){const j=parseInt(H);if(te(j))if(se==="?")B.push({type:0,index:j});else{const V=(0,k.parseColor)(se);V&&B.push({type:1,index:j,color:V})}}}return B.length&&this._onColor.fire(B),!0}setHyperlink(x){const B=x.split(";");return!(B.length<2)&&(B[1]?this._createHyperlink(B[0],B[1]):!B[0]&&this._finishHyperlink())}_createHyperlink(x,B){this._getCurrentLinkId()&&this._finishHyperlink();const N=x.split(":");let H;const se=N.findIndex((j=>j.startsWith("id=")));return se!==-1&&(H=N[se].slice(3)||void 0),this._curAttrData.extended=this._curAttrData.extended.clone(),this._curAttrData.extended.urlId=this._oscLinkService.registerLink({id:H,uri:B}),this._curAttrData.updateExtended(),!0}_finishHyperlink(){return this._curAttrData.extended=this._curAttrData.extended.clone(),this._curAttrData.extended.urlId=0,this._curAttrData.updateExtended(),!0}_setOrReportSpecialColor(x,B){const N=x.split(";");for(let H=0;H<N.length&&!(B>=this._specialColors.length);++H,++B)if(N[H]==="?")this._onColor.fire([{type:0,index:this._specialColors[B]}]);else{const se=(0,k.parseColor)(N[H]);se&&this._onColor.fire([{type:1,index:this._specialColors[B],color:se}])}return!0}setOrReportFgColor(x){return this._setOrReportSpecialColor(x,0)}setOrReportBgColor(x){return this._setOrReportSpecialColor(x,1)}setOrReportCursorColor(x){return this._setOrReportSpecialColor(x,2)}restoreIndexedColor(x){if(!x)return this._onColor.fire([{type:2}]),!0;const B=[],N=x.split(";");for(let H=0;H<N.length;++H)if(/^\d+$/.exec(N[H])){const se=parseInt(N[H]);te(se)&&B.push({type:2,index:se})}return B.length&&this._onColor.fire(B),!0}restoreFgColor(x){return this._onColor.fire([{type:2,index:256}]),!0}restoreBgColor(x){return this._onColor.fire([{type:2,index:257}]),!0}restoreCursorColor(x){return this._onColor.fire([{type:2,index:258}]),!0}nextLine(){return this._activeBuffer.x=0,this.index(),!0}keypadApplicationMode(){return this._logService.debug("Serial port requested application keypad."),this._coreService.decPrivateModes.applicationKeypad=!0,this._onRequestSyncScrollBar.fire(),!0}keypadNumericMode(){return this._logService.debug("Switching back to normal keypad."),this._coreService.decPrivateModes.applicationKeypad=!1,this._onRequestSyncScrollBar.fire(),!0}selectDefaultCharset(){return this._charsetService.setgLevel(0),this._charsetService.setgCharset(0,m.DEFAULT_CHARSET),!0}selectCharset(x){return x.length!==2?(this.selectDefaultCharset(),!0):(x[0]==="/"||this._charsetService.setgCharset(R[x[0]],m.CHARSETS[x[1]]||m.DEFAULT_CHARSET),!0)}index(){return this._restrictCursor(),this._activeBuffer.y++,this._activeBuffer.y===this._activeBuffer.scrollBottom+1?(this._activeBuffer.y--,this._bufferService.scroll(this._eraseAttrData())):this._activeBuffer.y>=this._bufferService.rows&&(this._activeBuffer.y=this._bufferService.rows-1),this._restrictCursor(),!0}tabSet(){return this._activeBuffer.tabs[this._activeBuffer.x]=!0,!0}reverseIndex(){if(this._restrictCursor(),this._activeBuffer.y===this._activeBuffer.scrollTop){const x=this._activeBuffer.scrollBottom-this._activeBuffer.scrollTop;this._activeBuffer.lines.shiftElements(this._activeBuffer.ybase+this._activeBuffer.y,x,1),this._activeBuffer.lines.set(this._activeBuffer.ybase+this._activeBuffer.y,this._activeBuffer.getBlankLine(this._eraseAttrData())),this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom)}else this._activeBuffer.y--,this._restrictCursor();return!0}fullReset(){return this._parser.reset(),this._onRequestReset.fire(),!0}reset(){this._curAttrData=h.DEFAULT_ATTR_DATA.clone(),this._eraseAttrDataInternal=h.DEFAULT_ATTR_DATA.clone()}_eraseAttrData(){return this._eraseAttrDataInternal.bg&=-67108864,this._eraseAttrDataInternal.bg|=67108863&this._curAttrData.bg,this._eraseAttrDataInternal}setgLevel(x){return this._charsetService.setgLevel(x),!0}screenAlignmentPattern(){const x=new p.CellData;x.content=4194373,x.fg=this._curAttrData.fg,x.bg=this._curAttrData.bg,this._setCursor(0,0);for(let B=0;B<this._bufferService.rows;++B){const N=this._activeBuffer.ybase+this._activeBuffer.y+B,H=this._activeBuffer.lines.get(N);H&&(H.fill(x),H.isWrapped=!1)}return this._dirtyRowTracker.markAllDirty(),this._setCursor(0,0),!0}requestStatusString(x,B){const N=this._bufferService.buffer,H=this._optionsService.rawOptions;return(se=>(this._coreService.triggerDataEvent(`${l.C0.ESC}${se}${l.C0.ESC}\\`),!0))(x==='"q'?`P1$r${this._curAttrData.isProtected()?1:0}"q`:x==='"p'?'P1$r61;1"p':x==="r"?`P1$r${N.scrollTop+1};${N.scrollBottom+1}r`:x==="m"?"P1$r0m":x===" q"?`P1$r${{block:2,underline:4,bar:6}[H.cursorStyle]-(H.cursorBlink?1:0)} q`:"P0$r")}markRangeDirty(x,B){this._dirtyRowTracker.markRangeDirty(x,B)}}r.InputHandler=J;let re=class{constructor(ee){this._bufferService=ee,this.clearRange()}clearRange(){this.start=this._bufferService.buffer.y,this.end=this._bufferService.buffer.y}markDirty(ee){ee<this.start?this.start=ee:ee>this.end&&(this.end=ee)}markRangeDirty(ee,x){ee>x&&(z=ee,ee=x,x=z),ee<this.start&&(this.start=ee),x>this.end&&(this.end=x)}markAllDirty(){this.markRangeDirty(0,this._bufferService.rows-1)}};function te(ee){return 0<=ee&&ee<256}re=u([_(0,S.IBufferService)],re)},844:(c,r)=>{function a(u){for(const _ of u)_.dispose();u.length=0}Object.defineProperty(r,"__esModule",{value:!0}),r.getDisposeArrayDisposable=r.disposeArray=r.toDisposable=r.MutableDisposable=r.Disposable=void 0,r.Disposable=class{constructor(){this._disposables=[],this._isDisposed=!1}dispose(){this._isDisposed=!0;for(const u of this._disposables)u.dispose();this._disposables.length=0}register(u){return this._disposables.push(u),u}unregister(u){const _=this._disposables.indexOf(u);_!==-1&&this._disposables.splice(_,1)}},r.MutableDisposable=class{constructor(){this._isDisposed=!1}get value(){return this._isDisposed?void 0:this._value}set value(u){this._isDisposed||u===this._value||(this._value?.dispose(),this._value=u)}clear(){this.value=void 0}dispose(){this._isDisposed=!0,this._value?.dispose(),this._value=void 0}},r.toDisposable=function(u){return{dispose:u}},r.disposeArray=a,r.getDisposeArrayDisposable=function(u){return{dispose:()=>a(u)}}},1505:(c,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.FourKeyMap=r.TwoKeyMap=void 0;class a{constructor(){this._data={}}set(_,l,m){this._data[_]||(this._data[_]={}),this._data[_][l]=m}get(_,l){return this._data[_]?this._data[_][l]:void 0}clear(){this._data={}}}r.TwoKeyMap=a,r.FourKeyMap=class{constructor(){this._data=new a}set(u,_,l,m,g){this._data.get(u,_)||this._data.set(u,_,new a),this._data.get(u,_).set(l,m,g)}get(u,_,l,m){return this._data.get(u,_)?.get(l,m)}clear(){this._data.clear()}}},6114:(c,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.isChromeOS=r.isLinux=r.isWindows=r.isIphone=r.isIpad=r.isMac=r.getSafariVersion=r.isSafari=r.isLegacyEdge=r.isFirefox=r.isNode=void 0,r.isNode=typeof process<"u"&&"title"in process;const a=r.isNode?"node":navigator.userAgent,u=r.isNode?"node":navigator.platform;r.isFirefox=a.includes("Firefox"),r.isLegacyEdge=a.includes("Edge"),r.isSafari=/^((?!chrome|android).)*safari/i.test(a),r.getSafariVersion=function(){if(!r.isSafari)return 0;const _=a.match(/Version\/(\d+)/);return _===null||_.length<2?0:parseInt(_[1])},r.isMac=["Macintosh","MacIntel","MacPPC","Mac68K"].includes(u),r.isIpad=u==="iPad",r.isIphone=u==="iPhone",r.isWindows=["Windows","Win16","Win32","WinCE"].includes(u),r.isLinux=u.indexOf("Linux")>=0,r.isChromeOS=/\bCrOS\b/.test(a)},6106:(c,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.SortedList=void 0;let a=0;r.SortedList=class{constructor(u){this._getKey=u,this._array=[]}clear(){this._array.length=0}insert(u){this._array.length!==0?(a=this._search(this._getKey(u)),this._array.splice(a,0,u)):this._array.push(u)}delete(u){if(this._array.length===0)return!1;const _=this._getKey(u);if(_===void 0||(a=this._search(_),a===-1)||this._getKey(this._array[a])!==_)return!1;do if(this._array[a]===u)return this._array.splice(a,1),!0;while(++a<this._array.length&&this._getKey(this._array[a])===_);return!1}*getKeyIterator(u){if(this._array.length!==0&&(a=this._search(u),!(a<0||a>=this._array.length)&&this._getKey(this._array[a])===u))do yield this._array[a];while(++a<this._array.length&&this._getKey(this._array[a])===u)}forEachByKey(u,_){if(this._array.length!==0&&(a=this._search(u),!(a<0||a>=this._array.length)&&this._getKey(this._array[a])===u))do _(this._array[a]);while(++a<this._array.length&&this._getKey(this._array[a])===u)}values(){return[...this._array].values()}_search(u){let _=0,l=this._array.length-1;for(;l>=_;){let m=_+l>>1;const g=this._getKey(this._array[m]);if(g>u)l=m-1;else{if(!(g<u)){for(;m>0&&this._getKey(this._array[m-1])===u;)m--;return m}_=m+1}}return _}}},7226:(c,r,a)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.DebouncedIdleTask=r.IdleTaskQueue=r.PriorityTaskQueue=void 0;const u=a(6114);class _{constructor(){this._tasks=[],this._i=0}enqueue(g){this._tasks.push(g),this._start()}flush(){for(;this._i<this._tasks.length;)this._tasks[this._i]()||this._i++;this.clear()}clear(){this._idleCallback&&(this._cancelCallback(this._idleCallback),this._idleCallback=void 0),this._i=0,this._tasks.length=0}_start(){this._idleCallback||(this._idleCallback=this._requestCallback(this._process.bind(this)))}_process(g){this._idleCallback=void 0;let C=0,y=0,h=g.timeRemaining(),f=0;for(;this._i<this._tasks.length;){if(C=Date.now(),this._tasks[this._i]()||this._i++,C=Math.max(1,Date.now()-C),y=Math.max(C,y),f=g.timeRemaining(),1.5*y>f)return h-C<-20&&console.warn(`task queue exceeded allotted deadline by ${Math.abs(Math.round(h-C))}ms`),void this._start();h=f}this.clear()}}class l extends _{_requestCallback(g){return setTimeout((()=>g(this._createDeadline(16))))}_cancelCallback(g){clearTimeout(g)}_createDeadline(g){const C=Date.now()+g;return{timeRemaining:()=>Math.max(0,C-Date.now())}}}r.PriorityTaskQueue=l,r.IdleTaskQueue=!u.isNode&&"requestIdleCallback"in window?class extends _{_requestCallback(m){return requestIdleCallback(m)}_cancelCallback(m){cancelIdleCallback(m)}}:l,r.DebouncedIdleTask=class{constructor(){this._queue=new r.IdleTaskQueue}set(m){this._queue.clear(),this._queue.enqueue(m)}flush(){this._queue.flush()}}},9282:(c,r,a)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.updateWindowsModeWrappedState=void 0;const u=a(643);r.updateWindowsModeWrappedState=function(_){const l=_.buffer.lines.get(_.buffer.ybase+_.buffer.y-1),m=l?.get(_.cols-1),g=_.buffer.lines.get(_.buffer.ybase+_.buffer.y);g&&m&&(g.isWrapped=m[u.CHAR_DATA_CODE_INDEX]!==u.NULL_CELL_CODE&&m[u.CHAR_DATA_CODE_INDEX]!==u.WHITESPACE_CELL_CODE)}},3734:(c,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.ExtendedAttrs=r.AttributeData=void 0;class a{constructor(){this.fg=0,this.bg=0,this.extended=new u}static toColorRGB(l){return[l>>>16&255,l>>>8&255,255&l]}static fromColorRGB(l){return(255&l[0])<<16|(255&l[1])<<8|255&l[2]}clone(){const l=new a;return l.fg=this.fg,l.bg=this.bg,l.extended=this.extended.clone(),l}isInverse(){return 67108864&this.fg}isBold(){return 134217728&this.fg}isUnderline(){return this.hasExtendedAttrs()&&this.extended.underlineStyle!==0?1:268435456&this.fg}isBlink(){return 536870912&this.fg}isInvisible(){return 1073741824&this.fg}isItalic(){return 67108864&this.bg}isDim(){return 134217728&this.bg}isStrikethrough(){return 2147483648&this.fg}isProtected(){return 536870912&this.bg}isOverline(){return 1073741824&this.bg}getFgColorMode(){return 50331648&this.fg}getBgColorMode(){return 50331648&this.bg}isFgRGB(){return(50331648&this.fg)==50331648}isBgRGB(){return(50331648&this.bg)==50331648}isFgPalette(){return(50331648&this.fg)==16777216||(50331648&this.fg)==33554432}isBgPalette(){return(50331648&this.bg)==16777216||(50331648&this.bg)==33554432}isFgDefault(){return(50331648&this.fg)==0}isBgDefault(){return(50331648&this.bg)==0}isAttributeDefault(){return this.fg===0&&this.bg===0}getFgColor(){switch(50331648&this.fg){case 16777216:case 33554432:return 255&this.fg;case 50331648:return 16777215&this.fg;default:return-1}}getBgColor(){switch(50331648&this.bg){case 16777216:case 33554432:return 255&this.bg;case 50331648:return 16777215&this.bg;default:return-1}}hasExtendedAttrs(){return 268435456&this.bg}updateExtended(){this.extended.isEmpty()?this.bg&=-268435457:this.bg|=268435456}getUnderlineColor(){if(268435456&this.bg&&~this.extended.underlineColor)switch(50331648&this.extended.underlineColor){case 16777216:case 33554432:return 255&this.extended.underlineColor;case 50331648:return 16777215&this.extended.underlineColor;default:return this.getFgColor()}return this.getFgColor()}getUnderlineColorMode(){return 268435456&this.bg&&~this.extended.underlineColor?50331648&this.extended.underlineColor:this.getFgColorMode()}isUnderlineColorRGB(){return 268435456&this.bg&&~this.extended.underlineColor?(50331648&this.extended.underlineColor)==50331648:this.isFgRGB()}isUnderlineColorPalette(){return 268435456&this.bg&&~this.extended.underlineColor?(50331648&this.extended.underlineColor)==16777216||(50331648&this.extended.underlineColor)==33554432:this.isFgPalette()}isUnderlineColorDefault(){return 268435456&this.bg&&~this.extended.underlineColor?(50331648&this.extended.underlineColor)==0:this.isFgDefault()}getUnderlineStyle(){return 268435456&this.fg?268435456&this.bg?this.extended.underlineStyle:1:0}getUnderlineVariantOffset(){return this.extended.underlineVariantOffset}}r.AttributeData=a;class u{get ext(){return this._urlId?-469762049&this._ext|this.underlineStyle<<26:this._ext}set ext(l){this._ext=l}get underlineStyle(){return this._urlId?5:(469762048&this._ext)>>26}set underlineStyle(l){this._ext&=-469762049,this._ext|=l<<26&469762048}get underlineColor(){return 67108863&this._ext}set underlineColor(l){this._ext&=-67108864,this._ext|=67108863&l}get urlId(){return this._urlId}set urlId(l){this._urlId=l}get underlineVariantOffset(){const l=(3758096384&this._ext)>>29;return l<0?4294967288^l:l}set underlineVariantOffset(l){this._ext&=536870911,this._ext|=l<<29&3758096384}constructor(l=0,m=0){this._ext=0,this._urlId=0,this._ext=l,this._urlId=m}clone(){return new u(this._ext,this._urlId)}isEmpty(){return this.underlineStyle===0&&this._urlId===0}}r.ExtendedAttrs=u},9092:(c,r,a)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.Buffer=r.MAX_BUFFER_SIZE=void 0;const u=a(6349),_=a(7226),l=a(3734),m=a(8437),g=a(4634),C=a(511),y=a(643),h=a(4863),f=a(7116);r.MAX_BUFFER_SIZE=4294967295,r.Buffer=class{constructor(d,p,v){this._hasScrollback=d,this._optionsService=p,this._bufferService=v,this.ydisp=0,this.ybase=0,this.y=0,this.x=0,this.tabs={},this.savedY=0,this.savedX=0,this.savedCurAttrData=m.DEFAULT_ATTR_DATA.clone(),this.savedCharset=f.DEFAULT_CHARSET,this.markers=[],this._nullCell=C.CellData.fromCharData([0,y.NULL_CELL_CHAR,y.NULL_CELL_WIDTH,y.NULL_CELL_CODE]),this._whitespaceCell=C.CellData.fromCharData([0,y.WHITESPACE_CELL_CHAR,y.WHITESPACE_CELL_WIDTH,y.WHITESPACE_CELL_CODE]),this._isClearing=!1,this._memoryCleanupQueue=new _.IdleTaskQueue,this._memoryCleanupPosition=0,this._cols=this._bufferService.cols,this._rows=this._bufferService.rows,this.lines=new u.CircularList(this._getCorrectBufferLength(this._rows)),this.scrollTop=0,this.scrollBottom=this._rows-1,this.setupTabStops()}getNullCell(d){return d?(this._nullCell.fg=d.fg,this._nullCell.bg=d.bg,this._nullCell.extended=d.extended):(this._nullCell.fg=0,this._nullCell.bg=0,this._nullCell.extended=new l.ExtendedAttrs),this._nullCell}getWhitespaceCell(d){return d?(this._whitespaceCell.fg=d.fg,this._whitespaceCell.bg=d.bg,this._whitespaceCell.extended=d.extended):(this._whitespaceCell.fg=0,this._whitespaceCell.bg=0,this._whitespaceCell.extended=new l.ExtendedAttrs),this._whitespaceCell}getBlankLine(d,p){return new m.BufferLine(this._bufferService.cols,this.getNullCell(d),p)}get hasScrollback(){return this._hasScrollback&&this.lines.maxLength>this._rows}get isCursorInViewport(){const d=this.ybase+this.y-this.ydisp;return d>=0&&d<this._rows}_getCorrectBufferLength(d){if(!this._hasScrollback)return d;const p=d+this._optionsService.rawOptions.scrollback;return p>r.MAX_BUFFER_SIZE?r.MAX_BUFFER_SIZE:p}fillViewportRows(d){if(this.lines.length===0){d===void 0&&(d=m.DEFAULT_ATTR_DATA);let p=this._rows;for(;p--;)this.lines.push(this.getBlankLine(d))}}clear(){this.ydisp=0,this.ybase=0,this.y=0,this.x=0,this.lines=new u.CircularList(this._getCorrectBufferLength(this._rows)),this.scrollTop=0,this.scrollBottom=this._rows-1,this.setupTabStops()}resize(d,p){const v=this.getNullCell(m.DEFAULT_ATTR_DATA);let S=0;const w=this._getCorrectBufferLength(p);if(w>this.lines.maxLength&&(this.lines.maxLength=w),this.lines.length>0){if(this._cols<d)for(let b=0;b<this.lines.length;b++)S+=+this.lines.get(b).resize(d,v);let E=0;if(this._rows<p)for(let b=this._rows;b<p;b++)this.lines.length<p+this.ybase&&(this._optionsService.rawOptions.windowsMode||this._optionsService.rawOptions.windowsPty.backend!==void 0||this._optionsService.rawOptions.windowsPty.buildNumber!==void 0?this.lines.push(new m.BufferLine(d,v)):this.ybase>0&&this.lines.length<=this.ybase+this.y+E+1?(this.ybase--,E++,this.ydisp>0&&this.ydisp--):this.lines.push(new m.BufferLine(d,v)));else for(let b=this._rows;b>p;b--)this.lines.length>p+this.ybase&&(this.lines.length>this.ybase+this.y+1?this.lines.pop():(this.ybase++,this.ydisp++));if(w<this.lines.maxLength){const b=this.lines.length-w;b>0&&(this.lines.trimStart(b),this.ybase=Math.max(this.ybase-b,0),this.ydisp=Math.max(this.ydisp-b,0),this.savedY=Math.max(this.savedY-b,0)),this.lines.maxLength=w}this.x=Math.min(this.x,d-1),this.y=Math.min(this.y,p-1),E&&(this.y+=E),this.savedX=Math.min(this.savedX,d-1),this.scrollTop=0}if(this.scrollBottom=p-1,this._isReflowEnabled&&(this._reflow(d,p),this._cols>d))for(let E=0;E<this.lines.length;E++)S+=+this.lines.get(E).resize(d,v);this._cols=d,this._rows=p,this._memoryCleanupQueue.clear(),S>.1*this.lines.length&&(this._memoryCleanupPosition=0,this._memoryCleanupQueue.enqueue((()=>this._batchedMemoryCleanup())))}_batchedMemoryCleanup(){let d=!0;this._memoryCleanupPosition>=this.lines.length&&(this._memoryCleanupPosition=0,d=!1);let p=0;for(;this._memoryCleanupPosition<this.lines.length;)if(p+=this.lines.get(this._memoryCleanupPosition++).cleanupMemory(),p>100)return!0;return d}get _isReflowEnabled(){const d=this._optionsService.rawOptions.windowsPty;return d&&d.buildNumber?this._hasScrollback&&d.backend==="conpty"&&d.buildNumber>=21376:this._hasScrollback&&!this._optionsService.rawOptions.windowsMode}_reflow(d,p){this._cols!==d&&(d>this._cols?this._reflowLarger(d,p):this._reflowSmaller(d,p))}_reflowLarger(d,p){const v=(0,g.reflowLargerGetLinesToRemove)(this.lines,this._cols,d,this.ybase+this.y,this.getNullCell(m.DEFAULT_ATTR_DATA));if(v.length>0){const S=(0,g.reflowLargerCreateNewLayout)(this.lines,v);(0,g.reflowLargerApplyNewLayout)(this.lines,S.layout),this._reflowLargerAdjustViewport(d,p,S.countRemoved)}}_reflowLargerAdjustViewport(d,p,v){const S=this.getNullCell(m.DEFAULT_ATTR_DATA);let w=v;for(;w-- >0;)this.ybase===0?(this.y>0&&this.y--,this.lines.length<p&&this.lines.push(new m.BufferLine(d,S))):(this.ydisp===this.ybase&&this.ydisp--,this.ybase--);this.savedY=Math.max(this.savedY-v,0)}_reflowSmaller(d,p){const v=this.getNullCell(m.DEFAULT_ATTR_DATA),S=[];let w=0;for(let E=this.lines.length-1;E>=0;E--){let b=this.lines.get(E);if(!b||!b.isWrapped&&b.getTrimmedLength()<=d)continue;const k=[b];for(;b.isWrapped&&E>0;)b=this.lines.get(--E),k.unshift(b);const R=this.ybase+this.y;if(R>=E&&R<E+k.length)continue;const I=k[k.length-1].getTrimmedLength(),P=(0,g.reflowSmallerGetNewLineLengths)(k,this._cols,d),L=P.length-k.length;let z;z=this.ybase===0&&this.y!==this.lines.length-1?Math.max(0,this.y-this.lines.maxLength+L):Math.max(0,this.lines.length-this.lines.maxLength+L);const J=[];for(let N=0;N<L;N++){const H=this.getBlankLine(m.DEFAULT_ATTR_DATA,!0);J.push(H)}J.length>0&&(S.push({start:E+k.length+w,newLines:J}),w+=J.length),k.push(...J);let re=P.length-1,te=P[re];te===0&&(re--,te=P[re]);let ee=k.length-L-1,x=I;for(;ee>=0;){const N=Math.min(x,te);if(k[re]===void 0)break;if(k[re].copyCellsFrom(k[ee],x-N,te-N,N,!0),te-=N,te===0&&(re--,te=P[re]),x-=N,x===0){ee--;const H=Math.max(ee,0);x=(0,g.getWrappedLineTrimmedLength)(k,H,this._cols)}}for(let N=0;N<k.length;N++)P[N]<d&&k[N].setCell(P[N],v);let B=L-z;for(;B-- >0;)this.ybase===0?this.y<p-1?(this.y++,this.lines.pop()):(this.ybase++,this.ydisp++):this.ybase<Math.min(this.lines.maxLength,this.lines.length+w)-p&&(this.ybase===this.ydisp&&this.ydisp++,this.ybase++);this.savedY=Math.min(this.savedY+L,this.ybase+p-1)}if(S.length>0){const E=[],b=[];for(let re=0;re<this.lines.length;re++)b.push(this.lines.get(re));const k=this.lines.length;let R=k-1,I=0,P=S[I];this.lines.length=Math.min(this.lines.maxLength,this.lines.length+w);let L=0;for(let re=Math.min(this.lines.maxLength-1,k+w-1);re>=0;re--)if(P&&P.start>R+L){for(let te=P.newLines.length-1;te>=0;te--)this.lines.set(re--,P.newLines[te]);re++,E.push({index:R+1,amount:P.newLines.length}),L+=P.newLines.length,P=S[++I]}else this.lines.set(re,b[R--]);let z=0;for(let re=E.length-1;re>=0;re--)E[re].index+=z,this.lines.onInsertEmitter.fire(E[re]),z+=E[re].amount;const J=Math.max(0,k+w-this.lines.maxLength);J>0&&this.lines.onTrimEmitter.fire(J)}}translateBufferLineToString(d,p,v=0,S){const w=this.lines.get(d);return w?w.translateToString(p,v,S):""}getWrappedRangeForLine(d){let p=d,v=d;for(;p>0&&this.lines.get(p).isWrapped;)p--;for(;v+1<this.lines.length&&this.lines.get(v+1).isWrapped;)v++;return{first:p,last:v}}setupTabStops(d){for(d!=null?this.tabs[d]||(d=this.prevStop(d)):(this.tabs={},d=0);d<this._cols;d+=this._optionsService.rawOptions.tabStopWidth)this.tabs[d]=!0}prevStop(d){for(d==null&&(d=this.x);!this.tabs[--d]&&d>0;);return d>=this._cols?this._cols-1:d<0?0:d}nextStop(d){for(d==null&&(d=this.x);!this.tabs[++d]&&d<this._cols;);return d>=this._cols?this._cols-1:d<0?0:d}clearMarkers(d){this._isClearing=!0;for(let p=0;p<this.markers.length;p++)this.markers[p].line===d&&(this.markers[p].dispose(),this.markers.splice(p--,1));this._isClearing=!1}clearAllMarkers(){this._isClearing=!0;for(let d=0;d<this.markers.length;d++)this.markers[d].dispose(),this.markers.splice(d--,1);this._isClearing=!1}addMarker(d){const p=new h.Marker(d);return this.markers.push(p),p.register(this.lines.onTrim((v=>{p.line-=v,p.line<0&&p.dispose()}))),p.register(this.lines.onInsert((v=>{p.line>=v.index&&(p.line+=v.amount)}))),p.register(this.lines.onDelete((v=>{p.line>=v.index&&p.line<v.index+v.amount&&p.dispose(),p.line>v.index&&(p.line-=v.amount)}))),p.register(p.onDispose((()=>this._removeMarker(p)))),p}_removeMarker(d){this._isClearing||this.markers.splice(this.markers.indexOf(d),1)}}},8437:(c,r,a)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.BufferLine=r.DEFAULT_ATTR_DATA=void 0;const u=a(3734),_=a(511),l=a(643),m=a(482);r.DEFAULT_ATTR_DATA=Object.freeze(new u.AttributeData);let g=0;class C{constructor(h,f,d=!1){this.isWrapped=d,this._combined={},this._extendedAttrs={},this._data=new Uint32Array(3*h);const p=f||_.CellData.fromCharData([0,l.NULL_CELL_CHAR,l.NULL_CELL_WIDTH,l.NULL_CELL_CODE]);for(let v=0;v<h;++v)this.setCell(v,p);this.length=h}get(h){const f=this._data[3*h+0],d=2097151&f;return[this._data[3*h+1],2097152&f?this._combined[h]:d?(0,m.stringFromCodePoint)(d):"",f>>22,2097152&f?this._combined[h].charCodeAt(this._combined[h].length-1):d]}set(h,f){this._data[3*h+1]=f[l.CHAR_DATA_ATTR_INDEX],f[l.CHAR_DATA_CHAR_INDEX].length>1?(this._combined[h]=f[1],this._data[3*h+0]=2097152|h|f[l.CHAR_DATA_WIDTH_INDEX]<<22):this._data[3*h+0]=f[l.CHAR_DATA_CHAR_INDEX].charCodeAt(0)|f[l.CHAR_DATA_WIDTH_INDEX]<<22}getWidth(h){return this._data[3*h+0]>>22}hasWidth(h){return 12582912&this._data[3*h+0]}getFg(h){return this._data[3*h+1]}getBg(h){return this._data[3*h+2]}hasContent(h){return 4194303&this._data[3*h+0]}getCodePoint(h){const f=this._data[3*h+0];return 2097152&f?this._combined[h].charCodeAt(this._combined[h].length-1):2097151&f}isCombined(h){return 2097152&this._data[3*h+0]}getString(h){const f=this._data[3*h+0];return 2097152&f?this._combined[h]:2097151&f?(0,m.stringFromCodePoint)(2097151&f):""}isProtected(h){return 536870912&this._data[3*h+2]}loadCell(h,f){return g=3*h,f.content=this._data[g+0],f.fg=this._data[g+1],f.bg=this._data[g+2],2097152&f.content&&(f.combinedData=this._combined[h]),268435456&f.bg&&(f.extended=this._extendedAttrs[h]),f}setCell(h,f){2097152&f.content&&(this._combined[h]=f.combinedData),268435456&f.bg&&(this._extendedAttrs[h]=f.extended),this._data[3*h+0]=f.content,this._data[3*h+1]=f.fg,this._data[3*h+2]=f.bg}setCellFromCodepoint(h,f,d,p){268435456&p.bg&&(this._extendedAttrs[h]=p.extended),this._data[3*h+0]=f|d<<22,this._data[3*h+1]=p.fg,this._data[3*h+2]=p.bg}addCodepointToCell(h,f,d){let p=this._data[3*h+0];2097152&p?this._combined[h]+=(0,m.stringFromCodePoint)(f):2097151&p?(this._combined[h]=(0,m.stringFromCodePoint)(2097151&p)+(0,m.stringFromCodePoint)(f),p&=-2097152,p|=2097152):p=f|4194304,d&&(p&=-12582913,p|=d<<22),this._data[3*h+0]=p}insertCells(h,f,d){if((h%=this.length)&&this.getWidth(h-1)===2&&this.setCellFromCodepoint(h-1,0,1,d),f<this.length-h){const p=new _.CellData;for(let v=this.length-h-f-1;v>=0;--v)this.setCell(h+f+v,this.loadCell(h+v,p));for(let v=0;v<f;++v)this.setCell(h+v,d)}else for(let p=h;p<this.length;++p)this.setCell(p,d);this.getWidth(this.length-1)===2&&this.setCellFromCodepoint(this.length-1,0,1,d)}deleteCells(h,f,d){if(h%=this.length,f<this.length-h){const p=new _.CellData;for(let v=0;v<this.length-h-f;++v)this.setCell(h+v,this.loadCell(h+f+v,p));for(let v=this.length-f;v<this.length;++v)this.setCell(v,d)}else for(let p=h;p<this.length;++p)this.setCell(p,d);h&&this.getWidth(h-1)===2&&this.setCellFromCodepoint(h-1,0,1,d),this.getWidth(h)!==0||this.hasContent(h)||this.setCellFromCodepoint(h,0,1,d)}replaceCells(h,f,d,p=!1){if(p)for(h&&this.getWidth(h-1)===2&&!this.isProtected(h-1)&&this.setCellFromCodepoint(h-1,0,1,d),f<this.length&&this.getWidth(f-1)===2&&!this.isProtected(f)&&this.setCellFromCodepoint(f,0,1,d);h<f&&h<this.length;)this.isProtected(h)||this.setCell(h,d),h++;else for(h&&this.getWidth(h-1)===2&&this.setCellFromCodepoint(h-1,0,1,d),f<this.length&&this.getWidth(f-1)===2&&this.setCellFromCodepoint(f,0,1,d);h<f&&h<this.length;)this.setCell(h++,d)}resize(h,f){if(h===this.length)return 4*this._data.length*2<this._data.buffer.byteLength;const d=3*h;if(h>this.length){if(this._data.buffer.byteLength>=4*d)this._data=new Uint32Array(this._data.buffer,0,d);else{const p=new Uint32Array(d);p.set(this._data),this._data=p}for(let p=this.length;p<h;++p)this.setCell(p,f)}else{this._data=this._data.subarray(0,d);const p=Object.keys(this._combined);for(let S=0;S<p.length;S++){const w=parseInt(p[S],10);w>=h&&delete this._combined[w]}const v=Object.keys(this._extendedAttrs);for(let S=0;S<v.length;S++){const w=parseInt(v[S],10);w>=h&&delete this._extendedAttrs[w]}}return this.length=h,4*d*2<this._data.buffer.byteLength}cleanupMemory(){if(4*this._data.length*2<this._data.buffer.byteLength){const h=new Uint32Array(this._data.length);return h.set(this._data),this._data=h,1}return 0}fill(h,f=!1){if(f)for(let d=0;d<this.length;++d)this.isProtected(d)||this.setCell(d,h);else{this._combined={},this._extendedAttrs={};for(let d=0;d<this.length;++d)this.setCell(d,h)}}copyFrom(h){this.length!==h.length?this._data=new Uint32Array(h._data):this._data.set(h._data),this.length=h.length,this._combined={};for(const f in h._combined)this._combined[f]=h._combined[f];this._extendedAttrs={};for(const f in h._extendedAttrs)this._extendedAttrs[f]=h._extendedAttrs[f];this.isWrapped=h.isWrapped}clone(){const h=new C(0);h._data=new Uint32Array(this._data),h.length=this.length;for(const f in this._combined)h._combined[f]=this._combined[f];for(const f in this._extendedAttrs)h._extendedAttrs[f]=this._extendedAttrs[f];return h.isWrapped=this.isWrapped,h}getTrimmedLength(){for(let h=this.length-1;h>=0;--h)if(4194303&this._data[3*h+0])return h+(this._data[3*h+0]>>22);return 0}getNoBgTrimmedLength(){for(let h=this.length-1;h>=0;--h)if(4194303&this._data[3*h+0]||50331648&this._data[3*h+2])return h+(this._data[3*h+0]>>22);return 0}copyCellsFrom(h,f,d,p,v){const S=h._data;if(v)for(let E=p-1;E>=0;E--){for(let b=0;b<3;b++)this._data[3*(d+E)+b]=S[3*(f+E)+b];268435456&S[3*(f+E)+2]&&(this._extendedAttrs[d+E]=h._extendedAttrs[f+E])}else for(let E=0;E<p;E++){for(let b=0;b<3;b++)this._data[3*(d+E)+b]=S[3*(f+E)+b];268435456&S[3*(f+E)+2]&&(this._extendedAttrs[d+E]=h._extendedAttrs[f+E])}const w=Object.keys(h._combined);for(let E=0;E<w.length;E++){const b=parseInt(w[E],10);b>=f&&(this._combined[b-f+d]=h._combined[b])}}translateToString(h,f,d,p){f=f??0,d=d??this.length,h&&(d=Math.min(d,this.getTrimmedLength())),p&&(p.length=0);let v="";for(;f<d;){const S=this._data[3*f+0],w=2097151&S,E=2097152&S?this._combined[f]:w?(0,m.stringFromCodePoint)(w):l.WHITESPACE_CELL_CHAR;if(v+=E,p)for(let b=0;b<E.length;++b)p.push(f);f+=S>>22||1}return p&&p.push(f),v}}r.BufferLine=C},4841:(c,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.getRangeLength=void 0,r.getRangeLength=function(a,u){if(a.start.y>a.end.y)throw new Error(`Buffer range end (${a.end.x}, ${a.end.y}) cannot be before start (${a.start.x}, ${a.start.y})`);return u*(a.end.y-a.start.y)+(a.end.x-a.start.x+1)}},4634:(c,r)=>{function a(u,_,l){if(_===u.length-1)return u[_].getTrimmedLength();const m=!u[_].hasContent(l-1)&&u[_].getWidth(l-1)===1,g=u[_+1].getWidth(0)===2;return m&&g?l-1:l}Object.defineProperty(r,"__esModule",{value:!0}),r.getWrappedLineTrimmedLength=r.reflowSmallerGetNewLineLengths=r.reflowLargerApplyNewLayout=r.reflowLargerCreateNewLayout=r.reflowLargerGetLinesToRemove=void 0,r.reflowLargerGetLinesToRemove=function(u,_,l,m,g){const C=[];for(let y=0;y<u.length-1;y++){let h=y,f=u.get(++h);if(!f.isWrapped)continue;const d=[u.get(y)];for(;h<u.length&&f.isWrapped;)d.push(f),f=u.get(++h);if(m>=y&&m<h){y+=d.length-1;continue}let p=0,v=a(d,p,_),S=1,w=0;for(;S<d.length;){const b=a(d,S,_),k=b-w,R=l-v,I=Math.min(k,R);d[p].copyCellsFrom(d[S],w,v,I,!1),v+=I,v===l&&(p++,v=0),w+=I,w===b&&(S++,w=0),v===0&&p!==0&&d[p-1].getWidth(l-1)===2&&(d[p].copyCellsFrom(d[p-1],l-1,v++,1,!1),d[p-1].setCell(l-1,g))}d[p].replaceCells(v,l,g);let E=0;for(let b=d.length-1;b>0&&(b>p||d[b].getTrimmedLength()===0);b--)E++;E>0&&(C.push(y+d.length-E),C.push(E)),y+=d.length-1}return C},r.reflowLargerCreateNewLayout=function(u,_){const l=[];let m=0,g=_[m],C=0;for(let y=0;y<u.length;y++)if(g===y){const h=_[++m];u.onDeleteEmitter.fire({index:y-C,amount:h}),y+=h-1,C+=h,g=_[++m]}else l.push(y);return{layout:l,countRemoved:C}},r.reflowLargerApplyNewLayout=function(u,_){const l=[];for(let m=0;m<_.length;m++)l.push(u.get(_[m]));for(let m=0;m<l.length;m++)u.set(m,l[m]);u.length=_.length},r.reflowSmallerGetNewLineLengths=function(u,_,l){const m=[],g=u.map(((f,d)=>a(u,d,_))).reduce(((f,d)=>f+d));let C=0,y=0,h=0;for(;h<g;){if(g-h<l){m.push(g-h);break}C+=l;const f=a(u,y,_);C>f&&(C-=f,y++);const d=u[y].getWidth(C-1)===2;d&&C--;const p=d?l-1:l;m.push(p),h+=p}return m},r.getWrappedLineTrimmedLength=a},5295:(c,r,a)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.BufferSet=void 0;const u=a(8460),_=a(844),l=a(9092);class m extends _.Disposable{constructor(C,y){super(),this._optionsService=C,this._bufferService=y,this._onBufferActivate=this.register(new u.EventEmitter),this.onBufferActivate=this._onBufferActivate.event,this.reset(),this.register(this._optionsService.onSpecificOptionChange("scrollback",(()=>this.resize(this._bufferService.cols,this._bufferService.rows)))),this.register(this._optionsService.onSpecificOptionChange("tabStopWidth",(()=>this.setupTabStops())))}reset(){this._normal=new l.Buffer(!0,this._optionsService,this._bufferService),this._normal.fillViewportRows(),this._alt=new l.Buffer(!1,this._optionsService,this._bufferService),this._activeBuffer=this._normal,this._onBufferActivate.fire({activeBuffer:this._normal,inactiveBuffer:this._alt}),this.setupTabStops()}get alt(){return this._alt}get active(){return this._activeBuffer}get normal(){return this._normal}activateNormalBuffer(){this._activeBuffer!==this._normal&&(this._normal.x=this._alt.x,this._normal.y=this._alt.y,this._alt.clearAllMarkers(),this._alt.clear(),this._activeBuffer=this._normal,this._onBufferActivate.fire({activeBuffer:this._normal,inactiveBuffer:this._alt}))}activateAltBuffer(C){this._activeBuffer!==this._alt&&(this._alt.fillViewportRows(C),this._alt.x=this._normal.x,this._alt.y=this._normal.y,this._activeBuffer=this._alt,this._onBufferActivate.fire({activeBuffer:this._alt,inactiveBuffer:this._normal}))}resize(C,y){this._normal.resize(C,y),this._alt.resize(C,y),this.setupTabStops(C)}setupTabStops(C){this._normal.setupTabStops(C),this._alt.setupTabStops(C)}}r.BufferSet=m},511:(c,r,a)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.CellData=void 0;const u=a(482),_=a(643),l=a(3734);class m extends l.AttributeData{constructor(){super(...arguments),this.content=0,this.fg=0,this.bg=0,this.extended=new l.ExtendedAttrs,this.combinedData=""}static fromCharData(C){const y=new m;return y.setFromCharData(C),y}isCombined(){return 2097152&this.content}getWidth(){return this.content>>22}getChars(){return 2097152&this.content?this.combinedData:2097151&this.content?(0,u.stringFromCodePoint)(2097151&this.content):""}getCode(){return this.isCombined()?this.combinedData.charCodeAt(this.combinedData.length-1):2097151&this.content}setFromCharData(C){this.fg=C[_.CHAR_DATA_ATTR_INDEX],this.bg=0;let y=!1;if(C[_.CHAR_DATA_CHAR_INDEX].length>2)y=!0;else if(C[_.CHAR_DATA_CHAR_INDEX].length===2){const h=C[_.CHAR_DATA_CHAR_INDEX].charCodeAt(0);if(55296<=h&&h<=56319){const f=C[_.CHAR_DATA_CHAR_INDEX].charCodeAt(1);56320<=f&&f<=57343?this.content=1024*(h-55296)+f-56320+65536|C[_.CHAR_DATA_WIDTH_INDEX]<<22:y=!0}else y=!0}else this.content=C[_.CHAR_DATA_CHAR_INDEX].charCodeAt(0)|C[_.CHAR_DATA_WIDTH_INDEX]<<22;y&&(this.combinedData=C[_.CHAR_DATA_CHAR_INDEX],this.content=2097152|C[_.CHAR_DATA_WIDTH_INDEX]<<22)}getAsCharData(){return[this.fg,this.getChars(),this.getWidth(),this.getCode()]}}r.CellData=m},643:(c,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.WHITESPACE_CELL_CODE=r.WHITESPACE_CELL_WIDTH=r.WHITESPACE_CELL_CHAR=r.NULL_CELL_CODE=r.NULL_CELL_WIDTH=r.NULL_CELL_CHAR=r.CHAR_DATA_CODE_INDEX=r.CHAR_DATA_WIDTH_INDEX=r.CHAR_DATA_CHAR_INDEX=r.CHAR_DATA_ATTR_INDEX=r.DEFAULT_EXT=r.DEFAULT_ATTR=r.DEFAULT_COLOR=void 0,r.DEFAULT_COLOR=0,r.DEFAULT_ATTR=256|r.DEFAULT_COLOR<<9,r.DEFAULT_EXT=0,r.CHAR_DATA_ATTR_INDEX=0,r.CHAR_DATA_CHAR_INDEX=1,r.CHAR_DATA_WIDTH_INDEX=2,r.CHAR_DATA_CODE_INDEX=3,r.NULL_CELL_CHAR="",r.NULL_CELL_WIDTH=1,r.NULL_CELL_CODE=0,r.WHITESPACE_CELL_CHAR=" ",r.WHITESPACE_CELL_WIDTH=1,r.WHITESPACE_CELL_CODE=32},4863:(c,r,a)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.Marker=void 0;const u=a(8460),_=a(844);class l{get id(){return this._id}constructor(g){this.line=g,this.isDisposed=!1,this._disposables=[],this._id=l._nextId++,this._onDispose=this.register(new u.EventEmitter),this.onDispose=this._onDispose.event}dispose(){this.isDisposed||(this.isDisposed=!0,this.line=-1,this._onDispose.fire(),(0,_.disposeArray)(this._disposables),this._disposables.length=0)}register(g){return this._disposables.push(g),g}}r.Marker=l,l._nextId=1},7116:(c,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.DEFAULT_CHARSET=r.CHARSETS=void 0,r.CHARSETS={},r.DEFAULT_CHARSET=r.CHARSETS.B,r.CHARSETS[0]={"`":"",a:"",b:"",c:"",d:"",e:"",f:"",g:"",h:"",i:"",j:"",k:"",l:"",m:"",n:"",o:"",p:"",q:"",r:"",s:"",t:"",u:"",v:"",w:"",x:"",y:"",z:"","{":"","|":"","}":"","~":""},r.CHARSETS.A={"#":""},r.CHARSETS.B=void 0,r.CHARSETS[4]={"#":"","@":"","[":"ij","\\":"","]":"|","{":"","|":"f","}":"","~":""},r.CHARSETS.C=r.CHARSETS[5]={"[":"","\\":"","]":"","^":"","`":"","{":"","|":"","}":"","~":""},r.CHARSETS.R={"#":"","@":"","[":"","\\":"","]":"","{":"","|":"","}":"","~":""},r.CHARSETS.Q={"@":"","[":"","\\":"","]":"","^":"","`":"","{":"","|":"","}":"","~":""},r.CHARSETS.K={"@":"","[":"","\\":"","]":"","{":"","|":"","}":"","~":""},r.CHARSETS.Y={"#":"","@":"","[":"","\\":"","]":"","`":"","{":"","|":"","}":"","~":""},r.CHARSETS.E=r.CHARSETS[6]={"@":"","[":"","\\":"","]":"","^":"","`":"","{":"","|":"","}":"","~":""},r.CHARSETS.Z={"#":"","@":"","[":"","\\":"","]":"","{":"","|":"","}":""},r.CHARSETS.H=r.CHARSETS[7]={"@":"","[":"","\\":"","]":"","^":"","`":"","{":"","|":"","}":"","~":""},r.CHARSETS["="]={"#":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":""}},2584:(c,r)=>{var a,u,_;Object.defineProperty(r,"__esModule",{value:!0}),r.C1_ESCAPED=r.C1=r.C0=void 0,(function(l){l.NUL="\0",l.SOH="",l.STX="",l.ETX="",l.EOT="",l.ENQ="",l.ACK="",l.BEL="\x07",l.BS="\b",l.HT="	",l.LF=`
`,l.VT="\v",l.FF="\f",l.CR="\r",l.SO="",l.SI="",l.DLE="",l.DC1="",l.DC2="",l.DC3="",l.DC4="",l.NAK="",l.SYN="",l.ETB="",l.CAN="",l.EM="",l.SUB="",l.ESC="\x1B",l.FS="",l.GS="",l.RS="",l.US="",l.SP=" ",l.DEL=""})(a||(r.C0=a={})),(function(l){l.PAD="",l.HOP="",l.BPH="",l.NBH="",l.IND="",l.NEL="",l.SSA="",l.ESA="",l.HTS="",l.HTJ="",l.VTS="",l.PLD="",l.PLU="",l.RI="",l.SS2="",l.SS3="",l.DCS="",l.PU1="",l.PU2="",l.STS="",l.CCH="",l.MW="",l.SPA="",l.EPA="",l.SOS="",l.SGCI="",l.SCI="",l.CSI="",l.ST="",l.OSC="",l.PM="",l.APC=""})(u||(r.C1=u={})),(function(l){l.ST=`${a.ESC}\\`})(_||(r.C1_ESCAPED=_={}))},7399:(c,r,a)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.evaluateKeyboardEvent=void 0;const u=a(2584),_={48:["0",")"],49:["1","!"],50:["2","@"],51:["3","#"],52:["4","$"],53:["5","%"],54:["6","^"],55:["7","&"],56:["8","*"],57:["9","("],186:[";",":"],187:["=","+"],188:[",","<"],189:["-","_"],190:[".",">"],191:["/","?"],192:["`","~"],219:["[","{"],220:["\\","|"],221:["]","}"],222:["'",'"']};r.evaluateKeyboardEvent=function(l,m,g,C){const y={type:0,cancel:!1,key:void 0},h=(l.shiftKey?1:0)|(l.altKey?2:0)|(l.ctrlKey?4:0)|(l.metaKey?8:0);switch(l.keyCode){case 0:l.key==="UIKeyInputUpArrow"?y.key=m?u.C0.ESC+"OA":u.C0.ESC+"[A":l.key==="UIKeyInputLeftArrow"?y.key=m?u.C0.ESC+"OD":u.C0.ESC+"[D":l.key==="UIKeyInputRightArrow"?y.key=m?u.C0.ESC+"OC":u.C0.ESC+"[C":l.key==="UIKeyInputDownArrow"&&(y.key=m?u.C0.ESC+"OB":u.C0.ESC+"[B");break;case 8:y.key=l.ctrlKey?"\b":u.C0.DEL,l.altKey&&(y.key=u.C0.ESC+y.key);break;case 9:if(l.shiftKey){y.key=u.C0.ESC+"[Z";break}y.key=u.C0.HT,y.cancel=!0;break;case 13:y.key=l.altKey?u.C0.ESC+u.C0.CR:u.C0.CR,y.cancel=!0;break;case 27:y.key=u.C0.ESC,l.altKey&&(y.key=u.C0.ESC+u.C0.ESC),y.cancel=!0;break;case 37:if(l.metaKey)break;h?(y.key=u.C0.ESC+"[1;"+(h+1)+"D",y.key===u.C0.ESC+"[1;3D"&&(y.key=u.C0.ESC+(g?"b":"[1;5D"))):y.key=m?u.C0.ESC+"OD":u.C0.ESC+"[D";break;case 39:if(l.metaKey)break;h?(y.key=u.C0.ESC+"[1;"+(h+1)+"C",y.key===u.C0.ESC+"[1;3C"&&(y.key=u.C0.ESC+(g?"f":"[1;5C"))):y.key=m?u.C0.ESC+"OC":u.C0.ESC+"[C";break;case 38:if(l.metaKey)break;h?(y.key=u.C0.ESC+"[1;"+(h+1)+"A",g||y.key!==u.C0.ESC+"[1;3A"||(y.key=u.C0.ESC+"[1;5A")):y.key=m?u.C0.ESC+"OA":u.C0.ESC+"[A";break;case 40:if(l.metaKey)break;h?(y.key=u.C0.ESC+"[1;"+(h+1)+"B",g||y.key!==u.C0.ESC+"[1;3B"||(y.key=u.C0.ESC+"[1;5B")):y.key=m?u.C0.ESC+"OB":u.C0.ESC+"[B";break;case 45:l.shiftKey||l.ctrlKey||(y.key=u.C0.ESC+"[2~");break;case 46:y.key=h?u.C0.ESC+"[3;"+(h+1)+"~":u.C0.ESC+"[3~";break;case 36:y.key=h?u.C0.ESC+"[1;"+(h+1)+"H":m?u.C0.ESC+"OH":u.C0.ESC+"[H";break;case 35:y.key=h?u.C0.ESC+"[1;"+(h+1)+"F":m?u.C0.ESC+"OF":u.C0.ESC+"[F";break;case 33:l.shiftKey?y.type=2:l.ctrlKey?y.key=u.C0.ESC+"[5;"+(h+1)+"~":y.key=u.C0.ESC+"[5~";break;case 34:l.shiftKey?y.type=3:l.ctrlKey?y.key=u.C0.ESC+"[6;"+(h+1)+"~":y.key=u.C0.ESC+"[6~";break;case 112:y.key=h?u.C0.ESC+"[1;"+(h+1)+"P":u.C0.ESC+"OP";break;case 113:y.key=h?u.C0.ESC+"[1;"+(h+1)+"Q":u.C0.ESC+"OQ";break;case 114:y.key=h?u.C0.ESC+"[1;"+(h+1)+"R":u.C0.ESC+"OR";break;case 115:y.key=h?u.C0.ESC+"[1;"+(h+1)+"S":u.C0.ESC+"OS";break;case 116:y.key=h?u.C0.ESC+"[15;"+(h+1)+"~":u.C0.ESC+"[15~";break;case 117:y.key=h?u.C0.ESC+"[17;"+(h+1)+"~":u.C0.ESC+"[17~";break;case 118:y.key=h?u.C0.ESC+"[18;"+(h+1)+"~":u.C0.ESC+"[18~";break;case 119:y.key=h?u.C0.ESC+"[19;"+(h+1)+"~":u.C0.ESC+"[19~";break;case 120:y.key=h?u.C0.ESC+"[20;"+(h+1)+"~":u.C0.ESC+"[20~";break;case 121:y.key=h?u.C0.ESC+"[21;"+(h+1)+"~":u.C0.ESC+"[21~";break;case 122:y.key=h?u.C0.ESC+"[23;"+(h+1)+"~":u.C0.ESC+"[23~";break;case 123:y.key=h?u.C0.ESC+"[24;"+(h+1)+"~":u.C0.ESC+"[24~";break;default:if(!l.ctrlKey||l.shiftKey||l.altKey||l.metaKey)if(g&&!C||!l.altKey||l.metaKey)!g||l.altKey||l.ctrlKey||l.shiftKey||!l.metaKey?l.key&&!l.ctrlKey&&!l.altKey&&!l.metaKey&&l.keyCode>=48&&l.key.length===1?y.key=l.key:l.key&&l.ctrlKey&&(l.key==="_"&&(y.key=u.C0.US),l.key==="@"&&(y.key=u.C0.NUL)):l.keyCode===65&&(y.type=1);else{const f=_[l.keyCode],d=f?.[l.shiftKey?1:0];if(d)y.key=u.C0.ESC+d;else if(l.keyCode>=65&&l.keyCode<=90){const p=l.ctrlKey?l.keyCode-64:l.keyCode+32;let v=String.fromCharCode(p);l.shiftKey&&(v=v.toUpperCase()),y.key=u.C0.ESC+v}else if(l.keyCode===32)y.key=u.C0.ESC+(l.ctrlKey?u.C0.NUL:" ");else if(l.key==="Dead"&&l.code.startsWith("Key")){let p=l.code.slice(3,4);l.shiftKey||(p=p.toLowerCase()),y.key=u.C0.ESC+p,y.cancel=!0}}else l.keyCode>=65&&l.keyCode<=90?y.key=String.fromCharCode(l.keyCode-64):l.keyCode===32?y.key=u.C0.NUL:l.keyCode>=51&&l.keyCode<=55?y.key=String.fromCharCode(l.keyCode-51+27):l.keyCode===56?y.key=u.C0.DEL:l.keyCode===219?y.key=u.C0.ESC:l.keyCode===220?y.key=u.C0.FS:l.keyCode===221&&(y.key=u.C0.GS)}return y}},482:(c,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.Utf8ToUtf32=r.StringToUtf32=r.utf32ToString=r.stringFromCodePoint=void 0,r.stringFromCodePoint=function(a){return a>65535?(a-=65536,String.fromCharCode(55296+(a>>10))+String.fromCharCode(a%1024+56320)):String.fromCharCode(a)},r.utf32ToString=function(a,u=0,_=a.length){let l="";for(let m=u;m<_;++m){let g=a[m];g>65535?(g-=65536,l+=String.fromCharCode(55296+(g>>10))+String.fromCharCode(g%1024+56320)):l+=String.fromCharCode(g)}return l},r.StringToUtf32=class{constructor(){this._interim=0}clear(){this._interim=0}decode(a,u){const _=a.length;if(!_)return 0;let l=0,m=0;if(this._interim){const g=a.charCodeAt(m++);56320<=g&&g<=57343?u[l++]=1024*(this._interim-55296)+g-56320+65536:(u[l++]=this._interim,u[l++]=g),this._interim=0}for(let g=m;g<_;++g){const C=a.charCodeAt(g);if(55296<=C&&C<=56319){if(++g>=_)return this._interim=C,l;const y=a.charCodeAt(g);56320<=y&&y<=57343?u[l++]=1024*(C-55296)+y-56320+65536:(u[l++]=C,u[l++]=y)}else C!==65279&&(u[l++]=C)}return l}},r.Utf8ToUtf32=class{constructor(){this.interim=new Uint8Array(3)}clear(){this.interim.fill(0)}decode(a,u){const _=a.length;if(!_)return 0;let l,m,g,C,y=0,h=0,f=0;if(this.interim[0]){let v=!1,S=this.interim[0];S&=(224&S)==192?31:(240&S)==224?15:7;let w,E=0;for(;(w=63&this.interim[++E])&&E<4;)S<<=6,S|=w;const b=(224&this.interim[0])==192?2:(240&this.interim[0])==224?3:4,k=b-E;for(;f<k;){if(f>=_)return 0;if(w=a[f++],(192&w)!=128){f--,v=!0;break}this.interim[E++]=w,S<<=6,S|=63&w}v||(b===2?S<128?f--:u[y++]=S:b===3?S<2048||S>=55296&&S<=57343||S===65279||(u[y++]=S):S<65536||S>1114111||(u[y++]=S)),this.interim.fill(0)}const d=_-4;let p=f;for(;p<_;){for(;!(!(p<d)||128&(l=a[p])||128&(m=a[p+1])||128&(g=a[p+2])||128&(C=a[p+3]));)u[y++]=l,u[y++]=m,u[y++]=g,u[y++]=C,p+=4;if(l=a[p++],l<128)u[y++]=l;else if((224&l)==192){if(p>=_)return this.interim[0]=l,y;if(m=a[p++],(192&m)!=128){p--;continue}if(h=(31&l)<<6|63&m,h<128){p--;continue}u[y++]=h}else if((240&l)==224){if(p>=_)return this.interim[0]=l,y;if(m=a[p++],(192&m)!=128){p--;continue}if(p>=_)return this.interim[0]=l,this.interim[1]=m,y;if(g=a[p++],(192&g)!=128){p--;continue}if(h=(15&l)<<12|(63&m)<<6|63&g,h<2048||h>=55296&&h<=57343||h===65279)continue;u[y++]=h}else if((248&l)==240){if(p>=_)return this.interim[0]=l,y;if(m=a[p++],(192&m)!=128){p--;continue}if(p>=_)return this.interim[0]=l,this.interim[1]=m,y;if(g=a[p++],(192&g)!=128){p--;continue}if(p>=_)return this.interim[0]=l,this.interim[1]=m,this.interim[2]=g,y;if(C=a[p++],(192&C)!=128){p--;continue}if(h=(7&l)<<18|(63&m)<<12|(63&g)<<6|63&C,h<65536||h>1114111)continue;u[y++]=h}}return y}}},225:(c,r,a)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.UnicodeV6=void 0;const u=a(1480),_=[[768,879],[1155,1158],[1160,1161],[1425,1469],[1471,1471],[1473,1474],[1476,1477],[1479,1479],[1536,1539],[1552,1557],[1611,1630],[1648,1648],[1750,1764],[1767,1768],[1770,1773],[1807,1807],[1809,1809],[1840,1866],[1958,1968],[2027,2035],[2305,2306],[2364,2364],[2369,2376],[2381,2381],[2385,2388],[2402,2403],[2433,2433],[2492,2492],[2497,2500],[2509,2509],[2530,2531],[2561,2562],[2620,2620],[2625,2626],[2631,2632],[2635,2637],[2672,2673],[2689,2690],[2748,2748],[2753,2757],[2759,2760],[2765,2765],[2786,2787],[2817,2817],[2876,2876],[2879,2879],[2881,2883],[2893,2893],[2902,2902],[2946,2946],[3008,3008],[3021,3021],[3134,3136],[3142,3144],[3146,3149],[3157,3158],[3260,3260],[3263,3263],[3270,3270],[3276,3277],[3298,3299],[3393,3395],[3405,3405],[3530,3530],[3538,3540],[3542,3542],[3633,3633],[3636,3642],[3655,3662],[3761,3761],[3764,3769],[3771,3772],[3784,3789],[3864,3865],[3893,3893],[3895,3895],[3897,3897],[3953,3966],[3968,3972],[3974,3975],[3984,3991],[3993,4028],[4038,4038],[4141,4144],[4146,4146],[4150,4151],[4153,4153],[4184,4185],[4448,4607],[4959,4959],[5906,5908],[5938,5940],[5970,5971],[6002,6003],[6068,6069],[6071,6077],[6086,6086],[6089,6099],[6109,6109],[6155,6157],[6313,6313],[6432,6434],[6439,6440],[6450,6450],[6457,6459],[6679,6680],[6912,6915],[6964,6964],[6966,6970],[6972,6972],[6978,6978],[7019,7027],[7616,7626],[7678,7679],[8203,8207],[8234,8238],[8288,8291],[8298,8303],[8400,8431],[12330,12335],[12441,12442],[43014,43014],[43019,43019],[43045,43046],[64286,64286],[65024,65039],[65056,65059],[65279,65279],[65529,65531]],l=[[68097,68099],[68101,68102],[68108,68111],[68152,68154],[68159,68159],[119143,119145],[119155,119170],[119173,119179],[119210,119213],[119362,119364],[917505,917505],[917536,917631],[917760,917999]];let m;r.UnicodeV6=class{constructor(){if(this.version="6",!m){m=new Uint8Array(65536),m.fill(1),m[0]=0,m.fill(0,1,32),m.fill(0,127,160),m.fill(2,4352,4448),m[9001]=2,m[9002]=2,m.fill(2,11904,42192),m[12351]=1,m.fill(2,44032,55204),m.fill(2,63744,64256),m.fill(2,65040,65050),m.fill(2,65072,65136),m.fill(2,65280,65377),m.fill(2,65504,65511);for(let g=0;g<_.length;++g)m.fill(0,_[g][0],_[g][1]+1)}}wcwidth(g){return g<32?0:g<127?1:g<65536?m[g]:(function(C,y){let h,f=0,d=y.length-1;if(C<y[0][0]||C>y[d][1])return!1;for(;d>=f;)if(h=f+d>>1,C>y[h][1])f=h+1;else{if(!(C<y[h][0]))return!0;d=h-1}return!1})(g,l)?0:g>=131072&&g<=196605||g>=196608&&g<=262141?2:1}charProperties(g,C){let y=this.wcwidth(g),h=y===0&&C!==0;if(h){const f=u.UnicodeService.extractWidth(C);f===0?h=!1:f>y&&(y=f)}return u.UnicodeService.createPropertyValue(0,y,h)}}},5981:(c,r,a)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.WriteBuffer=void 0;const u=a(8460),_=a(844);class l extends _.Disposable{constructor(g){super(),this._action=g,this._writeBuffer=[],this._callbacks=[],this._pendingData=0,this._bufferOffset=0,this._isSyncWriting=!1,this._syncCalls=0,this._didUserInput=!1,this._onWriteParsed=this.register(new u.EventEmitter),this.onWriteParsed=this._onWriteParsed.event}handleUserInput(){this._didUserInput=!0}writeSync(g,C){if(C!==void 0&&this._syncCalls>C)return void(this._syncCalls=0);if(this._pendingData+=g.length,this._writeBuffer.push(g),this._callbacks.push(void 0),this._syncCalls++,this._isSyncWriting)return;let y;for(this._isSyncWriting=!0;y=this._writeBuffer.shift();){this._action(y);const h=this._callbacks.shift();h&&h()}this._pendingData=0,this._bufferOffset=2147483647,this._isSyncWriting=!1,this._syncCalls=0}write(g,C){if(this._pendingData>5e7)throw new Error("write data discarded, use flow control to avoid losing data");if(!this._writeBuffer.length){if(this._bufferOffset=0,this._didUserInput)return this._didUserInput=!1,this._pendingData+=g.length,this._writeBuffer.push(g),this._callbacks.push(C),void this._innerWrite();setTimeout((()=>this._innerWrite()))}this._pendingData+=g.length,this._writeBuffer.push(g),this._callbacks.push(C)}_innerWrite(g=0,C=!0){const y=g||Date.now();for(;this._writeBuffer.length>this._bufferOffset;){const h=this._writeBuffer[this._bufferOffset],f=this._action(h,C);if(f){const p=v=>Date.now()-y>=12?setTimeout((()=>this._innerWrite(0,v))):this._innerWrite(y,v);return void f.catch((v=>(queueMicrotask((()=>{throw v})),Promise.resolve(!1)))).then(p)}const d=this._callbacks[this._bufferOffset];if(d&&d(),this._bufferOffset++,this._pendingData-=h.length,Date.now()-y>=12)break}this._writeBuffer.length>this._bufferOffset?(this._bufferOffset>50&&(this._writeBuffer=this._writeBuffer.slice(this._bufferOffset),this._callbacks=this._callbacks.slice(this._bufferOffset),this._bufferOffset=0),setTimeout((()=>this._innerWrite()))):(this._writeBuffer.length=0,this._callbacks.length=0,this._pendingData=0,this._bufferOffset=0),this._onWriteParsed.fire()}}r.WriteBuffer=l},5941:(c,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.toRgbString=r.parseColor=void 0;const a=/^([\da-f])\/([\da-f])\/([\da-f])$|^([\da-f]{2})\/([\da-f]{2})\/([\da-f]{2})$|^([\da-f]{3})\/([\da-f]{3})\/([\da-f]{3})$|^([\da-f]{4})\/([\da-f]{4})\/([\da-f]{4})$/,u=/^[\da-f]+$/;function _(l,m){const g=l.toString(16),C=g.length<2?"0"+g:g;switch(m){case 4:return g[0];case 8:return C;case 12:return(C+C).slice(0,3);default:return C+C}}r.parseColor=function(l){if(!l)return;let m=l.toLowerCase();if(m.indexOf("rgb:")===0){m=m.slice(4);const g=a.exec(m);if(g){const C=g[1]?15:g[4]?255:g[7]?4095:65535;return[Math.round(parseInt(g[1]||g[4]||g[7]||g[10],16)/C*255),Math.round(parseInt(g[2]||g[5]||g[8]||g[11],16)/C*255),Math.round(parseInt(g[3]||g[6]||g[9]||g[12],16)/C*255)]}}else if(m.indexOf("#")===0&&(m=m.slice(1),u.exec(m)&&[3,6,9,12].includes(m.length))){const g=m.length/3,C=[0,0,0];for(let y=0;y<3;++y){const h=parseInt(m.slice(g*y,g*y+g),16);C[y]=g===1?h<<4:g===2?h:g===3?h>>4:h>>8}return C}},r.toRgbString=function(l,m=16){const[g,C,y]=l;return`rgb:${_(g,m)}/${_(C,m)}/${_(y,m)}`}},5770:(c,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.PAYLOAD_LIMIT=void 0,r.PAYLOAD_LIMIT=1e7},6351:(c,r,a)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.DcsHandler=r.DcsParser=void 0;const u=a(482),_=a(8742),l=a(5770),m=[];r.DcsParser=class{constructor(){this._handlers=Object.create(null),this._active=m,this._ident=0,this._handlerFb=()=>{},this._stack={paused:!1,loopPosition:0,fallThrough:!1}}dispose(){this._handlers=Object.create(null),this._handlerFb=()=>{},this._active=m}registerHandler(C,y){this._handlers[C]===void 0&&(this._handlers[C]=[]);const h=this._handlers[C];return h.push(y),{dispose:()=>{const f=h.indexOf(y);f!==-1&&h.splice(f,1)}}}clearHandler(C){this._handlers[C]&&delete this._handlers[C]}setHandlerFallback(C){this._handlerFb=C}reset(){if(this._active.length)for(let C=this._stack.paused?this._stack.loopPosition-1:this._active.length-1;C>=0;--C)this._active[C].unhook(!1);this._stack.paused=!1,this._active=m,this._ident=0}hook(C,y){if(this.reset(),this._ident=C,this._active=this._handlers[C]||m,this._active.length)for(let h=this._active.length-1;h>=0;h--)this._active[h].hook(y);else this._handlerFb(this._ident,"HOOK",y)}put(C,y,h){if(this._active.length)for(let f=this._active.length-1;f>=0;f--)this._active[f].put(C,y,h);else this._handlerFb(this._ident,"PUT",(0,u.utf32ToString)(C,y,h))}unhook(C,y=!0){if(this._active.length){let h=!1,f=this._active.length-1,d=!1;if(this._stack.paused&&(f=this._stack.loopPosition-1,h=y,d=this._stack.fallThrough,this._stack.paused=!1),!d&&h===!1){for(;f>=0&&(h=this._active[f].unhook(C),h!==!0);f--)if(h instanceof Promise)return this._stack.paused=!0,this._stack.loopPosition=f,this._stack.fallThrough=!1,h;f--}for(;f>=0;f--)if(h=this._active[f].unhook(!1),h instanceof Promise)return this._stack.paused=!0,this._stack.loopPosition=f,this._stack.fallThrough=!0,h}else this._handlerFb(this._ident,"UNHOOK",C);this._active=m,this._ident=0}};const g=new _.Params;g.addParam(0),r.DcsHandler=class{constructor(C){this._handler=C,this._data="",this._params=g,this._hitLimit=!1}hook(C){this._params=C.length>1||C.params[0]?C.clone():g,this._data="",this._hitLimit=!1}put(C,y,h){this._hitLimit||(this._data+=(0,u.utf32ToString)(C,y,h),this._data.length>l.PAYLOAD_LIMIT&&(this._data="",this._hitLimit=!0))}unhook(C){let y=!1;if(this._hitLimit)y=!1;else if(C&&(y=this._handler(this._data,this._params),y instanceof Promise))return y.then((h=>(this._params=g,this._data="",this._hitLimit=!1,h)));return this._params=g,this._data="",this._hitLimit=!1,y}}},2015:(c,r,a)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.EscapeSequenceParser=r.VT500_TRANSITION_TABLE=r.TransitionTable=void 0;const u=a(844),_=a(8742),l=a(6242),m=a(6351);class g{constructor(f){this.table=new Uint8Array(f)}setDefault(f,d){this.table.fill(f<<4|d)}add(f,d,p,v){this.table[d<<8|f]=p<<4|v}addMany(f,d,p,v){for(let S=0;S<f.length;S++)this.table[d<<8|f[S]]=p<<4|v}}r.TransitionTable=g;const C=160;r.VT500_TRANSITION_TABLE=(function(){const h=new g(4095),f=Array.apply(null,Array(256)).map(((E,b)=>b)),d=(E,b)=>f.slice(E,b),p=d(32,127),v=d(0,24);v.push(25),v.push.apply(v,d(28,32));const S=d(0,14);let w;for(w in h.setDefault(1,0),h.addMany(p,0,2,0),S)h.addMany([24,26,153,154],w,3,0),h.addMany(d(128,144),w,3,0),h.addMany(d(144,152),w,3,0),h.add(156,w,0,0),h.add(27,w,11,1),h.add(157,w,4,8),h.addMany([152,158,159],w,0,7),h.add(155,w,11,3),h.add(144,w,11,9);return h.addMany(v,0,3,0),h.addMany(v,1,3,1),h.add(127,1,0,1),h.addMany(v,8,0,8),h.addMany(v,3,3,3),h.add(127,3,0,3),h.addMany(v,4,3,4),h.add(127,4,0,4),h.addMany(v,6,3,6),h.addMany(v,5,3,5),h.add(127,5,0,5),h.addMany(v,2,3,2),h.add(127,2,0,2),h.add(93,1,4,8),h.addMany(p,8,5,8),h.add(127,8,5,8),h.addMany([156,27,24,26,7],8,6,0),h.addMany(d(28,32),8,0,8),h.addMany([88,94,95],1,0,7),h.addMany(p,7,0,7),h.addMany(v,7,0,7),h.add(156,7,0,0),h.add(127,7,0,7),h.add(91,1,11,3),h.addMany(d(64,127),3,7,0),h.addMany(d(48,60),3,8,4),h.addMany([60,61,62,63],3,9,4),h.addMany(d(48,60),4,8,4),h.addMany(d(64,127),4,7,0),h.addMany([60,61,62,63],4,0,6),h.addMany(d(32,64),6,0,6),h.add(127,6,0,6),h.addMany(d(64,127),6,0,0),h.addMany(d(32,48),3,9,5),h.addMany(d(32,48),5,9,5),h.addMany(d(48,64),5,0,6),h.addMany(d(64,127),5,7,0),h.addMany(d(32,48),4,9,5),h.addMany(d(32,48),1,9,2),h.addMany(d(32,48),2,9,2),h.addMany(d(48,127),2,10,0),h.addMany(d(48,80),1,10,0),h.addMany(d(81,88),1,10,0),h.addMany([89,90,92],1,10,0),h.addMany(d(96,127),1,10,0),h.add(80,1,11,9),h.addMany(v,9,0,9),h.add(127,9,0,9),h.addMany(d(28,32),9,0,9),h.addMany(d(32,48),9,9,12),h.addMany(d(48,60),9,8,10),h.addMany([60,61,62,63],9,9,10),h.addMany(v,11,0,11),h.addMany(d(32,128),11,0,11),h.addMany(d(28,32),11,0,11),h.addMany(v,10,0,10),h.add(127,10,0,10),h.addMany(d(28,32),10,0,10),h.addMany(d(48,60),10,8,10),h.addMany([60,61,62,63],10,0,11),h.addMany(d(32,48),10,9,12),h.addMany(v,12,0,12),h.add(127,12,0,12),h.addMany(d(28,32),12,0,12),h.addMany(d(32,48),12,9,12),h.addMany(d(48,64),12,0,11),h.addMany(d(64,127),12,12,13),h.addMany(d(64,127),10,12,13),h.addMany(d(64,127),9,12,13),h.addMany(v,13,13,13),h.addMany(p,13,13,13),h.add(127,13,0,13),h.addMany([27,156,24,26],13,14,0),h.add(C,0,2,0),h.add(C,8,5,8),h.add(C,6,0,6),h.add(C,11,0,11),h.add(C,13,13,13),h})();class y extends u.Disposable{constructor(f=r.VT500_TRANSITION_TABLE){super(),this._transitions=f,this._parseStack={state:0,handlers:[],handlerPos:0,transition:0,chunkPos:0},this.initialState=0,this.currentState=this.initialState,this._params=new _.Params,this._params.addParam(0),this._collect=0,this.precedingJoinState=0,this._printHandlerFb=(d,p,v)=>{},this._executeHandlerFb=d=>{},this._csiHandlerFb=(d,p)=>{},this._escHandlerFb=d=>{},this._errorHandlerFb=d=>d,this._printHandler=this._printHandlerFb,this._executeHandlers=Object.create(null),this._csiHandlers=Object.create(null),this._escHandlers=Object.create(null),this.register((0,u.toDisposable)((()=>{this._csiHandlers=Object.create(null),this._executeHandlers=Object.create(null),this._escHandlers=Object.create(null)}))),this._oscParser=this.register(new l.OscParser),this._dcsParser=this.register(new m.DcsParser),this._errorHandler=this._errorHandlerFb,this.registerEscHandler({final:"\\"},(()=>!0))}_identifier(f,d=[64,126]){let p=0;if(f.prefix){if(f.prefix.length>1)throw new Error("only one byte as prefix supported");if(p=f.prefix.charCodeAt(0),p&&60>p||p>63)throw new Error("prefix must be in range 0x3c .. 0x3f")}if(f.intermediates){if(f.intermediates.length>2)throw new Error("only two bytes as intermediates are supported");for(let S=0;S<f.intermediates.length;++S){const w=f.intermediates.charCodeAt(S);if(32>w||w>47)throw new Error("intermediate must be in range 0x20 .. 0x2f");p<<=8,p|=w}}if(f.final.length!==1)throw new Error("final must be a single byte");const v=f.final.charCodeAt(0);if(d[0]>v||v>d[1])throw new Error(`final must be in range ${d[0]} .. ${d[1]}`);return p<<=8,p|=v,p}identToString(f){const d=[];for(;f;)d.push(String.fromCharCode(255&f)),f>>=8;return d.reverse().join("")}setPrintHandler(f){this._printHandler=f}clearPrintHandler(){this._printHandler=this._printHandlerFb}registerEscHandler(f,d){const p=this._identifier(f,[48,126]);this._escHandlers[p]===void 0&&(this._escHandlers[p]=[]);const v=this._escHandlers[p];return v.push(d),{dispose:()=>{const S=v.indexOf(d);S!==-1&&v.splice(S,1)}}}clearEscHandler(f){this._escHandlers[this._identifier(f,[48,126])]&&delete this._escHandlers[this._identifier(f,[48,126])]}setEscHandlerFallback(f){this._escHandlerFb=f}setExecuteHandler(f,d){this._executeHandlers[f.charCodeAt(0)]=d}clearExecuteHandler(f){this._executeHandlers[f.charCodeAt(0)]&&delete this._executeHandlers[f.charCodeAt(0)]}setExecuteHandlerFallback(f){this._executeHandlerFb=f}registerCsiHandler(f,d){const p=this._identifier(f);this._csiHandlers[p]===void 0&&(this._csiHandlers[p]=[]);const v=this._csiHandlers[p];return v.push(d),{dispose:()=>{const S=v.indexOf(d);S!==-1&&v.splice(S,1)}}}clearCsiHandler(f){this._csiHandlers[this._identifier(f)]&&delete this._csiHandlers[this._identifier(f)]}setCsiHandlerFallback(f){this._csiHandlerFb=f}registerDcsHandler(f,d){return this._dcsParser.registerHandler(this._identifier(f),d)}clearDcsHandler(f){this._dcsParser.clearHandler(this._identifier(f))}setDcsHandlerFallback(f){this._dcsParser.setHandlerFallback(f)}registerOscHandler(f,d){return this._oscParser.registerHandler(f,d)}clearOscHandler(f){this._oscParser.clearHandler(f)}setOscHandlerFallback(f){this._oscParser.setHandlerFallback(f)}setErrorHandler(f){this._errorHandler=f}clearErrorHandler(){this._errorHandler=this._errorHandlerFb}reset(){this.currentState=this.initialState,this._oscParser.reset(),this._dcsParser.reset(),this._params.reset(),this._params.addParam(0),this._collect=0,this.precedingJoinState=0,this._parseStack.state!==0&&(this._parseStack.state=2,this._parseStack.handlers=[])}_preserveStack(f,d,p,v,S){this._parseStack.state=f,this._parseStack.handlers=d,this._parseStack.handlerPos=p,this._parseStack.transition=v,this._parseStack.chunkPos=S}parse(f,d,p){let v,S=0,w=0,E=0;if(this._parseStack.state)if(this._parseStack.state===2)this._parseStack.state=0,E=this._parseStack.chunkPos+1;else{if(p===void 0||this._parseStack.state===1)throw this._parseStack.state=1,new Error("improper continuation due to previous async handler, giving up parsing");const b=this._parseStack.handlers;let k=this._parseStack.handlerPos-1;switch(this._parseStack.state){case 3:if(p===!1&&k>-1){for(;k>=0&&(v=b[k](this._params),v!==!0);k--)if(v instanceof Promise)return this._parseStack.handlerPos=k,v}this._parseStack.handlers=[];break;case 4:if(p===!1&&k>-1){for(;k>=0&&(v=b[k](),v!==!0);k--)if(v instanceof Promise)return this._parseStack.handlerPos=k,v}this._parseStack.handlers=[];break;case 6:if(S=f[this._parseStack.chunkPos],v=this._dcsParser.unhook(S!==24&&S!==26,p),v)return v;S===27&&(this._parseStack.transition|=1),this._params.reset(),this._params.addParam(0),this._collect=0;break;case 5:if(S=f[this._parseStack.chunkPos],v=this._oscParser.end(S!==24&&S!==26,p),v)return v;S===27&&(this._parseStack.transition|=1),this._params.reset(),this._params.addParam(0),this._collect=0}this._parseStack.state=0,E=this._parseStack.chunkPos+1,this.precedingJoinState=0,this.currentState=15&this._parseStack.transition}for(let b=E;b<d;++b){switch(S=f[b],w=this._transitions.table[this.currentState<<8|(S<160?S:C)],w>>4){case 2:for(let L=b+1;;++L){if(L>=d||(S=f[L])<32||S>126&&S<C){this._printHandler(f,b,L),b=L-1;break}if(++L>=d||(S=f[L])<32||S>126&&S<C){this._printHandler(f,b,L),b=L-1;break}if(++L>=d||(S=f[L])<32||S>126&&S<C){this._printHandler(f,b,L),b=L-1;break}if(++L>=d||(S=f[L])<32||S>126&&S<C){this._printHandler(f,b,L),b=L-1;break}}break;case 3:this._executeHandlers[S]?this._executeHandlers[S]():this._executeHandlerFb(S),this.precedingJoinState=0;break;case 0:break;case 1:if(this._errorHandler({position:b,code:S,currentState:this.currentState,collect:this._collect,params:this._params,abort:!1}).abort)return;break;case 7:const k=this._csiHandlers[this._collect<<8|S];let R=k?k.length-1:-1;for(;R>=0&&(v=k[R](this._params),v!==!0);R--)if(v instanceof Promise)return this._preserveStack(3,k,R,w,b),v;R<0&&this._csiHandlerFb(this._collect<<8|S,this._params),this.precedingJoinState=0;break;case 8:do switch(S){case 59:this._params.addParam(0);break;case 58:this._params.addSubParam(-1);break;default:this._params.addDigit(S-48)}while(++b<d&&(S=f[b])>47&&S<60);b--;break;case 9:this._collect<<=8,this._collect|=S;break;case 10:const I=this._escHandlers[this._collect<<8|S];let P=I?I.length-1:-1;for(;P>=0&&(v=I[P](),v!==!0);P--)if(v instanceof Promise)return this._preserveStack(4,I,P,w,b),v;P<0&&this._escHandlerFb(this._collect<<8|S),this.precedingJoinState=0;break;case 11:this._params.reset(),this._params.addParam(0),this._collect=0;break;case 12:this._dcsParser.hook(this._collect<<8|S,this._params);break;case 13:for(let L=b+1;;++L)if(L>=d||(S=f[L])===24||S===26||S===27||S>127&&S<C){this._dcsParser.put(f,b,L),b=L-1;break}break;case 14:if(v=this._dcsParser.unhook(S!==24&&S!==26),v)return this._preserveStack(6,[],0,w,b),v;S===27&&(w|=1),this._params.reset(),this._params.addParam(0),this._collect=0,this.precedingJoinState=0;break;case 4:this._oscParser.start();break;case 5:for(let L=b+1;;L++)if(L>=d||(S=f[L])<32||S>127&&S<C){this._oscParser.put(f,b,L),b=L-1;break}break;case 6:if(v=this._oscParser.end(S!==24&&S!==26),v)return this._preserveStack(5,[],0,w,b),v;S===27&&(w|=1),this._params.reset(),this._params.addParam(0),this._collect=0,this.precedingJoinState=0}this.currentState=15&w}}}r.EscapeSequenceParser=y},6242:(c,r,a)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.OscHandler=r.OscParser=void 0;const u=a(5770),_=a(482),l=[];r.OscParser=class{constructor(){this._state=0,this._active=l,this._id=-1,this._handlers=Object.create(null),this._handlerFb=()=>{},this._stack={paused:!1,loopPosition:0,fallThrough:!1}}registerHandler(m,g){this._handlers[m]===void 0&&(this._handlers[m]=[]);const C=this._handlers[m];return C.push(g),{dispose:()=>{const y=C.indexOf(g);y!==-1&&C.splice(y,1)}}}clearHandler(m){this._handlers[m]&&delete this._handlers[m]}setHandlerFallback(m){this._handlerFb=m}dispose(){this._handlers=Object.create(null),this._handlerFb=()=>{},this._active=l}reset(){if(this._state===2)for(let m=this._stack.paused?this._stack.loopPosition-1:this._active.length-1;m>=0;--m)this._active[m].end(!1);this._stack.paused=!1,this._active=l,this._id=-1,this._state=0}_start(){if(this._active=this._handlers[this._id]||l,this._active.length)for(let m=this._active.length-1;m>=0;m--)this._active[m].start();else this._handlerFb(this._id,"START")}_put(m,g,C){if(this._active.length)for(let y=this._active.length-1;y>=0;y--)this._active[y].put(m,g,C);else this._handlerFb(this._id,"PUT",(0,_.utf32ToString)(m,g,C))}start(){this.reset(),this._state=1}put(m,g,C){if(this._state!==3){if(this._state===1)for(;g<C;){const y=m[g++];if(y===59){this._state=2,this._start();break}if(y<48||57<y)return void(this._state=3);this._id===-1&&(this._id=0),this._id=10*this._id+y-48}this._state===2&&C-g>0&&this._put(m,g,C)}}end(m,g=!0){if(this._state!==0){if(this._state!==3)if(this._state===1&&this._start(),this._active.length){let C=!1,y=this._active.length-1,h=!1;if(this._stack.paused&&(y=this._stack.loopPosition-1,C=g,h=this._stack.fallThrough,this._stack.paused=!1),!h&&C===!1){for(;y>=0&&(C=this._active[y].end(m),C!==!0);y--)if(C instanceof Promise)return this._stack.paused=!0,this._stack.loopPosition=y,this._stack.fallThrough=!1,C;y--}for(;y>=0;y--)if(C=this._active[y].end(!1),C instanceof Promise)return this._stack.paused=!0,this._stack.loopPosition=y,this._stack.fallThrough=!0,C}else this._handlerFb(this._id,"END",m);this._active=l,this._id=-1,this._state=0}}},r.OscHandler=class{constructor(m){this._handler=m,this._data="",this._hitLimit=!1}start(){this._data="",this._hitLimit=!1}put(m,g,C){this._hitLimit||(this._data+=(0,_.utf32ToString)(m,g,C),this._data.length>u.PAYLOAD_LIMIT&&(this._data="",this._hitLimit=!0))}end(m){let g=!1;if(this._hitLimit)g=!1;else if(m&&(g=this._handler(this._data),g instanceof Promise))return g.then((C=>(this._data="",this._hitLimit=!1,C)));return this._data="",this._hitLimit=!1,g}}},8742:(c,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.Params=void 0;const a=2147483647;class u{static fromArray(l){const m=new u;if(!l.length)return m;for(let g=Array.isArray(l[0])?1:0;g<l.length;++g){const C=l[g];if(Array.isArray(C))for(let y=0;y<C.length;++y)m.addSubParam(C[y]);else m.addParam(C)}return m}constructor(l=32,m=32){if(this.maxLength=l,this.maxSubParamsLength=m,m>256)throw new Error("maxSubParamsLength must not be greater than 256");this.params=new Int32Array(l),this.length=0,this._subParams=new Int32Array(m),this._subParamsLength=0,this._subParamsIdx=new Uint16Array(l),this._rejectDigits=!1,this._rejectSubDigits=!1,this._digitIsSub=!1}clone(){const l=new u(this.maxLength,this.maxSubParamsLength);return l.params.set(this.params),l.length=this.length,l._subParams.set(this._subParams),l._subParamsLength=this._subParamsLength,l._subParamsIdx.set(this._subParamsIdx),l._rejectDigits=this._rejectDigits,l._rejectSubDigits=this._rejectSubDigits,l._digitIsSub=this._digitIsSub,l}toArray(){const l=[];for(let m=0;m<this.length;++m){l.push(this.params[m]);const g=this._subParamsIdx[m]>>8,C=255&this._subParamsIdx[m];C-g>0&&l.push(Array.prototype.slice.call(this._subParams,g,C))}return l}reset(){this.length=0,this._subParamsLength=0,this._rejectDigits=!1,this._rejectSubDigits=!1,this._digitIsSub=!1}addParam(l){if(this._digitIsSub=!1,this.length>=this.maxLength)this._rejectDigits=!0;else{if(l<-1)throw new Error("values lesser than -1 are not allowed");this._subParamsIdx[this.length]=this._subParamsLength<<8|this._subParamsLength,this.params[this.length++]=l>a?a:l}}addSubParam(l){if(this._digitIsSub=!0,this.length)if(this._rejectDigits||this._subParamsLength>=this.maxSubParamsLength)this._rejectSubDigits=!0;else{if(l<-1)throw new Error("values lesser than -1 are not allowed");this._subParams[this._subParamsLength++]=l>a?a:l,this._subParamsIdx[this.length-1]++}}hasSubParams(l){return(255&this._subParamsIdx[l])-(this._subParamsIdx[l]>>8)>0}getSubParams(l){const m=this._subParamsIdx[l]>>8,g=255&this._subParamsIdx[l];return g-m>0?this._subParams.subarray(m,g):null}getSubParamsAll(){const l={};for(let m=0;m<this.length;++m){const g=this._subParamsIdx[m]>>8,C=255&this._subParamsIdx[m];C-g>0&&(l[m]=this._subParams.slice(g,C))}return l}addDigit(l){let m;if(this._rejectDigits||!(m=this._digitIsSub?this._subParamsLength:this.length)||this._digitIsSub&&this._rejectSubDigits)return;const g=this._digitIsSub?this._subParams:this.params,C=g[m-1];g[m-1]=~C?Math.min(10*C+l,a):l}}r.Params=u},5741:(c,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.AddonManager=void 0,r.AddonManager=class{constructor(){this._addons=[]}dispose(){for(let a=this._addons.length-1;a>=0;a--)this._addons[a].instance.dispose()}loadAddon(a,u){const _={instance:u,dispose:u.dispose,isDisposed:!1};this._addons.push(_),u.dispose=()=>this._wrappedAddonDispose(_),u.activate(a)}_wrappedAddonDispose(a){if(a.isDisposed)return;let u=-1;for(let _=0;_<this._addons.length;_++)if(this._addons[_]===a){u=_;break}if(u===-1)throw new Error("Could not dispose an addon that has not been loaded");a.isDisposed=!0,a.dispose.apply(a.instance),this._addons.splice(u,1)}}},8771:(c,r,a)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.BufferApiView=void 0;const u=a(3785),_=a(511);r.BufferApiView=class{constructor(l,m){this._buffer=l,this.type=m}init(l){return this._buffer=l,this}get cursorY(){return this._buffer.y}get cursorX(){return this._buffer.x}get viewportY(){return this._buffer.ydisp}get baseY(){return this._buffer.ybase}get length(){return this._buffer.lines.length}getLine(l){const m=this._buffer.lines.get(l);if(m)return new u.BufferLineApiView(m)}getNullCell(){return new _.CellData}}},3785:(c,r,a)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.BufferLineApiView=void 0;const u=a(511);r.BufferLineApiView=class{constructor(_){this._line=_}get isWrapped(){return this._line.isWrapped}get length(){return this._line.length}getCell(_,l){if(!(_<0||_>=this._line.length))return l?(this._line.loadCell(_,l),l):this._line.loadCell(_,new u.CellData)}translateToString(_,l,m){return this._line.translateToString(_,l,m)}}},8285:(c,r,a)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.BufferNamespaceApi=void 0;const u=a(8771),_=a(8460),l=a(844);class m extends l.Disposable{constructor(C){super(),this._core=C,this._onBufferChange=this.register(new _.EventEmitter),this.onBufferChange=this._onBufferChange.event,this._normal=new u.BufferApiView(this._core.buffers.normal,"normal"),this._alternate=new u.BufferApiView(this._core.buffers.alt,"alternate"),this._core.buffers.onBufferActivate((()=>this._onBufferChange.fire(this.active)))}get active(){if(this._core.buffers.active===this._core.buffers.normal)return this.normal;if(this._core.buffers.active===this._core.buffers.alt)return this.alternate;throw new Error("Active buffer is neither normal nor alternate")}get normal(){return this._normal.init(this._core.buffers.normal)}get alternate(){return this._alternate.init(this._core.buffers.alt)}}r.BufferNamespaceApi=m},7975:(c,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.ParserApi=void 0,r.ParserApi=class{constructor(a){this._core=a}registerCsiHandler(a,u){return this._core.registerCsiHandler(a,(_=>u(_.toArray())))}addCsiHandler(a,u){return this.registerCsiHandler(a,u)}registerDcsHandler(a,u){return this._core.registerDcsHandler(a,((_,l)=>u(_,l.toArray())))}addDcsHandler(a,u){return this.registerDcsHandler(a,u)}registerEscHandler(a,u){return this._core.registerEscHandler(a,u)}addEscHandler(a,u){return this.registerEscHandler(a,u)}registerOscHandler(a,u){return this._core.registerOscHandler(a,u)}addOscHandler(a,u){return this.registerOscHandler(a,u)}}},7090:(c,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.UnicodeApi=void 0,r.UnicodeApi=class{constructor(a){this._core=a}register(a){this._core.unicodeService.register(a)}get versions(){return this._core.unicodeService.versions}get activeVersion(){return this._core.unicodeService.activeVersion}set activeVersion(a){this._core.unicodeService.activeVersion=a}}},744:function(c,r,a){var u=this&&this.__decorate||function(h,f,d,p){var v,S=arguments.length,w=S<3?f:p===null?p=Object.getOwnPropertyDescriptor(f,d):p;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")w=Reflect.decorate(h,f,d,p);else for(var E=h.length-1;E>=0;E--)(v=h[E])&&(w=(S<3?v(w):S>3?v(f,d,w):v(f,d))||w);return S>3&&w&&Object.defineProperty(f,d,w),w},_=this&&this.__param||function(h,f){return function(d,p){f(d,p,h)}};Object.defineProperty(r,"__esModule",{value:!0}),r.BufferService=r.MINIMUM_ROWS=r.MINIMUM_COLS=void 0;const l=a(8460),m=a(844),g=a(5295),C=a(2585);r.MINIMUM_COLS=2,r.MINIMUM_ROWS=1;let y=r.BufferService=class extends m.Disposable{get buffer(){return this.buffers.active}constructor(h){super(),this.isUserScrolling=!1,this._onResize=this.register(new l.EventEmitter),this.onResize=this._onResize.event,this._onScroll=this.register(new l.EventEmitter),this.onScroll=this._onScroll.event,this.cols=Math.max(h.rawOptions.cols||0,r.MINIMUM_COLS),this.rows=Math.max(h.rawOptions.rows||0,r.MINIMUM_ROWS),this.buffers=this.register(new g.BufferSet(h,this))}resize(h,f){this.cols=h,this.rows=f,this.buffers.resize(h,f),this._onResize.fire({cols:h,rows:f})}reset(){this.buffers.reset(),this.isUserScrolling=!1}scroll(h,f=!1){const d=this.buffer;let p;p=this._cachedBlankLine,p&&p.length===this.cols&&p.getFg(0)===h.fg&&p.getBg(0)===h.bg||(p=d.getBlankLine(h,f),this._cachedBlankLine=p),p.isWrapped=f;const v=d.ybase+d.scrollTop,S=d.ybase+d.scrollBottom;if(d.scrollTop===0){const w=d.lines.isFull;S===d.lines.length-1?w?d.lines.recycle().copyFrom(p):d.lines.push(p.clone()):d.lines.splice(S+1,0,p.clone()),w?this.isUserScrolling&&(d.ydisp=Math.max(d.ydisp-1,0)):(d.ybase++,this.isUserScrolling||d.ydisp++)}else{const w=S-v+1;d.lines.shiftElements(v+1,w-1,-1),d.lines.set(S,p.clone())}this.isUserScrolling||(d.ydisp=d.ybase),this._onScroll.fire(d.ydisp)}scrollLines(h,f,d){const p=this.buffer;if(h<0){if(p.ydisp===0)return;this.isUserScrolling=!0}else h+p.ydisp>=p.ybase&&(this.isUserScrolling=!1);const v=p.ydisp;p.ydisp=Math.max(Math.min(p.ydisp+h,p.ybase),0),v!==p.ydisp&&(f||this._onScroll.fire(p.ydisp))}};r.BufferService=y=u([_(0,C.IOptionsService)],y)},7994:(c,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.CharsetService=void 0,r.CharsetService=class{constructor(){this.glevel=0,this._charsets=[]}reset(){this.charset=void 0,this._charsets=[],this.glevel=0}setgLevel(a){this.glevel=a,this.charset=this._charsets[a]}setgCharset(a,u){this._charsets[a]=u,this.glevel===a&&(this.charset=u)}}},1753:function(c,r,a){var u=this&&this.__decorate||function(p,v,S,w){var E,b=arguments.length,k=b<3?v:w===null?w=Object.getOwnPropertyDescriptor(v,S):w;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")k=Reflect.decorate(p,v,S,w);else for(var R=p.length-1;R>=0;R--)(E=p[R])&&(k=(b<3?E(k):b>3?E(v,S,k):E(v,S))||k);return b>3&&k&&Object.defineProperty(v,S,k),k},_=this&&this.__param||function(p,v){return function(S,w){v(S,w,p)}};Object.defineProperty(r,"__esModule",{value:!0}),r.CoreMouseService=void 0;const l=a(2585),m=a(8460),g=a(844),C={NONE:{events:0,restrict:()=>!1},X10:{events:1,restrict:p=>p.button!==4&&p.action===1&&(p.ctrl=!1,p.alt=!1,p.shift=!1,!0)},VT200:{events:19,restrict:p=>p.action!==32},DRAG:{events:23,restrict:p=>p.action!==32||p.button!==3},ANY:{events:31,restrict:p=>!0}};function y(p,v){let S=(p.ctrl?16:0)|(p.shift?4:0)|(p.alt?8:0);return p.button===4?(S|=64,S|=p.action):(S|=3&p.button,4&p.button&&(S|=64),8&p.button&&(S|=128),p.action===32?S|=32:p.action!==0||v||(S|=3)),S}const h=String.fromCharCode,f={DEFAULT:p=>{const v=[y(p,!1)+32,p.col+32,p.row+32];return v[0]>255||v[1]>255||v[2]>255?"":`\x1B[M${h(v[0])}${h(v[1])}${h(v[2])}`},SGR:p=>{const v=p.action===0&&p.button!==4?"m":"M";return`\x1B[<${y(p,!0)};${p.col};${p.row}${v}`},SGR_PIXELS:p=>{const v=p.action===0&&p.button!==4?"m":"M";return`\x1B[<${y(p,!0)};${p.x};${p.y}${v}`}};let d=r.CoreMouseService=class extends g.Disposable{constructor(p,v){super(),this._bufferService=p,this._coreService=v,this._protocols={},this._encodings={},this._activeProtocol="",this._activeEncoding="",this._lastEvent=null,this._onProtocolChange=this.register(new m.EventEmitter),this.onProtocolChange=this._onProtocolChange.event;for(const S of Object.keys(C))this.addProtocol(S,C[S]);for(const S of Object.keys(f))this.addEncoding(S,f[S]);this.reset()}addProtocol(p,v){this._protocols[p]=v}addEncoding(p,v){this._encodings[p]=v}get activeProtocol(){return this._activeProtocol}get areMouseEventsActive(){return this._protocols[this._activeProtocol].events!==0}set activeProtocol(p){if(!this._protocols[p])throw new Error(`unknown protocol "${p}"`);this._activeProtocol=p,this._onProtocolChange.fire(this._protocols[p].events)}get activeEncoding(){return this._activeEncoding}set activeEncoding(p){if(!this._encodings[p])throw new Error(`unknown encoding "${p}"`);this._activeEncoding=p}reset(){this.activeProtocol="NONE",this.activeEncoding="DEFAULT",this._lastEvent=null}triggerMouseEvent(p){if(p.col<0||p.col>=this._bufferService.cols||p.row<0||p.row>=this._bufferService.rows||p.button===4&&p.action===32||p.button===3&&p.action!==32||p.button!==4&&(p.action===2||p.action===3)||(p.col++,p.row++,p.action===32&&this._lastEvent&&this._equalEvents(this._lastEvent,p,this._activeEncoding==="SGR_PIXELS"))||!this._protocols[this._activeProtocol].restrict(p))return!1;const v=this._encodings[this._activeEncoding](p);return v&&(this._activeEncoding==="DEFAULT"?this._coreService.triggerBinaryEvent(v):this._coreService.triggerDataEvent(v,!0)),this._lastEvent=p,!0}explainEvents(p){return{down:!!(1&p),up:!!(2&p),drag:!!(4&p),move:!!(8&p),wheel:!!(16&p)}}_equalEvents(p,v,S){if(S){if(p.x!==v.x||p.y!==v.y)return!1}else if(p.col!==v.col||p.row!==v.row)return!1;return p.button===v.button&&p.action===v.action&&p.ctrl===v.ctrl&&p.alt===v.alt&&p.shift===v.shift}};r.CoreMouseService=d=u([_(0,l.IBufferService),_(1,l.ICoreService)],d)},6975:function(c,r,a){var u=this&&this.__decorate||function(d,p,v,S){var w,E=arguments.length,b=E<3?p:S===null?S=Object.getOwnPropertyDescriptor(p,v):S;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")b=Reflect.decorate(d,p,v,S);else for(var k=d.length-1;k>=0;k--)(w=d[k])&&(b=(E<3?w(b):E>3?w(p,v,b):w(p,v))||b);return E>3&&b&&Object.defineProperty(p,v,b),b},_=this&&this.__param||function(d,p){return function(v,S){p(v,S,d)}};Object.defineProperty(r,"__esModule",{value:!0}),r.CoreService=void 0;const l=a(1439),m=a(8460),g=a(844),C=a(2585),y=Object.freeze({insertMode:!1}),h=Object.freeze({applicationCursorKeys:!1,applicationKeypad:!1,bracketedPasteMode:!1,origin:!1,reverseWraparound:!1,sendFocus:!1,wraparound:!0});let f=r.CoreService=class extends g.Disposable{constructor(d,p,v){super(),this._bufferService=d,this._logService=p,this._optionsService=v,this.isCursorInitialized=!1,this.isCursorHidden=!1,this._onData=this.register(new m.EventEmitter),this.onData=this._onData.event,this._onUserInput=this.register(new m.EventEmitter),this.onUserInput=this._onUserInput.event,this._onBinary=this.register(new m.EventEmitter),this.onBinary=this._onBinary.event,this._onRequestScrollToBottom=this.register(new m.EventEmitter),this.onRequestScrollToBottom=this._onRequestScrollToBottom.event,this.modes=(0,l.clone)(y),this.decPrivateModes=(0,l.clone)(h)}reset(){this.modes=(0,l.clone)(y),this.decPrivateModes=(0,l.clone)(h)}triggerDataEvent(d,p=!1){if(this._optionsService.rawOptions.disableStdin)return;const v=this._bufferService.buffer;p&&this._optionsService.rawOptions.scrollOnUserInput&&v.ybase!==v.ydisp&&this._onRequestScrollToBottom.fire(),p&&this._onUserInput.fire(),this._logService.debug(`sending data "${d}"`,(()=>d.split("").map((S=>S.charCodeAt(0))))),this._onData.fire(d)}triggerBinaryEvent(d){this._optionsService.rawOptions.disableStdin||(this._logService.debug(`sending binary "${d}"`,(()=>d.split("").map((p=>p.charCodeAt(0))))),this._onBinary.fire(d))}};r.CoreService=f=u([_(0,C.IBufferService),_(1,C.ILogService),_(2,C.IOptionsService)],f)},9074:(c,r,a)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.DecorationService=void 0;const u=a(8055),_=a(8460),l=a(844),m=a(6106);let g=0,C=0;class y extends l.Disposable{get decorations(){return this._decorations.values()}constructor(){super(),this._decorations=new m.SortedList((d=>d?.marker.line)),this._onDecorationRegistered=this.register(new _.EventEmitter),this.onDecorationRegistered=this._onDecorationRegistered.event,this._onDecorationRemoved=this.register(new _.EventEmitter),this.onDecorationRemoved=this._onDecorationRemoved.event,this.register((0,l.toDisposable)((()=>this.reset())))}registerDecoration(d){if(d.marker.isDisposed)return;const p=new h(d);if(p){const v=p.marker.onDispose((()=>p.dispose()));p.onDispose((()=>{p&&(this._decorations.delete(p)&&this._onDecorationRemoved.fire(p),v.dispose())})),this._decorations.insert(p),this._onDecorationRegistered.fire(p)}return p}reset(){for(const d of this._decorations.values())d.dispose();this._decorations.clear()}*getDecorationsAtCell(d,p,v){let S=0,w=0;for(const E of this._decorations.getKeyIterator(p))S=E.options.x??0,w=S+(E.options.width??1),d>=S&&d<w&&(!v||(E.options.layer??"bottom")===v)&&(yield E)}forEachDecorationAtCell(d,p,v,S){this._decorations.forEachByKey(p,(w=>{g=w.options.x??0,C=g+(w.options.width??1),d>=g&&d<C&&(!v||(w.options.layer??"bottom")===v)&&S(w)}))}}r.DecorationService=y;class h extends l.Disposable{get isDisposed(){return this._isDisposed}get backgroundColorRGB(){return this._cachedBg===null&&(this.options.backgroundColor?this._cachedBg=u.css.toColor(this.options.backgroundColor):this._cachedBg=void 0),this._cachedBg}get foregroundColorRGB(){return this._cachedFg===null&&(this.options.foregroundColor?this._cachedFg=u.css.toColor(this.options.foregroundColor):this._cachedFg=void 0),this._cachedFg}constructor(d){super(),this.options=d,this.onRenderEmitter=this.register(new _.EventEmitter),this.onRender=this.onRenderEmitter.event,this._onDispose=this.register(new _.EventEmitter),this.onDispose=this._onDispose.event,this._cachedBg=null,this._cachedFg=null,this.marker=d.marker,this.options.overviewRulerOptions&&!this.options.overviewRulerOptions.position&&(this.options.overviewRulerOptions.position="full")}dispose(){this._onDispose.fire(),super.dispose()}}},4348:(c,r,a)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.InstantiationService=r.ServiceCollection=void 0;const u=a(2585),_=a(8343);class l{constructor(...g){this._entries=new Map;for(const[C,y]of g)this.set(C,y)}set(g,C){const y=this._entries.get(g);return this._entries.set(g,C),y}forEach(g){for(const[C,y]of this._entries.entries())g(C,y)}has(g){return this._entries.has(g)}get(g){return this._entries.get(g)}}r.ServiceCollection=l,r.InstantiationService=class{constructor(){this._services=new l,this._services.set(u.IInstantiationService,this)}setService(m,g){this._services.set(m,g)}getService(m){return this._services.get(m)}createInstance(m,...g){const C=(0,_.getServiceDependencies)(m).sort(((f,d)=>f.index-d.index)),y=[];for(const f of C){const d=this._services.get(f.id);if(!d)throw new Error(`[createInstance] ${m.name} depends on UNKNOWN service ${f.id}.`);y.push(d)}const h=C.length>0?C[0].index:g.length;if(g.length!==h)throw new Error(`[createInstance] First service dependency of ${m.name} at position ${h+1} conflicts with ${g.length} static arguments`);return new m(...g,...y)}}},7866:function(c,r,a){var u=this&&this.__decorate||function(h,f,d,p){var v,S=arguments.length,w=S<3?f:p===null?p=Object.getOwnPropertyDescriptor(f,d):p;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")w=Reflect.decorate(h,f,d,p);else for(var E=h.length-1;E>=0;E--)(v=h[E])&&(w=(S<3?v(w):S>3?v(f,d,w):v(f,d))||w);return S>3&&w&&Object.defineProperty(f,d,w),w},_=this&&this.__param||function(h,f){return function(d,p){f(d,p,h)}};Object.defineProperty(r,"__esModule",{value:!0}),r.traceCall=r.setTraceLogger=r.LogService=void 0;const l=a(844),m=a(2585),g={trace:m.LogLevelEnum.TRACE,debug:m.LogLevelEnum.DEBUG,info:m.LogLevelEnum.INFO,warn:m.LogLevelEnum.WARN,error:m.LogLevelEnum.ERROR,off:m.LogLevelEnum.OFF};let C,y=r.LogService=class extends l.Disposable{get logLevel(){return this._logLevel}constructor(h){super(),this._optionsService=h,this._logLevel=m.LogLevelEnum.OFF,this._updateLogLevel(),this.register(this._optionsService.onSpecificOptionChange("logLevel",(()=>this._updateLogLevel()))),C=this}_updateLogLevel(){this._logLevel=g[this._optionsService.rawOptions.logLevel]}_evalLazyOptionalParams(h){for(let f=0;f<h.length;f++)typeof h[f]=="function"&&(h[f]=h[f]())}_log(h,f,d){this._evalLazyOptionalParams(d),h.call(console,(this._optionsService.options.logger?"":"xterm.js: ")+f,...d)}trace(h,...f){this._logLevel<=m.LogLevelEnum.TRACE&&this._log(this._optionsService.options.logger?.trace.bind(this._optionsService.options.logger)??console.log,h,f)}debug(h,...f){this._logLevel<=m.LogLevelEnum.DEBUG&&this._log(this._optionsService.options.logger?.debug.bind(this._optionsService.options.logger)??console.log,h,f)}info(h,...f){this._logLevel<=m.LogLevelEnum.INFO&&this._log(this._optionsService.options.logger?.info.bind(this._optionsService.options.logger)??console.info,h,f)}warn(h,...f){this._logLevel<=m.LogLevelEnum.WARN&&this._log(this._optionsService.options.logger?.warn.bind(this._optionsService.options.logger)??console.warn,h,f)}error(h,...f){this._logLevel<=m.LogLevelEnum.ERROR&&this._log(this._optionsService.options.logger?.error.bind(this._optionsService.options.logger)??console.error,h,f)}};r.LogService=y=u([_(0,m.IOptionsService)],y),r.setTraceLogger=function(h){C=h},r.traceCall=function(h,f,d){if(typeof d.value!="function")throw new Error("not supported");const p=d.value;d.value=function(...v){if(C.logLevel!==m.LogLevelEnum.TRACE)return p.apply(this,v);C.trace(`GlyphRenderer#${p.name}(${v.map((w=>JSON.stringify(w))).join(", ")})`);const S=p.apply(this,v);return C.trace(`GlyphRenderer#${p.name} return`,S),S}}},7302:(c,r,a)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.OptionsService=r.DEFAULT_OPTIONS=void 0;const u=a(8460),_=a(844),l=a(6114);r.DEFAULT_OPTIONS={cols:80,rows:24,cursorBlink:!1,cursorStyle:"block",cursorWidth:1,cursorInactiveStyle:"outline",customGlyphs:!0,drawBoldTextInBrightColors:!0,documentOverride:null,fastScrollModifier:"alt",fastScrollSensitivity:5,fontFamily:"courier-new, courier, monospace",fontSize:15,fontWeight:"normal",fontWeightBold:"bold",ignoreBracketedPasteMode:!1,lineHeight:1,letterSpacing:0,linkHandler:null,logLevel:"info",logger:null,scrollback:1e3,scrollOnUserInput:!0,scrollSensitivity:1,screenReaderMode:!1,smoothScrollDuration:0,macOptionIsMeta:!1,macOptionClickForcesSelection:!1,minimumContrastRatio:1,disableStdin:!1,allowProposedApi:!1,allowTransparency:!1,tabStopWidth:8,theme:{},rescaleOverlappingGlyphs:!1,rightClickSelectsWord:l.isMac,windowOptions:{},windowsMode:!1,windowsPty:{},wordSeparator:" ()[]{}',\"`",altClickMovesCursor:!0,convertEol:!1,termName:"xterm",cancelEvents:!1,overviewRulerWidth:0};const m=["normal","bold","100","200","300","400","500","600","700","800","900"];class g extends _.Disposable{constructor(y){super(),this._onOptionChange=this.register(new u.EventEmitter),this.onOptionChange=this._onOptionChange.event;const h={...r.DEFAULT_OPTIONS};for(const f in y)if(f in h)try{const d=y[f];h[f]=this._sanitizeAndValidateOption(f,d)}catch(d){console.error(d)}this.rawOptions=h,this.options={...h},this._setupOptions(),this.register((0,_.toDisposable)((()=>{this.rawOptions.linkHandler=null,this.rawOptions.documentOverride=null})))}onSpecificOptionChange(y,h){return this.onOptionChange((f=>{f===y&&h(this.rawOptions[y])}))}onMultipleOptionChange(y,h){return this.onOptionChange((f=>{y.indexOf(f)!==-1&&h()}))}_setupOptions(){const y=f=>{if(!(f in r.DEFAULT_OPTIONS))throw new Error(`No option with key "${f}"`);return this.rawOptions[f]},h=(f,d)=>{if(!(f in r.DEFAULT_OPTIONS))throw new Error(`No option with key "${f}"`);d=this._sanitizeAndValidateOption(f,d),this.rawOptions[f]!==d&&(this.rawOptions[f]=d,this._onOptionChange.fire(f))};for(const f in this.rawOptions){const d={get:y.bind(this,f),set:h.bind(this,f)};Object.defineProperty(this.options,f,d)}}_sanitizeAndValidateOption(y,h){switch(y){case"cursorStyle":if(h||(h=r.DEFAULT_OPTIONS[y]),!(function(f){return f==="block"||f==="underline"||f==="bar"})(h))throw new Error(`"${h}" is not a valid value for ${y}`);break;case"wordSeparator":h||(h=r.DEFAULT_OPTIONS[y]);break;case"fontWeight":case"fontWeightBold":if(typeof h=="number"&&1<=h&&h<=1e3)break;h=m.includes(h)?h:r.DEFAULT_OPTIONS[y];break;case"cursorWidth":h=Math.floor(h);case"lineHeight":case"tabStopWidth":if(h<1)throw new Error(`${y} cannot be less than 1, value: ${h}`);break;case"minimumContrastRatio":h=Math.max(1,Math.min(21,Math.round(10*h)/10));break;case"scrollback":if((h=Math.min(h,4294967295))<0)throw new Error(`${y} cannot be less than 0, value: ${h}`);break;case"fastScrollSensitivity":case"scrollSensitivity":if(h<=0)throw new Error(`${y} cannot be less than or equal to 0, value: ${h}`);break;case"rows":case"cols":if(!h&&h!==0)throw new Error(`${y} must be numeric, value: ${h}`);break;case"windowsPty":h=h??{}}return h}}r.OptionsService=g},2660:function(c,r,a){var u=this&&this.__decorate||function(g,C,y,h){var f,d=arguments.length,p=d<3?C:h===null?h=Object.getOwnPropertyDescriptor(C,y):h;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")p=Reflect.decorate(g,C,y,h);else for(var v=g.length-1;v>=0;v--)(f=g[v])&&(p=(d<3?f(p):d>3?f(C,y,p):f(C,y))||p);return d>3&&p&&Object.defineProperty(C,y,p),p},_=this&&this.__param||function(g,C){return function(y,h){C(y,h,g)}};Object.defineProperty(r,"__esModule",{value:!0}),r.OscLinkService=void 0;const l=a(2585);let m=r.OscLinkService=class{constructor(g){this._bufferService=g,this._nextId=1,this._entriesWithId=new Map,this._dataByLinkId=new Map}registerLink(g){const C=this._bufferService.buffer;if(g.id===void 0){const v=C.addMarker(C.ybase+C.y),S={data:g,id:this._nextId++,lines:[v]};return v.onDispose((()=>this._removeMarkerFromLink(S,v))),this._dataByLinkId.set(S.id,S),S.id}const y=g,h=this._getEntryIdKey(y),f=this._entriesWithId.get(h);if(f)return this.addLineToLink(f.id,C.ybase+C.y),f.id;const d=C.addMarker(C.ybase+C.y),p={id:this._nextId++,key:this._getEntryIdKey(y),data:y,lines:[d]};return d.onDispose((()=>this._removeMarkerFromLink(p,d))),this._entriesWithId.set(p.key,p),this._dataByLinkId.set(p.id,p),p.id}addLineToLink(g,C){const y=this._dataByLinkId.get(g);if(y&&y.lines.every((h=>h.line!==C))){const h=this._bufferService.buffer.addMarker(C);y.lines.push(h),h.onDispose((()=>this._removeMarkerFromLink(y,h)))}}getLinkData(g){return this._dataByLinkId.get(g)?.data}_getEntryIdKey(g){return`${g.id};;${g.uri}`}_removeMarkerFromLink(g,C){const y=g.lines.indexOf(C);y!==-1&&(g.lines.splice(y,1),g.lines.length===0&&(g.data.id!==void 0&&this._entriesWithId.delete(g.key),this._dataByLinkId.delete(g.id)))}};r.OscLinkService=m=u([_(0,l.IBufferService)],m)},8343:(c,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.createDecorator=r.getServiceDependencies=r.serviceRegistry=void 0;const a="di$target",u="di$dependencies";r.serviceRegistry=new Map,r.getServiceDependencies=function(_){return _[u]||[]},r.createDecorator=function(_){if(r.serviceRegistry.has(_))return r.serviceRegistry.get(_);const l=function(m,g,C){if(arguments.length!==3)throw new Error("@IServiceName-decorator can only be used to decorate a parameter");(function(y,h,f){h[a]===h?h[u].push({id:y,index:f}):(h[u]=[{id:y,index:f}],h[a]=h)})(l,m,C)};return l.toString=()=>_,r.serviceRegistry.set(_,l),l}},2585:(c,r,a)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.IDecorationService=r.IUnicodeService=r.IOscLinkService=r.IOptionsService=r.ILogService=r.LogLevelEnum=r.IInstantiationService=r.ICharsetService=r.ICoreService=r.ICoreMouseService=r.IBufferService=void 0;const u=a(8343);var _;r.IBufferService=(0,u.createDecorator)("BufferService"),r.ICoreMouseService=(0,u.createDecorator)("CoreMouseService"),r.ICoreService=(0,u.createDecorator)("CoreService"),r.ICharsetService=(0,u.createDecorator)("CharsetService"),r.IInstantiationService=(0,u.createDecorator)("InstantiationService"),(function(l){l[l.TRACE=0]="TRACE",l[l.DEBUG=1]="DEBUG",l[l.INFO=2]="INFO",l[l.WARN=3]="WARN",l[l.ERROR=4]="ERROR",l[l.OFF=5]="OFF"})(_||(r.LogLevelEnum=_={})),r.ILogService=(0,u.createDecorator)("LogService"),r.IOptionsService=(0,u.createDecorator)("OptionsService"),r.IOscLinkService=(0,u.createDecorator)("OscLinkService"),r.IUnicodeService=(0,u.createDecorator)("UnicodeService"),r.IDecorationService=(0,u.createDecorator)("DecorationService")},1480:(c,r,a)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.UnicodeService=void 0;const u=a(8460),_=a(225);class l{static extractShouldJoin(g){return(1&g)!=0}static extractWidth(g){return g>>1&3}static extractCharKind(g){return g>>3}static createPropertyValue(g,C,y=!1){return(16777215&g)<<3|(3&C)<<1|(y?1:0)}constructor(){this._providers=Object.create(null),this._active="",this._onChange=new u.EventEmitter,this.onChange=this._onChange.event;const g=new _.UnicodeV6;this.register(g),this._active=g.version,this._activeProvider=g}dispose(){this._onChange.dispose()}get versions(){return Object.keys(this._providers)}get activeVersion(){return this._active}set activeVersion(g){if(!this._providers[g])throw new Error(`unknown Unicode version "${g}"`);this._active=g,this._activeProvider=this._providers[g],this._onChange.fire(g)}register(g){this._providers[g.version]=g}wcwidth(g){return this._activeProvider.wcwidth(g)}getStringCellWidth(g){let C=0,y=0;const h=g.length;for(let f=0;f<h;++f){let d=g.charCodeAt(f);if(55296<=d&&d<=56319){if(++f>=h)return C+this.wcwidth(d);const S=g.charCodeAt(f);56320<=S&&S<=57343?d=1024*(d-55296)+S-56320+65536:C+=this.wcwidth(S)}const p=this.charProperties(d,y);let v=l.extractWidth(p);l.extractShouldJoin(p)&&(v-=l.extractWidth(y)),C+=v,y=p}return C}charProperties(g,C){return this._activeProvider.charProperties(g,C)}}r.UnicodeService=l}},s={};function n(c){var r=s[c];if(r!==void 0)return r.exports;var a=s[c]={exports:{}};return i[c].call(a.exports,a,a.exports,n),a.exports}var o={};return(()=>{var c=o;Object.defineProperty(c,"__esModule",{value:!0}),c.Terminal=void 0;const r=n(9042),a=n(3236),u=n(844),_=n(5741),l=n(8285),m=n(7975),g=n(7090),C=["cols","rows"];class y extends u.Disposable{constructor(f){super(),this._core=this.register(new a.Terminal(f)),this._addonManager=this.register(new _.AddonManager),this._publicOptions={...this._core.options};const d=v=>this._core.options[v],p=(v,S)=>{this._checkReadonlyOptions(v),this._core.options[v]=S};for(const v in this._core.options){const S={get:d.bind(this,v),set:p.bind(this,v)};Object.defineProperty(this._publicOptions,v,S)}}_checkReadonlyOptions(f){if(C.includes(f))throw new Error(`Option "${f}" can only be set in the constructor`)}_checkProposedApi(){if(!this._core.optionsService.rawOptions.allowProposedApi)throw new Error("You must set the allowProposedApi option to true to use proposed API")}get onBell(){return this._core.onBell}get onBinary(){return this._core.onBinary}get onCursorMove(){return this._core.onCursorMove}get onData(){return this._core.onData}get onKey(){return this._core.onKey}get onLineFeed(){return this._core.onLineFeed}get onRender(){return this._core.onRender}get onResize(){return this._core.onResize}get onScroll(){return this._core.onScroll}get onSelectionChange(){return this._core.onSelectionChange}get onTitleChange(){return this._core.onTitleChange}get onWriteParsed(){return this._core.onWriteParsed}get element(){return this._core.element}get parser(){return this._parser||(this._parser=new m.ParserApi(this._core)),this._parser}get unicode(){return this._checkProposedApi(),new g.UnicodeApi(this._core)}get textarea(){return this._core.textarea}get rows(){return this._core.rows}get cols(){return this._core.cols}get buffer(){return this._buffer||(this._buffer=this.register(new l.BufferNamespaceApi(this._core))),this._buffer}get markers(){return this._checkProposedApi(),this._core.markers}get modes(){const f=this._core.coreService.decPrivateModes;let d="none";switch(this._core.coreMouseService.activeProtocol){case"X10":d="x10";break;case"VT200":d="vt200";break;case"DRAG":d="drag";break;case"ANY":d="any"}return{applicationCursorKeysMode:f.applicationCursorKeys,applicationKeypadMode:f.applicationKeypad,bracketedPasteMode:f.bracketedPasteMode,insertMode:this._core.coreService.modes.insertMode,mouseTrackingMode:d,originMode:f.origin,reverseWraparoundMode:f.reverseWraparound,sendFocusMode:f.sendFocus,wraparoundMode:f.wraparound}}get options(){return this._publicOptions}set options(f){for(const d in f)this._publicOptions[d]=f[d]}blur(){this._core.blur()}focus(){this._core.focus()}input(f,d=!0){this._core.input(f,d)}resize(f,d){this._verifyIntegers(f,d),this._core.resize(f,d)}open(f){this._core.open(f)}attachCustomKeyEventHandler(f){this._core.attachCustomKeyEventHandler(f)}attachCustomWheelEventHandler(f){this._core.attachCustomWheelEventHandler(f)}registerLinkProvider(f){return this._core.registerLinkProvider(f)}registerCharacterJoiner(f){return this._checkProposedApi(),this._core.registerCharacterJoiner(f)}deregisterCharacterJoiner(f){this._checkProposedApi(),this._core.deregisterCharacterJoiner(f)}registerMarker(f=0){return this._verifyIntegers(f),this._core.registerMarker(f)}registerDecoration(f){return this._checkProposedApi(),this._verifyPositiveIntegers(f.x??0,f.width??0,f.height??0),this._core.registerDecoration(f)}hasSelection(){return this._core.hasSelection()}select(f,d,p){this._verifyIntegers(f,d,p),this._core.select(f,d,p)}getSelection(){return this._core.getSelection()}getSelectionPosition(){return this._core.getSelectionPosition()}clearSelection(){this._core.clearSelection()}selectAll(){this._core.selectAll()}selectLines(f,d){this._verifyIntegers(f,d),this._core.selectLines(f,d)}dispose(){super.dispose()}scrollLines(f){this._verifyIntegers(f),this._core.scrollLines(f)}scrollPages(f){this._verifyIntegers(f),this._core.scrollPages(f)}scrollToTop(){this._core.scrollToTop()}scrollToBottom(){this._core.scrollToBottom()}scrollToLine(f){this._verifyIntegers(f),this._core.scrollToLine(f)}clear(){this._core.clear()}write(f,d){this._core.write(f,d)}writeln(f,d){this._core.write(f),this._core.write(`\r
`,d)}paste(f){this._core.paste(f)}refresh(f,d){this._verifyIntegers(f,d),this._core.refresh(f,d)}reset(){this._core.reset()}clearTextureAtlas(){this._core.clearTextureAtlas()}loadAddon(f){this._addonManager.loadAddon(this,f)}static get strings(){return r}_verifyIntegers(...f){for(const d of f)if(d===1/0||isNaN(d)||d%1!=0)throw new Error("This API only accepts integers")}_verifyPositiveIntegers(...f){for(const d of f)if(d&&(d===1/0||isNaN(d)||d%1!=0||d<0))throw new Error("This API only accepts positive integers")}}c.Terminal=y})(),o})()))})(rn)),rn.exports}var Kp=Vp();let ir={exports:{}};function _a(e,t){return(e||e===0?e+"":"").padEnd(t," ")}function be(e,t,i,s){return new Proxy({},{get:function(n,o){n=new e(t.buffer,i,s);const c=n[o];return typeof c=="function"?c.bind(n):c},set:function(n,o,c){return new e(t.buffer,i,s)[o]=c,!0}})}function A(e,t){return e=(e?e.toString(16):"").toUpperCase(),"0x"+(e||e===0?e+"":"").padStart(t||1,"0")}var sr;if(typeof crypto<"u"&&crypto.getRandomValues){const e=new Int32Array(1);sr=function(){return crypto.getRandomValues(e),e[0]}}else if(typeof require<"u"){const e=require("crypto");sr=function(){return e.randomBytes(4).readInt32LE(0)}}else typeof process<"u"&&hn(()=>import("../chunks/BIHI7g3E.js"),[],import.meta.url).then(e=>{sr=function(){return e.randomBytes(4).readInt32LE(0)}});var Ls;if(typeof Math.clz32=="function")Ls=function(e){return 31-Math.clz32(e)};else{for(var ps=new Int8Array(256),ms=0,fa=-2;256>ms;ms++)ms&ms-1||fa++,ps[ms]=fa;Ls=function(e){e>>>=0;var t=e>>>16;if(t){var i=t>>>8;return i?24+ps[i]:16+ps[t]}return(i=e>>>8)?8+ps[i]:ps[e]}}function Yp(e){return 1>=e?1:1<<1+Ls(e-1)}function Ss(e){var t=new Uint8Array(e),i,s;this.length=0,this.push=function(n){this.length!==e&&this.length++,t[s]=n,s=s+1&e-1},this.shift=function(){if(this.length){var n=t[i];return i=i+1&e-1,this.length--,n}return-1},this.peek=function(){return this.length?t[i]:-1},this.clear=function(){this.length=s=i=0},this.clear()}function Mi(e){this.size=e,this.data=new Float32Array(e),this.length=this.end=this.start=0}Mi.prototype.push=function(e){this.length===this.size?this.start=this.start+1&this.size-1:this.length++,this.data[this.end]=e,this.end=this.end+1&this.size-1};Mi.prototype.shift=function(){if(this.length){var e=this.data[this.start];return this.start=this.start+1&this.size-1,this.length--,e}};Mi.prototype.shift_block=function(e){var t=new Float32Array(e);e>this.length&&(e=this.length);var i=this.start+e,s=this.data.subarray(this.start,i);return t.set(s),i>=this.size&&(i-=this.size,t.set(this.data.subarray(0,i),s.length)),this.start=i,this.length-=e,t};Mi.prototype.peek=function(){if(this.length)return this.data[this.start]};Mi.prototype.clear=function(){this.length=this.end=this.start=0};function Bs(e){typeof e=="number"?this.view=new Uint8Array(e+7>>3):e instanceof ArrayBuffer&&(this.view=new Uint8Array(e))}Bs.prototype.set=function(e,t){const i=e>>3;e=1<<(e&7),this.view[i]=t?this.view[i]|e:this.view[i]&~e};Bs.prototype.get=function(e){return this.view[e>>3]>>(e&7)&1};Bs.prototype.get_buffer=function(){return this.view.buffer};var At,yn;if(typeof XMLHttpRequest>"u"||typeof process<"u"&&process.versions&&process.versions.node){let e;At=async function(t,i){if(e||(e=await hn(()=>import("../chunks/BIHI7g3E.js"),[],import.meta.url)),i.range){t=await e.open(t,"r");const s=Buffer.allocUnsafe(i.range.length);try{await t.read({buffer:s,position:i.range.start})}finally{await t.close()}i.done&&i.done(new Uint8Array(s))}else t=await e.readFile(t,{encoding:i.as_json?"utf-8":null}),t=i.as_json?JSON.parse(t):new Uint8Array(t).buffer,i.done(t)},yn=async function(t){return e||(e=await hn(()=>import("../chunks/BIHI7g3E.js"),[],import.meta.url)),(await e.stat(t)).size}}else At=async function(e,t,i){function s(){const a=i||0;setTimeout(()=>{At(e,t,a+1)},1e3*([1,1,2,3,5,8,13,21][a]||34))}var n=new XMLHttpRequest;if(n.open(t.method||"get",e,!0),n.responseType=t.as_json?"json":"arraybuffer",t.headers)for(var o=Object.keys(t.headers),c=0;c<o.length;c++){var r=o[c];n.setRequestHeader(r,t.headers[r])}t.range&&(o=t.range.start,n.setRequestHeader("Range","bytes="+o+"-"+(o+t.range.length-1)),n.setRequestHeader("X-Accept-Encoding","identity"),n.onreadystatechange=function(){n.status===200&&(console.error("Server sent full file in response to ranged request, aborting",{filename:e}),n.abort())}),n.onload=function(){if(n.readyState===4){if(n.status!==200&&n.status!==206)console.error("Loading the image "+e+" failed (status %d)",n.status),500<=n.status&&600>n.status&&s();else if(n.response){if(t.range){const a=n.getResponseHeader("Content-Encoding");a&&a!=="identity"&&console.error("Server sent Content-Encoding in response to ranged request",{filename:e,enc:a})}t.done&&t.done(n.response,n)}}},n.onerror=function(a){console.error("Loading the image "+e+" failed",a),s()},t.progress&&(n.onprogress=function(a){t.progress(a)}),n.send(null)},yn=async function(e){return new Promise((t,i)=>{At(e,{done:(s,n)=>{s=n.getResponseHeader("Content-Range")||"",(n=s.match(/\/(\d+)\s*$/))?t(+n[1]):i(Error("`Range: bytes=...` header not supported (Got `"+s+"`)"))},headers:{Range:"bytes=0-0","X-Accept-Encoding":"identity"}})})};function bn(e,t,i){return String.fromCharCode(...new Uint8Array(e.buffer,t>>>0,i>>>0))}const wi={cp437:"  !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_`abcdefghijklmnopqrstuvwxyz{|}~ ",cp858:" "};wi.cp858=wi.cp437.slice(0,128)+wi.cp858;wi.ascii=wi.cp437.split("").map((e,t)=>31<t&&128>t?e:".").join("");function yh(e){return e&&wi[e]?wi[e]:wi.cp437}function Xp(e,t){function i(j){return j=j.toString(16),"#"+"0".repeat(6-j.length)+j}function s(j){var V=256*R,X=8*k,M=w?w.canvas:null;M&&M.width===V&&M.height===X||(M?(M.width=V,M.height=X):(M=new OffscreenCanvas(V,X),w=M.getContext("2d")),E=w.createImageData(V,X));const T=E.data;let K=0,q;X=P?function(he){q=q||he,T[K+3]=he,T[K+7]=he,K+=8}:function(he){q=q||he,T[K+3]=he,K+=4},M=32-k;const Y=V*(k-1)*4;V=4*(R-V*k);const Z=1020*R;for(let he=0,me=0;2048>he;++he,me+=M,K+=V){const fe=he%256;he&&!fe&&(K+=Y),q=!1;for(let Ae=0;Ae<k;++Ae,++me,K+=Z){const ue=j[me];for(let ve=128;0<ve;ve>>=1)X(ue&ve?255:0);I&&X(L&&192<=fe&&223>=fe&&ue&1?255:0)}b[he]=q?1:0}w.putImageData(E,0,0)}function n(j,V,X,M){if(V&&X){j.style.width="",j.style.height="",M&&(j.style.transform="");var T=j.getBoundingClientRect();M?j.style.transform=(V===1?"":" scaleX("+V+")")+(X===1?"":" scaleY("+X+")"):(V%1===0&&X%1===0?(c.style.imageRendering="crisp-edges",c.style.imageRendering="pixelated",c.style["-ms-interpolation-mode"]="nearest-neighbor"):(c.style.imageRendering="",c.style["-ms-interpolation-mode"]=""),M=window.devicePixelRatio||1,M%1!==0&&(V/=M,X/=M)),V!==1&&(j.style.width=T.width*V+"px"),X!==1&&(j.style.height=T.height*X+"px")}}const o=e.container;this.screen_fill_buffer=t,console.assert(o,"options.container must be provided"),this.FLAG_BLINKING=1,this.FLAG_FONT_PAGE_B=2;var c=o.getElementsByTagName("canvas")[0],r=c.getContext("2d",{alpha:!1}),a=o.getElementsByTagName("div")[0],u=document.createElement("div"),_,l,m=e.scale!==void 0?e.scale:1,g=e.scale!==void 0?e.scale:1,C=1,y,h,f,d,p,v,S,w,E,b=new Int8Array(2048),k,R,I,P,L,z=0,J=0,re,te=0,ee,x,B,N=yh(e.encoding),H=0,se=!1;this.init=function(){u.classList.add("cursor"),u.style.position="absolute",u.style.backgroundColor="#ccc",u.style.width="7px",u.style.display="inline-block",this.set_mode(!1),this.set_size_text(80,25),h===2&&this.set_size_graphical(720,400,720,400),this.set_scale(m,g),this.timer()},this.make_screenshot=function(){const j=new Image;if(h===1||h===2)j.src=c.toDataURL("image/png");else{const V=[9,16],X=document.createElement("canvas");X.width=d*V[0],X.height=p*V[1];const M=X.getContext("2d");M.imageSmoothingEnabled=!1,M.font=window.getComputedStyle(a).font,M.textBaseline="top";for(let T=0;T<p;T++)for(let K=0;K<d;K++){const q=4*(T*d+K),Y=f[q+0],Z=f[q+3];M.fillStyle=i(f[q+2]),M.fillRect(K*V[0],T*V[1],V[0],V[1]),M.fillStyle=i(Z),M.fillText(N[Y],K*V[0],T*V[1])}u.style.display!=="none"&&_<p&&l<d&&(M.fillStyle=u.style.backgroundColor,M.fillRect(l*V[0],_*V[1]+parseInt(u.style.marginTop,10),parseInt(u.style.width,10),parseInt(u.style.height,10))),j.src=X.toDataURL("image/png")}return j},this.put_char=function(j,V,X,M,T,K){V=4*(j*d+V),f[V+0]=X,f[V+1]=M,f[V+2]=T,f[V+3]=K,y[j]=1},this.timer=function(){H=requestAnimationFrame(()=>this.update_screen())},this.update_screen=function(){se||(h===0?this.update_text():h===1?this.update_graphical():this.update_graphical_text()),this.timer()},this.update_text=function(){for(var j=0;j<p;j++)y[j]&&(this.text_update_row(j),y[j]=0)},this.update_graphical=function(){this.screen_fill_buffer()},this.update_graphical_text=function(){if(v){var j=performance.now();if(266<j-te){re=!re,B&&(y[_]=1);var V=4*d;for(let Y=0,Z=0;Y<p;++Y)if(y[Y])Z+=V;else for(var X=0;X<d;++X,Z+=4)if(f[Z+1]&1){y[Y]=1,Z+=V-4*X;break}te=j}j=w.canvas,V=S.canvas,X=4*d;const T=d*R,K=k;let q=0;for(let Y=0,Z=0,he=0;Y<p;++Y,Z+=k){if(!y[Y]){he+=X;continue}++q,S.clearRect(0,K,T,k);let me,fe,Ae,ue;for(let ve=0;ve<T;ve+=R,he+=4){const Me=f[he+0];var M=f[he+1];const et=f[he+2],$e=f[he+3],tt=M&2?J:z;M=(!(M&1)||re)&&b[(tt<<8)+Me],Ae!==et&&(Ae!==void 0&&(v.fillStyle=i(Ae),v.fillRect(ue,Z,ve-ue,k)),Ae=et,ue=ve),me!==$e&&(me!==void 0&&(S.fillStyle=i(me),S.fillRect(fe,0,ve-fe,k)),me=$e,fe=ve),M&&S.drawImage(j,Me*R,tt*k,R,k,ve,K,R,k)}S.fillStyle=i(me),S.fillRect(fe,0,T-fe,k),S.globalCompositeOperation="destination-in",S.drawImage(V,0,K,T,k,0,0,T,k),S.globalCompositeOperation="source-over",v.fillStyle=i(Ae),v.fillRect(ue,Z,T-ue,k),v.drawImage(V,0,0,T,k,0,Z,T,k)}q&&(re&&B&&y[_]&&(v.fillStyle=i(f[4*(_*d+l)+3]),v.fillRect(l*R,_*k+ee,R,x-ee+1)),y.fill(0)),q&&r.drawImage(v.canvas,0,0)}},this.destroy=function(){H&&(cancelAnimationFrame(H),H=0)},this.pause=function(){se=!0,u.classList.remove("blinking-cursor")},this.continue=function(){se=!1,u.classList.add("blinking-cursor")},this.set_mode=function(j){h=j?1:e.use_graphical_text?2:0,h===0?(a.style.display="block",c.style.display="none"):(a.style.display="none",c.style.display="block",h===2&&y&&y.fill(1))},this.set_font_bitmap=function(j,V,X,M,T,K){const q=X?16:V?9:8;(k!==j||R!==q||I!==V||P!==X||L!==M||K)&&(K=R!==q||k!==j,k=j,R=q,I=V,P=X,L=M,h===2&&(s(T),y.fill(1),K&&this.set_size_graphical_text()))},this.set_font_page=function(j,V){(z!==j||J!==V)&&(z=j,J=V,y.fill(1))},this.clear_screen=function(){r.fillStyle="#000",r.fillRect(0,0,c.width,c.height)},this.set_size_graphical_text=function(){if(w){var j=R*d,V=k*p,X=2*k;v&&v.canvas.width===j&&v.canvas.height===V&&S.canvas.height===X||(v?(v.canvas.width=j,v.canvas.height=V,S.canvas.width=j,S.canvas.height=X):(v=new OffscreenCanvas(j,V).getContext("2d",{alpha:!1}),S=new OffscreenCanvas(j,X).getContext("2d")),this.set_size_graphical(j,V,j,V),y.fill(1))}},this.set_size_text=function(j,V){if(j!==d||V!==p)if(y=new Int8Array(V),f=new Int32Array(j*V*4),d=j,p=V,h===0){for(;a.childNodes.length>V;)a.removeChild(a.firstChild);for(;a.childNodes.length<V;)a.appendChild(document.createElement("div"));for(j=0;j<V;j++)this.text_update_row(j);n(a,m,g,!0)}else h===2&&this.set_size_graphical_text()},this.set_size_graphical=function(j,V){c.style.display="block",c.width=j,c.height=V,r.imageSmoothingEnabled=!1,C=640>=j&&2*j<window.innerWidth*window.devicePixelRatio&&2*V<window.innerHeight*window.devicePixelRatio?2:1,n(c,m*C,g*C,!1)},this.set_scale=function(j,V){m=j,g=V,n(a,m,g,!0),n(c,m*C,g*C,!1)},this.update_cursor_scanline=function(j,V,X){(j!==ee||V!==x||X!==B)&&(h===0?X?(u.style.display="inline",u.style.height=V-j+"px",u.style.marginTop=j+"px"):u.style.display="none":h===2&&_<p&&(y[_]=1),ee=j,x=V,B=X)},this.update_cursor=function(j,V){(j!==_||V!==l)&&(j<p&&(y[j]=1),_<p&&(y[_]=1),_=j,l=V)},this.text_update_row=function(j){for(var V=4*j*d,X,M=a.childNodes[j],T=document.createElement("div"),K=0;K<d;){var q=document.createElement("span"),Y=f[V+1]&1,Z=f[V+2],he=f[V+3];for(Y&&q.classList.add("blink"),q.style.backgroundColor=i(Z),q.style.color=i(he),X="";K<d&&(f[V+1]&1)===Y&&f[V+2]===Z&&f[V+3]===he;)if(X+=N[f[V+0]],K++,V+=4,j===_){if(K===l)break;if(K===l+1){u.style.backgroundColor=q.style.color,T.appendChild(u);break}}q.textContent=X,T.appendChild(q)}M.parentNode.replaceChild(T,M)},this.update_buffer=function(j){for(const V of j)r.putImageData(V.image_data,V.screen_x-V.buffer_x,V.screen_y-V.buffer_y,V.buffer_x,V.buffer_y,V.buffer_width,V.buffer_height)},this.get_text_screen=function(){for(var j=[],V=0;V<p;V++)j.push(this.get_text_row(V));return j},this.get_text_row=function(j){var V=j*d*4;j=V+4*d;let X="";for(;V<j;V+=4)X+=N[f[V]];return X},this.init()}function it(e){this.buffer=e,this.byteLength=e.byteLength,this.onprogress=this.onload=void 0}it.prototype.load=function(){this.onload&&this.onload({buffer:this.buffer})};it.prototype.get=function(e,t,i){i(new Uint8Array(this.buffer,e,t))};it.prototype.set=function(e,t,i){new Uint8Array(this.buffer,e,t.byteLength).set(t),i()};it.prototype.get_buffer=function(e){e(this.buffer)};it.prototype.get_state=function(){const e=[];return e[0]=this.byteLength,e[1]=new Uint8Array(this.buffer),e};it.prototype.set_state=function(e){this.byteLength=e[0],this.buffer=e[1].slice().buffer};function lt(e,t,i){this.filename=e,this.byteLength=t,this.block_cache=new Map,this.block_cache_is_write=new Set,this.fixed_chunk_size=i,this.cache_reads=!!i,this.onprogress=this.onload=void 0}lt.prototype.load=async function(){this.byteLength===void 0&&(this.byteLength=await yn(this.filename)),this.onload&&this.onload(Object.create(null))};lt.prototype.get_from_cache=function(e,t){var i=t/256;e/=256;for(var s=0;s<i;s++)if(!this.block_cache.get(e+s))return;if(i===1)return this.block_cache.get(e);for(t=new Uint8Array(t),s=0;s<i;s++)t.set(this.block_cache.get(e+s),256*s);return t};lt.prototype.get=function(e,t,i){var s=this.get_from_cache(e,t);if(s)i(s);else{var n=e,o=t;this.fixed_chunk_size&&(n=e-e%this.fixed_chunk_size,o=Math.ceil((e-n+t)/this.fixed_chunk_size)*this.fixed_chunk_size),At(this.filename,{done:(function(c){c=new Uint8Array(c),this.handle_read(n,o,c),i(n===e&&o===t?c:c.subarray(e-n,e-n+t))}).bind(this),range:{start:n,length:o}})}};lt.prototype.set=function(e,t,i){e/=256;for(var s=t.length/256,n=0;n<s;n++){var o=this.block_cache.get(e+n);if(o===void 0)o=t.slice(256*n,256*(n+1)),this.block_cache.set(e+n,o);else{const c=t.subarray(256*n,256*(n+1));o.set(c)}this.block_cache_is_write.add(e+n)}i()};lt.prototype.handle_read=function(e,t,i){e/=256,t/=256;for(var s=0;s<t;s++){const n=this.block_cache.get(e+s);n?i.set(n,256*s):this.cache_reads&&this.block_cache.set(e+s,i.slice(256*s,256*(s+1)))}};lt.prototype.get_buffer=function(e){e()};lt.prototype.get_state=function(){const e=[],t=[];for(const[i,s]of this.block_cache)this.block_cache_is_write.has(i)&&t.push([i,s]);return e[0]=t,e};lt.prototype.set_state=function(e){e=e[0],this.block_cache.clear(),this.block_cache_is_write.clear();for(const[t,i]of e)this.block_cache.set(t,i),this.block_cache_is_write.add(t)};function xi(e,t,i,s,n){const o=e.match(/\.[^\.]+(\.zst)?$/);this.extension=o?o[0]:"",this.basename=e.substring(0,e.length-this.extension.length),this.is_zstd=this.extension.endsWith(".zst"),this.basename.endsWith("/")||(this.basename+="-"),this.block_cache=new Map,this.block_cache_is_write=new Set,this.byteLength=t,this.fixed_chunk_size=i,this.partfile_alt_format=!!s,this.zstd_decompress=n,this.cache_reads=!!i,this.onprogress=this.onload=void 0}xi.prototype.load=function(){this.onload&&this.onload(Object.create(null))};xi.prototype.get=function(e,t,i){var s=this.get_from_cache(e,t);if(s)i(s);else if(this.fixed_chunk_size){const o=Math.floor(e/this.fixed_chunk_size),c=e-o*this.fixed_chunk_size,r=Math.ceil((c+t)/this.fixed_chunk_size),a=new Uint8Array(r*this.fixed_chunk_size);let u=0;for(let _=0;_<r;_++){var n=(o+_)*this.fixed_chunk_size;s=this.partfile_alt_format?this.basename+(o+_+"").padStart(8,"0")+this.extension:this.basename+n+"-"+(n+this.fixed_chunk_size)+this.extension,(n=this.get_from_cache(n,this.fixed_chunk_size))?(a.set(n,_*this.fixed_chunk_size),u++,u===r&&i(a.subarray(c,c+t))):At(s,{done:(async function(l){l=new Uint8Array(l),this.is_zstd&&(l=await this.zstd_decompress(this.fixed_chunk_size,l),l=new Uint8Array(l)),a.set(l,_*this.fixed_chunk_size),this.handle_read((o+_)*this.fixed_chunk_size,this.fixed_chunk_size|0,l),u++,u===r&&i(a.subarray(c,c+t))}).bind(this)})}}else At(this.basename+e+"-"+(e+t)+this.extension,{done:(function(o){o=new Uint8Array(o),this.handle_read(e,t,o),i(o)}).bind(this)})};xi.prototype.get_from_cache=lt.prototype.get_from_cache;xi.prototype.set=lt.prototype.set;xi.prototype.handle_read=lt.prototype.handle_read;xi.prototype.get_state=lt.prototype.get_state;xi.prototype.set_state=lt.prototype.set_state;function Ai(e){this.file=e,this.byteLength=e.size,1073741824<e.size&&console.warn("SyncFileBuffer: Allocating buffer of "+(e.size>>20)+" MB ..."),this.buffer=new ArrayBuffer(e.size),this.onprogress=this.onload=void 0}Ai.prototype.load=function(){this.load_next(0)};Ai.prototype.load_next=function(e){var t=new FileReader;if(t.onload=(function(s){s=new Uint8Array(s.target.result),new Uint8Array(this.buffer,e).set(s),this.load_next(e+4194304)}).bind(this),this.onprogress&&this.onprogress({loaded:e,total:this.byteLength,lengthComputable:!0}),e<this.byteLength){var i=this.file.slice(e,Math.min(e+4194304,this.byteLength));t.readAsArrayBuffer(i)}else this.file=void 0,this.onload&&this.onload({buffer:this.buffer})};Ai.prototype.get=it.prototype.get;Ai.prototype.set=it.prototype.set;Ai.prototype.get_buffer=it.prototype.get_buffer;Ai.prototype.get_state=it.prototype.get_state;Ai.prototype.set_state=it.prototype.set_state;function ii(e){this.file=e,this.byteLength=e.size,this.block_cache=new Map,this.block_cache_is_write=new Set,this.onprogress=this.onload=void 0}ii.prototype.load=function(){this.onload&&this.onload(Object.create(null))};ii.prototype.get=function(e,t,i){var s=this.get_from_cache(e,t);s?i(s):(s=new FileReader,s.onload=(function(n){n=new Uint8Array(n.target.result),this.handle_read(e,t,n),i(n)}).bind(this),s.readAsArrayBuffer(this.file.slice(e,e+t)))};ii.prototype.get_from_cache=lt.prototype.get_from_cache;ii.prototype.set=lt.prototype.set;ii.prototype.handle_read=lt.prototype.handle_read;ii.prototype.get_state=lt.prototype.get_state;ii.prototype.set_state=lt.prototype.set_state;ii.prototype.get_buffer=function(e){e()};ii.prototype.get_as_file=function(e){for(var t=[],i=Array.from(this.block_cache.keys()).sort(function(r,a){return r-a}),s=0,n=0;n<i.length;n++){var o=i[n],c=this.block_cache.get(o);o*=256,o!==s&&(t.push(this.file.slice(s,o)),s=o),t.push(c),s+=c.length}return s!==this.file.size&&t.push(this.file.slice(s)),new File(t,e)};function pr(e,t){if(e.buffer instanceof ArrayBuffer)return new it(e.buffer);if(typeof File<"u"&&e.buffer instanceof File)return t=e.async,t===void 0&&(t=268435456<=e.buffer.size),t?new ii(e.buffer):new Ai(e.buffer);if(e.url)return e.use_parts?new xi(e.url,e.size,e.fixed_chunk_size,!1,t):new lt(e.url,e.size,e.fixed_chunk_size)}function Qe(e){this.cpu=e,this.channel_page=new Uint8Array(8),this.channel_pagehi=new Uint8Array(8),this.channel_addr=new Uint16Array(8),this.channel_addr_init=new Uint16Array(8),this.channel_count=new Uint16Array(8),this.channel_count_init=new Uint16Array(8),this.channel_mask=new Uint8Array(8),this.channel_mode=new Uint8Array(8),this.unmask_listeners=[],this.lsb_msb_flipflop=0,e=e.io,e.register_write(0,this,this.port_addr_write.bind(this,0)),e.register_write(2,this,this.port_addr_write.bind(this,1)),e.register_write(4,this,this.port_addr_write.bind(this,2)),e.register_write(6,this,this.port_addr_write.bind(this,3)),e.register_write(1,this,this.port_count_write.bind(this,0)),e.register_write(3,this,this.port_count_write.bind(this,1)),e.register_write(5,this,this.port_count_write.bind(this,2)),e.register_write(7,this,this.port_count_write.bind(this,3)),e.register_read(0,this,this.port_addr_read.bind(this,0)),e.register_read(2,this,this.port_addr_read.bind(this,1)),e.register_read(4,this,this.port_addr_read.bind(this,2)),e.register_read(6,this,this.port_addr_read.bind(this,3)),e.register_read(1,this,this.port_count_read.bind(this,0)),e.register_read(3,this,this.port_count_read.bind(this,1)),e.register_read(5,this,this.port_count_read.bind(this,2)),e.register_read(7,this,this.port_count_read.bind(this,3)),e.register_write(192,this,this.port_addr_write.bind(this,4)),e.register_write(196,this,this.port_addr_write.bind(this,5)),e.register_write(200,this,this.port_addr_write.bind(this,6)),e.register_write(204,this,this.port_addr_write.bind(this,7)),e.register_write(194,this,this.port_count_write.bind(this,4)),e.register_write(198,this,this.port_count_write.bind(this,5)),e.register_write(202,this,this.port_count_write.bind(this,6)),e.register_write(206,this,this.port_count_write.bind(this,7)),e.register_read(192,this,this.port_addr_read.bind(this,4)),e.register_read(196,this,this.port_addr_read.bind(this,5)),e.register_read(200,this,this.port_addr_read.bind(this,6)),e.register_read(204,this,this.port_addr_read.bind(this,7)),e.register_read(194,this,this.port_count_read.bind(this,4)),e.register_read(198,this,this.port_count_read.bind(this,5)),e.register_read(202,this,this.port_count_read.bind(this,6)),e.register_read(206,this,this.port_count_read.bind(this,7)),e.register_write(135,this,this.port_page_write.bind(this,0)),e.register_write(131,this,this.port_page_write.bind(this,1)),e.register_write(129,this,this.port_page_write.bind(this,2)),e.register_write(130,this,this.port_page_write.bind(this,3)),e.register_write(143,this,this.port_page_write.bind(this,4)),e.register_write(139,this,this.port_page_write.bind(this,5)),e.register_write(137,this,this.port_page_write.bind(this,6)),e.register_write(138,this,this.port_page_write.bind(this,7)),e.register_read(135,this,this.port_page_read.bind(this,0)),e.register_read(131,this,this.port_page_read.bind(this,1)),e.register_read(129,this,this.port_page_read.bind(this,2)),e.register_read(130,this,this.port_page_read.bind(this,3)),e.register_read(143,this,this.port_page_read.bind(this,4)),e.register_read(139,this,this.port_page_read.bind(this,5)),e.register_read(137,this,this.port_page_read.bind(this,6)),e.register_read(138,this,this.port_page_read.bind(this,7)),e.register_write(1159,this,this.port_pagehi_write.bind(this,0)),e.register_write(1155,this,this.port_pagehi_write.bind(this,1)),e.register_write(1153,this,this.port_pagehi_write.bind(this,2)),e.register_write(1154,this,this.port_pagehi_write.bind(this,3)),e.register_write(1163,this,this.port_pagehi_write.bind(this,5)),e.register_write(1161,this,this.port_pagehi_write.bind(this,6)),e.register_write(1162,this,this.port_pagehi_write.bind(this,7)),e.register_read(1159,this,this.port_pagehi_read.bind(this,0)),e.register_read(1155,this,this.port_pagehi_read.bind(this,1)),e.register_read(1153,this,this.port_pagehi_read.bind(this,2)),e.register_read(1154,this,this.port_pagehi_read.bind(this,3)),e.register_read(1163,this,this.port_pagehi_read.bind(this,5)),e.register_read(1161,this,this.port_pagehi_read.bind(this,6)),e.register_read(1162,this,this.port_pagehi_read.bind(this,7)),e.register_write(10,this,this.port_singlemask_write.bind(this,0)),e.register_write(212,this,this.port_singlemask_write.bind(this,4)),e.register_write(15,this,this.port_multimask_write.bind(this,0)),e.register_write(222,this,this.port_multimask_write.bind(this,4)),e.register_read(15,this,this.port_multimask_read.bind(this,0)),e.register_read(222,this,this.port_multimask_read.bind(this,4)),e.register_write(11,this,this.port_mode_write.bind(this,0)),e.register_write(214,this,this.port_mode_write.bind(this,4)),e.register_write(12,this,this.portC_write),e.register_write(216,this,this.portC_write)}Qe.prototype.get_state=function(){return[this.channel_page,this.channel_pagehi,this.channel_addr,this.channel_addr_init,this.channel_count,this.channel_count_init,this.channel_mask,this.channel_mode,this.lsb_msb_flipflop]};Qe.prototype.set_state=function(e){this.channel_page=e[0],this.channel_pagehi=e[1],this.channel_addr=e[2],this.channel_addr_init=e[3],this.channel_count=e[4],this.channel_count_init=e[5],this.channel_mask=e[6],this.channel_mode=e[7],this.lsb_msb_flipflop=e[8]};Qe.prototype.port_count_write=function(e,t){A(t),this.channel_count[e]=this.flipflop_get(this.channel_count[e],t,!1),this.channel_count_init[e]=this.flipflop_get(this.channel_count_init[e],t,!0)};Qe.prototype.port_count_read=function(e){return A(this.channel_count[e]),this.flipflop_read(this.channel_count[e])};Qe.prototype.port_addr_write=function(e,t){A(t),this.channel_addr[e]=this.flipflop_get(this.channel_addr[e],t,!1),this.channel_addr_init[e]=this.flipflop_get(this.channel_addr_init[e],t,!0)};Qe.prototype.port_addr_read=function(e){return A(this.channel_addr[e]),this.flipflop_read(this.channel_addr[e])};Qe.prototype.port_pagehi_write=function(e,t){A(t),this.channel_pagehi[e]=t};Qe.prototype.port_pagehi_read=function(e){return this.channel_pagehi[e]};Qe.prototype.port_page_write=function(e,t){A(t),this.channel_page[e]=t};Qe.prototype.port_page_read=function(e){return this.channel_page[e]};Qe.prototype.port_singlemask_write=function(e,t){this.update_mask((t&3)+e,t&4?1:0)};Qe.prototype.port_multimask_write=function(e,t){A(t);for(var i=0;4>i;i++)this.update_mask(e+i,t&1<<i)};Qe.prototype.port_multimask_read=function(e){var t=0|this.channel_mask[e+0];return t|=this.channel_mask[e+1]<<1,t|=this.channel_mask[e+2]<<2,t|=this.channel_mask[e+3]<<3,A(t),t};Qe.prototype.port_mode_write=function(e,t){e=(t&3)+e,A(t),this.channel_mode[e]=t};Qe.prototype.portC_write=function(){this.lsb_msb_flipflop=0};Qe.prototype.on_unmask=function(e,t){this.unmask_listeners.push({fn:e,this_value:t})};Qe.prototype.update_mask=function(e,t){if(this.channel_mask[e]!==t&&(this.channel_mask[e]=t,!t))for(t=0;t<this.unmask_listeners.length;t++)this.unmask_listeners[t].fn.call(this.unmask_listeners[t].this_value,e)};Qe.prototype.do_read=function(e,t,i,s,n){var o=this.count_get_8bit(s),c=this.address_get_8bit(s);if(""+A(c)+A(o),i<o&&(""+A(i)+A(o),void 0),t+o>e.byteLength)n(!0);else{var r=this.cpu;this.channel_addr[s]+=o,e.get(t,o,function(a){r.write_blob(a,c),n(!1)})}};Qe.prototype.do_write=function(e,t,i,s,n){var o=this.channel_count[s]+1&65535,c=5<=s?2:1,r=o*c,a=this.address_get_8bit(s),u=!1,_=!1,l=this.channel_mode[s]&16;""+A(a)+A(r),i<r?(o=Math.floor(i/c),r=o*c,u=!0):i>r&&(_=!0),t+r>e.byteLength?n(!0):(this.channel_addr[s]+=o,this.channel_count[s]-=o,!u&&l&&(this.channel_addr[s]=this.channel_addr_init[s],this.channel_count[s]=this.channel_count_init[s]),e.set(t,this.cpu.mem8.subarray(a,a+r),()=>{_&&l?this.do_write(e,t+r,i-r,s,n):n(!1)}))};Qe.prototype.address_get_8bit=function(e){var t=this.channel_addr[e];return 5<=e&&(t<<=1),t=t&65535|this.channel_page[e]<<16,t|=this.channel_pagehi[e]<<24};Qe.prototype.count_get_8bit=function(e){var t=this.channel_count[e]+1;return 5<=e&&(t*=2),t};Qe.prototype.flipflop_get=function(e,t,i){return i||(this.lsb_msb_flipflop^=1),this.lsb_msb_flipflop?e&-256|t:e&-65281|t<<8};Qe.prototype.flipflop_read=function(e){return(this.lsb_msb_flipflop^=1)?e&255:e>>8&255};function ht(e){this.ports=[],this.cpu=e;for(var t=0;65536>t;t++)this.ports[t]=this.create_empty_entry();var i=e.memory_size[0];for(t=0;t<<17<i;t++)e.memory_map_read8[t]=e.memory_map_write8[t]=void 0,e.memory_map_read32[t]=e.memory_map_write32[t]=void 0;this.mmap_register(i,4294967296-i,function(s){return A(s>>>0,8),255},function(s,n){A(s>>>0,8),A(n,2)},function(s){return A(s>>>0,8),-1},function(s,n){A(s>>>0,8),A(n>>>0,8)})}ht.prototype.create_empty_entry=function(){return{read8:this.empty_port_read8,read16:this.empty_port_read16,read32:this.empty_port_read32,write8:this.empty_port_write,write16:this.empty_port_write,write32:this.empty_port_write,device:void 0}};ht.prototype.empty_port_read8=function(){return 255};ht.prototype.empty_port_read16=function(){return 65535};ht.prototype.empty_port_read32=function(){return-1};ht.prototype.empty_port_write=function(){};ht.prototype.register_read=function(e,t,i,s,n){i&&(this.ports[e].read8=i),s&&(this.ports[e].read16=s),n&&(this.ports[e].read32=n),this.ports[e].device=t};ht.prototype.register_write=function(e,t,i,s,n){i&&(this.ports[e].write8=i),s&&(this.ports[e].write16=s),n&&(this.ports[e].write32=n),this.ports[e].device=t};ht.prototype.register_read_consecutive=function(e,t,i,s,n,o){function c(){return i.call(this)|s.call(this)<<8}function r(){return n.call(this)|o.call(this)<<8}function a(){return i.call(this)|s.call(this)<<8|n.call(this)<<16|o.call(this)<<24}n&&o?(this.register_read(e,t,i,c,a),this.register_read(e+1,t,s),this.register_read(e+2,t,n,r),this.register_read(e+3,t,o)):(this.register_read(e,t,i,c),this.register_read(e+1,t,s))};ht.prototype.register_write_consecutive=function(e,t,i,s,n,o){function c(u){i.call(this,u&255),s.call(this,u>>8&255)}function r(u){n.call(this,u&255),o.call(this,u>>8&255)}function a(u){i.call(this,u&255),s.call(this,u>>8&255),n.call(this,u>>16&255),o.call(this,u>>>24)}n&&o?(this.register_write(e,t,i,c,a),this.register_write(e+1,t,s),this.register_write(e+2,t,n,r),this.register_write(e+3,t,o)):(this.register_write(e,t,i,c),this.register_write(e+1,t,s))};ht.prototype.mmap_read32_shim=function(e){var t=this.cpu.memory_map_read8[e>>>17];return t(e)|t(e+1)<<8|t(e+2)<<16|t(e+3)<<24};ht.prototype.mmap_write32_shim=function(e,t){var i=this.cpu.memory_map_write8[e>>>17];i(e,t&255),i(e+1,t>>8&255),i(e+2,t>>16&255),i(e+3,t>>>24)};ht.prototype.mmap_register=function(e,t,i,s,n,o){for(A(e>>>0,8),A(t,8),n||(n=this.mmap_read32_shim.bind(this)),o||(o=this.mmap_write32_shim.bind(this)),e>>>=17;0<t;e++)this.cpu.memory_map_read8[e]=i,this.cpu.memory_map_write8[e]=s,this.cpu.memory_map_read32[e]=n,this.cpu.memory_map_write32[e]=o,t-=131072};ht.prototype.port_write8=function(e,t){var i=this.ports[e];return i.write8===this.empty_port_write&&(A(e,4),A(t,2),this.get_port_description(e)),i.write8.call(i.device,t)};ht.prototype.port_write16=function(e,t){var i=this.ports[e];return i.write16===this.empty_port_write&&(A(e,4),A(t,4),this.get_port_description(e)),i.write16.call(i.device,t)};ht.prototype.port_write32=function(e,t){var i=this.ports[e];return i.write32===this.empty_port_write&&(A(e,4),A(t>>>0,8),this.get_port_description(e)),i.write32.call(i.device,t)};ht.prototype.port_read8=function(e){var t=this.ports[e];return t.read8===this.empty_port_read8&&(A(e,4),this.get_port_description(e)),t=t.read8.call(t.device,e),(0>t||256<=t)&&A(e),t};ht.prototype.port_read16=function(e){var t=this.ports[e];return t.read16===this.empty_port_read16&&(A(e,4),this.get_port_description(e)),t=t.read16.call(t.device,e),(0>t||65536<=t)&&A(e),t};ht.prototype.port_read32=function(e){var t=this.ports[e];return t.read32===this.empty_port_read32&&(A(e,4),this.get_port_description(e)),t.read32.call(t.device,e)};var pa={4:"PORT_DMA_ADDR_2",5:"PORT_DMA_CNT_2",10:"PORT_DMA1_MASK_REG",11:"PORT_DMA1_MODE_REG",12:"PORT_DMA1_CLEAR_FF_REG",13:"PORT_DMA1_MASTER_CLEAR",32:"PORT_PIC1_CMD",33:"PORT_PIC1_DATA",64:"PORT_PIT_COUNTER0",65:"PORT_PIT_COUNTER1",66:"PORT_PIT_COUNTER2",67:"PORT_PIT_MODE",96:"PORT_PS2_DATA",97:"PORT_PS2_CTRLB",100:"PORT_PS2_STATUS",112:"PORT_CMOS_INDEX",113:"PORT_CMOS_DATA",128:"PORT_DIAG",129:"PORT_DMA_PAGE_2",146:"PORT_A20",160:"PORT_PIC2_CMD",161:"PORT_PIC2_DATA",178:"PORT_SMI_CMD",179:"PORT_SMI_STATUS",212:"PORT_DMA2_MASK_REG",214:"PORT_DMA2_MODE_REG",218:"PORT_DMA2_MASTER_CLEAR",240:"PORT_MATH_CLEAR",368:"PORT_ATA2_CMD_BASE",496:"PORT_ATA1_CMD_BASE",632:"PORT_LPT2",744:"PORT_SERIAL4",760:"PORT_SERIAL2",884:"PORT_ATA2_CTRL_BASE",888:"PORT_LPT1",1e3:"PORT_SERIAL3",1008:"PORT_FD_BASE",1010:"PORT_FD_DOR",1012:"PORT_FD_STATUS",1013:"PORT_FD_DATA",1014:"PORT_HD_DATA",1015:"PORT_FD_DIR",1016:"PORT_SERIAL1",3320:"PORT_PCI_CMD",3321:"PORT_PCI_REBOOT",3324:"PORT_PCI_DATA",1026:"PORT_BIOS_DEBUG",1296:"PORT_QEMU_CFG_CTL",1297:"PORT_QEMU_CFG_DATA",45056:"PORT_ACPI_PM_BASE",45312:"PORT_SMB_BASE",35072:"PORT_BIOS_APM"};ht.prototype.get_port_description=function(e){return pa[e]?"  ("+pa[e]+")":""};var bh={};function ts(){this.listeners={},this.pair=void 0}ts.prototype.register=function(e,t,i){var s=this.listeners[e];s===void 0&&(s=this.listeners[e]=[]),s.push({fn:t,this_value:i})};ts.prototype.unregister=function(e,t){var i=this.listeners[e];i!==void 0&&(this.listeners[e]=i.filter(function(s){return s.fn!==t}))};ts.prototype.send=function(e,t){if(this.pair&&(e=this.pair.listeners[e],e!==void 0))for(var i=0;i<e.length;i++){var s=e[i];s.fn.call(s.this_value,t)}};ts.prototype.send_async=function(e,t){setTimeout(this.send.bind(this,e,t),0)};bh.create=function(){var e=new ts,t=new ts;return e.pair=t,t.pair=e,[e,t]};var wh=new Uint8Array(256),Sh=[],mr=[],gr=[],Ch=new Uint8Array(256),jn=[];function _e(e,t){this.cpu=e,this.bus=t,this.write_buffer=new Ss(64),this.read_buffer=new Ss(64),this.mixer_current_address=this.command_size=this.command=this.read_buffer_lastvalue=0,this.mixer_registers=new Uint8Array(256),this.mixer_reset(),this.dummy_speaker_enabled=!1,this.test_register=0,this.dsp_signed=this.dsp_16bit=this.dsp_stereo=this.dsp_highspeed=!1,this.dac_buffers=[new Mi(65536),new Mi(65536)],this.dma=e.devices.dma,this.dma_channel=this.dma_irq=this.dma_bytes_block=this.dma_bytes_left=this.dma_bytes_count=this.dma_sample_count=0,this.dma_channel_8bit=1,this.dma_channel_16bit=5,this.dma_autoinit=!1,this.dma_buffer=new ArrayBuffer(65536),this.dma_buffer_int8=new Int8Array(this.dma_buffer),this.dma_buffer_uint8=new Uint8Array(this.dma_buffer),this.dma_buffer_int16=new Int16Array(this.dma_buffer),this.dma_buffer_uint16=new Uint16Array(this.dma_buffer),this.dma_syncbuffer=new it(this.dma_buffer),this.dma_paused=this.dma_waiting_transfer=!1,this.sampling_rate=22050,t.send("dac-tell-sampling-rate",this.sampling_rate),this.bytes_per_sample=1,this.e2_value=170,this.e2_count=0,this.asp_registers=new Uint8Array(256),this.mpu_read_buffer=new Ss(64),this.fm_current_address1=this.fm_current_address0=this.mpu_read_buffer_lastvalue=0,this.fm_waveform_select_enable=!1,this.irq=5,this.irq_triggered=new Uint8Array(16),e.io.register_read_consecutive(544,this,this.port2x0_read,this.port2x1_read,this.port2x2_read,this.port2x3_read),e.io.register_read_consecutive(904,this,this.port2x0_read,this.port2x1_read),e.io.register_read_consecutive(548,this,this.port2x4_read,this.port2x5_read),e.io.register_read(550,this,this.port2x6_read),e.io.register_read(551,this,this.port2x7_read),e.io.register_read(552,this,this.port2x8_read),e.io.register_read(553,this,this.port2x9_read),e.io.register_read(554,this,this.port2xA_read),e.io.register_read(555,this,this.port2xB_read),e.io.register_read(556,this,this.port2xC_read),e.io.register_read(557,this,this.port2xD_read),e.io.register_read_consecutive(558,this,this.port2xE_read,this.port2xF_read),e.io.register_write_consecutive(544,this,this.port2x0_write,this.port2x1_write,this.port2x2_write,this.port2x3_write),e.io.register_write_consecutive(904,this,this.port2x0_write,this.port2x1_write),e.io.register_write_consecutive(548,this,this.port2x4_write,this.port2x5_write),e.io.register_write(550,this,this.port2x6_write),e.io.register_write(551,this,this.port2x7_write),e.io.register_write_consecutive(552,this,this.port2x8_write,this.port2x9_write),e.io.register_write(554,this,this.port2xA_write),e.io.register_write(555,this,this.port2xB_write),e.io.register_write(556,this,this.port2xC_write),e.io.register_write(557,this,this.port2xD_write),e.io.register_write(558,this,this.port2xE_write),e.io.register_write(559,this,this.port2xF_write),e.io.register_read_consecutive(816,this,this.port3x0_read,this.port3x1_read),e.io.register_write_consecutive(816,this,this.port3x0_write,this.port3x1_write),this.dma.on_unmask(this.dma_on_unmask,this),t.register("dac-request-data",function(){this.dac_handle_request()},this),t.register("speaker-has-initialized",function(){this.mixer_reset()},this),t.send("speaker-confirm-initialized"),this.dsp_reset()}_e.prototype.dsp_reset=function(){this.write_buffer.clear(),this.read_buffer.clear(),this.command_size=this.command=0,this.dummy_speaker_enabled=!1,this.test_register=0,this.dsp_signed=this.dsp_16bit=this.dsp_stereo=this.dsp_highspeed=!1,this.dac_buffers[0].clear(),this.dac_buffers[1].clear(),this.dma_channel=this.dma_irq=this.dma_bytes_block=this.dma_bytes_left=this.dma_bytes_count=this.dma_sample_count=0,this.dma_autoinit=!1,this.dma_buffer_uint8.fill(0),this.dma_paused=this.dma_waiting_transfer=!1,this.e2_value=170,this.e2_count=0,this.sampling_rate=22050,this.bytes_per_sample=1,this.lower_irq(1),this.irq_triggered.fill(0),this.asp_registers.fill(0),this.asp_registers[5]=1,this.asp_registers[9]=248};_e.prototype.get_state=function(){var e=[];return e[2]=this.read_buffer_lastvalue,e[3]=this.command,e[4]=this.command_size,e[5]=this.mixer_current_address,e[6]=this.mixer_registers,e[7]=this.dummy_speaker_enabled,e[8]=this.test_register,e[9]=this.dsp_highspeed,e[10]=this.dsp_stereo,e[11]=this.dsp_16bit,e[12]=this.dsp_signed,e[15]=this.dma_sample_count,e[16]=this.dma_bytes_count,e[17]=this.dma_bytes_left,e[18]=this.dma_bytes_block,e[19]=this.dma_irq,e[20]=this.dma_channel,e[21]=this.dma_channel_8bit,e[22]=this.dma_channel_16bit,e[23]=this.dma_autoinit,e[24]=this.dma_buffer_uint8,e[25]=this.dma_waiting_transfer,e[26]=this.dma_paused,e[27]=this.sampling_rate,e[28]=this.bytes_per_sample,e[29]=this.e2_value,e[30]=this.e2_count,e[31]=this.asp_registers,e[33]=this.mpu_read_buffer_last_value,e[34]=this.irq,e[35]=this.irq_triggered,e};_e.prototype.set_state=function(e){this.read_buffer_lastvalue=e[2],this.command=e[3],this.command_size=e[4],this.mixer_current_address=e[5],this.mixer_registers=e[6],this.mixer_full_update(),this.dummy_speaker_enabled=e[7],this.test_register=e[8],this.dsp_highspeed=e[9],this.dsp_stereo=e[10],this.dsp_16bit=e[11],this.dsp_signed=e[12],this.dma_sample_count=e[15],this.dma_bytes_count=e[16],this.dma_bytes_left=e[17],this.dma_bytes_block=e[18],this.dma_irq=e[19],this.dma_channel=e[20],this.dma_channel_8bit=e[21],this.dma_channel_16bit=e[22],this.dma_autoinit=e[23],this.dma_buffer_uint8=e[24],this.dma_waiting_transfer=e[25],this.dma_paused=e[26],this.sampling_rate=e[27],this.bytes_per_sample=e[28],this.e2_value=e[29],this.e2_count=e[30],this.asp_registers=e[31],this.mpu_read_buffer_last_value=e[33],this.irq=e[34],this.irq_triggered=e[35],this.dma_buffer=this.dma_buffer_uint8.buffer,this.dma_buffer_int8=new Int8Array(this.dma_buffer),this.dma_buffer_int16=new Int16Array(this.dma_buffer),this.dma_buffer_uint16=new Uint16Array(this.dma_buffer),this.dma_syncbuffer=new it(this.dma_buffer),this.dma_paused?this.bus.send("dac-disable"):this.bus.send("dac-enable")};_e.prototype.port2x0_read=function(){return 255};_e.prototype.port2x1_read=function(){return 255};_e.prototype.port2x2_read=function(){return 255};_e.prototype.port2x3_read=function(){return 255};_e.prototype.port2x4_read=function(){return this.mixer_current_address};_e.prototype.port2x5_read=function(){return this.mixer_read(this.mixer_current_address)};_e.prototype.port2x6_read=function(){return 255};_e.prototype.port2x7_read=function(){return 255};_e.prototype.port2x8_read=function(){return 255};_e.prototype.port2x9_read=function(){return 255};_e.prototype.port2xA_read=function(){return this.read_buffer.length&&(this.read_buffer_lastvalue=this.read_buffer.shift()),A(this.read_buffer_lastvalue),String.fromCharCode(this.read_buffer_lastvalue),this.read_buffer_lastvalue};_e.prototype.port2xB_read=function(){return 255};_e.prototype.port2xC_read=function(){return 127};_e.prototype.port2xD_read=function(){return 255};_e.prototype.port2xE_read=function(){return this.irq_triggered[1]&&this.lower_irq(1),(this.read_buffer.length&&!this.dsp_highspeed)<<7|127};_e.prototype.port2xF_read=function(){return this.lower_irq(2),0};_e.prototype.port2x0_write=function(e){A(e),this.fm_current_address0=0};_e.prototype.port2x1_write=function(e){A(e);var t=jn[this.fm_current_address0];t||(t=this.fm_default_write),t.call(this,e,0,this.fm_current_address0)};_e.prototype.port2x2_write=function(e){A(e),this.fm_current_address1=0};_e.prototype.port2x3_write=function(e){A(e);var t=jn[this.fm_current_address1];t||(t=this.fm_default_write),t.call(this,e,1,this.fm_current_address1)};_e.prototype.port2x4_write=function(e){A(e),this.mixer_current_address=e};_e.prototype.port2x5_write=function(e){A(e),this.mixer_write(this.mixer_current_address,e)};_e.prototype.port2x6_write=function(e){A(e),this.dsp_highspeed?this.dsp_highspeed=!1:e&&this.dsp_reset(),this.read_buffer.clear(),this.read_buffer.push(170)};_e.prototype.port2x7_write=function(){};_e.prototype.port2x8_write=function(){};_e.prototype.port2x9_write=function(){};_e.prototype.port2xA_write=function(){};_e.prototype.port2xB_write=function(){};_e.prototype.port2xC_write=function(e){this.command===0?(A(e),this.command=e,this.write_buffer.clear(),this.command_size=wh[e]):(A(e),this.write_buffer.push(e)),this.write_buffer.length>=this.command_size&&this.command_do()};_e.prototype.port2xD_write=function(){};_e.prototype.port2xE_write=function(){};_e.prototype.port2xF_write=function(){};_e.prototype.port3x0_read=function(){return this.mpu_read_buffer.length&&(this.mpu_read_buffer_lastvalue=this.mpu_read_buffer.shift()),A(this.mpu_read_buffer_lastvalue),this.mpu_read_buffer_lastvalue};_e.prototype.port3x0_write=function(e){A(e)};_e.prototype.port3x1_read=function(){return 0|128*!this.mpu_read_buffer.length};_e.prototype.port3x1_write=function(e){A(e),e===255&&(this.mpu_read_buffer.clear(),this.mpu_read_buffer.push(254))};_e.prototype.command_do=function(){var e=Sh[this.command];e||(e=this.dsp_default_handler),e.call(this),this.command_size=this.command=0,this.write_buffer.clear()};_e.prototype.dsp_default_handler=function(){A(this.command)};function Ee(e,t,i){i||(i=_e.prototype.dsp_default_handler);for(var s=0;s<e.length;s++)wh[e[s]]=t,Sh[e[s]]=i}function Eh(e){for(var t=[],i=0;16>i;i++)t.push(e+i);return t}Ee([14],2,function(){this.asp_registers[this.write_buffer.shift()]=this.write_buffer.shift()});Ee([15],1,function(){this.read_buffer.clear(),this.read_buffer.push(this.asp_registers[this.write_buffer.shift()])});Ee([16],1,function(){var e=this.write_buffer.shift();e=kh(e/127.5+-1,-1,1),this.dac_buffers[0].push(e),this.dac_buffers[1].push(e),this.bus.send("dac-enable")});Ee([20,21],2,function(){this.dma_irq=1,this.dma_channel=this.dma_channel_8bit,this.dsp_highspeed=this.dsp_16bit=this.dsp_signed=this.dma_autoinit=!1,this.dma_transfer_size_set(),this.dma_transfer_start()});Ee([22],2);Ee([23],2);Ee([28],0,function(){this.dma_irq=1,this.dma_channel=this.dma_channel_8bit,this.dma_autoinit=!0,this.dsp_highspeed=this.dsp_16bit=this.dsp_signed=!1,this.dma_transfer_start()});Ee([31],0);Ee([32],0,function(){this.read_buffer.clear(),this.read_buffer.push(127)});Ee([36],2);Ee([44],0);Ee([48],0);Ee([49],0);Ee([52],0);Ee([53],0);Ee([54],0);Ee([55],0);Ee([56],0);Ee([64],1,function(){this.sampling_rate_change(1e6/(256-this.write_buffer.shift())/this.get_channel_count())});Ee([65,66],2,function(){this.sampling_rate_change(this.write_buffer.shift()<<8|this.write_buffer.shift())});Ee([72],2,function(){this.dma_transfer_size_set()});Ee([116],2);Ee([117],2);Ee([118],2);Ee([119],2);Ee([125],0);Ee([127],0);Ee([128],2);Ee([144],0,function(){this.dma_irq=1,this.dma_channel=this.dma_channel_8bit,this.dma_autoinit=!0,this.dsp_signed=!1,this.dsp_highspeed=!0,this.dsp_16bit=!1,this.dma_transfer_start()});Ee([145],0);Ee([152],0);Ee([153],0);Ee([160],0);Ee([168],0);Ee(Eh(176),3,function(){if(this.command&8)this.dsp_default_handler();else{var e=this.write_buffer.shift();this.dma_irq=2,this.dma_channel=this.dma_channel_16bit,this.dma_autoinit=!!(this.command&4),this.dsp_signed=!!(e&16),this.dsp_stereo=!!(e&32),this.dsp_16bit=!0,this.dma_transfer_size_set(),this.dma_transfer_start()}});Ee(Eh(192),3,function(){if(this.command&8)this.dsp_default_handler();else{var e=this.write_buffer.shift();this.dma_irq=1,this.dma_channel=this.dma_channel_8bit,this.dma_autoinit=!!(this.command&4),this.dsp_signed=!!(e&16),this.dsp_stereo=!!(e&32),this.dsp_16bit=!1,this.dma_transfer_size_set(),this.dma_transfer_start()}});Ee([208],0,function(){this.dma_paused=!0,this.bus.send("dac-disable")});Ee([209],0,function(){this.dummy_speaker_enabled=!0});Ee([211],0,function(){this.dummy_speaker_enabled=!1});Ee([212],0,function(){this.dma_paused=!1,this.bus.send("dac-enable")});Ee([213],0,function(){this.dma_paused=!0,this.bus.send("dac-disable")});Ee([214],0,function(){this.dma_paused=!1,this.bus.send("dac-enable")});Ee([216],0,function(){this.read_buffer.clear(),this.read_buffer.push(255*this.dummy_speaker_enabled)});Ee([217,218],0,function(){this.dma_autoinit=!1});Ee([224],1,function(){this.read_buffer.clear(),this.read_buffer.push(~this.write_buffer.shift())});Ee([225],0,function(){this.read_buffer.clear(),this.read_buffer.push(4),this.read_buffer.push(5)});Ee([226],1);Ee([227],0,function(){this.read_buffer.clear();for(var e=0;44>e;e++)this.read_buffer.push("COPYRIGHT (C) CREATIVE TECHNOLOGY LTD, 1992.".charCodeAt(e));this.read_buffer.push(0)});Ee([228],1,function(){this.test_register=this.write_buffer.shift()});Ee([232],0,function(){this.read_buffer.clear(),this.read_buffer.push(this.test_register)});Ee([242,243],0,function(){this.raise_irq()});var vr=new Uint8Array(256);vr[14]=255;vr[15]=7;vr[55]=56;Ee([249],1,function(){var e=this.write_buffer.shift();this.read_buffer.clear(),this.read_buffer.push(vr[e])});_e.prototype.mixer_read=function(e){var t=mr[e];return t?t=t.call(this):(t=this.mixer_registers[e],A(e),A(t)),t};_e.prototype.mixer_write=function(e,t){var i=gr[e];i?i.call(this,t):(A(e),A(t))};_e.prototype.mixer_default_read=function(){return A(this.mixer_current_address),this.mixer_registers[this.mixer_current_address]};_e.prototype.mixer_default_write=function(e){A(this.mixer_current_address),A(e),this.mixer_registers[this.mixer_current_address]=e};_e.prototype.mixer_reset=function(){this.mixer_registers[4]=204,this.mixer_registers[34]=204,this.mixer_registers[38]=204,this.mixer_registers[40]=0,this.mixer_registers[46]=0,this.mixer_registers[10]=0,this.mixer_registers[48]=192,this.mixer_registers[49]=192,this.mixer_registers[50]=192,this.mixer_registers[51]=192,this.mixer_registers[52]=192,this.mixer_registers[53]=192,this.mixer_registers[54]=0,this.mixer_registers[55]=0,this.mixer_registers[56]=0,this.mixer_registers[57]=0,this.mixer_registers[59]=0,this.mixer_registers[60]=31,this.mixer_registers[61]=21,this.mixer_registers[62]=11,this.mixer_registers[63]=0,this.mixer_registers[64]=0,this.mixer_registers[65]=0,this.mixer_registers[66]=0,this.mixer_registers[67]=0,this.mixer_registers[68]=128,this.mixer_registers[69]=128,this.mixer_registers[70]=128,this.mixer_registers[71]=128,this.mixer_full_update()};_e.prototype.mixer_full_update=function(){for(var e=1;e<this.mixer_registers.length;e++)Ch[e]||this.mixer_write(e,this.mixer_registers[e])};function Wt(e,t){t||(t=_e.prototype.mixer_default_read),mr[e]=t}function si(e,t){t||(t=_e.prototype.mixer_default_write),gr[e]=t}function Us(e,t,i){Ch[e]=1,mr[e]=function(){return this.mixer_registers[t]&240|this.mixer_registers[i]>>>4},gr[e]=function(s){this.mixer_registers[e]=s;var n=s<<4&240|this.mixer_registers[i]&15;this.mixer_write(t,s&240|this.mixer_registers[t]&15),this.mixer_write(i,n)}}function yr(e,t,i){mr[e]=_e.prototype.mixer_default_read,gr[e]=function(s){this.mixer_registers[e]=s,this.bus.send("mixer-volume",[t,i,(s>>>2)-62])}}Wt(0,function(){return this.mixer_reset(),0});si(0);Us(4,50,51);Us(34,48,49);Us(38,52,53);Us(40,54,55);Us(46,56,57);yr(48,0,0);yr(49,0,1);yr(50,2,0);yr(51,2,1);Wt(59);si(59,function(e){this.mixer_registers[59]=e,this.bus.send("mixer-volume",[1,2,6*(e>>>6)-18])});Wt(65);si(65,function(e){this.mixer_registers[65]=e,this.bus.send("mixer-gain-left",6*(e>>>6))});Wt(66);si(66,function(e){this.mixer_registers[66]=e,this.bus.send("mixer-gain-right",6*(e>>>6))});Wt(68);si(68,function(e){this.mixer_registers[68]=e,e>>>=3,this.bus.send("mixer-treble-left",e-(16>e?14:16))});Wt(69);si(69,function(e){this.mixer_registers[69]=e,e>>>=3,this.bus.send("mixer-treble-right",e-(16>e?14:16))});Wt(70);si(70,function(e){this.mixer_registers[70]=e,e>>>=3,this.bus.send("mixer-bass-right",e-(16>e?14:16))});Wt(71);si(71,function(e){this.mixer_registers[71]=e,e>>>=3,this.bus.send("mixer-bass-right",e-(16>e?14:16))});Wt(128,function(){switch(this.irq){case 2:return 1;case 5:return 2;case 7:return 4;case 10:return 8;default:return 0}});si(128,function(e){e&1&&(this.irq=2),e&2&&(this.irq=5),e&4&&(this.irq=7),e&8&&(this.irq=10)});Wt(129,function(){var e=0;switch(this.dma_channel_8bit){case 0:e|=1;break;case 1:e|=2;break;case 3:e|=8}switch(this.dma_channel_16bit){case 5:e|=32;break;case 6:e|=64;break;case 7:e|=128}return e});si(129,function(e){e&1&&(this.dma_channel_8bit=0),e&2&&(this.dma_channel_8bit=1),e&8&&(this.dma_channel_8bit=3),e&32&&(this.dma_channel_16bit=5),e&64&&(this.dma_channel_16bit=6),e&128&&(this.dma_channel_16bit=7)});Wt(130,function(){for(var e=32,t=0;16>t;t++)e|=t*this.irq_triggered[t];return e});_e.prototype.fm_default_write=function(e,t,i){A(i),A(e)};function Et(e,t){t||(t=_e.prototype.fm_default_write);for(var i=0;i<e.length;i++)jn[e[i]]=t}function Ri(e,t){for(var i=[];e<=t;e++)i.push(e);return i}const dt=new Uint8Array(32);dt[0]=0;dt[1]=1;dt[2]=2;dt[3]=3;dt[4]=4;dt[5]=5;dt[8]=6;dt[9]=7;dt[10]=8;dt[11]=9;dt[12]=10;dt[13]=11;dt[16]=12;dt[17]=13;dt[18]=14;dt[19]=15;dt[20]=16;dt[21]=17;Et([1],function(e,t){this.fm_waveform_select_enable[t]=e&1,this.fm_update_waveforms()});Et([2]);Et([3]);Et([4],function(){});Et([5],function(e,t,i){t===0&&this.fm_default_write(e,t,i)});Et([8],function(){});Et(Ri(32,53),function(){});Et(Ri(64,85),function(){});Et(Ri(96,117),function(){});Et(Ri(128,149),function(){});Et(Ri(160,168),function(){});Et(Ri(176,184),function(){});Et([189],function(){});Et(Ri(192,200),function(){});Et(Ri(224,245),function(){});_e.prototype.fm_update_waveforms=function(){};_e.prototype.sampling_rate_change=function(e){this.sampling_rate=e,this.bus.send("dac-tell-sampling-rate",e)};_e.prototype.get_channel_count=function(){return this.dsp_stereo?2:1};_e.prototype.dma_transfer_size_set=function(){this.dma_sample_count=1+(this.write_buffer.shift()<<0)+(this.write_buffer.shift()<<8)};_e.prototype.dma_transfer_start=function(){this.bytes_per_sample=1,this.dsp_16bit&&(this.bytes_per_sample*=2),this.dma_bytes_count=this.dma_sample_count*this.bytes_per_sample,this.dma_bytes_block=1024*this.bytes_per_sample,this.dma_bytes_block=Math.min(Math.max(this.dma_bytes_count>>2&-4,32),this.dma_bytes_block),this.dma_waiting_transfer=!0,this.dma.channel_mask[this.dma_channel]||this.dma_on_unmask(this.dma_channel)};_e.prototype.dma_on_unmask=function(e){e===this.dma_channel&&this.dma_waiting_transfer&&(this.dma_waiting_transfer=!1,this.dma_bytes_left=this.dma_bytes_count,this.dma_paused=!1,this.bus.send("dac-enable"))};_e.prototype.dma_transfer_next=function(){var e=Math.min(this.dma_bytes_left,this.dma_bytes_block),t=Math.floor(e/this.bytes_per_sample);this.dma.do_write(this.dma_syncbuffer,0,e,this.dma_channel,i=>{i||(this.dma_to_dac(t),this.dma_bytes_left-=e,this.dma_bytes_left||(this.raise_irq(this.dma_irq),this.dma_autoinit&&(this.dma_bytes_left=this.dma_bytes_count)))})};_e.prototype.dma_to_dac=function(e){for(var t=this.dsp_16bit?32767.5:127.5,i=this.dsp_signed?0:-1,s=this.dsp_stereo?1:2,n=this.dsp_16bit?this.dsp_signed?this.dma_buffer_int16:this.dma_buffer_uint16:this.dsp_signed?this.dma_buffer_int8:this.dma_buffer_uint8,o=0,c=0;c<e;c++)for(var r=kh(n[c]/t+i,-1,1),a=0;a<s;a++)this.dac_buffers[o].push(r),o^=1;this.dac_send()};_e.prototype.dac_handle_request=function(){!this.dma_bytes_left||this.dma_paused?this.dac_send():this.dma_transfer_next()};_e.prototype.dac_send=function(){if(this.dac_buffers[0].length){var e=this.dac_buffers[0].shift_block(this.dac_buffers[0].length),t=this.dac_buffers[1].shift_block(this.dac_buffers[1].length);this.bus.send("dac-send-data",[e,t],[e.buffer,t.buffer])}};_e.prototype.raise_irq=function(e){this.irq_triggered[e]=1,this.cpu.device_raise_irq(this.irq)};_e.prototype.lower_irq=function(e){this.irq_triggered[e]=0,this.cpu.device_lower_irq(this.irq)};function kh(e,t,i){return(e<t)*t+(e>i)*i+(t<=e&&e<=i)*e}function Yi(e){this.message=e}Yi.prototype=Error();const Jp={Uint8Array,Int8Array,Uint16Array,Int16Array,Uint32Array,Int32Array,Float32Array,Float64Array};function wn(e,t){if(typeof e!="object"||e===null)return e;if(Array.isArray(e))return e.map(n=>wn(n,t));if(e.constructor===Object&&console.log(e),e.BYTES_PER_ELEMENT){var i=new Uint8Array(e.buffer,e.byteOffset,e.length*e.BYTES_PER_ELEMENT);return{__state_type__:e.constructor.name.replace("bound ",""),buffer_id:t.push(i)-1}}e=e.get_state(),i=[];for(var s=0;s<e.length;s++)i[s]=wn(e[s],t);return i}function Sn(e,t){if(typeof e!="object"||e===null)return e;if(Array.isArray(e)){for(let i=0;i<e.length;i++)e[i]=Sn(e[i],t);return e}return new Jp[e.__state_type__](t[e.buffer_id])}function Qp(e,t){function i(m,g){const C=m.length;if(16>C)throw new Yi("Invalid length: "+C);if(m=new Int32Array(m.buffer,m.byteOffset,4),m[0]!==-2039052682)throw new Yi("Invalid header: "+A(m[0]>>>0));if(m[1]!==6)throw new Yi("Version mismatch: dump="+m[1]+" we=6");if(g&&m[2]!==C)throw new Yi("Length doesn't match header: real="+C+" header="+m[2]);return m[3]}function s(m){return m=new TextDecoder().decode(m),JSON.parse(m)}if(t=new Uint8Array(t),new Uint32Array(t.buffer,0,1)[0]===4247762216){var n=e.zstd_create_ctx(t.length);new Uint8Array(e.wasm_memory.buffer,e.zstd_get_src_ptr(n),t.length).set(t);var o=e.zstd_read(n,16),c=new Uint8Array(e.wasm_memory.buffer,o,16),r=i(c,!1);e.zstd_read_free(o,16),o=e.zstd_read(n,r),c=new Uint8Array(e.wasm_memory.buffer,o,r),c=s(c),e.zstd_read_free(o,r),o=c.state;var a=c.buffer_infos;c=[],r=16+r;for(var u of a){if(a=(r+3&-4)-r,1048576<u.length){var _=e.zstd_read(n,a);e.zstd_read_free(_,a),_=new Uint8Array(u.length),c.push(_.buffer);for(var l=0;l<u.length;){const m=Math.min(u.length-l,1048576),g=e.zstd_read(n,m);_.set(new Uint8Array(e.wasm_memory.buffer,g,m),l),e.zstd_read_free(g,m),l+=m}}else _=e.zstd_read(n,a+u.length),l=_+a,c.push(e.wasm_memory.buffer.slice(l,l+u.length)),e.zstd_read_free(_,a+u.length);r+=a+u.length}o=Sn(o,c),e.set_state(o),e.zstd_free_ctx(n)}else{if(n=i(t,!0),0>n||n+12>=t.length)throw new Yi("Invalid info block length: "+n);u=t.subarray(16,16+n),o=s(u),u=o.state,o=o.buffer_infos;let m=16+n;m=m+3&-4,n=o.map(g=>{const C=m+g.offset;return t.buffer.slice(C,C+g.length)}),u=Sn(u,n),e.set_state(u)}}function gs(e,t,i,s,n){let o="";var c=[],r=t?"compiled":i?"jit exit":s?"unguarded register":n?"wasm size":"executed";for(let _=0;256>_;_++)for(let l=0;8>l;l++)for(const m of[!1,!0]){var a=e.wm.exports.get_opstats_buffer(t,i,s,n,_,!1,m,l);c.push({opcode:_,count:a,is_mem:m,fixed_g:l}),a=e.wm.exports.get_opstats_buffer(t,i,s,n,_,!0,m,l),c.push({opcode:3840|_,count:a,is_mem:m,fixed_g:l})}e=0,t=new Set([38,46,54,62,100,101,102,103,240,242,243]);for(const{count:_,opcode:l}of c)t.has(l)||(e+=_);if(e===0)return"";i=new Uint32Array(256),t=new Uint32Array(256);for(const{opcode:_,count:l}of c)(_&65280)===3840?t[_&255]+=l:i[_&255]+=l;o=o+`------------------
Total: `+(e+`
`);const u=1e7<e?1e3:1;for(s=Math.max.apply(Math,c.map(({count:_})=>Math.round(_/u))),s=String(s).length,o+=`Instruction counts ${r} (in ${u}):
`,n=0;256>n;n++)o+=n.toString(16).padStart(2,"0")+":"+_a(Math.round(i[n]/u),s),o=n%16===15?o+`
`:o+" ";for(o=o+`
Instruction counts ${r} (0f, in ${u}):
`,r=0;256>r;r++)o+=(r&255).toString(16).padStart(2,"0")+":"+_a(Math.round(t[r]/u),s),o=r%16===15?o+`
`:o+" ";o+=`
`,c=c.filter(({count:_})=>_).sort(({count:_},{count:l})=>l-_);for(const{opcode:_,is_mem:l,fixed_g:m,count:g}of c.slice(0,200))c=_.toString(16)+"_"+m+(l?"_m":"_r"),o+=c+":"+(g/e*100).toFixed(2)+" ";return o+`
`}function Mt(e){this.cpu=e,this.cmos_index=0,this.cmos_data=new Uint8Array(128),this.last_update=this.rtc_time=Date.now(),this.next_interrupt_alarm=this.next_interrupt=0,this.periodic_interrupt=!1,this.periodic_interrupt_time=.9765625,this.cmos_a=38,this.cmos_b=2,this.nmi_disabled=this.cmos_diag_status=this.cmos_c=0,this.update_interrupt=!1,this.update_interrupt_time=0,e.io.register_write(112,this,function(t){this.cmos_index=t&127,this.nmi_disabled=t>>7}),e.io.register_write(113,this,this.cmos_port_write),e.io.register_read(113,this,this.cmos_port_read)}Mt.prototype.get_state=function(){var e=[];return e[0]=this.cmos_index,e[1]=this.cmos_data,e[2]=this.rtc_time,e[3]=this.last_update,e[4]=this.next_interrupt,e[5]=this.next_interrupt_alarm,e[6]=this.periodic_interrupt,e[7]=this.periodic_interrupt_time,e[8]=this.cmos_a,e[9]=this.cmos_b,e[10]=this.cmos_c,e[11]=this.nmi_disabled,e[12]=this.update_interrupt,e[13]=this.update_interrupt_time,e[14]=this.cmos_diag_status,e};Mt.prototype.set_state=function(e){this.cmos_index=e[0],this.cmos_data=e[1],this.rtc_time=e[2],this.last_update=e[3],this.next_interrupt=e[4],this.next_interrupt_alarm=e[5],this.periodic_interrupt=e[6],this.periodic_interrupt_time=e[7],this.cmos_a=e[8],this.cmos_b=e[9],this.cmos_c=e[10],this.nmi_disabled=e[11],this.update_interrupt=e[12]||!1,this.update_interrupt_time=e[13]||0,this.cmos_diag_status=e[14]||0};Mt.prototype.timer=function(e){e=Date.now(),this.rtc_time+=e-this.last_update,this.last_update=e,this.periodic_interrupt&&this.next_interrupt<e?(this.cpu.device_raise_irq(8),this.cmos_c|=192,this.next_interrupt+=this.periodic_interrupt_time*Math.ceil((e-this.next_interrupt)/this.periodic_interrupt_time)):this.next_interrupt_alarm&&this.next_interrupt_alarm<e?(this.cpu.device_raise_irq(8),this.cmos_c|=160,this.next_interrupt_alarm=0):this.update_interrupt&&this.update_interrupt_time<e&&(this.cpu.device_raise_irq(8),this.cmos_c|=144,this.update_interrupt_time=e+1e3);let t=100;return this.periodic_interrupt&&this.next_interrupt&&(t=Math.min(t,Math.max(0,this.next_interrupt-e))),this.next_interrupt_alarm&&(t=Math.min(t,Math.max(0,this.next_interrupt_alarm-e))),this.update_interrupt&&(t=Math.min(t,Math.max(0,this.update_interrupt_time-e))),t};Mt.prototype.bcd_pack=function(e){for(var t=0,i=0,s;e;)s=e%10,i|=s<<4*t,t++,e=(e-s)/10;return i};Mt.prototype.bcd_unpack=function(e){return(e&15)+10*(e>>4&15)};Mt.prototype.encode_time=function(e){return this.cmos_b&4?e:this.bcd_pack(e)};Mt.prototype.decode_time=function(e){return this.cmos_b&4?e:this.bcd_unpack(e)};Mt.prototype.cmos_port_read=function(){var e=this.cmos_index;switch(e){case 0:return A(this.encode_time(new Date(this.rtc_time).getUTCSeconds())),this.encode_time(new Date(this.rtc_time).getUTCSeconds());case 2:return A(this.encode_time(new Date(this.rtc_time).getUTCMinutes())),this.encode_time(new Date(this.rtc_time).getUTCMinutes());case 4:return A(this.encode_time(new Date(this.rtc_time).getUTCHours())),this.encode_time(new Date(this.rtc_time).getUTCHours());case 6:return A(this.encode_time(new Date(this.rtc_time).getUTCDay()+1)),this.encode_time(new Date(this.rtc_time).getUTCDay()+1);case 7:return A(this.encode_time(new Date(this.rtc_time).getUTCDate())),this.encode_time(new Date(this.rtc_time).getUTCDate());case 8:return A(this.encode_time(new Date(this.rtc_time).getUTCMonth()+1)),this.encode_time(new Date(this.rtc_time).getUTCMonth()+1);case 9:return A(this.encode_time(new Date(this.rtc_time).getUTCFullYear()%100)),this.encode_time(new Date(this.rtc_time).getUTCFullYear()%100);case 10:return 999<=Pe.microtick()%1e3?this.cmos_a|128:this.cmos_a;case 11:return this.cmos_b;case 12:return this.cpu.device_lower_irq(8),e=this.cmos_c,this.cmos_c&=-241,e;case 13:return 128;case 14:return this.cmos_diag_status;case 50:case 55:return A(this.encode_time(new Date(this.rtc_time).getUTCFullYear()/100|0)),this.encode_time(new Date(this.rtc_time).getUTCFullYear()/100|0);default:return A(e),this.cmos_data[this.cmos_index]}};Mt.prototype.cmos_port_write=function(e){switch(this.cmos_index){case 10:this.cmos_a=e&127,this.periodic_interrupt_time=1e3/(32768>>(this.cmos_a&15)-1),A(this.cmos_a,2);break;case 11:if(this.cmos_b=e,this.cmos_b&128&&(this.cmos_b&=239),this.cmos_b&64&&(this.next_interrupt=Date.now()),this.cmos_b&32){e=new Date;const t=this.decode_time(this.cmos_data[1]),i=this.decode_time(this.cmos_data[3]),s=this.decode_time(this.cmos_data[5]);this.next_interrupt_alarm=+new Date(Date.UTC(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate(),s,i,t))}this.cmos_b&16&&(this.update_interrupt_time=Date.now()),A(this.cmos_b,2);break;case 14:this.cmos_diag_status=e;break;case 1:case 3:case 5:this.cmos_write(this.cmos_index,e);break;default:A(this.cmos_index),A(e)}this.update_interrupt=(this.cmos_b&16)===16&&0<(this.cmos_a&15),this.periodic_interrupt=(this.cmos_b&64)===64&&0<(this.cmos_a&15)};Mt.prototype.cmos_read=function(e){return this.cmos_data[e]};Mt.prototype.cmos_write=function(e,t){A(e),A(t),this.cmos_data[e]=t};function ri(e,t){this.cpu=e,this.bus=t,this.counter_start_time=new Float64Array(3),this.counter_start_value=new Uint16Array(3),this.counter_next_low=new Uint8Array(4),this.counter_enabled=new Uint8Array(4),this.counter_mode=new Uint8Array(4),this.counter_read_mode=new Uint8Array(4),this.counter_latch=new Uint8Array(4),this.counter_latch_value=new Uint16Array(3),this.counter_reload=new Uint16Array(3),e.io.register_read(97,this,function(){var i=Pe.microtick(),s=66.66666666666667*i&1;return i=this.did_rollover(2,i),s<<4|i<<5}),e.io.register_write(97,this,function(i){i&1?this.bus.send("pcspeaker-enable"):this.bus.send("pcspeaker-disable")}),e.io.register_read(64,this,function(){return this.counter_read(0)}),e.io.register_read(65,this,function(){return this.counter_read(1)}),e.io.register_read(66,this,function(){return this.counter_read(2)}),e.io.register_write(64,this,function(i){this.counter_write(0,i)}),e.io.register_write(65,this,function(i){this.counter_write(1,i)}),e.io.register_write(66,this,function(i){this.counter_write(2,i),this.bus.send("pcspeaker-update",[this.counter_mode[2],this.counter_reload[2]])}),e.io.register_write(67,this,this.port43_write)}ri.prototype.get_state=function(){var e=[];return e[0]=this.counter_next_low,e[1]=this.counter_enabled,e[2]=this.counter_mode,e[3]=this.counter_read_mode,e[4]=this.counter_latch,e[5]=this.counter_latch_value,e[6]=this.counter_reload,e[7]=this.counter_start_time,e[8]=this.counter_start_value,e};ri.prototype.set_state=function(e){this.counter_next_low=e[0],this.counter_enabled=e[1],this.counter_mode=e[2],this.counter_read_mode=e[3],this.counter_latch=e[4],this.counter_latch_value=e[5],this.counter_reload=e[6],this.counter_start_time=e[7],this.counter_start_value=e[8]};ri.prototype.timer=function(e,t){var i=100;return t||(this.counter_enabled[0]&&this.did_rollover(0,e)?(this.counter_start_value[0]=this.get_counter_value(0,e),this.counter_start_time[0]=e,this.cpu.device_lower_irq(0),this.cpu.device_raise_irq(0),this.counter_mode[0]===0&&(this.counter_enabled[0]=0)):this.cpu.device_lower_irq(0),this.counter_enabled[0]&&(i=(this.counter_start_value[0]-Math.floor(1193.1816666*(e-this.counter_start_time[0])))/1193.1816666)),i};ri.prototype.get_counter_value=function(e,t){return this.counter_enabled[e]?(t=this.counter_start_value[e]-Math.floor(1193.1816666*(t-this.counter_start_time[e])),e=this.counter_reload[e],t>=e?t%=e:0>t&&(t=t%e+e),t):0};ri.prototype.did_rollover=function(e,t){return t-=this.counter_start_time[e],0>t?!0:this.counter_start_value[e]<Math.floor(1193.1816666*t)};ri.prototype.counter_read=function(e){var t=this.counter_latch[e];return t?(this.counter_latch[e]--,t===2?this.counter_latch_value[e]&255:this.counter_latch_value[e]>>8):(t=this.counter_next_low[e],this.counter_mode[e]===3&&(this.counter_next_low[e]^=1),e=this.get_counter_value(e,Pe.microtick()),t?e&255:e>>8)};ri.prototype.counter_write=function(e,t){this.counter_reload[e]=this.counter_next_low[e]?this.counter_reload[e]&-256|t:this.counter_reload[e]&255|t<<8,this.counter_read_mode[e]===3&&this.counter_next_low[e]||(this.counter_reload[e]||(this.counter_reload[e]=65535),this.counter_start_value[e]=this.counter_reload[e],this.counter_enabled[e]=!0,this.counter_start_time[e]=Pe.microtick(),A(this.counter_reload[e])),this.counter_read_mode[e]===3&&(this.counter_next_low[e]^=1)};ri.prototype.port43_write=function(e){var t=e>>1&7,i=e>>6&3;e=e>>4&3,i!==3&&(e===0?(this.counter_latch[i]=2,t=this.get_counter_value(i,Pe.microtick()),this.counter_latch_value[i]=t?t-1:0):(6<=t&&(t&=-5),this.counter_next_low[i]=e===1?1:e===2?0:1,i===0&&this.cpu.device_lower_irq(0),t!==0&&t!==3&&t!==2&&A(t),this.counter_mode[i]=t,this.counter_read_mode[i]=e,i===2&&this.bus.send("pcspeaker-update",[this.counter_mode[2],this.counter_reload[2]])))};ri.prototype.dump=function(){};function xh(e){if(typeof window<"u")if(window.AudioContext||window.webkitAudioContext){var t=window.AudioWorklet?Gn:Vn;this.bus=e,this.audio_context=window.AudioContext?new AudioContext:new webkitAudioContext,this.mixer=new as(e,this.audio_context),this.pcspeaker=new Ah(e,this.audio_context,this.mixer),this.dac=new t(e,this.audio_context,this.mixer),this.pcspeaker.start(),e.register("emulator-stopped",function(){this.audio_context.suspend()},this),e.register("emulator-started",function(){this.audio_context.resume()},this),e.register("speaker-confirm-initialized",function(){e.send("speaker-has-initialized")},this),e.send("speaker-has-initialized")}else console.warn("Web browser doesn't support Web Audio API")}xh.prototype.destroy=function(){this.audio_context&&this.audio_context.close(),this.audio_context=null,this.dac&&this.dac.node_processor&&this.dac.node_processor.port.close(),this.dac=null};function as(e,t){function i(s){return function(n){s.gain.setValueAtTime(n,this.audio_context.currentTime)}}this.audio_context=t,this.sources=new Map,this.gain_right=this.gain_left=this.volume_right=this.volume_left=this.volume_both=1,this.node_treble_left=this.audio_context.createBiquadFilter(),this.node_treble_right=this.audio_context.createBiquadFilter(),this.node_treble_left.type="highshelf",this.node_treble_right.type="highshelf",this.node_treble_left.frequency.setValueAtTime(2e3,this.audio_context.currentTime),this.node_treble_right.frequency.setValueAtTime(2e3,this.audio_context.currentTime),this.node_bass_left=this.audio_context.createBiquadFilter(),this.node_bass_right=this.audio_context.createBiquadFilter(),this.node_bass_left.type="lowshelf",this.node_bass_right.type="lowshelf",this.node_bass_left.frequency.setValueAtTime(200,this.audio_context.currentTime),this.node_bass_right.frequency.setValueAtTime(200,this.audio_context.currentTime),this.node_gain_left=this.audio_context.createGain(),this.node_gain_right=this.audio_context.createGain(),this.node_merger=this.audio_context.createChannelMerger(2),this.input_left=this.node_treble_left,this.input_right=this.node_treble_right,this.node_treble_left.connect(this.node_bass_left),this.node_bass_left.connect(this.node_gain_left),this.node_gain_left.connect(this.node_merger,0,0),this.node_treble_right.connect(this.node_bass_right),this.node_bass_right.connect(this.node_gain_right),this.node_gain_right.connect(this.node_merger,0,1),this.node_merger.connect(this.audio_context.destination),e.register("mixer-connect",function(s){this.connect_source(s[0],s[1])},this),e.register("mixer-disconnect",function(s){this.disconnect_source(s[0],s[1])},this),e.register("mixer-volume",function(s){var n=s[0],o=s[1];s=Math.pow(10,s[2]/20),n=n===0?this:this.sources.get(n),n===void 0||n.set_volume(s,o)},this),e.register("mixer-gain-left",function(s){this.gain_left=Math.pow(10,s/20),this.update()},this),e.register("mixer-gain-right",function(s){this.gain_right=Math.pow(10,s/20),this.update()},this),e.register("mixer-treble-left",i(this.node_treble_left),this),e.register("mixer-treble-right",i(this.node_treble_right),this),e.register("mixer-bass-left",i(this.node_bass_left),this),e.register("mixer-bass-right",i(this.node_bass_right),this)}as.prototype.add_source=function(e,t){return e=new hs(this.audio_context,e,this.input_left,this.input_right),this.sources.has(t),this.sources.set(t,e),e};as.prototype.connect_source=function(e,t){e=this.sources.get(e),e===void 0||e.connect(t)};as.prototype.disconnect_source=function(e,t){e=this.sources.get(e),e===void 0||e.disconnect(t)};as.prototype.set_volume=function(e,t){switch(t===void 0&&(t=2),t){case 0:this.volume_left=e;break;case 1:this.volume_right=e;break;case 2:this.volume_both=e;break;default:return}this.update()};as.prototype.update=function(){var e=this.volume_both*this.volume_right*this.gain_right;this.node_gain_left.gain.setValueAtTime(this.volume_both*this.volume_left*this.gain_left,this.audio_context.currentTime),this.node_gain_right.gain.setValueAtTime(e,this.audio_context.currentTime)};function hs(e,t,i,s){this.audio_context=e,this.connected_right=this.connected_left=!0,this.volume_right=this.volume_left=this.volume_both=this.gain_hidden=1,this.node_splitter=e.createChannelSplitter(2),this.node_gain_left=e.createGain(),this.node_gain_right=e.createGain(),t.connect(this.node_splitter),this.node_splitter.connect(this.node_gain_left,0),this.node_gain_left.connect(i),this.node_splitter.connect(this.node_gain_right,1),this.node_gain_right.connect(s)}hs.prototype.update=function(){var e=this.connected_right*this.gain_hidden*this.volume_both*this.volume_right;this.node_gain_left.gain.setValueAtTime(this.connected_left*this.gain_hidden*this.volume_both*this.volume_left,this.audio_context.currentTime),this.node_gain_right.gain.setValueAtTime(e,this.audio_context.currentTime)};hs.prototype.connect=function(e){var t=!e||e===2;(t||e===0)&&(this.connected_left=!0),(t||e===1)&&(this.connected_right=!0),this.update()};hs.prototype.disconnect=function(e){var t=!e||e===2;(t||e===0)&&(this.connected_left=!1),(t||e===1)&&(this.connected_right=!1),this.update()};hs.prototype.set_volume=function(e,t){switch(t===void 0&&(t=2),t){case 0:this.volume_left=e;break;case 1:this.volume_right=e;break;case 2:this.volume_both=e;break;default:return}this.update()};hs.prototype.set_gain_hidden=function(e){this.gain_hidden=e};function Ah(e,t,i){this.node_oscillator=t.createOscillator(),this.node_oscillator.type="square",this.node_oscillator.frequency.setValueAtTime(440,t.currentTime),this.mixer_connection=i.add_source(this.node_oscillator,1),this.mixer_connection.disconnect(),e.register("pcspeaker-enable",function(){i.connect_source(1)},this),e.register("pcspeaker-disable",function(){i.disconnect_source(1)},this),e.register("pcspeaker-update",function(s){var n=s[1],o=0;s[0]===3&&(o=Math.min(1.1931816665999999e6/n,this.node_oscillator.frequency.maxValue),o=Math.max(o,0)),this.node_oscillator.frequency.setValueAtTime(o,t.currentTime)},this)}Ah.prototype.start=function(){this.node_oscillator.start()};function Gn(e,t,i){this.bus=e,this.audio_context=t,this.enabled=!1,this.sampling_rate=48e3,t=(function(){function c(u){return u===0?1:(u*=Math.PI,Math.sin(u)/u)}function r(){var u=Reflect.construct(AudioWorkletProcessor,[],r);return u.kernel_size=3,u.queue_data=Array(1024),u.queue_start=0,u.queue_end=0,u.queue_length=0,u.queue_size=u.queue_data.length,u.queued_samples=0,u.source_buffer_previous=a,u.source_buffer_current=a,u.source_samples_per_destination=1,u.source_block_start=0,u.source_time=0,u.source_offset=0,u.port.onmessage=_=>{switch(_.data.type){case"queue":u.queue_push(_.data.value);break;case"sampling-rate":u.source_samples_per_destination=_.data.value/sampleRate}},u}var a=[new Float32Array(256),new Float32Array(256)];Reflect.setPrototypeOf(r.prototype,AudioWorkletProcessor.prototype),Reflect.setPrototypeOf(r,AudioWorkletProcessor),r.prototype.process=r.prototype.process=function(u,_){for(u=0;u<_[0][0].length;u++){for(var l=0,m=0,g=this.source_offset+this.kernel_size,C=this.source_offset-this.kernel_size+1;C<=g;C++){var y=this.source_block_start+C;l+=this.get_sample(y,0)*this.kernel(this.source_time-C),m+=this.get_sample(y,1)*this.kernel(this.source_time-C)}(isNaN(l)||isNaN(m))&&(l=m=0,this.dbg_log("ERROR: NaN values! Ignoring for now.")),_[0][0][u]=l,_[0][1][u]=m,this.source_time+=this.source_samples_per_destination,this.source_offset=Math.floor(this.source_time)}return _=this.source_offset,_+=this.kernel_size+2,this.source_time-=this.source_offset,this.source_block_start+=this.source_offset,this.source_offset=0,this.ensure_enough_data(_),!0},r.prototype.kernel=function(u){return c(u)*c(u/this.kernel_size)},r.prototype.get_sample=function(u,_){return 0>u?(u+=this.source_buffer_previous[0].length,this.source_buffer_previous[_][u]):this.source_buffer_current[_][u]},r.prototype.ensure_enough_data=function(u){var _=this.source_buffer_current[0].length;_-this.source_block_start<u&&(this.prepare_next_buffer(),this.source_block_start-=_)},r.prototype.prepare_next_buffer=function(){256>this.queued_samples&&this.queue_length&&this.dbg_log("Not enough samples - should not happen during midway of playback"),this.source_buffer_previous=this.source_buffer_current,this.source_buffer_current=this.queue_shift();var u=this.source_buffer_current[0].length;if(256>u){for(var _=this.queue_start,l=0;256>u&&l<this.queue_length;)u+=this.queue_data[_][0].length,_=_+1&this.queue_size-1,l++;u=Math.max(u,256),u=[new Float32Array(u),new Float32Array(u)],u[0].set(this.source_buffer_current[0]),u[1].set(this.source_buffer_current[1]),_=this.source_buffer_current[0].length;for(var m=0;m<l;m++){var g=this.queue_shift();u[0].set(g[0],_),u[1].set(g[1],_),_+=g[0].length}this.source_buffer_current=u}this.pump()},r.prototype.pump=function(){1024>this.queued_samples/this.source_samples_per_destination&&this.port.postMessage({type:"pump"})},r.prototype.queue_push=function(u){this.queue_length<this.queue_size&&(this.queue_data[this.queue_end]=u,this.queue_end=this.queue_end+1&this.queue_size-1,this.queue_length++,this.queued_samples+=u[0].length,this.pump())},r.prototype.queue_shift=function(){if(!this.queue_length)return a;var u=this.queue_data[this.queue_start];return this.queue_data[this.queue_start]=null,this.queue_start=this.queue_start+1&this.queue_size-1,this.queue_length--,this.queued_samples-=u[0].length,u},r.prototype.dbg_log=function(){},registerProcessor("dac-processor",r)}).toString();var s=t.indexOf("{")+1,n=t.lastIndexOf("}");t=t.substring(s,n),t=new Blob([t],{type:"application/javascript"});var o=URL.createObjectURL(t);this.node_processor=null,this.node_output=this.audio_context.createGain(),this.audio_context.audioWorklet.addModule(o).then(()=>{URL.revokeObjectURL(o),this.node_processor=new AudioWorkletNode(this.audio_context,"dac-processor",{numberOfInputs:0,numberOfOutputs:1,outputChannelCount:[2],parameterData:{},processorOptions:{}}),this.node_processor.port.postMessage({type:"sampling-rate",value:this.sampling_rate}),this.node_processor.port.onmessage=c=>{switch(c.data.type){case"pump":this.pump()}},this.node_processor.connect(this.node_output)}),this.mixer_connection=i.add_source(this.node_output,2),this.mixer_connection.set_gain_hidden(3),e.register("dac-send-data",function(c){this.queue(c)},this),e.register("dac-enable",function(){this.enabled=!0},this),e.register("dac-disable",function(){this.enabled=!1},this),e.register("dac-tell-sampling-rate",function(c){this.sampling_rate=c,this.node_processor&&this.node_processor.port.postMessage({type:"sampling-rate",value:c})},this)}Gn.prototype.queue=function(e){this.node_processor&&this.node_processor.port.postMessage({type:"queue",value:e},[e[0].buffer,e[1].buffer])};Gn.prototype.pump=function(){this.enabled&&this.bus.send("dac-request-data")};function Vn(e,t,i){this.bus=e,this.audio_context=t,this.enabled=!1,this.sampling_rate=22050,this.buffered_time=0,this.rate_ratio=1,this.node_lowpass=this.audio_context.createBiquadFilter(),this.node_lowpass.type="lowpass",this.node_output=this.node_lowpass,this.mixer_connection=i.add_source(this.node_output,2),this.mixer_connection.set_gain_hidden(3),e.register("dac-send-data",function(s){this.queue(s)},this),e.register("dac-enable",function(){this.enabled=!0,this.pump()},this),e.register("dac-disable",function(){this.enabled=!1},this),e.register("dac-tell-sampling-rate",function(s){this.sampling_rate=s,this.rate_ratio=Math.ceil(8e3/s),this.node_lowpass.frequency.setValueAtTime(s/2,this.audio_context.currentTime)},this)}Vn.prototype.queue=function(e){var t=e[0].length,i=t/this.sampling_rate;if(1<this.rate_ratio)for(var s=this.audio_context.createBuffer(2,t*this.rate_ratio,this.sampling_rate*this.rate_ratio),n=s.getChannelData(0),o=s.getChannelData(1),c=0,r=0;r<t;r++)for(var a=0;a<this.rate_ratio;a++,c++)n[c]=e[0][r],o[c]=e[1][r];else s=this.audio_context.createBuffer(2,t,this.sampling_rate),s.copyToChannel?(s.copyToChannel(e[0],0),s.copyToChannel(e[1],1)):(s.getChannelData(0).set(e[0]),s.getChannelData(1).set(e[1]));if(e=this.audio_context.createBufferSource(),e.buffer=s,e.connect(this.node_lowpass),e.addEventListener("ended",this.pump.bind(this)),s=this.audio_context.currentTime,this.buffered_time<s)for(this.buffered_time=s,s=.2-i,t=0;t<=s;)t+=i,this.buffered_time+=i,setTimeout(()=>this.pump(),1e3*t);e.start(this.buffered_time),this.buffered_time+=i,setTimeout(()=>this.pump(),0)};Vn.prototype.pump=function(){this.enabled&&(.2<this.buffered_time-this.audio_context.currentTime||this.bus.send("dac-request-data"))};function _i(e,t,i){this.bus=t,this.socket=void 0,this.id=i||0,this.send_queue=[],this.url=e,this.reconnect_interval=1e4,this.last_connect_attempt=Date.now()-this.reconnect_interval,this.send_queue_limit=64,this.destroyed=!1,this.bus.register("net"+this.id+"-send",function(s){this.send(s)},this)}_i.prototype.handle_message=function(e){this.bus&&this.bus.send("net"+this.id+"-receive",new Uint8Array(e.data))};_i.prototype.handle_close=function(){this.destroyed||(this.connect(),setTimeout(this.connect.bind(this),this.reconnect_interval))};_i.prototype.handle_open=function(){for(var e=0;e<this.send_queue.length;e++)this.send(this.send_queue[e]);this.send_queue=[]};_i.prototype.handle_error=function(){};_i.prototype.destroy=function(){this.destroyed=!0,this.socket&&this.socket.close()};_i.prototype.connect=function(){if(typeof WebSocket<"u"){if(this.socket){var e=this.socket.readyState;if(e===0||e===1)return}if(e=Date.now(),!(this.last_connect_attempt+this.reconnect_interval>e)){this.last_connect_attempt=Date.now();try{this.socket=new WebSocket(this.url)}catch(t){console.error(t);return}this.socket.binaryType="arraybuffer",this.socket.onopen=this.handle_open.bind(this),this.socket.onmessage=this.handle_message.bind(this),this.socket.onclose=this.handle_close.bind(this),this.socket.onerror=this.handle_error.bind(this)}}};_i.prototype.send=function(e){this.socket&&this.socket.readyState===1?this.socket.send(e):(this.send_queue.push(e),this.send_queue.length>2*this.send_queue_limit&&(this.send_queue=this.send_queue.slice(-this.send_queue_limit)),this.connect())};_i.prototype.change_proxy=function(e){this.url=e,this.socket&&(this.socket.onclose=function(){},this.socket.onerror=function(){},this.socket.close(),this.socket=void 0)};const Zp=new Date("1970-01-01T00:00:00Z").getTime(),em=new Date("1900-01-01T00:00:00Z").getTime(),tm=Zp-em,im=Math.pow(2,32),sm=[118,56,54];function ma(e){return[0,1,2,3,4,5].map(t=>e[t].toString(16)).map(t=>t.length===1?"0"+t:t).join(":")}function Cs(e){return e[0]<<24|e[1]<<16|e[2]<<8|e[3]}class rm{constructor(t,i){t=Math.min(t,16),this.maximum_capacity=i?Math.max(i,t):0,this.length=this.head=this.tail=0,this.buffer=new Uint8Array(t)}write(t){const i=t.length;var s=this.length+i;let n=this.buffer.length;if(n<s){for(;n<s;)n*=2;if(this.maximum_capacity&&n>this.maximum_capacity)throw Error("stream capacity overflow in GrowableRingbuffer.write(), package dropped");s=new Uint8Array(n),this.peek(s),this.tail=0,this.head=this.length,this.buffer=s}s=this.buffer;const o=this.head+i;if(o>n){const c=n-this.head;s.set(t.subarray(0,c),this.head),s.set(t.subarray(c))}else s.set(t,this.head);this.head=o%n,this.length+=i}peek(t){const i=Math.min(this.length,t.length);if(i){const o=this.buffer;var s=o.length,n=this.tail+i;n>s?(n%=s,s-=this.tail,t.set(o.subarray(this.tail)),t.set(o.subarray(0,n),s)):t.set(o.subarray(this.tail,n))}return i}remove(t){return t>this.length&&(t=this.length),t&&(this.tail=(this.tail+t)%this.buffer.length,this.length-=t),t}}function Rh(){const e=new Uint8Array(1518),t=e.buffer,i=e.byteOffset;return{eth_frame:e,eth_frame_view:new DataView(t),eth_payload_view:new DataView(t,i+14,1500),ipv4_payload_view:new DataView(t,i+34,1480),udp_payload_view:new DataView(t,i+42,1472),text_encoder:new TextEncoder}}function xt(e,t,i,s){return s.eth_frame.set(t,i.byteOffset+e),t.length}function Xs(e,t,i,s){const n=i.byteOffset+(e&-2);for(s=s.eth_frame,i=i.byteOffset;i<n;i+=2)t+=s[i]<<8|s[i+1];for(e&1&&(t+=s[n]<<8);t>>>16;)t=(t&65535)+(t>>>16);return~t&65535}function at(e,t){e.eth_frame.fill(0);var i=e.eth_frame,s=i.subarray,n=e.eth_frame_view;if(xt(0,t.eth.dest,n,e),xt(6,t.eth.src,n,e),n.setUint16(12,t.eth.ethertype),n=14,t.arp){var o=e.eth_payload_view;o.setUint16(0,t.arp.htype),o.setUint16(2,t.arp.ptype),o.setUint8(4,t.arp.sha.length),o.setUint8(5,t.arp.spa.length),o.setUint16(6,t.arp.oper),xt(8,t.arp.sha,o,e),xt(14,t.arp.spa,o,e),xt(18,t.arp.tha,o,e),xt(24,t.arp.tpa,o,e),n+=28}else if(t.ipv4){o=e.eth_payload_view;var c=20;if(t.icmp){var r=e.ipv4_payload_view;r.setUint8(0,t.icmp.type),r.setUint8(1,t.icmp.code),r.setUint16(2,0);var a=4+xt(4,t.icmp.data,r,e);r.setUint16(2,Xs(a,0,r,e)),c+=a}else if(t.udp){r=e.ipv4_payload_view;var u=8;if(t.dhcp){a=u;var _=e.udp_payload_view;_.setUint8(0,t.dhcp.op),_.setUint8(1,t.dhcp.htype),_.setUint8(2,t.dhcp.hlen),_.setUint8(3,t.dhcp.hops),_.setUint32(4,t.dhcp.xid),_.setUint16(8,t.dhcp.secs),_.setUint16(10,t.dhcp.flags),_.setUint32(12,t.dhcp.ciaddr),_.setUint32(16,t.dhcp.yiaddr),_.setUint32(20,t.dhcp.siaddr),_.setUint32(24,t.dhcp.giaddr),xt(28,t.dhcp.chaddr,_,e),_.setUint32(236,1669485411),u=240;for(var l of t.dhcp.options)u+=xt(u,l,_,e);a+=u}else if(t.dns){l=u,u=e.udp_payload_view,u.setUint16(0,t.dns.id),u.setUint16(2,t.dns.flags),u.setUint16(4,t.dns.questions.length),u.setUint16(6,t.dns.answers.length);let C=12;for(var m=0;m<t.dns.questions.length;++m){var g=t.dns.questions[m];for(_ of g.name){const y=e.text_encoder.encodeInto(_,e.eth_frame.subarray(u.byteOffset+(C+1))).written;u.setUint8(C,y),C+=1+y}u.setUint16(C,g.type),C+=2,u.setUint16(C,g.class),C+=2}for(m=0;m<t.dns.answers.length;++m){_=t.dns.answers[m];for(a of _.name)g=e.text_encoder.encodeInto(a,e.eth_frame.subarray(u.byteOffset+(C+1))).written,u.setUint8(C,g),C+=1+g;u.setUint16(C,_.type),C+=2,u.setUint16(C,_.class),C+=2,u.setUint32(C,_.ttl),C+=4,u.setUint16(C,_.data.length),C+=2,C+=xt(C,_.data,u,e)}a=l+C}else t.ntp?(a=u,_=e.udp_payload_view,_.setUint8(0,t.ntp.flags),_.setUint8(1,t.ntp.stratum),_.setUint8(2,t.ntp.poll),_.setUint8(3,t.ntp.precision),_.setUint32(4,t.ntp.root_delay),_.setUint32(8,t.ntp.root_disp),_.setUint32(12,t.ntp.ref_id),_.setUint32(16,t.ntp.ref_ts_i),_.setUint32(20,t.ntp.ref_ts_f),_.setUint32(24,t.ntp.ori_ts_i),_.setUint32(28,t.ntp.ori_ts_f),_.setUint32(32,t.ntp.rec_ts_i),_.setUint32(36,t.ntp.rec_ts_f),_.setUint32(40,t.ntp.trans_ts_i),_.setUint32(44,t.ntp.trans_ts_f),a+=48):a=u+xt(0,t.udp.data,e.udp_payload_view,e);u=a,r.setUint16(0,t.udp.sport),r.setUint16(2,t.udp.dport),r.setUint16(4,u),r.setUint16(6,0),r.setUint16(6,Xs(u,(t.ipv4.src[0]<<8|t.ipv4.src[1])+(t.ipv4.src[2]<<8|t.ipv4.src[3])+(t.ipv4.dest[0]<<8|t.ipv4.dest[1])+(t.ipv4.dest[2]<<8|t.ipv4.dest[3])+17+u,r,e)),c+=u}else t.tcp&&(r=e.ipv4_payload_view,a=0,_=t.tcp,_.fin&&(a|=1),_.syn&&(a|=2),_.rst&&(a|=4),_.psh&&(a|=8),_.ack&&(a|=16),_.urg&&(a|=32),_.ece&&(a|=64),_.cwr&&(a|=128),r.setUint16(0,_.sport),r.setUint16(2,_.dport),r.setUint32(4,_.seq),r.setUint32(8,_.ackn),r.setUint8(12,80),r.setUint8(13,a),r.setUint16(14,_.winsize),r.setUint16(16,0),r.setUint16(18,_.urgent||0),a=20,t.tcp_data&&(a+=xt(20,t.tcp_data,r,e)),r.setUint16(16,Xs(a,(t.ipv4.src[0]<<8|t.ipv4.src[1])+(t.ipv4.src[2]<<8|t.ipv4.src[3])+(t.ipv4.dest[0]<<8|t.ipv4.dest[1])+(t.ipv4.dest[2]<<8|t.ipv4.dest[3])+6+a,r,e)),c+=a);o.setUint8(0,69),o.setUint8(1,t.ipv4.tos||0),o.setUint16(2,c),o.setUint16(4,t.ipv4.id||0),o.setUint8(6,64),o.setUint8(8,t.ipv4.ttl||32),o.setUint8(9,t.ipv4.proto),o.setUint16(10,0),xt(12,t.ipv4.src,o,e),xt(16,t.ipv4.dest,o,e),o.setUint16(10,Xs(20,0,o,e)),n+=c}return s.call(i,0,n)}function nm(e,t){return fetch(`https://${t.doh_server||"cloudflare-dns.com"}/dns-query`,{method:"POST",headers:[["content-type","application/dns-message"]],body:e.udp.data}).then(async i=>{i={eth:{ethertype:2048,src:t.router_mac,dest:e.eth.src},ipv4:{proto:17,src:t.router_ip,dest:e.ipv4.src},udp:{sport:53,dport:e.udp.sport,data:new Uint8Array(await i.arrayBuffer())}},t.receive(at(t.eth_encoder_buf,i))}),!0}function om(e,t){let i={};i.eth={ethertype:2048,src:t.router_mac,dest:e.eth.src},i.ipv4={proto:17,src:t.router_ip,dest:t.vm_ip},i.udp={sport:67,dport:68},i.dhcp={htype:1,hlen:6,hops:0,xid:e.dhcp.xid,secs:0,flags:0,ciaddr:0,yiaddr:Cs(t.vm_ip),siaddr:Cs(t.router_ip),giaddr:Cs(t.router_ip),chaddr:e.dhcp.chaddr};let s=[],n=e.dhcp.options.find(function(o){return o[0]===53});n&&n[2]===3&&(e.dhcp.op=3),e.dhcp.op===1&&(i.dhcp.op=2,s.push(new Uint8Array([53,1,2]))),e.dhcp.op===3&&(i.dhcp.op=2,s.push(new Uint8Array([53,1,5])),s.push(new Uint8Array([51,4,8,0,0,0]))),e=[t.router_ip[0],t.router_ip[1],t.router_ip[2],t.router_ip[3]],s.push(new Uint8Array([1,4,255,255,255,0])),t.masquerade&&(s.push(new Uint8Array([3,4].concat(e))),s.push(new Uint8Array([6,4].concat(e)))),s.push(new Uint8Array([54,4].concat(e))),s.push(new Uint8Array([60,3].concat(sm))),s.push(new Uint8Array([255,0])),i.dhcp.options=s,t.receive(at(t.eth_encoder_buf,i))}function Th(e,t){let i={};var s=new DataView(e.buffer,e.byteOffset,e.byteLength).getUint16(12),n={ethertype:s,dest:e.subarray(0,6),dest_s:ma(e.subarray(0,6)),src:e.subarray(6,12),src_s:ma(e.subarray(6,12))};if(i.eth=n,e=e.subarray(14,e.length),s===2048){var o=new DataView(e.buffer,e.byteOffset,e.byteLength),c=e[0]>>4&15;n=e[0]&15;var r=o.getUint8(1),a=o.getUint16(2);let u=o.getUint8(8);if(s=o.getUint8(9),o=o.getUint16(10),c={version:c,ihl:n,tos:r,len:a,ttl:u,proto:s,ip_checksum:o,src:e.subarray(12,16),dest:e.subarray(16,20)},i.ipv4=c,n=e.subarray(4*n,a),s===1)e=new DataView(n.buffer,n.byteOffset,n.byteLength),e={type:e.getUint8(0),code:e.getUint8(1),checksum:e.getUint16(2),data:n.subarray(4)},i.icmp=e;else if(s===6)s=new DataView(n.buffer,n.byteOffset,n.byteLength),e={sport:s.getUint16(0),dport:s.getUint16(2),seq:s.getUint32(4),ackn:s.getUint32(8),doff:s.getUint8(12)>>4,winsize:s.getUint16(14),checksum:s.getUint16(16),urgent:s.getUint16(18)},s=s.getUint8(13),e.fin=!!(s&1),e.syn=!!(s&2),e.rst=!!(s&4),e.psh=!!(s&8),e.ack=!!(s&16),e.urg=!!(s&32),e.ece=!!(s&64),e.cwr=!!(s&128),i.tcp=e,i.tcp_data=n.subarray(4*e.doff);else if(s===17){if(e=new DataView(n.buffer,n.byteOffset,n.byteLength),e={sport:e.getUint16(0),dport:e.getUint16(2),len:e.getUint16(4),checksum:e.getUint16(6),data:n.subarray(8),data_s:new TextDecoder().decode(n.subarray(8))},e.dport===67||e.sport===67){for(n=n.subarray(8),s=new DataView(n.buffer,n.byteOffset,n.byteLength),n.subarray(44,236),s={op:s.getUint8(0),htype:s.getUint8(1),hlen:s.getUint8(2),hops:s.getUint8(3),xid:s.getUint32(4),secs:s.getUint16(8),flags:s.getUint16(10),ciaddr:s.getUint32(12),yiaddr:s.getUint32(16),siaddr:s.getUint32(20),giaddr:s.getUint32(24),chaddr:n.subarray(28,44),magic:s.getUint32(236),options:[]},n=n.subarray(240),a=0;a<n.length;++a)c=a,n[a]!==0&&(++a,r=n[a],a+=r,s.options.push(n.subarray(c,c+r+2)));i.dhcp=s,i.dhcp_options=s.options}else e.dport===53||e.sport===53?am(n.subarray(8),i):e.dport===123&&(s=n.subarray(8),s=new DataView(s.buffer,s.byteOffset,s.byteLength),i.ntp={flags:s.getUint8(0),stratum:s.getUint8(1),poll:s.getUint8(2),precision:s.getUint8(3),root_delay:s.getUint32(4),root_disp:s.getUint32(8),ref_id:s.getUint32(12),ref_ts_i:s.getUint32(16),ref_ts_f:s.getUint32(20),ori_ts_i:s.getUint32(24),ori_ts_f:s.getUint32(28),rec_ts_i:s.getUint32(32),rec_ts_f:s.getUint32(36),trans_ts_i:s.getUint32(40),trans_ts_f:s.getUint32(44)});i.udp=e}}else s===2054?(s=new DataView(e.buffer,e.byteOffset,e.byteLength),e={htype:s.getUint16(0),ptype:s.getUint16(2),oper:s.getUint16(6),sha:e.subarray(8,14),spa:e.subarray(14,18),tha:e.subarray(18,24),tpa:e.subarray(24,28)},i.arp=e):s!==34525&&A(s);if(i.ipv4)if(i.tcp)e=`${i.ipv4.src.join(".")}:${i.tcp.sport}:${i.ipv4.dest.join(".")}:${i.tcp.dport}`,(!i.tcp.syn||!t.on_tcp_connection(i,e))&&(t.tcp_conn[e]?t.tcp_conn[e].process(i):(e=i.tcp.ackn,(i.tcp.fin||i.tcp.syn)&&(e+=1),s={},s.eth={ethertype:2048,src:t.router_mac,dest:i.eth.src},s.ipv4={proto:6,src:i.ipv4.dest,dest:i.ipv4.src},s.tcp={sport:i.tcp.dport,dport:i.tcp.sport,seq:e,ackn:i.tcp.seq+(i.tcp.syn?1:0),winsize:i.tcp.winsize,rst:!0,ack:i.tcp.syn},t.receive(at(t.eth_encoder_buf,s))));else if(i.udp)if(i.dns)if(t.dns_method==="static"){for(e={},e.eth={ethertype:2048,src:t.router_mac,dest:i.eth.src},e.ipv4={proto:17,src:t.router_ip,dest:i.ipv4.src},e.udp={sport:53,dport:i.udp.sport},s=[],n=0;n<i.dns.questions.length;++n)switch(a=i.dns.questions[n],a.type){case 1:s.push({name:a.name,type:a.type,class:a.class,ttl:600,data:[192,168,87,1]})}e.dns={id:i.dns.id,flags:33152,questions:i.dns.questions,answers:s},t.receive(at(t.eth_encoder_buf,e))}else nm(i,t);else i.dhcp?om(i,t):i.ntp?(e=Date.now()+tm,s=e%1e3/1e3*im,n={},n.eth={ethertype:2048,src:t.router_mac,dest:i.eth.src},n.ipv4={proto:17,src:i.ipv4.dest,dest:i.ipv4.src},n.udp={sport:123,dport:i.udp.sport},n.ntp=Object.assign({},i.ntp),n.ntp.flags=36,n.ntp.poll=10,n.ntp.ori_ts_i=i.ntp.trans_ts_i,n.ntp.ori_ts_f=i.ntp.trans_ts_f,n.ntp.rec_ts_i=e/1e3,n.ntp.rec_ts_f=s,n.ntp.trans_ts_i=e/1e3,n.ntp.trans_ts_f=s,n.ntp.stratum=2,t.receive(at(t.eth_encoder_buf,n))):i.udp.dport===8&&(e={},e.eth={ethertype:2048,src:t.router_mac,dest:i.eth.src},e.ipv4={proto:17,src:i.ipv4.dest,dest:i.ipv4.src},e.udp={sport:i.udp.dport,dport:i.udp.sport,data:new TextEncoder().encode(i.udp.data_s)},t.receive(at(t.eth_encoder_buf,e)));else i.icmp&&i.icmp.type===8&&(e={},e.eth={ethertype:2048,src:t.router_mac,dest:i.eth.src},e.ipv4={proto:1,src:i.ipv4.dest,dest:i.ipv4.src},e.icmp={type:0,code:i.icmp.code,data:i.icmp.data},t.receive(at(t.eth_encoder_buf,e)));else i.arp&&i.arp.oper===1&&i.arp.ptype===2048&&(e=Cs(i.arp.tpa)&4294967040,s=Cs(t.router_ip)&4294967040,!t.masquerade&&e!==s||e===s&&99<i.arp.tpa[3]||(e={},e.eth={ethertype:2054,src:t.router_mac,dest:i.eth.src},e.arp={htype:1,ptype:2048,oper:2,sha:t.router_mac,spa:i.arp.tpa,tha:i.eth.src,tpa:i.arp.spa},t.receive(at(t.eth_encoder_buf,e))))}function am(e,t){function i(){let u=[],_;do _=s.getUint8(r),u.push(new TextDecoder().decode(e.subarray(r+1,r+1+_))),r+=_+1;while(0<_);return u}let s=new DataView(e.buffer,e.byteOffset,e.byteLength),n={id:s.getUint16(0),flags:s.getUint16(2),questions:[],answers:[]};var o=s.getUint16(4);let c=s.getUint16(6);s.getUint16(8),s.getUint16(10);let r=12;for(var a=0;a<o;a++)n.questions.push({name:i(),type:s.getInt16(r),class:s.getInt16(r+2)}),r+=4;for(o=0;o<c;o++){a={name:i(),type:s.getInt16(r),class:s.getUint16(r+2),ttl:s.getUint32(r+4)},r+=8;let u=s.getUint16(r);r+=2,a.data=e.subarray(r,r+u),r+=u,n.answers.push(a)}t.dns=n}function Lh(e,t){var i=t.vm_ip.join(".");const s=t.router_ip.join("."),n=16383*Math.random()|0;let o,c,r=0;do o=49152+(n+r)%16383,c=`${i}:${e}:${s}:${o}`;while(16383>++r&&t.tcp_conn[c]);if(t.tcp_conn[c])throw Error("pool of dynamic TCP port numbers exhausted, connection aborted");return i=new gt,i.tuple=c,i.hsrc=t.router_mac,i.psrc=t.router_ip,i.sport=o,i.hdest=t.vm_mac,i.dport=e,i.pdest=t.vm_ip,i.net=t,t.tcp_conn[c]=i,i.connect(),i}function hm(e,t){return new Promise(i=>{let s=Lh(e,t);s.state="syn-probe",s.on("probe",i)})}function gt(){this.state="closed",this.net=null,this.send_buffer=new rm(2048,0),this.send_chunk_buf=new Uint8Array(1460),this.delayed_send_fin=this.in_active_close=!1,this.delayed_state=void 0,this.events_handlers={}}gt.prototype.on=function(e,t){this.events_handlers[e]=t};gt.prototype.emit=function(e,...t){this.events_handlers[e]&&this.events_handlers[e].apply(this,t)};gt.prototype.ipv4_reply=function(){let e={};return e.eth={ethertype:2048,src:this.hsrc,dest:this.hdest},e.ipv4={proto:6,src:this.psrc,dest:this.pdest},e.tcp={sport:this.sport,dport:this.dport,winsize:this.winsize,ackn:this.ack,seq:this.seq,ack:!0},e};gt.prototype.packet_reply=function(e,t){if(e={sport:e.tcp.dport,dport:e.tcp.sport,winsize:e.tcp.winsize,ackn:this.ack,seq:this.seq},t)for(const i in t)e[i]=t[i];return t=this.ipv4_reply(),t.tcp=e,t};gt.prototype.connect=function(){this.seq=1338,this.ack=1,this.start_seq=0,this.winsize=64240,this.state="syn-sent";let e=this.ipv4_reply();e.ipv4.id=2345,e.tcp={sport:this.sport,dport:this.dport,seq:1337,ackn:0,winsize:0,syn:!0},this.net.receive(at(this.net.eth_encoder_buf,e))};gt.prototype.accept=function(e){this.seq=1338,this.ack=e.tcp.seq+1,this.start_seq=e.tcp.seq,this.hsrc=this.net.router_mac,this.psrc=e.ipv4.dest,this.sport=e.tcp.dport,this.hdest=e.eth.src,this.dport=e.tcp.sport,this.pdest=e.ipv4.src,this.winsize=e.tcp.winsize;let t=this.ipv4_reply();t.tcp={sport:this.sport,dport:this.dport,seq:1337,ackn:this.ack,winsize:e.tcp.winsize,syn:!0,ack:!0},this.state="established",this.net.receive(at(this.net.eth_encoder_buf,t))};gt.prototype.process=function(e){if(this.state==="closed")e=this.packet_reply(e,{rst:!0}),this.net.receive(at(this.net.eth_encoder_buf,e));else if(e.tcp.rst)this.state==="syn-probe"?this.emit("probe",!1):this.on_close(),this.release();else if(e.tcp.syn)this.state==="syn-sent"&&e.tcp.ack?(this.ack=e.tcp.seq+1,this.start_seq=e.tcp.seq,this.last_received_ackn=e.tcp.ackn,e=this.ipv4_reply(),this.net.receive(at(this.net.eth_encoder_buf,e)),this.state="established",this.emit("connect")):this.state==="syn-probe"&&e.tcp.ack&&(this.emit("probe",!0),e=this.packet_reply(e,{rst:!0}),this.net.receive(at(this.net.eth_encoder_buf,e)),this.release());else{if(e.tcp.ack){if(this.state==="syn-received")this.state="established";else if(this.state==="fin-wait-1")e.tcp.fin||(this.state="fin-wait-2");else if(this.state==="closing"||this.state==="last-ack"){this.release();return}}if(this.last_received_ackn===void 0)this.last_received_ackn=e.tcp.ackn;else{var t=e.tcp.ackn-this.last_received_ackn;if(0<t){if(this.last_received_ackn=e.tcp.ackn,this.send_buffer.remove(t),this.seq+=t,this.pending=!1,this.delayed_send_fin&&!this.send_buffer.length){this.delayed_send_fin=!1,this.state=this.delayed_state,e=this.ipv4_reply(),e.tcp.fin=!0,this.net.receive(at(this.net.eth_encoder_buf,e));return}}else if(0>t){e=this.packet_reply(e,{rst:!0}),this.net.receive(at(this.net.eth_encoder_buf,e)),this.on_close(),this.release();return}}e.tcp.fin?(++this.ack,t=this.packet_reply(e,{}),this.state==="established"?(t.tcp.ack=!0,this.state="close-wait",this.on_shutdown()):this.state==="fin-wait-1"?(e.tcp.ack?this.release():this.state="closing",t.tcp.ack=!0):this.state==="fin-wait-2"?(this.release(),t.tcp.ack=!0):(this.release(),this.on_close(),t.tcp.rst=!0),this.net.receive(at(this.net.eth_encoder_buf,t))):this.ack!==e.tcp.seq?(e=this.packet_reply(e,{ack:!0}),this.net.receive(at(this.net.eth_encoder_buf,e))):e.tcp.ack&&0<e.tcp_data.length&&(this.ack+=e.tcp_data.length,t=this.ipv4_reply(),this.net.receive(at(this.net.eth_encoder_buf,t)),this.emit("data",e.tcp_data)),this.pump()}};gt.prototype.write=function(e){this.in_active_close||this.send_buffer.write(e),this.pump()};gt.prototype.writev=function(e){if(!this.in_active_close)for(const t of e)this.send_buffer.write(t);this.pump()};gt.prototype.close=function(){if(!this.in_active_close){if(this.in_active_close=!0,this.state==="established"||this.state==="syn-received")var e="fin-wait-1";else if(this.state==="close-wait")e="last-ack";else{this.release();return}this.send_buffer.length||this.pending?(this.delayed_send_fin=!0,this.delayed_state=e):(this.state=e,e=this.ipv4_reply(),e.tcp.fin=!0,this.net.receive(at(this.net.eth_encoder_buf,e)))}this.pump()};gt.prototype.on_shutdown=function(){this.emit("shutdown")};gt.prototype.on_close=function(){this.emit("close")};gt.prototype.release=function(){this.net.tcp_conn[this.tuple]&&(this.state="closed",delete this.net.tcp_conn[this.tuple])};gt.prototype.pump=function(){if(this.send_buffer.length&&!this.pending){const e=this.send_chunk_buf,t=this.send_buffer.peek(e),i=this.ipv4_reply();i.tcp.psh=!0,i.tcp_data=e.subarray(0,t),this.net.receive(at(this.net.eth_encoder_buf,i)),this.pending=!0}};function $t(e,t){t=t||{},this.bus=e,this.id=t.id||0,this.router_mac=new Uint8Array((t.router_mac||"52:54:0:1:2:3").split(":").map(function(i){return parseInt(i,16)})),this.router_ip=new Uint8Array((t.router_ip||"192.168.86.1").split(".").map(function(i){return parseInt(i,10)})),this.vm_ip=new Uint8Array((t.vm_ip||"192.168.86.100").split(".").map(function(i){return parseInt(i,10)})),this.masquerade=t.masquerade===void 0||!!t.masquerade,this.vm_mac=new Uint8Array(6),this.dns_method=t.dns_method||"static",this.doh_server=t.doh_server,this.tcp_conn={},this.eth_encoder_buf=Rh(),this.fetch=(...i)=>fetch(...i),this.cors_proxy=t.cors_proxy,this.bus.register("net"+this.id+"-mac",function(i){this.vm_mac=new Uint8Array(i.split(":").map(function(s){return parseInt(s,16)}))},this),this.bus.register("net"+this.id+"-send",function(i){this.send(i)},this)}$t.prototype.destroy=function(){};$t.prototype.on_tcp_connection=function(e,t){if(e.tcp.dport===80){let i=new gt;return i.state="syn-received",i.net=this,i.on("data",cm),i.tuple=t,i.accept(e),this.tcp_conn[t]=i,!0}return!1};$t.prototype.connect=function(e){return Lh(e,this)};$t.prototype.tcp_probe=function(e){return hm(e,this)};async function cm(e){if(this.read=this.read||"",(this.read+=new TextDecoder().decode(e))&&this.read.indexOf(`\r
\r
`)!==-1){e=this.read.indexOf(`\r
\r
`);var t=this.read.substring(0,e).split(/\r\n/);e=this.read.substring(e+4),this.read="";let i=t[0].split(" "),s;s=/^https?:/.test(i[1])?new URL(i[1]):new URL("http://host"+i[1]),typeof window<"u"&&s.protocol==="http:"&&window.location.protocol==="https:"&&(s.protocol="https:");let n=new Headers;for(let r=1;r<t.length;++r){const a=this.net.parse_http_header(t[r]);if(!a){console.warn('The request contains an invalid header: "%s"',t[r]),this.net.respond_text_and_close(this,400,"Bad Request",`Invalid header in request: ${t[r]}`);return}a.key.toLowerCase()==="host"?s.host=a.value:n.append(a.key,a.value)}if(!this.net.cors_proxy&&/^\d+\.external$/.test(s.hostname))if(t=parseInt(s.hostname.split(".")[0],10),!isNaN(t)&&0<t&&65536>t)s.protocol="http:",s.hostname="localhost",s.port=t.toString(10);else{console.warn('Unknown port for localhost: "%s"',s.href),this.net.respond_text_and_close(this,400,"Bad Request",`Unknown port for localhost: ${s.href}`);return}this.name=s.href,t={method:i[0],headers:n},["put","post"].indexOf(t.method.toLowerCase())!==-1&&(t.body=e);const o=this.net.cors_proxy?this.net.cors_proxy+encodeURIComponent(s.href):s.href;new TextEncoder;let c=!1;this.net.fetch(o,t).then(r=>{let a=new Headers(r.headers);if(a.delete("content-encoding"),a.delete("keep-alive"),a.delete("content-length"),a.delete("transfer-encoding"),a.set("x-was-fetch-redirected",`${!!r.redirected}`),a.set("x-fetch-resp-url",r.url),a.set("connection","close"),this.write(this.net.form_response_head(r.status,r.statusText,a)),c=!0,r.body&&r.body.getReader){const u=r.body.getReader(),_=({value:l,done:m})=>{if(l&&this.write(l),m)this.close();else return u.read().then(_)};u.read().then(_)}else r.arrayBuffer().then(u=>{this.write(new Uint8Array(u)),this.close()})}).catch(r=>{console.warn("Fetch Failed: "+o+`
`+r),c||this.net.respond_text_and_close(this,502,"Fetch Error",`Fetch ${o} failed:

${r.stack||r.message}`),this.close()})}}$t.prototype.fetch=async function(e,t){this.cors_proxy&&(e=this.cors_proxy+encodeURIComponent(e));try{const i=await fetch(e,t),s=await i.arrayBuffer();return[i,s]}catch(i){return console.warn("Fetch Failed: "+e+`
`+i),[{status:502,statusText:"Fetch Error",headers:new Headers({"Content-Type":"text/plain"})},new TextEncoder().encode(`Fetch ${e} failed:

${i.stack}`).buffer]}};$t.prototype.form_response_head=function(e,t,i){e=[`HTTP/1.1 ${e} ${t}`];for(const[s,n]of i.entries())e.push(`${s}: ${n}`);return new TextEncoder().encode(e.join(`\r
`)+`\r
\r
`)};$t.prototype.respond_text_and_close=function(e,t,i,s){const n=new Headers({"content-type":"text/plain","content-length":s.length.toString(10),connection:"close"});e.writev([this.form_response_head(t,i,n),new TextEncoder().encode(s)]),e.close()};$t.prototype.parse_http_header=function(e){var t=e.match(/^([^:]*):(.*)$/);if(t&&(e=t[1],t=t[2].trim(),e.length!==0&&t.length!==0&&/^[\w-]+$/.test(e)&&/^[\x20-\x7E]+$/.test(t)))return{key:e,value:t}};$t.prototype.send=function(e){Th(e,this)};$t.prototype.receive=function(e){this.bus.send("net"+this.id+"-receive",new Uint8Array(e))};function fi(e,t,i){this.register_ws(e),this.last_stream=1,this.connections={0:{congestion:0}},this.congested_buffer=[],i=i||{},this.bus=t,this.id=i.id||0,this.router_mac=new Uint8Array((i.router_mac||"52:54:0:1:2:3").split(":").map(function(s){return parseInt(s,16)})),this.router_ip=new Uint8Array((i.router_ip||"192.168.86.1").split(".").map(function(s){return parseInt(s,10)})),this.vm_ip=new Uint8Array((i.vm_ip||"192.168.86.100").split(".").map(function(s){return parseInt(s,10)})),this.masquerade=i.masquerade===void 0||!!i.masquerade,this.vm_mac=new Uint8Array(6),this.dns_method=i.dns_method||"doh",this.doh_server=i.doh_server,this.tcp_conn={},this.eth_encoder_buf=Rh(),this.bus.register("net"+this.id+"-mac",function(s){this.vm_mac=new Uint8Array(s.split(":").map(function(n){return parseInt(n,16)}))},this),this.bus.register("net"+this.id+"-send",function(s){this.send(s)},this)}fi.prototype.register_ws=function(e){this.wispws=new WebSocket(e.replace("wisp://","ws://").replace("wisps://","wss://")),this.wispws.binaryType="arraybuffer",this.wispws.onmessage=t=>{this.process_incoming_wisp_frame(new Uint8Array(t.data))},this.wispws.onclose=()=>{setTimeout(()=>{this.register_ws(e)},1e4)}};fi.prototype.send_packet=function(e,t,i){this.connections[i]&&(0<this.connections[i].congestion?(t==="DATA"&&this.connections[i].congestion--,this.wispws.send(e)):(this.connections[i].congested=!0,this.congested_buffer.push({data:e,type:t})))};fi.prototype.process_incoming_wisp_frame=function(e){const t=new DataView(e.buffer),i=t.getUint32(1,!0);switch(e[0]){case 2:if(this.connections[i])this.connections[i].data_callback(e.slice(5));else throw Error("Got a DATA packet but stream not registered. ID: "+i);break;case 3:if(this.connections[i]&&(this.connections[i].congestion=t.getUint32(5,!0)),this.connections[i].congested){for(const s of this.congested_buffer)this.send_packet(s.data,s.type,i);this.connections[i].congested=!1}break;case 4:this.connections[i]&&this.connections[i].close_callback(t.getUint8(5)),delete this.connections[i]}};fi.prototype.send_wisp_frame=function(e){let t,i;switch(e.type){case"CONNECT":const s=new TextEncoder().encode(e.hostname);t=new Uint8Array(8+s.length),i=new DataView(t.buffer),i.setUint8(0,1),i.setUint32(1,e.stream_id,!0),i.setUint8(5,1),i.setUint16(6,e.port,!0),t.set(s,8),this.connections[e.stream_id]={data_callback:e.data_callback,close_callback:e.close_callback,congestion:this.connections[0].congestion};break;case"DATA":t=new Uint8Array(5+e.data.length),i=new DataView(t.buffer),i.setUint8(0,2),i.setUint32(1,e.stream_id,!0),t.set(e.data,5);break;case"CLOSE":t=new Uint8Array(6),i=new DataView(t.buffer),i.setUint8(0,4),i.setUint32(1,e.stream_id,!0),i.setUint8(5,e.reason)}this.send_packet(t,e.type,e.stream_id)};fi.prototype.destroy=function(){this.wispws&&(this.wispws.onmessage=null,this.wispws.onclose=null,this.wispws.close(),this.wispws=null)};fi.prototype.on_tcp_connection=function(e,t){let i=new gt;return i.state="syn-received",i.net=this,i.tuple=t,i.stream_id=this.last_stream++,this.tcp_conn[t]=i,i.on("data",s=>{s.length!==0&&this.send_wisp_frame({type:"DATA",stream_id:i.stream_id,data:s})}),i.on_close=()=>{this.send_wisp_frame({type:"CLOSE",stream_id:i.stream_id,reason:2})},i.on_shutdown=i.on_close,this.send_wisp_frame({type:"CONNECT",stream_id:i.stream_id,hostname:e.ipv4.dest.join("."),port:e.tcp.dport,data_callback:s=>{i.write(s)},close_callback:()=>{i.close()}}),i.accept(e),!0};fi.prototype.send=function(e){Th(e,this)};fi.prototype.receive=function(e){this.bus.send("net"+this.id+"-receive",new Uint8Array(e))};const lm=typeof window<"u"&&0<=window.navigator.platform.toString().toLowerCase().search("win");function um(e){function t(p){return p.shiftKey&&p.ctrlKey&&(p.keyCode===73||p.keyCode===74||p.keyCode===75)||!C.emu_enabled?!1:p.target?p.target.classList.contains("phone_keyboard")||p.target.nodeName!=="INPUT"&&p.target.nodeName!=="TEXTAREA":!0}function i(p){return!p.altKey&&_[56]&&a(56,!1),c(p,!1)}function s(p){return!p.altKey&&_[56]&&a(56,!1),c(p,!0)}function n(){for(var p=Object.keys(_),v,S=0;S<p.length;S++)v=+p[S],_[v]&&a(v,!1);_={}}function o(p){if(C.bus&&t(p))switch(p.inputType){case"insertText":for(var v=0;v<p.data.length;v++)C.simulate_char(p.data[v]);break;case"insertLineBreak":C.simulate_press(13);break;case"deleteContentBackward":C.simulate_press(8)}}function c(p,v){if(C.bus&&t(p)&&p.code!==""&&p.key!=="Process"&&p.key!=="Unidentified"&&p.keyCode!==229)return p.preventDefault&&p.preventDefault(),lm&&(l&&(clearTimeout(g),p.getModifierState&&p.getModifierState("AltGraph")&&m===v&&l.code==="ControlLeft"&&p.code==="AltRight"||r(l,m),l=null),p.code==="ControlLeft")?(l=p,m=v,g=setTimeout(()=>{r(l,m),l=null},10),!1):(r(p,v),!1)}function r(p,v){e:{if(p.code!==void 0){var S=d[p.code];if(S!==void 0)break e}S=y[p.keyCode]}S?a(S,v,p.repeat):console.log("Missing char in map: keyCode="+(p.keyCode||-1).toString(16)+" code="+p.code)}function a(p,v,S){if(v)_[p]&&!S&&a(p,!1);else if(!_[p])return;(_[p]=v)||(p|=128),255<p?(u(p>>8),u(p&255)):u(p)}function u(p){C.bus.send("keyboard-code",p)}var _={},l=null,m=!1,g=0,C=this;this.emu_enabled=!0;const y=new Uint16Array([0,0,0,0,0,0,0,0,14,15,0,0,0,28,0,0,42,29,56,0,58,0,0,0,0,0,0,1,0,0,0,0,57,57417,57425,57423,57415,57419,57416,57421,80,0,0,0,0,82,83,0,11,2,3,4,5,6,7,8,9,10,0,39,0,13,0,0,0,30,48,46,32,18,33,34,35,23,36,37,38,50,49,24,25,16,19,31,20,22,47,17,45,21,44,57435,57436,57437,0,0,82,79,80,81,75,76,77,71,72,73,0,0,0,0,0,0,59,60,61,62,63,64,65,66,67,68,87,88,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,69,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,12,0,0,0,0,0,0,0,0,0,0,0,0,39,13,51,12,52,53,41,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,26,43,27,40,0,57435,57400,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),h={8:8,10:13,32:32,39:222,44:188,45:189,46:190,47:191,48:48,49:49,50:50,51:51,52:52,53:53,54:54,55:55,56:56,57:57,59:186,61:187,91:219,92:220,93:221,96:192,97:65,98:66,99:67,100:68,101:69,102:70,103:71,104:72,105:73,106:74,107:75,108:76,109:77,110:78,111:79,112:80,113:81,114:82,115:83,116:84,117:85,118:86,119:87,120:88,121:89,122:90},f={33:49,34:222,35:51,36:52,37:53,38:55,40:57,41:48,42:56,43:187,58:186,60:188,62:190,63:191,64:50,65:65,66:66,67:67,68:68,69:69,70:70,71:71,72:72,73:73,74:74,75:75,76:76,77:77,78:78,79:79,80:80,81:81,82:82,83:83,84:84,85:85,86:86,87:87,88:88,89:89,90:90,94:54,95:189,123:219,124:220,125:221,126:192};var d={Escape:1,Digit1:2,Digit2:3,Digit3:4,Digit4:5,Digit5:6,Digit6:7,Digit7:8,Digit8:9,Digit9:10,Digit0:11,Minus:12,Equal:13,Backspace:14,Tab:15,KeyQ:16,KeyW:17,KeyE:18,KeyR:19,KeyT:20,KeyY:21,KeyU:22,KeyI:23,KeyO:24,KeyP:25,BracketLeft:26,BracketRight:27,Enter:28,ControlLeft:29,KeyA:30,KeyS:31,KeyD:32,KeyF:33,KeyG:34,KeyH:35,KeyJ:36,KeyK:37,KeyL:38,Semicolon:39,Quote:40,Backquote:41,ShiftLeft:42,Backslash:43,KeyZ:44,KeyX:45,KeyC:46,KeyV:47,KeyB:48,KeyN:49,KeyM:50,Comma:51,Period:52,Slash:53,IntlRo:53,ShiftRight:54,NumpadMultiply:55,AltLeft:56,Space:57,CapsLock:58,F1:59,F2:60,F3:61,F4:62,F5:63,F6:64,F7:65,F8:66,F9:67,F10:68,NumLock:69,ScrollLock:70,Numpad7:71,Numpad8:72,Numpad9:73,NumpadSubtract:74,Numpad4:75,Numpad5:76,Numpad6:77,NumpadAdd:78,Numpad1:79,Numpad2:80,Numpad3:81,Numpad0:82,NumpadDecimal:83,IntlBackslash:86,F11:87,F12:88,NumpadEnter:57372,ControlRight:57373,NumpadDivide:57397,AltRight:57400,Home:57415,ArrowUp:57416,PageUp:57417,ArrowLeft:57419,ArrowRight:57421,End:57423,ArrowDown:57424,PageDown:57425,Insert:57426,Delete:57427,MetaLeft:57435,OSLeft:57435,MetaRight:57436,OSRight:57436,ContextMenu:57437};this.bus=e,this.destroy=function(){typeof window<"u"&&(window.removeEventListener("keyup",i,!1),window.removeEventListener("keydown",s,!1),window.removeEventListener("blur",n,!1),window.removeEventListener("input",o,!1))},this.init=function(){typeof window<"u"&&(this.destroy(),window.addEventListener("keyup",i,!1),window.addEventListener("keydown",s,!1),window.addEventListener("blur",n,!1),window.addEventListener("input",o,!1))},this.init(),this.simulate_press=function(p){p={keyCode:p},c(p,!0),c(p,!1)},this.simulate_char=function(p){var v=p.charCodeAt(0);v in h?this.simulate_press(h[v]):v in f?(u(42),this.simulate_press(f[v]),u(170)):console.log("ascii -> keyCode not found: ",v,p)}}function dm(e,t){function i(h){if(!y.enabled||!y.emu_enabled)return!1;var f=t||document.body,d;if(!(d=document.pointerLockElement))e:{for(h=h.target;h.parentNode;){if(h===f){d=!0;break e}h=h.parentNode}d=!1}return d}function s(h){i(h)&&(h=h.changedTouches)&&h.length&&(h=h[h.length-1],g=h.clientX,C=h.clientY)}function n(){(_||m||l)&&(y.bus.send("mouse-click",[!1,!1,!1]),_=m=l=!1)}function o(h){if(y.bus&&i(h)&&y.is_running){var f=0,d=0,p=h.changedTouches;p?p.length&&(p=p[p.length-1],f=p.clientX-g,d=p.clientY-C,g=p.clientX,C=p.clientY,h.preventDefault()):typeof h.movementX=="number"?(f=h.movementX,d=h.movementY):typeof h.webkitMovementX=="number"?(f=h.webkitMovementX,d=h.webkitMovementY):typeof h.mozMovementX=="number"?(f=h.mozMovementX,d=h.mozMovementY):(f=h.clientX-g,d=h.clientY-C,g=h.clientX,C=h.clientY),y.bus.send("mouse-delta",[1*f,-(1*d)]),t&&y.bus.send("mouse-absolute",[h.pageX-t.offsetLeft,h.pageY-t.offsetTop,t.offsetWidth,t.offsetHeight])}}function c(h){i(h)&&a(h,!0)}function r(h){i(h)&&a(h,!1)}function a(h,f){y.bus&&(h.which===1?_=f:h.which===2?m=f:h.which===3&&(l=f),y.bus.send("mouse-click",[_,m,l]),h.preventDefault())}function u(h){if(i(h)){var f=h.wheelDelta||-h.detail;0>f?f=-1:0<f&&(f=1),y.bus.send("mouse-wheel",[f,0]),h.preventDefault()}}var _=!1,l=!1,m=!1,g=0,C=0,y=this;this.enabled=!1,this.emu_enabled=!0,this.bus=e,this.bus.register("mouse-enable",function(h){this.enabled=h},this),this.is_running=!1,this.bus.register("emulator-stopped",function(){this.is_running=!1},this),this.bus.register("emulator-started",function(){this.is_running=!0},this),this.destroy=function(){typeof window<"u"&&(window.removeEventListener("touchstart",s,!1),window.removeEventListener("touchend",n,!1),window.removeEventListener("touchmove",o,!1),window.removeEventListener("mousemove",o,!1),window.removeEventListener("mousedown",c,!1),window.removeEventListener("mouseup",r,!1),window.removeEventListener("wheel",u,{passive:!1}))},this.init=function(){typeof window<"u"&&(this.destroy(),window.addEventListener("touchstart",s,!1),window.addEventListener("touchend",n,!1),window.addEventListener("touchmove",o,!1),window.addEventListener("mousemove",o,!1),window.addEventListener("mousedown",c,!1),window.addEventListener("mouseup",r,!1),window.addEventListener("wheel",u,{passive:!1}))},this.init()}function _m(e){var t,i=0,s=0,n=yh(e?.encoding);this.put_char=function(o,c,r){t[o*i+c]=r},this.destroy=function(){},this.pause=function(){},this.continue=function(){},this.set_mode=function(){},this.set_font_bitmap=function(){},this.set_font_page=function(){},this.clear_screen=function(){},this.set_size_text=function(o,c){(o!==i||c!==s)&&(t=new Uint8Array(o*c),i=o,s=c)},this.set_size_graphical=function(){},this.set_scale=function(){},this.update_cursor_scanline=function(){},this.update_cursor=function(){},this.update_buffer=function(){},this.get_text_screen=function(){for(var o=[],c=0;c<s;c++)o.push(this.get_text_row(c));return o},this.get_text_row=function(o){return o*=i,Array.from(t.subarray(o,o+i),c=>n[c]).join("")},this.set_size_text(80,25)}function fm(e,t){function i(r){c.bus&&c.enabled&&(c.send_char(r.which),r.preventDefault())}function s(r){var a=r.which;a===8?(c.send_char(127),r.preventDefault()):a===9&&(c.send_char(9),r.preventDefault())}function n(r){if(c.enabled){for(var a=r.clipboardData.getData("text/plain"),u=0;u<a.length;u++)c.send_char(a.charCodeAt(u));r.preventDefault()}}function o(r){r.target!==e&&e.blur()}var c=this;this.enabled=!0,this.bus=t,this.text="",this.text_new_line=!1,this.last_update=0,this.bus.register("serial0-output-byte",function(r){r=String.fromCharCode(r),this.show_char(r)},this),this.destroy=function(){e.removeEventListener("keypress",i,!1),e.removeEventListener("keydown",s,!1),e.removeEventListener("paste",n,!1),window.removeEventListener("mousedown",o,!1)},this.init=function(){this.destroy(),e.style.display="block",e.addEventListener("keypress",i,!1),e.addEventListener("keydown",s,!1),e.addEventListener("paste",n,!1),window.addEventListener("mousedown",o,!1)},this.init(),this.show_char=function(r){r==="\b"?(this.text=this.text.slice(0,-1),this.update()):r!=="\r"&&(this.text+=r,r===`
`&&(this.text_new_line=!0),this.update())},this.update=function(){var r=Date.now(),a=r-this.last_update;16>a?this.update_timer===void 0&&(this.update_timer=setTimeout(()=>{this.update_timer=void 0,this.last_update=Date.now(),this.render()},16-a)):(this.update_timer!==void 0&&(clearTimeout(this.update_timer),this.update_timer=void 0),this.last_update=r,this.render())},this.render=function(){e.value=this.text,this.text_new_line&&(this.text_new_line=!1,e.scrollTop=1e9)},this.send_char=function(r){c.bus&&c.bus.send("serial0-input",r)}}function Kn(e,t){if(this.element=e,window.Terminal){var i=this.term=new window.Terminal({logLevel:"off",convertEol:"true"});i.write("This is the serial console. Whatever you type or paste here will be sent to COM1");var s=new TextEncoder,n=i.onData(function(o){for(const c of s.encode(o))t.send("serial0-input",c)});t.register("serial0-output-byte",function(o){i.write(Uint8Array.of(o))},this),this.destroy=function(){n.dispose(),i.dispose()}}}Kn.prototype.show=function(){this.term&&this.term.open(this.element)};function Dh(e,t){t=t.id||0,this.bus=e,this.bus_send_msgid=`net${t}-send`,this.bus_recv_msgid=`net${t}-receive`,this.channel=new BroadcastChannel(`v86-inbrowser-${t}`),this.is_open=!0,this.nic_to_hub_fn=i=>{this.channel.postMessage(i)},this.bus.register(this.bus_send_msgid,this.nic_to_hub_fn,this),this.hub_to_nic_fn=i=>{this.bus.send(this.bus_recv_msgid,i.data)},this.channel.addEventListener("message",this.hub_to_nic_fn)}Dh.prototype.destroy=function(){this.is_open&&(this.bus.unregister(this.bus_send_msgid,this.nic_to_hub_fn),this.channel.removeEventListener("message",this.hub_to_nic_fn),this.channel.close(),this.is_open=!1)};function br(){this.filedata=new Map}br.prototype.read=async function(e,t,i){return(e=this.filedata.get(e))?e.subarray(t,t+i):null};br.prototype.cache=async function(e,t){this.filedata.set(e,t)};br.prototype.uncache=function(e){this.filedata.delete(e)};function Ns(e,t){t.endsWith("/")||(t+="/"),this.storage=e,this.baseurl=t}Ns.prototype.load_from_server=function(e){return new Promise(t=>{At(this.baseurl+e,{done:async i=>{i=new Uint8Array(i),await this.cache(e,i),t(i)}})})};Ns.prototype.read=async function(e,t,i){const s=await this.storage.read(e,t,i);return s||(await this.load_from_server(e)).subarray(t,t+i)};Ns.prototype.cache=async function(e,t){return await this.storage.cache(e,t)};Ns.prototype.uncache=function(e){this.storage.uncache(e)};const pm=new TextDecoder,mm=new TextEncoder;function Ve(e,t,i,s){for(var n,o=0,c=0;c<e.length;c++)switch(n=t[c],e[c]){case"w":i[s++]=n&255,i[s++]=n>>8&255,i[s++]=n>>16&255,i[s++]=n>>24&255,o+=4;break;case"d":i[s++]=n&255,i[s++]=n>>8&255,i[s++]=n>>16&255,i[s++]=n>>24&255,i[s++]=0,i[s++]=0,i[s++]=0,i[s++]=0,o+=8;break;case"h":i[s++]=n&255,i[s++]=n>>8,o+=2;break;case"b":i[s++]=n,o+=1;break;case"s":var r=s,a=0;i[s++]=0,i[s++]=0,o+=2,n=mm.encode(n),o+=n.byteLength,a+=n.byteLength,i.set(n,s),s+=n.byteLength,i[r+0]=a&255,i[r+1]=a>>8&255;break;case"Q":Ve(["b","w","d"],[n.type,n.version,n.path],i,s),s+=13,o+=13}return o}function Ie(e,t,i){let s=i.offset;for(var n=[],o=0;o<e.length;o++)switch(e[o]){case"w":var c=t[s++];c+=t[s++]<<8,c+=t[s++]<<16,c+=t[s++]<<24>>>0,n.push(c);break;case"d":c=t[s++],c+=t[s++]<<8,c+=t[s++]<<16,c+=t[s++]<<24>>>0,s+=4,n.push(c);break;case"h":c=t[s++],n.push(c+(t[s++]<<8));break;case"b":n.push(t[s++]);break;case"s":c=t[s++],c+=t[s++]<<8;var r=t.slice(s,s+c);s+=c,n.push(pm.decode(r));break;case"Q":i.offset=s,c=Ie(["b","w","d"],t,i),s=i.offset,n.push({type:c[0],version:c[1],path:c[2]})}return i.offset=s,n}const ga=new TextEncoder;function pe(e,t){this.inodes=[],this.storage=e,this.qidcounter=t||{last_qidnumber:0},this.inodedata={},this.total_size=274877906944,this.used_size=0,this.mounts=[],this.CreateDirectory("",-1)}pe.prototype.get_state=function(){let e=[];e[0]=this.inodes,e[1]=this.qidcounter.last_qidnumber,e[2]=[];for(const[t,i]of Object.entries(this.inodedata))(this.inodes[t].mode&16384)===0&&e[2].push([t,i]);return e[3]=this.total_size,e[4]=this.used_size,e=e.concat(this.mounts)};pe.prototype.set_state=function(e){this.inodes=e[0].map(t=>{const i=new Fs(0);return i.set_state(t),i}),this.qidcounter.last_qidnumber=e[1],this.inodedata={};for(let[t,i]of e[2])i.buffer.byteLength!==i.byteLength&&(i=i.slice()),this.inodedata[t]=i;this.total_size=e[3],this.used_size=e[4],this.mounts=e.slice(5)};pe.prototype.load_from_json=function(e){if(e.version!==3)throw"The filesystem JSON format has changed. Please recreate the filesystem JSON.";var t=e.fsroot;for(this.used_size=e.size,e=0;e<t.length;e++)this.LoadRecursive(t[e],0)};pe.prototype.LoadRecursive=function(e,t){var i=this.CreateInode();const s=e[0];i.size=e[1],i.mtime=e[2],i.ctime=i.mtime,i.atime=i.mtime,i.mode=e[3],i.uid=e[4],i.gid=e[5];var n=i.mode&61440;n===16384?(this.PushInode(i,t,s),this.LoadDir(this.inodes.length-1,e[6])):n===32768?(i.status=2,i.sha256sum=e[6],this.PushInode(i,t,s)):n===40960?(i.symlink=e[6],this.PushInode(i,t,s)):n!==49152&&A(n)};pe.prototype.LoadDir=function(e,t){for(var i=0;i<t.length;i++)this.LoadRecursive(t[i],e)};pe.prototype.should_be_linked=function(e){return!this.is_forwarder(e)||e.foreign_id===0};pe.prototype.link_under_dir=function(e,t,i){const s=this.inodes[t],n=this.inodes[e];this.is_forwarder(n),this.IsDirectory(e),this.should_be_linked(s),n.direntries.has(i),n.direntries.set(i,t),s.nlinks++,this.IsDirectory(t)&&(s.direntries.has(".."),s.direntries.has(".")||s.nlinks++,s.direntries.set(".",t),s.direntries.set("..",e),n.nlinks++)};pe.prototype.unlink_from_dir=function(e,t){const i=this.Search(e,t),s=this.inodes[i],n=this.inodes[e];this.is_forwarder(n),this.IsDirectory(e),n.direntries.delete(t)&&(s.nlinks--,this.IsDirectory(i)&&(s.direntries.get(".."),s.direntries.delete(".."),n.nlinks--))};pe.prototype.PushInode=function(e,t,i){t!==-1?(this.inodes.push(e),e.fid=this.inodes.length-1,this.link_under_dir(t,e.fid,i)):this.inodes.length===0&&(this.inodes.push(e),e.direntries.set(".",0),e.direntries.set("..",0),e.nlinks=2)};function Fs(e){this.direntries=new Map,this.minor=this.major=this.mtime=this.atime=this.ctime=this.fid=this.gid=this.uid=this.size=this.status=0,this.symlink="",this.mode=493,this.qid={type:0,version:0,path:e},this.caps=void 0,this.nlinks=0,this.sha256sum="",this.locks=[],this.foreign_id=this.mount_id=-1}Fs.prototype.get_state=function(){const e=[];return e[0]=this.mode,e[1]=(this.mode&61440)===16384?[...this.direntries]:(this.mode&61440)===32768?this.sha256sum:(this.mode&61440)===40960?this.symlink:(this.mode&61440)===49152?[this.minor,this.major]:null,e[2]=this.locks,e[3]=this.status,e[4]=this.size,e[5]=this.uid,e[6]=this.gid,e[7]=this.fid,e[8]=this.ctime,e[9]=this.atime,e[10]=this.mtime,e[11]=this.qid.version,e[12]=this.qid.path,e[13]=this.nlinks,e};Fs.prototype.set_state=function(e){if(this.mode=e[0],(this.mode&61440)===16384){this.direntries=new Map;for(const[t,i]of e[1])this.direntries.set(t,i)}else(this.mode&61440)===32768?this.sha256sum=e[1]:(this.mode&61440)===40960?this.symlink=e[1]:(this.mode&61440)===49152&&([this.minor,this.major]=e[1]);this.locks=[];for(const t of e[2]){const i=new ui;i.set_state(t),this.locks.push(i)}this.status=e[3],this.size=e[4],this.uid=e[5],this.gid=e[6],this.fid=e[7],this.ctime=e[8],this.atime=e[9],this.mtime=e[10],this.qid.type=(this.mode&61440)>>8,this.qid.version=e[11],this.qid.path=e[12],this.nlinks=e[13]};pe.prototype.divert=function(e,t){const i=this.Search(e,t),s=this.inodes[i],n=new Fs(-1);this.IsDirectory(i),Object.assign(n,s);const o=this.inodes.length;if(this.inodes.push(n),n.fid=o,this.is_forwarder(s)&&this.mounts[s.mount_id].backtrack.set(s.foreign_id,o),this.should_be_linked(s)&&(this.unlink_from_dir(e,t),this.link_under_dir(e,o,t)),this.IsDirectory(i)&&!this.is_forwarder(s))for(const[c,r]of n.direntries)c!=="."&&c!==".."&&this.IsDirectory(r)&&this.inodes[r].direntries.set("..",o);return this.inodedata[o]=this.inodedata[i],delete this.inodedata[i],s.direntries=new Map,s.nlinks=0,o};pe.prototype.copy_inode=function(e,t){Object.assign(t,e,{fid:t.fid,direntries:t.direntries,nlinks:t.nlinks})};pe.prototype.CreateInode=function(){const e=Math.round(Date.now()/1e3),t=new Fs(++this.qidcounter.last_qidnumber);return t.atime=t.ctime=t.mtime=e,t};pe.prototype.CreateDirectory=function(e,t){var i=this.inodes[t];return 0<=t&&this.is_forwarder(i)?(t=i.foreign_id,e=this.follow_fs(i).CreateDirectory(e,t),this.create_forwarder(i.mount_id,e)):(i=this.CreateInode(),i.mode=16895,0<=t&&(i.uid=this.inodes[t].uid,i.gid=this.inodes[t].gid,i.mode=this.inodes[t].mode&511|16384),i.qid.type=64,this.PushInode(i,t,e),this.NotifyListeners(this.inodes.length-1,"newdir"),this.inodes.length-1)};pe.prototype.CreateFile=function(e,t){var i=this.inodes[t];return this.is_forwarder(i)?(t=i.foreign_id,e=this.follow_fs(i).CreateFile(e,t),this.create_forwarder(i.mount_id,e)):(i=this.CreateInode(),i.uid=this.inodes[t].uid,i.gid=this.inodes[t].gid,i.qid.type=128,i.mode=this.inodes[t].mode&438|32768,this.PushInode(i,t,e),this.NotifyListeners(this.inodes.length-1,"newfile"),this.inodes.length-1)};pe.prototype.CreateNode=function(e,t,i,s){var n=this.inodes[t];return this.is_forwarder(n)?(t=n.foreign_id,e=this.follow_fs(n).CreateNode(e,t,i,s),this.create_forwarder(n.mount_id,e)):(n=this.CreateInode(),n.major=i,n.minor=s,n.uid=this.inodes[t].uid,n.gid=this.inodes[t].gid,n.qid.type=192,n.mode=this.inodes[t].mode&438,this.PushInode(n,t,e),this.inodes.length-1)};pe.prototype.CreateSymlink=function(e,t,i){var s=this.inodes[t];return this.is_forwarder(s)?(t=s.foreign_id,e=this.follow_fs(s).CreateSymlink(e,t,i),this.create_forwarder(s.mount_id,e)):(s=this.CreateInode(),s.uid=this.inodes[t].uid,s.gid=this.inodes[t].gid,s.qid.type=160,s.symlink=i,s.mode=40960,this.PushInode(s,t,e),this.inodes.length-1)};pe.prototype.CreateTextFile=async function(e,t,i){var s=this.inodes[t];if(this.is_forwarder(s))return t=s.foreign_id,i=await this.follow_fs(s).CreateTextFile(e,t,i),this.create_forwarder(s.mount_id,i);for(s=this.CreateFile(e,t),t=this.inodes[s],e=new Uint8Array(i.length),t.size=i.length,t=0;t<i.length;t++)e[t]=i.charCodeAt(t);return await this.set_data(s,e),s};pe.prototype.CreateBinaryFile=async function(e,t,i){var s=this.inodes[t];return this.is_forwarder(s)?(t=s.foreign_id,i=await this.follow_fs(s).CreateBinaryFile(e,t,i),this.create_forwarder(s.mount_id,i)):(s=this.CreateFile(e,t),e=this.inodes[s],t=new Uint8Array(i.length),t.set(i),await this.set_data(s,t),e.size=i.length,s)};pe.prototype.OpenInode=async function(e,t){var i=this.inodes[e];if(this.is_forwarder(i))return await this.follow_fs(i).OpenInode(i.foreign_id,t);(i.mode&61440)===16384&&this.FillDirectory(e)};pe.prototype.CloseInode=async function(e){var t=this.inodes[e];if(this.is_forwarder(t))return await this.follow_fs(t).CloseInode(t.foreign_id);t.status===2&&this.storage.uncache(t.sha256sum),t.status===4&&(t.status=-1,await this.DeleteData(e))};pe.prototype.Rename=async function(e,t,i,s){if(e===i&&t===s)return 0;var n=this.Search(e,t);if(n===-1)return-2;var o=this.GetFullPath(e)+"/"+t;if(this.Search(i,s)!==-1){var c=this.Unlink(i,s);if(0>c)return c}var r=this.inodes[n],a=this.inodes[e];if(c=this.inodes[i],this.is_forwarder(a)||this.is_forwarder(c))if(this.is_forwarder(a)&&a.mount_id===c.mount_id){if(e=await this.follow_fs(a).Rename(a.foreign_id,t,c.foreign_id,s),0>e)return e}else{if(this.is_a_root(n)||!this.IsDirectory(n)&&1<this.GetInode(n).nlinks)return-1;a=this.divert(e,t);const u=this.GetInode(n),_=await this.Read(a,0,u.size);if(this.is_forwarder(c)?(i=this.follow_fs(c),s=this.IsDirectory(a)?i.CreateDirectory(s,c.foreign_id):i.CreateFile(s,c.foreign_id),i=i.GetInode(s),this.copy_inode(u,i),this.set_forwarder(n,c.mount_id,s)):(this.delete_forwarder(r),this.copy_inode(u,r),this.link_under_dir(i,n,s)),await this.ChangeSize(n,u.size),_&&_.length&&await this.Write(n,0,_.length,_),this.IsDirectory(n)){for(const l of this.GetChildren(a))if(c=await this.Rename(a,l,n,l),0>c)return c}if(await this.DeleteData(a),e=this.Unlink(e,t),0>e)return e}else this.unlink_from_dir(e,t),this.link_under_dir(i,n,s),r.qid.version++;return this.NotifyListeners(n,"rename",{oldpath:o}),0};pe.prototype.Write=async function(e,t,i,s){this.NotifyListeners(e,"write");var n=this.inodes[e];if(this.is_forwarder(n))e=n.foreign_id,await this.follow_fs(n).Write(e,t,i,s);else{var o=await this.get_buffer(e);!o||o.length<t+i?(await this.ChangeSize(e,Math.floor(3*(t+i)/2)),n.size=t+i,o=await this.get_buffer(e)):n.size<t+i&&(n.size=t+i),s&&o.set(s.subarray(0,i),t),await this.set_data(e,o)}};pe.prototype.Read=async function(e,t,i){const s=this.inodes[e];return this.is_forwarder(s)?(e=s.foreign_id,await this.follow_fs(s).Read(e,t,i)):await this.get_data(e,t,i)};pe.prototype.Search=function(e,t){if(e=this.inodes[e],this.is_forwarder(e)){const i=e.foreign_id;return t=this.follow_fs(e).Search(i,t),t===-1?-1:this.get_forwarder(e.mount_id,t)}return t=e.direntries.get(t),t===void 0?-1:t};pe.prototype.CountUsedInodes=function(){let e=this.inodes.length;for(const{fs:t,backtrack:i}of this.mounts)e+=t.CountUsedInodes(),e-=i.size;return e};pe.prototype.CountFreeInodes=function(){let e=1048576;for(const{fs:t}of this.mounts)e+=t.CountFreeInodes();return e};pe.prototype.GetTotalSize=function(){let e=this.used_size;for(const{fs:t}of this.mounts)e+=t.GetTotalSize();return e};pe.prototype.GetSpace=function(){let e=this.total_size;for(const{fs:t}of this.mounts)e+=t.GetSpace();return this.total_size};pe.prototype.GetDirectoryName=function(e){const t=this.inodes[this.GetParent(e)];if(this.is_forwarder(t))return this.follow_fs(t).GetDirectoryName(this.inodes[e].foreign_id);if(!t)return"";for(const[i,s]of t.direntries)if(s===e)return i;return""};pe.prototype.GetFullPath=function(e){this.IsDirectory(e);for(var t="";e!==0;)t="/"+this.GetDirectoryName(e)+t,e=this.GetParent(e);return t.substring(1)};pe.prototype.Link=function(e,t,i){if(this.IsDirectory(t))return-1;const s=this.inodes[e],n=this.inodes[t];return this.is_forwarder(s)?this.is_forwarder(n)&&n.mount_id===s.mount_id?this.follow_fs(s).Link(s.foreign_id,n.foreign_id,i):-1:this.is_forwarder(n)?-1:(this.link_under_dir(e,t,i),0)};pe.prototype.Unlink=function(e,t){if(t==="."||t==="..")return-1;const i=this.Search(e,t),s=this.inodes[i],n=this.inodes[e];return this.is_forwarder(n)?(this.is_forwarder(s),e=n.foreign_id,this.follow_fs(n).Unlink(e,t)):this.IsDirectory(i)&&!this.IsEmpty(i)?-39:(this.unlink_from_dir(e,t),s.nlinks===0&&(s.status=4,this.NotifyListeners(i,"delete")),0)};pe.prototype.DeleteData=async function(e){const t=this.inodes[e];this.is_forwarder(t)?await this.follow_fs(t).DeleteData(t.foreign_id):(t.size=0,delete this.inodedata[e])};pe.prototype.get_buffer=async function(e){const t=this.inodes[e];return this.inodedata[e]?this.inodedata[e]:t.status===2?await this.storage.read(t.sha256sum,0,t.size):null};pe.prototype.get_data=async function(e,t,i){const s=this.inodes[e];return this.inodedata[e]?this.inodedata[e].subarray(t,t+i):s.status===2?await this.storage.read(s.sha256sum,t,i):null};pe.prototype.set_data=async function(e,t){this.inodedata[e]=t,this.inodes[e].status===2&&(this.inodes[e].status=0,this.storage.uncache(this.inodes[e].sha256sum))};pe.prototype.GetInode=function(e){return e=this.inodes[e],this.is_forwarder(e)?this.follow_fs(e).GetInode(e.foreign_id):e};pe.prototype.ChangeSize=async function(e,t){var i=this.GetInode(e),s=await this.get_data(e,0,i.size);if(t!==i.size){var n=new Uint8Array(t);i.size=t,s&&n.set(s.subarray(0,Math.min(s.length,i.size)),0),await this.set_data(e,n)}};pe.prototype.SearchPath=function(e){e=e.replace("//","/"),e=e.split("/"),0<e.length&&e[e.length-1].length===0&&e.pop(),0<e.length&&e[0].length===0&&e.shift();const t=e.length;var i=-1,s=0;let n=null;for(var o=0;o<t;o++)if(i=s,s=this.Search(i,e[o]),!n&&this.is_forwarder(this.inodes[i])&&(n="/"+e.slice(o).join("/")),s===-1)return o<t-1?{id:-1,parentid:-1,name:e[o],forward_path:n}:{id:-1,parentid:i,name:e[o],forward_path:n};return{id:s,parentid:i,name:e[o],forward_path:n}};pe.prototype.GetRecursiveList=function(e,t){if(this.is_forwarder(this.inodes[e])){const i=this.follow_fs(this.inodes[e]),s=this.inodes[e].mount_id,n=t.length;for(i.GetRecursiveList(this.inodes[e].foreign_id,t),e=n;e<t.length;e++)t[e].parentid=this.get_forwarder(s,t[e].parentid)}else for(const[i,s]of this.inodes[e].direntries)i!=="."&&i!==".."&&(t.push({parentid:e,name:i}),this.IsDirectory(s)&&this.GetRecursiveList(s,t))};pe.prototype.RecursiveDelete=function(e){var t=[];if(e=this.SearchPath(e),e.id!==-1)for(this.GetRecursiveList(e.id,t),e=t.length-1;0<=e;e--)this.Unlink(t[e].parentid,t[e].name)};pe.prototype.DeleteNode=function(e){var t=this.SearchPath(e);t.id!==-1&&((this.inodes[t.id].mode&61440)===32768?this.Unlink(t.parentid,t.name):(this.inodes[t.id].mode&61440)===16384&&(this.RecursiveDelete(e),this.Unlink(t.parentid,t.name)))};pe.prototype.NotifyListeners=function(){};pe.prototype.Check=function(){for(var e=1;e<this.inodes.length;e++)if(this.inodes[e].status!==-1&&(this.GetInode(e),this.IsDirectory(e))){const t=this.GetInode(e);this.IsDirectory(e)&&this.GetParent(e);for(const[i]of t.direntries)for(const s of i);}};pe.prototype.FillDirectory=function(e){var t=this.inodes[e];if(this.is_forwarder(t))this.follow_fs(t).FillDirectory(t.foreign_id);else{var i=0;for(const s of t.direntries.keys())i+=24+ga.encode(s).length;e=this.inodedata[e]=new Uint8Array(i),t.size=i,i=0;for(const[s,n]of t.direntries)t=this.GetInode(n),i+=Ve(["Q","d","b","s"],[t.qid,i+13+8+1+2+ga.encode(s).length,t.mode>>12,s],e,i)}};pe.prototype.RoundToDirentry=function(e,t){if(e=this.inodedata[e],t>=e.length)return e.length;let i=0;for(;;){const s=Ie(["Q","d"],e,{offset:i})[1];if(s>t)break;i=s}return i};pe.prototype.IsDirectory=function(e){return e=this.inodes[e],this.is_forwarder(e)?this.follow_fs(e).IsDirectory(e.foreign_id):(e.mode&61440)===16384};pe.prototype.IsEmpty=function(e){if(e=this.inodes[e],this.is_forwarder(e))return this.follow_fs(e).IsDirectory(e.foreign_id);for(const t of e.direntries.keys())if(t!=="."&&t!=="..")return!1;return!0};pe.prototype.GetChildren=function(e){if(this.IsDirectory(e),e=this.inodes[e],this.is_forwarder(e))return this.follow_fs(e).GetChildren(e.foreign_id);const t=[];for(const i of e.direntries.keys())i!=="."&&i!==".."&&t.push(i);return t};pe.prototype.GetParent=function(e){if(this.IsDirectory(e),e=this.inodes[e],this.should_be_linked(e))return e.direntries.get("..");const t=this.follow_fs(e).GetParent(e.foreign_id);return this.get_forwarder(e.mount_id,t)};pe.prototype.PrepareCAPs=function(e){return e=this.GetInode(e),e.caps||(e.caps=new Uint8Array(20),e.caps[0]=0,e.caps[1]=0,e.caps[2]=0,e.caps[3]=2,e.caps[4]=255,e.caps[5]=255,e.caps[6]=255,e.caps[7]=255,e.caps[8]=255,e.caps[9]=255,e.caps[10]=255,e.caps[11]=255,e.caps[12]=63,e.caps[13]=0,e.caps[14]=0,e.caps[15]=0,e.caps[16]=63,e.caps[17]=0,e.caps[18]=0,e.caps[19]=0),e.caps.length};function Yn(e){this.fs=e,this.backtrack=new Map}Yn.prototype.get_state=function(){const e=[];return e[0]=this.fs,e[1]=[...this.backtrack],e};Yn.prototype.set_state=function(e){this.fs=e[0],this.backtrack=new Map(e[1])};pe.prototype.set_forwarder=function(e,t,i){const s=this.inodes[e];this.is_forwarder(s)&&this.mounts[s.mount_id].backtrack.delete(s.foreign_id),s.status=5,s.mount_id=t,s.foreign_id=i,this.mounts[t].backtrack.set(i,e)};pe.prototype.create_forwarder=function(e,t){const i=this.CreateInode(),s=this.inodes.length;return this.inodes.push(i),i.fid=s,this.set_forwarder(s,e,t),s};pe.prototype.is_forwarder=function(e){return e.status===5};pe.prototype.is_a_root=function(e){return this.GetInode(e).fid===0};pe.prototype.get_forwarder=function(e,t){const i=this.mounts[e].backtrack.get(t);return i===void 0?this.create_forwarder(e,t):i};pe.prototype.delete_forwarder=function(e){this.is_forwarder(e),e.status=-1,this.mounts[e.mount_id].backtrack.delete(e.foreign_id)};pe.prototype.follow_fs=function(e){const t=this.mounts[e.mount_id];return this.is_forwarder(e),t.fs};pe.prototype.Mount=function(e,t){if(e=this.SearchPath(e),e.parentid===-1)return-2;if(e.id!==-1)return-17;if(e.forward_path){var i=this.inodes[e.parentid];return t=this.follow_fs(i).Mount(e.forward_path,t),0>t?t:this.get_forwarder(i.mount_id,t)}return i=this.mounts.length,this.mounts.push(new Yn(t)),t=this.create_forwarder(i,0),this.link_under_dir(e.parentid,t,e.name),t};function ui(){this.type=2,this.start=0,this.length=1/0,this.proc_id=-1,this.client_id=""}ui.prototype.get_state=function(){const e=[];return e[0]=this.type,e[1]=this.start,e[2]=this.length===1/0?0:this.length,e[3]=this.proc_id,e[4]=this.client_id,e};ui.prototype.set_state=function(e){this.type=e[0],this.start=e[1],this.length=e[2]===0?1/0:e[2],this.proc_id=e[3],this.client_id=e[4]};ui.prototype.clone=function(){const e=new ui;return e.set_state(this.get_state()),e};ui.prototype.conflicts_with=function(e){return!(this.proc_id===e.proc_id&&this.client_id===e.client_id||this.type===2||e.type===2||this.type!==1&&e.type!==1||this.start+this.length<=e.start||e.start+e.length<=this.start)};ui.prototype.is_alike=function(e){return e.proc_id===this.proc_id&&e.client_id===this.client_id&&e.type===this.type};ui.prototype.may_merge_after=function(e){return this.is_alike(e)&&e.start+e.length===this.start};pe.prototype.DescribeLock=function(e,t,i,s,n){const o=new ui;return o.type=e,o.start=t,o.length=i,o.proc_id=s,o.client_id=n,o};pe.prototype.GetLock=function(e,t){if(e=this.inodes[e],this.is_forwarder(e)){var i=e.foreign_id;return this.follow_fs(e).GetLock(i,t)}for(i of e.locks)if(t.conflicts_with(i))return i.clone();return null};pe.prototype.Lock=function(e,t,i){const s=this.inodes[e];if(this.is_forwarder(s))return e=s.foreign_id,this.follow_fs(s).Lock(e,t,i);if(t=t.clone(),t.type!==2&&this.GetLock(e,t))return 1;for(i=0;i<s.locks.length;i++){if(e=s.locks[i],e.start+e.length<=t.start)continue;if(t.start+t.length<=e.start)break;if(e.proc_id!==t.proc_id||e.client_id!==t.client_id){e.conflicts_with(t);continue}var n=t.start+t.length;const o=t.start-e.start,c=e.start+e.length-n;if(0<o&&0<c&&e.type===t.type)return 0;if(0<o&&(e.length=o),0>=o&&0<c)e.start=n,e.length=c;else if(0<c){for(;i<s.locks.length&&s.locks[i].start<n;)i++;s.locks.splice(i,0,this.DescribeLock(e.type,n,c,e.proc_id,e.client_id))}else 0>=o&&(s.locks.splice(i,1),i--)}if(t.type!==2){for(i=t,e=!1,n=0;n<s.locks.length&&(i.may_merge_after(s.locks[n])&&(s.locks[n].length+=t.length,i=s.locks[n],e=!0),!(t.start<=s.locks[n].start));n++);for(e||(s.locks.splice(n,0,i),n++);n<s.locks.length;n++)if(s.locks[n].is_alike(i)){s.locks[n].may_merge_after(i)&&(i.length+=s.locks[n].length,s.locks.splice(n,1));break}}return 0};pe.prototype.read_dir=function(e){if(e=this.SearchPath(e),e.id!==-1)return e=this.GetInode(e.id),Array.from(e.direntries.keys()).filter(t=>t!=="."&&t!=="..")};pe.prototype.read_file=function(e){if(e=this.SearchPath(e),e.id===-1)return Promise.resolve(null);const t=this.GetInode(e.id);return this.Read(e.id,0,t.size)};function Ce(e){this.cpu_is_running=!1,this.cpu_exception_hook=function(){};var t=bh.create();this.bus=t[0],this.emulator_bus=t[1];var i,s;const n=new WebAssembly.Table({element:"anyfunc",initial:1924});t={cpu_exception_hook:c=>this.cpu_exception_hook(c),run_hardware_timers:function(c,r){return i.run_hardware_timers(c,r)},cpu_event_halt:()=>{this.emulator_bus.send("cpu-event-halt")},abort:function(){},microtick:Pe.microtick,get_rand_int:function(){return sr()},stop_idling:function(){return i.stop_idling()},io_port_read8:function(c){return i.io.port_read8(c)},io_port_read16:function(c){return i.io.port_read16(c)},io_port_read32:function(c){return i.io.port_read32(c)},io_port_write8:function(c,r){i.io.port_write8(c,r)},io_port_write16:function(c,r){i.io.port_write16(c,r)},io_port_write32:function(c,r){i.io.port_write32(c,r)},mmap_read8:function(c){return i.mmap_read8(c)},mmap_read16:function(c){return i.mmap_read16(c)},mmap_read32:function(c){return i.mmap_read32(c)},mmap_write8:function(c,r){i.mmap_write8(c,r)},mmap_write16:function(c,r){i.mmap_write16(c,r)},mmap_write32:function(c,r){i.mmap_write32(c,r)},mmap_write64:function(c,r,a){i.mmap_write64(c,r,a)},mmap_write128:function(c,r,a,u,_){i.mmap_write128(c,r,a,u,_)},log_from_wasm:function(c,r){bn(s,c,r)},console_log_from_wasm:function(c,r){c=bn(s,c,r),console.error(c)},dbg_trace_from_wasm:function(){},codegen_finalize:(c,r,a,u,_)=>{i.codegen_finalize(c,r,a,u,_)},jit_clear_func:c=>i.jit_clear_func(c),jit_clear_all_funcs:()=>i.jit_clear_all_funcs(),__indirect_function_table:n};let o=e.wasm_fn;o||(o=c=>new Promise(r=>{let a="v86.wasm",u="v86-fallback.wasm";e.wasm_path?(a=e.wasm_path,u=a.replace("v86.wasm","v86-fallback.wasm")):typeof window>"u"&&typeof __dirname=="string"?(a=__dirname+"/"+a,u=__dirname+"/"+u):(a="build/"+a,u="build/"+u),At(a,{done:async _=>{try{const{instance:l}=await WebAssembly.instantiate(_,c);this.wasm_source=_,r(l.exports)}catch{At(u,{done:async m=>{const{instance:g}=await WebAssembly.instantiate(m,c);this.wasm_source=m,r(g.exports)}})}},progress:_=>{this.emulator_bus.send("download-progress",{file_index:0,file_count:1,file_name:a,lengthComputable:_.lengthComputable,total:_.total,loaded:_.loaded})}})})),o({env:t}).then(c=>{s=c.memory,c.rust_init(),c=this.v86=new Pe(this.emulator_bus,{exports:c,wasm_table:n}),i=c.cpu,this.continue_init(c,e)}),this.zstd_worker=null,this.zstd_worker_request_id=0}Ce.prototype.continue_init=async function(e,t){function i(m,g){switch(m){case"hda":n.hda=this.disk_images.hda=g;break;case"hdb":n.hdb=this.disk_images.hdb=g;break;case"cdrom":n.cdrom=this.disk_images.cdrom=g;break;case"fda":n.fda=this.disk_images.fda=g;break;case"fdb":n.fdb=this.disk_images.fdb=g;break;case"multiboot":n.multiboot=this.disk_images.multiboot=g.buffer;break;case"bzimage":n.bzimage=this.disk_images.bzimage=g.buffer;break;case"initrd":n.initrd=this.disk_images.initrd=g.buffer;break;case"bios":n.bios=g.buffer;break;case"vga_bios":n.vga_bios=g.buffer;break;case"initial_state":n.initial_state=g.buffer;break;case"fs9p_json":n.fs9p_json=g}}async function s(){if(n.fs9p&&n.fs9p_json&&!n.initial_state&&(n.fs9p.load_from_json(n.fs9p_json),t.bzimage_initrd_from_filesystem)){const{bzimage_path:m,initrd_path:g}=this.get_bzimage_initrd_from_filesystem(n.fs9p),[C,y]=await Promise.all([n.fs9p.read_file(g),n.fs9p.read_file(m)]);i.call(this,"initrd",new it(C.buffer)),i.call(this,"bzimage",new it(y.buffer))}this.serial_adapter&&this.serial_adapter.show&&this.serial_adapter.show(),this.v86.init(n),n.initial_state&&(e.restore_state(n.initial_state),n.initial_state=void 0),t.autostart&&this.v86.run(),this.emulator_bus.send("emulator-loaded")}this.bus.register("emulator-stopped",function(){this.cpu_is_running=!1,this.screen_adapter.pause()},this),this.bus.register("emulator-started",function(){this.cpu_is_running=!0,this.screen_adapter.continue()},this);var n={};this.disk_images={fda:void 0,fdb:void 0,hda:void 0,hdb:void 0,cdrom:void 0};var o=t.boot_order?t.boot_order:t.fda?801:t.hda?786:291;n.acpi=t.acpi,n.disable_jit=t.disable_jit,n.load_devices=!0,n.memory_size=t.memory_size||67108864,n.vga_memory_size=t.vga_memory_size||8388608,n.boot_order=o,n.fastboot=t.fastboot||!1,n.fda=void 0,n.fdb=void 0,n.uart1=t.uart1,n.uart2=t.uart2,n.uart3=t.uart3,n.cmdline=t.cmdline,n.preserve_mac_from_state_image=t.preserve_mac_from_state_image,n.mac_address_translation=t.mac_address_translation,n.cpuid_level=t.cpuid_level,n.virtio_balloon=t.virtio_balloon,n.virtio_console=t.virtio_console,(o=t.network_relay_url||t.net_device&&t.net_device.relay_url)&&(o==="fetch"?this.network_adapter=new $t(this.bus,t.net_device):o==="inbrowser"?this.network_adapter=new Dh(this.bus,t.net_device):o.startsWith("wisp://")||o.startsWith("wisps://")?this.network_adapter=new fi(o,this.bus,t.net_device):this.network_adapter=new _i(o,this.bus)),n.net_device=t.net_device||{type:"ne2k"},o=t.screen||{},t.screen_container&&(o.container=t.screen_container),t.disable_keyboard||(this.keyboard_adapter=new um(this.bus)),t.disable_mouse||(this.mouse_adapter=new dm(this.bus,o.container)),this.screen_adapter=o.container?new Xp(o,()=>this.v86.cpu.devices.vga&&this.v86.cpu.devices.vga.screen_fill_buffer()):new _m(o),n.screen=this.screen_adapter,n.screen_options=o,t.serial_container_xtermjs?this.serial_adapter=new Kn(t.serial_container_xtermjs,this.bus):t.serial_container&&(this.serial_adapter=new fm(t.serial_container,this.bus)),t.disable_speaker||(this.speaker_adapter=new xh(this.bus));var c=[];if(o=(m,g)=>{g&&(g.get&&g.set&&g.load?c.push({name:m,loadable:g}):((m==="bios"||m==="vga_bios"||m==="initial_state"||m==="multiboot"||m==="bzimage"||m==="initrd")&&(g.async=!1),(m==="fda"||m==="fdb")&&(g.async=!1),g.url&&!g.async?c.push({name:m,url:g.url,size:g.size}):c.push({name:m,loadable:pr(g,this.zstd_decompress_worker.bind(this))})))},t.state&&console.warn("Warning: Unknown option 'state'. Did you mean 'initial_state'?"),o("bios",t.bios),o("vga_bios",t.vga_bios),o("cdrom",t.cdrom),o("hda",t.hda),o("hdb",t.hdb),o("fda",t.fda),o("fdb",t.fdb),o("initial_state",t.initial_state),o("multiboot",t.multiboot),o("bzimage",t.bzimage),o("initrd",t.initrd),t.filesystem&&t.filesystem.handle9p)n.handle9p=t.filesystem.handle9p;else if(t.filesystem&&t.filesystem.proxy_url)n.proxy9p=t.filesystem.proxy_url;else if(t.filesystem){o=t.filesystem.basefs;var r=t.filesystem.baseurl;let m=new br;if(r&&(m=new Ns(m,r)),n.fs9p=this.fs9p=new pe(m),o){if(typeof o=="object"){var a=o.size;o=o.url}c.push({name:"fs9p_json",url:o,size:a,as_json:!0})}}var u=this,_=c.length,l=(function(m){if(m===_)setTimeout(s.bind(this),0);else{var g=c[m];g.loadable?(g.loadable.onload=(function(){i.call(this,g.name,g.loadable),l(m+1)}).bind(this),g.loadable.load()):At(g.url,{done:(function(C){g.url.endsWith(".zst")&&g.name!=="initial_state"&&(C=this.zstd_decompress(g.size,new Uint8Array(C))),i.call(this,g.name,g.as_json?C:new it(C)),l(m+1)}).bind(this),progress:function(C){C.target.status===200?u.emulator_bus.send("download-progress",{file_index:m,file_count:_,file_name:g.url,lengthComputable:C.lengthComputable,total:C.total||g.size,loaded:C.loaded}):u.emulator_bus.send("download-error",{file_index:m,file_count:_,file_name:g.url,request:C.target})},as_json:g.as_json})}}).bind(this);l(0)};Ce.prototype.zstd_decompress=function(e,t){const i=this.v86.cpu;this.zstd_context=i.zstd_create_ctx(t.length),new Uint8Array(i.wasm_memory.buffer).set(t,i.zstd_get_src_ptr(this.zstd_context)),t=i.zstd_read(this.zstd_context,e);const s=i.wasm_memory.buffer.slice(t,t+e);return i.zstd_read_free(t,e),i.zstd_free_ctx(this.zstd_context),this.zstd_context=null,s};Ce.prototype.zstd_decompress_worker=async function(e,t){if(!this.zstd_worker){const i=URL.createObjectURL(new Blob(["("+(function(){let s;globalThis.onmessage=function(n){if(s){var{src:o,decompressed_size:c,id:r}=n.data;n=s.exports;var a=n.zstd_create_ctx(o.length);new Uint8Array(n.memory.buffer).set(o,n.zstd_get_src_ptr(a));var u=n.zstd_read(a,c),_=n.memory.buffer.slice(u,u+c);n.zstd_read_free(u,c),n.zstd_free_ctx(a),postMessage({result:_,id:r},[_])}else a=Object.fromEntries("cpu_exception_hook run_hardware_timers cpu_event_halt microtick get_rand_int stop_idling io_port_read8 io_port_read16 io_port_read32 io_port_write8 io_port_write16 io_port_write32 mmap_read8 mmap_read16 mmap_read32 mmap_write8 mmap_write16 mmap_write32 mmap_write64 mmap_write128 codegen_finalize jit_clear_func jit_clear_all_funcs".split(" ").map(l=>[l,()=>console.error("zstd worker unexpectedly called "+l)])),a.__indirect_function_table=new WebAssembly.Table({element:"anyfunc",initial:1024}),a.abort=()=>{throw Error("zstd worker aborted")},a.log_from_wasm=a.console_log_from_wasm=(l,m)=>{console.log(bn(s.exports.memory.buffer,l,m))},a.dbg_trace_from_wasm=()=>console.trace(),s=new WebAssembly.Instance(new WebAssembly.Module(n.data),{env:a})}}).toString()+")()"],{type:"text/javascript"}));this.zstd_worker=new Worker(i),URL.revokeObjectURL(i),this.zstd_worker.postMessage(this.wasm_source,[this.wasm_source])}return new Promise(i=>{const s=this.zstd_worker_request_id++,n=async o=>{o.data.id===s&&(this.zstd_worker.removeEventListener("message",n),i(o.data.result))};this.zstd_worker.addEventListener("message",n),this.zstd_worker.postMessage({src:t,decompressed_size:e,id:s},[t.buffer])})};Ce.prototype.get_bzimage_initrd_from_filesystem=function(e){const t=(e.read_dir("/")||[]).map(n=>"/"+n);e=(e.read_dir("/boot/")||[]).map(n=>"/boot/"+n);let i,s;for(const n of[].concat(t,e)){const o=/old/i.test(n)||/fallback/i.test(n),c=/vmlinuz/i.test(n)||/bzimage/i.test(n),r=/initrd/i.test(n)||/initramfs/i.test(n);!c||s&&o||(s=n),!r||i&&o||(i=n)}return i&&s||(console.log("Failed to find bzimage or initrd in filesystem. Files:"),console.log(t.join(" ")),console.log(e.join(" "))),{initrd_path:i,bzimage_path:s}};Ce.prototype.run=async function(){this.v86.run()};Ce.prototype.stop=async function(){this.cpu_is_running&&await new Promise(e=>{const t=()=>{this.remove_listener("emulator-stopped",t),e()};this.add_listener("emulator-stopped",t),this.v86.stop()})};Ce.prototype.destroy=async function(){await this.stop(),this.v86.destroy(),this.keyboard_adapter&&this.keyboard_adapter.destroy(),this.network_adapter&&this.network_adapter.destroy(),this.mouse_adapter&&this.mouse_adapter.destroy(),this.screen_adapter&&this.screen_adapter.destroy(),this.serial_adapter&&this.serial_adapter.destroy(),this.speaker_adapter&&this.speaker_adapter.destroy()};Ce.prototype.restart=function(){this.v86.restart()};Ce.prototype.add_listener=function(e,t){this.bus.register(e,t,this)};Ce.prototype.remove_listener=function(e,t){this.bus.unregister(e,t)};Ce.prototype.restore_state=async function(e){this.v86.restore_state(e)};Ce.prototype.save_state=async function(){return this.v86.save_state()};Ce.prototype.get_instruction_counter=function(){return this.v86?this.v86.cpu.instruction_counter[0]>>>0:0};Ce.prototype.is_running=function(){return this.cpu_is_running};Ce.prototype.set_fda=async function(e){const t=this.v86.cpu.devices.fdc.drives[0];if(e.url&&!e.async)await new Promise(i=>{At(e.url,{done:s=>{t.insert_disk(new it(s)),i()}})});else{const i=pr(e,this.zstd_decompress_worker.bind(this));i.onload=()=>{t.insert_disk(i)},await i.load()}};Ce.prototype.set_fdb=async function(e){const t=this.v86.cpu.devices.fdc.drives[1];if(e.url&&!e.async)await new Promise(i=>{At(e.url,{done:s=>{t.insert_disk(new it(s)),i()}})});else{const i=pr(e,this.zstd_decompress_worker.bind(this));i.onload=()=>{t.insert_disk(i)},await i.load()}};Ce.prototype.eject_fda=function(){this.v86.cpu.devices.fdc.drives[0].eject_disk()};Ce.prototype.eject_fdb=function(){this.v86.cpu.devices.fdc.drives[1].eject_disk()};Ce.prototype.get_disk_fda=function(){return this.v86.cpu.devices.fdc.drives[0].get_buffer()};Ce.prototype.get_disk_fdb=function(){return this.v86.cpu.devices.fdc.drives[1].get_buffer()};Ce.prototype.set_cdrom=async function(e){if(e.url&&!e.async)At(e.url,{done:t=>{this.v86.cpu.devices.cdrom.set_cdrom(new it(t))}});else{const t=pr(e,this.zstd_decompress_worker.bind(this));t.onload=()=>{this.v86.cpu.devices.cdrom.set_cdrom(t)},await t.load()}};Ce.prototype.eject_cdrom=function(){this.v86.cpu.devices.cdrom.eject()};Ce.prototype.keyboard_send_scancodes=async function(e,t){for(var i=0;i<e.length;i++)this.bus.send("keyboard-code",e[i]),t&&await new Promise(s=>setTimeout(s,t))};Ce.prototype.keyboard_send_keys=async function(e,t){for(var i=0;i<e.length;i++)this.keyboard_adapter.simulate_press(e[i]),t&&await new Promise(s=>setTimeout(s,t))};Ce.prototype.keyboard_send_text=async function(e,t){for(var i=0;i<e.length;i++)this.keyboard_adapter.simulate_char(e[i]),t&&await new Promise(s=>setTimeout(s,t))};Ce.prototype.screen_make_screenshot=function(){return this.screen_adapter?this.screen_adapter.make_screenshot():null};Ce.prototype.screen_set_scale=function(e,t){this.screen_adapter&&this.screen_adapter.set_scale(e,t)};Ce.prototype.screen_go_fullscreen=function(){if(this.screen_adapter){var e=document.getElementById("screen_container");if(e){var t=e.requestFullScreen||e.webkitRequestFullscreen||e.mozRequestFullScreen||e.msRequestFullScreen;t&&(t.call(e),(e=document.getElementsByClassName("phone_keyboard")[0])&&e.focus());try{navigator.keyboard.lock()}catch{}this.lock_mouse()}}};Ce.prototype.lock_mouse=async function(){const e=document.body;try{await e.requestPointerLock({unadjustedMovement:!0})}catch{await e.requestPointerLock()}};Ce.prototype.mouse_set_enabled=function(e){this.mouse_adapter&&(this.mouse_adapter.emu_enabled=e)};Ce.prototype.mouse_set_status=Ce.prototype.mouse_set_enabled;Ce.prototype.keyboard_set_enabled=function(e){this.keyboard_adapter&&(this.keyboard_adapter.emu_enabled=e)};Ce.prototype.keyboard_set_status=Ce.prototype.keyboard_set_enabled;Ce.prototype.serial0_send=function(e){for(var t=0;t<e.length;t++)this.bus.send("serial0-input",e.charCodeAt(t))};Ce.prototype.serial_send_bytes=function(e,t){for(var i=0;i<t.length;i++)this.bus.send("serial"+e+"-input",t[i])};Ce.prototype.serial_set_modem_status=function(e,t){this.bus.send("serial"+e+"-modem-status-input",t)};Ce.prototype.serial_set_carrier_detect=function(e,t){this.bus.send("serial"+e+"-carrier-detect-input",t)};Ce.prototype.serial_set_ring_indicator=function(e,t){this.bus.send("serial"+e+"-ring-indicator-input",t)};Ce.prototype.serial_set_data_set_ready=function(e,t){this.bus.send("serial"+e+"-data-set-ready-input",t)};Ce.prototype.serial_set_clear_to_send=function(e,t){this.bus.send("serial"+e+"-clear-to-send-input",t)};Ce.prototype.create_file=async function(e,t){var i=this.fs9p;if(i){var s=e.split("/");if(s=s[s.length-1],e=i.SearchPath(e).parentid,s!==""&&e!==-1)await i.CreateBinaryFile(s,e,t);else return Promise.reject(new Xn)}};Ce.prototype.read_file=async function(e){var t=this.fs9p;if(t)return(e=await t.read_file(e))?e:Promise.reject(new Xn)};Ce.prototype.automatically=function(e){const t=i=>{const s=i[0];if(s){var n=i.slice(1);s.sleep?setTimeout(()=>t(n),1e3*s.sleep):s.vga_text?this.wait_until_vga_screen_contains(s.vga_text).then(()=>t(n)):s.keyboard_send?(Array.isArray(s.keyboard_send)?this.keyboard_send_scancodes(s.keyboard_send):this.keyboard_send_text(s.keyboard_send),t(n)):s.call&&(s.call(),t(n))}};t(e)};Ce.prototype.wait_until_vga_screen_contains=async function(e,t){const i=Array.isArray(e);var s=t?.timeout_msec||0;const n=new Set;t=u=>n.add(u[0]);const o=(u,_)=>_.test?_.test(u):u.startsWith(_),c=[];this.add_listener("screen-put-char",t);for(var r of this.screen_adapter.get_text_screen())if(i)c.push(r.trimRight());else if(o(r,e))return this.remove_listener("screen-put-char",t),!0;r=!1,s=s?performance.now()+s:0;e:for(;!s||performance.now()<s;){if(i){for(var a=c.length;0<a&&c[a-1]==="";)a--;if(a-=e.length,0<=a){let u=!0;for(let _=0;_<e.length&&u;_++)u=o(c[a+_],e[_]);if(u){r=!0;break}}}await new Promise(u=>setTimeout(u,100));for(const u of n)if(a=this.screen_adapter.get_text_row(u),i)c[u]=a.trimRight();else if(o(a,e)){r=!0;break e}n.clear()}return this.remove_listener("screen-put-char",t),r};Ce.prototype.read_memory=function(e,t){return this.v86.cpu.read_blob(e,t)};Ce.prototype.write_memory=function(e,t){this.v86.cpu.write_blob(e,t)};Ce.prototype.set_serial_container_xtermjs=function(e){this.serial_adapter&&this.serial_adapter.destroy&&this.serial_adapter.destroy(),this.serial_adapter=new Kn(e,this.bus),this.serial_adapter.show()};Ce.prototype.get_instruction_stats=function(){var e=this.v86.cpu,t="",i="COMPILE COMPILE_SKIPPED_NO_NEW_ENTRY_POINTS COMPILE_WRONG_ADDRESS_SPACE COMPILE_CUT_OFF_AT_END_OF_PAGE COMPILE_WITH_LOOP_SAFETY COMPILE_PAGE COMPILE_PAGE/COMPILE COMPILE_BASIC_BLOCK COMPILE_DUPLICATED_BASIC_BLOCK COMPILE_WASM_BLOCK COMPILE_WASM_LOOP COMPILE_DISPATCHER COMPILE_ENTRY_POINT COMPILE_WASM_TOTAL_BYTES COMPILE_WASM_TOTAL_BYTES/COMPILE_PAGE RUN_INTERPRETED RUN_INTERPRETED_NEW_PAGE RUN_INTERPRETED_PAGE_HAS_CODE RUN_INTERPRETED_PAGE_HAS_ENTRY_AFTER_PAGE_WALK RUN_INTERPRETED_NEAR_END_OF_PAGE RUN_INTERPRETED_DIFFERENT_STATE RUN_INTERPRETED_DIFFERENT_STATE_CPL3 RUN_INTERPRETED_DIFFERENT_STATE_FLAT RUN_INTERPRETED_DIFFERENT_STATE_IS32 RUN_INTERPRETED_DIFFERENT_STATE_SS32 RUN_INTERPRETED_MISSED_COMPILED_ENTRY_RUN_INTERPRETED RUN_INTERPRETED_STEPS RUN_FROM_CACHE RUN_FROM_CACHE_STEPS RUN_FROM_CACHE_STEPS/RUN_FROM_CACHE RUN_FROM_CACHE_STEPS/RUN_INTERPRETED_STEPS DIRECT_EXIT INDIRECT_JUMP INDIRECT_JUMP_NO_ENTRY NORMAL_PAGE_CHANGE NORMAL_FALLTHRU NORMAL_FALLTHRU_WITH_TARGET_BLOCK NORMAL_BRANCH NORMAL_BRANCH_WITH_TARGET_BLOCK CONDITIONAL_JUMP CONDITIONAL_JUMP_PAGE_CHANGE CONDITIONAL_JUMP_EXIT CONDITIONAL_JUMP_FALLTHRU CONDITIONAL_JUMP_FALLTHRU_WITH_TARGET_BLOCK CONDITIONAL_JUMP_BRANCH CONDITIONAL_JUMP_BRANCH_WITH_TARGET_BLOCK DISPATCHER_SMALL DISPATCHER_LARGE LOOP LOOP_SAFETY CONDITION_OPTIMISED CONDITION_UNOPTIMISED CONDITION_UNOPTIMISED_PF CONDITION_UNOPTIMISED_UNHANDLED_L CONDITION_UNOPTIMISED_UNHANDLED_LE FAILED_PAGE_CHANGE SAFE_READ_FAST SAFE_READ_SLOW_PAGE_CROSSED SAFE_READ_SLOW_NOT_VALID SAFE_READ_SLOW_NOT_USER SAFE_READ_SLOW_IN_MAPPED_RANGE SAFE_WRITE_FAST SAFE_WRITE_SLOW_PAGE_CROSSED SAFE_WRITE_SLOW_NOT_VALID SAFE_WRITE_SLOW_NOT_USER SAFE_WRITE_SLOW_IN_MAPPED_RANGE SAFE_WRITE_SLOW_READ_ONLY SAFE_WRITE_SLOW_HAS_CODE SAFE_READ_WRITE_FAST SAFE_READ_WRITE_SLOW_PAGE_CROSSED SAFE_READ_WRITE_SLOW_NOT_VALID SAFE_READ_WRITE_SLOW_NOT_USER SAFE_READ_WRITE_SLOW_IN_MAPPED_RANGE SAFE_READ_WRITE_SLOW_READ_ONLY SAFE_READ_WRITE_SLOW_HAS_CODE PAGE_FAULT TLB_MISS MAIN_LOOP MAIN_LOOP_IDLE DO_MANY_CYCLES CYCLE_INTERNAL INVALIDATE_ALL_MODULES_NO_FREE_WASM_INDICES INVALIDATE_MODULE_WRITTEN_WHILE_COMPILED INVALIDATE_MODULE_UNUSED_AFTER_OVERWRITE INVALIDATE_MODULE_DIRTY_PAGE INVALIDATE_PAGE_HAD_CODE INVALIDATE_PAGE_HAD_ENTRY_POINTS DIRTY_PAGE_DID_NOT_HAVE_CODE RUN_FROM_CACHE_EXIT_SAME_PAGE RUN_FROM_CACHE_EXIT_NEAR_END_OF_PAGE RUN_FROM_CACHE_EXIT_DIFFERENT_PAGE CLEAR_TLB FULL_CLEAR_TLB TLB_FULL TLB_GLOBAL_FULL MODRM_SIMPLE_REG MODRM_SIMPLE_REG_WITH_OFFSET MODRM_SIMPLE_CONST_OFFSET MODRM_COMPLEX SEG_OFFSET_OPTIMISED SEG_OFFSET_NOT_OPTIMISED SEG_OFFSET_NOT_OPTIMISED_ES SEG_OFFSET_NOT_OPTIMISED_FS SEG_OFFSET_NOT_OPTIMISED_GS SEG_OFFSET_NOT_OPTIMISED_NOT_FLAT".split(" "),s=0;const n={};for(let c=0;c<i.length;c++){const r=i[c];var o=void 0;if(r.includes("/")){s++;const[a,u]=r.split("/");o=n[a]/n[u]}else o=n[r]=e.wm.exports.profiler_stat_get(c-s),o=1e8<=o?Math.round(o/1e6)+"m":1e5<=o?Math.round(o/1e3)+"k":o;t+=r+"="+o+`
`}return t+=`
`,i=e.wm.exports.get_valid_tlb_entries_count(),s=e.wm.exports.get_valid_global_tlb_entries_count(),t=t+("TLB_ENTRIES="+i+" ("+s+" global, "+(i-s)+` non-global)
WASM_TABLE_FREE=`)+(e.wm.exports.jit_get_wasm_table_index_free_list_count()+`
`),t+="JIT_CACHE_SIZE="+e.wm.exports.jit_get_cache_size()+`
`,t+="FLAT_SEGMENTS="+e.wm.exports.has_flat_segmentation()+`
`,t+="wasm memory size: "+(e.wasm_memory.buffer.byteLength>>20)+`m
`,t=t+`Config:
JIT_DISABLED=`+(e.wm.exports.get_jit_config(0)+`
`),t+="MAX_PAGES="+e.wm.exports.get_jit_config(1)+`
`,t+="JIT_USE_LOOP_SAFETY="+!!e.wm.exports.get_jit_config(2)+`
`,t+="MAX_EXTRA_BASIC_BLOCKS="+e.wm.exports.get_jit_config(3)+`
`,e=[gs(e,!1,!1,!1,!1),gs(e,!0,!1,!1,!1),gs(e,!1,!0,!1,!1),gs(e,!1,!1,!0,!1),gs(e,!1,!1,!1,!0)].join(`

`),t+e};function Xn(e){this.message=e||"File not found"}Xn.prototype=Error.prototype;typeof ir<"u"&&typeof ir.exports<"u"?ir.exports.V86=Ce:typeof window<"u"?window.V86=Ce:typeof importScripts=="function"&&(self.V86=Ce);function Pe(e,t){this.stopping=this.running=!1,this.idle=!0,this.tick_counter=0,this.worker=null,this.cpu=new we(e,t,()=>{this.idle&&this.next_tick(0)}),this.bus=e,this.register_yield()}Pe.prototype.run=function(){this.stopping=!1,this.running||(this.running=!0,this.bus.send("emulator-started")),this.next_tick(0)};Pe.prototype.do_tick=function(){if(this.stopping||!this.running)this.stopping=this.running=!1,this.bus.send("emulator-stopped");else{this.idle=!1;var e=this.cpu.main_loop();this.next_tick(e)}};Pe.prototype.next_tick=function(e){const t=++this.tick_counter;this.idle=!0,this.yield(e,t)};Pe.prototype.yield_callback=function(e){e===this.tick_counter&&this.do_tick()};Pe.prototype.stop=function(){this.running&&(this.stopping=!0)};Pe.prototype.destroy=function(){this.unregister_yield()};Pe.prototype.restart=function(){this.cpu.reset_cpu(),this.cpu.load_bios()};Pe.prototype.init=function(e){this.cpu.init(e,this.bus),this.bus.send("emulator-ready")};if(typeof process<"u")Pe.prototype.yield=function(e,t){1>e?global.setImmediate(i=>this.yield_callback(i),t):setTimeout(i=>this.yield_callback(i),e,t)},Pe.prototype.register_yield=function(){},Pe.prototype.unregister_yield=function(){};else if(window.scheduler&&typeof window.scheduler.postTask=="function"&&location.href.includes("use-scheduling-api"))Pe.prototype.yield=function(e,t){e=Math.max(0,e),window.scheduler.postTask(()=>this.yield_callback(t),{delay:e})},Pe.prototype.register_yield=function(){},Pe.prototype.unregister_yield=function(){};else if(typeof Worker<"u"){let e=function(){let t;globalThis.onmessage=function(i){const s=i.data.t;t=t&&clearTimeout(t),1>s?postMessage(i.data.tick):t=setTimeout(()=>postMessage(i.data.tick),s)}};Pe.prototype.register_yield=function(){const t=URL.createObjectURL(new Blob(["("+e.toString()+")()"],{type:"text/javascript"}));this.worker=new Worker(t),this.worker.onmessage=i=>this.yield_callback(i.data),URL.revokeObjectURL(t)},Pe.prototype.yield=function(t,i){this.worker.postMessage({t,tick:i})},Pe.prototype.unregister_yield=function(){this.worker&&this.worker.terminate(),this.worker=null}}else Pe.prototype.yield=function(e){setTimeout(()=>{this.do_tick()},e)},Pe.prototype.register_yield=function(){},Pe.prototype.unregister_yield=function(){};Pe.prototype.save_state=function(){for(var e=[],t=wn(this.cpu,e),i=[],s=0,n=0;n<e.length;n++){var o=e[n].byteLength;i[n]={offset:s,length:o},s+=o,s=s+3&-4}n=JSON.stringify({buffer_infos:i,state:t}),n=new TextEncoder().encode(n),t=16+n.length,t=t+3&-4,o=t+s,s=new ArrayBuffer(o);var c=new Int32Array(s,0,4);for(new Uint8Array(s,16,n.length).set(n),t=new Uint8Array(s,t),c[0]=-2039052682,c[1]=6,c[2]=o,c[3]=n.length,n=0;n<e.length;n++)t.set(e[n],i[n].offset);return s};Pe.prototype.restore_state=function(e){return Qp(this.cpu,e)};if(typeof performance=="object"&&performance.now)Pe.microtick=performance.now.bind(performance);else if(typeof require=="function"){const{performance:e}=require("perf_hooks");Pe.microtick=e.now.bind(e)}else Pe.microtick=typeof process=="object"&&process.hrtime?function(){var e=process.hrtime();return 1e3*e[0]+e[1]/1e6}:Date.now;function zs(e){this.cpu=e;var t=e.io;e.devices.pci.register_device({pci_id:56,pci_space:[134,128,19,113,7,0,128,2,8,0,128,6,0,0,128,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,1,0,0],pci_bars:[],name:"acpi"}),this.timer_imprecision_offset=this.timer_last_value=0,this.status=1,this.pm1_enable=this.pm1_status=0,this.last_timer=this.get_timer(Pe.microtick()),this.gpe=new Uint8Array(4),t.register_read(45056,this,void 0,function(){return this.pm1_status}),t.register_write(45056,this,void 0,function(i){A(i,4),this.pm1_status&=~i}),t.register_read(45058,this,void 0,function(){return this.pm1_enable}),t.register_write(45058,this,void 0,function(i){A(i),this.pm1_enable=i}),t.register_read(45060,this,function(){return this.status&255},function(){return this.status}),t.register_write(45060,this,void 0,function(i){A(i),this.status=i}),t.register_read(45064,this,void 0,void 0,function(){return this.get_timer(Pe.microtick())&16777215}),t.register_read(45024,this,function(){return this.gpe[0]}),t.register_read(45025,this,function(){return this.gpe[1]}),t.register_read(45026,this,function(){return this.gpe[2]}),t.register_read(45027,this,function(){return this.gpe[3]}),t.register_write(45024,this,function(i){A(i),this.gpe[0]=i}),t.register_write(45025,this,function(i){A(i),this.gpe[1]=i}),t.register_write(45026,this,function(i){A(i),this.gpe[2]=i}),t.register_write(45027,this,function(i){A(i),this.gpe[3]=i})}zs.prototype.timer=function(e){e=this.get_timer(e);var t=((e^this.last_timer)&8388608)!==0;return this.pm1_enable&1&&t?(this.pm1_status|=1,this.cpu.device_raise_irq(9)):this.cpu.device_lower_irq(9),this.last_timer=e,100};zs.prototype.get_timer=function(e){return e=Math.round(3579.545*e),e===this.timer_last_value?3579.545>this.timer_imprecision_offset&&this.timer_imprecision_offset++:this.timer_last_value+this.timer_imprecision_offset<=e&&(this.timer_imprecision_offset=0,this.timer_last_value=e),this.timer_last_value+this.timer_imprecision_offset};zs.prototype.get_state=function(){var e=[];return e[0]=this.status,e[1]=this.pm1_status,e[2]=this.pm1_enable,e[3]=this.gpe,e};zs.prototype.set_state=function(e){this.status=e[0],this.pm1_status=e[1],this.pm1_enable=e[2],this.gpe=e[3]};function Pt(e,t,i){switch(this.bus=i,this.cpu=e,this.ints=4,this.line_control=this.baud_rate=0,this.lsr=96,this.ier=this.fifo_control=0,this.iir=1,this.irq=this.scratch_register=this.modem_status=this.modem_control=0,this.input=[],this.current_line="",t){case 1016:this.com=0,this.irq=4;break;case 760:this.com=1,this.irq=3;break;case 1e3:this.com=2,this.irq=4;break;case 744:this.irq=this.com=3;break;default:""+A(t),this.com=0,this.irq=4}this.bus.register("serial"+this.com+"-input",function(s){this.data_received(s)},this),this.bus.register("serial"+this.com+"-modem-status-input",function(s){this.set_modem_status(s)},this),this.bus.register("serial"+this.com+"-carrier-detect-input",function(s){this.set_modem_status(s?this.modem_status|136:this.modem_status&-137)},this),this.bus.register("serial"+this.com+"-ring-indicator-input",function(s){this.set_modem_status(s?this.modem_status|68:this.modem_status&-69)},this),this.bus.register("serial"+this.com+"-data-set-ready-input",function(s){this.set_modem_status(s?this.modem_status|34:this.modem_status&-35)},this),this.bus.register("serial"+this.com+"-clear-to-send-input",function(s){this.set_modem_status(s?this.modem_status|17:this.modem_status&-18)},this),e=e.io,e.register_write(t,this,function(s){this.write_data(s)},function(s){this.write_data(s&255),this.write_data(s>>8)}),e.register_write(t|1,this,function(s){this.line_control&128?(this.baud_rate=this.baud_rate&255|s<<8,A(this.baud_rate)):((this.ier&2)===0&&s&2&&this.ThrowInterrupt(2),this.ier=s&15,A(s),this.CheckInterrupt())}),e.register_read(t,this,function(){if(this.line_control&128)return this.baud_rate&255;let s=0;return this.input.length!==0&&(s=this.input.shift(),A(s)),this.input.length===0&&(this.lsr&=-2,this.ClearInterrupt(12),this.ClearInterrupt(4)),s}),e.register_read(t|1,this,function(){return this.line_control&128?this.baud_rate>>8:this.ier&15}),e.register_read(t|2,this,function(){var s=this.iir&15;return A(this.iir),this.iir===2&&this.ClearInterrupt(2),this.fifo_control&1&&(s|=192),s}),e.register_write(t|2,this,function(s){A(s),this.fifo_control=s}),e.register_read(t|3,this,function(){return A(this.line_control),this.line_control}),e.register_write(t|3,this,function(s){A(s),this.line_control=s}),e.register_read(t|4,this,function(){return this.modem_control}),e.register_write(t|4,this,function(s){A(s),this.modem_control=s}),e.register_read(t|5,this,function(){return A(this.lsr),this.lsr}),e.register_write(t|5,this,function(){}),e.register_read(t|6,this,function(){return A(this.modem_status),this.modem_status&=240}),e.register_write(t|6,this,function(s){A(s),this.set_modem_status(s)}),e.register_read(t|7,this,function(){return this.scratch_register}),e.register_write(t|7,this,function(s){this.scratch_register=s})}Pt.prototype.get_state=function(){var e=[];return e[0]=this.ints,e[1]=this.baud_rate,e[2]=this.line_control,e[3]=this.lsr,e[4]=this.fifo_control,e[5]=this.ier,e[6]=this.iir,e[7]=this.modem_control,e[8]=this.modem_status,e[9]=this.scratch_register,e[10]=this.irq,e};Pt.prototype.set_state=function(e){this.ints=e[0],this.baud_rate=e[1],this.line_control=e[2],this.lsr=e[3],this.fifo_control=e[4],this.ier=e[5],this.iir=e[6],this.modem_control=e[7],this.modem_status=e[8],this.scratch_register=e[9],this.irq=e[10]};Pt.prototype.CheckInterrupt=function(){this.ints&4096&&this.ier&1?(this.iir=12,this.cpu.device_raise_irq(this.irq)):this.ints&16&&this.ier&1?(this.iir=4,this.cpu.device_raise_irq(this.irq)):this.ints&4&&this.ier&2?(this.iir=2,this.cpu.device_raise_irq(this.irq)):this.ints&1&&this.ier&8?(this.iir=0,this.cpu.device_raise_irq(this.irq)):(this.iir=1,this.cpu.device_lower_irq(this.irq))};Pt.prototype.ThrowInterrupt=function(e){this.ints|=1<<e,this.CheckInterrupt()};Pt.prototype.ClearInterrupt=function(e){this.ints&=~(1<<e),this.CheckInterrupt()};Pt.prototype.data_received=function(e){A(e),this.input.push(e),this.lsr|=1,this.fifo_control&1?this.ThrowInterrupt(12):this.ThrowInterrupt(4)};Pt.prototype.write_data=function(e){this.line_control&128?this.baud_rate=this.baud_rate&-256|e:(A(e),this.ThrowInterrupt(2),this.modem_control&16?this.data_received(e):this.bus.send("serial"+this.com+"-output-byte",e))};Pt.prototype.set_modem_status=function(e){A(e);const t=this.modem_status&15;let i=(this.modem_status^e)>>4;this.modem_status=e,this.modem_status=this.modem_status|i|t};function jt(e){this.pci_addr=new Uint8Array(4),this.pci_value=new Uint8Array(4),this.pci_response=new Uint8Array(4),this.pci_status=new Uint8Array(4),this.pci_addr32=new Int32Array(this.pci_addr.buffer),this.pci_value32=new Int32Array(this.pci_value.buffer),this.pci_response32=new Int32Array(this.pci_response.buffer),this.pci_status32=new Int32Array(this.pci_status.buffer),this.device_spaces=[],this.devices=[],this.cpu=e;for(var t=0;256>t;t++)this.device_spaces[t]=void 0,this.devices[t]=void 0;this.io=e.io,e.io.register_write(3324,this,function(i){this.pci_write8(this.pci_addr32[0],i)},function(i){this.pci_write16(this.pci_addr32[0],i)},function(i){this.pci_write32(this.pci_addr32[0],i)}),e.io.register_write(3325,this,function(i){this.pci_write8(this.pci_addr32[0]+1|0,i)}),e.io.register_write(3326,this,function(i){this.pci_write8(this.pci_addr32[0]+2|0,i)},function(i){this.pci_write16(this.pci_addr32[0]+2|0,i)}),e.io.register_write(3327,this,function(i){this.pci_write8(this.pci_addr32[0]+3|0,i)}),e.io.register_read_consecutive(3324,this,function(){return this.pci_response[0]},function(){return this.pci_response[1]},function(){return this.pci_response[2]},function(){return this.pci_response[3]}),e.io.register_read_consecutive(3320,this,function(){return this.pci_status[0]},function(){return this.pci_status[1]},function(){return this.pci_status[2]},function(){return this.pci_status[3]}),e.io.register_write_consecutive(3320,this,function(i){this.pci_addr[0]=i&252},function(i){(this.pci_addr[1]&6)===2&&(i&6)===6?e.reboot_internal():this.pci_addr[1]=i},function(i){this.pci_addr[2]=i},function(i){this.pci_addr[3]=i,this.pci_query()}),this.register_device({pci_id:0,pci_space:[134,128,55,18,0,0,0,0,2,0,0,6,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,16,0,0,0,0,0,0],pci_bars:[],name:"82441FX PMC"}),this.isa_bridge={pci_id:8,pci_space:[134,128,0,112,7,0,0,2,0,0,1,6,0,0,128,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],pci_bars:[],name:"82371SB PIIX3 ISA"},this.isa_bridge_space=this.register_device(this.isa_bridge),this.isa_bridge_space8=new Uint8Array(this.isa_bridge_space.buffer)}jt.prototype.get_state=function(){for(var e=[],t=0;256>t;t++)e[t]=this.device_spaces[t];return e[256]=this.pci_addr,e[257]=this.pci_value,e[258]=this.pci_response,e[259]=this.pci_status,e};jt.prototype.set_state=function(e){for(var t=0;256>t;t++){var i=this.devices[t],s=e[t];if(i&&s){for(var n=0;n<i.pci_bars.length;n++){var o=s[4+n];if(o&1){var c=i.pci_bars[n];this.set_io_bars(c,c.original_bar&65534,o&65534)}}this.device_spaces[t].set(s)}else s&&A(t,2)}this.pci_addr.set(e[256]),this.pci_value.set(e[257]),this.pci_response.set(e[258]),this.pci_status.set(e[259])};jt.prototype.pci_query=function(){var e=this.pci_addr[2]<<8|this.pci_addr[1],t=this.pci_addr[0]&252,i=e>>3&31,s="query enabled="+(this.pci_addr[3]>>7)+(" bdf="+A(e,4));s+=" dev="+A(i,2),s+=" addr="+A(t,2),e=this.device_spaces[e],e!==void 0?(this.pci_status32[0]=-2147483648,this.pci_response32[0]=t<e.byteLength?e[t>>2]:0,s+=" "+A(this.pci_addr32[0]>>>0,8)+" -> "+A(this.pci_response32[0]>>>0,8)):(this.pci_response32[0]=-1,this.pci_status32[0]=0)};jt.prototype.pci_write8=function(e,t){var i=e>>8&65535;e&=255;var s=new Uint8Array(this.device_spaces[i].buffer);A(e),A(i>>3,2),A(e,4),A(t,2),s[e]=t};jt.prototype.pci_write16=function(e,t){var i=e>>8&65535;e&=255;var s=new Uint16Array(this.device_spaces[i].buffer);16<=e&&44>e?A(e):(A(e),A(i>>3,2),A(e,4),A(t,4),s[e>>>1]=t)};jt.prototype.pci_write32=function(e,t){var i=e>>8&65535;e&=255;var s=this.device_spaces[i],n=this.devices[i];if(s)if(16<=e&&40>e){if(n=n.pci_bars[e-16>>2],A(s[e>>2]),A(t>>>0),A(i>>3,2),n){i=e>>2;var o=s[i]&1;if((t|3|n.size-1)===-1?(t=~(n.size-1)|o,o===0&&(s[i]=t)):o===0&&(s[i]=n.original_bar),o===1){o=s[i]&65534;var c=t&65534;A(o>>>0,8),A(c>>>0,8),this.set_io_bars(n,o,c),s[i]=t|1}}else s[e>>2]=0;A(s[e>>2]>>>0)}else e===48?(A(i>>3,2),A(t>>>0,8),s[e>>2]=n.pci_rom_size?(t|2047)===-1?-n.pci_rom_size|0:n.pci_rom_address|0:0):e===4?(A(i>>3,2),A(e,4),A(t>>>0,8)):(A(i>>3,2),A(e,4),A(t>>>0,8),s[e>>>2]=t)};jt.prototype.register_device=function(e){var t=e.pci_id;A(t);var i=new Int32Array(64);i.set(new Int32Array(new Uint8Array(e.pci_space).buffer)),this.device_spaces[t]=i,this.devices[t]=e,t=i.slice(4,10);for(var s=0;s<e.pci_bars.length;s++){var n=e.pci_bars[s];if(n){var o=t[s],c=o&1;if(A(o),n.original_bar=o,n.entries=[],c!==0)for(o&=-2,c=0;c<n.size;c++)n.entries[c]=this.io.ports[o+c]}}return i};jt.prototype.set_io_bars=function(e,t,i){var s=e.size;A(t),A(i);for(var n=this.io.ports,o=0;o<s;o++){4096<=t+o&&(n[t+o]=this.io.create_empty_entry());var c=e.entries[o];4096<=i+o&&(n[i+o]=c)}};jt.prototype.raise_irq=function(e){this.cpu.device_raise_irq(this.isa_bridge_space8[96+((this.device_spaces[e][15]>>8&255)-1+((e>>3)-1&255)&3)])};jt.prototype.lower_irq=function(e){this.cpu.device_lower_irq(this.isa_bridge_space8[96+((this.device_spaces[e][15]>>8&255)+(e>>3&255)-2&3)])};function Ih(e,t,i){e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&(e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5]),e[6]===t[0]&&e[7]===t[1]&&e[8]===t[2]&&e[9]===t[3]&&e[10]===t[4]&&e[11]===t[5]&&(e[6]=i[0],e[7]=i[1],e[8]=i[2],e[9]=i[3],e[10]=i[4],e[11]=i[5]);var s=e[12]<<8|e[13];if(s===2048){if(e=e.subarray(14),e[0]>>4===4&&e[9]===17){e=e.subarray(20),s=e[0]<<8|e[1];var n=e[2]<<8|e[3];if(A(e[6]<<8|e[7],4),s===67||n===67)if(s=e.subarray(8),n=s[236]<<24|s[237]<<16|s[238]<<8|s[239],n!==1669485411)A(n,8);else for(s[28]===t[0]&&s[29]===t[1]&&s[30]===t[2]&&s[31]===t[3]&&s[32]===t[4]&&s[33]===t[5]&&(s[28]=i[0],s[29]=i[1],s[30]=i[2],s[31]=i[3],s[32]=i[4],s[33]=i[5],e[6]=e[7]=0),n=240;n<s.length;){const o=s[n++];if(o===255)break;const c=s[n++];o===61&&s[n+0]===1&&s[n+1]===t[0]&&s[n+2]===t[1]&&s[n+3]===t[2]&&s[n+4]===t[3]&&s[n+5]===t[4]&&s[n+6]===t[5]&&(s[n+1]=i[0],s[n+2]=i[1],s[n+3]=i[2],s[n+4]=i[3],s[n+5]=i[4],s[n+6]=i[5],e[6]=e[7]=0),n+=c}}}else s===2054&&(e=e.subarray(14),Jt(e.subarray(8,14)),Jt(e.subarray(18,24)),e[8]===t[0]&&e[9]===t[1]&&e[10]===t[2]&&e[11]===t[3]&&e[12]===t[4]&&e[13]===t[5]&&(e[8]=i[0],e[9]=i[1],e[10]=i[2],e[11]=i[3],e[12]=i[4],e[13]=i[5]))}function Jt(e){return[e[0].toString(16).padStart(2,"0"),e[1].toString(16).padStart(2,"0"),e[2].toString(16).padStart(2,"0"),e[3].toString(16).padStart(2,"0"),e[4].toString(16).padStart(2,"0"),e[5].toString(16).padStart(2,"0")].join(":")}function Rt(e,t,i,s,n){for(this.cpu=e,this.pci=e.devices.pci,this.id=n||0,this.preserve_mac_from_state_image=i,this.mac_address_translation=s,this.bus=t,this.bus.register("net"+this.id+"-receive",function(o){this.receive(o)},this),this.port=768+256*this.id,this.name="ne2k",this.pci_space=[236,16,41,128,3,1,0,0,0,0,0,2,0,0,0,0,this.port&255|1,this.port>>8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,244,26,0,17,0,0,184,254,0,0,0,0,0,0,0,0,0,1,0,0],this.pci_id=(this.id===0?5:7+this.id)<<3,this.pci_bars=[{size:32}],this.imr=this.isr=0,this.cr=1,this.tpsr=this.tcnt=this.rcnt=this.dcfg=0,this.memory=new Uint8Array(32768),this.txcr=this.rxcr=0,this.tsr=1,this.mac=new Uint8Array([0,34,21,255*Math.random()|0,255*Math.random()|0,255*Math.random()|0]),this.bus.send("net"+this.id+"-mac",Jt(this.mac)),this.mar=Uint8Array.of(255,255,255,255,255,255,255,255),this.mac_address_in_state=null,t=0;6>t;t++)this.memory[t<<1]=this.memory[t<<1|1]=this.mac[t];this.memory[28]=this.memory[29]=87,this.memory[30]=this.memory[31]=87,""+Jt(this.mac),this.rsar=0,this.pstart=64,this.pstop=128,this.boundary=this.curpg=76,t=e.io,t.register_read(this.port|0,this,function(){return this.cr},function(){return this.cr}),t.register_write(this.port|0,this,function(o){this.cr=o,A(o,2),A(this.txcr,2),this.cr&1||(o&24&&this.rcnt===0&&this.do_interrupt(64),o&4&&(o=this.tpsr<<8,o=this.memory.subarray(o,o+this.tcnt),this.mac_address_in_state&&(o=new Uint8Array(o),Ih(o,this.mac_address_in_state,this.mac)),this.bus.send("net"+this.id+"-send",o),this.bus.send("eth-transmit-end",[o.length]),this.cr&=-5,this.do_interrupt(2),A(o.byteLength)))}),t.register_read(this.port|13,this,function(){return this.get_page()===1?this.mar[5]:0}),t.register_read(this.port|14,this,function(){return this.get_page()===1?this.mar[6]:0},function(){return this.get_page(),0}),t.register_read(this.port|15,this,function(){return this.get_page()===1?this.mar[7]:0}),t.register_read(this.port|31,this,function(){return this.get_page(),this.do_interrupt(128),0}),t.register_write(this.port|31,this,function(o){this.get_page(),A(o,2)}),t.register_read(this.port|1,this,function(){var o=this.get_page();return o===0?this.pstart:o===1?this.mac[0]:o===2?this.pstart:0}),t.register_write(this.port|1,this,function(o){var c=this.get_page();c===0?(A(o,2),this.pstart=o):c===1?(A(o),this.mac[0]=o):A(o)}),t.register_read(this.port|2,this,function(){var o=this.get_page();return o===0?this.pstop:o===1?this.mac[1]:o===2?this.pstop:0}),t.register_write(this.port|2,this,function(o){var c=this.get_page();c===0?(A(o,2),o>this.memory.length>>8&&(o=this.memory.length>>8,A(o)),this.pstop=o):c===1?(A(o),this.mac[1]=o):A(o)}),t.register_read(this.port|7,this,function(){var o=this.get_page();return o===0?(A(this.isr,2),this.isr):o===1?(A(this.curpg,2),this.curpg):0}),t.register_write(this.port|7,this,function(o){var c=this.get_page();c===0?(A(o,2),this.isr&=~o,this.update_irq()):c===1&&(A(o,2),this.curpg=o)}),t.register_write(this.port|13,this,function(o){this.get_page()===0&&(this.txcr=o),A(o,2)}),t.register_write(this.port|14,this,function(o){this.get_page()===0?(A(o,2),this.dcfg=o):A(o,2)}),t.register_read(this.port|10,this,function(){var o=this.get_page();return o===0?80:o===1?this.mar[2]:0}),t.register_write(this.port|10,this,function(o){this.get_page()===0?(A(o,2),this.rcnt=this.rcnt&65280|o&255):A(o,2)}),t.register_read(this.port|11,this,function(){var o=this.get_page();return o===0?67:o===1?this.mar[3]:0}),t.register_write(this.port|11,this,function(o){this.get_page()===0?(A(o,2),this.rcnt=this.rcnt&255|o<<8&65280):A(o,2)}),t.register_read(this.port|8,this,function(){var o=this.get_page();return o===0?this.rsar&255:o===1?this.mar[0]:0}),t.register_write(this.port|8,this,function(o){this.get_page()===0?(A(o,2),this.rsar=this.rsar&65280|o&255):A(o,2)}),t.register_read(this.port|9,this,function(){var o=this.get_page();return o===0?this.rsar>>8&255:o===1?this.mar[1]:0}),t.register_write(this.port|9,this,function(o){this.get_page()===0?(A(o,2),this.rsar=this.rsar&255|o<<8&65280):A(o,2)}),t.register_write(this.port|15,this,function(o){this.get_page()===0?(A(o,2),A(this.isr,2),this.imr=o,this.update_irq()):A(o,2)}),t.register_read(this.port|3,this,function(){var o=this.get_page();return o===0?(A(this.boundary,2),this.boundary):o===1?this.mac[2]:0}),t.register_write(this.port|3,this,function(o){var c=this.get_page();c===0?(A(o,2),this.boundary=o):c===1?(A(o),this.mac[2]=o):A(o)}),t.register_read(this.port|4,this,function(){var o=this.get_page();return o===0?this.tsr:o===1?this.mac[3]:0}),t.register_write(this.port|4,this,function(o){var c=this.get_page();c===0?(A(o,2),this.tpsr=o):c===1?(A(o),this.mac[3]=o):A(o)}),t.register_read(this.port|5,this,function(){var o=this.get_page();return o===0?0:o===1?this.mac[4]:0}),t.register_write(this.port|5,this,function(o){var c=this.get_page();c===0?(A(o,2),this.tcnt=this.tcnt&-256|o):c===1?(A(o),this.mac[4]=o):A(o)}),t.register_read(this.port|6,this,function(){var o=this.get_page();return o===0?0:o===1?this.mac[5]:0}),t.register_write(this.port|6,this,function(o){var c=this.get_page();c===0?(A(o,2),this.tcnt=this.tcnt&255|o<<8):c===1?(A(o),this.mac[5]=o):A(o)}),t.register_read(this.port|12,this,function(){var o=this.get_page();return o===0?9:o===1?this.mar[4]:0}),t.register_write(this.port|12,this,function(o){this.get_page()===0?(A(o,2),this.rxcr=o):A(o)}),t.register_read(this.port|16,this,this.data_port_read8,this.data_port_read16,this.data_port_read32),t.register_write(this.port|16,this,this.data_port_write16,this.data_port_write16,this.data_port_write32),e.devices.pci.register_device(this)}Rt.prototype.get_state=function(){var e=[];return e[0]=this.isr,e[1]=this.imr,e[2]=this.cr,e[3]=this.dcfg,e[4]=this.rcnt,e[5]=this.tcnt,e[6]=this.tpsr,e[7]=this.rsar,e[8]=this.pstart,e[9]=this.curpg,e[10]=this.boundary,e[11]=this.pstop,e[12]=this.rxcr,e[13]=this.txcr,e[14]=this.tsr,e[15]=this.mac,e[16]=this.memory,e};Rt.prototype.set_state=function(e){this.isr=e[0],this.imr=e[1],this.cr=e[2],this.dcfg=e[3],this.rcnt=e[4],this.tcnt=e[5],this.tpsr=e[6],this.rsar=e[7],this.pstart=e[8],this.curpg=e[9],this.boundary=e[10],this.pstop=e[11],this.rxcr=e[12],this.txcr=e[13],this.tsr=e[14],this.preserve_mac_from_state_image?(this.mac=e[15],this.memory=e[16]):this.mac_address_translation&&(this.mac_address_in_state=e[15],this.memory=e[16],Jt(this.mac_address_in_state),Jt(this.mac)),this.bus.send("net"+this.id+"-mac",Jt(this.mac))};Rt.prototype.do_interrupt=function(e){A(e,2),this.isr|=e,this.update_irq()};Rt.prototype.update_irq=function(){this.imr&this.isr?this.pci.raise_irq(this.pci_id):this.pci.lower_irq(this.pci_id)};Rt.prototype.data_port_write=function(e){(16>=this.rsar||16384<=this.rsar&&32768>this.rsar)&&(this.memory[this.rsar]=e),this.rsar++,this.rcnt--,this.rsar>=this.pstop<<8&&(this.rsar+=this.pstart-this.pstop<<8),this.rcnt===0&&this.do_interrupt(64)};Rt.prototype.data_port_write16=function(e){this.data_port_write(e),this.dcfg&1&&this.data_port_write(e>>8)};Rt.prototype.data_port_write32=function(e){this.data_port_write(e),this.data_port_write(e>>8),this.data_port_write(e>>16),this.data_port_write(e>>24)};Rt.prototype.data_port_read=function(){let e=0;return 32768>this.rsar&&(e=this.memory[this.rsar]),this.rsar++,this.rcnt--,this.rsar>=this.pstop<<8&&(this.rsar+=this.pstart-this.pstop<<8),this.rcnt===0&&this.do_interrupt(64),e};Rt.prototype.data_port_read8=function(){return this.data_port_read16()&255};Rt.prototype.data_port_read16=function(){return this.dcfg&1?this.data_port_read()|this.data_port_read()<<8:this.data_port_read()};Rt.prototype.data_port_read32=function(){return this.data_port_read()|this.data_port_read()<<8|this.data_port_read()<<16|this.data_port_read()<<24};Rt.prototype.receive=function(e){if(!(this.cr&1)&&(this.bus.send("eth-receive-end",[e.length]),this.rxcr&16||this.rxcr&4&&e[0]===255&&e[1]===255&&e[2]===255&&e[3]===255&&e[4]===255&&e[5]===255||!(this.rxcr&8&&(e[0]&1)===1||e[0]!==this.mac[0]||e[1]!==this.mac[1]||e[2]!==this.mac[2]||e[3]!==this.mac[3]||e[4]!==this.mac[4]||e[5]!==this.mac[5]))){this.mac_address_in_state&&(e=new Uint8Array(e),Ih(e,this.mac,this.mac_address_in_state));var t=this.curpg<<8,i=Math.max(60,e.length)+4,s=t+4,n=this.curpg+1+(i>>8),o=t+i,c=1+(i>>8),r=this.boundary>this.curpg?this.boundary-this.curpg:this.pstop-this.curpg+this.boundary-this.pstart;r<c&&this.boundary!==0?(A(this.pstart),A(this.pstop),A(this.curpg),A(c),A(this.boundary),A(r)):(o>this.pstop<<8?(o=(this.pstop<<8)-s,this.memory.set(e.subarray(0,o),s),this.memory.set(e.subarray(o),this.pstart<<8),A(o)):(this.memory.set(e,s),60>e.length&&this.memory.fill(0,s+e.length,s+60)),n>=this.pstop&&(n+=this.pstart-this.pstop),this.memory[t]=1,this.memory[t+1]=n,this.memory[t+2]=i,this.memory[t+3]=i>>8,this.curpg=n,A(t),A(i),A(n),this.do_interrupt(1))}};Rt.prototype.get_page=function(){return this.cr>>6&3};function pi(e,t){this.bus=t,this.rows=25,this.cols=80,this.ports=4,t=[{size_supported:16,notify_offset:0},{size_supported:16,notify_offset:1},{size_supported:16,notify_offset:2},{size_supported:16,notify_offset:3}];for(let i=1;i<this.ports;++i)t.push({size_supported:16,notify_offset:0}),t.push({size_supported:8,notify_offset:1});this.virtio=new _t(e,{name:"virtio-console",pci_id:96,device_id:4163,subsystem_device_id:3,common:{initial_port:47104,queues:t,features:[0,1,32],on_driver_ok:()=>{}},notification:{initial_port:47360,single_handler:!1,handlers:[()=>{},i=>{const s=this.virtio.queues[i],n=3<i?i-3>>1:0;for(;s.has_request();){const o=s.pop_request(),c=new Uint8Array(o.length_readable);o.get_next_blob(c),this.bus.send("virtio-console"+n+"-output-bytes",c),this.Ack(i,o)}},i=>{if(i===2)for(i=this.virtio.queues[i];i.count_requests()>i.size-2;)i.pop_request()},i=>{if(i===3)for(var s=this.virtio.queues[i];s.has_request();){var n=s.pop_request(),o=new Uint8Array(n.length_readable);n.get_next_blob(o);var c=Ie(["w","h","h"],o,{offset:0});switch(o=c[0],c=c[1],this.Ack(i,n),c){case 0:for(n=0;n<this.ports;++n)this.SendEvent(n,1,0);break;case 3:this.Ack(i,n),this.SendEvent(o,4,1),this.SendName(o,"virtio-"+o),this.SendEvent(o,6,1);break;case 6:this.Ack(i,n),o===0&&this.SendWindowSize(o);break;default:return}}}]},isr_status:{initial_port:46848},device_specific:{initial_port:46592,struct:[{bytes:2,name:"cols",read:()=>this.cols,write:()=>{}},{bytes:2,name:"rows",read:()=>this.rows,write:()=>{}},{bytes:4,name:"max_nr_ports",read:()=>this.ports,write:()=>{}},{bytes:4,name:"emerg_wr",read:()=>0,write:()=>{}}]}});for(let i=0;i<this.ports;++i){const s=i===0?0:2*i+2;this.bus.register("virtio-console"+i+"-input-bytes",function(n){var o=this.virtio.queues[s];o.has_request()&&(o=o.pop_request(),this.Send(s,o,new Uint8Array(n)))},this),this.bus.register("virtio-console"+i+"-resize",function(n){i===0&&(this.cols=n[0],this.rows=n[1]),this.virtio.queues[2].is_configured()&&this.virtio.queues[2].has_request()&&this.SendWindowSize(i,n[0],n[1])},this)}}pi.prototype.SendWindowSize=function(e,t,i){i=i||this.rows,t=t||this.cols;const s=this.virtio.queues[2].pop_request(),n=new Uint8Array(12);Ve(["w","h","h","h","h"],[e,5,0,i,t],n,0),this.Send(2,s,n)};pi.prototype.SendName=function(e,t){const i=this.virtio.queues[2].pop_request();t=new TextEncoder().encode(t);const s=new Uint8Array(8+t.length+1);for(Ve(["w","h","h"],[e,7,1],s,0),e=0;e<t.length;++e)s[e+8]=t[e];s[8+t.length]=0,this.Send(2,i,s)};pi.prototype.get_state=function(){const e=[];return e[0]=this.virtio,e[1]=this.rows,e[2]=this.cols,e[3]=this.ports,e};pi.prototype.set_state=function(e){this.virtio.set_state(e[0]),this.rows=e[1],this.cols=e[2],this.ports=e[3]};pi.prototype.reset=function(){this.virtio.reset()};pi.prototype.SendEvent=function(e,t,i){const s=this.virtio.queues[2].pop_request(),n=new Uint8Array(8);Ve(["w","h","h"],[e,t,i],n,0),this.Send(2,s,n)};pi.prototype.Send=function(e,t,i){t.set_next_blob(i),this.virtio.queues[e].push_reply(t),this.virtio.queues[e].flush_replies()};pi.prototype.Ack=function(e,t){t.set_next_blob(new Uint8Array(0)),this.virtio.queues[e].push_reply(t),this.virtio.queues[e].flush_replies()};function yt(e,t){this.cpu=e,this.bus=t,this.reset(),this.bus.register("keyboard-code",function(i){this.kbd_send_code(i)},this),this.bus.register("mouse-click",function(i){this.mouse_send_click(i[0],i[1],i[2])},this),this.bus.register("mouse-delta",function(i){this.mouse_send_delta(i[0],i[1])},this),this.bus.register("mouse-wheel",function(i){this.wheel_movement-=i[0],this.wheel_movement-=2*i[1],this.wheel_movement=Math.min(7,Math.max(-8,this.wheel_movement)),this.send_mouse_packet(0,0)},this),e.io.register_read(96,this,this.port60_read),e.io.register_read(100,this,this.port64_read),e.io.register_write(96,this,this.port60_write),e.io.register_write(100,this,this.port64_write)}yt.prototype.reset=function(){this.use_mouse=this.enable_mouse_stream=!1,this.have_mouse=!0,this.mouse_clicks=this.mouse_delta_y=this.mouse_delta_x=0,this.have_keyboard=!0,this.next_read_resolution=this.next_read_rate=this.next_handle_scan_code_set=this.next_read_led=this.next_read_sample=this.next_is_mouse_command=this.enable_keyboard_stream=!1,this.kbd_buffer=new Ss(1024),this.last_port60_byte=0,this.sample_rate=100,this.mouse_id=this.mouse_detect_state=0,this.mouse_reset_workaround=!1,this.wheel_movement=0,this.resolution=4,this.scaling2=!1,this.last_mouse_packet=-1,this.mouse_buffer=new Ss(1024),this.next_byte_is_aux=this.next_byte_is_ready=!1,this.command_register=5,this.controller_output_port=0,this.read_controller_output_port=this.read_command_register=this.read_output_register=!1};yt.prototype.get_state=function(){var e=[];return e[0]=this.enable_mouse_stream,e[1]=this.use_mouse,e[2]=this.have_mouse,e[3]=this.mouse_delta_x,e[4]=this.mouse_delta_y,e[5]=this.mouse_clicks,e[6]=this.have_keyboard,e[7]=this.enable_keyboard_stream,e[8]=this.next_is_mouse_command,e[9]=this.next_read_sample,e[10]=this.next_read_led,e[11]=this.next_handle_scan_code_set,e[12]=this.next_read_rate,e[13]=this.next_read_resolution,e[15]=this.last_port60_byte,e[16]=this.sample_rate,e[17]=this.resolution,e[18]=this.scaling2,e[20]=this.command_register,e[21]=this.read_output_register,e[22]=this.read_command_register,e[23]=this.controller_output_port,e[24]=this.read_controller_output_port,e[25]=this.mouse_id,e[26]=this.mouse_detect_state,e[27]=this.mouse_reset_workaround,e};yt.prototype.set_state=function(e){this.enable_mouse_stream=e[0],this.use_mouse=e[1],this.have_mouse=e[2],this.mouse_delta_x=e[3],this.mouse_delta_y=e[4],this.mouse_clicks=e[5],this.have_keyboard=e[6],this.enable_keyboard_stream=e[7],this.next_is_mouse_command=e[8],this.next_read_sample=e[9],this.next_read_led=e[10],this.next_handle_scan_code_set=e[11],this.next_read_rate=e[12],this.next_read_resolution=e[13],this.last_port60_byte=e[15],this.sample_rate=e[16],this.resolution=e[17],this.scaling2=e[18],this.command_register=e[20],this.read_output_register=e[21],this.read_command_register=e[22],this.controller_output_port=e[23],this.read_controller_output_port=e[24],this.mouse_id=e[25]||0,this.mouse_detect_state=e[26]||0,this.mouse_reset_workaround=e[27]||!1,this.next_byte_is_aux=this.next_byte_is_ready=!1,this.kbd_buffer.clear(),this.mouse_buffer.clear(),this.bus.send("mouse-enable",this.use_mouse)};yt.prototype.raise_irq=function(){this.next_byte_is_ready||(this.kbd_buffer.length?this.kbd_irq():this.mouse_buffer.length&&this.mouse_irq())};yt.prototype.mouse_irq=function(){this.next_byte_is_aux=this.next_byte_is_ready=!0,this.command_register&2&&(this.cpu.device_lower_irq(12),this.cpu.device_raise_irq(12))};yt.prototype.kbd_irq=function(){this.next_byte_is_ready=!0,this.next_byte_is_aux=!1,this.command_register&1&&(this.cpu.device_lower_irq(1),this.cpu.device_raise_irq(1))};yt.prototype.kbd_send_code=function(e){this.enable_keyboard_stream&&(A(e),this.kbd_buffer.push(e),this.raise_irq())};yt.prototype.mouse_send_delta=function(e,t){this.have_mouse&&this.use_mouse&&(this.mouse_delta_x+=1*e,this.mouse_delta_y+=1*t,this.enable_mouse_stream&&(e=this.mouse_delta_x|0,t=this.mouse_delta_y|0,e||t))&&(this.mouse_delta_x-=e,this.mouse_delta_y-=t,this.send_mouse_packet(e,t))};yt.prototype.mouse_send_click=function(e,t,i){this.have_mouse&&this.use_mouse&&(this.mouse_clicks=e|i<<1|t<<2,this.enable_mouse_stream&&this.send_mouse_packet(0,0))};yt.prototype.send_mouse_packet=function(e,t){var i=(0>t)<<5|(0>e)<<4|8|this.mouse_clicks;this.last_mouse_packet=Date.now(),this.mouse_buffer.push(i),this.mouse_buffer.push(e),this.mouse_buffer.push(t),this.mouse_id===4?(this.mouse_buffer.push(0|this.wheel_movement&15),this.wheel_movement=0):this.mouse_id===3&&(this.mouse_buffer.push(this.wheel_movement&255),this.wheel_movement=0),this.raise_irq()};yt.prototype.apply_scaling2=function(e){var t=e>>31;switch(Math.abs(e)){case 0:case 1:case 3:return e;case 2:return t;case 4:return 6*t;case 5:return 9*t;default:return e<<1}};yt.prototype.port60_read=function(){return this.next_byte_is_ready=!1,!this.kbd_buffer.length&&!this.mouse_buffer.length?this.last_port60_byte:(this.next_byte_is_aux?(this.cpu.device_lower_irq(12),this.last_port60_byte=this.mouse_buffer.shift()):(this.cpu.device_lower_irq(1),this.last_port60_byte=this.kbd_buffer.shift()),A(this.last_port60_byte),(this.kbd_buffer.length||this.mouse_buffer.length)&&this.raise_irq(),this.last_port60_byte)};yt.prototype.port64_read=function(){var e=16;return this.next_byte_is_ready&&(e|=1),this.next_byte_is_aux&&(e|=32),A(e),e};yt.prototype.port60_write=function(e){if(A(e),this.read_command_register)this.command_register=e,this.read_command_register=!1,A(this.command_register);else if(this.read_output_register)this.read_output_register=!1,this.mouse_buffer.clear(),this.mouse_buffer.push(e),this.mouse_irq();else if(this.next_read_sample){switch(this.next_read_sample=!1,this.mouse_buffer.clear(),this.mouse_buffer.push(250),this.sample_rate=e,this.mouse_detect_state){case-1:e===60?(this.mouse_reset_workaround=!0,this.mouse_detect_state=0):(this.mouse_reset_workaround=!1,this.mouse_detect_state=e===200?1:0);break;case 0:e===200&&(this.mouse_detect_state=1);break;case 1:this.mouse_detect_state=e===100?2:e===200?3:0;break;case 2:e===80&&(this.mouse_id=3),this.mouse_detect_state=-1;break;case 3:e===80&&(this.mouse_id=4),this.mouse_detect_state=-1}A(e),A(this.mouse_id),this.sample_rate||(this.sample_rate=100),this.mouse_irq()}else if(this.next_read_resolution)this.next_read_resolution=!1,this.mouse_buffer.clear(),this.mouse_buffer.push(250),this.resolution=3<e?4:1<<e,this.mouse_irq();else if(this.next_read_led)this.next_read_led=!1,this.kbd_buffer.push(250),this.kbd_irq();else if(this.next_handle_scan_code_set)this.next_handle_scan_code_set=!1,this.kbd_buffer.push(250),this.kbd_irq(),e||this.kbd_buffer.push(1);else if(this.next_read_rate)this.next_read_rate=!1,this.kbd_buffer.push(250),this.kbd_irq();else if(this.next_is_mouse_command){if(this.next_is_mouse_command=!1,A(e),this.have_mouse){switch(this.kbd_buffer.clear(),this.mouse_buffer.clear(),this.mouse_buffer.push(250),e){case 230:this.scaling2=!1;break;case 231:this.scaling2=!0;break;case 232:this.next_read_resolution=!0;break;case 233:this.send_mouse_packet(0,0);break;case 235:this.send_mouse_packet(0,0);break;case 242:A(this.mouse_id),this.mouse_buffer.push(this.mouse_id),this.mouse_clicks=this.mouse_delta_x=this.mouse_delta_y=0,this.raise_irq();break;case 243:this.next_read_sample=!0;break;case 244:this.use_mouse=this.enable_mouse_stream=!0,this.bus.send("mouse-enable",!0),this.mouse_clicks=this.mouse_delta_x=this.mouse_delta_y=0;break;case 245:this.enable_mouse_stream=!1;break;case 246:this.enable_mouse_stream=!1,this.sample_rate=100,this.scaling2=!1,this.resolution=4;break;case 255:this.mouse_buffer.push(170),this.mouse_buffer.push(0),this.use_mouse=!0,this.bus.send("mouse-enable",!0),this.enable_mouse_stream=!1,this.sample_rate=100,this.scaling2=!1,this.resolution=4,this.mouse_reset_workaround||(this.mouse_id=0),this.mouse_clicks=this.mouse_delta_x=this.mouse_delta_y=0;break;default:A(e)}this.mouse_irq()}}else if(this.read_controller_output_port)this.read_controller_output_port=!1,this.controller_output_port=e;else{switch(A(e),this.mouse_buffer.clear(),this.kbd_buffer.clear(),this.kbd_buffer.push(250),e){case 237:this.next_read_led=!0;break;case 240:this.next_handle_scan_code_set=!0;break;case 242:this.kbd_buffer.push(171),this.kbd_buffer.push(131);break;case 243:this.next_read_rate=!0;break;case 244:this.enable_keyboard_stream=!0;break;case 245:this.enable_keyboard_stream=!1;break;case 246:break;case 255:this.kbd_buffer.clear(),this.kbd_buffer.push(250),this.kbd_buffer.push(170),this.kbd_buffer.push(0);break;default:A(e)}this.kbd_irq()}};yt.prototype.port64_write=function(e){switch(A(e),e){case 32:this.kbd_buffer.clear(),this.mouse_buffer.clear(),this.kbd_buffer.push(this.command_register),this.kbd_irq();break;case 96:this.read_command_register=!0;break;case 209:this.read_controller_output_port=!0;break;case 211:this.read_output_register=!0;break;case 212:this.next_is_mouse_command=!0;break;case 167:this.command_register|=32;break;case 168:this.command_register&=-33;break;case 169:this.kbd_buffer.clear(),this.mouse_buffer.clear(),this.kbd_buffer.push(0),this.kbd_irq();break;case 170:this.kbd_buffer.clear(),this.mouse_buffer.clear(),this.kbd_buffer.push(85),this.kbd_irq();break;case 171:this.kbd_buffer.clear(),this.mouse_buffer.clear(),this.kbd_buffer.push(0),this.kbd_irq();break;case 173:this.command_register|=16;break;case 174:this.command_register&=-17;break;case 254:this.cpu.reboot_internal();break;default:A(e)}};const is=DataView.prototype,vs={size:1,get:is.getUint8,set:is.setUint8},vi={size:2,get:is.getUint16,set:is.setUint16},Ke={size:4,get:is.getUint32,set:is.setUint32},Oh=Jn([{magic:Ke},{class:vs},{data:vs},{version0:vs},{osabi:vs},{abiversion:vs},{pad0:(function(e){return{size:e,get:()=>-1}})(7)},{type:vi},{machine:vi},{version1:Ke},{entry:Ke},{phoff:Ke},{shoff:Ke},{flags:Ke},{ehsize:vi},{phentsize:vi},{phnum:vi},{shentsize:vi},{shnum:vi},{shstrndx:vi}]);console.assert(Oh.reduce((e,t)=>e+t.size,0)===52);const Ph=Jn([{type:Ke},{offset:Ke},{vaddr:Ke},{paddr:Ke},{filesz:Ke},{memsz:Ke},{flags:Ke},{align:Ke}]);console.assert(Ph.reduce((e,t)=>e+t.size,0)===32);const Mh=Jn([{name:Ke},{type:Ke},{flags:Ke},{addr:Ke},{offset:Ke},{size:Ke},{link:Ke},{info:Ke},{addralign:Ke},{entsize:Ke}]);console.assert(Mh.reduce((e,t)=>e+t.size,0)===40);function Jn(e){return e.map(function(t){var i=Object.keys(t);return console.assert(i.length===1),i=i[0],t=t[i],console.assert(0<t.size),{name:i,type:t,size:t.size,get:t.get,set:t.set}})}function Bh(e,t){const i={};let s=0;for(const n of t)t=n.get.call(e,s,!0),console.assert(i[n.name]===void 0),i[n.name]=t,s+=n.size;return[i,s]}function va(e,t,i){const s=[];let n=0;for(var o=0;o<i;o++){const[c,r]=Bh(new DataView(e.buffer,e.byteOffset+n,void 0),t);s.push(c),n+=r}return[s,n]}const ya={0:0,1:525,2:525,3:350,4:350,5:350};function Re(e,t,i,s){this.io=e.io,this.cpu=e,this.dma=e.devices.dma,this.cmd_table=this.build_cmd_lookup_table(),this.sra=0,this.srb=192,this.dor=12,this.tdr=0,this.msr=128,this.dsr=0,this.cmd_phase=1,this.cmd_flags=this.cmd_code=0,this.cmd_buffer=new Uint8Array(17),this.cmd_remaining=this.cmd_cursor=0,this.response_data=new Uint8Array(15),this.reset_sense_int_count=this.curr_drive_no=this.status1=this.status0=this.response_length=this.response_cursor=0,this.locked=!1,this.head_load_time=this.step_rate_interval=0,this.fdc_config=96,this.eot=this.precomp_trk=0,this.drives=[new Zt("fda",s?.fda,t,4),new Zt("fdb",s?.fdb,i,4)],Object.seal(this),this.cpu.devices.rtc.cmos_write(16,this.drives[0].drive_type<<4|this.drives[1].drive_type),this.io.register_read(1008,this,this.read_reg_sra),this.io.register_read(1009,this,this.read_reg_srb),this.io.register_read(1010,this,this.read_reg_dor),this.io.register_read(1011,this,this.read_reg_tdr),this.io.register_read(1012,this,this.read_reg_msr),this.io.register_read(1013,this,this.read_reg_fifo),this.io.register_read(1015,this,this.read_reg_dir),this.io.register_write(1010,this,this.write_reg_dor),this.io.register_write(1011,this,this.write_reg_tdr),this.io.register_write(1012,this,this.write_reg_dsr),this.io.register_write(1013,this,this.write_reg_fifo),this.io.register_write(1015,this,this.write_reg_ccr)}Re.prototype.build_cmd_lookup_table=function(){const e=[{code:6,mask:31,argc:8,name:"READ",handler:this.exec_read},{code:5,mask:63,argc:8,name:"WRITE",handler:this.exec_write},{code:15,mask:255,argc:2,name:"SEEK",handler:this.exec_seek},{code:8,mask:255,argc:0,name:"SENSE INTERRUPT STATUS",handler:this.exec_sense_interrupt_status},{code:7,mask:255,argc:1,name:"RECALIBRATE",handler:this.exec_recalibrate},{code:13,mask:191,argc:5,name:"FORMAT TRACK",handler:this.exec_format_track},{code:2,mask:191,argc:8,name:"READ TRACK",handler:this.exec_unimplemented},{code:78,mask:255,argc:17,name:"RESTORE",handler:this.exec_unimplemented},{code:46,mask:255,argc:0,name:"SAVE",handler:this.exec_unimplemented},{code:12,mask:31,argc:8,name:"READ DELETED DATA",handler:this.exec_unimplemented},{code:17,mask:31,argc:8,name:"SCAN EQUAL",handler:this.exec_unimplemented},{code:22,mask:31,argc:8,name:"VERIFY",handler:this.exec_unimplemented},{code:25,mask:31,argc:8,name:"SCAN LOW OR EQUAL",handler:this.exec_unimplemented},{code:29,mask:31,argc:8,name:"SCAN HIGH OR EQUAL",handler:this.exec_unimplemented},{code:9,mask:63,argc:8,name:"WRITE DELETED DATA",handler:this.exec_unimplemented},{code:10,mask:191,argc:1,name:"READ ID",handler:this.exec_read_id},{code:3,mask:255,argc:2,name:"SPECIFY",handler:this.exec_specify},{code:4,mask:255,argc:1,name:"SENSE DRIVE STATUS",handler:this.exec_sense_drive_status},{code:18,mask:255,argc:1,name:"PERPENDICULAR MODE",handler:this.exec_perpendicular_mode},{code:19,mask:255,argc:3,name:"CONFIGURE",handler:this.exec_configure},{code:23,mask:255,argc:2,name:"POWERDOWN MODE",handler:this.exec_unimplemented},{code:51,mask:255,argc:1,name:"OPTION",handler:this.exec_unimplemented},{code:142,mask:255,argc:5,name:"DRIVE SPECIFICATION",handler:this.exec_unimplemented},{code:143,mask:255,argc:2,name:"RELATIVE SEEK OUT",handler:this.exec_unimplemented},{code:205,mask:255,argc:10,name:"FORMAT AND WRITE",handler:this.exec_unimplemented},{code:207,mask:255,argc:2,name:"RELATIVE SEEK IN",handler:this.exec_unimplemented},{code:20,mask:127,argc:0,name:"LOCK",handler:this.exec_lock},{code:14,mask:255,argc:0,name:"DUMP REGISTERS",handler:this.exec_dump_regs},{code:16,mask:255,argc:0,name:"VERSION",handler:this.exec_version},{code:24,mask:255,argc:0,name:"PART ID",handler:this.exec_part_id},{code:0,mask:0,argc:0,name:"UNKNOWN COMMAND",handler:this.exec_unimplemented}],t=Array(256);for(let i=e.length-1;0<=i;i--){const s=e[i];if(s.mask===255)t[s.code]=s;else for(let n=0;256>n;n++)(n&s.mask)===s.code&&(t[n]=s)}return t};Re.prototype.raise_irq=function(){this.sra&128||(this.cpu.device_raise_irq(6),this.sra|=128),this.reset_sense_int_count=0};Re.prototype.lower_irq=function(){this.status0=0,this.sra&128&&(this.cpu.device_lower_irq(6),this.sra&=-129)};Re.prototype.set_curr_drive_no=function(e){return this.curr_drive_no=e&1,this.drives[this.curr_drive_no]};Re.prototype.enter_command_phase=function(){this.cmd_phase=1,this.cmd_remaining=this.cmd_cursor=0,this.msr&=-81,this.msr|=128};Re.prototype.enter_result_phase=function(e){this.cmd_phase=3,this.response_cursor=0,this.response_length=e,this.msr|=208};Re.prototype.reset_fdc=function(){this.lower_irq("controller reset"),this.sra=0,this.srb=192,this.dor=12,this.msr=128,this.curr_drive_no=0,this.status0|=192,this.response_length=this.response_cursor=0,this.drives[0].seek(0,0,1),this.drives[1].seek(0,0,1),this.enter_command_phase(),this.raise_irq("controller reset"),this.reset_sense_int_count=4};Re.prototype.read_reg_sra=function(){return A(this.sra),this.sra};Re.prototype.read_reg_srb=function(){return A(this.srb),this.srb};Re.prototype.read_reg_dor=function(){const e=this.dor&-4|this.curr_drive_no;return A(e),e};Re.prototype.read_reg_tdr=function(){return A(this.tdr),this.tdr};Re.prototype.read_reg_msr=function(){return A(this.msr),this.dsr&=-65,this.dor|=4,this.msr};Re.prototype.read_reg_fifo=function(){if(this.dsr&=-65,!(this.msr&128&&this.msr&64)||this.cmd_phase!==3)return 0;if(this.response_cursor<this.response_length){const e=this.response_data[this.response_cursor++];return this.response_cursor===this.response_length&&(this.msr&=-129,this.enter_command_phase(),this.lower_irq("")),e}return 0};Re.prototype.read_reg_dir=function(){const e=this.drives[this.curr_drive_no].media_changed?128:0;return A(e),e};Re.prototype.write_reg_dor=function(e){this.srb=this.srb&-36|(e&16?1:0)|(e&32?2:0)|(e&1?32:0),!(this.dor&4)&&e&4&&(this.reset_fdc(),this.dsr&=-65);const t=e&3;A(e),A(e>>4),this.curr_drive_no=t&1,this.dor=e};Re.prototype.write_reg_tdr=function(e){this.dor&4?(A(e),this.tdr=e&4):A(e)};Re.prototype.write_reg_dsr=function(e){this.dor&4?(A(e),e&128&&(this.dor&=-5,this.reset_fdc(),this.dor|=4),e&64&&this.reset_fdc(),this.dsr=e):A(e)};Re.prototype.write_reg_fifo=function(e){if(this.dsr&=-65,this.dor&4)if(!(this.msr&128)||this.msr&64)A(e);else if(this.cmd_phase!==1)A(e);else{if(this.cmd_remaining===0){var t=this.cmd_table[e];this.cmd_code=e,this.cmd_remaining=t.argc,this.cmd_flags=this.cmd_cursor=0,(t.code===6||t.code===5)&&this.cmd_code&128&&(this.cmd_flags|=1),this.cmd_remaining&&(this.msr|=128),this.msr|=16}else this.cmd_buffer[this.cmd_cursor++]=e,this.cmd_remaining--;this.cmd_remaining===0&&(this.cmd_phase=2,e=this.cmd_table[this.cmd_code],t=this.cmd_buffer.slice(0,this.cmd_cursor),e.handler.call(this,t))}else A(e)};Re.prototype.write_reg_ccr=function(e){this.dor&4?(A(e),this.dsr=this.dsr&-4|e&3):A(e)};Re.prototype.exec_unimplemented=function(){A(this.cmd_code),this.status0=128,this.response_data[0]=this.status0,this.enter_result_phase(1)};Re.prototype.exec_read=function(e){this.start_read_write(e,!1)};Re.prototype.exec_write=function(e){this.start_read_write(e,!0)};Re.prototype.exec_seek=function(e){const t=this.set_curr_drive_no(e[0]&1);e=e[1],this.enter_command_phase(),t.seek(t.curr_head,e,t.curr_sect),this.status0|=32,this.raise_irq("SEEK command")};Re.prototype.exec_sense_interrupt_status=function(){const e=this.drives[this.curr_drive_no];let t;if(0<this.reset_sense_int_count)t=192|4-this.reset_sense_int_count--;else if(this.sra&128)t=this.status0&-8|this.curr_drive_no;else{this.response_data[0]=128,this.enter_result_phase(1);return}this.response_data[0]=t,this.response_data[1]=e.curr_track,this.enter_result_phase(2),this.lower_irq("SENSE INTERRUPT command"),this.status0=192};Re.prototype.exec_recalibrate=function(e){this.set_curr_drive_no(e[0]&1).seek(0,0,1),this.enter_command_phase(),this.status0|=32,this.raise_irq("RECALIBRATE command")};Re.prototype.exec_format_track=function(e){let t=0,i=0;this.set_curr_drive_no(e[0]&1).read_only&&(t=96,i=2),this.end_read_write(t,i,0)};Re.prototype.exec_read_id=function(e){const t=this.drives[this.curr_drive_no];t.curr_head=e[0]>>2&1,t.max_sect!==0&&(t.curr_sect=t.curr_sect%t.max_sect+1),this.end_read_write(0,0,0)};Re.prototype.exec_specify=function(e){const t=e[1];this.step_rate_interval=e[0]>>4,this.head_load_time=t>>1,this.dor=t&1?this.dor&-9:this.dor|8,this.enter_command_phase()};Re.prototype.exec_sense_drive_status=function(e){e=e[0];const t=this.set_curr_drive_no(e&1);t.curr_head=e>>2&1,this.response_data[0]=(t.read_only?64:0)|(t.curr_track===0?16:0)|t.curr_head<<2|this.curr_drive_no|40,this.enter_result_phase(1)};Re.prototype.exec_perpendicular_mode=function(e){e=e[0],e&128&&(this.drives[this.curr_drive_no].perpendicular=e&7),this.enter_command_phase()};Re.prototype.exec_configure=function(e){this.fdc_config=e[1],this.precomp_trk=e[2],this.enter_command_phase()};Re.prototype.exec_lock=function(){this.cmd_code&128?(this.locked=!0,this.response_data[0]=16):(this.locked=!1,this.response_data[0]=0),this.enter_result_phase(1)};Re.prototype.exec_dump_regs=function(){const e=this.drives[this.curr_drive_no];this.response_data[0]=this.drives[0].curr_track,this.response_data[1]=this.drives[1].curr_track,this.response_data[2]=0,this.response_data[3]=0,this.response_data[4]=this.step_rate_interval,this.response_data[5]=this.head_load_time<<1|(this.dor&8?1:0),this.response_data[6]=e.max_sect,this.response_data[7]=(this.locked?128:0)|e.perpendicular<<2,this.response_data[8]=this.fdc_config,this.response_data[9]=this.precomp_trk,this.enter_result_phase(10)};Re.prototype.exec_version=function(){this.response_data[0]=144,this.enter_result_phase(1)};Re.prototype.exec_part_id=function(){this.response_data[0]=65,this.enter_result_phase(1)};Re.prototype.start_read_write=function(e,t){const i=this.set_curr_drive_no(e[0]&1),s=e[1],n=e[2],o=e[3];var c=e[4];const r=e[5];switch(e=128>e[7]?e[7]:128,i.seek(n,s,o)){case 2:this.end_read_write(64,0,0),this.response_data[3]=s,this.response_data[4]=n,this.response_data[5]=o;return;case 3:this.end_read_write(64,128,0),this.response_data[3]=s,this.response_data[4]=n,this.response_data[5]=o;return;case 1:this.status0|=32}const a=128<<(7<c?7:c);if(c=i.chs2lba(s,n,o)*a,a!==128&&(e=this.cmd_flags&1?(2*r-o+1)*a:(r-o+1)*a,0>=e)){this.end_read_write(64,1,0),this.response_data[3]=s,this.response_data[4]=n,this.response_data[5]=o;return}this.eot=r,t&&i.read_only?(this.end_read_write(96,2,0),this.response_data[3]=s,this.response_data[4]=n,this.response_data[5]=o):this.dor&8&&(this.msr&=-129,(t?this.dma.do_write:this.dma.do_read).call(this.dma,i.buffer,c,e,2,u=>{u?this.end_read_write(64,0,0):(this.seek_next_sect(),this.end_read_write(0,0,0))}))};Re.prototype.end_read_write=function(e,t,i){const s=this.drives[this.curr_drive_no];this.status0&=-8,this.status0|=this.curr_drive_no,s.curr_head&&(this.status0|=4),this.status0|=e,this.msr|=192,this.msr&=-33,this.response_data[0]=this.status0,this.response_data[1]=t,this.response_data[2]=i,this.response_data[3]=s.curr_track,this.response_data[4]=s.curr_head,this.response_data[5]=s.curr_sect,this.response_data[6]=2,this.enter_result_phase(7),this.raise_irq(this.cmd_table[this.cmd_code].name+" command")};Re.prototype.seek_next_sect=function(){const e=this.drives[this.curr_drive_no];let t=e.curr_track,i=e.curr_head,s=e.curr_sect,n=1;return s>=e.max_sect||s===this.eot?(s=1,this.cmd_flags&1?i===0&&e.max_head===2?i=1:(i=0,t++,this.status0|=32,e.max_head===1&&(n=0)):(this.status0|=32,t++,n=0)):s++,e.seek(i,t,s),n};Re.prototype.get_state=function(){const e=[];return e[19]=this.sra,e[20]=this.srb,e[21]=this.dor,e[22]=this.tdr,e[23]=this.msr,e[24]=this.dsr,e[25]=this.cmd_phase,e[26]=this.cmd_code,e[27]=this.cmd_flags,e[28]=this.cmd_buffer,e[29]=this.cmd_cursor,e[30]=this.cmd_remaining,e[31]=this.response_data,e[32]=this.response_cursor,e[33]=this.response_length,e[34]=this.status0,e[35]=this.status1,e[36]=this.curr_drive_no,e[37]=this.reset_sense_int_count,e[38]=this.locked,e[39]=this.step_rate_interval,e[40]=this.head_load_time,e[41]=this.fdc_config,e[42]=this.precomp_trk,e[43]=this.eot,e[44]=this.drives[0].get_state(),e[45]=this.drives[1].get_state(),e};Re.prototype.set_state=function(e){typeof e[19]<"u"&&(this.sra=e[19],this.srb=e[20],this.dor=e[21],this.tdr=e[22],this.msr=e[23],this.dsr=e[24],this.cmd_phase=e[25],this.cmd_code=e[26],this.cmd_flags=e[27],this.cmd_buffer.set(e[28]),this.cmd_cursor=e[29],this.cmd_remaining=e[30],this.response_data.set(e[31]),this.response_cursor=e[32],this.response_length=e[33],this.status0=e[34],this.status1=e[35],this.curr_drive_no=e[36],this.reset_sense_int_count=e[37],this.locked=e[38],this.step_rate_interval=e[39],this.head_load_time=e[40],this.fdc_config=e[41],this.precomp_trk=e[42],this.eot=e[43],this.drives[0].set_state(e[44]),this.drives[1].set_state(e[45]))};const Gi=[{drive_type:4,sectors:18,tracks:80,heads:2},{drive_type:4,sectors:20,tracks:80,heads:2},{drive_type:4,sectors:21,tracks:80,heads:2},{drive_type:4,sectors:21,tracks:82,heads:2},{drive_type:4,sectors:21,tracks:83,heads:2},{drive_type:4,sectors:22,tracks:80,heads:2},{drive_type:4,sectors:23,tracks:80,heads:2},{drive_type:4,sectors:24,tracks:80,heads:2},{drive_type:5,sectors:36,tracks:80,heads:2},{drive_type:5,sectors:39,tracks:80,heads:2},{drive_type:5,sectors:40,tracks:80,heads:2},{drive_type:5,sectors:44,tracks:80,heads:2},{drive_type:5,sectors:48,tracks:80,heads:2},{drive_type:4,sectors:8,tracks:80,heads:2},{drive_type:4,sectors:9,tracks:80,heads:2},{drive_type:4,sectors:10,tracks:80,heads:2},{drive_type:4,sectors:10,tracks:82,heads:2},{drive_type:4,sectors:10,tracks:83,heads:2},{drive_type:4,sectors:13,tracks:80,heads:2},{drive_type:4,sectors:14,tracks:80,heads:2},{drive_type:2,sectors:15,tracks:80,heads:2},{drive_type:2,sectors:18,tracks:80,heads:2},{drive_type:2,sectors:18,tracks:82,heads:2},{drive_type:2,sectors:18,tracks:83,heads:2},{drive_type:2,sectors:20,tracks:80,heads:2},{drive_type:2,sectors:9,tracks:80,heads:2},{drive_type:2,sectors:11,tracks:80,heads:2},{drive_type:2,sectors:9,tracks:40,heads:2},{drive_type:2,sectors:9,tracks:40,heads:1},{drive_type:2,sectors:10,tracks:41,heads:2},{drive_type:2,sectors:10,tracks:42,heads:2},{drive_type:2,sectors:8,tracks:40,heads:2},{drive_type:2,sectors:8,tracks:40,heads:1},{drive_type:4,sectors:9,tracks:80,heads:1},{drive_type:1,sectors:10,tracks:40,heads:1},{drive_type:1,sectors:10,tracks:40,heads:2}];function Zt(e,t,i,s){this.name=e,this.curr_head=this.curr_track=this.max_sect=this.max_head=this.max_track=this.drive_type=0,this.curr_sect=1,this.perpendicular=0,this.read_only=!1,this.media_changed=!0,this.buffer=null,Object.seal(this),e=t?.drive_type,e!==void 0&&0<=e&&5>=e&&(this.drive_type=e),this.insert_disk(i,!!t?.read_only),this.drive_type===0&&e===void 0&&(this.drive_type=s)}Zt.prototype.insert_disk=function(e,t){if(!e)return!1;e instanceof Uint8Array&&(e=new it(e.buffer));const[i,s]=this.find_disk_format(e,this.drive_type);return i?(this.max_track=s.tracks,this.max_head=s.heads,this.max_sect=s.sectors,this.read_only=!!t,this.media_changed=!0,this.buffer=i,this.drive_type===0&&(this.drive_type=s.drive_type),!0):!1};Zt.prototype.eject_disk=function(){this.max_sect=this.max_head=this.max_track=0,this.media_changed=!0,this.buffer=null};Zt.prototype.get_buffer=function(){return this.buffer?this.buffer.buffer:null};Zt.prototype.chs2lba=function(e,t,i){return(e*this.max_head+t)*this.max_sect+i-1};Zt.prototype.find_disk_format=function(e,t){const i=t===0,s=e.byteLength;let n=-1,o=-1,c=-1,r=-1,a=-1;for(let u=0;u<Gi.length;u++){const _=Gi[u],l=_.sectors*_.tracks*_.heads*512;if(s===l)if(i||_.drive_type===t){n=u;break}else i||ya[_.drive_type]!==ya[t]?c=c===-1?u:c:o=o===-1?u:o;else s<l&&(a===-1||l<a)&&(r=u,a=l)}return n!==-1?[e,Gi[n]]:o!==-1?[e,Gi[o]]:c!==-1?[e,Gi[c]]:r!==-1?(t=new Uint8Array(a),t.set(new Uint8Array(e.buffer)),[new it(t.buffer),Gi[r]]):[null,null]};Zt.prototype.seek=function(e,t,i){if(t>this.max_track||e!==0&&this.max_head===1)return 2;if(i>this.max_sect)return 3;let s=0;const n=this.chs2lba(this.curr_track,this.curr_head,this.curr_sect),o=this.chs2lba(t,e,i);return n!==o&&(this.curr_track!==t&&(this.buffer&&(this.media_changed=!1),s=1),this.curr_head=e,this.curr_track=t,this.curr_sect=i),this.buffer||(s=2),s};Zt.prototype.get_state=function(){const e=[];return e[0]=this.drive_type,e[1]=this.max_track,e[2]=this.max_head,e[3]=this.max_sect,e[4]=this.curr_track,e[5]=this.curr_head,e[6]=this.curr_sect,e[7]=this.perpendicular,e[8]=this.read_only,e[9]=this.media_changed,e[10]=this.buffer?this.buffer.get_state():null,e};Zt.prototype.set_state=function(e){this.drive_type=e[0],this.max_track=e[1],this.max_head=e[2],this.max_sect=e[3],this.curr_track=e[4],this.curr_head=e[5],this.curr_sect=e[6],this.perpendicular=e[7],this.read_only=e[8],this.media_changed=e[9],e[10]?(this.buffer||(this.buffer=new it(new ArrayBuffer(0))),this.buffer.set_state(e[10])):this.buffer=null};const ba={70:{name:"GET CONFIGURATION",flags:0},74:{name:"GET EVENT STATUS NOTIFICATION",flags:0},18:{name:"INQUIRY",flags:0},189:{name:"MECHANISM STATUS",flags:0},26:{name:"MODE SENSE (6)",flags:0},90:{name:"MODE SENSE (10)",flags:0},69:{name:"PAUSE",flags:1},30:{name:"PREVENT ALLOW MEDIUM REMOVAL",flags:0},40:{name:"READ (10)",flags:1},168:{name:"READ (12)",flags:1},37:{name:"READ CAPACITY",flags:1},190:{name:"READ CD",flags:1},81:{name:"READ DISK INFORMATION",flags:1},66:{name:"READ SUBCHANNEL",flags:1},67:{name:"READ TOC PMA ATIP",flags:1},82:{name:"READ TRACK INFORMATION",flags:1},3:{name:"REQUEST SENSE",flags:0},27:{name:"START STOP UNIT",flags:0},0:{name:"TEST UNIT READY",flags:1}};function wr(e,t,i){this.cpu=e,this.bus=t,this.secondary=this.primary=void 0,t=i&&i[0][0];const s=i&&i[1][0];if(t||s){t&&(this.primary=new St(this,0,i[0],496,1014,14)),s&&(this.secondary=new St(this,1,i[1],368,886,15)),i=t?this.primary.command_base:0;const n=t?this.primary.control_base:0,o=s?this.secondary.command_base:0,c=s?this.secondary.control_base:0;this.name="ide",this.pci_id=240,this.pci_space=[134,128,16,112,5,0,160,2,0,128,1,1,0,0,0,0,i&255|1,i>>8,0,0,n&255|1,n>>8,0,0,o&255|1,o>>8,0,0,c&255|1,c>>8,0,0,1,180,0,0,0,0,0,0,0,0,0,0,67,16,212,130,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],this.pci_bars=[t?{size:8}:void 0,t?{size:1}:void 0,s?{size:8}:void 0,s?{size:1}:void 0,{size:16}],e.devices.pci.register_device(this)}Object.seal(this)}wr.prototype.get_state=function(){const e=[];return e[0]=this.primary,e[1]=this.secondary,e};wr.prototype.set_state=function(e){this.primary&&this.primary.set_state(e[0]),this.secondary&&this.secondary.set_state(e[1])};function St(e,t,i,s,n,o){this.controller=e,this.channel_nr=t,this.cpu=e.cpu,this.bus=e.bus,this.command_base=s,this.control_base=n,this.irq=o,this.name="ide"+t,s=i?i[0]:void 0,i=i?i[1]:void 0,this.master=new xe(this,0,s?.buffer,s?.is_cdrom),this.slave=new xe(this,1,i?.buffer,i?.is_cdrom),this.current_interface=this.master,this.device_control_reg=2,this.dma_command=this.dma_status=this.prdt_addr=0,e=e.cpu,e.io.register_read(this.command_base|0,this,function(){return this.current_interface.read_data(1)},function(){return this.current_interface.read_data(2)},function(){return this.current_interface.read_data(4)}),e.io.register_read(this.command_base|1,this,function(){return this.current_interface.error_reg&255}),e.io.register_read(this.command_base|2,this,function(){return this.current_interface.sector_count_reg&255}),e.io.register_read(this.command_base|3,this,function(){return this.current_interface.lba_low_reg&255}),e.io.register_read(this.command_base|4,this,function(){return this.current_interface.lba_mid_reg&255}),e.io.register_read(this.command_base|5,this,function(){return this.current_interface.lba_high_reg&255}),e.io.register_read(this.command_base|6,this,function(){return this.current_interface.device_reg&255}),e.io.register_read(this.command_base|7,this,function(){const c=this.read_status();return this.cpu.device_lower_irq(this.irq),c}),e.io.register_write(this.command_base|0,this,function(c){this.current_interface.write_data_port8(c)},function(c){this.current_interface.write_data_port16(c)},function(c){this.current_interface.write_data_port32(c)}),e.io.register_write(this.command_base|1,this,function(c){this.current_interface.features_reg=(this.current_interface.features_reg<<8|c)&65535}),e.io.register_write(this.command_base|2,this,function(c){this.current_interface.sector_count_reg=(this.current_interface.sector_count_reg<<8|c)&65535}),e.io.register_write(this.command_base|3,this,function(c){this.current_interface.lba_low_reg=(this.current_interface.lba_low_reg<<8|c)&65535}),e.io.register_write(this.command_base|4,this,function(c){this.current_interface.lba_mid_reg=(this.current_interface.lba_mid_reg<<8|c)&65535}),e.io.register_write(this.command_base|5,this,function(c){this.current_interface.lba_high_reg=(this.current_interface.lba_high_reg<<8|c)&65535}),e.io.register_write(this.command_base|6,this,function(c){const r=c&16;(r&&this.current_interface===this.master||!r&&this.current_interface===this.slave)&&(this.current_interface=r?this.slave:this.master),this.current_interface.device_reg=c,this.current_interface.is_lba=c>>6&1,this.current_interface.head=c&15}),e.io.register_write(this.command_base|7,this,function(c){this.current_interface.status_reg&=-34,this.current_interface.ata_command(c),this.cpu.device_lower_irq(this.irq)}),e.io.register_read(this.control_base|0,this,this.read_status),e.io.register_write(this.control_base|0,this,this.write_control),t=46080+8*t,e.io.register_read(t|0,this,this.dma_read_command8,void 0,this.dma_read_command),e.io.register_write(t|0,this,this.dma_write_command8,void 0,this.dma_write_command),e.io.register_read(t|2,this,this.dma_read_status),e.io.register_write(t|2,this,this.dma_write_status),e.io.register_read(t|4,this,void 0,void 0,this.dma_read_addr),e.io.register_write(t|4,this,void 0,void 0,this.dma_set_addr)}St.prototype.read_status=function(){return this.current_interface.drive_connected?this.current_interface.status_reg:0};St.prototype.write_control=function(e){e&4&&(this.cpu.device_lower_irq(this.irq),this.master.device_reset(),this.slave.device_reset()),this.device_control_reg=e};St.prototype.dma_read_addr=function(){return this.prdt_addr};St.prototype.dma_set_addr=function(e){this.prdt_addr=e};St.prototype.dma_read_status=function(){return this.dma_status};St.prototype.dma_write_status=function(e){this.dma_status&=~(e&6)};St.prototype.dma_read_command=function(){return this.dma_read_command8()|this.dma_read_status()<<16};St.prototype.dma_read_command8=function(){return this.dma_command};St.prototype.dma_write_command=function(e){this.dma_write_command8(e&255),this.dma_write_status(e>>16&255)};St.prototype.dma_write_command8=function(e){const t=this.dma_command;if(this.dma_command=e&9,(t&1)!==(e&1))if((e&1)===0)this.dma_status&=-2;else switch(this.dma_status|=1,this.current_interface.current_command){case 200:case 37:this.current_interface.do_ata_read_sectors_dma();break;case 202:case 53:this.current_interface.do_ata_write_sectors_dma();break;case 160:this.current_interface.do_atapi_dma();break;default:A(this.current_interface.current_command),this.dma_status&=-2,this.dma_status|=2,this.push_irq()}};St.prototype.push_irq=function(){(this.device_control_reg&2)===0&&(this.dma_status|=4,this.cpu.device_raise_irq(this.irq))};St.prototype.get_state=function(){var e=[];return e[0]=this.master,e[1]=this.slave,e[2]=this.command_base,e[3]=this.irq,e[5]=this.control_base,e[7]=this.name,e[8]=this.device_control_reg,e[9]=this.prdt_addr,e[10]=this.dma_status,e[11]=this.current_interface===this.master,e[12]=this.dma_command,e};St.prototype.set_state=function(e){this.master.set_state(e[0]),this.slave.set_state(e[1]),this.command_base=e[2],this.irq=e[3],this.control_base=e[5],this.name=e[7],this.device_control_reg=e[8],this.prdt_addr=e[9],this.dma_status=e[10],this.current_interface=e[11]?this.master:this.slave,this.dma_command=e[12]};function xe(e,t,i,s){this.channel=e,this.name=e.name+"."+t,this.bus=e.bus,this.channel_nr=e.channel_nr,this.interface_nr=t,this.cpu=e.cpu,this.buffer=null,this.drive_connected=s||!!i,this.sector_size=s?2048:512,this.is_atapi=s,this.sector_count=0,this.head_count=this.is_atapi?1:0,this.device_reg=this.head=this.lba_high_reg=this.lba_mid_reg=this.features_reg=this.lba_low_reg=this.sector_count_reg=this.is_lba=this.cylinder_count=this.sectors_per_track=0,this.status_reg=80,this.sectors_per_drq=128,this.data_pointer=this.error_reg=0,this.data=new Uint8Array(65536),this.data16=new Uint16Array(this.data.buffer),this.data32=new Int32Array(this.data.buffer),this.data_end=this.data_length=0,this.current_command=-1,this.last_io_id=this.write_dest=0,this.in_progress_io_ids=new Set,this.cancelled_io_ids=new Set,this.current_atapi_command=-1,this.atapi_add_sense=this.atapi_sense_key=0,this.medium_changed=!1,this.set_disk_buffer(i),Object.seal(this)}xe.prototype.has_disk=function(){return!!this.buffer};xe.prototype.eject=function(){this.is_atapi&&this.buffer&&(this.medium_changed=!0,this.buffer=null,this.status_reg=89,this.error_reg=96,this.push_irq())};xe.prototype.set_cdrom=function(e){this.is_atapi&&e&&(this.set_disk_buffer(e),this.medium_changed=!0)};xe.prototype.set_disk_buffer=function(e){if(e){if(this.buffer=e,this.is_atapi&&(this.status_reg=89,this.error_reg=96),this.sector_count=this.buffer.byteLength/this.sector_size,this.sector_count!==(this.sector_count|0)&&(this.sector_count=Math.ceil(this.sector_count)),this.is_atapi?(this.head_count=1,this.sectors_per_track=2048):(this.head_count=16,this.sectors_per_track=63),this.cylinder_count=this.sector_count/this.head_count/this.sectors_per_track,this.cylinder_count!==(this.cylinder_count|0)&&(this.cylinder_count=Math.floor(this.cylinder_count)),this.interface_nr===0){e=this.cpu.devices.rtc,e.cmos_write(57,e.cmos_read(57)|1<<4*this.channel_nr),e.cmos_write(18,e.cmos_read(18)&15|240);const t=this.channel_nr===0?27:36;e.cmos_write(t+0,this.cylinder_count&255),e.cmos_write(t+1,this.cylinder_count>>8&255),e.cmos_write(t+2,this.head_count&255),e.cmos_write(t+3,255),e.cmos_write(t+4,255),e.cmos_write(t+5,200),e.cmos_write(t+6,this.cylinder_count&255),e.cmos_write(t+7,this.cylinder_count>>8&255),e.cmos_write(t+8,this.sectors_per_track&255)}this.channel.cpu&&this.push_irq()}};xe.prototype.device_reset=function(){this.is_atapi?(this.status_reg=0,this.lba_low_reg=this.error_reg=this.sector_count_reg=1,this.lba_mid_reg=20,this.lba_high_reg=235):(this.status_reg=81,this.lba_low_reg=this.error_reg=this.sector_count_reg=1,this.lba_high_reg=this.lba_mid_reg=0),this.cancel_io_operations()};xe.prototype.push_irq=function(){this.channel.push_irq()};xe.prototype.ata_abort_command=function(){this.error_reg=4,this.status_reg=65,this.push_irq()};xe.prototype.capture_regs=function(){return`ST=${A(this.status_reg&255)} ER=${A(this.error_reg&255)} SC=${A(this.sector_count_reg&255)} LL=${A(this.lba_low_reg&255)} LM=${A(this.lba_mid_reg&255)} LH=${A(this.lba_high_reg&255)} FE=${A(this.features_reg&255)}`};xe.prototype.ata_command=function(e){if(this.drive_connected||e===144)switch(this.current_command=e,this.error_reg=0,e){case 8:this.data_length=this.data_end=this.data_pointer=0,this.device_reset(),this.push_irq();break;case 16:this.lba_mid_reg=0,this.status_reg=80,this.push_irq();break;case 248:e=this.sector_count-1,this.lba_low_reg=e&255,this.lba_mid_reg=e>>8&255,this.lba_high_reg=e>>16&255,this.device_reg=this.device_reg&240|e>>24&15,this.status_reg=80,this.push_irq();break;case 39:e=this.sector_count-1,this.lba_low_reg=e&255,this.lba_mid_reg=e>>8&255,this.lba_high_reg=e>>16&255,this.lba_low_reg|=e>>24<<8&65280,this.status_reg=80,this.push_irq();break;case 32:this.is_atapi?(this.lba_mid_reg=20,this.lba_high_reg=235,this.ata_abort_command()):this.ata_read_sectors(e);break;case 36:case 41:case 196:this.is_atapi?this.ata_abort_command():this.ata_read_sectors(e);break;case 48:case 52:case 57:case 197:this.is_atapi?this.ata_abort_command():this.ata_write_sectors(e);break;case 144:this.channel.master.status_reg=80,this.channel.master.error_reg=1,this.channel.master.push_irq(),this.channel.slave.drive_connected&&(this.channel.slave.status_reg=80,this.channel.slave.error_reg=1,this.channel.slave.push_irq());break;case 145:this.status_reg=80,this.push_irq();break;case 160:this.is_atapi?(this.data_allocate(12),this.data_end=12,this.sector_count_reg=1,this.status_reg=88,this.push_irq()):this.ata_abort_command();break;case 161:this.is_atapi?(this.create_identify_packet(),this.status_reg=88,this.push_irq()):this.ata_abort_command();break;case 198:A(this.sector_count_reg&255),this.sectors_per_drq=this.sector_count_reg&255,this.status_reg=80,this.push_irq();break;case 200:case 37:this.ata_read_sectors_dma(e);break;case 202:case 53:this.ata_write_sectors_dma(e);break;case 64:this.status_reg=80,this.push_irq();break;case 218:this.is_atapi&&(this.buffer||(this.error_reg|=2),this.medium_changed&&(this.error_reg|=32,this.medium_changed=!1),this.error_reg|=64),this.status_reg=80,this.push_irq();break;case 224:this.status_reg=80,this.push_irq();break;case 225:this.status_reg=80,this.push_irq();break;case 231:this.status_reg=80,this.push_irq();break;case 234:this.status_reg=80,this.push_irq();break;case 236:this.is_atapi?(this.lba_mid_reg=20,this.lba_high_reg=235,this.ata_abort_command()):(this.create_identify_packet(),this.status_reg=88,this.push_irq());break;case 239:this.status_reg=80,this.push_irq();break;case 222:this.status_reg=64,this.push_irq();break;case 245:this.status_reg=80,this.push_irq();break;case 249:this.ata_abort_command();break;case 0:this.ata_abort_command();break;case 240:A(e),this.capture_regs(),this.ata_abort_command();break;default:A(e),this.capture_regs(),this.ata_abort_command()}else A(e)};xe.prototype.atapi_handle=function(){var e=this.data[0],t=ba[e]?ba[e].flags:0;if(this.data_pointer=0,this.current_atapi_command=e,e!==3&&(this.atapi_add_sense=this.atapi_sense_key=0),!this.buffer&&t&1)this.atapi_check_condition_response(2,58),this.push_irq();else{switch(e){case 0:this.buffer?(this.data_allocate(0),this.data_end=this.data_length,this.status_reg=80):this.atapi_check_condition_response(2,58);break;case 3:this.data_allocate(this.data[4]),this.data_end=this.data_length,this.status_reg=88,this.data[0]=240,this.data[2]=this.atapi_sense_key,this.data[7]=8,this.data[12]=this.atapi_add_sense,this.atapi_add_sense=this.atapi_sense_key=0;break;case 18:e=this.data[4],this.status_reg=88,A(this.data[1],2),this.data.set([5,128,1,49,31,0,0,0,83,79,78,89,32,32,32,32,67,68,45,82,79,77,32,67,68,85,45,49,48,48,48,32,49,46,49,97]),this.data_end=this.data_length=Math.min(36,e);break;case 26:this.data_allocate(this.data[4]),this.data_end=this.data_length,this.status_reg=88;break;case 30:this.data_allocate(0),this.data_end=this.data_length,this.status_reg=80;break;case 37:e=this.sector_count-1,this.data_set(new Uint8Array([e>>24&255,e>>16&255,e>>8&255,e&255,0,0,this.sector_size>>8&255,this.sector_size&255])),this.data_end=this.data_length,this.status_reg=88;break;case 40:case 168:this.features_reg&1?this.atapi_read_dma(this.data):this.atapi_read(this.data);break;case 66:e=this.data[8],this.data_allocate(Math.min(8,e)),this.data_end=this.data_length,this.status_reg=88;break;case 67:e=this.data[8]|this.data[7]<<8,t=this.data[9]>>6,A(t,2),A(this.data[6]),this.data_allocate(e),this.data_end=this.data_length,t===0?(e=this.sector_count,this.data.set(new Uint8Array([0,18,1,1,0,20,1,0,0,0,0,0,0,22,170,0,e>>24,e>>16&255,e>>8&255,e&255]))):t===1&&this.data.set(new Uint8Array([0,10,1,1,0,0,0,0,0,0,0,0])),this.status_reg=88;break;case 70:e=Math.min(this.data[8]|this.data[7]<<8,32),this.data_allocate(e),this.data_end=this.data_length,this.data[0]=e-4>>24&255,this.data[1]=e-4>>16&255,this.data[2]=e-4>>8&255,this.data[3]=e-4&255,this.data[6]=8,this.data[10]=3,this.status_reg=88;break;case 81:this.data_allocate(0),this.data_end=this.data_length,this.status_reg=80;break;case 82:this.atapi_check_condition_response(5,36);break;case 90:e=this.data[8]|this.data[7]<<8,t=this.data[2],A(t),t===42&&this.data_allocate(Math.min(30,e)),this.data_end=this.data_length,this.status_reg=88;break;case 189:this.data_allocate(this.data[9]|this.data[8]<<8),this.data_end=this.data_length,this.data[5]=1,this.status_reg=88;break;case 27:e=this.data[4]&3,A(this.data[1]&1),A(e),this.buffer&&e===2&&(this.medium_changed=!0,this.buffer=null),this.status_reg=80,this.data_allocate(0),this.data_end=this.data_length;break;case 69:case 74:this.atapi_check_condition_response(5,36);break;case 190:this.data_allocate(0),this.data_end=this.data_length,this.status_reg=80;break;default:A(this.data[0]),this.atapi_check_condition_response(5,36)}this.sector_count_reg=this.sector_count_reg&-8|2,(this.status_reg&128)===0&&this.push_irq(),(this.status_reg&128)===0&&this.data_length===0&&(this.sector_count_reg|=1,this.status_reg&=-9)}};xe.prototype.atapi_check_condition_response=function(e,t){this.data_allocate(0),this.data_end=this.data_length,this.status_reg=65,this.error_reg=e<<4,this.sector_count_reg=this.sector_count_reg&-8|3,this.atapi_sense_key=e,this.atapi_add_sense=t};xe.prototype.do_write=function(){this.status_reg=80;var e=this.data.subarray(0,this.data_length);this.ata_advance(this.current_command,this.data_length/512),this.push_irq(),this.buffer.set(this.write_dest,e,function(){}),this.report_write(this.data_length)};xe.prototype.atapi_read=function(e){var t=e[2]<<24|e[3]<<16|e[4]<<8|e[5];e=e[0]===168?e[6]<<24|e[7]<<16|e[8]<<8|e[9]:e[7]<<8|e[8];var i=(e>>>0)*this.sector_size;t*=this.sector_size,this.data_length=0;var s=this.lba_high_reg<<8&65280|this.lba_mid_reg&255;this.lba_mid_reg=this.lba_high_reg=0,s===65535&&s--,s>i&&(s=i),this.buffer?t>=this.buffer.byteLength?(this.name+""+A(t+i)+A(this.buffer.byteLength),this.status_reg=255,this.push_irq()):i===0?(this.status_reg=80,this.data_pointer=0):(i=Math.min(i,this.buffer.byteLength-t),this.status_reg=208,this.report_read_start(),this.read_buffer(t,i,n=>{this.data_set(n),this.status_reg=88,this.sector_count_reg=this.sector_count_reg&-8|2,this.push_irq(),this.data_end=s&=-4,this.data_end>this.data_length&&(this.data_end=this.data_length),this.lba_mid_reg=this.data_end&255,this.lba_high_reg=this.data_end>>8&255,this.report_read_end(i)})):(this.status_reg=255,this.error_reg=65,this.push_irq())};xe.prototype.atapi_read_dma=function(e){var t=e[2]<<24|e[3]<<16|e[4]<<8|e[5],i=e[0]===168?e[6]<<24|e[7]<<16|e[8]<<8|e[9]:e[7]<<8|e[8];i>>>=0,e=e[1];var s=i*this.sector_size,n=t*this.sector_size;this.name+""+A(t)+A(i)+A(s)+A(e),n>=this.buffer.byteLength?(this.name+""+A(n+s)+A(this.buffer.byteLength),this.status_reg=255,this.push_irq()):(this.status_reg=208,this.report_read_start(),this.read_buffer(n,s,o=>{this.report_read_end(s),this.status_reg=88,this.sector_count_reg=this.sector_count_reg&-8|2,this.data_set(o),this.do_atapi_dma()}))};xe.prototype.do_atapi_dma=function(){if((this.channel.dma_status&1)!==0&&(this.status_reg&8)!==0){var e=this.channel.prdt_addr,t=0,i=this.data;do{var s=this.cpu.read32s(e),n=this.cpu.read16(e+4),o=this.cpu.read8(e+7)&128;if(n||(n=65536),this.cpu.write_blob(i.subarray(t,Math.min(t+n,this.data_length)),s),t+=n,e+=8,t>=this.data_length&&!o)break}while(!o);this.status_reg=80,this.channel.dma_status&=-2,this.sector_count_reg=this.sector_count_reg&-8|3,this.push_irq()}};xe.prototype.read_data=function(e){if(this.data_pointer<this.data_end){A(this.data_pointer);var t=e===1?this.data[this.data_pointer]:e===2?this.data16[this.data_pointer>>>1]:this.data32[this.data_pointer>>>2];return this.data_pointer+=e,this.data_pointer>=this.data_end&&this.read_end(),t}return this.data_pointer+=e,0};xe.prototype.read_end=function(){if(this.current_command===160)if(this.data_end===this.data_length)this.status_reg=80,this.sector_count_reg=this.sector_count_reg&-8|3,this.push_irq();else{this.status_reg=88,this.sector_count_reg=this.sector_count_reg&-8|2,this.push_irq();var e=this.lba_high_reg<<8&65280|this.lba_mid_reg&255;this.data_end+e>this.data_length?(this.lba_mid_reg=this.data_length-this.data_end&255,this.lba_high_reg=this.data_length-this.data_end>>8&255,this.data_end=this.data_length):this.data_end+=e}else this.error_reg=0,this.data_pointer>=this.data_length?this.status_reg=80:(e=this.current_command===41||this.current_command===196?Math.min(this.sectors_per_drq,(this.data_length-this.data_end)/512):1,this.ata_advance(this.current_command,e),this.data_end+=512*e,this.status_reg=88,this.push_irq())};xe.prototype.write_data_port=function(e,t){this.data_pointer>=this.data_end?(A(e),A(this.data_end),A(this.data_pointer)):(t===1?this.data[this.data_pointer++]=e:t===2?(this.data16[this.data_pointer>>>1]=e,this.data_pointer+=2):(this.data32[this.data_pointer>>>2]=e,this.data_pointer+=4),this.data_pointer===this.data_end&&this.write_end())};xe.prototype.write_data_port8=function(e){this.write_data_port(e,1)};xe.prototype.write_data_port16=function(e){this.write_data_port(e,2)};xe.prototype.write_data_port32=function(e){this.write_data_port(e,4)};xe.prototype.write_end=function(){this.current_command===160?this.atapi_handle():this.data_pointer>=this.data_length?this.do_write():(A(this.current_command),this.status_reg=88,this.data_end+=512,this.push_irq())};xe.prototype.ata_advance=function(e,t){this.sector_count_reg-=t,e===36||e===41||e===37||e===52||e===57||e===53?(e=t+this.get_lba48(),this.lba_low_reg=e&255|e>>16&65280,this.lba_mid_reg=e>>8&255,this.lba_high_reg=e>>16&255):this.is_lba?(e=t+this.get_lba28(),this.lba_low_reg=e&255,this.lba_mid_reg=e>>8&255,this.lba_high_reg=e>>16&255,this.head=this.head&-16|e&15):(e=t+this.get_chs(),t=e/(this.head_count*this.sectors_per_track)|0,this.lba_mid_reg=t&255,this.lba_high_reg=t>>8&255,this.head=(e/this.sectors_per_track|0)%this.head_count&15,this.lba_low_reg=e%this.sectors_per_track+1&255,this.get_chs())};xe.prototype.ata_read_sectors=function(e){var t=e===36||e===41,i=this.get_count(t);t=this.get_lba(t);var s=e===32||e===36,n=i*this.sector_size;t*=this.sector_size,t+n>this.buffer.byteLength?(this.status_reg=255,this.push_irq()):(this.status_reg=192,this.report_read_start(),this.read_buffer(t,n,o=>{this.data_set(o),this.status_reg=88,this.data_end=s?512:Math.min(n,512*this.sectors_per_drq),this.ata_advance(e,s?1:Math.min(i,this.sectors_per_track)),this.push_irq(),this.report_read_end(n)}))};xe.prototype.ata_read_sectors_dma=function(e){e=e===37;var t=this.get_count(e);this.get_lba(e)*this.sector_size+t*this.sector_size>this.buffer.byteLength?(this.status_reg=255,this.push_irq()):(this.status_reg=88,this.channel.dma_status|=1)};xe.prototype.do_ata_read_sectors_dma=function(){var e=this.current_command===37,t=this.get_count(e);e=this.get_lba(e);var i=t*this.sector_size;e*=this.sector_size,this.report_read_start(),this.read_buffer(e,i,s=>{var n=this.channel.prdt_addr,o=0;do{var c=this.cpu.read32s(n),r=this.cpu.read16(n+4),a=this.cpu.read8(n+7)&128;r||(r=65536),this.cpu.write_blob(s.subarray(o,o+r),c),o+=r,n+=8}while(!a);this.ata_advance(this.current_command,t),this.status_reg=80,this.channel.dma_status&=-2,this.current_command=-1,this.report_read_end(i),this.push_irq()})};xe.prototype.ata_write_sectors=function(e){var t=e===52||e===57,i=this.get_count(t);t=this.get_lba(t),e=e===48||e===52,i*=this.sector_size,t*=this.sector_size,t+i>this.buffer.byteLength?(this.status_reg=255,this.push_irq()):(this.status_reg=88,this.data_allocate_noclear(i),this.data_end=e?512:Math.min(i,512*this.sectors_per_drq),this.write_dest=t)};xe.prototype.ata_write_sectors_dma=function(e){e=e===53;var t=this.get_count(e);this.get_lba(e)*this.sector_size+t*this.sector_size>this.buffer.byteLength?(this.status_reg=255,this.push_irq()):(this.status_reg=88,this.channel.dma_status|=1)};xe.prototype.do_ata_write_sectors_dma=function(){var e=this.current_command===53,t=this.get_count(e),i=this.get_lba(e);e=t*this.sector_size,i*=this.sector_size;var s=this.channel.prdt_addr,n=0;const o=new Uint8Array(e);do{var c=this.cpu.read32s(s),r=this.cpu.read16(s+4),a=this.cpu.read8(s+7)&128;r||(r=65536),c=this.cpu.mem8.subarray(c,c+r),o.set(c,n),n+=r,s+=8}while(!a);this.buffer.set(i,o,()=>{this.ata_advance(this.current_command,t),this.status_reg=80,this.push_irq(),this.channel.dma_status&=-2,this.current_command=-1}),this.report_write(e)};xe.prototype.get_chs=function(){return((this.lba_mid_reg&255|this.lba_high_reg<<8&65280)*this.head_count+this.head)*this.sectors_per_track+(this.lba_low_reg&255)-1};xe.prototype.get_lba28=function(){return this.lba_low_reg&255|this.lba_mid_reg<<8&65280|this.lba_high_reg<<16&16711680|(this.head&15)<<24};xe.prototype.get_lba48=function(){return(this.lba_low_reg&255|this.lba_mid_reg<<8&65280|this.lba_high_reg<<16&16711680|this.lba_low_reg>>8<<24&4278190080)>>>0};xe.prototype.get_lba=function(e){return e?this.get_lba48():this.is_lba?this.get_lba28():this.get_chs()};xe.prototype.get_count=function(e){return e?(e=this.sector_count_reg,e===0&&(e=65536)):(e=this.sector_count_reg&255,e===0&&(e=256)),e};xe.prototype.create_identify_packet=function(){const e=Math.min(16383,this.cylinder_count),t=(c,r,a,u)=>{r<<=1;var _=a<<1;for(a=r+_,c.fill(32,r,_),_=0;_<u.length&&r<a;_++)_&1?(c[r]=u.charCodeAt(_),r+=2):c[r+1]=u.charCodeAt(_)},i=this.is_atapi?34112:64,s=this.current_command===160?0:1031,n=this.is_atapi?16928:16384,o=this.is_atapi?20480:29696;this.data.fill(0,0,512),this.data_set([i&255,i>>8&255,e&255,e>>8&255,0,0,this.head_count&255,this.head_count>>8&255,this.sectors_per_track/512&255,this.sectors_per_track/512>>8&255,0,2,this.sectors_per_track&255,this.sectors_per_track>>8&255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,2,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,128,0,1,0,0,2,0,0,0,2,0,2,7,0,e&255,e>>8&255,this.head_count&255,this.head_count>>8&255,this.sectors_per_track,0,this.sector_count&255,this.sector_count>>8&255,this.sector_count>>16&255,this.sector_count>>24&255,0,0,this.sector_count&255,this.sector_count>>8&255,this.sector_count>>16&255,this.sector_count>>24&255,0,0,s&255,s>>8&255,0,0,30,0,30,0,30,0,30,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,n&255,n>>8&255,o&255,o>>8&255,0,64,n&255,n>>8&255,o&255,o>>8&255,0,64,0,0,0,0,0,0,0,0,0,0,1,96,0,0,0,0,0,0,0,0,0,0,0,0,this.sector_count&255,this.sector_count>>8&255,this.sector_count>>16&255,this.sector_count>>24&255]),t(this.data,10,10,`8086-86${this.channel_nr}${this.interface_nr}`),t(this.data,23,4,"1.00"),t(this.data,27,20,this.is_atapi?"v86 ATAPI CD-ROM":"v86 ATA HD"),this.data_end=this.data_length=512};xe.prototype.data_allocate=function(e){this.data_allocate_noclear(e),this.data32.fill(0,0,e+3>>2)};xe.prototype.data_allocate_noclear=function(e){this.data.length<e&&(this.data=new Uint8Array(e+3&-4),this.data16=new Uint16Array(this.data.buffer),this.data32=new Int32Array(this.data.buffer)),this.data_length=e,this.data_pointer=0};xe.prototype.data_set=function(e){this.data_allocate_noclear(e.length),this.data.set(e)};xe.prototype.report_read_start=function(){this.bus.send("ide-read-start")};xe.prototype.report_read_end=function(e){this.bus.send("ide-read-end",[this.channel_nr,e,e/this.sector_size|0])};xe.prototype.report_write=function(e){this.bus.send("ide-write-end",[this.channel_nr,e,e/this.sector_size|0])};xe.prototype.read_buffer=function(e,t,i){const s=this.last_io_id++;this.in_progress_io_ids.add(s),this.buffer.get(e,t,n=>{this.cancelled_io_ids.delete(s)?this.in_progress_io_ids.has(s):(this.in_progress_io_ids.delete(s),i(n))})};xe.prototype.cancel_io_operations=function(){for(const e of this.in_progress_io_ids)this.cancelled_io_ids.add(e);this.in_progress_io_ids.clear()};xe.prototype.get_state=function(){var e=[];return e[0]=this.sector_count_reg,e[1]=this.cylinder_count,e[2]=this.lba_high_reg,e[3]=this.lba_mid_reg,e[4]=this.data_pointer,e[5]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=this.device_reg,e[10]=this.error_reg,e[11]=this.head,e[12]=this.head_count,e[13]=this.is_atapi,e[14]=this.is_lba,e[15]=this.features_reg,e[16]=this.data,e[17]=this.data_length,e[18]=this.lba_low_reg,e[19]=this.sector_count,e[20]=this.sector_size,e[21]=this.sectors_per_drq,e[22]=this.sectors_per_track,e[23]=this.status_reg,e[24]=this.write_dest,e[25]=this.current_command,e[26]=this.data_end,e[27]=this.current_atapi_command,e[28]=this.buffer,e};xe.prototype.set_state=function(e){this.sector_count_reg=e[0],this.cylinder_count=e[1],this.lba_high_reg=e[2],this.lba_mid_reg=e[3],this.data_pointer=e[4],this.device_reg=e[9],this.error_reg=e[10],this.head=e[11],this.head_count=e[12],this.is_atapi=e[13],this.is_lba=e[14],this.features_reg=e[15],this.data=e[16],this.data_length=e[17],this.lba_low_reg=e[18],this.sector_count=e[19],this.sector_size=e[20],this.sectors_per_drq=e[21],this.sectors_per_track=e[22],this.status_reg=e[23],this.write_dest=e[24],this.current_command=e[25],this.data_end=e[26],this.current_atapi_command=e[27],this.data16=new Uint16Array(this.data.buffer),this.data32=new Int32Array(this.data.buffer),this.buffer&&this.buffer.set_state(e[28]),this.drive_connected=this.is_atapi||this.buffer,this.medium_changed=!1};function cs(e,t,i){for(this.bus=t,this.id=e.devices.net?1:0,this.status=this.pairs=1,this.preserve_mac_from_state_image=i,this.mac=new Uint8Array([0,34,21,255*Math.random()|0,255*Math.random()|0,255*Math.random()|0]),this.bus.send("net"+this.id+"-mac",Jt(this.mac)),t=[],i=0;i<this.pairs;++i)t.push({size_supported:1024,notify_offset:0}),t.push({size_supported:1024,notify_offset:1});t.push({size_supported:16,notify_offset:2}),this.virtio=new _t(e,{name:"virtio-net",pci_id:80,device_id:4161,subsystem_device_id:1,common:{initial_port:51200,queues:t,features:[5,16,22,3,17,23,32],on_driver_ok:()=>{}},notification:{initial_port:51456,single_handler:!1,handlers:[()=>{},s=>{const n=this.virtio.queues[s];for(;n.has_request();){const o=n.pop_request(),c=new Uint8Array(o.length_readable);o.get_next_blob(c),this.bus.send("net"+this.id+"-send",c.subarray(12)),this.bus.send("eth-transmit-end",[c.length-12]),this.virtio.queues[s].push_reply(o)}this.virtio.queues[s].flush_replies()},s=>{if(s===2*this.pairs)for(var n=this.virtio.queues[s];n.has_request();){const o=n.pop_request(),c=new Uint8Array(o.length_readable);o.get_next_blob(c);const r=Ie(["b","b"],c,{offset:0});switch(r[0]<<8|r[1]){case 1024:Ie(["h"],c,{offset:2}),this.Send(s,o,new Uint8Array([0]));break;case 257:this.mac=c.subarray(2,8),this.Send(s,o,new Uint8Array([0])),this.bus.send("net"+this.id+"-mac",Jt(this.mac));break;default:this.Send(s,o,new Uint8Array([1]));return}}}]},isr_status:{initial_port:50944},device_specific:{initial_port:50688,struct:[0,1,2,3,4,5].map((s,n)=>({bytes:1,name:"mac_"+n,read:()=>this.mac[n],write:()=>{}})).concat([{bytes:2,name:"status",read:()=>this.status,write:()=>{}},{bytes:2,name:"max_pairs",read:()=>this.pairs,write:()=>{}},{bytes:2,name:"mtu",read:()=>1500,write:()=>{}}])}}),this.bus.register("net"+this.id+"-receive",s=>{this.bus.send("eth-receive-end",[s.length]);const n=new Uint8Array(12+s.byteLength);new DataView(n.buffer,n.byteOffset,n.byteLength).setInt16(10,1),n.set(s,12),s=this.virtio.queues[0],s.has_request()?(s=s.pop_request(),s.set_next_blob(n),this.virtio.queues[0].push_reply(s),this.virtio.queues[0].flush_replies()):console.log("No buffer to write into!")},this)}cs.prototype.get_state=function(){const e=[];return e[0]=this.virtio,e[1]=this.id,e[2]=this.mac,e};cs.prototype.set_state=function(e){this.virtio.set_state(e[0]),this.id=e[1],this.preserve_mac_from_state_image&&(this.mac=e[2],this.bus.send("net"+this.id+"-mac",Jt(this.mac)))};cs.prototype.reset=function(){this.virtio.reset()};cs.prototype.Send=function(e,t,i){t.set_next_blob(i),this.virtio.queues[e].push_reply(t),this.virtio.queues[e].flush_replies()};cs.prototype.Ack=function(e,t){this.virtio.queues[e].push_reply(t),this.virtio.queues[e].flush_replies()};const Uh=Uint32Array.from([655360,655360,720896,753664]),Qn=Uint32Array.from([131072,65536,32768,32768]);function de(e,t,i,s){this.cpu=e,this.bus=t,this.screen=i,this.vga_memory_size=s,this.cursor_address=0,this.cursor_scanline_start=14,this.cursor_scanline_end=15,this.max_cols=80,this.max_rows=25,this.virtual_height=this.virtual_width=this.screen_height=this.screen_width=0,this.layers=[],this.start_address_latched=this.start_address=0,this.crtc=new Uint8Array(25),this.line_compare=this.offset_register=this.preset_row_scan=this.underline_location_register=this.vertical_blank_start=this.vertical_display_enable_end=this.horizontal_blank_start=this.horizontal_display_enable_end=this.crtc_mode=0,this.graphical_mode=!1,this.vga256_palette=new Int32Array(256),this.latch_dword=0,this.svga_version=45253,this.svga_height=this.svga_width=0,this.svga_enabled=!1,this.svga_bpp=32,this.svga_offset_y=this.svga_offset_x=this.svga_offset=this.svga_bank_offset=0,this.vga_memory_size=this.vga_memory_size===void 0||262144>this.vga_memory_size?262144:268435456<this.vga_memory_size?268435456:Yp(this.vga_memory_size),this.pci_space=[52,18,17,17,3,1,0,0,0,0,0,3,0,0,0,0,8,14680064,57344,224,0,0,0,0,0,0,191,254,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,244,26,0,17,0,0,190,254,0,0,0,0,0,0,0,0,0,0,0,0],this.pci_id=144,this.pci_bars=[{size:this.vga_memory_size}],this.pci_rom_size=65536,this.pci_rom_address=4272947200,this.name="vga",this.dac_state=this.dac_color_index_read=this.dac_color_index_write=this.index_crtc=0,this.dac_mask=255,this.dac_map=new Uint8Array(16),this.attribute_controller_index=-1,this.palette_source=32,this.color_select=this.horizontal_panning=this.color_plane_enable=this.attribute_mode=0,this.sequencer_index=-1,this.plane_write_bm=15,this.clocking_mode=this.sequencer_memory_mode=0,this.graphics_index=-1,this.planar_rotate_reg=this.planar_mode=this.plane_read=this.character_map_select=0,this.planar_bitmap=255,this.max_scan_line=this.color_dont_care=this.color_compare=this.miscellaneous_graphics_register=this.planar_setreset_enable=this.planar_setreset=0,this.port_3DA_value=this.miscellaneous_output_register=255,this.font_page_ab_enabled=!1,t=e.io,t.register_write(960,this,this.port3C0_write),t.register_read(960,this,this.port3C0_read,this.port3C0_read16),t.register_read(961,this,this.port3C1_read),t.register_write(962,this,this.port3C2_write),t.register_write_consecutive(964,this,this.port3C4_write,this.port3C5_write),t.register_read(964,this,this.port3C4_read),t.register_read(965,this,this.port3C5_read),t.register_write_consecutive(974,this,this.port3CE_write,this.port3CF_write),t.register_read(974,this,this.port3CE_read),t.register_read(975,this,this.port3CF_read),t.register_read(966,this,this.port3C6_read),t.register_write(966,this,this.port3C6_write),t.register_write(967,this,this.port3C7_write),t.register_read(967,this,this.port3C7_read),t.register_write(968,this,this.port3C8_write),t.register_read(968,this,this.port3C8_read),t.register_write(969,this,this.port3C9_write),t.register_read(969,this,this.port3C9_read),t.register_read(972,this,this.port3CC_read),t.register_write(980,this,this.port3D4_write,this.port3D4_write16),t.register_write(981,this,this.port3D5_write,this.port3D5_write16),t.register_read(980,this,this.port3D4_read),t.register_read(981,this,this.port3D5_read,this.port3D5_read16),t.register_write(948,this,this.port3D4_write,this.port3D4_write16),t.register_write(949,this,this.port3D5_write,this.port3D5_write16),t.register_read(948,this,this.port3D4_read),t.register_read(949,this,this.port3D5_read,this.port3D5_read16),t.register_read(970,this,function(){return 0}),t.register_read(986,this,this.port3DA_read),t.register_read(954,this,this.port3DA_read),this.dispi_index=-1,this.dispi_enable_value=0,t.register_write(462,this,void 0,this.port1CE_write),t.register_write(463,this,void 0,this.port1CF_write),t.register_read(463,this,void 0,this.port1CF_read),i=e.svga_allocate_memory(this.vga_memory_size)>>>0,this.svga_memory=be(Uint8Array,e.wasm_memory,i,this.vga_memory_size),this.diff_addr_min=this.vga_memory_size,this.diff_addr_max=0,this.diff_plot_min=this.vga_memory_size,this.diff_plot_max=0,this.image_data=null,this.vga_memory=new Uint8Array(262144),this.plane0=new Uint8Array(this.vga_memory.buffer,0,65536),this.plane1=new Uint8Array(this.vga_memory.buffer,65536,65536),this.plane2=new Uint8Array(this.vga_memory.buffer,131072,65536),this.plane3=new Uint8Array(this.vga_memory.buffer,196608,65536),this.pixel_buffer=new Uint8Array(524288),t.mmap_register(655360,131072,n=>this.vga_memory_read(n),(n,o)=>this.vga_memory_write(n,o)),e.devices.pci.register_device(this)}de.prototype.get_state=function(){var e=[];return e[0]=this.vga_memory_size,e[1]=this.cursor_address,e[2]=this.cursor_scanline_start,e[3]=this.cursor_scanline_end,e[4]=this.max_cols,e[5]=this.max_rows,e[6]=this.vga_memory,e[7]=this.dac_state,e[8]=this.start_address,e[9]=this.graphical_mode,e[10]=this.vga256_palette,e[11]=this.latch_dword,e[12]=this.color_compare,e[13]=this.color_dont_care,e[14]=this.miscellaneous_graphics_register,e[15]=this.svga_width,e[16]=this.svga_height,e[17]=this.crtc_mode,e[18]=this.svga_enabled,e[19]=this.svga_bpp,e[20]=this.svga_bank_offset,e[21]=this.svga_offset,e[22]=this.index_crtc,e[23]=this.dac_color_index_write,e[24]=this.dac_color_index_read,e[25]=this.dac_map,e[26]=this.sequencer_index,e[27]=this.plane_write_bm,e[28]=this.sequencer_memory_mode,e[29]=this.graphics_index,e[30]=this.plane_read,e[31]=this.planar_mode,e[32]=this.planar_rotate_reg,e[33]=this.planar_bitmap,e[34]=this.max_scan_line,e[35]=this.miscellaneous_output_register,e[36]=this.port_3DA_value,e[37]=this.dispi_index,e[38]=this.dispi_enable_value,e[39]=this.svga_memory,e[41]=this.attribute_controller_index,e[42]=this.offset_register,e[43]=this.planar_setreset,e[44]=this.planar_setreset_enable,e[45]=this.start_address_latched,e[46]=this.crtc,e[47]=this.horizontal_display_enable_end,e[48]=this.horizontal_blank_start,e[49]=this.vertical_display_enable_end,e[50]=this.vertical_blank_start,e[51]=this.underline_location_register,e[52]=this.preset_row_scan,e[53]=this.offset_register,e[54]=this.palette_source,e[55]=this.attribute_mode,e[56]=this.color_plane_enable,e[57]=this.horizontal_panning,e[58]=this.color_select,e[59]=this.clocking_mode,e[60]=this.line_compare,e[61]=this.pixel_buffer,e[62]=this.dac_mask,e[63]=this.character_map_select,e[64]=this.font_page_ab_enabled,e};de.prototype.set_state=function(e){this.vga_memory_size=e[0],this.cursor_address=e[1],this.cursor_scanline_start=e[2],this.cursor_scanline_end=e[3],this.max_cols=e[4],this.max_rows=e[5],e[6]&&this.vga_memory.set(e[6]),this.dac_state=e[7],this.start_address=e[8],this.graphical_mode=e[9],this.vga256_palette=e[10],this.latch_dword=e[11],this.color_compare=e[12],this.color_dont_care=e[13],this.miscellaneous_graphics_register=e[14],this.svga_width=e[15],this.svga_height=e[16],this.crtc_mode=e[17],this.svga_enabled=e[18],this.svga_bpp=e[19],this.svga_bank_offset=e[20],this.svga_offset=e[21],this.index_crtc=e[22],this.dac_color_index_write=e[23],this.dac_color_index_read=e[24],this.dac_map=e[25],this.sequencer_index=e[26],this.plane_write_bm=e[27],this.sequencer_memory_mode=e[28],this.graphics_index=e[29],this.plane_read=e[30],this.planar_mode=e[31],this.planar_rotate_reg=e[32],this.planar_bitmap=e[33],this.max_scan_line=e[34],this.miscellaneous_output_register=e[35],this.port_3DA_value=e[36],this.dispi_index=e[37],this.dispi_enable_value=e[38],this.svga_memory.set(e[39]),this.attribute_controller_index=e[41],this.offset_register=e[42],this.planar_setreset=e[43],this.planar_setreset_enable=e[44],this.start_address_latched=e[45],this.crtc.set(e[46]),this.horizontal_display_enable_end=e[47],this.horizontal_blank_start=e[48],this.vertical_display_enable_end=e[49],this.vertical_blank_start=e[50],this.underline_location_register=e[51],this.preset_row_scan=e[52],this.offset_register=e[53],this.palette_source=e[54],this.attribute_mode=e[55],this.color_plane_enable=e[56],this.horizontal_panning=e[57],this.color_select=e[58],this.clocking_mode=e[59],this.line_compare=e[60],e[61]&&this.pixel_buffer.set(e[61]),this.dac_mask=e[62]===void 0?255:e[62],this.character_map_select=e[63]===void 0?0:e[63],this.font_page_ab_enabled=e[64]===void 0?0:e[64],this.screen.set_mode(this.graphical_mode),this.graphical_mode?(this.screen_height=this.screen_width=0,this.svga_enabled?(this.set_size_graphical(this.svga_width,this.svga_height,this.svga_width,this.svga_height,this.svga_bpp),this.update_layers()):(this.update_vga_size(),this.update_layers(),this.complete_replot())):(this.set_font_bitmap(!0),this.set_size_text(this.max_cols,this.max_rows),this.set_font_page(),this.update_cursor_scanline(),this.update_cursor()),this.complete_redraw()};de.prototype.vga_memory_read=function(e){if(this.svga_enabled)return this.cpu.read8((e-655360|this.svga_bank_offset)+3758096384|0);var t=this.miscellaneous_graphics_register>>2&3;return e-=Uh[t],0>e||e>=Qn[t]?(A(e>>>0),0):(this.latch_dword=this.plane0[e],this.latch_dword|=this.plane1[e]<<8,this.latch_dword|=this.plane2[e]<<16,this.latch_dword|=this.plane3[e]<<24,this.planar_mode&8?(t=255,this.color_dont_care&1&&(t&=this.plane0[e]^~(this.color_compare&1?255:0)),this.color_dont_care&2&&(t&=this.plane1[e]^~(this.color_compare&2?255:0)),this.color_dont_care&4&&(t&=this.plane2[e]^~(this.color_compare&4?255:0)),this.color_dont_care&8&&(t&=this.plane3[e]^~(this.color_compare&8?255:0)),t):(t=this.plane_read,this.graphical_mode?this.sequencer_memory_mode&8?(t=e&3,e&=-4):this.planar_mode&16&&(t=e&1,e&=-2):t&=3,this.vga_memory[t<<16|e]))};de.prototype.vga_memory_write=function(e,t){if(this.svga_enabled)this.cpu.write8((e-655360|this.svga_bank_offset)+3758096384|0,t);else{var i=this.miscellaneous_graphics_register>>2&3;e-=Uh[i],0>e||e>=Qn[i]?(A(e>>>0),A(t)):this.graphical_mode?this.vga_memory_write_graphical(e,t):this.plane_write_bm&3?this.vga_memory_write_text_mode(e,t):this.plane_write_bm&4&&(this.plane2[e]=t)}};de.prototype.vga_memory_write_graphical=function(e,t){var i=this.planar_mode&3,s=this.apply_feed(this.planar_bitmap),n=this.apply_expand(this.planar_setreset),o=this.apply_expand(this.planar_setreset_enable);switch(i){case 0:t=this.apply_rotate(t);var c=this.apply_feed(t);c=this.apply_setreset(c,o),c=this.apply_logical(c,this.latch_dword),c=this.apply_bitmask(c,s);break;case 1:c=this.latch_dword;break;case 2:c=this.apply_expand(t),c=this.apply_logical(c,this.latch_dword),c=this.apply_bitmask(c,s);break;case 3:t=this.apply_rotate(t),s&=this.apply_feed(t),c=this.apply_bitmask(n,s)}switch(t=15,this.sequencer_memory_mode&12){case 0:t=5<<(e&1),e&=-2;break;case 8:case 12:t=1<<(e&3),e&=-4}t&=this.plane_write_bm,t&1&&(this.plane0[e]=c>>0&255),t&2&&(this.plane1[e]=c>>8&255),t&4&&(this.plane2[e]=c>>16&255),t&8&&(this.plane3[e]=c>>24&255),e=this.vga_addr_to_pixel(e),this.partial_replot(e,e+7)};de.prototype.apply_feed=function(e){return e|e<<8|e<<16|e<<24};de.prototype.apply_expand=function(e){return(e&1?255:0)|(e&2?255:0)<<8|(e&4?255:0)<<16|(e&8?255:0)<<24};de.prototype.apply_rotate=function(e){return(e|e<<8)>>>(this.planar_rotate_reg&7)&255};de.prototype.apply_setreset=function(e,t){var i=this.apply_expand(this.planar_setreset);return(e|t&i)&(~t|i)};de.prototype.apply_logical=function(e,t){switch(this.planar_rotate_reg&24){case 8:return e&t;case 16:return e|t;case 24:return e^t}return e};de.prototype.apply_bitmask=function(e,t){return t&e|~t&this.latch_dword};de.prototype.text_mode_redraw=function(){const e=this.scan_line_to_screen_row(this.line_compare),t=Math.max(0,2*(2*this.offset_register-this.max_cols)),i=this.attribute_mode&8,s=this.font_page_ab_enabled?7:15,n=i?7:15,o=this.screen.FLAG_BLINKING,c=this.screen.FLAG_FONT_PAGE_B;let r=this.start_address<<1;for(let a=0;a<this.max_rows;a++){a===e&&(r=0);for(let u=0;u<this.max_cols;u++){const _=this.vga_memory[r],l=this.vga_memory[r|1],m=(i&&l&128?o:0)|(!this.font_page_ab_enabled||l&8?0:c);this.bus.send("screen-put-char",[a,u,_]),this.screen.put_char(a,u,_,m,this.vga256_palette[this.dac_mask&this.dac_map[l>>4&n]],this.vga256_palette[this.dac_mask&this.dac_map[l&s]]),r+=2}r+=t}};de.prototype.vga_memory_write_text_mode=function(e,t){this.vga_memory[e]=t;var i=Math.max(this.max_cols,2*this.offset_register);let s;if(e>>1>=this.start_address){var n=(e>>1)-this.start_address;s=n/i|0,i=n%i}else n=e>>1,s=(n/i|0)+this.scan_line_to_screen_row(this.line_compare),i=n%i;if(!(i>=this.max_cols||s>=this.max_rows)){e&1?(n=t,t=this.vga_memory[e&-2]):n=this.vga_memory[e|1];var o=this.attribute_mode&8;e=(o&&n&128?this.screen.FLAG_BLINKING:0)|(!this.font_page_ab_enabled||n&8?0:this.screen.FLAG_FONT_PAGE_B);var c=this.font_page_ab_enabled?7:15;o=o?7:15,this.bus.send("screen-put-char",[s,i,t]),this.screen.put_char(s,i,t,e,this.vga256_palette[this.dac_mask&this.dac_map[n>>4&o]],this.vga256_palette[this.dac_mask&this.dac_map[n&c]])}};de.prototype.update_cursor=function(){var e=Math.max(this.max_cols,2*this.offset_register);let t;this.cursor_address>=this.start_address?(t=(this.cursor_address-this.start_address)/e|0,e=(this.cursor_address-this.start_address)%e):(t=(this.cursor_address/e|0)+this.scan_line_to_screen_row(this.line_compare),e=this.cursor_address%e),this.screen.update_cursor(t,e)};de.prototype.complete_redraw=function(){this.graphical_mode?this.svga_enabled?this.cpu.svga_mark_dirty():(this.diff_addr_min=0,this.diff_addr_max=524288):this.text_mode_redraw()};de.prototype.complete_replot=function(){this.graphical_mode&&!this.svga_enabled&&(this.diff_plot_min=0,this.diff_plot_max=524288,this.complete_redraw())};de.prototype.partial_redraw=function(e,t){e<this.diff_addr_min&&(this.diff_addr_min=e),t>this.diff_addr_max&&(this.diff_addr_max=t)};de.prototype.partial_replot=function(e,t){e<this.diff_plot_min&&(this.diff_plot_min=e),t>this.diff_plot_max&&(this.diff_plot_max=t),this.partial_redraw(e,t)};de.prototype.reset_diffs=function(){this.diff_addr_min=this.vga_memory_size,this.diff_addr_max=0,this.diff_plot_min=this.vga_memory_size,this.diff_plot_max=0};de.prototype.destroy=function(){};de.prototype.vga_bytes_per_line=function(){var e=this.offset_register<<2;return this.underline_location_register&64?e<<=1:this.crtc_mode&64&&(e>>>=1),e};de.prototype.vga_addr_shift_count=function(){var e=128+(~this.underline_location_register&this.crtc_mode&64);return e-=this.underline_location_register&64,e-=this.attribute_mode&64,e>>>6};de.prototype.vga_addr_to_pixel=function(e){var t=this.vga_addr_shift_count();if(~this.crtc_mode&3){var i=e-this.start_address;i&=this.crtc_mode<<13|-24577,i<<=t;var s=i/this.virtual_width|0;switch(i%=this.virtual_width,this.crtc_mode&3){case 2:s=s<<1|e>>13&1;break;case 1:s=s<<1|e>>14&1;break;case 0:s=s<<2|e>>13&3}return s*this.virtual_width+i+(this.start_address<<t)}return e<<t};de.prototype.scan_line_to_screen_row=function(e){return this.max_scan_line&128&&(e>>>=1),e=Math.ceil(e/(1+(this.max_scan_line&31))),this.crtc_mode&1||(e<<=1),this.crtc_mode&2||(e<<=1),e};de.prototype.set_size_text=function(e,t){this.max_cols=e,this.max_rows=t,this.screen.set_size_text(e,t),this.bus.send("screen-set-size",[e,t,0])};de.prototype.set_size_graphical=function(e,t,i,s,n){if(i=Math.max(i,1),s=Math.max(s,1),this.screen_width!==e||this.screen_height!==t||this.virtual_width!==i||this.virtual_height!==s){if(this.screen_width=e,this.screen_height=t,this.virtual_width=i,this.virtual_height=s,typeof ImageData<"u"){const o=i*s,c=this.cpu.svga_allocate_dest_buffer(o)>>>0;this.dest_buffet_offset=c,this.image_data=new ImageData(new Uint8ClampedArray(this.cpu.wasm_memory.buffer,c,4*o),i,s),this.cpu.svga_mark_dirty()}this.screen.set_size_graphical(e,t,i,s),this.bus.send("screen-set-size",[e,t,n])}};de.prototype.update_vga_size=function(){if(!this.svga_enabled){var e=Math.min(1+this.horizontal_display_enable_end,this.horizontal_blank_start),t=Math.min(1+this.vertical_display_enable_end,this.vertical_blank_start);if(e&&t)if(this.graphical_mode){e<<=3;var i=this.offset_register<<4,s=4;this.attribute_mode&64?(e>>>=1,i>>>=1,s=8):this.attribute_mode&2&&(s=1),t=this.scan_line_to_screen_row(t);var n=Qn[0];const o=this.vga_bytes_per_line();this.set_size_graphical(e,t,i,o?Math.ceil(n/o):t,s),this.update_vertical_retrace(),this.update_layers()}else this.max_scan_line&128&&(t>>>=1),i=t/(1+(this.max_scan_line&31))|0,e&&i&&this.set_size_text(e,i)}};de.prototype.update_layers=function(){if(this.graphical_mode||this.text_mode_redraw(),this.svga_enabled)this.layers=[];else if(this.virtual_width&&this.screen_width)if(!this.palette_source||this.clocking_mode&32)this.layers=[],this.screen.clear_screen();else{var e=this.start_address_latched,t=this.horizontal_panning;this.attribute_mode&64&&(t>>>=1);var i=this.preset_row_scan>>5&3,s=this.vga_addr_to_pixel(e+i);e=s/this.virtual_width|0;var n=s%this.virtual_width+t;s=this.scan_line_to_screen_row(1+this.line_compare),s=Math.min(s,this.screen_height);var o=this.screen_height-s;this.layers=[],n=-n;for(var c=0;n<this.screen_width;n+=this.virtual_width,c++)this.layers.push({image_data:this.image_data,screen_x:n,screen_y:0,buffer_x:0,buffer_y:e+c,buffer_width:this.virtual_width,buffer_height:s});for(e=0,this.attribute_mode&32||(e=this.vga_addr_to_pixel(i)+t),n=-e,c=0;n<this.screen_width;n+=this.virtual_width,c++)this.layers.push({image_data:this.image_data,screen_x:n,screen_y:s,buffer_x:0,buffer_y:c,buffer_width:this.virtual_width,buffer_height:o})}};de.prototype.update_vertical_retrace=function(){this.port_3DA_value|=8,this.start_address_latched!==this.start_address&&(this.start_address_latched=this.start_address,this.update_layers())};de.prototype.update_cursor_scanline=function(){var e=this.max_scan_line&31;const t=Math.min(e,this.cursor_scanline_start&31);e=Math.min(e,this.cursor_scanline_end&31),this.screen.update_cursor_scanline(t,e,!(this.cursor_scanline_start&32)&&t<e)};de.prototype.port3C0_write=function(e){if(this.attribute_controller_index===-1)A(e),this.attribute_controller_index=e&31,A(this.attribute_controller_index),this.palette_source!==(e&32)&&(this.palette_source=e&32,this.update_layers());else{if(16>this.attribute_controller_index)A(this.attribute_controller_index),A(e),this.dac_map[this.attribute_controller_index]=e,this.attribute_mode&64||this.complete_redraw();else switch(this.attribute_controller_index){case 16:if(A(e),this.attribute_mode!==e){var t=this.attribute_mode;this.attribute_mode=e;const i=(e&1)!==0;this.svga_enabled||this.graphical_mode===i||(this.graphical_mode=i,this.screen.set_mode(this.graphical_mode)),(t^e)&64&&this.complete_replot(),this.update_vga_size(),this.complete_redraw(),this.set_font_bitmap(!1)}break;case 18:A(e),this.color_plane_enable!==e&&(this.color_plane_enable=e,this.complete_redraw());break;case 19:A(e),this.horizontal_panning!==e&&(this.horizontal_panning=e&15,this.update_layers());break;case 20:A(e),this.color_select!==e&&(this.color_select=e,this.complete_redraw());break;default:A(this.attribute_controller_index),A(e)}this.attribute_controller_index=-1}};de.prototype.port3C0_read=function(){return(this.attribute_controller_index|this.palette_source)&255};de.prototype.port3C0_read16=function(){return this.port3C0_read()|this.port3C1_read()<<8&65280};de.prototype.port3C1_read=function(){if(16>this.attribute_controller_index)return A(this.attribute_controller_index),A(this.dac_map[this.attribute_controller_index]),this.dac_map[this.attribute_controller_index]&255;switch(this.attribute_controller_index){case 16:return A(this.attribute_mode),this.attribute_mode;case 18:return A(this.color_plane_enable),this.color_plane_enable;case 19:return A(this.horizontal_panning),this.horizontal_panning;case 20:return A(this.color_select),this.color_select;default:A(this.attribute_controller_index)}return 255};de.prototype.port3C2_write=function(e){A(e),this.miscellaneous_output_register=e};de.prototype.port3C4_write=function(e){this.sequencer_index=e};de.prototype.port3C4_read=function(){return this.sequencer_index};de.prototype.port3C5_write=function(e){switch(this.sequencer_index){case 1:A(e);var t=this.clocking_mode;this.clocking_mode=e,(t^e)&32&&this.update_layers(),this.set_font_bitmap(!1);break;case 2:A(e),t=this.plane_write_bm,this.plane_write_bm=e,this.graphical_mode||!(t&4)||this.plane_write_bm&4||this.set_font_bitmap(!0);break;case 3:A(e),t=this.character_map_select,this.character_map_select=e,this.graphical_mode||t===e||this.set_font_page();break;case 4:A(e),this.sequencer_memory_mode=e;break;default:A(this.sequencer_index),A(e)}};de.prototype.port3C5_read=function(){switch(A(this.sequencer_index),this.sequencer_index){case 1:return this.clocking_mode;case 2:return this.plane_write_bm;case 3:return this.character_map_select;case 4:return this.sequencer_memory_mode;case 6:return 18}return 0};de.prototype.port3C6_write=function(e){this.dac_mask!==e&&(this.dac_mask=e,this.complete_redraw())};de.prototype.port3C6_read=function(){return this.dac_mask};de.prototype.port3C7_write=function(e){A(e),this.dac_color_index_read=3*e,this.dac_state&=0};de.prototype.port3C7_read=function(){return this.dac_state};de.prototype.port3C8_write=function(e){this.dac_color_index_write=3*e,this.dac_state|=3};de.prototype.port3C8_read=function(){return this.dac_color_index_write/3&255};de.prototype.port3C9_write=function(e){var t=this.dac_color_index_write/3|0,i=this.dac_color_index_write%3,s=this.vga256_palette[t];if((this.dispi_enable_value&32)===0){e&=63;const n=e&1;e=e<<2|n<<1|n}i===0?s=s&-16711681|e<<16:i===1?s=s&-65281|e<<8:(s=s&-256|e,A(t),A(s)),this.vga256_palette[t]!==s&&(this.vga256_palette[t]=s,this.complete_redraw()),this.dac_color_index_write++};de.prototype.port3C9_read=function(){var e=this.vga256_palette[this.dac_color_index_read/3|0]>>8*(2-this.dac_color_index_read%3)&255;return this.dac_color_index_read++,this.dispi_enable_value&32?e:e>>2};de.prototype.port3CC_read=function(){return this.miscellaneous_output_register};de.prototype.port3CE_write=function(e){this.graphics_index=e};de.prototype.port3CE_read=function(){return this.graphics_index};de.prototype.port3CF_write=function(e){switch(this.graphics_index){case 0:this.planar_setreset=e,A(e);break;case 1:this.planar_setreset_enable=e,A(e);break;case 2:this.color_compare=e,A(e);break;case 3:this.planar_rotate_reg=e,A(e);break;case 4:this.plane_read=e,A(e);break;case 5:var t=this.planar_mode;this.planar_mode=e,A(e),(t^e)&96&&this.complete_replot();break;case 6:A(e),this.miscellaneous_graphics_register!==e&&(this.miscellaneous_graphics_register=e,this.update_vga_size());break;case 7:this.color_dont_care=e,A(e);break;case 8:this.planar_bitmap=e,A(e);break;default:A(this.graphics_index),A(e)}};de.prototype.port3CF_read=function(){switch(A(this.graphics_index),this.graphics_index){case 0:return this.planar_setreset;case 1:return this.planar_setreset_enable;case 2:return this.color_compare;case 3:return this.planar_rotate_reg;case 4:return this.plane_read;case 5:return this.planar_mode;case 6:return this.miscellaneous_graphics_register;case 7:return this.color_dont_care;case 8:return this.planar_bitmap}return 0};de.prototype.port3D4_write=function(e){this.index_crtc=e};de.prototype.port3D4_write16=function(e){this.port3D4_write(e&255),this.port3D5_write(e>>8&255)};de.prototype.port3D4_read=function(){return this.index_crtc};de.prototype.port3D5_write=function(e){switch(this.index_crtc){case 1:A(e),this.horizontal_display_enable_end!==e&&(this.horizontal_display_enable_end=e,this.update_vga_size());break;case 2:this.horizontal_blank_start!==e&&(this.horizontal_blank_start=e,this.update_vga_size());break;case 7:A(e);var t=this.vertical_display_enable_end;this.vertical_display_enable_end&=255,this.vertical_display_enable_end=this.vertical_display_enable_end|e<<3&512|e<<7&256,t!==this.vertical_display_enable_end&&this.update_vga_size(),this.line_compare=this.line_compare&767|e<<4&256,t=this.vertical_blank_start,this.vertical_blank_start=this.vertical_blank_start&767|e<<5&256,t!==this.vertical_blank_start&&this.update_vga_size(),this.update_layers();break;case 8:A(e),this.preset_row_scan=e,this.update_layers();break;case 9:A(e);var i=this.max_scan_line;this.max_scan_line=e,this.line_compare=this.line_compare&511|e<<3&512,t=this.vertical_blank_start,this.vertical_blank_start=this.vertical_blank_start&511|e<<4&512,((i^this.max_scan_line)&159||t!==this.vertical_blank_start)&&this.update_vga_size(),this.update_cursor_scanline(),this.update_layers(),this.set_font_bitmap(!1);break;case 10:A(e),this.cursor_scanline_start=e,this.update_cursor_scanline();break;case 11:A(e),this.cursor_scanline_end=e,this.update_cursor_scanline();break;case 12:(this.start_address>>8&255)!==e&&(this.start_address=this.start_address&255|e<<8,this.update_layers(),~this.crtc_mode&3&&this.complete_replot()),A(e),A(this.start_address,4);break;case 13:(this.start_address&255)!==e&&(this.start_address=this.start_address&65280|e,this.update_layers(),~this.crtc_mode&3&&this.complete_replot()),A(e),A(this.start_address,4);break;case 14:A(e),this.cursor_address=this.cursor_address&255|e<<8,this.update_cursor();break;case 15:A(e),this.cursor_address=this.cursor_address&65280|e,this.update_cursor();break;case 18:A(e),(this.vertical_display_enable_end&255)!==e&&(this.vertical_display_enable_end=this.vertical_display_enable_end&768|e,this.update_vga_size());break;case 19:A(e),this.offset_register!==e&&(this.offset_register=e,this.update_vga_size(),~this.crtc_mode&3&&this.complete_replot());break;case 20:A(e),this.underline_location_register!==e&&(t=this.underline_location_register,this.underline_location_register=e,this.update_vga_size(),(t^e)&64&&this.complete_replot());break;case 21:A(e),(this.vertical_blank_start&255)!==e&&(this.vertical_blank_start=this.vertical_blank_start&768|e,this.update_vga_size());break;case 23:A(e),this.crtc_mode!==e&&(t=this.crtc_mode,this.crtc_mode=e,this.update_vga_size(),(t^e)&67&&this.complete_replot());break;case 24:A(e),this.line_compare=this.line_compare&768|e,this.update_layers();break;default:this.index_crtc<this.crtc.length&&(this.crtc[this.index_crtc]=e),A(this.index_crtc),A(e)}};de.prototype.port3D5_write16=function(e){A(e,4),this.port3D5_write(e&255)};de.prototype.port3D5_read=function(){switch(A(this.index_crtc),this.index_crtc){case 1:return this.horizontal_display_enable_end;case 2:return this.horizontal_blank_start;case 7:return this.vertical_display_enable_end>>7&2|this.vertical_blank_start>>5&8|this.line_compare>>4&16|this.vertical_display_enable_end>>3&64;case 8:return this.preset_row_scan;case 9:return this.max_scan_line;case 10:return this.cursor_scanline_start;case 11:return this.cursor_scanline_end;case 12:return this.start_address&255;case 13:return this.start_address>>8;case 14:return this.cursor_address>>8;case 15:return this.cursor_address&255;case 18:return this.vertical_display_enable_end&255;case 19:return this.offset_register;case 20:return this.underline_location_register;case 21:return this.vertical_blank_start&255;case 23:return this.crtc_mode;case 24:return this.line_compare&255}return this.index_crtc<this.crtc.length?this.crtc[this.index_crtc]:0};de.prototype.port3D5_read16=function(){return this.port3D5_read()};de.prototype.port3DA_read=function(){var e=this.port_3DA_value;return this.graphical_mode?(this.port_3DA_value^=1,this.port_3DA_value&=1):(this.port_3DA_value&1&&(this.port_3DA_value^=8),this.port_3DA_value^=1),this.attribute_controller_index=-1,e};de.prototype.port1CE_write=function(e){this.dispi_index=e};de.prototype.port1CF_write=function(e){A(this.dispi_index),A(e);const t=this.svga_enabled;switch(this.dispi_index){case 0:45248<=e&&45253>=e?this.svga_version=e:A(e);break;case 1:this.svga_width=e,2560<this.svga_width&&(this.svga_width=2560);break;case 2:this.svga_height=e,1600<this.svga_height&&(this.svga_height=1600);break;case 3:this.svga_bpp=e;break;case 4:(this.svga_enabled=(e&1)===1)&&(e&128)===0&&this.svga_memory.fill(0),this.dispi_enable_value=e;break;case 5:A(e<<16),this.svga_bank_offset=e<<16;break;case 8:A(e),this.svga_offset_x!==e&&(this.svga_offset_x=e,this.svga_offset=this.svga_offset_y*this.svga_width+this.svga_offset_x,this.complete_redraw());break;case 9:A(e*this.svga_width),A(e),this.svga_offset_y!==e&&(this.svga_offset_y=e,this.svga_offset=this.svga_offset_y*this.svga_width+this.svga_offset_x,this.complete_redraw());break;default:A(this.dispi_index)}!this.svga_enabled||this.svga_width&&this.svga_height||(this.svga_enabled=!1),this.svga_enabled&&!t&&(this.svga_offset_y=this.svga_offset_x=this.svga_offset=0,this.graphical_mode=!0,this.screen.set_mode(this.graphical_mode),this.set_size_graphical(this.svga_width,this.svga_height,this.svga_width,this.svga_height,this.svga_bpp)),t&&!this.svga_enabled&&(this.graphical_mode=e=(this.attribute_mode&1)!==0,this.screen.set_mode(e),this.update_vga_size(),this.set_font_bitmap(!1),this.complete_redraw()),this.svga_enabled||(this.svga_bank_offset=0),this.update_layers()};de.prototype.port1CF_read=function(){return A(this.dispi_index),this.svga_register_read(this.dispi_index)};de.prototype.svga_register_read=function(e){switch(e){case 0:return this.svga_version;case 1:return this.dispi_enable_value&2?2560:this.svga_width;case 2:return this.dispi_enable_value&2?1600:this.svga_height;case 3:return this.dispi_enable_value&2?32:this.svga_bpp;case 4:return this.dispi_enable_value;case 5:return this.svga_bank_offset>>>16;case 6:return this.screen_width?this.screen_width:1;case 8:return this.svga_offset_x;case 9:return this.svga_offset_y;case 10:return this.vga_memory_size/65536|0;default:A(this.dispi_index)}return 255};de.prototype.vga_replot=function(){for(var e=this.diff_plot_min&-16,t=Math.min(this.diff_plot_max|15,524287),i=this.vga_addr_shift_count(),s=~this.crtc_mode&3,n=this.planar_mode&96,o=this.attribute_mode&64;e<=t;){var c=e>>>i;if(s){var r=e/this.virtual_width|0,a=e-this.virtual_width*r;switch(s){case 1:c=(r&1)<<13,r>>>=1;break;case 2:c=(r&1)<<14,r>>>=1;break;case 3:c=(r&3)<<13,r>>>=2}c|=(r*this.virtual_width+a>>>i)+this.start_address}r=this.plane0[c],a=this.plane1[c];var u=this.plane2[c],_=this.plane3[c];switch(c=new Uint8Array(8),n){case 0:r<<=0,a<<=1,u<<=2,_<<=3;for(var l=7;0<=l;l--)c[7-l]=r>>l&1|a>>l&2|u>>l&4|_>>l&8;break;case 32:c[0]=r>>6&3|u>>4&12,c[1]=r>>4&3|u>>2&12,c[2]=r>>2&3|u>>0&12,c[3]=r>>0&3|u<<2&12,c[4]=a>>6&3|_>>4&12,c[5]=a>>4&3|_>>2&12,c[6]=a>>2&3|_>>0&12,c[7]=a>>0&3|_<<2&12;break;case 64:case 96:c[0]=r>>4&15,c[1]=r>>0&15,c[2]=a>>4&15,c[3]=a>>0&15,c[4]=u>>4&15,c[5]=u>>0&15,c[6]=_>>4&15,c[7]=_>>0&15}if(o)for(r=l=0;4>l;l++,e++,r+=2)this.pixel_buffer[e]=c[r]<<4|c[r+1];else for(l=0;8>l;l++,e++)this.pixel_buffer[e]=c[l]}};de.prototype.vga_redraw=function(){var e=this.diff_addr_min,t=Math.min(this.diff_addr_max,524287);const i=new Int32Array(this.cpu.wasm_memory.buffer,this.dest_buffet_offset,this.virtual_width*this.virtual_height);var s=255,n=0;if(this.attribute_mode&128&&(s&=207,n|=this.color_select<<4&48),this.attribute_mode&64)for(;e<=t;e++){var o=this.pixel_buffer[e]&s|n;o=this.vga256_palette[o],i[e]=o&65280|o<<16|o>>16|4278190080}else for(s&=63,n|=this.color_select<<4&192;e<=t;e++)o=this.dac_map[this.pixel_buffer[e]&this.color_plane_enable]&s|n,o=this.vga256_palette[o],i[e]=o&65280|o<<16|o>>16|4278190080};de.prototype.screen_fill_buffer=function(){if(this.graphical_mode){if(this.image_data.data.byteLength===0){var e=new Uint8ClampedArray(this.cpu.wasm_memory.buffer,this.dest_buffet_offset,4*this.virtual_width*this.virtual_height);this.image_data=new ImageData(e,this.virtual_width,this.virtual_height),this.update_layers()}if(this.svga_enabled){e=0;let s=this.svga_height;if(this.svga_bpp===8){const n=new Int32Array(this.cpu.wasm_memory.buffer,this.dest_buffet_offset,this.screen_width*this.screen_height),o=new Uint8Array(this.cpu.wasm_memory.buffer,this.svga_memory.byteOffset,this.vga_memory_size);for(var t=0;t<n.length;t++){var i=this.vga256_palette[o[t]];n[t]=i&65280|i<<16|i>>16|4278190080}}else this.cpu.svga_fill_pixel_buffer(this.svga_bpp,this.svga_offset),t=this.svga_bpp===15?2:this.svga_bpp/8,e=((this.cpu.svga_dirty_bitmap_min_offset[0]/t|0)-this.svga_offset)/this.svga_width|0,s=(((this.cpu.svga_dirty_bitmap_max_offset[0]/t|0)-this.svga_offset)/this.svga_width|0)+1;e<s&&(e=Math.max(e,0),s=Math.min(s,this.svga_height),this.screen.update_buffer([{image_data:this.image_data,screen_x:0,screen_y:e,buffer_x:0,buffer_y:e,buffer_width:this.svga_width,buffer_height:s-e}]))}else this.vga_replot(),this.vga_redraw(),this.screen.update_buffer(this.layers);this.reset_diffs()}this.update_vertical_retrace()};de.prototype.set_font_bitmap=function(e){const t=this.max_scan_line&31;if(t&&!this.graphical_mode){const i=!!(this.clocking_mode&8);this.screen.set_font_bitmap(t+1,!i&&!(this.clocking_mode&1),i,!!(this.attribute_mode&4),this.plane2,e)}};de.prototype.set_font_page=function(){const e=[0,2,4,6,1,3,5,7],t=(this.character_map_select&12)>>2|(this.character_map_select&32)>>3,i=this.character_map_select&3|(this.character_map_select&16)>>2;this.font_page_ab_enabled=t!==i,this.screen.set_font_page(e[t],e[i]),this.complete_redraw()};const gm="SWAP_IN SWAP_OUT MAJFLT MINFLT MEMFREE MEMTOT AVAIL CACHES HTLB_PGALLOC HTLB_PGFAIL".split(" ");function Ti(e,t){this.bus=t,this.zeroed=this.fp_cmd=this.actual=this.num_pages=0,this.virtio=new _t(e,{name:"virtio-balloon",pci_id:88,device_id:4165,subsystem_device_id:5,common:{initial_port:55296,queues:[{size_supported:32,notify_offset:0},{size_supported:32,notify_offset:0},{size_supported:2,notify_offset:1},{size_supported:64,notify_offset:2}],features:[1,3,32],on_driver_ok:()=>{}},notification:{initial_port:55552,single_handler:!1,handlers:[i=>{const s=this.virtio.queues[i];for(;s.has_request();){var n=s.pop_request();const o=new Uint8Array(n.length_readable);n.get_next_blob(o),this.virtio.queues[i].push_reply(n),n=o.byteLength/4,this.actual+=i===0?n:-n}this.virtio.queues[i].flush_replies()},i=>{var s=this.virtio.queues[i];if(s.has_request()){s=s.pop_request();const n=new Uint8Array(s.length_readable);s.get_next_blob(n);let o={};for(let c=0;c<s.length_readable;c+=10){let[r,a]=Ie(["h","d"],n,{offset:c});o[gm[r]]=a}this.virtio.queues[i].push_reply(s),this.stats_cb&&this.stats_cb(o)}},i=>{const s=this.virtio.queues[i];for(;s.has_request();){const o=s.pop_request();if(0<o.length_readable){var n=new Uint8Array(o.length_readable);o.get_next_blob(n),[n]=Ie(["w"],n,{offset:0}),n===0&&(this.free_cb&&this.free_cb(this.zeroed),1<this.fp_cmd&&(this.fp_cmd=1),this.virtio.notify_config_changes())}if(0<o.length_writable)for(n=0;n<o.write_buffers.length;++n){let c=o.write_buffers[n];this.zeroed+=c.len,this.virtio.cpu.zero_memory(c.addr_low,c.len)}this.virtio.queues[i].push_reply(o)}this.virtio.queues[i].flush_replies()}]},isr_status:{initial_port:55040},device_specific:{initial_port:54784,struct:[{bytes:4,name:"num_pages",read:()=>this.num_pages,write:()=>{}},{bytes:4,name:"actual",read:()=>this.actual,write:()=>{}},{bytes:4,name:"free_page_hint_cmd_id",read:()=>this.fp_cmd,write:()=>{}}]}})}Ti.prototype.Inflate=function(e){this.num_pages+=e,this.virtio.notify_config_changes()};Ti.prototype.Deflate=function(e){this.num_pages-=e,this.virtio.notify_config_changes()};Ti.prototype.Cleanup=function(e){this.fp_cmd=2,this.free_cb=e,this.zeroed=0,this.virtio.notify_config_changes()};Ti.prototype.get_state=function(){const e=[];return e[0]=this.virtio,e[1]=this.num_pages,e[2]=this.actual,e};Ti.prototype.set_state=function(e){this.virtio.set_state(e[0]),this.num_pages=e[1],this.actual=e[2]};Ti.prototype.GetStats=function(e){for(this.stats_cb=e,e=this.virtio.queues[2];e.has_request();){const t=e.pop_request();this.virtio.queues[2].push_reply(t)}this.virtio.queues[2].flush_replies()};Ti.prototype.Reset=function(){};function vm(e,t,i,s){var n=new Uint8Array(t);const o=new Uint16Array(t);var c=new Uint32Array(t),r=n[497]||4,a=o[255];if(a!==43605)A(a);else if(a=o[257]|o[258]<<16,a!==1400005704)A(a);else{a=o[259];var u=n[529],_=o[283],l=c[139],m=c[140],g=n[565],C=518<=a?c[142]:255,y=c[146],h=c[147],f=c[150],d=c[151],p=c[152];for(A(a),A(u),A(_),A(c[133]),A(l),A(m),A(g),A(C),A(y),A(h),A(d),A(f),A(p),n[528]=255,n[529]=u&-97|128,o[274]=56832,o[253]=65535,A(56832),s+="\0",A(581632),c[138]=581632,n=0;n<s.length;n++)e[581632+n]=s.charCodeAt(n);for(r=512*(r+1),A(r),s=new Uint8Array(t,0,r),t=new Uint8Array(t,r),n=r=0,i&&(r=67108864,n=i.byteLength,e.set(new Uint8Array(i),r)),c[134]=r,c[135]=n,e.set(s,524288),e.set(t,1048576),e=new Uint8Array(512),new Uint16Array(e.buffer)[0]=43605,e[2]=1,i=3,e[i++]=250,e[i++]=184,e[i++]=32768,e[i++]=128,e[i++]=142,e[i++]=192,e[i++]=142,e[i++]=216,e[i++]=142,e[i++]=224,e[i++]=142,e[i++]=232,e[i++]=142,e[i++]=208,e[i++]=188,e[i++]=57344,e[i++]=224,e[i++]=234,e[i++]=0,e[i++]=0,e[i++]=32800,e[i++]=128,c=e[i]=0,t=0;t<e.length;t++)c+=e[t];return e[i]=-c,{name:"genroms/kernel.bin",data:e}}}function we(e,t,i){this.stop_idling=i,this.wm=t,this.wasm_patch(),this.create_jit_imports(),this.wasm_memory=t=this.wm.exports.memory,this.memory_size=be(Uint32Array,t,812,1),this.mem8=new Uint8Array(0),this.mem32s=new Int32Array(this.mem8.buffer),this.segment_is_null=be(Uint8Array,t,724,8),this.segment_offsets=be(Int32Array,t,736,8),this.segment_limits=be(Uint32Array,t,768,8),this.segment_access_bytes=be(Uint8Array,t,512,8),this.protected_mode=be(Int32Array,t,800,1),this.idtr_size=be(Int32Array,t,564,1),this.idtr_offset=be(Int32Array,t,568,1),this.gdtr_size=be(Int32Array,t,572,1),this.gdtr_offset=be(Int32Array,t,576,1),this.tss_size_32=be(Int32Array,t,1128,1),this.page_fault=be(Uint32Array,t,540,8),this.cr=be(Int32Array,t,580,8),this.cpl=be(Uint8Array,t,612,1),this.is_32=be(Int32Array,t,804,1),this.stack_size_32=be(Int32Array,t,808,1),this.in_hlt=be(Uint8Array,t,616,1),this.last_virt_eip=be(Int32Array,t,620,1),this.eip_phys=be(Int32Array,t,624,1),this.sysenter_cs=be(Int32Array,t,636,1),this.sysenter_esp=be(Int32Array,t,640,1),this.sysenter_eip=be(Int32Array,t,644,1),this.prefixes=be(Int32Array,t,648,1),this.flags=be(Int32Array,t,120,1),this.flags_changed=be(Int32Array,t,100,1),this.last_op_size=be(Int32Array,t,96,1),this.last_op1=be(Int32Array,t,104,1),this.last_result=be(Int32Array,t,112,1),this.current_tsc=be(Uint32Array,t,960,2),this.devices={},this.instruction_pointer=be(Int32Array,t,556,1),this.previous_ip=be(Int32Array,t,560,1),this.apic_enabled=be(Uint8Array,t,548,1),this.acpi_enabled=be(Uint8Array,t,552,1),this.memory_map_read8=[],this.memory_map_write8=[],this.memory_map_read32=[],this.memory_map_write32=[],this.bios={main:null,vga:null},this.instruction_counter=be(Uint32Array,t,664,1),this.reg32=be(Int32Array,t,64,8),this.fpu_st=be(Int32Array,t,1152,32),this.fpu_stack_empty=be(Uint8Array,t,816,1),this.fpu_stack_empty[0]=255,this.fpu_stack_ptr=be(Uint8Array,t,1032,1),this.fpu_stack_ptr[0]=0,this.fpu_control_word=be(Uint16Array,t,1036,1),this.fpu_control_word[0]=895,this.fpu_status_word=be(Uint16Array,t,1040,1),this.fpu_status_word[0]=0,this.fpu_ip=be(Int32Array,t,1048,1),this.fpu_ip[0]=0,this.fpu_ip_selector=be(Int32Array,t,1052,1),this.fpu_ip_selector[0]=0,this.fpu_opcode=be(Int32Array,t,1044,1),this.fpu_opcode[0]=0,this.fpu_dp=be(Int32Array,t,1056,1),this.fpu_dp[0]=0,this.fpu_dp_selector=be(Int32Array,t,1060,1),this.fpu_dp_selector[0]=0,this.reg_xmm32s=be(Int32Array,t,832,32),this.mxcsr=be(Int32Array,t,824,1),this.sreg=be(Uint16Array,t,668,8),this.dreg=be(Int32Array,t,684,8),this.reg_pdpte=be(Int32Array,t,968,8),this.svga_dirty_bitmap_min_offset=be(Uint32Array,t,716,1),this.svga_dirty_bitmap_max_offset=be(Uint32Array,t,720,1),this.fw_value=[],this.fw_pointer=0,this.option_roms=[],this.io=void 0,this.bus=e,this.set_tsc(0,0)}we.prototype.mmap_read8=function(e){return this.memory_map_read8[e>>>17](e)};we.prototype.mmap_write8=function(e,t){this.memory_map_write8[e>>>17](e,t)};we.prototype.mmap_read16=function(e){var t=this.memory_map_read8[e>>>17];return t(e)|t(e+1|0)<<8};we.prototype.mmap_write16=function(e,t){var i=this.memory_map_write8[e>>>17];i(e,t&255),i(e+1|0,t>>8)};we.prototype.mmap_read32=function(e){return this.memory_map_read32[e>>>17](e)};we.prototype.mmap_write32=function(e,t){this.memory_map_write32[e>>>17](e,t)};we.prototype.mmap_write64=function(e,t,i){var s=this.memory_map_write32[e>>>17];s(e,t),s(e+4,i)};we.prototype.mmap_write128=function(e,t,i,s,n){var o=this.memory_map_write32[e>>>17];o(e,t),o(e+4,i),o(e+8,s),o(e+12,n)};we.prototype.write_blob=function(e,t){e.length&&(this.in_mapped_range(t),this.in_mapped_range(t+e.length-1),this.jit_dirty_cache(t,t+e.length),this.mem8.set(e,t))};we.prototype.read_blob=function(e,t){return t&&(this.in_mapped_range(e),this.in_mapped_range(e+t-1)),this.mem8.subarray(e,e+t)};we.prototype.clear_opstats=function(){new Uint8Array(this.wasm_memory.buffer,32768,131072).fill(0),this.wm.exports.profiler_init()};we.prototype.create_jit_imports=function(){const e=Object.create(null);e.m=this.wm.exports.memory;for(const t of Object.keys(this.wm.exports))t.startsWith("_")||t.startsWith("zstd")||t.endsWith("_js")||(e[t]=this.wm.exports[t]);this.jit_imports=e};we.prototype.wasm_patch=function(){const e=i=>this.wm.exports[i],t=i=>{const s=e(i);return console.assert(s,"Missing import: "+i),s};this.reset_cpu=t("reset_cpu"),this.getiopl=t("getiopl"),this.get_eflags=t("get_eflags"),this.handle_irqs=t("handle_irqs"),this.main_loop=t("main_loop"),this.set_jit_config=t("set_jit_config"),this.read8=t("read8"),this.read16=t("read16"),this.read32s=t("read32s"),this.write8=t("write8"),this.write16=t("write16"),this.write32=t("write32"),this.in_mapped_range=t("in_mapped_range"),this.fpu_load_tag_word=t("fpu_load_tag_word"),this.fpu_load_status_word=t("fpu_load_status_word"),this.fpu_get_sti_f64=t("fpu_get_sti_f64"),this.translate_address_system_read=t("translate_address_system_read_js"),this.get_seg_cs=t("get_seg_cs"),this.get_real_eip=t("get_real_eip"),this.clear_tlb=t("clear_tlb"),this.full_clear_tlb=t("full_clear_tlb"),this.update_state_flags=t("update_state_flags"),this.set_tsc=t("set_tsc"),this.store_current_tsc=t("store_current_tsc"),this.set_cpuid_level=t("set_cpuid_level"),this.device_raise_irq=t("device_raise_irq"),this.device_lower_irq=t("device_lower_irq"),this.apic_timer=t("apic_timer"),this.jit_clear_cache=t("jit_clear_cache_js"),this.jit_dirty_cache=t("jit_dirty_cache"),this.codegen_finalize_finished=t("codegen_finalize_finished"),this.allocate_memory=t("allocate_memory"),this.zero_memory=t("zero_memory"),this.is_memory_zeroed=t("is_memory_zeroed"),this.svga_allocate_memory=t("svga_allocate_memory"),this.svga_allocate_dest_buffer=t("svga_allocate_dest_buffer"),this.svga_fill_pixel_buffer=t("svga_fill_pixel_buffer"),this.svga_mark_dirty=t("svga_mark_dirty"),this.get_pic_addr_master=t("get_pic_addr_master"),this.get_pic_addr_slave=t("get_pic_addr_slave"),this.get_apic_addr=t("get_apic_addr"),this.get_ioapic_addr=t("get_ioapic_addr"),this.zstd_create_ctx=t("zstd_create_ctx"),this.zstd_get_src_ptr=t("zstd_get_src_ptr"),this.zstd_free_ctx=t("zstd_free_ctx"),this.zstd_read=t("zstd_read"),this.zstd_read_free=t("zstd_read_free")};we.prototype.jit_force_generate=function(e){this.jit_force_generate_unsafe&&this.jit_force_generate_unsafe(e)};we.prototype.jit_clear_func=function(e){this.wm.wasm_table.set(e+1024,null)};we.prototype.jit_clear_all_funcs=function(){const e=this.wm.wasm_table;for(let t=0;900>t;t++)e.set(1024+t,null)};we.prototype.get_state=function(){var e=[];e[0]=this.memory_size[0],e[1]=new Uint8Array([...this.segment_is_null,...this.segment_access_bytes]),e[2]=this.segment_offsets,e[3]=this.segment_limits,e[4]=this.protected_mode[0],e[5]=this.idtr_offset[0],e[6]=this.idtr_size[0],e[7]=this.gdtr_offset[0],e[8]=this.gdtr_size[0],e[9]=this.page_fault[0],e[10]=this.cr,e[11]=this.cpl[0],e[13]=this.is_32[0],e[16]=this.stack_size_32[0],e[17]=this.in_hlt[0],e[18]=this.last_virt_eip[0],e[19]=this.eip_phys[0],e[22]=this.sysenter_cs[0],e[23]=this.sysenter_eip[0],e[24]=this.sysenter_esp[0],e[25]=this.prefixes[0],e[26]=this.flags[0],e[27]=this.flags_changed[0],e[28]=this.last_op1[0],e[30]=this.last_op_size[0],e[37]=this.instruction_pointer[0],e[38]=this.previous_ip[0],e[39]=this.reg32,e[40]=this.sreg,e[41]=this.dreg,e[42]=this.reg_pdpte,this.store_current_tsc(),e[43]=this.current_tsc,e[45]=this.devices.virtio_9p,e[46]=this.get_state_apic(),e[47]=this.devices.rtc,e[48]=this.devices.pci,e[49]=this.devices.dma,e[50]=this.devices.acpi,e[52]=this.devices.vga,e[53]=this.devices.ps2,e[54]=this.devices.uart0,e[55]=this.devices.fdc,this.devices.ide.secondary?e[85]=this.devices.ide:this.devices.ide.primary?.master.is_atapi?e[56]=this.devices.ide.primary:e[57]=this.devices.ide.primary,e[58]=this.devices.pit,e[59]=this.devices.net,e[60]=this.get_state_pic(),e[61]=this.devices.sb16,e[62]=this.fw_value,e[63]=this.get_state_ioapic(),e[64]=this.tss_size_32[0],e[66]=this.reg_xmm32s,e[67]=this.fpu_st,e[68]=this.fpu_stack_empty[0],e[69]=this.fpu_stack_ptr[0],e[70]=this.fpu_control_word[0],e[71]=this.fpu_ip[0],e[72]=this.fpu_ip_selector[0],e[73]=this.fpu_dp[0],e[74]=this.fpu_dp_selector[0],e[75]=this.fpu_opcode[0];const{packed_memory:t,bitmap:i}=this.pack_memory();return e[77]=t,e[78]=new Uint8Array(i.get_buffer()),e[79]=this.devices.uart1,e[80]=this.devices.uart2,e[81]=this.devices.uart3,e[82]=this.devices.virtio_console,e[83]=this.devices.virtio_net,e[84]=this.devices.virtio_balloon,e};we.prototype.get_state_pic=function(){const e=new Uint8Array(this.wasm_memory.buffer,this.get_pic_addr_master(),13),t=new Uint8Array(this.wasm_memory.buffer,this.get_pic_addr_slave(),13),i=[],s=[];return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[4]=e[4],i[5]=s,i[6]=e[6],i[7]=e[7],i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=e[12],s[0]=t[0],s[1]=t[1],s[2]=t[2],s[3]=t[3],s[4]=t[4],s[5]=null,s[6]=t[6],s[7]=t[7],s[8]=t[8],s[9]=t[9],s[10]=t[10],s[11]=t[11],s[12]=t[12],i};we.prototype.get_state_apic=function(){return new Uint8Array(this.wasm_memory.buffer,this.get_apic_addr(),184)};we.prototype.get_state_ioapic=function(){return new Uint8Array(this.wasm_memory.buffer,this.get_ioapic_addr(),208)};we.prototype.set_state=function(e){if(this.memory_size[0]=e[0],this.mem8.length!==this.memory_size[0]&&console.warn("Note: Memory size mismatch. we="+this.mem8.length+" state="+this.memory_size[0]),e[1].length===8?(this.segment_is_null.set(e[1]),this.segment_access_bytes.fill(242),this.segment_access_bytes[1]=250):e[1].length===16&&(this.segment_is_null.set(e[1].subarray(0,8)),this.segment_access_bytes.set(e[1].subarray(8,16))),this.segment_offsets.set(e[2]),this.segment_limits.set(e[3]),this.protected_mode[0]=e[4],this.idtr_offset[0]=e[5],this.idtr_size[0]=e[6],this.gdtr_offset[0]=e[7],this.gdtr_size[0]=e[8],this.page_fault[0]=e[9],this.cr.set(e[10]),this.cpl[0]=e[11],this.is_32[0]=e[13],this.stack_size_32[0]=e[16],this.in_hlt[0]=e[17],this.last_virt_eip[0]=e[18],this.eip_phys[0]=e[19],this.sysenter_cs[0]=e[22],this.sysenter_eip[0]=e[23],this.sysenter_esp[0]=e[24],this.prefixes[0]=e[25],this.flags[0]=e[26],this.flags_changed[0]=e[27],this.last_op1[0]=e[28],this.last_op_size[0]=e[30],this.instruction_pointer[0]=e[37],this.previous_ip[0]=e[38],this.reg32.set(e[39]),this.sreg.set(e[40]),this.dreg.set(e[41]),e[42]&&this.reg_pdpte.set(e[42]),this.set_tsc(e[43][0],e[43][1]),this.devices.virtio_9p&&this.devices.virtio_9p.set_state(e[45]),e[46]&&this.set_state_apic(e[46]),this.devices.rtc&&this.devices.rtc.set_state(e[47]),this.devices.dma&&this.devices.dma.set_state(e[49]),this.devices.acpi&&this.devices.acpi.set_state(e[50]),this.devices.vga&&this.devices.vga.set_state(e[52]),this.devices.ps2&&this.devices.ps2.set_state(e[53]),this.devices.uart0&&this.devices.uart0.set_state(e[54]),this.devices.fdc&&this.devices.fdc.set_state(e[55]),e[56]||e[57]){var t=[[void 0,void 0],[void 0,void 0]];t[0][0]=e[56]?{is_cdrom:!0,buffer:this.devices.cdrom.buffer}:{is_cdrom:!1,buffer:this.devices.ide.primary.master.buffer},this.devices.ide=new wr(this,this.devices.ide.bus,t),this.devices.cdrom=e[56]?this.devices.ide.primary.master:void 0,this.devices.ide.primary.set_state(e[56]||e[57])}else e[85]&&this.devices.ide.set_state(e[85]);this.devices.pci&&this.devices.pci.set_state(e[48]),this.devices.pit&&this.devices.pit.set_state(e[58]),this.devices.net&&this.devices.net.set_state(e[59]),this.set_state_pic(e[60]),this.devices.sb16&&this.devices.sb16.set_state(e[61]),this.devices.uart1&&this.devices.uart1.set_state(e[79]),this.devices.uart2&&this.devices.uart2.set_state(e[80]),this.devices.uart3&&this.devices.uart3.set_state(e[81]),this.devices.virtio_console&&this.devices.virtio_console.set_state(e[82]),this.devices.virtio_net&&this.devices.virtio_net.set_state(e[83]),this.devices.virtio_balloon&&this.devices.virtio_balloon.set_state(e[84]),this.fw_value=e[62],e[63]&&this.set_state_ioapic(e[63]),this.tss_size_32[0]=e[64],this.reg_xmm32s.set(e[66]),this.fpu_st.set(e[67]),this.fpu_stack_empty[0]=e[68],this.fpu_stack_ptr[0]=e[69],this.fpu_control_word[0]=e[70],this.fpu_ip[0]=e[71],this.fpu_ip_selector[0]=e[72],this.fpu_dp[0]=e[73],this.fpu_dp_selector[0]=e[74],this.fpu_opcode[0]=e[75],t=new Bs(e[78].buffer),this.unpack_memory(t,e[77]),this.update_state_flags(),this.full_clear_tlb(),this.jit_clear_cache()};we.prototype.set_state_pic=function(e){const t=new Uint8Array(this.wasm_memory.buffer,this.get_pic_addr_master(),13),i=new Uint8Array(this.wasm_memory.buffer,this.get_pic_addr_slave(),13);t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4];const s=e[5];t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],i[0]=s[0],i[1]=s[1],i[2]=s[2],i[3]=s[3],i[4]=s[4],i[6]=s[6],i[7]=s[7],i[8]=s[8],i[9]=s[9],i[10]=s[10],i[11]=s[11],i[12]=s[12]};we.prototype.set_state_apic=function(e){if(e instanceof Array){const t=new Int32Array(this.wasm_memory.buffer,this.get_apic_addr(),46);t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[8]=e[6],t[9]=e[7],t[10]=e[8],t[11]=e[9],t[12]=e[10],t[13]=e[11],t[14]=e[12],t[15]=e[13],t.set(e[15],16),t.set(e[15],24),t.set(e[16],32),t[40]=e[17],t[41]=e[18],t[42]=e[19],t[43]=e[20],t[44]=e[21],t[45]=e[22]||65536}else new Uint8Array(this.wasm_memory.buffer,this.get_apic_addr(),184).set(e)};we.prototype.set_state_ioapic=function(e){if(e instanceof Array){const t=new Int32Array(this.wasm_memory.buffer,this.get_ioapic_addr(),52);t.set(e[0],0),t.set(e[1],24),t[48]=e[2],t[49]=e[3],t[50]=e[4],t[51]=e[5]}else new Uint8Array(this.wasm_memory.buffer,this.get_ioapic_addr(),208).set(e)};we.prototype.pack_memory=function(){for(var e=this.mem8.length>>12,t=[],i=0;i<e;i++)this.is_memory_zeroed(i<<12,4096)||t.push(i);e=new Bs(e),i=new Uint8Array(t.length<<12);for(const[s,n]of t.entries())e.set(n,1),t=n<<12,t=this.mem8.subarray(t,t+4096),i.set(t,s<<12);return{bitmap:e,packed_memory:i}};we.prototype.unpack_memory=function(e,t){this.zero_memory(0,this.memory_size[0]);const i=this.memory_size[0]>>12;let s=0;for(let o=0;o<i;o++)if(e.get(o)){var n=s<<12;n=t.subarray(n,n+4096),this.mem8.set(n,o<<12),s++}};we.prototype.reboot_internal=function(){this.reset_cpu(),this.fw_value=[],this.devices.virtio_9p&&this.devices.virtio_9p.reset(),this.devices.virtio_console&&this.devices.virtio_console.reset(),this.devices.virtio_net&&this.devices.virtio_net.reset(),this.devices.ps2&&this.devices.ps2.reset(),this.load_bios()};we.prototype.reset_memory=function(){this.mem8.fill(0)};we.prototype.create_memory=function(e,t){e<t?e=t:0>(e|0)&&(e=Math.pow(2,31)-131072),e=(e-1|131071)+1|0,console.assert(this.memory_size[0]===0,"Expected uninitialised memory"),this.memory_size[0]=e,t=this.allocate_memory(e),this.mem8=be(Uint8Array,this.wasm_memory,t,e),this.mem32s=be(Uint32Array,this.wasm_memory,t,e>>2)};we.prototype.init=function(e,t){this.create_memory(e.memory_size||67108864,e.initrd?67108864:1048576),e.disable_jit&&this.set_jit_config(0,1),e.cpuid_level&&this.set_cpuid_level(e.cpuid_level),this.acpi_enabled[0]=+e.acpi,this.reset_cpu();var i=new ht(this);if(this.io=i,this.bios.main=e.bios,this.bios.vga=e.vga_bios,this.load_bios(),e.bzimage){const n=vm(this.mem8,e.bzimage,e.initrd,e.cmdline||"");n&&this.option_roms.push(n)}i.register_read(179,this,function(){return 0});var s=0;i.register_read(146,this,function(){return s}),i.register_write(146,this,function(n){s=n}),i.register_read(1297,this,function(){return this.fw_pointer<this.fw_value.length?this.fw_value[this.fw_pointer++]:0}),i.register_write(1296,this,void 0,function(n){function o(a){return new Uint8Array(Int32Array.of(a).buffer)}function c(a){return a>>8|a<<8&65280}function r(a){return a<<24|a<<8&16711680|a>>8&65280|a>>>24}if(""+A(n),this.fw_pointer=0,n===0)this.fw_value=o(1431127377);else if(n===1)this.fw_value=o(0);else if(n===3)this.fw_value=o(this.memory_size[0]);else if(n===5)this.fw_value=o(1);else if(n===15)this.fw_value=o(1);else if(n===13)this.fw_value=new Uint8Array(16);else if(n===25){n=new Int32Array(4+64*this.option_roms.length);const a=new Uint8Array(n.buffer);n[0]=r(this.option_roms.length);for(let u=0;u<this.option_roms.length;u++){const{name:_,data:l}=this.option_roms[u],m=4+64*u;n[m+0>>2]=r(l.length),n[m+4>>2]=c(49152+u);for(let g=0;g<_.length;g++)a[m+8+g]=_.charCodeAt(g)}this.fw_value=a}else 32768<=n&&49152>n?this.fw_value=o(0):49152<=n&&n-49152<this.option_roms.length?this.fw_value=this.option_roms[n-49152].data:(""+A(n),this.fw_value=o(0))}),this.devices={},e.load_devices&&(this.devices.pci=new jt(this),this.acpi_enabled[0]&&(this.devices.acpi=new zs(this)),this.devices.rtc=new Mt(this),this.fill_cmos(this.devices.rtc,e),this.devices.dma=new Qe(this),this.devices.vga=new de(this,t,e.screen,e.vga_memory_size||8388608),this.devices.ps2=new yt(this,t),this.devices.uart0=new Pt(this,1016,t),e.uart1&&(this.devices.uart1=new Pt(this,760,t)),e.uart2&&(this.devices.uart2=new Pt(this,1e3,t)),e.uart3&&(this.devices.uart3=new Pt(this,744,t)),this.devices.fdc=new Re(this,e.fda,e.fdb),i=[[void 0,void 0],[void 0,void 0]],e.hda&&(i[0][0]={buffer:e.hda},i[0][1]={buffer:e.hdb}),i[1][0]={is_cdrom:!0,buffer:e.cdrom},this.devices.ide=new wr(this,t,i),this.devices.cdrom=this.devices.ide.secondary.master,this.devices.pit=new ri(this,t),e.net_device.type==="ne2k"?this.devices.net=new Rt(this,t,e.preserve_mac_from_state_image,e.mac_address_translation):e.net_device.type==="virtio"&&(this.devices.virtio_net=new cs(this,t,e.preserve_mac_from_state_image)),e.fs9p?this.devices.virtio_9p=new ni(e.fs9p,this,t):e.handle9p?this.devices.virtio_9p=new Sr(e.handle9p,this):e.proxy9p&&(this.devices.virtio_9p=new Bt(e.proxy9p,this)),e.virtio_console&&(this.devices.virtio_console=new pi(this,t)),e.virtio_balloon&&(this.devices.virtio_balloon=new Ti(this,t)),this.devices.sb16=new _e(this,t)),e.multiboot&&(e=this.load_multiboot_option_rom(e.multiboot,e.initrd,e.cmdline))&&(this.bios.main?this.option_roms.push(e):this.reg32[0]=this.io.port_read32(244)),this.debug_init()};we.prototype.load_multiboot=function(e){this.load_multiboot_option_rom(e,void 0,"")&&(this.reg32[0]=this.io.port_read32(244))};we.prototype.load_multiboot_option_rom=function(e,t,i){if(8192>e.byteLength){var s=new Int32Array(2048);new Uint8Array(s.buffer).set(new Uint8Array(e))}else s=new Int32Array(e,0,2048);for(var n=0;8192>n;n+=4){if(s[n>>2]===464367618){var o=s[n+4>>2];if(464367618+o+s[n+8>>2]|0)continue}else continue;""+A(o>>>0,8);var c=this;this.io.register_read(244,this,function(){return 0},function(){return 0},function(){var _=31860,l=0;if(i){l|=4,c.write32(31760,_),i+="\0";var m=new TextEncoder().encode(i);c.write_blob(m,_),_+=m.length}if(o&2){l|=64,m=0,c.write32(31788,0),c.write32(31792,_);var g=0,C=!1;for(let h=0;4294967296>h;h+=131072)C&&c.memory_map_read8[h>>>17]!==void 0?(c.write32(_,20),c.write32(_+4,g),c.write32(_+8,0),c.write32(_+12,h-g),c.write32(_+16,0),c.write32(_+20,1),_+=24,m+=24,C=!1):C||c.memory_map_read8[h>>>17]!==void 0||(g=h,C=!0);c.write32(31788,m)}if(c.write32(31744,l),m=l=0,o&65536){C=s[n+12>>2],l=s[n+16>>2];var y=s[n+20>>2];m=s[n+24>>2],g=s[n+28>>2],A(C,8),A(l,8),A(y,8),A(m,8),A(g,8),C=new Uint8Array(e,n-(C-l),y===0?void 0:y-l),c.write_blob(C,l),l=g|0,m=Math.max(y,m)}else if(s[0]===1179403647){g=new DataView(e);const[h,f]=Bh(g,Oh);console.assert(f===52),console.assert(h.magic===1179403647,"Bad magic"),console.assert(h.class===1,"Unimplemented: 64 bit elf"),console.assert(h.data===1,"Unimplemented: big endian"),console.assert(h.version0===1,"Bad version0"),console.assert(h.type===2,"Unimplemented type"),console.assert(h.version1===1,"Bad version1"),console.assert(h.ehsize===52,"Bad header size"),console.assert(h.phentsize===32,"Bad program header size"),console.assert(h.shentsize===40,"Bad section header size"),[l]=va(new DataView(g.buffer,g.byteOffset+h.phoff,h.phentsize*h.phnum),Ph,h.phnum),va(new DataView(g.buffer,g.byteOffset+h.shoff,h.shentsize*h.shnum),Mh,h.shnum),g=h,C=l,l=g.entry;for(y of C)y.type!==0&&(y.type===1?y.paddr+y.memsz<c.memory_size[0]?(y.filesz&&(C=new Uint8Array(e,y.offset,y.filesz),c.write_blob(C,y.paddr)),m=Math.max(m,y.paddr+y.memsz),l===g.entry&&y.vaddr<=l&&y.vaddr+y.memsz>l&&(l=l-y.vaddr+y.paddr)):A(y.paddr):y.type===2||y.type===3||y.type===4||y.type===6||y.type===7||y.type===1685382480||y.type===1685382481||y.type===1685382482||y.type===1685382483||A(y.type))}for(t&&(c.write32(31764,1),c.write32(31768,_),y=m,(y&4095)!==0&&(y=(y&-4096)+4096),m=y+t.byteLength,c.write32(_,y),c.write32(_+4,m),c.write32(_+8,0),c.write32(_+12,0),c.write_blob(new Uint8Array(t),y)),c.reg32[3]=31744,c.cr[0]=1,c.protected_mode[0]=1,c.flags[0]=2,c.is_32[0]=1,c.stack_size_32[0]=1,_=0;6>_;_++)c.segment_is_null[_]=0,c.segment_offsets[_]=0,c.segment_limits[_]=4294967295,c.sreg[_]=45058;return c.instruction_pointer[0]=c.get_seg_cs()+l|0,c.update_state_flags(),c.dump_state(),c.dump_regs_short(),732803074}),this.io.register_write_consecutive(244,this,function(_){throw console.log("Test exited with code "+A(_,2)),"HALT"},function(){},function(){},function(){});for(let _=0;15>=_;_++){let l=function(m){A(_),A(m,2),m?this.device_raise_irq(_):this.device_lower_irq(_)};this.io.register_write(8192+_,this,l,l,l)}const a=new Uint8Array(512);new Uint16Array(a.buffer)[0]=43605,a[2]=1;var r=3;a[r++]=102,a[r++]=229,a[r++]=244;let u=a[r]=0;for(let _=0;_<a.length;_++)u+=a[_];return a[r]=-u,{name:"genroms/multiboot.bin",data:a}}};we.prototype.fill_cmos=function(e,t){var i=t.boot_order||291;e.cmos_write(56,1|i>>4&240),e.cmos_write(61,i&255),e.cmos_write(21,128),e.cmos_write(22,2),i=0,1048576<=this.memory_size[0]&&(i=this.memory_size[0]-1048576>>10,i=Math.min(i,65535)),e.cmos_write(23,i&255),e.cmos_write(24,i>>8&255),e.cmos_write(48,i&255),e.cmos_write(49,i>>8&255),i=0,16777216<=this.memory_size[0]&&(i=this.memory_size[0]-16777216>>16,i=Math.min(i,65535)),e.cmos_write(52,i&255),e.cmos_write(53,i>>8&255),e.cmos_write(91,0),e.cmos_write(92,0),e.cmos_write(93,0),e.cmos_write(20,47),e.cmos_write(95,0),t.fastboot&&e.cmos_write(63,1)};we.prototype.load_bios=function(){var e=this.bios.main,t=this.bios.vga;if(e){var i=new Uint8Array(e);if(this.write_blob(i,1048576-e.byteLength),t){var s=new Uint8Array(t);this.write_blob(s,786432),this.io.mmap_register(4272947200,1048576,function(n){return n=n-4272947200|0,n<s.length?s[n]:0},function(){})}this.io.mmap_register(4293918720,1048576,(function(n){return this.mem8[n&1048575]}).bind(this),(function(n,o){this.mem8[n&1048575]=o}).bind(this))}};we.prototype.codegen_finalize=function(e,t,i,s,n){const o=new Uint8Array(this.wasm_memory.buffer,s>>>0,n>>>0);WebAssembly.instantiate(o,{e:this.jit_imports}).then(c=>{this.wm.wasm_table.set(e+1024,c.instance.exports.f),this.codegen_finalize_finished(e,t,i),this.test_hook_did_finalize_wasm&&this.test_hook_did_finalize_wasm(o)})};we.prototype.log_uncompiled_code=function(){};we.prototype.dump_function_code=function(){};we.prototype.run_hardware_timers=function(e,t){const i=this.devices.pit.timer(t,!1),s=this.devices.rtc.timer(t,!1);let n=100,o=100;return e&&(n=this.devices.acpi.timer(t),o=this.apic_timer(t)),Math.min(i,s,n,o)};we.prototype.debug_init=function(){};we.prototype.dump_stack=function(){};we.prototype.debug_get_state=function(){};we.prototype.dump_state=function(){};we.prototype.get_regs_short=function(){};we.prototype.dump_regs_short=function(){};we.prototype.dump_gdt_ldt=function(){};we.prototype.dump_idt=function(){};we.prototype.dump_page_structures=function(){if(this.cr[4]&32)for(var e=0;4>e;e++){var t=this.read32s(this.cr[3]+8*e);t&1&&this.dump_page_directory(t&4294963200,!0,e<<30)}else this.dump_page_directory(this.cr[3],!1,0)};we.prototype.dump_page_directory=function(){};we.prototype.get_memory_dump=function(){};we.prototype.memory_hex_dump=function(){};we.prototype.used_memory_dump=function(){};we.prototype.debug_interrupt=function(){};we.prototype.debug_dump_code=function(){};we.prototype.dump_wasm=function(){};function _t(e,t){this.cpu=e,this.pci=e.devices.pci,this.device_id=t.device_id,this.pci_space=[244,26,t.device_id&255,t.device_id>>8,7,5,16,0,1,0,2,0,0,0,0,0,1,168,0,0,0,16,191,254,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,244,26,t.subsystem_device_id&255,t.subsystem_device_id>>8,0,0,0,0,64,0,0,0,0,0,0,0,0,1,0,0],this.pci_space=this.pci_space.concat(Array(256-this.pci_space.length).fill(0)),this.pci_id=t.pci_id,this.pci_bars=[],this.name=t.name,this.driver_feature_select=this.device_feature_select=0,this.device_feature=new Uint32Array(4),this.driver_feature=new Uint32Array(4);for(var i of t.common.features)this.device_feature[i>>>5]|=1<<(i&31),this.driver_feature[i>>>5]|=1<<(i&31);t.common.features.includes(32),this.features_ok=!0,this.device_status=0,this.config_has_changed=!1,this.config_generation=0,this.queues=[];for(const s of t.common.queues)this.queues.push(new Ze(e,this,s));this.queue_select=0,this.queue_selected=this.queues[0],this.isr_status=0,i=[],i.push(this.create_common_capability(t.common)),i.push(this.create_notification_capability(t.notification)),i.push(this.create_isr_capability(t.isr_status)),t.device_specific&&i.push(this.create_device_specific_capability(t.device_specific)),this.init_capabilities(i),e.devices.pci.register_device(this),this.reset()}_t.prototype.create_common_capability=function(e){return{type:1,bar:0,port:e.initial_port,use_mmio:!1,offset:0,extra:new Uint8Array(0),struct:[{bytes:4,name:"device_feature_select",read:()=>this.device_feature_select,write:t=>{this.device_feature_select=t}},{bytes:4,name:"device_feature",read:()=>this.device_feature[this.device_feature_select]||0,write:()=>{}},{bytes:4,name:"driver_feature_select",read:()=>this.driver_feature_select,write:t=>{this.driver_feature_select=t}},{bytes:4,name:"driver_feature",read:()=>this.driver_feature[this.driver_feature_select]||0,write:t=>{const i=this.device_feature[this.driver_feature_select];this.driver_feature_select<this.driver_feature.length&&(this.driver_feature[this.driver_feature_select]=t&i),this.features_ok=this.features_ok&&!(t&~i)}},{bytes:2,name:"msix_config",read:()=>65535,write:()=>{}},{bytes:2,name:"num_queues",read:()=>this.queues.length,write:()=>{}},{bytes:1,name:"device_status",read:()=>this.device_status,write:t=>{t===0&&this.reset(),t&~this.device_status&4&&this.device_status&64&&this.notify_config_changes(),this.features_ok||(t&=-9),this.device_status=t,t&~this.device_status&4&&e.on_driver_ok()}},{bytes:1,name:"config_generation",read:()=>this.config_generation,write:()=>{}},{bytes:2,name:"queue_select",read:()=>this.queue_select,write:t=>{this.queue_select=t,this.queue_selected=this.queue_select<this.queues.length?this.queues[this.queue_select]:null}},{bytes:2,name:"queue_size",read:()=>this.queue_selected?this.queue_selected.size:0,write:t=>{this.queue_selected&&(t&t-1&&(t=1<<Ls(t-1)+1),t>this.queue_selected.size_supported&&(t=this.queue_selected.size_supported),this.queue_selected.set_size(t))}},{bytes:2,name:"queue_msix_vector",read:()=>65535,write:()=>{}},{bytes:2,name:"queue_enable",read:()=>this.queue_selected?this.queue_selected.enabled|0:0,write:t=>{this.queue_selected&&t===1&&this.queue_selected.is_configured()&&this.queue_selected.enable()}},{bytes:2,name:"queue_notify_off",read:()=>this.queue_selected?this.queue_selected.notify_offset:0,write:()=>{}},{bytes:4,name:"queue_desc (low dword)",read:()=>this.queue_selected?this.queue_selected.desc_addr:0,write:t=>{this.queue_selected&&(this.queue_selected.desc_addr=t)}},{bytes:4,name:"queue_desc (high dword)",read:()=>0,write:()=>{}},{bytes:4,name:"queue_avail (low dword)",read:()=>this.queue_selected?this.queue_selected.avail_addr:0,write:t=>{this.queue_selected&&(this.queue_selected.avail_addr=t)}},{bytes:4,name:"queue_avail (high dword)",read:()=>0,write:()=>{}},{bytes:4,name:"queue_used (low dword)",read:()=>this.queue_selected?this.queue_selected.used_addr:0,write:t=>{this.queue_selected&&(this.queue_selected.used_addr=t)}},{bytes:4,name:"queue_used (high dword)",read:()=>0,write:()=>{}}]}};_t.prototype.create_notification_capability=function(e){const t=[];let i;i=e.single_handler?0:2;for(const[s,n]of e.handlers.entries())t.push({bytes:2,name:"notify"+s,read:()=>65535,write:n||(()=>{})});return{type:2,bar:1,port:e.initial_port,use_mmio:!1,offset:0,extra:new Uint8Array([i&255,i>>8&255,i>>16&255,i>>24]),struct:t}};_t.prototype.create_isr_capability=function(e){return{type:3,bar:2,port:e.initial_port,use_mmio:!1,offset:0,extra:new Uint8Array(0),struct:[{bytes:1,name:"isr_status",read:()=>{const t=this.isr_status;return this.lower_irq(),t},write:()=>{}}]}};_t.prototype.create_device_specific_capability=function(e){return{type:4,bar:3,port:e.initial_port,use_mmio:!1,offset:0,extra:new Uint8Array(0),struct:e.struct}};_t.prototype.init_capabilities=function(e){let t=this.pci_space[52]=64;var i=t;for(const n of e){e=16+n.extra.length,i=t,t=i+e;var s=n.struct.reduce((o,c)=>o+c.bytes,0);s+=n.offset,s=16>s?16:1<<Ls(s-1)+1,this.pci_bars[n.bar]={size:s},this.pci_space[i]=9,this.pci_space[i+1]=t,this.pci_space[i+2]=e,this.pci_space[i+3]=n.type,this.pci_space[i+4]=n.bar,this.pci_space[i+5]=0,this.pci_space[i+6]=0,this.pci_space[i+7]=0,this.pci_space[i+8]=n.offset&255,this.pci_space[i+9]=n.offset>>>8&255,this.pci_space[i+10]=n.offset>>>16&255,this.pci_space[i+11]=n.offset>>>24,this.pci_space[i+12]=s&255,this.pci_space[i+13]=s>>>8&255,this.pci_space[i+14]=s>>>16&255,this.pci_space[i+15]=s>>>24;for(const[o,c]of n.extra.entries())this.pci_space[i+16+o]=c;i=16+4*n.bar,this.pci_space[i]=n.port&254|!n.use_mmio,this.pci_space[i+1]=n.port>>>8&255,this.pci_space[i+2]=n.port>>>16&255,this.pci_space[i+3]=n.port>>>24&255,i=n.port+n.offset;for(const o of n.struct){let c=o.read;if(e=o.write,!n.use_mmio){s=function(u){return c(u&-2)>>((u&1)<<3)&255};const r=function(u){return c(u&-4)>>((u&3)<<3)&255},a=function(u){return c(u)};switch(o.bytes){case 4:this.cpu.io.register_read(i,this,r,void 0,c),this.cpu.io.register_read(i+1,this,r),this.cpu.io.register_read(i+2,this,r),this.cpu.io.register_read(i+3,this,r),this.cpu.io.register_write(i,this,void 0,void 0,e);break;case 2:this.cpu.io.register_read(i,this,s,c,a),this.cpu.io.register_read(i+1,this,s),this.cpu.io.register_write(i,this,void 0,e);break;case 1:this.cpu.io.register_read(i,this,c),this.cpu.io.register_write(i,this,e)}}i+=o.bytes}}this.pci_space[t]=9,this.pci_space[t+1]=0,this.pci_space[t+2]=20,this.pci_space[t+3]=5,this.pci_space[t+4]=0,this.pci_space[t+5]=0,this.pci_space[t+6]=0,this.pci_space[t+7]=0,this.pci_space[t+8]=0,this.pci_space[t+9]=0,this.pci_space[t+10]=0,this.pci_space[t+11]=0,this.pci_space[t+12]=0,this.pci_space[t+13]=0,this.pci_space[t+14]=0,this.pci_space[t+15]=0,this.pci_space[t+16]=0,this.pci_space[t+17]=0,this.pci_space[t+18]=0,this.pci_space[t+19]=0};_t.prototype.get_state=function(){let e=[];return e[0]=this.device_feature_select,e[1]=this.driver_feature_select,e[2]=this.device_feature,e[3]=this.driver_feature,e[4]=this.features_ok,e[5]=this.device_status,e[6]=this.config_has_changed,e[7]=this.config_generation,e[8]=this.isr_status,e[9]=this.queue_select,e=e.concat(this.queues)};_t.prototype.set_state=function(e){this.device_feature_select=e[0],this.driver_feature_select=e[1],this.device_feature=e[2],this.driver_feature=e[3],this.features_ok=e[4],this.device_status=e[5],this.config_has_changed=e[6],this.config_generation=e[7],this.isr_status=e[8],this.queue_select=e[9];let t=0;for(const i of e.slice(10))this.queues[t].set_state(i),t++;this.queue_selected=this.queues[this.queue_select]||null};_t.prototype.reset=function(){this.driver_feature_select=this.device_feature_select=0,this.driver_feature.set(this.device_feature),this.features_ok=!0,this.queue_select=this.device_status=0,this.queue_selected=this.queues[0];for(const e of this.queues)e.reset();this.config_has_changed=!1,this.config_generation=0,this.lower_irq()};_t.prototype.notify_config_changes=function(){this.config_has_changed=!0,this.device_status&4&&this.raise_irq(2)};_t.prototype.update_config_generation=function(){this.config_has_changed&&(this.config_generation++,this.config_generation&=255,this.config_has_changed=!1)};_t.prototype.is_feature_negotiated=function(e){return 0<(this.driver_feature[e>>>5]&1<<(e&31))};_t.prototype.needs_reset=function(){this.device_status|=64,this.device_status&4&&this.notify_config_changes()};_t.prototype.raise_irq=function(e){A(e),this.isr_status|=e,this.pci.raise_irq(this.pci_id)};_t.prototype.lower_irq=function(){this.isr_status=0,this.pci.lower_irq(this.pci_id)};function Ze(e,t,i){this.cpu=e,this.virtio=t,this.size_supported=this.size=i.size_supported,this.mask=this.size-1,this.enabled=!1,this.notify_offset=i.notify_offset,this.num_staged_replies=this.used_addr=this.avail_last_idx=this.avail_addr=this.desc_addr=0,this.reset()}Ze.prototype.get_state=function(){const e=[];return e[0]=this.size,e[1]=this.size_supported,e[2]=this.enabled,e[3]=this.notify_offset,e[4]=this.desc_addr,e[5]=this.avail_addr,e[6]=this.avail_last_idx,e[7]=this.used_addr,e[8]=this.num_staged_replies,e[9]=1,e};Ze.prototype.set_state=function(e){this.size=e[0],this.size_supported=e[1],this.enabled=e[2],this.notify_offset=e[3],this.desc_addr=e[4],this.avail_addr=e[5],this.avail_last_idx=e[6],this.used_addr=e[7],this.num_staged_replies=e[8],this.mask=this.size-1,this.fix_wrapping=e[9]!==1};Ze.prototype.reset=function(){this.enabled=!1,this.num_staged_replies=this.used_addr=this.avail_last_idx=this.avail_addr=this.desc_addr=0,this.set_size(this.size_supported)};Ze.prototype.is_configured=function(){return this.desc_addr&&this.avail_addr&&this.used_addr};Ze.prototype.enable=function(){this.is_configured(),this.enabled=!0};Ze.prototype.set_size=function(e){this.size=e,this.mask=e-1};Ze.prototype.count_requests=function(){return this.fix_wrapping&&(this.fix_wrapping=!1,this.avail_last_idx=(this.avail_get_idx()&~this.mask)+(this.avail_last_idx&this.mask)),this.avail_get_idx()-this.avail_last_idx&65535};Ze.prototype.has_request=function(){return this.count_requests()!==0};Ze.prototype.pop_request=function(){this.has_request();var e=this.avail_get_entry(this.avail_last_idx);return e=new Zn(this,e),this.avail_last_idx=this.avail_last_idx+1&65535,e};Ze.prototype.push_reply=function(e){const t=this.used_get_idx()+this.num_staged_replies&this.mask;this.used_set_entry(t,e.head_idx,e.length_written),this.num_staged_replies++};Ze.prototype.flush_replies=function(){if(this.num_staged_replies!==0){var e=this.used_get_idx()+this.num_staged_replies&65535;this.used_set_idx(e),this.num_staged_replies=0,this.virtio.is_feature_negotiated(29)?(this.avail_get_used_event(),this.virtio.raise_irq(1)):~this.avail_get_flags()&1&&this.virtio.raise_irq(1)}};Ze.prototype.notify_me_after=function(e){e=this.avail_get_idx()+e&65535,this.used_set_avail_event(e)};Ze.prototype.get_descriptor=function(e,t){return{addr_low:this.cpu.read32s(e+16*t),addr_high:this.cpu.read32s(e+16*t+4),len:this.cpu.read32s(e+16*t+8),flags:this.cpu.read16(e+16*t+12),next:this.cpu.read16(e+16*t+14)}};Ze.prototype.avail_get_flags=function(){return this.cpu.read16(this.avail_addr)};Ze.prototype.avail_get_idx=function(){return this.cpu.read16(this.avail_addr+2)};Ze.prototype.avail_get_entry=function(e){return this.cpu.read16(this.avail_addr+4+2*(e&this.mask))};Ze.prototype.avail_get_used_event=function(){return this.cpu.read16(this.avail_addr+4+2*this.size)};Ze.prototype.used_get_flags=function(){return this.cpu.read16(this.used_addr)};Ze.prototype.used_set_flags=function(e){this.cpu.write16(this.used_addr,e)};Ze.prototype.used_get_idx=function(){return this.cpu.read16(this.used_addr+2)};Ze.prototype.used_set_idx=function(e){this.cpu.write16(this.used_addr+2,e)};Ze.prototype.used_set_entry=function(e,t,i){this.cpu.write32(this.used_addr+4+8*e,t),this.cpu.write32(this.used_addr+8+8*e,i)};Ze.prototype.used_set_avail_event=function(e){this.cpu.write16(this.used_addr+4+8*this.size,e)};function Zn(e,t){this.cpu=e.cpu,this.virtio=e.virtio,this.head_idx=t,this.read_buffers=[],this.length_readable=this.read_buffer_offset=this.read_buffer_idx=0,this.write_buffers=[],this.length_writable=this.length_written=this.write_buffer_offset=this.write_buffer_idx=0;let i=e.desc_addr,s=0,n=e.size,o=!1;const c=this.virtio.is_feature_negotiated(28);do{const r=e.get_descriptor(i,t);if(A(r.addr_high,8),A(r.addr_low,8),A(r.len,8),A(r.flags,4),A(r.next,4),c&&r.flags&4)i=r.addr_low,s=t=0,n=r.len/16;else{if(r.flags&2)o=!0,this.write_buffers.push(r),this.length_writable+=r.len;else{if(o)break;this.read_buffers.push(r),this.length_readable+=r.len}if(s++,s>n)break;if(r.flags&1)t=r.next;else break}}while(!0)}Zn.prototype.get_next_blob=function(e){let t=0,i=e.length;for(;i&&this.read_buffer_idx!==this.read_buffers.length;){var s=this.read_buffers[this.read_buffer_idx];const n=s.addr_low+this.read_buffer_offset;s=s.len-this.read_buffer_offset,s>i?(s=i,this.read_buffer_offset+=i):(this.read_buffer_idx++,this.read_buffer_offset=0),e.set(this.cpu.read_blob(n,s),t),t+=s,i-=s}return t};Zn.prototype.set_next_blob=function(e){let t=0,i=e.length;for(;i&&this.write_buffer_idx!==this.write_buffers.length;){var s=this.write_buffers[this.write_buffer_idx];const n=s.addr_low+this.write_buffer_offset;s=s.len-this.write_buffer_offset,s>i?(s=i,this.write_buffer_offset+=i):(this.write_buffer_idx++,this.write_buffer_offset=0),this.cpu.write_blob(e.subarray(t,t+s),n),t+=s,i-=s}return this.length_written+=t,t};function eo(e,t,i,s){const n=new _t(e,{name:"virtio-9p",pci_id:48,device_id:4169,subsystem_device_id:9,common:{initial_port:43008,queues:[{size_supported:32,notify_offset:0}],features:[0,32,29,28],on_driver_ok:()=>{}},notification:{initial_port:43264,single_handler:!1,handlers:[o=>{if(o===0){for(o=n.queues[0];o.has_request();){const c=o.pop_request();s(c)}o.notify_me_after(0)}}]},isr_status:{initial_port:42752},device_specific:{initial_port:42496,struct:[{bytes:2,name:"mount tag length",read:()=>t,write:()=>{}}].concat(Array.from(Array(254).keys()).map(o=>({bytes:1,name:"mount tag name "+o,read:()=>i[o]||0,write:()=>{}})))}});return n}function ni(e,t,i){this.fs=e,this.bus=i,this.configspace_tagname=[104,111,115,116,57,112],this.configspace_taglen=this.configspace_tagname.length,this.virtio=eo(t,this.configspace_taglen,this.configspace_tagname,this.ReceiveRequest.bind(this)),this.virtqueue=this.virtio.queues[0],this.VERSION="9P2000.L",this.msize=this.BLOCKSIZE=8192,this.replybuffer=new Uint8Array(2*this.msize),this.replybuffersize=0,this.fids=[]}ni.prototype.get_state=function(){var e=[];return e[0]=this.configspace_tagname,e[1]=this.configspace_taglen,e[2]=this.virtio,e[3]=this.VERSION,e[4]=this.BLOCKSIZE,e[5]=this.msize,e[6]=this.replybuffer,e[7]=this.replybuffersize,e[8]=this.fids.map(function(t){return[t.inodeid,t.type,t.uid,t.dbg_name]}),e[9]=this.fs,e};ni.prototype.set_state=function(e){this.configspace_tagname=e[0],this.configspace_taglen=e[1],this.virtio.set_state(e[2]),this.virtqueue=this.virtio.queues[0],this.VERSION=e[3],this.BLOCKSIZE=e[4],this.msize=e[5],this.replybuffer=e[6],this.replybuffersize=e[7],this.fids=e[8].map(function(t){return{inodeid:t[0],type:t[1],uid:t[2],dbg_name:t[3]}}),this.fs.set_state(e[9])};ni.prototype.Createfid=function(e,t,i,s){return{inodeid:e,type:t,uid:i,dbg_name:s}};ni.prototype.update_dbg_name=function(e,t){for(const i of this.fids)i.inodeid===e&&(i.dbg_name=t)};ni.prototype.reset=function(){this.fids=[],this.virtio.reset()};ni.prototype.BuildReply=function(e,t,i){Ve(["w","b","h"],[i+7,e+1,t],this.replybuffer,0),this.replybuffersize=i+7};ni.prototype.SendError=function(e,t,i){t=Ve(["w"],[i],this.replybuffer,7),this.BuildReply(6,e,t)};ni.prototype.SendReply=function(e){e.set_next_blob(this.replybuffer.subarray(0,this.replybuffersize)),this.virtqueue.push_reply(e),this.virtqueue.flush_replies()};ni.prototype.ReceiveRequest=async function(e){var t=new Uint8Array(e.length_readable);e.get_next_blob(t);var i={offset:0},s=Ie(["w","b","h"],t,i),n=s[1];switch(s=s[2],n){case 8:var o=this.fs.GetTotalSize(),c=this.fs.GetSpace(),r=[16914839];r[1]=this.BLOCKSIZE,r[2]=Math.floor(c/r[1]),r[3]=r[2]-Math.floor(o/r[1]),r[4]=r[2]-Math.floor(o/r[1]),r[5]=this.fs.CountUsedInodes(),r[6]=this.fs.CountFreeInodes(),r[7]=0,r[8]=256,o=Ve("wwddddddw".split(""),r,this.replybuffer,7),this.BuildReply(n,s,o),this.SendReply(e);break;case 112:case 12:r=Ie(["w","w"],t,i),o=r[0];var a=r[1];t=this.fids[o].inodeid,i=this.fs.GetInode(t),await this.fs.OpenInode(t,a),r=[],r[0]=i.qid,r[1]=this.msize-24,Ve(["Q","w"],r,this.replybuffer,7),this.BuildReply(n,s,17),this.SendReply(e);break;case 70:if(r=Ie(["w","w","s"],t,i),t=r[0],o=r[1],c=r[2],o=this.fs.Link(this.fids[t].inodeid,this.fids[o].inodeid,c),0>o){this.SendError(s,o===-1?"Operation not permitted":"Unknown error: "+-o,-o),this.SendReply(e);break}this.BuildReply(n,s,0),this.SendReply(e);break;case 16:r=Ie(["w","s","s","w"],t,i),o=r[0],c=r[1];var u=r[3];t=this.fs.CreateSymlink(c,this.fids[o].inodeid,r[2]),i=this.fs.GetInode(t),i.uid=this.fids[o].uid,i.gid=u,Ve(["Q"],[i.qid],this.replybuffer,7),this.BuildReply(n,s,13),this.SendReply(e);break;case 18:r=Ie("wswwww".split(""),t,i),o=r[0],c=r[1],a=r[2],t=r[3],i=r[4],u=r[5],t=this.fs.CreateNode(c,this.fids[o].inodeid,t,i),i=this.fs.GetInode(t),i.mode=a,i.uid=this.fids[o].uid,i.gid=u,Ve(["Q"],[i.qid],this.replybuffer,7),this.BuildReply(n,s,13),this.SendReply(e);break;case 22:r=Ie(["w"],t,i),o=r[0],i=this.fs.GetInode(this.fids[o].inodeid),o=Ve(["s"],[i.symlink],this.replybuffer,7),this.BuildReply(n,s,o),this.SendReply(e);break;case 72:r=Ie(["w","s","w","w"],t,i),o=r[0],c=r[1],a=r[2],u=r[3],t=this.fs.CreateDirectory(c,this.fids[o].inodeid),i=this.fs.GetInode(t),i.mode=a|16384,i.uid=this.fids[o].uid,i.gid=u,Ve(["Q"],[i.qid],this.replybuffer,7),this.BuildReply(n,s,13),this.SendReply(e);break;case 14:r=Ie(["w","s","w","w","w"],t,i),o=r[0],c=r[1],a=r[3],u=r[4],this.bus.send("9p-create",[c,this.fids[o].inodeid]),t=this.fs.CreateFile(c,this.fids[o].inodeid),this.fids[o].inodeid=t,this.fids[o].type=1,this.fids[o].dbg_name=c,i=this.fs.GetInode(t),i.uid=this.fids[o].uid,i.gid=u,i.mode=a|32768,Ve(["Q","w"],[i.qid,this.msize-24],this.replybuffer,7),this.BuildReply(n,s,17),this.SendReply(e);break;case 52:r=Ie("wbwddws".split(""),t,i),o=r[0],c=r[2],t=r[4]===0?1/0:r[4],r=this.fs.DescribeLock(r[1],r[3],t,r[5],r[6]),o=this.fs.Lock(this.fids[o].inodeid,r,c),Ve(["b"],[o],this.replybuffer,7),this.BuildReply(n,s,1),this.SendReply(e);break;case 54:r=Ie("wbddws".split(""),t,i),o=r[0],t=r[3]===0?1/0:r[3],r=this.fs.DescribeLock(r[1],r[2],t,r[4],r[5]),o=this.fs.GetLock(this.fids[o].inodeid,r),o||(o=r,o.type=2),o=Ve(["b","d","d","w","s"],[o.type,o.start,o.length===1/0?0:o.length,o.proc_id,o.client_id],this.replybuffer,7),this.BuildReply(n,s,o),this.SendReply(e);break;case 24:if(r=Ie(["w","d"],t,i),o=r[0],i=this.fs.GetInode(this.fids[o].inodeid),!i||i.status===4){this.SendError(s,"No such file or directory",2),this.SendReply(e);break}r[0]=r[1],r[1]=i.qid,r[2]=i.mode,r[3]=i.uid,r[4]=i.gid,r[5]=i.nlinks,r[6]=i.major<<8|i.minor,r[7]=i.size,r[8]=this.BLOCKSIZE,r[9]=Math.floor(i.size/512+1),r[10]=i.atime,r[11]=0,r[12]=i.mtime,r[13]=0,r[14]=i.ctime,r[15]=0,r[16]=0,r[17]=0,r[18]=0,r[19]=0,Ve("dQwwwddddddddddddddd".split(""),r,this.replybuffer,7),this.BuildReply(n,s,153),this.SendReply(e);break;case 26:r=Ie("wwwwwddddd".split(""),t,i),o=r[0],i=this.fs.GetInode(this.fids[o].inodeid),r[1]&1&&(i.mode=r[2]),r[1]&2&&(i.uid=r[3]),r[1]&4&&(i.gid=r[4]),r[1]&16&&(i.atime=Math.floor(new Date().getTime()/1e3)),r[1]&32&&(i.mtime=Math.floor(new Date().getTime()/1e3)),r[1]&64&&(i.ctime=Math.floor(new Date().getTime()/1e3)),r[1]&128&&(i.atime=r[6]),r[1]&256&&(i.mtime=r[8]),r[1]&8&&await this.fs.ChangeSize(this.fids[o].inodeid,r[5]),this.BuildReply(n,s,0),this.SendReply(e);break;case 50:Ie(["w","d"],t,i),this.BuildReply(n,s,0),this.SendReply(e);break;case 40:case 116:if(r=Ie(["w","d","w"],t,i),o=r[0],c=r[1],a=r[2],i=this.fs.GetInode(this.fids[o].inodeid),!i||i.status===4){this.SendError(s,"No such file or directory",2),this.SendReply(e);break}if(this.fids[o].type===2)for(i.caps.length<c+a&&(a=i.caps.length-c),r=0;r<a;r++)this.replybuffer[11+r]=i.caps[c+r];else await this.fs.OpenInode(this.fids[o].inodeid,void 0),r=this.fids[o].inodeid,a=Math.min(a,this.replybuffer.length-11),i.size<c+a?a=i.size-c:n===40&&(a=this.fs.RoundToDirentry(r,c+a)-c),c>i.size&&(a=0),this.bus.send("9p-read-start",[this.fids[o].dbg_name]),r=await this.fs.Read(r,c,a),this.bus.send("9p-read-end",[this.fids[o].dbg_name,a]),r&&this.replybuffer.set(r,11);Ve(["w"],[a],this.replybuffer,7),this.BuildReply(n,s,4+a),this.SendReply(e);break;case 118:if(r=Ie(["w","d","w"],t,i),o=r[0],c=r[1],a=r[2],r=this.fids[o].dbg_name,this.fids[o].type===2){this.SendError(s,"Setxattr not supported",95),this.SendReply(e);break}else await this.fs.Write(this.fids[o].inodeid,c,a,t.subarray(i.offset));this.bus.send("9p-write-end",[r,a]),Ve(["w"],[a],this.replybuffer,7),this.BuildReply(n,s,4),this.SendReply(e);break;case 74:if(r=Ie(["w","s","w","s"],t,i),o=await this.fs.Rename(this.fids[r[0]].inodeid,r[1],this.fids[r[2]].inodeid,r[3]),0>o){this.SendError(s,o===-2?"No such file or directory":o===-1?"Operation not permitted":o===-39?"Directory not empty":"Unknown error: "+-o,-o),this.SendReply(e);break}this.BuildReply(n,s,0),this.SendReply(e);break;case 76:if(r=Ie(["w","s","w"],t,i),t=r[0],c=r[1],o=this.fs.Search(this.fids[t].inodeid,c),o===-1){this.SendError(s,"No such file or directory",2),this.SendReply(e);break}if(o=this.fs.Unlink(this.fids[t].inodeid,c),0>o){this.SendError(s,o===-39?"Directory not empty":o===-1?"Operation not permitted":"Unknown error: "+-o,-o),this.SendReply(e);break}this.BuildReply(n,s,0),this.SendReply(e);break;case 100:o=Ie(["w","s"],t,i),this.msize!==o[0]&&(this.msize=o[0],this.replybuffer=new Uint8Array(Math.min(16777216,2*this.msize))),o=Ve(["w","s"],[this.msize,this.VERSION],this.replybuffer,7),this.BuildReply(n,s,o),this.SendReply(e);break;case 104:r=Ie(["w","w","s","s","w"],t,i),o=r[0],c=r[4],A(r[1]),this.fids[o]=this.Createfid(0,1,c,""),i=this.fs.GetInode(this.fids[o].inodeid),Ve(["Q"],[i.qid],this.replybuffer,7),this.BuildReply(n,s,13),this.SendReply(e),this.bus.send("9p-attach");break;case 108:Ie(["h"],t,i),this.BuildReply(n,s,0),this.SendReply(e);break;case 110:if(r=Ie(["w","w","h"],t,i),o=r[0],a=r[1],u=r[2],u===0){this.fids[a]=this.Createfid(this.fids[o].inodeid,1,this.fids[o].uid,this.fids[o].dbg_name),Ve(["h"],[0],this.replybuffer,7),this.BuildReply(n,s,2),this.SendReply(e);break}for(c=[],r=0;r<u;r++)c.push("s");i=Ie(c,t,i),t=this.fids[o].inodeid,c=9;var _=0;for(r=0;r<u&&(t=this.fs.Search(t,i[r]),t!==-1);r++)c+=Ve(["Q"],[this.fs.GetInode(t).qid],this.replybuffer,c),_++,this.fids[a]=this.Createfid(t,1,this.fids[o].uid,i[r]);Ve(["h"],[_],this.replybuffer,7),this.BuildReply(n,s,c-7),this.SendReply(e);break;case 120:r=Ie(["w"],t,i),this.fids[r[0]]&&0<=this.fids[r[0]].inodeid&&(await this.fs.CloseInode(this.fids[r[0]].inodeid),this.fids[r[0]].inodeid=-1,this.fids[r[0]].type=-1),this.BuildReply(n,s,0),this.SendReply(e);break;case 32:r=Ie(["w","s","d","w"],t,i),o=r[0],this.fids[o].type=2,this.BuildReply(n,s,0),this.SendReply(e);break;case 30:Ie(["w","w","s"],t,i),this.SendError(s,"Setxattr not supported",95),this.SendReply(e)}};function Sr(e,t){this.handle_fn=e,this.tag_bufchain=new Map,this.configspace_tagname=[104,111,115,116,57,112],this.configspace_taglen=this.configspace_tagname.length,this.virtio=eo(t,this.configspace_taglen,this.configspace_tagname,async i=>{const s=new Uint8Array(i.length_readable);i.get_next_blob(s);var n=Ie(["w","b","h"],s,{offset:0})[2];this.tag_bufchain.set(n,i),this.handle_fn(s,o=>{var c=Ie(["w","b","h"],o,{offset:0})[2];const r=this.tag_bufchain.get(c);r?(r.set_next_blob(o),this.virtqueue.push_reply(r),this.virtqueue.flush_replies(),this.tag_bufchain.delete(c)):console.error("No bufchain found for tag: "+c)})}),this.virtqueue=this.virtio.queues[0]}Sr.prototype.get_state=function(){var e=[];return e[0]=this.configspace_tagname,e[1]=this.configspace_taglen,e[2]=this.virtio,e[3]=this.tag_bufchain,e};Sr.prototype.set_state=function(e){this.configspace_tagname=e[0],this.configspace_taglen=e[1],this.virtio.set_state(e[2]),this.virtqueue=this.virtio.queues[0],this.tag_bufchain=e[3]};Sr.prototype.reset=function(){this.virtio.reset()};function Bt(e,t){this.socket=void 0,this.cpu=t,this.send_queue=[],this.url=e,this.reconnect_interval=1e4,this.last_connect_attempt=Date.now()-this.reconnect_interval,this.send_queue_limit=64,this.destroyed=!1,this.tag_bufchain=new Map,this.configspace_tagname=[104,111,115,116,57,112],this.configspace_taglen=this.configspace_tagname.length,this.virtio=eo(t,this.configspace_taglen,this.configspace_tagname,async i=>{const s=new Uint8Array(i.length_readable);i.get_next_blob(s);const n=Ie(["w","b","h"],s,{offset:0})[2];this.tag_bufchain.set(n,i),this.send(s)}),this.virtqueue=this.virtio.queues[0]}Bt.prototype.get_state=function(){var e=[];return e[0]=this.configspace_tagname,e[1]=this.configspace_taglen,e[2]=this.virtio,e[3]=this.tag_bufchain,e};Bt.prototype.set_state=function(e){this.configspace_tagname=e[0],this.configspace_taglen=e[1],this.virtio.set_state(e[2]),this.virtqueue=this.virtio.queues[0],this.tag_bufchain=e[3]};Bt.prototype.reset=function(){this.virtio.reset()};Bt.prototype.handle_message=function(e){e=new Uint8Array(e.data);const t=Ie(["w","b","h"],e,{offset:0})[2],i=this.tag_bufchain.get(t);i?(i.set_next_blob(e),this.virtqueue.push_reply(i),this.virtqueue.flush_replies(),this.tag_bufchain.delete(t)):console.error("Virtio9pProxy: No bufchain found for tag: "+t)};Bt.prototype.handle_close=function(){this.destroyed||(this.connect(),setTimeout(this.connect.bind(this),this.reconnect_interval))};Bt.prototype.handle_open=function(){for(var e=0;e<this.send_queue.length;e++)this.send(this.send_queue[e]);this.send_queue=[]};Bt.prototype.handle_error=function(){};Bt.prototype.destroy=function(){this.destroyed=!0,this.socket&&this.socket.close()};Bt.prototype.connect=function(){if(typeof WebSocket<"u"){if(this.socket){var e=this.socket.readyState;if(e===0||e===1)return}if(e=Date.now(),!(this.last_connect_attempt+this.reconnect_interval>e)){this.last_connect_attempt=Date.now();try{this.socket=new WebSocket(this.url)}catch(t){console.error(t);return}this.socket.binaryType="arraybuffer",this.socket.onopen=this.handle_open.bind(this),this.socket.onmessage=this.handle_message.bind(this),this.socket.onclose=this.handle_close.bind(this),this.socket.onerror=this.handle_error.bind(this)}}};Bt.prototype.send=function(e){this.socket&&this.socket.readyState===1?this.socket.send(e):(this.send_queue.push(e),this.send_queue.length>2*this.send_queue_limit&&(this.send_queue=this.send_queue.slice(-this.send_queue_limit)),this.connect())};Bt.prototype.change_proxy=function(e){this.url=e,this.socket&&(this.socket.onclose=function(){},this.socket.onerror=function(){},this.socket.close(),this.socket=void 0)};let{V86:ym}=ir.exports;const bm=1,wa="/root/",Sa=1,wm=2,Cn="serial0-input",Es="serial0-output-byte",Sm="serial1-output-byte",Cm="/dev/ttyS2",Ca="serial2-output-byte";function Js(e){throw new Error('Could not dynamically require "'+e+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var nn={exports:{}};var Ea;function Em(){return Ea||(Ea=1,(function(e,t){(function(i){e.exports=i()})(function(){return(function i(s,n,o){function c(u,_){if(!n[u]){if(!s[u]){var l=typeof Js=="function"&&Js;if(!_&&l)return l(u,!0);if(r)return r(u,!0);var m=new Error("Cannot find module '"+u+"'");throw m.code="MODULE_NOT_FOUND",m}var g=n[u]={exports:{}};s[u][0].call(g.exports,function(C){var y=s[u][1][C];return c(y||C)},g,g.exports,i,s,n,o)}return n[u].exports}for(var r=typeof Js=="function"&&Js,a=0;a<o.length;a++)c(o[a]);return c})({1:[function(i,s,n){(function(o){var c=o.MutationObserver||o.WebKitMutationObserver,r;if(c){var a=0,u=new c(C),_=o.document.createTextNode("");u.observe(_,{characterData:!0}),r=function(){_.data=a=++a%2}}else if(!o.setImmediate&&typeof o.MessageChannel<"u"){var l=new o.MessageChannel;l.port1.onmessage=C,r=function(){l.port2.postMessage(0)}}else"document"in o&&"onreadystatechange"in o.document.createElement("script")?r=function(){var h=o.document.createElement("script");h.onreadystatechange=function(){C(),h.onreadystatechange=null,h.parentNode.removeChild(h),h=null},o.document.documentElement.appendChild(h)}:r=function(){setTimeout(C,0)};var m,g=[];function C(){m=!0;for(var h,f,d=g.length;d;){for(f=g,g=[],h=-1;++h<d;)f[h]();d=g.length}m=!1}s.exports=y;function y(h){g.push(h)===1&&!m&&r()}}).call(this,typeof Ks<"u"?Ks:typeof self<"u"?self:typeof window<"u"?window:{})},{}],2:[function(i,s,n){var o=i(1);function c(){}var r={},a=["REJECTED"],u=["FULFILLED"],_=["PENDING"];s.exports=l;function l(S){if(typeof S!="function")throw new TypeError("resolver must be a function");this.state=_,this.queue=[],this.outcome=void 0,S!==c&&y(this,S)}l.prototype.catch=function(S){return this.then(null,S)},l.prototype.then=function(S,w){if(typeof S!="function"&&this.state===u||typeof w!="function"&&this.state===a)return this;var E=new this.constructor(c);if(this.state!==_){var b=this.state===u?S:w;g(E,b,this.outcome)}else this.queue.push(new m(E,S,w));return E};function m(S,w,E){this.promise=S,typeof w=="function"&&(this.onFulfilled=w,this.callFulfilled=this.otherCallFulfilled),typeof E=="function"&&(this.onRejected=E,this.callRejected=this.otherCallRejected)}m.prototype.callFulfilled=function(S){r.resolve(this.promise,S)},m.prototype.otherCallFulfilled=function(S){g(this.promise,this.onFulfilled,S)},m.prototype.callRejected=function(S){r.reject(this.promise,S)},m.prototype.otherCallRejected=function(S){g(this.promise,this.onRejected,S)};function g(S,w,E){o(function(){var b;try{b=w(E)}catch(k){return r.reject(S,k)}b===S?r.reject(S,new TypeError("Cannot resolve promise with itself")):r.resolve(S,b)})}r.resolve=function(S,w){var E=h(C,w);if(E.status==="error")return r.reject(S,E.value);var b=E.value;if(b)y(S,b);else{S.state=u,S.outcome=w;for(var k=-1,R=S.queue.length;++k<R;)S.queue[k].callFulfilled(w)}return S},r.reject=function(S,w){S.state=a,S.outcome=w;for(var E=-1,b=S.queue.length;++E<b;)S.queue[E].callRejected(w);return S};function C(S){var w=S&&S.then;if(S&&(typeof S=="object"||typeof S=="function")&&typeof w=="function")return function(){w.apply(S,arguments)}}function y(S,w){var E=!1;function b(P){E||(E=!0,r.reject(S,P))}function k(P){E||(E=!0,r.resolve(S,P))}function R(){w(k,b)}var I=h(R);I.status==="error"&&b(I.value)}function h(S,w){var E={};try{E.value=S(w),E.status="success"}catch(b){E.status="error",E.value=b}return E}l.resolve=f;function f(S){return S instanceof this?S:r.resolve(new this(c),S)}l.reject=d;function d(S){var w=new this(c);return r.reject(w,S)}l.all=p;function p(S){var w=this;if(Object.prototype.toString.call(S)!=="[object Array]")return this.reject(new TypeError("must be an array"));var E=S.length,b=!1;if(!E)return this.resolve([]);for(var k=new Array(E),R=0,I=-1,P=new this(c);++I<E;)L(S[I],I);return P;function L(z,J){w.resolve(z).then(re,function(te){b||(b=!0,r.reject(P,te))});function re(te){k[J]=te,++R===E&&!b&&(b=!0,r.resolve(P,k))}}}l.race=v;function v(S){var w=this;if(Object.prototype.toString.call(S)!=="[object Array]")return this.reject(new TypeError("must be an array"));var E=S.length,b=!1;if(!E)return this.resolve([]);for(var k=-1,R=new this(c);++k<E;)I(S[k]);return R;function I(P){w.resolve(P).then(function(L){b||(b=!0,r.resolve(R,L))},function(L){b||(b=!0,r.reject(R,L))})}}},{1:1}],3:[function(i,s,n){(function(o){typeof o.Promise!="function"&&(o.Promise=i(2))}).call(this,typeof Ks<"u"?Ks:typeof self<"u"?self:typeof window<"u"?window:{})},{2:2}],4:[function(i,s,n){var o=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(D){return typeof D}:function(D){return D&&typeof Symbol=="function"&&D.constructor===Symbol&&D!==Symbol.prototype?"symbol":typeof D};function c(D,F){if(!(D instanceof F))throw new TypeError("Cannot call a class as a function")}function r(){try{if(typeof indexedDB<"u")return indexedDB;if(typeof webkitIndexedDB<"u")return webkitIndexedDB;if(typeof mozIndexedDB<"u")return mozIndexedDB;if(typeof OIndexedDB<"u")return OIndexedDB;if(typeof msIndexedDB<"u")return msIndexedDB}catch{return}}var a=r();function u(){try{if(!a||!a.open)return!1;var D=typeof openDatabase<"u"&&/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform),F=typeof fetch=="function"&&fetch.toString().indexOf("[native code")!==-1;return(!D||F)&&typeof indexedDB<"u"&&typeof IDBKeyRange<"u"}catch{return!1}}function _(D,F){D=D||[],F=F||{};try{return new Blob(D,F)}catch(W){if(W.name!=="TypeError")throw W;for(var O=typeof BlobBuilder<"u"?BlobBuilder:typeof MSBlobBuilder<"u"?MSBlobBuilder:typeof MozBlobBuilder<"u"?MozBlobBuilder:WebKitBlobBuilder,$=new O,G=0;G<D.length;G+=1)$.append(D[G]);return $.getBlob(F.type)}}typeof Promise>"u"&&i(3);var l=Promise;function m(D,F){F&&D.then(function(O){F(null,O)},function(O){F(O)})}function g(D,F,O){typeof F=="function"&&D.then(F),typeof O=="function"&&D.catch(O)}function C(D){return typeof D!="string"&&(console.warn(D+" used as a key, but it is not a string."),D=String(D)),D}function y(){if(arguments.length&&typeof arguments[arguments.length-1]=="function")return arguments[arguments.length-1]}var h="local-forage-detect-blob-support",f=void 0,d={},p=Object.prototype.toString,v="readonly",S="readwrite";function w(D){for(var F=D.length,O=new ArrayBuffer(F),$=new Uint8Array(O),G=0;G<F;G++)$[G]=D.charCodeAt(G);return O}function E(D){return new l(function(F){var O=D.transaction(h,S),$=_([""]);O.objectStore(h).put($,"key"),O.onabort=function(G){G.preventDefault(),G.stopPropagation(),F(!1)},O.oncomplete=function(){var G=navigator.userAgent.match(/Chrome\/(\d+)/),W=navigator.userAgent.match(/Edge\//);F(W||!G||parseInt(G[1],10)>=43)}}).catch(function(){return!1})}function b(D){return typeof f=="boolean"?l.resolve(f):E(D).then(function(F){return f=F,f})}function k(D){var F=d[D.name],O={};O.promise=new l(function($,G){O.resolve=$,O.reject=G}),F.deferredOperations.push(O),F.dbReady?F.dbReady=F.dbReady.then(function(){return O.promise}):F.dbReady=O.promise}function R(D){var F=d[D.name],O=F.deferredOperations.pop();if(O)return O.resolve(),O.promise}function I(D,F){var O=d[D.name],$=O.deferredOperations.pop();if($)return $.reject(F),$.promise}function P(D,F){return new l(function(O,$){if(d[D.name]=d[D.name]||H(),D.db)if(F)k(D),D.db.close();else return O(D.db);var G=[D.name];F&&G.push(D.version);var W=a.open.apply(a,G);F&&(W.onupgradeneeded=function(ie){var ne=W.result;try{ne.createObjectStore(D.storeName),ie.oldVersion<=1&&ne.createObjectStore(h)}catch(ae){if(ae.name==="ConstraintError")console.warn('The database "'+D.name+'" has been upgraded from version '+ie.oldVersion+" to version "+ie.newVersion+', but the storage "'+D.storeName+'" already exists.');else throw ae}}),W.onerror=function(ie){ie.preventDefault(),$(W.error)},W.onsuccess=function(){var ie=W.result;ie.onversionchange=function(ne){ne.target.close()},O(ie),R(D)}})}function L(D){return P(D,!1)}function z(D){return P(D,!0)}function J(D,F){if(!D.db)return!0;var O=!D.db.objectStoreNames.contains(D.storeName),$=D.version<D.db.version,G=D.version>D.db.version;if($&&(D.version!==F&&console.warn('The database "'+D.name+`" can't be downgraded from version `+D.db.version+" to version "+D.version+"."),D.version=D.db.version),G||O){if(O){var W=D.db.version+1;W>D.version&&(D.version=W)}return!0}return!1}function re(D){return new l(function(F,O){var $=new FileReader;$.onerror=O,$.onloadend=function(G){var W=btoa(G.target.result||"");F({__local_forage_encoded_blob:!0,data:W,type:D.type})},$.readAsBinaryString(D)})}function te(D){var F=w(atob(D.data));return _([F],{type:D.type})}function ee(D){return D&&D.__local_forage_encoded_blob}function x(D){var F=this,O=F._initReady().then(function(){var $=d[F._dbInfo.name];if($&&$.dbReady)return $.dbReady});return g(O,D,D),O}function B(D){k(D);for(var F=d[D.name],O=F.forages,$=0;$<O.length;$++){var G=O[$];G._dbInfo.db&&(G._dbInfo.db.close(),G._dbInfo.db=null)}return D.db=null,L(D).then(function(W){return D.db=W,J(D)?z(D):W}).then(function(W){D.db=F.db=W;for(var ie=0;ie<O.length;ie++)O[ie]._dbInfo.db=W}).catch(function(W){throw I(D,W),W})}function N(D,F,O,$){$===void 0&&($=1);try{var G=D.db.transaction(D.storeName,F);O(null,G)}catch(W){if($>0&&(!D.db||W.name==="InvalidStateError"||W.name==="NotFoundError"))return l.resolve().then(function(){if(!D.db||W.name==="NotFoundError"&&!D.db.objectStoreNames.contains(D.storeName)&&D.version<=D.db.version)return D.db&&(D.version=D.db.version+1),z(D)}).then(function(){return B(D).then(function(){N(D,F,O,$-1)})}).catch(O);O(W)}}function H(){return{forages:[],db:null,dbReady:null,deferredOperations:[]}}function se(D){var F=this,O={db:null};if(D)for(var $ in D)O[$]=D[$];var G=d[O.name];G||(G=H(),d[O.name]=G),G.forages.push(F),F._initReady||(F._initReady=F.ready,F.ready=x);var W=[];function ie(){return l.resolve()}for(var ne=0;ne<G.forages.length;ne++){var ae=G.forages[ne];ae!==F&&W.push(ae._initReady().catch(ie))}var ce=G.forages.slice(0);return l.all(W).then(function(){return O.db=G.db,L(O)}).then(function(le){return O.db=le,J(O,F._defaultConfig.version)?z(O):le}).then(function(le){O.db=G.db=le,F._dbInfo=O;for(var ge=0;ge<ce.length;ge++){var Le=ce[ge];Le!==F&&(Le._dbInfo.db=O.db,Le._dbInfo.version=O.version)}})}function j(D,F){var O=this;D=C(D);var $=new l(function(G,W){O.ready().then(function(){N(O._dbInfo,v,function(ie,ne){if(ie)return W(ie);try{var ae=ne.objectStore(O._dbInfo.storeName),ce=ae.get(D);ce.onsuccess=function(){var le=ce.result;le===void 0&&(le=null),ee(le)&&(le=te(le)),G(le)},ce.onerror=function(){W(ce.error)}}catch(le){W(le)}})}).catch(W)});return m($,F),$}function V(D,F){var O=this,$=new l(function(G,W){O.ready().then(function(){N(O._dbInfo,v,function(ie,ne){if(ie)return W(ie);try{var ae=ne.objectStore(O._dbInfo.storeName),ce=ae.openCursor(),le=1;ce.onsuccess=function(){var ge=ce.result;if(ge){var Le=ge.value;ee(Le)&&(Le=te(Le));var Ue=D(Le,ge.key,le++);Ue!==void 0?G(Ue):ge.continue()}else G()},ce.onerror=function(){W(ce.error)}}catch(ge){W(ge)}})}).catch(W)});return m($,F),$}function X(D,F,O){var $=this;D=C(D);var G=new l(function(W,ie){var ne;$.ready().then(function(){return ne=$._dbInfo,p.call(F)==="[object Blob]"?b(ne.db).then(function(ae){return ae?F:re(F)}):F}).then(function(ae){N($._dbInfo,S,function(ce,le){if(ce)return ie(ce);try{var ge=le.objectStore($._dbInfo.storeName);ae===null&&(ae=void 0);var Le=ge.put(ae,D);le.oncomplete=function(){ae===void 0&&(ae=null),W(ae)},le.onabort=le.onerror=function(){var Ue=Le.error?Le.error:Le.transaction.error;ie(Ue)}}catch(Ue){ie(Ue)}})}).catch(ie)});return m(G,O),G}function M(D,F){var O=this;D=C(D);var $=new l(function(G,W){O.ready().then(function(){N(O._dbInfo,S,function(ie,ne){if(ie)return W(ie);try{var ae=ne.objectStore(O._dbInfo.storeName),ce=ae.delete(D);ne.oncomplete=function(){G()},ne.onerror=function(){W(ce.error)},ne.onabort=function(){var le=ce.error?ce.error:ce.transaction.error;W(le)}}catch(le){W(le)}})}).catch(W)});return m($,F),$}function T(D){var F=this,O=new l(function($,G){F.ready().then(function(){N(F._dbInfo,S,function(W,ie){if(W)return G(W);try{var ne=ie.objectStore(F._dbInfo.storeName),ae=ne.clear();ie.oncomplete=function(){$()},ie.onabort=ie.onerror=function(){var ce=ae.error?ae.error:ae.transaction.error;G(ce)}}catch(ce){G(ce)}})}).catch(G)});return m(O,D),O}function K(D){var F=this,O=new l(function($,G){F.ready().then(function(){N(F._dbInfo,v,function(W,ie){if(W)return G(W);try{var ne=ie.objectStore(F._dbInfo.storeName),ae=ne.count();ae.onsuccess=function(){$(ae.result)},ae.onerror=function(){G(ae.error)}}catch(ce){G(ce)}})}).catch(G)});return m(O,D),O}function q(D,F){var O=this,$=new l(function(G,W){if(D<0){G(null);return}O.ready().then(function(){N(O._dbInfo,v,function(ie,ne){if(ie)return W(ie);try{var ae=ne.objectStore(O._dbInfo.storeName),ce=!1,le=ae.openKeyCursor();le.onsuccess=function(){var ge=le.result;if(!ge){G(null);return}D===0||ce?G(ge.key):(ce=!0,ge.advance(D))},le.onerror=function(){W(le.error)}}catch(ge){W(ge)}})}).catch(W)});return m($,F),$}function Y(D){var F=this,O=new l(function($,G){F.ready().then(function(){N(F._dbInfo,v,function(W,ie){if(W)return G(W);try{var ne=ie.objectStore(F._dbInfo.storeName),ae=ne.openKeyCursor(),ce=[];ae.onsuccess=function(){var le=ae.result;if(!le){$(ce);return}ce.push(le.key),le.continue()},ae.onerror=function(){G(ae.error)}}catch(le){G(le)}})}).catch(G)});return m(O,D),O}function Z(D,F){F=y.apply(this,arguments);var O=this.config();D=typeof D!="function"&&D||{},D.name||(D.name=D.name||O.name,D.storeName=D.storeName||O.storeName);var $=this,G;if(!D.name)G=l.reject("Invalid arguments");else{var W=D.name===O.name&&$._dbInfo.db,ie=W?l.resolve($._dbInfo.db):L(D).then(function(ne){var ae=d[D.name],ce=ae.forages;ae.db=ne;for(var le=0;le<ce.length;le++)ce[le]._dbInfo.db=ne;return ne});D.storeName?G=ie.then(function(ne){if(ne.objectStoreNames.contains(D.storeName)){var ae=ne.version+1;k(D);var ce=d[D.name],le=ce.forages;ne.close();for(var ge=0;ge<le.length;ge++){var Le=le[ge];Le._dbInfo.db=null,Le._dbInfo.version=ae}var Ue=new l(function(Ne,ot){var nt=a.open(D.name,ae);nt.onerror=function(Dt){var _s=nt.result;_s.close(),ot(Dt)},nt.onupgradeneeded=function(){var Dt=nt.result;Dt.deleteObjectStore(D.storeName)},nt.onsuccess=function(){var Dt=nt.result;Dt.close(),Ne(Dt)}});return Ue.then(function(Ne){ce.db=Ne;for(var ot=0;ot<le.length;ot++){var nt=le[ot];nt._dbInfo.db=Ne,R(nt._dbInfo)}}).catch(function(Ne){throw(I(D,Ne)||l.resolve()).catch(function(){}),Ne})}}):G=ie.then(function(ne){k(D);var ae=d[D.name],ce=ae.forages;ne.close();for(var le=0;le<ce.length;le++){var ge=ce[le];ge._dbInfo.db=null}var Le=new l(function(Ue,Ne){var ot=a.deleteDatabase(D.name);ot.onerror=function(){var nt=ot.result;nt&&nt.close(),Ne(ot.error)},ot.onblocked=function(){console.warn('dropInstance blocked for database "'+D.name+'" until all open connections are closed')},ot.onsuccess=function(){var nt=ot.result;nt&&nt.close(),Ue(nt)}});return Le.then(function(Ue){ae.db=Ue;for(var Ne=0;Ne<ce.length;Ne++){var ot=ce[Ne];R(ot._dbInfo)}}).catch(function(Ue){throw(I(D,Ue)||l.resolve()).catch(function(){}),Ue})})}return m(G,F),G}var he={_driver:"asyncStorage",_initStorage:se,_support:u(),iterate:V,getItem:j,setItem:X,removeItem:M,clear:T,length:K,key:q,keys:Y,dropInstance:Z};function me(){return typeof openDatabase=="function"}var fe="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Ae="~~local_forage_type~",ue=/^~~local_forage_type~([^~]+)~/,ve="__lfsc__:",Me=ve.length,et="arbf",$e="blob",tt="si08",He="ui08",Ut="uic8",ut="si16",Nt="si32",oi="ur16",kt="ui32",je="fl32",rt="fl64",bt=Me+et.length,Oe=Object.prototype.toString;function Ni(D){var F=D.length*.75,O=D.length,$,G=0,W,ie,ne,ae;D[D.length-1]==="="&&(F--,D[D.length-2]==="="&&F--);var ce=new ArrayBuffer(F),le=new Uint8Array(ce);for($=0;$<O;$+=4)W=fe.indexOf(D[$]),ie=fe.indexOf(D[$+1]),ne=fe.indexOf(D[$+2]),ae=fe.indexOf(D[$+3]),le[G++]=W<<2|ie>>4,le[G++]=(ie&15)<<4|ne>>2,le[G++]=(ne&3)<<6|ae&63;return ce}function mi(D){var F=new Uint8Array(D),O="",$;for($=0;$<F.length;$+=3)O+=fe[F[$]>>2],O+=fe[(F[$]&3)<<4|F[$+1]>>4],O+=fe[(F[$+1]&15)<<2|F[$+2]>>6],O+=fe[F[$+2]&63];return F.length%3===2?O=O.substring(0,O.length-1)+"=":F.length%3===1&&(O=O.substring(0,O.length-2)+"=="),O}function Cr(D,F){var O="";if(D&&(O=Oe.call(D)),D&&(O==="[object ArrayBuffer]"||D.buffer&&Oe.call(D.buffer)==="[object ArrayBuffer]")){var $,G=ve;D instanceof ArrayBuffer?($=D,G+=et):($=D.buffer,O==="[object Int8Array]"?G+=tt:O==="[object Uint8Array]"?G+=He:O==="[object Uint8ClampedArray]"?G+=Ut:O==="[object Int16Array]"?G+=ut:O==="[object Uint16Array]"?G+=oi:O==="[object Int32Array]"?G+=Nt:O==="[object Uint32Array]"?G+=kt:O==="[object Float32Array]"?G+=je:O==="[object Float64Array]"?G+=rt:F(new Error("Failed to get type for BinaryArray"))),F(G+mi($))}else if(O==="[object Blob]"){var W=new FileReader;W.onload=function(){var ie=Ae+D.type+"~"+mi(this.result);F(ve+$e+ie)},W.readAsArrayBuffer(D)}else try{F(JSON.stringify(D))}catch(ie){console.error("Couldn't convert value into a JSON string: ",D),F(null,ie)}}function ls(D){if(D.substring(0,Me)!==ve)return JSON.parse(D);var F=D.substring(bt),O=D.substring(Me,bt),$;if(O===$e&&ue.test(F)){var G=F.match(ue);$=G[1],F=F.substring(G[0].length)}var W=Ni(F);switch(O){case et:return W;case $e:return _([W],{type:$});case tt:return new Int8Array(W);case He:return new Uint8Array(W);case Ut:return new Uint8ClampedArray(W);case ut:return new Int16Array(W);case oi:return new Uint16Array(W);case Nt:return new Int32Array(W);case kt:return new Uint32Array(W);case je:return new Float32Array(W);case rt:return new Float64Array(W);default:throw new Error("Unkown type: "+O)}}var us={serialize:Cr,deserialize:ls,stringToBuffer:Ni,bufferToString:mi};function to(D,F,O,$){D.executeSql("CREATE TABLE IF NOT EXISTS "+F.storeName+" (id INTEGER PRIMARY KEY, key unique, value)",[],O,$)}function Fh(D){var F=this,O={db:null};if(D)for(var $ in D)O[$]=typeof D[$]!="string"?D[$].toString():D[$];var G=new l(function(W,ie){try{O.db=openDatabase(O.name,String(O.version),O.description,O.size)}catch(ne){return ie(ne)}O.db.transaction(function(ne){to(ne,O,function(){F._dbInfo=O,W()},function(ae,ce){ie(ce)})},ie)});return O.serializer=us,G}function gi(D,F,O,$,G,W){D.executeSql(O,$,G,function(ie,ne){ne.code===ne.SYNTAX_ERR?ie.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name = ?",[F.storeName],function(ae,ce){ce.rows.length?W(ae,ne):to(ae,F,function(){ae.executeSql(O,$,G,W)},W)},W):W(ie,ne)},W)}function zh(D,F){var O=this;D=C(D);var $=new l(function(G,W){O.ready().then(function(){var ie=O._dbInfo;ie.db.transaction(function(ne){gi(ne,ie,"SELECT * FROM "+ie.storeName+" WHERE key = ? LIMIT 1",[D],function(ae,ce){var le=ce.rows.length?ce.rows.item(0).value:null;le&&(le=ie.serializer.deserialize(le)),G(le)},function(ae,ce){W(ce)})})}).catch(W)});return m($,F),$}function Hh(D,F){var O=this,$=new l(function(G,W){O.ready().then(function(){var ie=O._dbInfo;ie.db.transaction(function(ne){gi(ne,ie,"SELECT * FROM "+ie.storeName,[],function(ae,ce){for(var le=ce.rows,ge=le.length,Le=0;Le<ge;Le++){var Ue=le.item(Le),Ne=Ue.value;if(Ne&&(Ne=ie.serializer.deserialize(Ne)),Ne=D(Ne,Ue.key,Le+1),Ne!==void 0){G(Ne);return}}G()},function(ae,ce){W(ce)})})}).catch(W)});return m($,F),$}function io(D,F,O,$){var G=this;D=C(D);var W=new l(function(ie,ne){G.ready().then(function(){F===void 0&&(F=null);var ae=F,ce=G._dbInfo;ce.serializer.serialize(F,function(le,ge){ge?ne(ge):ce.db.transaction(function(Le){gi(Le,ce,"INSERT OR REPLACE INTO "+ce.storeName+" (key, value) VALUES (?, ?)",[D,le],function(){ie(ae)},function(Ue,Ne){ne(Ne)})},function(Le){if(Le.code===Le.QUOTA_ERR){if($>0){ie(io.apply(G,[D,ae,O,$-1]));return}ne(Le)}})})}).catch(ne)});return m(W,O),W}function qh(D,F,O){return io.apply(this,[D,F,O,1])}function Wh(D,F){var O=this;D=C(D);var $=new l(function(G,W){O.ready().then(function(){var ie=O._dbInfo;ie.db.transaction(function(ne){gi(ne,ie,"DELETE FROM "+ie.storeName+" WHERE key = ?",[D],function(){G()},function(ae,ce){W(ce)})})}).catch(W)});return m($,F),$}function $h(D){var F=this,O=new l(function($,G){F.ready().then(function(){var W=F._dbInfo;W.db.transaction(function(ie){gi(ie,W,"DELETE FROM "+W.storeName,[],function(){$()},function(ne,ae){G(ae)})})}).catch(G)});return m(O,D),O}function jh(D){var F=this,O=new l(function($,G){F.ready().then(function(){var W=F._dbInfo;W.db.transaction(function(ie){gi(ie,W,"SELECT COUNT(key) as c FROM "+W.storeName,[],function(ne,ae){var ce=ae.rows.item(0).c;$(ce)},function(ne,ae){G(ae)})})}).catch(G)});return m(O,D),O}function Gh(D,F){var O=this,$=new l(function(G,W){O.ready().then(function(){var ie=O._dbInfo;ie.db.transaction(function(ne){gi(ne,ie,"SELECT key FROM "+ie.storeName+" WHERE id = ? LIMIT 1",[D+1],function(ae,ce){var le=ce.rows.length?ce.rows.item(0).key:null;G(le)},function(ae,ce){W(ce)})})}).catch(W)});return m($,F),$}function Vh(D){var F=this,O=new l(function($,G){F.ready().then(function(){var W=F._dbInfo;W.db.transaction(function(ie){gi(ie,W,"SELECT key FROM "+W.storeName,[],function(ne,ae){for(var ce=[],le=0;le<ae.rows.length;le++)ce.push(ae.rows.item(le).key);$(ce)},function(ne,ae){G(ae)})})}).catch(G)});return m(O,D),O}function Kh(D){return new l(function(F,O){D.transaction(function($){$.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name <> '__WebKitDatabaseInfoTable__'",[],function(G,W){for(var ie=[],ne=0;ne<W.rows.length;ne++)ie.push(W.rows.item(ne).name);F({db:D,storeNames:ie})},function(G,W){O(W)})},function($){O($)})})}function Yh(D,F){F=y.apply(this,arguments);var O=this.config();D=typeof D!="function"&&D||{},D.name||(D.name=D.name||O.name,D.storeName=D.storeName||O.storeName);var $=this,G;return D.name?G=new l(function(W){var ie;D.name===O.name?ie=$._dbInfo.db:ie=openDatabase(D.name,"","",0),D.storeName?W({db:ie,storeNames:[D.storeName]}):W(Kh(ie))}).then(function(W){return new l(function(ie,ne){W.db.transaction(function(ae){function ce(Ue){return new l(function(Ne,ot){ae.executeSql("DROP TABLE IF EXISTS "+Ue,[],function(){Ne()},function(nt,Dt){ot(Dt)})})}for(var le=[],ge=0,Le=W.storeNames.length;ge<Le;ge++)le.push(ce(W.storeNames[ge]));l.all(le).then(function(){ie()}).catch(function(Ue){ne(Ue)})},function(ae){ne(ae)})})}):G=l.reject("Invalid arguments"),m(G,F),G}var Xh={_driver:"webSQLStorage",_initStorage:Fh,_support:me(),iterate:Hh,getItem:zh,setItem:qh,removeItem:Wh,clear:$h,length:jh,key:Gh,keys:Vh,dropInstance:Yh};function Jh(){try{return typeof localStorage<"u"&&"setItem"in localStorage&&!!localStorage.setItem}catch{return!1}}function so(D,F){var O=D.name+"/";return D.storeName!==F.storeName&&(O+=D.storeName+"/"),O}function Qh(){var D="_localforage_support_test";try{return localStorage.setItem(D,!0),localStorage.removeItem(D),!1}catch{return!0}}function Zh(){return!Qh()||localStorage.length>0}function ec(D){var F=this,O={};if(D)for(var $ in D)O[$]=D[$];return O.keyPrefix=so(D,F._defaultConfig),Zh()?(F._dbInfo=O,O.serializer=us,l.resolve()):l.reject()}function tc(D){var F=this,O=F.ready().then(function(){for(var $=F._dbInfo.keyPrefix,G=localStorage.length-1;G>=0;G--){var W=localStorage.key(G);W.indexOf($)===0&&localStorage.removeItem(W)}});return m(O,D),O}function ic(D,F){var O=this;D=C(D);var $=O.ready().then(function(){var G=O._dbInfo,W=localStorage.getItem(G.keyPrefix+D);return W&&(W=G.serializer.deserialize(W)),W});return m($,F),$}function sc(D,F){var O=this,$=O.ready().then(function(){for(var G=O._dbInfo,W=G.keyPrefix,ie=W.length,ne=localStorage.length,ae=1,ce=0;ce<ne;ce++){var le=localStorage.key(ce);if(le.indexOf(W)===0){var ge=localStorage.getItem(le);if(ge&&(ge=G.serializer.deserialize(ge)),ge=D(ge,le.substring(ie),ae++),ge!==void 0)return ge}}});return m($,F),$}function rc(D,F){var O=this,$=O.ready().then(function(){var G=O._dbInfo,W;try{W=localStorage.key(D)}catch{W=null}return W&&(W=W.substring(G.keyPrefix.length)),W});return m($,F),$}function nc(D){var F=this,O=F.ready().then(function(){for(var $=F._dbInfo,G=localStorage.length,W=[],ie=0;ie<G;ie++){var ne=localStorage.key(ie);ne.indexOf($.keyPrefix)===0&&W.push(ne.substring($.keyPrefix.length))}return W});return m(O,D),O}function oc(D){var F=this,O=F.keys().then(function($){return $.length});return m(O,D),O}function ac(D,F){var O=this;D=C(D);var $=O.ready().then(function(){var G=O._dbInfo;localStorage.removeItem(G.keyPrefix+D)});return m($,F),$}function hc(D,F,O){var $=this;D=C(D);var G=$.ready().then(function(){F===void 0&&(F=null);var W=F;return new l(function(ie,ne){var ae=$._dbInfo;ae.serializer.serialize(F,function(ce,le){if(le)ne(le);else try{localStorage.setItem(ae.keyPrefix+D,ce),ie(W)}catch(ge){(ge.name==="QuotaExceededError"||ge.name==="NS_ERROR_DOM_QUOTA_REACHED")&&ne(ge),ne(ge)}})})});return m(G,O),G}function cc(D,F){if(F=y.apply(this,arguments),D=typeof D!="function"&&D||{},!D.name){var O=this.config();D.name=D.name||O.name,D.storeName=D.storeName||O.storeName}var $=this,G;return D.name?G=new l(function(W){D.storeName?W(so(D,$._defaultConfig)):W(D.name+"/")}).then(function(W){for(var ie=localStorage.length-1;ie>=0;ie--){var ne=localStorage.key(ie);ne.indexOf(W)===0&&localStorage.removeItem(ne)}}):G=l.reject("Invalid arguments"),m(G,F),G}var lc={_driver:"localStorageWrapper",_initStorage:ec,_support:Jh(),iterate:sc,getItem:ic,setItem:hc,removeItem:ac,clear:tc,length:oc,key:rc,keys:nc,dropInstance:cc},uc=function(F,O){return F===O||typeof F=="number"&&typeof O=="number"&&isNaN(F)&&isNaN(O)},dc=function(F,O){for(var $=F.length,G=0;G<$;){if(uc(F[G],O))return!0;G++}return!1},ro=Array.isArray||function(D){return Object.prototype.toString.call(D)==="[object Array]"},ds={},no={},Fi={INDEXEDDB:he,WEBSQL:Xh,LOCALSTORAGE:lc},_c=[Fi.INDEXEDDB._driver,Fi.WEBSQL._driver,Fi.LOCALSTORAGE._driver],Hs=["dropInstance"],Er=["clear","getItem","iterate","key","keys","length","removeItem","setItem"].concat(Hs),fc={description:"",driver:_c.slice(),name:"localforage",size:4980736,storeName:"keyvaluepairs",version:1};function pc(D,F){D[F]=function(){var O=arguments;return D.ready().then(function(){return D[F].apply(D,O)})}}function kr(){for(var D=1;D<arguments.length;D++){var F=arguments[D];if(F)for(var O in F)F.hasOwnProperty(O)&&(ro(F[O])?arguments[0][O]=F[O].slice():arguments[0][O]=F[O])}return arguments[0]}var mc=(function(){function D(F){c(this,D);for(var O in Fi)if(Fi.hasOwnProperty(O)){var $=Fi[O],G=$._driver;this[O]=G,ds[G]||this.defineDriver($)}this._defaultConfig=kr({},fc),this._config=kr({},this._defaultConfig,F),this._driverSet=null,this._initDriver=null,this._ready=!1,this._dbInfo=null,this._wrapLibraryMethodsWithReady(),this.setDriver(this._config.driver).catch(function(){})}return D.prototype.config=function(O){if((typeof O>"u"?"undefined":o(O))==="object"){if(this._ready)return new Error("Can't call config() after localforage has been used.");for(var $ in O){if($==="storeName"&&(O[$]=O[$].replace(/\W/g,"_")),$==="version"&&typeof O[$]!="number")return new Error("Database version must be a number.");this._config[$]=O[$]}return"driver"in O&&O.driver?this.setDriver(this._config.driver):!0}else return typeof O=="string"?this._config[O]:this._config},D.prototype.defineDriver=function(O,$,G){var W=new l(function(ie,ne){try{var ae=O._driver,ce=new Error("Custom driver not compliant; see https://mozilla.github.io/localForage/#definedriver");if(!O._driver){ne(ce);return}for(var le=Er.concat("_initStorage"),ge=0,Le=le.length;ge<Le;ge++){var Ue=le[ge],Ne=!dc(Hs,Ue);if((Ne||O[Ue])&&typeof O[Ue]!="function"){ne(ce);return}}var ot=function(){for(var _s=function(yc){return function(){var bc=new Error("Method "+yc+" is not implemented by the current driver"),oo=l.reject(bc);return m(oo,arguments[arguments.length-1]),oo}},xr=0,vc=Hs.length;xr<vc;xr++){var Ar=Hs[xr];O[Ar]||(O[Ar]=_s(Ar))}};ot();var nt=function(_s){ds[ae]&&console.info("Redefining LocalForage driver: "+ae),ds[ae]=O,no[ae]=_s,ie()};"_support"in O?O._support&&typeof O._support=="function"?O._support().then(nt,ne):nt(!!O._support):nt(!0)}catch(Dt){ne(Dt)}});return g(W,$,G),W},D.prototype.driver=function(){return this._driver||null},D.prototype.getDriver=function(O,$,G){var W=ds[O]?l.resolve(ds[O]):l.reject(new Error("Driver not found."));return g(W,$,G),W},D.prototype.getSerializer=function(O){var $=l.resolve(us);return g($,O),$},D.prototype.ready=function(O){var $=this,G=$._driverSet.then(function(){return $._ready===null&&($._ready=$._initDriver()),$._ready});return g(G,O,O),G},D.prototype.setDriver=function(O,$,G){var W=this;ro(O)||(O=[O]);var ie=this._getSupportedDrivers(O);function ne(){W._config.driver=W.driver()}function ae(ge){return W._extend(ge),ne(),W._ready=W._initStorage(W._config),W._ready}function ce(ge){return function(){var Le=0;function Ue(){for(;Le<ge.length;){var Ne=ge[Le];return Le++,W._dbInfo=null,W._ready=null,W.getDriver(Ne).then(ae).catch(Ue)}ne();var ot=new Error("No available storage method found.");return W._driverSet=l.reject(ot),W._driverSet}return Ue()}}var le=this._driverSet!==null?this._driverSet.catch(function(){return l.resolve()}):l.resolve();return this._driverSet=le.then(function(){var ge=ie[0];return W._dbInfo=null,W._ready=null,W.getDriver(ge).then(function(Le){W._driver=Le._driver,ne(),W._wrapLibraryMethodsWithReady(),W._initDriver=ce(ie)})}).catch(function(){ne();var ge=new Error("No available storage method found.");return W._driverSet=l.reject(ge),W._driverSet}),g(this._driverSet,$,G),this._driverSet},D.prototype.supports=function(O){return!!no[O]},D.prototype._extend=function(O){kr(this,O)},D.prototype._getSupportedDrivers=function(O){for(var $=[],G=0,W=O.length;G<W;G++){var ie=O[G];this.supports(ie)&&$.push(ie)}return $},D.prototype._wrapLibraryMethodsWithReady=function(){for(var O=0,$=Er.length;O<$;O++)pc(this,Er[O])},D.prototype.createInstance=function(O){return new D(O)},D})(),gc=new mc;s.exports=gc},{3:3}]},{},[4])(4)})})(nn)),nn.exports}var km=Em();const Vi=ph(km),ka="fs",xa="ide";class xm{static async getKey(t,i=""){return`guest:${t}:${i}`}static async get(t){const i=await this.getKey(t);return await Vi.getItem(i)}static async set(t,i){const s=await this.getKey(t);return await Vi.setItem(s,i)}static async getIDE(t){const i=await this.getKey(xa,t);return await Vi.getItem(i)}static async setIDE(t,i){const s=await this.getKey(xa,t);return await Vi.setItem(s,i)}static async getFS(t){if(!t)return[];const i=await this.getKey(ka,t);return await Vi.getItem(i)||[]}static async setFS(t,i){if(!t)throw"Stopped saving FS state because moved away from terminal.";En(wm,"Saving FS state...");const s=await this.getKey(ka,t);return await Vi.setItem(s,i)}}function En(e,...t){bm>=e&&console.log(...t)}function Aa(e){return e.split("").map(i=>i.charCodeAt(0))}const Ra="terminal",Nh="terminal-hidden",ks="bus",Ta="__sandbox__",pt=el({emulator:null,listeners:[],xterm:null,addons:{serialize:null,fit:null,links:null},exec:(e,{mode:t=Ra,callbackExercise:i=null}={})=>{let s=`${e}
`;s=s.replace(/ \\ /g,"");const n=Aa(s),o=Gt(pt).emulator;if(!o){console.error("Emulator not ready");return}if(i){s=`(${e} && echo ${Ta}) > ${Cm}
`;let c="";const r=a=>{const u=String.fromCharCode(a);c+=u;const _=c.indexOf(Ta);_>-1&&(i(c.slice(0,_)),o.remove_listener(Ca,r))};o.add_listener(Ca,r)}t===Ra&&n.forEach(c=>o.bus.send(Cn,c)),t===ks&&o.keyboard_send_text(s),t===Nh&&(o.bus.listeners[Es]=[],n.forEach(c=>o.bus.send(Cn,c)),setTimeout(()=>{o.bus.listeners[Es]=Gt(pt).listeners},500))},ls:e=>{const t=Gt(pt).emulator;if(!t)return console.error("Emulator not ready"),[];let i=[];const s=t.fs9p.read_dir(e);for(const n of s){const o=`${e}/${n}`,c=t.fs9p.SearchPath(o),r=t.fs9p.IsDirectory(c.id);i.push({path:o,isDir:r}),t.fs9p.IsDirectory(c.id)&&(i=i.concat(Gt(pt).ls(o)))}return i},mountFile:async(e,t)=>{let i;if(typeof t=="string"){const o=t;i=await fetch(o).then(r=>r.blob()),o.split("/").pop()}else i=t,t.name;const s=await i.arrayBuffer(),n=new Uint8Array(s);return await Gt(pt).createFile(e,n),e},readFile:async e=>{const t=Gt(pt).emulator;if(!t){console.error("FS not ready yet");return}if(t.fs9p.SearchPath(e).id===-1){console.error("File not found");return}try{return await t.read_file(e)}catch(s){if(s instanceof Error&&s.message==="File not found")return new Uint8Array(0);s instanceof Error&&console.error(s.message)}},createFile:async(e,t)=>{const i=Gt(pt).emulator;if(!i){console.error("Emulator not ready");return}let s;t instanceof Uint8Array?s=t:(s=new Uint8Array(t.length),s.set(Aa(t)));const n=e.split("/").slice(0,-1).join("/");await Gt(pt).createFolder(n),await i.create_file(e,s)},createFolder:async e=>{const t=Gt(pt).emulator;if(!t){console.error("Emulator not ready");return}let i="";const s=e.split("/");for(const n of s){i+=`${n}/`;const o=t.fs9p.SearchPath(i);o.id===-1&&t.fs9p.CreateDirectory(n,o.parentid)}},clearCache:async()=>{Gt(pt).exec("sync; echo 3 >/proc/sys/vm/drop_caches",{mode:ks}),await new Promise(e=>setTimeout(e,200))}});var Am=Be("<!> <!>",1),Rm=Be('<span class="text-success fw-bold">ok</span>'),Tm=Be("<span> </span> <!> <br/>",1),Lm=Be('<div style="position:absolute"><div class="text-light font-monospace small"><!> <!></div></div>'),Dm=cr('<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M9.5 13a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0m0-5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0m0-5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0"></path></svg>'),Im=Be("<!> <!> <!>",1),Om=Be("<!> <!>",1),Pm=Be('<!> <div id="terminal"><div class="cli-options svelte-k4so18"><!></div></div>  <input type="file" style="display:none" multiple/> <input type="file" style="display:none" multiple webkitdirectory/>',1);function Mm(e,t){Fe(t,!1);const i=()=>il(pt,"$cli",s),[s,n]=tl();window.Terminal=Kp.Terminal;let o=Hi(t,"terminalId",8,"terminal"),c=Hi(t,"files",24,()=>[]),r=Hi(t,"assets",24,()=>[]),a=Hi(t,"init",8,""),u=Hi(t,"tools",24,()=>[]),_=Hi(t,"intro",8,""),l=Di(!0),m=Di([]),g=Di(!1),C=Di(),y=Di(),h=Di(),f,d,p=!1,v=0;const S=1;function w(){return{url:"",v86:""}}Na(()=>Kt(g,!0)),An(E);function E(){clearTimeout(f),clearInterval(d)}function b(X){Kt(m,[...U(m),X])}function k(X){if(p){console.log("Already initializing, skipping...");return}if(v>=S){console.error("Max initialization retries reached. Terminal failed to load."),p=!1,Kt(l,!1);return}console.log("Initializing terminal...",X),p=!0,Kt(l,!0),console.time("initialize"),b("Setting up your terminal..."),E(),console.log(i().emulator),i().emulator&&i().emulator.serial_adapter&&i().emulator.destroy,qi(pt,ft(i).emulator=null,ft(i));const M=w();qi(pt,ft(i).emulator=new ym({wasm_path:`${M.url}/v86/v86.wasm`,memory_size:512*1024*1024,vga_memory_size:8*1024*1024,initial_state:{url:`${M.url}/v86/alpine-state.bin.zst`,size:50*1024*1024},filesystem:{baseurl:`${M.url}/v86/alpine-rootfs-flat/`,basefs:`${M.url}/v86/alpine-fs.json`},bios:{url:`${M.url}/v86/bios/seabios.bin`,size:512*1024},vga_bios:{url:`${M.url}/v86/bios/vgabios.bin`,size:512*1024},autostart:!0,screen_container:null,serial_container_xtermjs:U(C),disable_mouse:!0,disable_speaker:!0,bzimage_initrd_from_filesystem:!0,cmdline:"rw root=host9p rootfstype=9p rootflags=trans=virtio,cache=loose modules=virtio_pci tsc=reliable"}),ft(i));let T="";i().emulator.add_listener(Sm,async Y=>{const Z=String.fromCharCode(Y);if(Z!==`
`)T+=Z;else{try{const he=JSON.parse(T),me=he.params;if(console.log("Command:",he),he.type==="open"){const fe=await i().emulator.read_file(me.path),Ae=new Blob([fe],{type:me.path.endsWith(".html")?"text/html":"text/plain"}),ue=URL.createObjectURL(Ae);window.open(ue)}else if(he.type==="download"){const fe=await i().emulator.read_file(me.path),Ae=new Blob([fe],{type:"application/octet-stream"}),ue=URL.createObjectURL(Ae),ve=document.createElement("a");ve.href=ue,ve.download=me.path.split("/").pop()||"download",ve.click()}else if(he.type==="fetch"&&me.url&&me.output&&me.sentinel){const fe=await fetch(me.url).then(Ae=>Ae.arrayBuffer());await i().emulator.create_file(me.output,new Uint8Array(fe)),await i().emulator.create_file(me.sentinel,new Uint8Array([]))}}catch(he){console.log("Received:",T),console.error(he)}T=""}});let K="";const q=async Y=>K+=String.fromCharCode(Y);i().emulator.add_listener(Es,q),i().emulator.bus.register("emulator-loaded",async()=>{if(qi(pt,ft(i).xterm=i().emulator.serial_adapter.term,ft(i)),console.log("Xterm.js terminal:",i().xterm),qi(pt,ft(i).listeners=i().emulator.bus.listeners[Es],ft(i)),!i().xterm){Kt(l,!1),p=!1,v++,console.warn("Could not load terminal; serial_adapter not defined."),setTimeout(()=>k(o()),500);return}v=0,qi(pt,ft(i).addons={serialize:new Gp.SerializeAddon,fit:new Hp.FitAddon,links:new Wp.WebLinksAddon},ft(i));for(const Y in i().addons){const Z=i().addons[Y];Z&&i().xterm.loadAddon(Z)}console.log("Terminal ready.",i()),b("Loading files..."),await z(),await L(),i().exec("sync & echo & ls & ll & pwd",{mode:ks}),i().exec(u().map(Y=>`timeout 2 ${Y}`).join(" & "),{mode:ks}),b("Initializing environment..."),i().exec(a()),I(!0),i().xterm.focus(),qi(pt,ft(i).xterm.options.cursorBlink=!0,ft(i)),i().exec(`date -s "${new Date().toString()}"`,{mode:ks}),b("Putting the finishing touches..."),d=setInterval(()=>{K.includes("")?(i().emulator.remove_listener(Es,q),clearInterval(d),Kt(l,!1),p=!1,console.timeEnd("initialize"),P()):i().emulator.bus.send(Cn,12)},200),console.log("Emulator setup complete."),_()&&(console.log("Writing intro to terminal."),setTimeout(()=>{i().xterm?.write(_()),i().exec("")},1e3))})}let R={cols:null,rows:null};function I(X=!1){if(U(l)&&!X||!i().addons.fit)return;i().addons.fit.fit();const M=i().addons.fit.proposeDimensions();!M?.cols||!M?.rows||R.cols===M.cols&&R.rows===M.rows||(R=M,X?En(Sa,"Set terminal size",M):En(Sa,"Resize terminal",M),i().exec(`stty rows ${M.rows} cols ${M.cols}`,{mode:X?Nh:void 0}))}async function P(){}async function L(){const X=await xm.getFS(o());for(const M of X)M.isDir?await i().createFolder(M.path):M.contents?await i().createFile(M.path,M.contents):console.warn(`Skipping file ${M?.path} because too large to save in browser.`)}async function z(){await i().clearCache();for(const X of c()){const M=`/data/${o()}/${X}`;await i().mountFile(`${wa}/${X}`,M)}for(const X of r()||[]){const M=`https://assets.sandbox.bio/tutorials/${o()}/${X}`;await i().mountFile(`${wa}/${X}`,M)}}function J(){const X=i().addons.serialize?.serialize();if(!X){console.warn("Could not export terminal contents; terminal not ready yet.");return}const M="<pre>"+new Ep().ansi_to_html(X)+"</pre>",T=new Blob([M],{type:"text/html"}),K=URL.createObjectURL(T);window.open(K)}async function re(X){const M=X.target,T=M.files;if(!T){console.warn("No file specified.");return}const K=[];for(const Y of T){const Z=Y?.webkitRelativePath||Y.name;K.push(await i().mountFile(`/root/${Z}`,Y))}const q=K.join(`
\r# `);i().xterm?.write(`

\r\x1B[0;32m# Files mounted:
\r# ${q}\x1B[0m

\r`),i().exec(""),M.value=""}Yc(()=>(U(g),Ba(o())),()=>{U(g)&&o()&&k(o())}),Xc(),wc();var te=Pm(),ee=ye(te);{var x=X=>{var M=Lm(),T=De(M),K=De(T);Vs(K,{value:null,class:"w-fit inline-block align-middle",children:(Y,Z)=>{Vs.Circle(Y,{style:"--size: 20px; --thickness: 3px;",children:(he,me)=>{var fe=Am(),Ae=ye(fe);Vs.CircleTrack(Ae,{});var ue=vt(Ae,2);Vs.CircleRange(ue,{}),oe(he,fe)},$$slots:{default:!0}})},$$slots:{default:!0}});var q=vt(K,2);ln(q,1,()=>U(m),cn,(Y,Z,he)=>{var me=Tm(),fe=ye(me);uo(fe,1,"",null,{},{"ps-4":he>0});var Ae=De(fe,!0);Te(fe);var ue=vt(fe,2);{var ve=Me=>{var et=Rm();oe(Me,et)};We(ue,Me=>{U(m),ft(()=>he<U(m).length-1)&&Me(ve)})}Xi(2),xs(()=>Ii(Ae,U(Z))),oe(Y,me)}),Te(T),Te(M),oe(X,M)};We(ee,X=>{U(l)&&X(x)})}var B=vt(ee,2);let N;var H=De(B),se=De(H);Vt(se,{children:(X,M)=>{var T=Om(),K=ye(T);Vt.Trigger(K,{class:"btn btn-dark btn-sm",children:(Y,Z)=>{var he=Dm();oe(Y,he)},$$slots:{default:!0}});var q=vt(K,2);Vt.Positioner(q,{children:(Y,Z)=>{Vt.Content(Y,{class:"bg-dark text-light border border-secondary rounded shadow-lg p-1",children:(he,me)=>{var fe=Im(),Ae=ye(fe);Vt.Item(Ae,{value:"mount-files",onclick:()=>U(y).click(),class:"menu-item",children:(Me,et)=>{Vt.ItemText(Me,{children:($e,tt)=>{Xi();var He=Qs("Mount local files");oe($e,He)},$$slots:{default:!0}})},$$slots:{default:!0}});var ue=vt(Ae,2);Vt.Item(ue,{value:"mount-folder",onclick:()=>U(h).click(),class:"menu-item",children:(Me,et)=>{Vt.ItemText(Me,{children:($e,tt)=>{Xi();var He=Qs("Mount local folder");oe($e,He)},$$slots:{default:!0}})},$$slots:{default:!0}});var ve=vt(ue,2);Vt.Item(ve,{value:"export",onclick:J,class:"menu-item",children:(Me,et)=>{Vt.ItemText(Me,{children:($e,tt)=>{Xi();var He=Qs("Export as HTML");oe($e,He)},$$slots:{default:!0}})},$$slots:{default:!0}}),oe(he,fe)},$$slots:{default:!0}})},$$slots:{default:!0}}),oe(X,T)},$$slots:{default:!0}}),Te(H),Te(B),Dr(B,X=>Kt(C,X),()=>U(C)),ol(B,(X,M)=>Fp?.(X,M),()=>()=>I());var j=vt(B,2);Dr(j,X=>Kt(y,X),()=>U(y));var V=vt(j,2);Dr(V,X=>Kt(h,X),()=>U(h)),xs(()=>N=uo(B,1,"svelte-k4so18",null,N,{"opacity-0":U(l)})),ao("change",j,re),ao("change",V,re),oe(e,te),ze(),n()}var Bm=Be('<a target="_blank" rel="noopener noreferrer" class="card preset-tonal hover:preset-filled transition-all duration-200 p-6 space-y-2 group"><h3 class="h4 group-hover:underline"> </h3> <p class="opacity-70"> </p></a>'),Um=Be("<tr><td> </td><td> </td><td> </td></tr>"),Nm=Be('<main class="container mx-auto p-4"><header class="py-6 space-y-2"><h2 class="h6 opacity-60"><a class="hover:underline" href="https://www.abacbs.org/abacbs2025">ABACBS 2025</a></h2> <h3 class="h3">Client-side Bioinformatics</h3> <h4 class=" text-lg italic">Building bioinformatics tools for the browser with WebAssembly</h4></header> <div class="card preset-filled-surface-100-900 border border-surface-200-800 divide-surface-200-800 divide-y"><article class="p-0 bg-black min-h-96"><!></article> <footer class="flex items-center justify-between gap-4 p-4"><small class="opacity-60">Modified from <a class="underline" href="https://sandbox.bio">sandbox.bio</a></small> <small class="opacity-60">ABACBS Wasm Workshop</small></footer></div> <h2 class="h4 mt-8">Demo Links</h2> <p class="mt-2">Explore these WebAssembly-based demos that run entirely in your browser (<a href="https://github.com/orgs/wasmodic/repositories" class="underline">templates on github</a>)</p> <section class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mt-6 mb-8"></section> <h2 class="h4 mt-8">Workshop Schedule</h2> <div class="table-wrap"><table class="table caption-bottom"><thead><tr><th>Section</th><th>Presenter</th><th>Time</th></tr></thead><tbody class="[&amp;>tr]:hover:preset-tonal-primary"></tbody></table></div> <h2 class="h4 mt-8">Resources</h2> <p class="mt-2">Here are some useful resources to get started with WebAssembly in bioinformatics:</p> <ul class="list-disc list-inside mt-4 space-y-2"><li><a target="_blank" class="underline" href="https://webassembly.org/">WebAssembly Official Site</a></li> <li><a target="_blank" class="underline" href="https://emscripten.org/">Emscripten Documentation</a></li> <li><a target="_blank" class="underline" href="https://biowasm.com/">Biowasm Overview</a></li> <li><a target="_blank" class="underline" href="https://docs.r-wasm.org/webr/latest/">WebR Documnetation</a></li> <li><a target="_blank" class="underline" href="https://webr.sh/">WebR IDE example</a></li> <li><a target="_blank" class="underline" href="https://docs.pyscript.net/2025.11.2/">PyScript Documentation</a></li> <li><a target="_blank" class="underline" href="https://pyodide.org/en/stable/">Pyodide Documentation</a></li> <li><a target="_blank" class="underline" href="https://jupyterlite.readthedocs.io/en/stable/">JupyterLite Documentation</a></li> <li><a target="_blank" class="underline" href="https://posit-dev.github.io/r-shinylive/">Shinylive R Documentation</a></li> <li><a target="_blank" class="underline" href="https://shinylive.io/r/examples/">Shinylive R Examples</a></li> <li><a target="_blank" class="underline" href="https://shiny.posit.co/py/get-started/shinylive.html">Shinylive Python Documentation</a></li> <li><a target="_blank" class="underline" href="https://shinylive.io/py/examples/">Shinylive Python Exmaples</a></li> <li><a target="_blank" class="underline" href="/Wasm-workshop-ABACBS.pdf">Slides</a></li></ul></main>');function Vm(e){const t=[{name:"WebR",description:"R running in the browser via WebAssembly to perform bioinformatics analyses",link:"https://wasmodic.github.io/webr/"},{name:"Pyscript Exercise",description:"PyScript makes it easy to create rich Python applications in the browser using HTML components",link:"https://wasmodic.github.io/pyscript/"},{name:"Pyodide",description:"Python running in the browser via WebAssembly to perform bioinformatics analyses",link:"https://wasmodic.github.io/pyodide/"},{name:"JupyterLite",description:"JupyterLab running entirely in the browser using WebAssembly for a rich interactive computing experience",link:"https://wasmodic.github.io/jupyterlite/"},{name:"ShinyLive (Python)",description:"Run Python Shiny applications entirely in the browser using WebAssembly",link:"https://shinylive.io/py/app/#gist=145aeacadb9bfe52ea708c6a0574f9a4"},{name:"ShinyLive (R)",description:"Run R Shiny applications entirely in the browser using WebAssembly",link:"https://shinylive.io/r/app/#code=NobwRAdghgtgpmAXGKAHVA6ASmANGAYwHsIAXOMpMAGwEsAjAJykYE8AKAZwAtaJWAlAB0IdJiw4BzSampFSAJmEQRnOKQxq4AE3YBGBQGZDAFgCsh5SJhQA1nAD6zCNqIwHagI4ACADwBabwAzAFcIAlJaEnYIbwBebzMABgFvEBFvb1QoTnIkrlhZOHYCdiEwAEFy3HKAYWrygHEGsAAVcoFcbwguxjhZKAI4eO9WrABVAFFO72JqajQ1EfKOkQBfEWs7R08QqDpSVgcgokYHKAA3ST9A0PDI6NIWSXVzq67YhOTU9Nis7j62k4N28fVQ7CejBepDekg+ykyOQItFomQC-0BwIA1N5jBksjk8uw+KRWkRxqQggAOdhIlEzOYLVBLBIrMDKDYqCAAOQcWEmFQAIgBlEEmJKZbwAYhEQUJngcdAgcGB6NKVggJ0Y3nYPj43j0iF5-KFwp++K8IJs9icUBcbg8cE87G++N2+yt2wc7oORy1sN1HxGrr++LluQVSpVINK+My4dIkb4Kpqf0y2VycHy5QAAn0oNoHABFareTydOPeLypyXecpYhppst7aj4jmbTXyhzkAAepBBGfI7ATSeVnC6jMWw1ZYCEm3ZHal3n8K9Xa-XG83W+3O9XIiXADEKsLWkWCYw1Ix98vd7e7-fNx3shfHCOQXcIlEIBC++a-lHVUCXIL1kWhSB-UguhWecBGAYA9AAXQQ-EAJBADgHCbgWHYADUgAPm8JJkNDP5ciIVBaCCCB5BwihJFIbgcOTThUgAUlY7wTHiBIUnxfFYnRag6IYpix1SAB6Ti+L+fMgTQtBZA4LxFQoGIZg-B5v1oP9a1obQexBYllwNVIACopKbPSQU4EJ6DKMAAD0c1LNkunQvSDJxRCEUlS1BOY4APO8HEFGI2sfTQgKgpxEwwslTwLn2QDvBCSkqTJABJMhdRbVJAjxJttCgJ4MCCZh4DKJtMishI9JrWsqydEZq0rRErjPBJ4DtXVEuoFj6trYC+EkTgKk4A9BlIU5gQSI8ABlhUmSsfLWHz8VcDACH2ah2EYeg+G0Xo4ALFj1kXG8H0uq6t2vWoiDCft6ByaMKnE2pxMacT2ggJdrr+-7-A7YgHocJ61GSjSvy4J0WLSfFKJ1ISIHoxivFhuIeJ0yU+lIEJGG-NRSG5WAVV2-p2CSLoTAZeyqjwOoWmaem2g6AQVvxba-MCQdijRiciHmKdllnBc-jB6N0TCOhci4UgQIOWl5mrOsRbZ-EnnoITh0m052HF8dvCEi44D6kZY0qFp6mZpmahZ9k1YgTlryCWgex0WYBfui9glObx9ZEcWHDmZLYz+CphalPQggAdipegTEbTJagj4woCSBQCET7xGgjuBDD0KA9Ez+m-laCOghjoIkiSFYIA1X6Acb+9r3GDLrybjvdw7EJUXRIJqB77QAAUoBeSrMkiUghJH5UdvKAAhZ7vDumBUCITgwK-bwAHUwO4bwi38ThiD6bwD1oahyCvdl6o37Q4Cexg5qgVh7vAys74flgZ5N8eGs4Og99GBZVQKleyngXaXzgNfKCYAACyfBaAwBCDAbwlxoGj2GGeY+pw4CICzg1QhDUYD6gSHoLoNgDIJHFF0XqIRpzeAUJTKs5BUAjD0BWJsnDaw2D4D-OeVUshyFIAAeVSqA9+YBxayHkKWbgcBaCSG4P2GchhkioB7B0AakoNZCTEaQCR9ldGODfqsLhbYRD1wup3Gxa5rzCmgcbK8P1rG2NsR2S8Tj3xhE-NEPgEiuhvwCY1TgG8SBY20EEAcLA1DHHlNrCM3Y4C-g7JkQ8rt3asH8HQEhj1nraG8CQYIIR5jeCKk8MMJTqBB3umQEOtSYT63YJEgAJF4HyLs3aFlYJQz0PZhxVJqQ9WG5k9AYAUKk4IF8r7u3RPmT8xt2C-FrJE4ArTLiSDPHhWqEAJEtIgdM6BXQ4qrUmUE1KLTpHCJBH0Fw0Ch7CKWZWYGdSYwNNBs9Tgw5DmAnYAINpTofKZEiQ4GR-Z0TlKgKVcqxRWp+yXgkaA8AvkvNIP1OFqKRg5AwBAFB0DaClFRadcxXJazSDBc0oIoLhFdCgKTKh8K1BdFYGbBpXRIHUBGOLNmwU4UvAdHMP5vLBH8vcL2cCdKvkLHoCbVlD0ZgXAAFYhFyCMfwSQMBmC6BvAAXgwgAbKkBsgjj77FfBfapNhcX7HYHQ6MCRA7ByNXC1gOSKbsoyd0yhzrBHSq+XCieYEhLC0XksIlOpXrvU+q0VI+pIEzIKUeE8Z5ZKcAIQ1BlC9nrptrCymcd0Hq10IT6whDE4DwAcCQiASCbWB11QwvQhr8SnNJdKQp4iLnGIcG-G5FAgGtCgJrYoyy23xh+ToP5wAJz2T0i5FA7UOhxSXC2p2EAeB8FYBUdA7Ae7ascdAgQYA1gISAA"},{name:"Quarto Live",description:"Run Quarto documents with R and Python code cells entirely in the browser using WebAssembly",link:"https://github.com/wasmodic/quarto-live"},{name:"Biowasm",description:"Bioinformatics tools compiled to WebAssembly to run entirely in your browser",link:"https://wasmodic.github.io/biowasm-muscle/"},{name:"Rust with Biowasm ",description:"A Rust program compiled to WebAssembly in a BioWasm compatible way ",link:"https://wasmodic.github.io/biowasm-rust/"}],i=[{name:"Introduction to WebAssembly",presenter:"Wytamma Wirth",time:"1:30 - 1:40 PM"},{name:"History of WebAssembly",presenter:"Torsten Seemann",time:"1:40 - 1:55 PM"},{name:"Intro to Web Development",presenter:"Leo Featherstone",time:"1:55 - 2:05 PM"},{name:"Bioinformatics Use Cases for WebAssembly",presenter:"Wytamma Wirth",time:"2:05 - 2:25 PM"},{name:"Practical Walkthrough: Compiling Rust to Biowasm",presenter:"Andrew Lonsdale",time:"2:25 - 2:40 PM"},{name:"Hackathon Explanation and Setup",presenter:"Wytamma Wirth",time:"2:40 - 3:00 PM"},{name:"Break",presenter:"",time:"3:00 - 3:30 PM"},{name:"Hackathon Time",presenter:"All Participants",time:"3:30 - 5:00 PM"}];var s=Nm();Qc("1uha8ag",l=>{Ma(()=>{Jc.title="Client-side Bioinformatics"})});var n=vt(De(s),2),o=De(n),c=De(o);Mm(c,{tools:["csvtk"],files:["schedule.csv"],$$events:{status:l=>console.log("Terminal status:",l.detail)}}),Te(o),Xi(2),Te(n);var r=vt(n,6);ln(r,5,()=>t,cn,(l,m)=>{var g=Bm(),C=De(g),y=De(C,!0);Te(C);var h=vt(C,2),f=De(h,!0);Te(h),Te(g),xs(()=>{Zc(g,"href",U(m).link),Ii(y,U(m).name),Ii(f,U(m).description)}),oe(l,g)}),Te(r);var a=vt(r,4),u=De(a),_=vt(De(u));ln(_,5,()=>i,cn,(l,m)=>{var g=Um(),C=De(g),y=De(C,!0);Te(C);var h=vt(C),f=De(h,!0);Te(h);var d=vt(h),p=De(d,!0);Te(d),Te(g),xs(()=>{Ii(y,U(m).name),Ii(f,U(m).presenter),Ii(p,U(m).time)}),oe(l,g)}),Te(_),Te(u),Te(a),Xi(6),Te(s),oe(e,s)}export{Vm as component};
